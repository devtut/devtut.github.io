<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MySQL - Performance Tuning</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Add the correct index, Don't hide in function, OR, Set the cache correctly, Negatives, Have an INDEX, Subqueries, JOIN + GROUP BY, Avoid inefficient constructs">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="MySQL - Performance Tuning">
    <meta property="og:description" content="Add the correct index, Don't hide in function, OR, Set the cache correctly, Negatives, Have an INDEX, Subqueries, JOIN + GROUP BY, Avoid inefficient constructs">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/mysql/performance-tuning.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="MySQL - Performance Tuning">
    <meta name="twitter:description" content="Add the correct index, Don't hide in function, OR, Set the cache correctly, Negatives, Have an INDEX, Subqueries, JOIN + GROUP BY, Avoid inefficient constructs">
    <meta name="twitter:url" content="/mysql/performance-tuning.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    <link rel="preload" href="/assets/css/0.styles.8b877eb8.css" as="style"><link rel="preload" href="/assets/js/app.ced448ab.js" as="script"><link rel="preload" href="/assets/js/3.f1d73125.js" as="script"><link rel="preload" href="/assets/js/2136.71149980.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.8b877eb8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>MySQL</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mysql/" class="sidebar-link">Disclaimer</a></li><li><a href="/mysql/getting-started-with-mysql.html" class="sidebar-link">Getting started with MySQL</a></li><li><a href="/mysql/data-types.html" class="sidebar-link">Data Types</a></li><li><a href="/mysql/select.html" class="sidebar-link">SELECT</a></li><li><a href="/mysql/backticks.html" class="sidebar-link">Backticks</a></li><li><a href="/mysql/null.html" class="sidebar-link">NULL</a></li><li><a href="/mysql/limit-and-offset.html" class="sidebar-link">Limit and Offset</a></li><li><a href="/mysql/creating-databases.html" class="sidebar-link">Creating databases</a></li><li><a href="/mysql/using-variables.html" class="sidebar-link">Using Variables</a></li><li><a href="/mysql/comment-mysql.html" class="sidebar-link">Comment Mysql</a></li><li><a href="/mysql/insert.html" class="sidebar-link">INSERT</a></li><li><a href="/mysql/delete.html" class="sidebar-link">DELETE</a></li><li><a href="/mysql/update.html" class="sidebar-link">UPDATE</a></li><li><a href="/mysql/order-by.html" class="sidebar-link">ORDER BY</a></li><li><a href="/mysql/group-by.html" class="sidebar-link">Group By</a></li><li><a href="/mysql/error-1055-only-full-group-by-something-is-not-in-group-by-clause.html" class="sidebar-link">Error 1055: ONLYFULLGROUP_BY: something  is not in GROUP BY clause ...</a></li><li><a href="/mysql/joins.html" class="sidebar-link">Joins</a></li><li><a href="/mysql/joins-join-3-table-with-the-same-name-of-id.html" class="sidebar-link">JOINS: Join 3 table with the same name of id.</a></li><li><a href="/mysql/union.html" class="sidebar-link">UNION</a></li><li><a href="/mysql/arithmetic.html" class="sidebar-link">Arithmetic</a></li><li><a href="/mysql/string-operations.html" class="sidebar-link">String operations</a></li><li><a href="/mysql/date-and-time-operations.html" class="sidebar-link">Date and Time Operations</a></li><li><a href="/mysql/handling-time-zones.html" class="sidebar-link">Handling Time Zones</a></li><li><a href="/mysql/regular-expressions.html" class="sidebar-link">Regular Expressions</a></li><li><a href="/mysql/view.html" class="sidebar-link">VIEW</a></li><li><a href="/mysql/table-creation.html" class="sidebar-link">Table Creation</a></li><li><a href="/mysql/alter-table.html" class="sidebar-link">ALTER TABLE</a></li><li><a href="/mysql/drop-table.html" class="sidebar-link">Drop Table</a></li><li><a href="/mysql/mysql-lock-table.html" class="sidebar-link">MySQL LOCK TABLE</a></li><li><a href="/mysql/error-codes.html" class="sidebar-link">Error codes</a></li><li><a href="/mysql/stored-routines-procedures-and-functions.html" class="sidebar-link">Stored routines (procedures and functions)</a></li><li><a href="/mysql/indexes-and-keys.html" class="sidebar-link">Indexes and Keys</a></li><li><a href="/mysql/full-text-search.html" class="sidebar-link">Full-Text search</a></li><li><a href="/mysql/prepare-statements.html" class="sidebar-link">PREPARE Statements</a></li><li><a href="/mysql/json.html" class="sidebar-link">JSON</a></li><li><a href="/mysql/extract-values-from-json-type.html" class="sidebar-link">Extract values from JSON type</a></li><li><a href="/mysql/mysql-admin.html" class="sidebar-link">MySQL Admin</a></li><li><a href="/mysql/triggers.html" class="sidebar-link">TRIGGERS</a></li><li><a href="/mysql/configuration-and-tuning.html" class="sidebar-link">Configuration and tuning</a></li><li><a href="/mysql/events.html" class="sidebar-link">Events</a></li><li><a href="/mysql/enum.html" class="sidebar-link">ENUM</a></li><li><a href="/mysql/install-mysql-container-with-docker-compose.html" class="sidebar-link">Install Mysql container with Docker-Compose</a></li><li><a href="/mysql/character-sets-and-collations.html" class="sidebar-link">Character Sets and Collations</a></li><li><a href="/mysql/myisam-engine.html" class="sidebar-link">MyISAM Engine</a></li><li><a href="/mysql/converting-from-myisam-to-innodb.html" class="sidebar-link">Converting from MyISAM to InnoDB</a></li><li><a href="/mysql/transaction.html" class="sidebar-link">Transaction</a></li><li><a href="/mysql/log-files.html" class="sidebar-link">Log files</a></li><li><a href="/mysql/clustering.html" class="sidebar-link">Clustering</a></li><li><a href="/mysql/partitioning.html" class="sidebar-link">Partitioning</a></li><li><a href="/mysql/replication.html" class="sidebar-link">Replication</a></li><li><a href="/mysql/backup-using-mysqldump.html" class="sidebar-link">Backup using mysqldump</a></li><li><a href="/mysql/mysqlimport.html" class="sidebar-link">mysqlimport</a></li><li><a href="/mysql/load-data-infile.html" class="sidebar-link">LOAD DATA INFILE</a></li><li><a href="/mysql/mysql-unions.html" class="sidebar-link">MySQL Unions</a></li><li><a href="/mysql/mysql-client.html" class="sidebar-link">MySQL client</a></li><li><a href="/mysql/temporary-tables.html" class="sidebar-link">Temporary Tables</a></li><li><a href="/mysql/customize-ps1.html" class="sidebar-link">Customize PS1</a></li><li><a href="/mysql/dealing-with-sparse-or-missing-data.html" class="sidebar-link">Dealing with sparse or missing data</a></li><li><a href="/mysql/connecting-with-utf-8-using-various-programming-language.html" class="sidebar-link">Connecting with UTF-8 Using Various Programming language.</a></li><li><a href="/mysql/time-with-subsecond-precision.html" class="sidebar-link">Time with subsecond precision</a></li><li><a href="/mysql/one-to-many.html" class="sidebar-link">One to Many</a></li><li><a href="/mysql/many-to-many-mapping-table.html" class="sidebar-link">Many-to-many Mapping table</a></li><li><a href="/mysql/pivot-queries.html" class="sidebar-link">Pivot queries</a></li><li><a href="/mysql/dynamic-un-pivot-table-using-prepared-statement.html" class="sidebar-link">Dynamic Un-Pivot Table using Prepared Statement</a></li><li><a href="/mysql/server-information.html" class="sidebar-link">Server Information</a></li><li><a href="/mysql/ssl-connection-setup.html" class="sidebar-link">SSL Connection Setup</a></li><li><a href="/mysql/create-new-user.html" class="sidebar-link">Create New User</a></li><li><a href="/mysql/security-via-grants.html" class="sidebar-link">Security via GRANTs</a></li><li><a href="/mysql/change-password.html" class="sidebar-link">Change Password</a></li><li><a href="/mysql/recover-and-reset-the-default-root-password-for-mysql-5-7.html" class="sidebar-link">Recover and reset the default root password for MySQL 5.7+</a></li><li><a href="/mysql/recover-from-lost-root-password.html" class="sidebar-link">Recover from lost root password</a></li><li><a href="/mysql/mysql-performance-tips.html" class="sidebar-link">Mysql Performance Tips</a></li><li><a href="/mysql/performance-tuning.html" class="active sidebar-link">Performance Tuning</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mysql/performance-tuning.html#add-the-correct-index" class="sidebar-link">Add the correct index</a></li><li class="sidebar-sub-header"><a href="/mysql/performance-tuning.html#don-t-hide-in-function" class="sidebar-link">Don't hide in function</a></li><li class="sidebar-sub-header"><a href="/mysql/performance-tuning.html#or" class="sidebar-link">OR</a></li><li class="sidebar-sub-header"><a href="/mysql/performance-tuning.html#set-the-cache-correctly" class="sidebar-link">Set the cache correctly</a></li><li class="sidebar-sub-header"><a href="/mysql/performance-tuning.html#negatives" class="sidebar-link">Negatives</a></li><li class="sidebar-sub-header"><a href="/mysql/performance-tuning.html#have-an-index" class="sidebar-link">Have an INDEX</a></li><li class="sidebar-sub-header"><a href="/mysql/performance-tuning.html#subqueries" class="sidebar-link">Subqueries</a></li><li class="sidebar-sub-header"><a href="/mysql/performance-tuning.html#join-group-by" class="sidebar-link">JOIN + GROUP BY</a></li><li class="sidebar-sub-header"><a href="/mysql/performance-tuning.html#avoid-inefficient-constructs" class="sidebar-link">Avoid inefficient constructs</a></li></ul></li><li><a href="/mysql/reserved-words.html" class="sidebar-link">Reserved Words</a></li><li><a href="/mysql/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="performance-tuning"><a href="#performance-tuning" class="header-anchor">#</a> Performance Tuning</h1> <h2 id="add-the-correct-index"><a href="#add-the-correct-index" class="header-anchor">#</a> Add the correct index</h2> <p>This is a huge topic, but it is also the most important &quot;performance&quot; issue.</p> <p>The main lesson for a novice is to learn of &quot;composite&quot; indexes.  Here's a quick example:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">INDEX</span><span class="token punctuation">(</span>last_name<span class="token punctuation">,</span> first_name<span class="token punctuation">)</span>

</code></pre></div><p>is excellent for these:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">WHERE</span> last_name <span class="token operator">=</span> <span class="token string">'...'</span>
<span class="token keyword">WHERE</span> first_name <span class="token operator">=</span> <span class="token string">'...'</span> <span class="token operator">AND</span> last_name <span class="token operator">=</span> <span class="token string">'...'</span>   <span class="token comment">-- (order in WHERE does not matter)</span>

</code></pre></div><p>but not for</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">WHERE</span> first_name <span class="token operator">=</span> <span class="token string">'...'</span>   <span class="token comment">-- order in INDEX _does_ matter</span>
<span class="token keyword">WHERE</span> last_name <span class="token operator">=</span> <span class="token string">'...'</span> <span class="token operator">OR</span> first_name <span class="token operator">=</span> <span class="token string">'...'</span>   <span class="token comment">-- &quot;OR&quot; is a killer</span>

</code></pre></div><h2 id="don-t-hide-in-function"><a href="#don-t-hide-in-function" class="header-anchor">#</a> Don't hide in function</h2> <p>A common mistake is to hide an indexed column inside a function call.  For example, this can't be helped by an index:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">WHERE</span> <span class="token keyword">DATE</span><span class="token punctuation">(</span>dt<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">'2000-01-01'</span>

</code></pre></div><p>Instead, given <code>INDEX(dt)</code> then these may use the index:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">WHERE</span> dt <span class="token operator">=</span> <span class="token string">'2000-01-01'</span>  <span class="token comment">-- if `dt` is datatype `DATE`</span>

</code></pre></div><p>This works for <code>DATE</code>, <code>DATETIME</code>, <code>TIMESTAMP</code>, and even <code>DATETIME(6)</code> (microseconds):</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">WHERE</span> dt <span class="token operator">&gt;=</span> <span class="token string">'2000-01-01'</span>
  <span class="token operator">AND</span> dt  <span class="token operator">&lt;</span> <span class="token string">'2000-01-01'</span> <span class="token operator">+</span> <span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">DAY</span>

</code></pre></div><h2 id="or"><a href="#or" class="header-anchor">#</a> OR</h2> <p>In general <code>OR</code> kills optimization.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">WHERE</span> a <span class="token operator">=</span> <span class="token number">12</span> <span class="token operator">OR</span> b <span class="token operator">=</span> <span class="token number">78</span>

</code></pre></div><p>cannot use <code>INDEX(a,b)</code>, and may or may not use <code>INDEX(a), INDEX(b)</code> via &quot;index merge&quot;.  Index merge is better than nothing, but only barely.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">WHERE</span> x <span class="token operator">=</span> <span class="token number">3</span> <span class="token operator">OR</span> x <span class="token operator">=</span> <span class="token number">5</span>

</code></pre></div><p>is turned into</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">WHERE</span> x <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>

</code></pre></div><p>which <strong>may</strong> use an index with <code>x</code> in it.</p> <h2 id="set-the-cache-correctly"><a href="#set-the-cache-correctly" class="header-anchor">#</a> Set the cache correctly</h2> <p><code>innodb_buffer_pool_size</code> should be about 70% of available RAM.</p> <h2 id="negatives"><a href="#negatives" class="header-anchor">#</a> Negatives</h2> <p>Here are some things that are not likely to help performance.  They stem from out-of-date information and/or naivety.</p> <ul><li>InnoDB has improved to the point where MyISAM is unlikely to be better.</li> <li><code>PARTITIONing</code> rarely provides performance benefits; it can even hurt performance.</li> <li>Setting <code>query_cache_size</code> bigger than 100M will usually <strong>hurt</strong> performance.</li> <li>Increasing lots of values in <code>my.cnf</code> may lead to 'swapping', which is a <strong>serious</strong> performance problem.</li> <li>&quot;Prefix indexes&quot; (such as <code>INDEX(foo(20))</code>) are generally useless.</li> <li><code>OPTIMIZE TABLE</code> is almost always useless.  (And it involves locking the table.)</li></ul> <h2 id="have-an-index"><a href="#have-an-index" class="header-anchor">#</a> Have an INDEX</h2> <p>The most important thing for speeding up a query on any non-tiny table is to have a suitable index.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">WHERE</span> a <span class="token operator">=</span> <span class="token number">12</span>  <span class="token comment">--&gt; INDEX(a)</span>
<span class="token keyword">WHERE</span> a <span class="token operator">&gt;</span> <span class="token number">12</span>  <span class="token comment">--&gt; INDEX(a)</span>

<span class="token keyword">WHERE</span> a <span class="token operator">=</span> <span class="token number">12</span> <span class="token operator">AND</span> b <span class="token operator">&gt;</span> <span class="token number">78</span>  <span class="token comment">--&gt; INDEX(a,b) is more useful than INDEX(b,a)</span>
<span class="token keyword">WHERE</span> a <span class="token operator">&gt;</span> <span class="token number">12</span> <span class="token operator">AND</span> b <span class="token operator">&gt;</span> <span class="token number">78</span>  <span class="token comment">--&gt; INDEX(a) or INDEX(b); no way to handle both ranges</span>

<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> x  <span class="token comment">--&gt; INDEX(x)</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> x<span class="token punctuation">,</span> y  <span class="token comment">--&gt; INDEX(x,y) in that order</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> x <span class="token keyword">DESC</span><span class="token punctuation">,</span> y <span class="token keyword">ASC</span>  <span class="token comment">--&gt; No index helps - because of mixing ASC and DESC</span>

</code></pre></div><h2 id="subqueries"><a href="#subqueries" class="header-anchor">#</a> Subqueries</h2> <p>Subqueries come in several flavors, and they have different optimization potential.  First, note that subqueries can be either &quot;correlated&quot; or &quot;uncorrelated&quot;.  Correlated means that they depend on some value from outside the subquery.  This generally implies that the subquery <strong>must</strong> be re-evaluated for each outer value.</p> <p>This correlated subquery is often pretty good.  Note: It must return at most 1 value.  It is often useful as an alternative to, though not necessarily faster than, a <code>LEFT JOIN</code>.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token punctuation">(</span> <span class="token keyword">SELECT</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">FROM</span> t <span class="token keyword">WHERE</span> t<span class="token punctuation">.</span>x <span class="token operator">=</span> u<span class="token punctuation">.</span>x <span class="token punctuation">)</span> <span class="token keyword">AS</span> c
    <span class="token keyword">FROM</span> u <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">SELECT</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token punctuation">(</span> <span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span> <span class="token keyword">AS</span> c
    <span class="token keyword">FROM</span> u <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">SELECT</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token punctuation">(</span> <span class="token keyword">SELECT</span> x <span class="token keyword">FROM</span> t <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">LIMIT</span> <span class="token number">1</span> <span class="token punctuation">)</span> <span class="token keyword">AS</span> c
    <span class="token keyword">FROM</span> u <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

</code></pre></div><p>This is usually uncorrelated:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">FROM</span> <span class="token punctuation">(</span> <span class="token keyword">SELECT</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span> <span class="token keyword">AS</span> a
    <span class="token keyword">JOIN</span> b <span class="token keyword">ON</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

</code></pre></div><p>Notes on the <code>FROM-SELECT</code>:</p> <ul><li>If it returns 1 row, great.</li> <li>A good paradigm (again &quot;1 row&quot;) is for the subquery to be <code>( SELECT @n := 0 )</code>, thereby initializing an `@variable for use in the rest or the query.</li> <li>If it returns many rows <strong>and</strong> the <code>JOIN</code> also is <code>( SELECT ... )</code> with many rows, then efficiency can be terrible.  Pre-5.6, there was no index, so it became a <code>CROSS JOIN</code>; 5.6+ involves deducing the best index on the temp tables and then generating it, only to throw it away when finished with the <code>SELECT</code>.</li></ul> <h2 id="join-group-by"><a href="#join-group-by" class="header-anchor">#</a> JOIN + GROUP BY</h2> <p>A common problem that leads to an inefficient query goes something like this:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">FROM</span> a
    <span class="token keyword">JOIN</span> b  <span class="token keyword">ON</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">WHERE</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> a<span class="token punctuation">.</span>id

</code></pre></div><p>First, the <code>JOIN</code> expands the number of rows; then the <code>GROUP BY</code> whittles it back down the the number of rows in <code>a</code>.</p> <p>There may not be any good choices to solve this explode-implode problem.  One possible option is to turn the <code>JOIN</code> into a correlated subquery in the <code>SELECT</code>.  This also eliminates the <code>GROUP BY</code>.</p> <h2 id="avoid-inefficient-constructs"><a href="#avoid-inefficient-constructs" class="header-anchor">#</a> Avoid inefficient constructs</h2> <div class="language-sql extra-class"><pre class="language-sql"><code>x <span class="token operator">IN</span> <span class="token punctuation">(</span> <span class="token keyword">SELECT</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span>

</code></pre></div><p>turn into a <code>JOIN</code></p> <p>When possible, avoid <code>OR</code>.</p> <p>Do not 'hide' an indexed column in a function, such as <code>WHERE DATE(x) = ...</code>; reformulate as <code>WHERE x = ...</code></p> <p>You can generally avoid <code>WHERE LCASE(name1) = LCASE(name2)</code> by having a suitable collation.</p> <p>Do no use <code>OFFSET</code> for &quot;pagination&quot;, instead 'remember where you left off'.</p> <p>Avoid <code>SELECT * ...</code> (unless debugging).</p> <p><strong>Note to Maria Deleva, Barranka, Batsu: This is a place holder; please make remove these items as you build full-scale examples.  After you have done the ones you can, I will move in to elaborate on the rest and/or toss them.</strong></p> <h4 id="syntax"><a href="#syntax" class="header-anchor">#</a> Syntax</h4> <li>
Don't use DISTINCT and GROUP BY in the same SELECT.
</li> <li>
Don't paginate via OFFSET, &quot;remember where you left off&quot;.
</li> <li>
WHERE (a,b) = (22,33) does not optimize at all.
</li> <li>
Explicitly say ALL or DISTINCT after UNION -- it reminds you pick between the faster ALL or the slower DISTINCT.
</li> <li>
Don't use SELECT *, especially if you have TEXT or BLOB columns that you don't need. There is overhead in tmp tables and transmission.
</li> <li>
It is faster when the GROUP BY and ORDER BY can have exactly the same list.
</li> <li>
Don't use FORCE INDEX; it may help today, but will probably hurt tomorrow.
</li> <h4 id="remarks"><a href="#remarks" class="header-anchor">#</a> Remarks</h4> <p>See also discussions about ORDER BY, LIKE, REGEXP, etc. Note: this needs editing with links and more Topics.</p> <p><a href="https://mariadb.com/kb/en/mariadb/building-the-best-index-for-a-given-select/" target="_blank" rel="noopener noreferrer"><strong>Cookbook on building optimal indexes</strong><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/mysql/performance-tuning.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/mysql/mysql-performance-tips.html" class="prev">
        Mysql Performance Tips
      </a></span> <span class="next"><a href="/mysql/reserved-words.html">
        Reserved Words
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.ced448ab.js" defer></script><script src="/assets/js/3.f1d73125.js" defer></script><script src="/assets/js/2136.71149980.js" defer></script>
  </body>
</html>
