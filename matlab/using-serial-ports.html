<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MATLAB - Using serial ports</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Creating a serial port on Mac/Linux/Windows, Chosing your communication mode, Reading from the serial port, Closing a serial port even if lost, deleted or overwritten, Writing to the serial port, Automatically processing data received from a serial port">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="MATLAB - Using serial ports">
    <meta property="og:description" content="Creating a serial port on Mac/Linux/Windows, Chosing your communication mode, Reading from the serial port, Closing a serial port even if lost, deleted or overwritten, Writing to the serial port, Automatically processing data received from a serial port">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/matlab/using-serial-ports.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="MATLAB - Using serial ports">
    <meta name="twitter:description" content="Creating a serial port on Mac/Linux/Windows, Chosing your communication mode, Reading from the serial port, Closing a serial port even if lost, deleted or overwritten, Writing to the serial port, Automatically processing data received from a serial port">
    <meta name="twitter:url" content="/matlab/using-serial-ports.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    <link rel="preload" href="/assets/css/0.styles.8b877eb8.css" as="style"><link rel="preload" href="/assets/js/app.ced448ab.js" as="script"><link rel="preload" href="/assets/js/3.f1d73125.js" as="script"><link rel="preload" href="/assets/js/1940.068edfa7.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.8b877eb8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>MATLAB</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/matlab/" class="sidebar-link">Disclaimer</a></li><li><a href="/matlab/getting-started-with-matlab-language.html" class="sidebar-link">Getting started with MATLAB Language</a></li><li><a href="/matlab/initializing-matrices-or-arrays.html" class="sidebar-link">Initializing Matrices or arrays</a></li><li><a href="/matlab/conditions.html" class="sidebar-link">Conditions</a></li><li><a href="/matlab/functions.html" class="sidebar-link">Functions</a></li><li><a href="/matlab/set-operations.html" class="sidebar-link">Set operations</a></li><li><a href="/matlab/documenting-functions.html" class="sidebar-link">Documenting functions</a></li><li><a href="/matlab/using-functions-with-logical-output.html" class="sidebar-link">Using functions with logical output</a></li><li><a href="/matlab/for-loops.html" class="sidebar-link">For loops</a></li><li><a href="/matlab/object-oriented-programming.html" class="sidebar-link">Object-Oriented Programming</a></li><li><a href="/matlab/vectorization.html" class="sidebar-link">Vectorization</a></li><li><a href="/matlab/matrix-decompositions.html" class="sidebar-link">Matrix decompositions</a></li><li><a href="/matlab/graphics-2d-line-plots.html" class="sidebar-link">Graphics: 2D Line Plots</a></li><li><a href="/matlab/graphics-2d-and-3d-transformations.html" class="sidebar-link">Graphics: 2D and 3D Transformations</a></li><li><a href="/matlab/controlling-subplot-coloring-in-matlab.html" class="sidebar-link">Controlling Subplot coloring in Matlab</a></li><li><a href="/matlab/image-processing.html" class="sidebar-link">Image processing</a></li><li><a href="/matlab/drawing.html" class="sidebar-link">Drawing</a></li><li><a href="/matlab/financial-applications.html" class="sidebar-link">Financial Applications</a></li><li><a href="/matlab/fourier-transforms-and-inverse-fourier-transforms.html" class="sidebar-link">Fourier Transforms and Inverse Fourier Transforms</a></li><li><a href="/matlab/ordinary-differential-equations-ode-solvers.html" class="sidebar-link">Ordinary Differential Equations (ODE) Solvers</a></li><li><a href="/matlab/interpolation-with-matlab.html" class="sidebar-link">Interpolation with MATLAB</a></li><li><a href="/matlab/integration.html" class="sidebar-link">Integration</a></li><li><a href="/matlab/reading-large-files.html" class="sidebar-link">Reading large files</a></li><li><a href="/matlab/usage-of-accumarray-function.html" class="sidebar-link">Usage of accumarray() Function</a></li><li><a href="/matlab/introduction-to-mex-api.html" class="sidebar-link">Introduction to MEX API</a></li><li><a href="/matlab/debugging.html" class="sidebar-link">Debugging</a></li><li><a href="/matlab/performance-and-benchmarking.html" class="sidebar-link">Performance and Benchmarking</a></li><li><a href="/matlab/multithreading.html" class="sidebar-link">Multithreading</a></li><li><a href="/matlab/using-serial-ports.html" class="active sidebar-link">Using serial ports</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/matlab/using-serial-ports.html#creating-a-serial-port-on-mac-linux-windows" class="sidebar-link">Creating a serial port on Mac/Linux/Windows</a></li><li class="sidebar-sub-header"><a href="/matlab/using-serial-ports.html#chosing-your-communication-mode" class="sidebar-link">Chosing your communication mode</a></li><li class="sidebar-sub-header"><a href="/matlab/using-serial-ports.html#reading-from-the-serial-port" class="sidebar-link">Reading from the serial port</a></li><li class="sidebar-sub-header"><a href="/matlab/using-serial-ports.html#closing-a-serial-port-even-if-lost-deleted-or-overwritten" class="sidebar-link">Closing a serial port even if lost, deleted or overwritten</a></li><li class="sidebar-sub-header"><a href="/matlab/using-serial-ports.html#writing-to-the-serial-port" class="sidebar-link">Writing to the serial port</a></li><li class="sidebar-sub-header"><a href="/matlab/using-serial-ports.html#automatically-processing-data-received-from-a-serial-port" class="sidebar-link">Automatically processing data received from a serial port</a></li></ul></li><li><a href="/matlab/undocumented-features.html" class="sidebar-link">Undocumented Features</a></li><li><a href="/matlab/matlab-best-practices.html" class="sidebar-link">MATLAB Best Practices</a></li><li><a href="/matlab/matlab-user-interfaces.html" class="sidebar-link">MATLAB User Interfaces</a></li><li><a href="/matlab/useful-tricks.html" class="sidebar-link">Useful tricks</a></li><li><a href="/matlab/common-mistakes-and-errors.html" class="sidebar-link">Common mistakes and errors</a></li><li><a href="/matlab/programming-utilities.html" class="sidebar-link">Programming Utilities</a></li><li><a href="/matlab/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="using-serial-ports"><a href="#using-serial-ports" class="header-anchor">#</a> Using serial ports</h1> <p>Serial ports are a common interface for communicating with external sensors or embedded systems such as Arduinos. Modern serial communications are often implemented over USB connections using USB-serial adapters.
MATLAB provides built-in functions for serial communications, including RS-232 and RS-485 protocols. These functions can be used for hardware serial ports or &quot;virtual&quot; USB-serial connections. The examples here illustrate serial communications in MATLAB.</p> <h2 id="creating-a-serial-port-on-mac-linux-windows"><a href="#creating-a-serial-port-on-mac-linux-windows" class="header-anchor">#</a> Creating a serial port on Mac/Linux/Windows</h2> <div class="language-matlab extra-class"><pre class="language-matlab"><code><span class="token comment">% Define serial port with a baud rate of 115200</span>
rate <span class="token operator">=</span> <span class="token number">115200</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> ispc
    s <span class="token operator">=</span> <span class="token function">serial</span><span class="token punctuation">(</span><span class="token string">'COM1'</span><span class="token punctuation">,</span> <span class="token string">'BaudRate'</span><span class="token punctuation">,</span>rate<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">elseif</span> ismac
    <span class="token comment">% Note that on OSX the serial device is uniquely enumerated. You will</span>
    <span class="token comment">% have to look at /dev/tty.* to discover the exact signature of your</span>
    <span class="token comment">% serial device</span>
    s <span class="token operator">=</span> <span class="token function">serial</span><span class="token punctuation">(</span><span class="token string">'/dev/tty.usbserial-A104VFT7'</span><span class="token punctuation">,</span> <span class="token string">'BaudRate'</span><span class="token punctuation">,</span>rate<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">elseif</span> isunix
    s <span class="token operator">=</span> <span class="token function">serial</span><span class="token punctuation">(</span><span class="token string">'/dev/ttyusb0'</span><span class="token punctuation">,</span> <span class="token string">'BaudRate'</span><span class="token punctuation">,</span>rate<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span>

<span class="token comment">% Set the input buffer size to 1,000,000 bytes (default: 512 bytes).</span>
s<span class="token punctuation">.</span>InputBufferSize <span class="token operator">=</span> <span class="token number">1000000</span><span class="token punctuation">;</span>    

<span class="token comment">% Open serial port    </span>
<span class="token function">fopen</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="chosing-your-communication-mode"><a href="#chosing-your-communication-mode" class="header-anchor">#</a> Chosing your communication mode</h2> <p>Matlab supports <strong>synchronous</strong> and <strong>asynchronous</strong> communication with a serial port. It is important to chose the right communication mode. The choice will depend on:</p> <ul><li>how the instrument you are communicating with behave.</li> <li>what other functions your main program (or GUI) will have to do aside from managing the serial port.</li></ul> <p>I'll define 3 different cases to illustrate, from the simplest to the most demanding. For the 3 examples, the instrument I am connecting to is a circuit board with an inclinometer, which can work in the 3 modes I will be describing below.</p> <h3 id="mode-1-synchronous-master-slave"><a href="#mode-1-synchronous-master-slave" class="header-anchor">#</a> Mode 1: Synchronous (Master/Slave)</h3> <p>This mode is the simplest one. It correspond to the case where the PC is the <strong>Master</strong> and the instrument is the <strong>slave</strong>. The instrument does not send anything to the serial port on it's own, it only <strong>replies</strong> an answer after being asked a question/command by the Master (the PC, your program). For example:</p> <ul><li>The PC sends a command: &quot;Give me a measurement now&quot;</li> <li>The instrument receive the command, take the measurement then send back the measurement value to the serial line: &quot;The inclinometer value is XXX&quot;.</li></ul> <p>OR</p> <ul><li>The PC sends a command: &quot;Change from mode X to mode Y&quot;</li> <li>The instrument receive the command, execute it, then send a confirmation message back to the serial line: &quot;<strong>Command executed</strong>&quot; (or &quot;<strong>Command NOT executed</strong>&quot;). This is commonly called an ACK/NACK reply (for &quot;Acknowledge(d)&quot; / &quot;NOT Acknowledged&quot;).</li></ul> <p><strong>Summary:</strong> in this mode, the instrument (the <strong>Slave</strong>) only send data to the serial line <strong>immediately after</strong> having been asked by the PC (the <strong>Master</strong>)</p> <p><a href="http://i.stack.imgur.com/t1XyZ.gif" target="_blank" rel="noopener noreferrer"><img src="http://i.stack.imgur.com/t1XyZ.gif" alt="Synchronous illustration"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="mode-2-asynchronous"><a href="#mode-2-asynchronous" class="header-anchor">#</a> Mode 2: Asynchronous</h3> <p>Now suppose I started my instrument, but it is more than just a dumb sensor. It constantly monitor it's own inclination and as long as it is vertical (within a tolerance, let's say +/-15 degrees), it stays silent. If the device is tilted by more than 15 degrees and get close to horizontal, it sends an alarm message to the serial line, immediately followed by a reading of the inclination. As long as the inclination is above the threshold, it continues to send an inclination reading every 5s.</p> <p>If your main program (or GUI) is constantly &quot;waiting&quot; for message arriving on the serial line, it can do that well ... but it cannot do anything else in the meantime. If the main program is a GUI, it is highly frustrating to have a GUI seemingly &quot;frozen&quot; because it won't accept any input from the user. Essentially, it became the <strong>Slave</strong> and the instrument is the <strong>Master</strong>. Unless you have a fancy way of controlling your GUI from the instrument, this is something to avoid. Fortunately, the <strong>asynchronous</strong> communication mode will let you:</p> <ul><li>define a separate function which tells your program what to do when a message is received</li> <li>keep this function in a corner, it will only be called and executed <strong>when a message arrives</strong> on the serial line. The rest of the time the GUI can execute any other code it has to run.</li></ul> <p><strong>Summary:</strong> In this mode, the instrument may send message to the serial line at anytime (but not necessarily <strong>all</strong> the time). The PC does not <strong>wait</strong> permanently for a message to process. It is allowed to run any other code. Only when a message arrives, it activates a function which will then read and process this message.</p> <p><a href="http://i.stack.imgur.com/WzhGZ.gif" target="_blank" rel="noopener noreferrer"><img src="http://i.stack.imgur.com/WzhGZ.gif" alt="enter image description here"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="mode-3-streaming-real-time"><a href="#mode-3-streaming-real-time" class="header-anchor">#</a> Mode 3: Streaming (<strong>Real time</strong>)</h3> <p>Now let's unleash the full power of my instrument. I put it in a mode where it will constantly send measurements to the serial line. My program want to receive these packets and display that on a curve or a digital display. If it only send a value every 5s as above, no problem, keep the above mode. But my instrument at full whack sends a data point to the serial line at 1000Hz, i.e. it sends a new value every single millisecond.
If I stay in the <strong>asynchronous mode</strong> described above, there is a high risk (actually a guaranteed certainty) that the special function we defined to process every new packet will take more than 1ms to execute (if you want to plot or display the value, graphic functions are quite slow, not even considering filtering or FFT'ing the signal). It means the function will start to execute, but before it finishes, a new packet will arrive and trigger the function again. The second function is placed in a queue for execution, and will only starts when the first one is done ... but by this time a few new packets arrived and each placed a function to execute in the queue. You can quickly foresee the result: By the time I am plotting the 5th points, I have already hundreds waiting to be plotted too ... the gui slows down, eventually freezes, the stack grows, the buffers fill up, until something gives. Eventually you are left with a completely frozen program or simply a crashed one.</p> <p>To overcome this, we will disconnect even further the synchronisation link between the PC and the instrument. We will let the instrument send data at it's own pace, without immediately triggering a function at each packet arrival. The serial port buffer will just accumulate the packets received. The PC will only collect data in the buffer at a pace it can manage (a regular interval, set up on the PC side), do something with it (while the buffer is getting refilled by the instrument), then collect a new batch of data from the buffer ... and so on.</p> <p><strong>Summary:</strong> In this mode, the instrument sends data continuously, which are collected by the serial port buffer. At regular interval, the PC collect data from the buffer and do something with it. There is no hard synchronisation link between the PC and the instrument. Both execute their tasks on their own timing.</p> <p><a href="http://i.stack.imgur.com/4kHsk.gif" target="_blank" rel="noopener noreferrer"><img src="http://i.stack.imgur.com/4kHsk.gif" alt="enter image description here"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="reading-from-the-serial-port"><a href="#reading-from-the-serial-port" class="header-anchor">#</a> Reading from the serial port</h2> <p>Assuming you created the serial port object <code>s</code> as in <a href="http://stackoverflow.com/documentation/matlab/1176/using-serial-ports-in-matlab/3802/creating-a-useful-serial-port-on-mac-linux-windows" target="_blank" rel="noopener noreferrer">this<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> example, then</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code><span class="token comment">% Read one byte</span>
data <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">% Read all the bytes, version 1</span>
data <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">% Read all the bytes, version 2</span>
data <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> s<span class="token punctuation">.</span>BytesAvailable<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">% Close the serial port</span>
<span class="token function">fclose</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="closing-a-serial-port-even-if-lost-deleted-or-overwritten"><a href="#closing-a-serial-port-even-if-lost-deleted-or-overwritten" class="header-anchor">#</a> Closing a serial port even if lost, deleted or overwritten</h2> <p>Assuming you created the serial port object <code>s</code> as in <a href="http://stackoverflow.com/documentation/matlab/1176/using-serial-ports-in-matlab/3802/creating-a-useful-serial-port-on-mac-linux-windows" target="_blank" rel="noopener noreferrer">this<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> example, then to close it</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code><span class="token function">fclose</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>

</code></pre></div><p>However, sometimes you can accidentally lose the port (e.g. clear, overwrite, change scope, etc...), and <code>fclose(s)</code> will no longer work. The solution is easy</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code><span class="token function">fclose</span><span class="token punctuation">(</span>instrfindall<span class="token punctuation">)</span>

</code></pre></div><p>More info at <a href="http://www.mathworks.com/help/matlab/ref/instrfindall.html" target="_blank" rel="noopener noreferrer"><code>instrfindall()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h2 id="writing-to-the-serial-port"><a href="#writing-to-the-serial-port" class="header-anchor">#</a> Writing to the serial port</h2> <p>Assuming you created the serial port object <code>s</code> as in <a href="http://stackoverflow.com/documentation/matlab/1176/using-serial-ports-in-matlab/3802/creating-a-useful-serial-port-on-mac-linux-windows" target="_blank" rel="noopener noreferrer">this<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> example, then</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code><span class="token comment">% Write one byte</span>
<span class="token function">fwrite</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">% Write one 16-bit signed integer</span>
<span class="token function">fwrite</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token number">32767</span><span class="token punctuation">,</span> <span class="token string">'int16'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">% Write an array of unsigned 8-bit integers</span>
<span class="token function">fwrite</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">48</span> <span class="token number">49</span> <span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'uchar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">% Close the serial port</span>
<span class="token function">fclose</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="automatically-processing-data-received-from-a-serial-port"><a href="#automatically-processing-data-received-from-a-serial-port" class="header-anchor">#</a> Automatically processing data received from a serial port</h2> <p>Some devices connected through a serial port send data to your program at a constant rate (streaming data) or send data at unpredictable intervals. You can configure the serial port to execute a function automatically to handle data whenever it arrives. This is called the <a href="http://www.mathworks.com/help/matlab/matlab_external/events-and-callbacks.html#f75633" target="_blank" rel="noopener noreferrer">&quot;callback function&quot;<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for the serial port object.</p> <p>There are two properties of the serial port that must be set to use this feature: the name of the function you want for the callback (<code>BytesAvailableFcn</code>), and the condition which should trigger executing the callback function (<code>BytesAvailableFcnMode</code>).</p> <p>There are two ways to trigger a callback function:</p> <ol><li>When a certain number of bytes have been received at the serial port (typically used for binary data)</li> <li>When a certain character is received at the serial port (typically used for text or ASCII data)</li></ol> <p>Callback functions have two required input arguments, called <code>obj</code> and <code>event</code>. <code>obj</code> is the serial port. For example, if you want to print the data received from the serial port, define a function for printing the data called <code>newdata</code>:</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code><span class="token keyword">function</span> <span class="token function">newdata</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span>event<span class="token punctuation">)</span>
    <span class="token punctuation">[</span>d<span class="token punctuation">,</span>c<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">% get the data from the serial port</span>
    <span class="token comment">% Note: for ASCII data, use fscanf(obj) to return characters instead of binary values</span>
    <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'Received %d bytes\n'</span><span class="token punctuation">,</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">disp</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>
<span class="token keyword">end</span>

</code></pre></div><p>For example, to execute the <code>newdata</code> function whenever 64 bytes of data are received, configure the serial port like this:</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>s <span class="token operator">=</span> <span class="token function">serial</span><span class="token punctuation">(</span>port_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
s<span class="token punctuation">.</span>BytesAvailableFcnMode <span class="token operator">=</span> <span class="token string">'byte'</span><span class="token punctuation">;</span>
s<span class="token punctuation">.</span>BytesAvailableFcnCount <span class="token operator">=</span> <span class="token number">64</span><span class="token punctuation">;</span>
s<span class="token punctuation">.</span>BytesAvailableFcn <span class="token operator">=</span> <span class="token operator">@</span>newdata<span class="token punctuation">;</span>

</code></pre></div><p>With text or ASCII data, the data is typically divided into lines with a &quot;terminator character&quot;, just like text on a page. To execute the <code>newdata</code> function whenever the carriage return character is received, configure the serial port like this:</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>s <span class="token operator">=</span> <span class="token function">serial</span><span class="token punctuation">(</span>port_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
s<span class="token punctuation">.</span>BytesAvailableFcnMode <span class="token operator">=</span> <span class="token string">'terminator'</span><span class="token punctuation">;</span>
s<span class="token punctuation">.</span>Terminator <span class="token operator">=</span> <span class="token string">'CR'</span><span class="token punctuation">;</span>  <span class="token comment">% the carriage return, ASCII code 13</span>
s<span class="token punctuation">.</span>BytesAvailableFcn <span class="token operator">=</span> <span class="token operator">@</span>newdata<span class="token punctuation">;</span>

</code></pre></div><h4 id="parameters"><a href="#parameters" class="header-anchor">#</a> Parameters</h4> <table><thead><tr><th>Serial port parameter</th> <th>what it does</th></tr></thead> <tbody><tr><td><code>BaudRate</code></td> <td>Sets the baudrate. The most common today is 57600, but 4800, 9600, and  115200 are frequently seen as well</td></tr> <tr><td><code>InputBufferSize</code></td> <td>The number of bytes kept in memory. Matlab has a FIFO, which means that new bytes will be discarded. The default is 512 bytes, but it can easily be set to 20MB without issue. There are only a few edge cases where the user would want this to be small</td></tr> <tr><td><code>BytesAvailable</code></td> <td>The number of bytes waiting to be read</td></tr> <tr><td><code>ValuesSent</code></td> <td>The number of bytes sent since the port was opened</td></tr> <tr><td><code>ValuesReceived</code></td> <td>The number of bytes read since the port was opened</td></tr> <tr><td><code>BytesAvailableFcn</code></td> <td>Specify the callback function to execute when a specified number of bytes is available in the input buffer, or a terminator is read</td></tr> <tr><td><code>BytesAvailableFcnCount</code></td> <td>Specify the number of bytes that must be available in the input buffer to generate a <code>bytes-available</code> event</td></tr> <tr><td><code>BytesAvailableFcnMode</code></td> <td>Specify if the <code>bytes-available</code> event is generated after a specified number of bytes is available in the input buffer, or after a terminator is read</td></tr></tbody></table></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/matlab/using-serial-ports.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/matlab/multithreading.html" class="prev">
        Multithreading
      </a></span> <span class="next"><a href="/matlab/undocumented-features.html">
        Undocumented Features
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.ced448ab.js" defer></script><script src="/assets/js/3.f1d73125.js" defer></script><script src="/assets/js/1940.068edfa7.js" defer></script>
  </body>
</html>
