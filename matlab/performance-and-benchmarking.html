<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MATLAB - Performance and Benchmarking</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Identifying performance bottlenecks using the Profiler, Comparing execution time of multiple functions, It's ok to be `single`!, The importance of preallocation, rearrange a ND-array may improve the overall performance">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="MATLAB - Performance and Benchmarking">
    <meta property="og:description" content="Identifying performance bottlenecks using the Profiler, Comparing execution time of multiple functions, It's ok to be `single`!, The importance of preallocation, rearrange a ND-array may improve the overall performance">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/matlab/performance-and-benchmarking.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="MATLAB - Performance and Benchmarking">
    <meta name="twitter:description" content="Identifying performance bottlenecks using the Profiler, Comparing execution time of multiple functions, It's ok to be `single`!, The importance of preallocation, rearrange a ND-array may improve the overall performance">
    <meta name="twitter:url" content="/matlab/performance-and-benchmarking.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/1934.d7a6f60c.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>MATLAB</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/matlab/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/matlab/getting-started-with-matlab-language.html" class="sidebar-link">Getting started with MATLAB Language</a></li><li><a href="/matlab/initializing-matrices-or-arrays.html" class="sidebar-link">Initializing Matrices or arrays</a></li><li><a href="/matlab/conditions.html" class="sidebar-link">Conditions</a></li><li><a href="/matlab/functions.html" class="sidebar-link">Functions</a></li><li><a href="/matlab/set-operations.html" class="sidebar-link">Set operations</a></li><li><a href="/matlab/documenting-functions.html" class="sidebar-link">Documenting functions</a></li><li><a href="/matlab/using-functions-with-logical-output.html" class="sidebar-link">Using functions with logical output</a></li><li><a href="/matlab/for-loops.html" class="sidebar-link">For loops</a></li><li><a href="/matlab/object-oriented-programming.html" class="sidebar-link">Object-Oriented Programming</a></li><li><a href="/matlab/vectorization.html" class="sidebar-link">Vectorization</a></li><li><a href="/matlab/matrix-decompositions.html" class="sidebar-link">Matrix decompositions</a></li><li><a href="/matlab/graphics-2d-line-plots.html" class="sidebar-link">Graphics: 2D Line Plots</a></li><li><a href="/matlab/graphics-2d-and-3d-transformations.html" class="sidebar-link">Graphics: 2D and 3D Transformations</a></li><li><a href="/matlab/controlling-subplot-coloring-in-matlab.html" class="sidebar-link">Controlling Subplot coloring in Matlab</a></li><li><a href="/matlab/image-processing.html" class="sidebar-link">Image processing</a></li><li><a href="/matlab/drawing.html" class="sidebar-link">Drawing</a></li><li><a href="/matlab/financial-applications.html" class="sidebar-link">Financial Applications</a></li><li><a href="/matlab/fourier-transforms-and-inverse-fourier-transforms.html" class="sidebar-link">Fourier Transforms and Inverse Fourier Transforms</a></li><li><a href="/matlab/ordinary-differential-equations-ode-solvers.html" class="sidebar-link">Ordinary Differential Equations (ODE) Solvers</a></li><li><a href="/matlab/interpolation-with-matlab.html" class="sidebar-link">Interpolation with MATLAB</a></li><li><a href="/matlab/integration.html" class="sidebar-link">Integration</a></li><li><a href="/matlab/reading-large-files.html" class="sidebar-link">Reading large files</a></li><li><a href="/matlab/usage-of-accumarray-function.html" class="sidebar-link">Usage of accumarray() Function</a></li><li><a href="/matlab/introduction-to-mex-api.html" class="sidebar-link">Introduction to MEX API</a></li><li><a href="/matlab/debugging.html" class="sidebar-link">Debugging</a></li><li><a href="/matlab/performance-and-benchmarking.html" aria-current="page" class="active sidebar-link">Performance and Benchmarking</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/matlab/performance-and-benchmarking.html#identifying-performance-bottlenecks-using-the-profiler" class="sidebar-link">Identifying performance bottlenecks using the Profiler</a></li><li class="sidebar-sub-header"><a href="/matlab/performance-and-benchmarking.html#comparing-execution-time-of-multiple-functions" class="sidebar-link">Comparing execution time of multiple functions</a></li><li class="sidebar-sub-header"><a href="/matlab/performance-and-benchmarking.html#it-s-ok-to-be-single" class="sidebar-link">It's ok to be single!</a></li><li class="sidebar-sub-header"><a href="/matlab/performance-and-benchmarking.html#the-importance-of-preallocation" class="sidebar-link">The importance of preallocation</a></li><li class="sidebar-sub-header"><a href="/matlab/performance-and-benchmarking.html#rearrange-a-nd-array-may-improve-the-overall-performance" class="sidebar-link">rearrange a ND-array may improve the overall performance</a></li></ul></li><li><a href="/matlab/multithreading.html" class="sidebar-link">Multithreading</a></li><li><a href="/matlab/using-serial-ports.html" class="sidebar-link">Using serial ports</a></li><li><a href="/matlab/undocumented-features.html" class="sidebar-link">Undocumented Features</a></li><li><a href="/matlab/matlab-best-practices.html" class="sidebar-link">MATLAB Best Practices</a></li><li><a href="/matlab/matlab-user-interfaces.html" class="sidebar-link">MATLAB User Interfaces</a></li><li><a href="/matlab/useful-tricks.html" class="sidebar-link">Useful tricks</a></li><li><a href="/matlab/common-mistakes-and-errors.html" class="sidebar-link">Common mistakes and errors</a></li><li><a href="/matlab/programming-utilities.html" class="sidebar-link">Programming Utilities</a></li><li><a href="/matlab/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="performance-and-benchmarking"><a href="#performance-and-benchmarking" class="header-anchor">#</a> Performance and Benchmarking</h1> <h2 id="identifying-performance-bottlenecks-using-the-profiler"><a href="#identifying-performance-bottlenecks-using-the-profiler" class="header-anchor">#</a> Identifying performance bottlenecks using the Profiler</h2> <p>The MATLAB <a href="http://www.mathworks.com/help/matlab/ref/profile.html" target="_blank" rel="noopener noreferrer">Profiler<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> is a tool for <a href="https://en.wikipedia.org/wiki/_(computer_programming)" target="_blank" rel="noopener noreferrer">software profiling<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> of MATLAB code. Using the Profiler, it is possible to obtain a visual representation  of both execution time and memory consumption.</p> <p>Running the Profiler can be done in two ways:</p> <li>
Clicking the &quot;Run and Time&quot; button in the MATLAB GUI while having some `.m` file open in the editor (added in **R2012b**).
[<img src="http://i.stack.imgur.com/NQ04e.png" alt="Button in toolstrip">](http://i.stack.imgur.com/NQ04e.png)
</li> <li>
Programmatically, using:
<div class="language-matlab extra-class"><pre class="language-matlab"><code>profile on
<span class="token operator">&lt;</span>some code we want to test<span class="token operator">&gt;</span>
profile off

</code></pre></div></li> <p>Below is some sample code and the result of its profiling:</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code><span class="token keyword">function</span> docTest

<span class="token keyword">for</span> ind1 <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">100</span>
  <span class="token punctuation">[</span><span class="token operator">~</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">var</span><span class="token punctuation">(</span><span class="token punctuation">...</span>
            <span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">...</span>
                <span class="token function">randn</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span>

spy

</code></pre></div><p><a href="http://i.stack.imgur.com/GHjl9.png" target="_blank" rel="noopener noreferrer"><img src="http://i.stack.imgur.com/GHjl9.png" alt="Profiler output"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>From the above we learn that the <code>spy</code> function takes about 25% of the total execution time. In the case of &quot;real code&quot;, a function that takes such a large percentage of execution time would be a good candidate for optimization, as opposed to functions analogous to <code>var</code> and <code>cla</code> whose optimization should be avoided.</p> <p>Moreover, it is possible to click on entries in the <strong>Function Name</strong> column to see a detailed breakdown of execution time for that entry. Here's the example of clicking <code>spy</code>:</p> <p><a href="http://i.stack.imgur.com/66Gmq.png" target="_blank" rel="noopener noreferrer">&lt;img src=&quot;http://i.stack.imgur.com/66Gmq.png&quot; alt=&quot;Internal timing of &quot;spy&quot;&quot; /&gt;<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>It is also possible to profile memory consumption by executing <code>profile('-memory')</code> before running the Profiler.</p> <p><a href="http://i.stack.imgur.com/RUgrs.png" target="_blank" rel="noopener noreferrer"><img src="http://i.stack.imgur.com/RUgrs.png" alt="enter image description here"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="comparing-execution-time-of-multiple-functions"><a href="#comparing-execution-time-of-multiple-functions" class="header-anchor">#</a> Comparing execution time of multiple functions</h2> <p>The widely used combination of <a href="http://de.mathworks.com/help/matlab/ref/tic.html" target="_blank" rel="noopener noreferrer"><strong><code>tic</code></strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and  <a href="http://de.mathworks.com/help/matlab/ref/toc.html" target="_blank" rel="noopener noreferrer"><strong><code>toc</code></strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> can provide a rough idea of the execution time of a function or code snippets.</p> <p><strong>For comparing several functions it shouldn't be used.</strong> Why? It is almost impossible to provide <strong>equal conditions</strong> for all code snippets to compare within a script using above solution. Maybe the functions share the same function space and common variables, so later called functions and code snippets already take advantage of previously initialized variables and functions. Also the there is no insight whether the JIT compiler would handle these subsequently called snippets equally.</p> <p>The dedicated function for benchmarks is <a href="http://de.mathworks.com/help/matlab/ref/timeit.html" target="_blank" rel="noopener noreferrer"><strong><code>timeit</code></strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. The following example illustrates its use.</p> <p>There are the array <code>A</code> and the matrix <code>B</code>. It should be determined which row of <code>B</code> is the most similar to <code>A</code> by counting the number of different elements.</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code><span class="token keyword">function</span> t <span class="token operator">=</span> <span class="token function">bench</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    A <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    B <span class="token operator">=</span> <span class="token function">perms</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">% functions to compare</span>
    fcns <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token operator">@</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token function">compare1</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span>B<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">@</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token function">compare2</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span>B<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">@</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token function">compare3</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span>B<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">@</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token function">compare4</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span>B<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">% timeit</span>
    t <span class="token operator">=</span> <span class="token function">cellfun</span><span class="token punctuation">(</span><span class="token operator">@</span>timeit<span class="token punctuation">,</span> fcns<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span>

<span class="token keyword">function</span> Z <span class="token operator">=</span> <span class="token function">compare1</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span>B<span class="token punctuation">)</span>  
    Z <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span>  <span class="token function">bsxfun</span><span class="token punctuation">(</span><span class="token operator">@</span>eq<span class="token punctuation">,</span>  A<span class="token punctuation">,</span>B<span class="token punctuation">)</span> <span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span>
<span class="token keyword">function</span> Z <span class="token operator">=</span> <span class="token function">compare2</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span>B<span class="token punctuation">)</span>  
    Z <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token function">bsxfun</span><span class="token punctuation">(</span><span class="token operator">@</span>xor<span class="token punctuation">,</span> A<span class="token punctuation">,</span> B<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span>
<span class="token keyword">function</span> Z <span class="token operator">=</span> <span class="token function">compare3</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span>B<span class="token punctuation">)</span>  
    A <span class="token operator">=</span> <span class="token function">logical</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Z <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token function">B</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token operator">~</span>A<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token function">B</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span>A<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span>
<span class="token keyword">function</span> Z <span class="token operator">=</span> <span class="token function">compare4</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span>B<span class="token punctuation">)</span>  
     Z <span class="token operator">=</span> <span class="token function">pdist2</span><span class="token punctuation">(</span> A<span class="token punctuation">,</span> B<span class="token punctuation">,</span> <span class="token string">'hamming'</span><span class="token punctuation">,</span> <span class="token string">'Smallest'</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span>

</code></pre></div><p>This way of benchmark was first seen in <a href="http://stackoverflow.com/a/21047303/2605073" target="_blank" rel="noopener noreferrer">this answer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="it-s-ok-to-be-single"><a href="#it-s-ok-to-be-single" class="header-anchor">#</a> It's ok to be <code>single</code>!</h2> <h3 id="overview"><a href="#overview" class="header-anchor">#</a> Overview:</h3> <p>The default data type for numeric arrays in MATLAB is <code>double</code>. <code>double</code> is a <a href="https://en.wikipedia.org/wiki/Double-precision_floating-point_format" target="_blank" rel="noopener noreferrer">floating point representation of numbers<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, and this format takes 8 bytes (or 64 bits) per value. In <strong>some</strong> cases, where e.g. dealing only with integers or when numerical instability is not an imminent issue, such high bit depth may not be required. For this reason, it is advised to consider the benefits of <code>single</code> precision (or other appropriate <a href="http://www.mathworks.com/help/matlab/numeric-types.html" target="_blank" rel="noopener noreferrer">types<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>):</p> <ul><li>Faster execution time (especially noticeable on GPUs).
</li><li>Half the memory consumption:
may succeed where <code>double</code> fails due to an out-of-memory error; more compact when storing as files.</li></ul> <p>Converting a variable from any supported data type to <code>single</code> is done using:</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>sing_var <span class="token operator">=</span> <span class="token function">single</span><span class="token punctuation">(</span>var<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>Some commonly used functions (such as: <a href="http://www.mathworks.com/help/matlab/ref/zeros.html#btov09h-4" target="_blank" rel="noopener noreferrer"><code>zeros</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <a href="http://www.mathworks.com/help/matlab/ref/eye.html#btpkgsh-1" target="_blank" rel="noopener noreferrer"><code>eye</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <a href="http://www.mathworks.com/help/matlab/ref/ones.html#inputarg_classname" target="_blank" rel="noopener noreferrer"><code>ones</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <a href="http://www.mathworks.com/help/matlab/matlab_oop/class-support-for-array-creation-functions.html" target="_blank" rel="noopener noreferrer">etc.<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>) that output <code>double</code> values by default, allow specifying the type/class of the output.</p> <h3 id="converting-variables-in-a-script-to-a-non-default-precision-type-class"><a href="#converting-variables-in-a-script-to-a-non-default-precision-type-class" class="header-anchor">#</a> Converting variables in a script to a non-default precision/type/class:</h3> <p>As of July 2016, there exists no documented way to change the <strong>default</strong> MATLAB data type from <code>double</code>.</p> <p>In MATLAB, new variables usually mimic the data types of variables used when creating them. To illustrate this, consider the following example:</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>A <span class="token operator">=</span> <span class="token function">magic</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
B <span class="token operator">=</span> <span class="token function">diag</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token punctuation">;</span>
C <span class="token operator">=</span> <span class="token number">20</span><span class="token operator">*</span>B<span class="token punctuation">;</span>
<span class="token operator">&gt;</span><span class="token operator">&gt;</span> whos C
  Name      Size            Bytes  Class     Attributes
  C         <span class="token number">3</span>x1                <span class="token number">24</span>  double 

</code></pre></div><div class="language-matlab extra-class"><pre class="language-matlab"><code>A <span class="token operator">=</span> <span class="token function">single</span><span class="token punctuation">(</span><span class="token function">magic</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">% A is converted to &quot;single&quot;</span>
B <span class="token operator">=</span> <span class="token function">diag</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token punctuation">;</span>
C <span class="token operator">=</span> B<span class="token operator">*</span><span class="token function">double</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">% The stricter type, which in this case is &quot;single&quot;, prevails</span>
D <span class="token operator">=</span> <span class="token function">single</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>C<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">% It is generally advised to cast to the desired type explicitly.</span>
<span class="token operator">&gt;</span><span class="token operator">&gt;</span> whos C
  Name      Size            Bytes  Class     Attributes
  C         <span class="token number">3</span>x1                <span class="token number">12</span>  single  

</code></pre></div><p>Thus, it may seem sufficient to cast/convert several initial variables to have the change permeate throughout the code - however this is <strong>discouraged</strong> (see <strong>Caveats &amp; Pitfalls</strong> below).</p> <h3 id="caveats-pitfalls"><a href="#caveats-pitfalls" class="header-anchor">#</a> Caveats &amp; Pitfalls:</h3> <li>
Repeated conversions are **discouraged** due to the introduction of numeric noise (when casting from `single` to `double`) or loss of information (when casting from `double` to `single`, or between certain [integer types](http://www.mathworks.com/help/matlab/matlab_prog/integers.html)), e.g. :
<div class="language-matlab extra-class"><pre class="language-matlab"><code><span class="token function">double</span><span class="token punctuation">(</span><span class="token function">single</span><span class="token punctuation">(</span><span class="token number">1.2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">double</span><span class="token punctuation">(</span><span class="token number">1.2</span><span class="token punctuation">)</span>   
ans <span class="token operator">=</span>
     <span class="token number">0</span>

</code></pre></div><p>This can be mitigated somewhat using [`typecast`](http://www.mathworks.com/help/matlab/ref/typecast.html).
See also [Be aware of floating point inaccuracy](http://stackoverflow.com/documentation/matlab/973/common-mistakes-and-errors/9784/be-aware-of-floating-point-inaccuracy#t=20160802125306630276).</p></li> <li>
Relying solely on implicit data-typing (i.e. what MATLAB guesses the type of the output of a computation should be) is **discouraged** due to several undesired effects that might arise:
<ul><li>
**Loss of information**: when a `double` result is expected, but a careless combination of `single` and `double` operands yields `single` precision.
</li> <li>
**Unexpectedly high memory consumption**: when a `single` result is expected but a careless computation results in a `double` output.
</li> <li>
**Unnecessary overhead when working with GPUs**: when mixing `gpuArray` types (i.e. variables stored in VRAM) with non-`gpuArray` variables (i.e. those **usually** stored in RAM) the data will have to be transferred one way or the other before the computation can be performed. This operation takes time, and can be very noticeable in repetative computations.
</li> <li>
**Errors when mixing floating-point types with integer types**: functions like [`mtimes`](http://www.mathworks.com/help/matlab/ref/mtimes.html) (`*`) are not defined for mixed inputs of integer and floating point types - and will error. Functions like [`times`](http://www.mathworks.com/help/matlab/ref/times.html) (`.*`) are not defined at all for integer-type inputs - and will again error.
<div class="language-matlab extra-class"><pre class="language-matlab"><code><span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token function">ones</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'int32'</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">ones</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'int32'</span><span class="token punctuation">)</span>
Error using  <span class="token operator">*</span> 
MTIMES is not fully supported <span class="token keyword">for</span> integer classes<span class="token punctuation">.</span> At least one input must be scalar<span class="token punctuation">.</span>

<span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token function">ones</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'int32'</span><span class="token punctuation">)</span><span class="token operator">.*</span><span class="token function">ones</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'double'</span><span class="token punctuation">)</span>
Error using  <span class="token operator">.*</span> 
Integers can only be combined with integers of the same class<span class="token punctuation">,</span> or scalar doubles<span class="token punctuation">.</span>

</code></pre></div></li></ul>
For better code readability and reduced risk of unwanted types, a defensive approach is **advised**, where variables are **explicitly** cast to the desired type.
</li> <h3 id="see-also"><a href="#see-also" class="header-anchor">#</a> See Also:</h3> <ul><li>MATLAB Documentation: <a href="http://www.mathworks.com/help/matlab/matlab_prog/floating-point-numbers.html" target="_blank" rel="noopener noreferrer">Floating-Point Numbers<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</li> <li>Mathworks' Technical Article: <a href="http://www.mathworks.com/company/newsletters/articles/best-practices-for-converting-matlab-code-to-fixed-point.html" target="_blank" rel="noopener noreferrer">Best Practices for Converting MATLAB Code to Fixed Point<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</li></ul> <h2 id="the-importance-of-preallocation"><a href="#the-importance-of-preallocation" class="header-anchor">#</a> The importance of preallocation</h2> <p>Arrays in MATLAB are held as continuous blocks in memory, allocated and released automatically by MATLAB. MATLAB hides memory management operations such as resizing of an array behind easy to use syntax:</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>a <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">4</span>

a <span class="token operator">=</span>

     <span class="token number">1</span>     <span class="token number">2</span>     <span class="token number">3</span>     <span class="token number">4</span>

<span class="token function">a</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">10</span>  <span class="token comment">% or alternatively a = [a, 10]</span>

a <span class="token operator">=</span>

     <span class="token number">1</span>     <span class="token number">2</span>     <span class="token number">3</span>     <span class="token number">4</span>    <span class="token number">10</span>

</code></pre></div><p>It is important to understand that the above is not a trivial operation, <code>a(5) = 10</code> will cause MATLAB to allocate a new block of memory of size 5, copy the first 4 numbers over, and set the 5'th to 10. That's a <code>O(numel(a))</code> operation, and not <code>O(1)</code>.</p> <p>Consider the following:</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>clear all
n<span class="token operator">=</span><span class="token number">12345678</span><span class="token punctuation">;</span>
a<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
tic
<span class="token keyword">for</span> <span class="token number">i</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token operator">:</span>n
    <span class="token function">a</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">a</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">i</span><span class="token punctuation">;</span>
<span class="token keyword">end</span>
toc

Elapsed time is <span class="token number">3.004213</span> seconds<span class="token punctuation">.</span>

</code></pre></div><p><code>a</code> is reallocated <code>n</code> times in this loop (excluding some optimizations undertaken by MATLAB)! Note that MATLAB gives us a warning:</p> <blockquote></blockquote> <p>&quot;The variable 'a' appears to change size on every loop iteration. Consider preallocating for speed.&quot;</p> <p>What happens when we preallocate?</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>a<span class="token operator">=</span><span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
tic
<span class="token keyword">for</span> <span class="token number">i</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token operator">:</span>n
    <span class="token function">a</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">a</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">i</span><span class="token punctuation">;</span>
<span class="token keyword">end</span>
toc

Elapsed time is <span class="token number">0.410531</span> seconds<span class="token punctuation">.</span>

</code></pre></div><p>We can see the runtime is reduced by an order of magnitude.</p> <p><strong>Methods for preallocation:</strong></p> <p>MATLAB provides various functions for allocation of vectors and matrices, depending on the specific requirements of the user. These include: <a href="http://www.mathworks.com/help/matlab/ref/zeros.html" target="_blank" rel="noopener noreferrer"><code>zeros</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <a href="http://www.mathworks.com/help/matlab/ref/ones.html" target="_blank" rel="noopener noreferrer"><code>ones</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <a href="http://www.mathworks.com/help/matlab/ref/nan.html" target="_blank" rel="noopener noreferrer"><code>nan</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <a href="http://www.mathworks.com/help/matlab/ref/eye.html" target="_blank" rel="noopener noreferrer"><code>eye</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <a href="http://www.mathworks.com/help/matlab/ref/true.html" target="_blank" rel="noopener noreferrer"><code>true</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> etc.</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>a <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>       <span class="token comment">% Allocates a 3-by-3 matrix initialized to 0</span>
a <span class="token operator">=</span>

     <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">0</span>
     <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">0</span>
     <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">0</span>

a <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>     <span class="token comment">% Allocates a 3-by-2 matrix initialized to 0</span>
a <span class="token operator">=</span>

     <span class="token number">0</span>     <span class="token number">0</span>
     <span class="token number">0</span>     <span class="token number">0</span>
     <span class="token number">0</span>     <span class="token number">0</span>

a <span class="token operator">=</span> <span class="token function">ones</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>      <span class="token comment">% Allocates a 3 dimensional array (2-by-3-by-2) initialized to 1</span>
<span class="token function">a</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span>

     <span class="token number">1</span>     <span class="token number">1</span>     <span class="token number">1</span>
     <span class="token number">1</span>     <span class="token number">1</span>     <span class="token number">1</span>


<span class="token function">a</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span>

     <span class="token number">1</span>     <span class="token number">1</span>     <span class="token number">1</span>
     <span class="token number">1</span>     <span class="token number">1</span>     <span class="token number">1</span>

a <span class="token operator">=</span> <span class="token function">ones</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">7</span>  <span class="token comment">% Allocates a row vector of length 3 initialized to 7</span>
a <span class="token operator">=</span>

     <span class="token number">7</span>     <span class="token number">7</span>     <span class="token number">7</span>

</code></pre></div><p>A data type can also be specified:</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>a <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'uint8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">% allocates an array of type uint8</span>

</code></pre></div><p>It is also easy to clone the size of an existing array:</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>a <span class="token operator">=</span> <span class="token function">ones</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">% a is a 3-by-4 matrix of 1's</span>
b <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">% b is a 3-by-4 matrix of 0's</span>

</code></pre></div><p>And clone the type:</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>a <span class="token operator">=</span> <span class="token function">ones</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">'single'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">% a is a 3-by-4 matrix of type single</span>
b <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'like'</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">% b is a 2-by-2 matrix of type single</span>

</code></pre></div><p>note that 'like' also clones <strong>complexity</strong> and <strong>sparsity</strong>.</p> <p>Preallocation is implicitly achieved using any function that returns an array of the final required size, such as <a href="http://www.mathworks.com/help/matlab/ref/rand.html" target="_blank" rel="noopener noreferrer"><code>rand</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <a href="http://www.mathworks.com/help/matlab/ref/gallery.html" target="_blank" rel="noopener noreferrer"><code>gallery</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <a href="http://www.mathworks.com/help/matlab/ref/kron.html" target="_blank" rel="noopener noreferrer"><code>kron</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <a href="http://www.mathworks.com/help/matlab/ref/bsxfun.html" target="_blank" rel="noopener noreferrer"><code>bsxfun</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <a href="http://www.mathworks.com/help/matlab/ref/colon.html" target="_blank" rel="noopener noreferrer"><code>colon</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and many others. For example, a common way to allocate vectors with linearly varying elements is by using the colon operator (with either the 2- or 3-operand variant<sup><a href="http://www.mathworks.com/help/matlab/ref/colon.html" target="_blank" rel="noopener noreferrer">1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></sup>):</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>a <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span> 
a <span class="token operator">=</span>

     <span class="token number">1</span>     <span class="token number">2</span>     <span class="token number">3</span>

a <span class="token operator">=</span> <span class="token number">2</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">3</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">4</span>
a <span class="token operator">=</span>

     <span class="token number">2</span>    <span class="token operator">-</span><span class="token number">1</span>    <span class="token operator">-</span><span class="token number">4</span>

</code></pre></div><p>Cell arrays can be allocated using the <code>cell()</code> function in much the same way as <code>zeros()</code>.</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>a <span class="token operator">=</span> <span class="token function">cell</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
a <span class="token operator">=</span> 

    <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token punctuation">[</span><span class="token punctuation">]</span>

</code></pre></div><p>Note that cell arrays work by holding pointers to the locations in memory of cell contents. So all preallocation tips apply to the individual cell array elements as well.</p> <p>Further reading:</p> <ul><li><a href="http://www.mathworks.com/help/matlab/math/resizing-and-reshaping-matrices.html#f1-88760" target="_blank" rel="noopener noreferrer">Official MATLAB documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> on &quot;<strong>Preallocating Memory</strong>&quot;.</li> <li><a href="http://www.mathworks.com/help/matlab/matlab_prog/memory-allocation.html" target="_blank" rel="noopener noreferrer">Official MATLAB documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> on &quot;<strong>How MATLAB Allocates Memory</strong>&quot;.</li> <li><a href="http://undocumentedmatlab.com/blog/preallocation-performance" target="_blank" rel="noopener noreferrer">Preallocation performance<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> on <strong><a href="http://undocumentedmatlab.com/" target="_blank" rel="noopener noreferrer">Undocumented matlab<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong>.</li> <li><a href="http://blogs.mathworks.com/loren/2012/11/29/understanding-array-preallocation/" target="_blank" rel="noopener noreferrer">Understanding Array Preallocation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> on <strong><a href="http://blogs.mathworks.com/loren/" target="_blank" rel="noopener noreferrer">Loren on the Art of MATLAB<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong></li></ul> <h2 id="rearrange-a-nd-array-may-improve-the-overall-performance"><a href="#rearrange-a-nd-array-may-improve-the-overall-performance" class="header-anchor">#</a> rearrange a ND-array may improve the overall performance</h2> <p>In some cases we need to apply functions to a set of ND-arrays. Let's look at this simple example.</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code><span class="token function">A</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token number">4</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">A</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">11</span> <span class="token number">22</span><span class="token punctuation">;</span> <span class="token number">44</span> <span class="token number">55</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">B</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">7</span> <span class="token number">8</span><span class="token punctuation">;</span> <span class="token number">1</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">B</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">77</span> <span class="token number">88</span><span class="token punctuation">;</span> <span class="token number">11</span> <span class="token number">22</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

A <span class="token operator">=</span>

<span class="token function">ans</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span>

   <span class="token number">1</span>   <span class="token number">2</span> 
   <span class="token number">4</span>   <span class="token number">5</span> 

<span class="token function">ans</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span>

   <span class="token number">11</span>   <span class="token number">22</span>
   <span class="token number">44</span>   <span class="token number">55</span>

<span class="token operator">&gt;</span><span class="token operator">&gt;</span> B
B <span class="token operator">=</span>

<span class="token function">ans</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span>

   <span class="token number">7</span>   <span class="token number">8</span>
   <span class="token number">1</span>   <span class="token number">2</span>

<span class="token function">ans</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span>

   <span class="token number">77</span>   <span class="token number">88</span>
   <span class="token number">11</span>   <span class="token number">22</span>

</code></pre></div><p>Both matrices are 3D, let's say we have to calculate the following:</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>result<span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">...</span>
<span class="token keyword">for</span> k <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span> 
   <span class="token function">result</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">,</span><span class="token number">j</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">result</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">,</span><span class="token number">j</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">abs</span><span class="token punctuation">(</span> <span class="token function">A</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">,</span><span class="token number">j</span><span class="token punctuation">,</span>k<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">B</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">,</span><span class="token number">j</span><span class="token punctuation">,</span>k<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">...</span>

<span class="token keyword">if</span> k is very large<span class="token punctuation">,</span> this <span class="token keyword">for</span><span class="token operator">-</span>loop can be a bottleneck since MATLAB order the data in a column major fashion<span class="token punctuation">.</span> So a better way to compute &quot;result&quot; could be<span class="token operator">:</span>

<span class="token comment">% trying to exploit the column major ordering</span>
Aprime <span class="token operator">=</span> <span class="token function">reshape</span><span class="token punctuation">(</span><span class="token function">permute</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Bprime <span class="token operator">=</span> <span class="token function">reshape</span><span class="token punctuation">(</span><span class="token function">permute</span><span class="token punctuation">(</span>B<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token operator">&gt;</span><span class="token operator">&gt;</span> Aprime
Aprime <span class="token operator">=</span>

    <span class="token number">1</span>    <span class="token number">4</span>    <span class="token number">2</span>    <span class="token number">5</span>
   <span class="token number">11</span>   <span class="token number">44</span>   <span class="token number">22</span>   <span class="token number">55</span>

<span class="token operator">&gt;</span><span class="token operator">&gt;</span> Bprime
Bprime <span class="token operator">=</span>

    <span class="token number">7</span>    <span class="token number">1</span>    <span class="token number">8</span>    <span class="token number">2</span>
   <span class="token number">77</span>   <span class="token number">11</span>   <span class="token number">88</span>   <span class="token number">22</span>

</code></pre></div><p>Now we replace the above loop for as following:</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>result<span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">...</span><span class="token punctuation">.</span>
temp <span class="token operator">=</span> <span class="token function">abs</span><span class="token punctuation">(</span>Aprime <span class="token operator">-</span> Bprime<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> k <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span>
    <span class="token function">result</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">,</span><span class="token number">j</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">result</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">,</span><span class="token number">j</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">temp</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token number">i</span><span class="token operator">+</span><span class="token number">2</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">j</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">...</span>

</code></pre></div><p>We rearranged the data so we can exploit the cache memory. Permutation and reshape can be costly but when working with big ND-arrays the computational cost related to these operations is much lower than working with not arranged arrays.</p> <h4 id="remarks"><a href="#remarks" class="header-anchor">#</a> Remarks</h4> <ul><li>Profiling code is a way to avoid the dreaded practice of &quot;<a href="https://www.google.com/search?q=premature+optimization" target="_blank" rel="noopener noreferrer">premature optimization<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>&quot;, by focusing the developer on those parts of the code that <strong>actually</strong> justify optimization efforts.</li> <li>MATLAB documentation article titled &quot;<a href="http://www.mathworks.com/help/matlab/matlab_prog/measure-performance-of-your-program.html" target="_blank" rel="noopener noreferrer">Measure Performance of Your Program<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>&quot;.</li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/matlab/performance-and-benchmarking.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      
      <a href="/matlab/debugging.html" class="prev">
        Debugging
      </a></span> <span class="next"><a href="/matlab/multithreading.html">
        Multithreading
      </a>
      
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/1934.d7a6f60c.js" defer></script>
  </body>
</html>
