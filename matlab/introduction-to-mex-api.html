<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MATLAB - Introduction to MEX API</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Check number of inputs/outputs in a C++ MEX-file, Input a string, modify it in C, and output it, Passing a struct by field names, Pass a 3D matrix from MATLAB to C">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="MATLAB - Introduction to MEX API">
    <meta property="og:description" content="Check number of inputs/outputs in a C++ MEX-file, Input a string, modify it in C, and output it, Passing a struct by field names, Pass a 3D matrix from MATLAB to C">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/matlab/introduction-to-mex-api.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="MATLAB - Introduction to MEX API">
    <meta name="twitter:description" content="Check number of inputs/outputs in a C++ MEX-file, Input a string, modify it in C, and output it, Passing a struct by field names, Pass a 3D matrix from MATLAB to C">
    <meta name="twitter:url" content="/matlab/introduction-to-mex-api.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    <link rel="preload" href="/assets/css/0.styles.8b877eb8.css" as="style"><link rel="preload" href="/assets/js/app.ced448ab.js" as="script"><link rel="preload" href="/assets/js/3.f1d73125.js" as="script"><link rel="preload" href="/assets/js/1925.10c476b5.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.8b877eb8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>MATLAB</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/matlab/" class="sidebar-link">Disclaimer</a></li><li><a href="/matlab/getting-started-with-matlab-language.html" class="sidebar-link">Getting started with MATLAB Language</a></li><li><a href="/matlab/initializing-matrices-or-arrays.html" class="sidebar-link">Initializing Matrices or arrays</a></li><li><a href="/matlab/conditions.html" class="sidebar-link">Conditions</a></li><li><a href="/matlab/functions.html" class="sidebar-link">Functions</a></li><li><a href="/matlab/set-operations.html" class="sidebar-link">Set operations</a></li><li><a href="/matlab/documenting-functions.html" class="sidebar-link">Documenting functions</a></li><li><a href="/matlab/using-functions-with-logical-output.html" class="sidebar-link">Using functions with logical output</a></li><li><a href="/matlab/for-loops.html" class="sidebar-link">For loops</a></li><li><a href="/matlab/object-oriented-programming.html" class="sidebar-link">Object-Oriented Programming</a></li><li><a href="/matlab/vectorization.html" class="sidebar-link">Vectorization</a></li><li><a href="/matlab/matrix-decompositions.html" class="sidebar-link">Matrix decompositions</a></li><li><a href="/matlab/graphics-2d-line-plots.html" class="sidebar-link">Graphics: 2D Line Plots</a></li><li><a href="/matlab/graphics-2d-and-3d-transformations.html" class="sidebar-link">Graphics: 2D and 3D Transformations</a></li><li><a href="/matlab/controlling-subplot-coloring-in-matlab.html" class="sidebar-link">Controlling Subplot coloring in Matlab</a></li><li><a href="/matlab/image-processing.html" class="sidebar-link">Image processing</a></li><li><a href="/matlab/drawing.html" class="sidebar-link">Drawing</a></li><li><a href="/matlab/financial-applications.html" class="sidebar-link">Financial Applications</a></li><li><a href="/matlab/fourier-transforms-and-inverse-fourier-transforms.html" class="sidebar-link">Fourier Transforms and Inverse Fourier Transforms</a></li><li><a href="/matlab/ordinary-differential-equations-ode-solvers.html" class="sidebar-link">Ordinary Differential Equations (ODE) Solvers</a></li><li><a href="/matlab/interpolation-with-matlab.html" class="sidebar-link">Interpolation with MATLAB</a></li><li><a href="/matlab/integration.html" class="sidebar-link">Integration</a></li><li><a href="/matlab/reading-large-files.html" class="sidebar-link">Reading large files</a></li><li><a href="/matlab/usage-of-accumarray-function.html" class="sidebar-link">Usage of accumarray() Function</a></li><li><a href="/matlab/introduction-to-mex-api.html" class="active sidebar-link">Introduction to MEX API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/matlab/introduction-to-mex-api.html#check-number-of-inputs-outputs-in-a-c-mex-file" class="sidebar-link">Check number of inputs/outputs in a C++ MEX-file</a></li><li class="sidebar-sub-header"><a href="/matlab/introduction-to-mex-api.html#input-a-string-modify-it-in-c-and-output-it" class="sidebar-link">Input a string, modify it in C, and output it</a></li><li class="sidebar-sub-header"><a href="/matlab/introduction-to-mex-api.html#passing-a-struct-by-field-names" class="sidebar-link">Passing a struct by field names</a></li><li class="sidebar-sub-header"><a href="/matlab/introduction-to-mex-api.html#pass-a-3d-matrix-from-matlab-to-c" class="sidebar-link">Pass a 3D matrix from MATLAB to C</a></li></ul></li><li><a href="/matlab/debugging.html" class="sidebar-link">Debugging</a></li><li><a href="/matlab/performance-and-benchmarking.html" class="sidebar-link">Performance and Benchmarking</a></li><li><a href="/matlab/multithreading.html" class="sidebar-link">Multithreading</a></li><li><a href="/matlab/using-serial-ports.html" class="sidebar-link">Using serial ports</a></li><li><a href="/matlab/undocumented-features.html" class="sidebar-link">Undocumented Features</a></li><li><a href="/matlab/matlab-best-practices.html" class="sidebar-link">MATLAB Best Practices</a></li><li><a href="/matlab/matlab-user-interfaces.html" class="sidebar-link">MATLAB User Interfaces</a></li><li><a href="/matlab/useful-tricks.html" class="sidebar-link">Useful tricks</a></li><li><a href="/matlab/common-mistakes-and-errors.html" class="sidebar-link">Common mistakes and errors</a></li><li><a href="/matlab/programming-utilities.html" class="sidebar-link">Programming Utilities</a></li><li><a href="/matlab/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="introduction-to-mex-api"><a href="#introduction-to-mex-api" class="header-anchor">#</a> Introduction to MEX API</h1> <h2 id="check-number-of-inputs-outputs-in-a-c-mex-file"><a href="#check-number-of-inputs-outputs-in-a-c-mex-file" class="header-anchor">#</a> Check number of inputs/outputs in a C++ MEX-file</h2> <p>In this example we will write a basic program that checks the number of inputs and outputs passed to a MEX-function.</p> <p>As a starting point, we need to create a C++ file implementing the &quot;MEX gateway&quot;. This is the function executed when the file is called from MATLAB.</p> <h3 id="testinputs-cpp"><a href="#testinputs-cpp" class="header-anchor">#</a> testinputs.cpp</h3> <div class="language-matlab extra-class"><pre class="language-matlab"><code><span class="token operator">/</span><span class="token operator">/</span> MathWorks provided header file
#include &quot;mex<span class="token punctuation">.</span>h&quot;

<span class="token operator">/</span><span class="token operator">/</span> gateway <span class="token keyword">function</span>
void <span class="token function">mexFunction</span><span class="token punctuation">(</span>int nlhs<span class="token punctuation">,</span> mxArray <span class="token operator">*</span>plhs<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> int nrhs<span class="token punctuation">,</span> const mxArray <span class="token operator">*</span>prhs<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token operator">/</span><span class="token operator">/</span> This <span class="token keyword">function</span> will error <span class="token keyword">if</span> number of inputs its not <span class="token number">3</span> or <span class="token number">4</span>
    <span class="token operator">/</span><span class="token operator">/</span> This <span class="token keyword">function</span> will error <span class="token keyword">if</span> number of outputs is more than <span class="token number">1</span>

    <span class="token operator">/</span><span class="token operator">/</span> Check inputs<span class="token operator">:</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>nrhs <span class="token operator">&lt;</span> <span class="token number">3</span> <span class="token operator">||</span> nrhs <span class="token operator">&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">mexErrMsgIdAndTxt</span><span class="token punctuation">(</span>&quot;Testinputs<span class="token operator">:</span>ErrorIdIn&quot;<span class="token punctuation">,</span>
            &quot;Invalid number of inputs to MEX file<span class="token punctuation">.</span>&quot;<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token operator">/</span><span class="token operator">/</span> Check outputs<span class="token operator">:</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>nlhs <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">mexErrMsgIdAndTxt</span><span class="token punctuation">(</span>&quot;Testinputs<span class="token operator">:</span>ErrorIdOut&quot;<span class="token punctuation">,</span>
                &quot;Invalid number of outputs to MEX file<span class="token punctuation">.</span>&quot;<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>First, we include the <code>mex.h</code> header which contains definitions of all the required functions and data types to work with the MEX API. Then we implement the function <code>mexFunction</code> as shown, where its signature must not change, independent of the inputs/outputs actually used. The function parameters are as follows:</p> <ul><li><code>nlhs</code>: Number of outputs requested.</li> <li><code>*plhs[]</code>: Array containing all the outputs in MEX API format.</li> <li><code>nrhs</code>: Number of inputs passed.</li> <li><code>*prhs[]</code>: Array containing all the inputs in MEX API format.</li></ul> <p>Next, we check the number of inputs/outputs arguments, and if the validation fails, an error is thrown using <code>mexErrMsgIdAndTxt</code> function (it expects <code>somename:iD</code> format identifier, a simple &quot;ID&quot; won't work).</p> <p>Once the file is compiled as <code>mex testinputs.cpp</code>, the function can be called in MATLAB as:</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code><span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token function">testinputs</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
Error using testinputs<span class="token punctuation">.</span> Invalid number of inputs to MEX file<span class="token punctuation">.</span>

<span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token function">testinputs</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>

<span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token operator">~</span><span class="token punctuation">,</span><span class="token operator">~</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">testinputs</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
Error using testinputs<span class="token punctuation">.</span> Invalid number of outputs to MEX file<span class="token punctuation">.</span>

</code></pre></div><h2 id="input-a-string-modify-it-in-c-and-output-it"><a href="#input-a-string-modify-it-in-c-and-output-it" class="header-anchor">#</a> Input a string, modify it in C, and output it</h2> <p>In this example, we illustrate string manipulation in MATLAB MEX. We will create a MEX-function that accepts a string as input from MATLAB, copy the data into C-string, modify it and convert it back to <code>mxArray</code> returned to the MATLAB side.</p> <p>The main objective of this example is to show how strings can be converted to C/C++ from MATLAB and vice versa.</p> <h3 id="stringio-cpp"><a href="#stringio-cpp" class="header-anchor">#</a> stringIO.cpp</h3> <div class="language-matlab extra-class"><pre class="language-matlab"><code>#include &quot;mex<span class="token punctuation">.</span>h&quot;
#include <span class="token operator">&lt;</span>cstring<span class="token operator">&gt;</span>

void <span class="token function">mexFunction</span><span class="token punctuation">(</span>int nlhs<span class="token punctuation">,</span> mxArray <span class="token operator">*</span>plhs<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> int nrhs<span class="token punctuation">,</span> const mxArray <span class="token operator">*</span>prhs<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token operator">/</span><span class="token operator">/</span> check number of arguments
    <span class="token keyword">if</span> <span class="token punctuation">(</span>nrhs <span class="token punctuation">!</span><span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">||</span> nlhs <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">mexErrMsgIdAndTxt</span><span class="token punctuation">(</span>&quot;StringIO<span class="token operator">:</span>WrongNumArgs&quot;<span class="token punctuation">,</span> &quot;Wrong number of arguments<span class="token punctuation">.</span>&quot;<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token operator">/</span><span class="token operator">/</span> check <span class="token keyword">if</span> input is a string
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">mxIsChar</span><span class="token punctuation">(</span>prhs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">mexErrMsgIdAndTxt</span><span class="token punctuation">(</span>&quot;StringIO<span class="token operator">:</span>TypeError&quot;<span class="token punctuation">,</span> &quot;Input is not a string&quot;<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token operator">/</span><span class="token operator">/</span> copy characters data from mxArray to a C<span class="token operator">-</span>style <span class="token function">string</span> <span class="token punctuation">(</span>null<span class="token operator">-</span>terminated<span class="token punctuation">)</span>
    char <span class="token operator">*</span>str <span class="token operator">=</span> <span class="token function">mxArrayToString</span><span class="token punctuation">(</span>prhs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token operator">/</span><span class="token operator">/</span> manipulate the string in some way
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span>&quot;theOneString&quot;<span class="token punctuation">,</span> str<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'T'</span><span class="token punctuation">;</span>  <span class="token operator">/</span><span class="token operator">/</span> capitalize first letter
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">' '</span><span class="token punctuation">;</span>  <span class="token operator">/</span><span class="token operator">/</span> do something <span class="token keyword">else</span>?
    <span class="token punctuation">}</span>

    <span class="token operator">/</span><span class="token operator">/</span> <span class="token keyword">return</span> the new modified string
    plhs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">mxCreateString</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token operator">/</span><span class="token operator">/</span> free allocated memory
    <span class="token function">mxFree</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>The relevant functions in this example are:</p> <ul><li><code>mxIsChar</code> to test if an <code>mxArray</code> is of <code>mxCHAR</code> type.</li> <li><code>mxArrayToString</code> to copy the data of a <code>mxArray</code> string to a <code>char *</code> buffer.</li> <li><code>mxCreateString</code> to create an <code>mxArray</code> string from a <code>char*</code>.</li></ul> <p>As a side note, if you only want to read the string, and not modify it, remember to declare it as <code>const char*</code> for speed and robustness.</p> <p>Finally, once compiled we can call it from MATLAB as:</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code><span class="token operator">&gt;</span><span class="token operator">&gt;</span> mex stringIO<span class="token punctuation">.</span>cpp

<span class="token operator">&gt;</span><span class="token operator">&gt;</span> strOut <span class="token operator">=</span> <span class="token function">stringIO</span><span class="token punctuation">(</span><span class="token string">'theOneString'</span><span class="token punctuation">)</span>
strOut <span class="token operator">=</span> 
TheOneString

<span class="token operator">&gt;</span><span class="token operator">&gt;</span> strOut <span class="token operator">=</span> <span class="token function">stringIO</span><span class="token punctuation">(</span><span class="token string">'somethingelse'</span><span class="token punctuation">)</span>
strOut<span class="token operator">=</span>
omethingelse

</code></pre></div><h2 id="passing-a-struct-by-field-names"><a href="#passing-a-struct-by-field-names" class="header-anchor">#</a> Passing a struct by field names</h2> <p>This example illustrates how to read various-type struct entries from MATLAB, and pass it to C equivalent type variables.</p> <p>While it is possible and easy to figure out from the example how to load fields by numbers, it is here achieved via comparing the field names to strings. Thus the struct fields can be addressed by their field names and variables in it can be read by C.</p> <h3 id="structin-c"><a href="#structin-c" class="header-anchor">#</a> structIn.c</h3> <div class="language-matlab extra-class"><pre class="language-matlab"><code>#include &quot;mex<span class="token punctuation">.</span>h&quot;
#include <span class="token operator">&lt;</span>string<span class="token punctuation">.</span>h<span class="token operator">&gt;</span> <span class="token operator">/</span><span class="token operator">/</span> strcmp


void <span class="token function">mexFunction</span> <span class="token punctuation">(</span>int nlhs<span class="token punctuation">,</span> mxArray <span class="token operator">*</span>plhs<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                  int nrhs<span class="token punctuation">,</span> const mxArray <span class="token operator">*</span>prhs<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token operator">/</span><span class="token operator">/</span> helpers
  double<span class="token operator">*</span> double_ptr<span class="token punctuation">;</span>
  unsigned int <span class="token number">i</span><span class="token punctuation">;</span> <span class="token operator">/</span><span class="token operator">/</span> loop variable
  
  <span class="token operator">/</span><span class="token operator">/</span> to be read variables
  bool optimal<span class="token punctuation">;</span>
  int randomseed<span class="token punctuation">;</span>
  unsigned int desiredNodes<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">!</span><span class="token function">mxIsStruct</span><span class="token punctuation">(</span>prhs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">mexErrMsgTxt</span><span class="token punctuation">(</span>&quot;First argument has to be a parameter struct<span class="token punctuation">!</span>&quot;<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token number">i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token number">i</span><span class="token operator">&lt;</span><span class="token function">mxGetNumberOfFields</span><span class="token punctuation">(</span>prhs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">i</span><span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">==</span><span class="token function">strcmp</span><span class="token punctuation">(</span><span class="token function">mxGetFieldNameByNumber</span><span class="token punctuation">(</span>prhs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">i</span><span class="token punctuation">)</span><span class="token punctuation">,</span>&quot;randomseed&quot;<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      mxArray <span class="token operator">*</span>p <span class="token operator">=</span> <span class="token function">mxGetFieldByNumber</span><span class="token punctuation">(</span>prhs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">i</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      randomseed <span class="token operator">=</span> <span class="token operator">*</span><span class="token function">mxGetPr</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">==</span><span class="token function">strcmp</span><span class="token punctuation">(</span><span class="token function">mxGetFieldNameByNumber</span><span class="token punctuation">(</span>prhs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">i</span><span class="token punctuation">)</span><span class="token punctuation">,</span>&quot;optimal&quot;<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      mxArray <span class="token operator">*</span>p <span class="token operator">=</span> <span class="token function">mxGetFieldByNumber</span><span class="token punctuation">(</span>prhs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">i</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      optimal <span class="token operator">=</span> <span class="token punctuation">(</span>bool<span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">mxGetPr</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">==</span><span class="token function">strcmp</span><span class="token punctuation">(</span><span class="token function">mxGetFieldNameByNumber</span><span class="token punctuation">(</span>prhs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">i</span><span class="token punctuation">)</span><span class="token punctuation">,</span>&quot;numNodes&quot;<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      mxArray <span class="token operator">*</span>p <span class="token operator">=</span> <span class="token function">mxGetFieldByNumber</span><span class="token punctuation">(</span>prhs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">i</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      desiredNodes <span class="token operator">=</span> <span class="token operator">*</span><span class="token function">mxGetPr</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>The loop over <code>i</code> runs over every field in the given struct, while the <code>if(0==strcmp)</code>-parts compare the matlab field's name to the given string. If it is a match, the corresponding value is extracted to a C variable.</p> <h2 id="pass-a-3d-matrix-from-matlab-to-c"><a href="#pass-a-3d-matrix-from-matlab-to-c" class="header-anchor">#</a> Pass a 3D matrix from MATLAB to C</h2> <p>In this example we illustrate how to take a double real-type 3D matrix from MATLAB, and pass it to a C <code>double*</code> array.</p> <p>The main objectives of this example are showing how to obtain data from MATLAB MEX arrays and to highlight some small details in matrix storage and handling.</p> <h3 id="matrixin-cpp"><a href="#matrixin-cpp" class="header-anchor">#</a> matrixIn.cpp</h3> <div class="language-matlab extra-class"><pre class="language-matlab"><code>#include &quot;mex<span class="token punctuation">.</span>h&quot;

void <span class="token function">mexFunction</span><span class="token punctuation">(</span>int  nlhs <span class="token punctuation">,</span> mxArray <span class="token operator">*</span>plhs<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        int nrhs<span class="token punctuation">,</span> mxArray const <span class="token operator">*</span>prhs<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token operator">/</span><span class="token operator">/</span> check amount of inputs
   <span class="token keyword">if</span> <span class="token punctuation">(</span>nrhs<span class="token punctuation">!</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">mexErrMsgIdAndTxt</span><span class="token punctuation">(</span>&quot;matrixIn<span class="token operator">:</span>InvalidInput&quot;<span class="token punctuation">,</span> &quot;Invalid number of inputs to MEX file<span class="token punctuation">.</span>&quot;<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
   
   <span class="token operator">/</span><span class="token operator">/</span> check type of input
   <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token punctuation">!</span><span class="token function">mxIsDouble</span><span class="token punctuation">(</span>prhs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">mxIsComplex</span><span class="token punctuation">(</span>prhs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">mexErrMsgIdAndTxt</span><span class="token punctuation">(</span>&quot;matrixIn<span class="token operator">:</span>InvalidType&quot;<span class="token punctuation">,</span>  &quot;Input matrix must be a double<span class="token punctuation">,</span> non<span class="token operator">-</span>complex array<span class="token punctuation">.</span>&quot;<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   
   <span class="token operator">/</span><span class="token operator">/</span> extract the data
   double const <span class="token operator">*</span> const matrixAux<span class="token operator">=</span> static_cast<span class="token operator">&lt;</span>double const <span class="token operator">*</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token function">mxGetData</span><span class="token punctuation">(</span>prhs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token operator">/</span><span class="token operator">/</span> Get matrix size
   const mwSize <span class="token operator">*</span>sizeInputMatrix<span class="token operator">=</span> <span class="token function">mxGetDimensions</span><span class="token punctuation">(</span>prhs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token operator">/</span><span class="token operator">/</span> allocate array in C<span class="token punctuation">.</span> Note<span class="token operator">:</span> its <span class="token number">1</span>D array<span class="token punctuation">,</span> not <span class="token number">3</span>D even <span class="token keyword">if</span> our input is <span class="token number">3</span>D
   double<span class="token operator">*</span>  matrixInC<span class="token operator">=</span> <span class="token punctuation">(</span>double<span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>sizeInputMatrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span>sizeInputMatrix<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span>sizeInputMatrix<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">*</span> <span class="token function">sizeof</span><span class="token punctuation">(</span>double<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  
   <span class="token operator">/</span><span class="token operator">/</span> MATLAB is column major<span class="token punctuation">,</span> not row <span class="token function">major</span> <span class="token punctuation">(</span>as C<span class="token punctuation">)</span><span class="token punctuation">.</span> We need to reorder the numbers
   <span class="token operator">/</span><span class="token operator">/</span> Basically permutes dimensions   

   <span class="token operator">/</span><span class="token operator">/</span> NOTE<span class="token operator">:</span> the ordering of the loops is optimized <span class="token keyword">for</span> fastest memory access<span class="token punctuation">!</span> 
   <span class="token operator">/</span><span class="token operator">/</span> This improves the speed in about <span class="token number">300</span><span class="token comment">% </span>

    const int size0 <span class="token operator">=</span> sizeInputMatrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">/</span><span class="token operator">/</span> Const makes compiler optimization kick in
    const int size1 <span class="token operator">=</span> sizeInputMatrix<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    const int size2 <span class="token operator">=</span> sizeInputMatrix<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    
    <span class="token keyword">for</span> <span class="token punctuation">(</span>int <span class="token number">j</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token number">j</span> <span class="token operator">&lt;</span> size2<span class="token punctuation">;</span> <span class="token number">j</span><span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        int jOffset <span class="token operator">=</span> <span class="token number">j</span><span class="token operator">*</span>size0<span class="token operator">*</span>size1<span class="token punctuation">;</span> <span class="token operator">/</span><span class="token operator">/</span> this saves re<span class="token operator">-</span>computation time
        <span class="token keyword">for</span> <span class="token punctuation">(</span>int k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> size0<span class="token punctuation">;</span> k<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            int kOffset <span class="token operator">=</span> k<span class="token operator">*</span>size1<span class="token punctuation">;</span> <span class="token operator">/</span><span class="token operator">/</span> this saves re<span class="token operator">-</span>computation time
            <span class="token keyword">for</span> <span class="token punctuation">(</span>int <span class="token number">i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token number">i</span> <span class="token operator">&lt;</span> size1<span class="token punctuation">;</span> <span class="token number">i</span><span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                int iOffset <span class="token operator">=</span> <span class="token number">i</span><span class="token operator">*</span>size0<span class="token punctuation">;</span> 
                matrixInC<span class="token punctuation">[</span><span class="token number">i</span> <span class="token operator">+</span> jOffset <span class="token operator">+</span> kOffset<span class="token punctuation">]</span> <span class="token operator">=</span> matrixAux<span class="token punctuation">[</span>iOffset <span class="token operator">+</span> jOffset <span class="token operator">+</span> k<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token operator">/</span><span class="token operator">/</span> we are done<span class="token punctuation">!</span>

    <span class="token operator">/</span><span class="token operator">/</span> Use your C matrix here

    <span class="token operator">/</span><span class="token operator">/</span> free memory
    <span class="token function">free</span><span class="token punctuation">(</span>matrixInC<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>The relevant concepts to be aware of:</p> <li>
MATLAB matrices are all 1D in memory, no matter how many dimensions they have when used in MATLAB. This is also true for most (if not all) main matrix representation in C/C++ libraries, as allows optimization and faster execution.
</li> <li>
You need to explicitly copy matrices from MATLAB to C in a loop.
</li> <li>
MATLAB matrices are stored in column major order, as in Fortran, but C/C++ and most modern languages are row major. It is important to permute the input matrix , or else the data will look completely different.
</li> <p>The relevant function in this example are:</p> <ul><li><code>mxIsDouble</code> checks if input is <code>double</code> type.</li> <li><code>mxIsComplex</code> checks if input is real or imaginary.</li> <li><code>mxGetData</code> returns a pointer to the real data in the input array. <code>NULL</code> if there is no real data.</li> <li><code>mxGetDimensions</code> returns an pointer to a <code>mwSize</code> array, with the size of the dimension in each index.</li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/matlab/introduction-to-mex-api.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/matlab/usage-of-accumarray-function.html" class="prev">
        Usage of accumarray() Function
      </a></span> <span class="next"><a href="/matlab/debugging.html">
        Debugging
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.ced448ab.js" defer></script><script src="/assets/js/3.f1d73125.js" defer></script><script src="/assets/js/1925.10c476b5.js" defer></script>
  </body>
</html>
