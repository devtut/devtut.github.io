<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MATLAB - Vectorization</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Use of bsxfun, Implicit array expansion (broadcasting) [R2016b], Element-wise operations, Logical Masking, Sum, mean, prod & co, Get the  value of a function  of two or more arguments">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="MATLAB - Vectorization">
    <meta property="og:description" content="Use of bsxfun, Implicit array expansion (broadcasting) [R2016b], Element-wise operations, Logical Masking, Sum, mean, prod & co, Get the  value of a function  of two or more arguments">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/matlab/vectorization.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="MATLAB - Vectorization">
    <meta name="twitter:description" content="Use of bsxfun, Implicit array expansion (broadcasting) [R2016b], Element-wise operations, Logical Masking, Sum, mean, prod & co, Get the  value of a function  of two or more arguments">
    <meta name="twitter:url" content="/matlab/vectorization.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/1943.f1d8c2b4.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>MATLAB</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/matlab/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/matlab/getting-started-with-matlab-language.html" class="sidebar-link">Getting started with MATLAB Language</a></li><li><a href="/matlab/initializing-matrices-or-arrays.html" class="sidebar-link">Initializing Matrices or arrays</a></li><li><a href="/matlab/conditions.html" class="sidebar-link">Conditions</a></li><li><a href="/matlab/functions.html" class="sidebar-link">Functions</a></li><li><a href="/matlab/set-operations.html" class="sidebar-link">Set operations</a></li><li><a href="/matlab/documenting-functions.html" class="sidebar-link">Documenting functions</a></li><li><a href="/matlab/using-functions-with-logical-output.html" class="sidebar-link">Using functions with logical output</a></li><li><a href="/matlab/for-loops.html" class="sidebar-link">For loops</a></li><li><a href="/matlab/object-oriented-programming.html" class="sidebar-link">Object-Oriented Programming</a></li><li><a href="/matlab/vectorization.html" aria-current="page" class="active sidebar-link">Vectorization</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/matlab/vectorization.html#use-of-bsxfun" class="sidebar-link">Use of bsxfun</a></li><li class="sidebar-sub-header"><a href="/matlab/vectorization.html#implicit-array-expansion-broadcasting-r2016b" class="sidebar-link">Implicit array expansion (broadcasting) [R2016b]</a></li><li class="sidebar-sub-header"><a href="/matlab/vectorization.html#element-wise-operations" class="sidebar-link">Element-wise operations</a></li><li class="sidebar-sub-header"><a href="/matlab/vectorization.html#logical-masking" class="sidebar-link">Logical Masking</a></li><li class="sidebar-sub-header"><a href="/matlab/vectorization.html#sum-mean-prod-co" class="sidebar-link">Sum, mean, prod &amp; co</a></li><li class="sidebar-sub-header"><a href="/matlab/vectorization.html#get-the-value-of-a-function-of-two-or-more-arguments" class="sidebar-link">Get the  value of a function  of two or more arguments</a></li></ul></li><li><a href="/matlab/matrix-decompositions.html" class="sidebar-link">Matrix decompositions</a></li><li><a href="/matlab/graphics-2d-line-plots.html" class="sidebar-link">Graphics: 2D Line Plots</a></li><li><a href="/matlab/graphics-2d-and-3d-transformations.html" class="sidebar-link">Graphics: 2D and 3D Transformations</a></li><li><a href="/matlab/controlling-subplot-coloring-in-matlab.html" class="sidebar-link">Controlling Subplot coloring in Matlab</a></li><li><a href="/matlab/image-processing.html" class="sidebar-link">Image processing</a></li><li><a href="/matlab/drawing.html" class="sidebar-link">Drawing</a></li><li><a href="/matlab/financial-applications.html" class="sidebar-link">Financial Applications</a></li><li><a href="/matlab/fourier-transforms-and-inverse-fourier-transforms.html" class="sidebar-link">Fourier Transforms and Inverse Fourier Transforms</a></li><li><a href="/matlab/ordinary-differential-equations-ode-solvers.html" class="sidebar-link">Ordinary Differential Equations (ODE) Solvers</a></li><li><a href="/matlab/interpolation-with-matlab.html" class="sidebar-link">Interpolation with MATLAB</a></li><li><a href="/matlab/integration.html" class="sidebar-link">Integration</a></li><li><a href="/matlab/reading-large-files.html" class="sidebar-link">Reading large files</a></li><li><a href="/matlab/usage-of-accumarray-function.html" class="sidebar-link">Usage of accumarray() Function</a></li><li><a href="/matlab/introduction-to-mex-api.html" class="sidebar-link">Introduction to MEX API</a></li><li><a href="/matlab/debugging.html" class="sidebar-link">Debugging</a></li><li><a href="/matlab/performance-and-benchmarking.html" class="sidebar-link">Performance and Benchmarking</a></li><li><a href="/matlab/multithreading.html" class="sidebar-link">Multithreading</a></li><li><a href="/matlab/using-serial-ports.html" class="sidebar-link">Using serial ports</a></li><li><a href="/matlab/undocumented-features.html" class="sidebar-link">Undocumented Features</a></li><li><a href="/matlab/matlab-best-practices.html" class="sidebar-link">MATLAB Best Practices</a></li><li><a href="/matlab/matlab-user-interfaces.html" class="sidebar-link">MATLAB User Interfaces</a></li><li><a href="/matlab/useful-tricks.html" class="sidebar-link">Useful tricks</a></li><li><a href="/matlab/common-mistakes-and-errors.html" class="sidebar-link">Common mistakes and errors</a></li><li><a href="/matlab/programming-utilities.html" class="sidebar-link">Programming Utilities</a></li><li><a href="/matlab/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vectorization"><a href="#vectorization" class="header-anchor">#</a> Vectorization</h1> <h2 id="use-of-bsxfun"><a href="#use-of-bsxfun" class="header-anchor">#</a> Use of bsxfun</h2> <p>Quite often, the reason why code has been written in a <code>for</code> loop is to compute values from 'nearby' ones. The function <code>bsxfun</code> can often be used to do this in a more succinct fashion.</p> <p>For example, assume that you wish to perform a columnwise operation on the matrix <code>B</code>, subtracting the mean of each column from it:</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>B <span class="token operator">=</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token function">randn</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment">% Generate random data </span>
A <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                      <span class="token comment">% Preallocate array</span>
<span class="token keyword">for</span> col <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token function">size</span><span class="token punctuation">(</span>B<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">% Loop over columns</span>
    <span class="token function">A</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span>col<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">B</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span>col<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">mean</span><span class="token punctuation">(</span><span class="token function">B</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span>col<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">% Subtract means </span>
<span class="token keyword">end</span> 

</code></pre></div><p>This method is inefficient if <code>B</code> is large, often due to MATLAB having to move the contents of variables around in memory. By using <code>bsxfun</code>, one can do the same job neatly and easily in just a single line:</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>A <span class="token operator">=</span> <span class="token function">bsxfun</span><span class="token punctuation">(</span><span class="token operator">@</span>minus<span class="token punctuation">,</span> B<span class="token punctuation">,</span> <span class="token function">mean</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>Here, <code>@minus</code> is a <a href="http://ch.mathworks.com/help/matlab/matlab_prog/creating-a-function-handle.html" target="_blank" rel="noopener noreferrer">function handle<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to the <a href="http://ch.mathworks.com/help/matlab/ref/minus.html" target="_blank" rel="noopener noreferrer"><code>minus</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> operator (<code>-</code>) and will be applied between elements of the two matrices <code>B</code> and <code>mean(B)</code>. Other function handles, even user-defined ones, are possible as well.</p> <p>Next, suppose you want to add row vector <code>v</code> to each row in matrix <code>A</code>:</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>v <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

A <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">6</span>
     <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token number">7</span>
     <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

</code></pre></div><p>The naive approach is use a loop (<strong>do <strong>not</strong> do this</strong>):</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>B <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> row <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span>
    <span class="token function">B</span><span class="token punctuation">(</span>row<span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">A</span><span class="token punctuation">(</span>row<span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span> <span class="token operator">+</span> v<span class="token punctuation">;</span>
<span class="token keyword">end</span>

</code></pre></div><p>Another option would be to replicate <code>v</code> with <code>repmat</code> (<strong>do <strong>not</strong> do this either</strong>):</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code><span class="token operator">&gt;</span><span class="token operator">&gt;</span> v <span class="token operator">=</span> <span class="token function">repmat</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
v <span class="token operator">=</span>
     <span class="token number">1</span>     <span class="token number">2</span>     <span class="token number">3</span>
     <span class="token number">1</span>     <span class="token number">2</span>     <span class="token number">3</span>
     <span class="token number">1</span>     <span class="token number">2</span>     <span class="token number">3</span>

<span class="token operator">&gt;</span><span class="token operator">&gt;</span> B <span class="token operator">=</span> A <span class="token operator">+</span> v<span class="token punctuation">;</span> 

</code></pre></div><p>Instead use <a href="http://uk.mathworks.com/help/matlab/ref/bsxfun.html" target="_blank" rel="noopener noreferrer"><code>bsxfun</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for this task:</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code><span class="token operator">&gt;</span><span class="token operator">&gt;</span> B <span class="token operator">=</span> <span class="token function">bsxfun</span><span class="token punctuation">(</span><span class="token operator">@</span>plus<span class="token punctuation">,</span> A<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
B <span class="token operator">=</span>
     <span class="token number">9</span>     <span class="token number">3</span>     <span class="token number">9</span>
     <span class="token number">4</span>     <span class="token number">7</span>    <span class="token number">10</span>
     <span class="token number">5</span>    <span class="token number">11</span>     <span class="token number">5</span>

</code></pre></div><h3 id="syntax"><a href="#syntax" class="header-anchor">#</a> Syntax</h3> <p><code>bsxfun(@fun, A, B)</code></p> <p>where <code>@fun</code> is one of the <a href="http://uk.mathworks.com/help/matlab/ref/bsxfun.html" target="_blank" rel="noopener noreferrer">supported functions<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and the two arrays <code>A</code> and <code>B</code> respect the two conditions below.</p> <p>The name <code>bsxfun</code> helps to understand how the function works and it stands for <strong>B</strong>inary <strong>FUN</strong>ction with <strong>S</strong>ingleton e<strong>X</strong>pansion. In other words, if:</p> <ol><li>two arrays share the same dimensions except for one</li> <li>and the discordant dimension is a singleton (i.e. has a size of <code>1</code>) in either of the two arrays</li></ol> <p>then the array with the singleton dimension will be expanded to match the dimension of the other array. After the expansion, a binary function is applied elementwise on the two arrays.</p> <p>For example, let <code>A</code> be an <code>M</code>-by-<code>N</code>-by<code>K</code> array and <code>B</code> is an <code>M</code>-by-<code>N</code> array. Firstly, their first two dimensions have corresponding sizes. Secondly, <code>A</code> has <code>K</code> layers while <code>B</code> has implicitly only <code>1</code>, hence it is a singleton. All <strong>conditions</strong> are met and <code>B</code> will be replicated to match the 3rd dimension of <code>A</code>.</p> <p>In other languages, this is commonly referred to as <strong>broadcasting</strong> and happens automatically in Python (numpy) and Octave.</p> <p>The function, <code>@fun</code>, must be a binary function meaning it must take exactly two inputs.</p> <h3 id="remarks"><a href="#remarks" class="header-anchor">#</a> Remarks</h3> <p>Internally, <code>bsxfun</code> does not replicate the array and executes an efficient loop.</p> <h2 id="implicit-array-expansion-broadcasting-r2016b"><a href="#implicit-array-expansion-broadcasting-r2016b" class="header-anchor">#</a> Implicit array expansion (broadcasting) [R2016b]</h2> <p><strong>MATLAB R2016b</strong> featured a generalization of its scalar expansion<sup><a href="https://www.mathworks.com/help/stateflow/ug/scalar-expansion-for-converting-scalars-to-nonscalars.html" target="_blank" rel="noopener noreferrer">1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>,<a href="http://blogs.mathworks.com/loren/2006/02/22/scalar-expansion-and-more-take-2/" target="_blank" rel="noopener noreferrer">2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></sup> mechanism, to also support certain element-wise operations between <strong>arrays</strong> of different sizes, as long as their dimension are compatible.
The operators that support implicit expansion are<a href="https://www.mathworks.com/help/matlab/release-notes.html?startrelease=R2016b&amp;endrelease=R2016b" target="_blank" rel="noopener noreferrer"><sup>1</sup><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>:</p> <ul><li><strong>Element-wise arithmetic operators:</strong> <code>+</code>, <code>-</code>, <code>.*</code>, <code>.^</code>, <code>./</code>, <code>.\</code>.</li> <li><strong>Relational operators:</strong> <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>==</code>, <code>~=</code>.</li> <li><strong>Logical operators:</strong> <code>&amp;</code>, <code>|</code>, <code>xor</code>.</li> <li><strong>Bit-wise functions:</strong> <code>bitand</code>, <code>bitor</code>, <code>bitxor</code>.</li> <li><strong>Elementary math functions:</strong> <code>max</code>, <code>min</code>, <code>mod</code>, <code>rem</code>, <code>hypot</code>, <code>atan2</code>, <code>atan2d</code>.</li></ul> <p>The aforementioned binary operations are allowed between arrays, as long as they have &quot;compatible sizes&quot;. Sizes are considered &quot;compatible&quot; when each dimension in one array is either exactly equal to the same dimension in the other array, or is equal to <code>1</code>. Note that trailing singleton (that is, of size <code>1</code>) dimensions are omitted by MATLAB, even though there's theoretically an infinite amount of them. In other words - dimensions that appear in one array and do not appear in the other, are implicitly fit for automatic expansion.</p> <p>For example, in MATLAB versions <strong>before R2016b</strong> this would happen:</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code><span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token function">magic</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span>
Error using  <span class="token operator">+</span> 
Matrix dimensions must agree<span class="token punctuation">.</span>

</code></pre></div><p>Whereas <strong>starting from R2016b</strong> the previous operation will succeed:</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code><span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token function">magic</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span>
ans <span class="token operator">=</span>

     <span class="token number">9</span>     <span class="token number">3</span>     <span class="token number">9</span>
     <span class="token number">4</span>     <span class="token number">7</span>    <span class="token number">10</span>
     <span class="token number">5</span>    <span class="token number">11</span>     <span class="token number">5</span>

</code></pre></div><h3 id="examples-of-compatible-sizes"><a href="#examples-of-compatible-sizes" class="header-anchor">#</a> Examples of compatible sizes:</h3> <table><thead><tr><th>Description</th> <th>1<sup>st</sup> Array Size</th> <th>2<sup>nd</sup> Array Size</th> <th>Result Size</th></tr></thead> <tbody><tr><td>Vector and scalar</td> <td><code>[3x1]</code></td> <td><code>[1x1]</code></td> <td><code>[3x1]</code></td></tr> <tr><td>Row and column vectors</td> <td><code>[1x3]</code></td> <td><code>[2x1]</code></td> <td><code>[2x3]</code></td></tr> <tr><td>Vector and 2D matrix</td> <td><code>[1x3]</code></td> <td><code>[5x3]</code></td> <td><code>[5x3]</code></td></tr> <tr><td>N-D and K-D arrays</td> <td><code>[1x3x3]</code></td> <td><code>[5x3x1x4x2]</code></td> <td><code>[5x3x3x4x2]</code></td></tr></tbody></table> <h3 id="examples-of-incompatible-sizes"><a href="#examples-of-incompatible-sizes" class="header-anchor">#</a> Examples of incompatible sizes:</h3> <table><thead><tr><th>Description</th> <th>1<sup>st</sup> Array Size</th> <th>2<sup>nd</sup> Array Size</th> <th>Possible Workaround</th></tr></thead> <tbody><tr><td>Vectors where a dimension is a multiple of the same dimension in the other array.</td> <td><code>[1x2]</code></td> <td><code>[1x8]</code></td> <td><code>transpose</code></td></tr> <tr><td>Arrays with dimensions that are multiples of each other.</td> <td><code>[2x2]</code></td> <td><code>[8x8]</code></td> <td><code>repmat</code>, <code>reshape</code></td></tr> <tr><td>N-D arrays that have the right amount of singleton dimensions but they're in the wrong order (#1).</td> <td><code>[2x3x4]</code></td> <td><code>[2x4x3]</code></td> <td><code>permute</code></td></tr> <tr><td>N-D arrays that have the right amount of singleton dimensions but they're in the wrong order (#2).</td> <td><code>[2x3x4x5]</code></td> <td><code>[5x2]</code></td> <td><code>permute</code></td></tr></tbody></table> <p><strong>IMPORTANT:</strong><br>
Code relying on this convention is <strong>NOT</strong> backward-compatible with <strong>any</strong> older versions of MATLAB. Therefore, the explicit invocation of <code>bsxfun</code><sup><a href="http://www.mathworks.com/help/matlab/ref/bsxfun.html" target="_blank" rel="noopener noreferrer">1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>,<a href="http://stackoverflow.com/documentation/matlab/750/vectorization/3560/use-of-bsxfun#t=201609152140397001511" target="_blank" rel="noopener noreferrer">2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></sup> (which achieves the same effect) should be used if code needs to run on older MATLAB versions. If such a concern does not exist, <a href="https://www.mathworks.com/help/matlab/release-notes.html?startrelease=R2016b&amp;endrelease=R2016b" target="_blank" rel="noopener noreferrer">MATLAB R2016 release notes<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> encourage users to switch from <code>bsxfun</code>:</p> <blockquote></blockquote> <p><strong>Compared to using <code>bsxfun</code>, implicit expansion offers faster speed of execution, better memory usage, and improved readability of code.</strong></p> <p>Related reading:</p> <ul><li>MATLAB documentation on &quot;<a href="http://www.mathworks.com/help/matlab/matlab_prog/compatible-array-sizes-for-basic-operations.html" target="_blank" rel="noopener noreferrer"><strong>Compatible Array Sizes for Basic Operations</strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>&quot;.</li> <li>NumPy's Broadcasting<sup><a href="http://docs.scipy.org/doc/numpy/user/basics.broadcasting.html" target="_blank" rel="noopener noreferrer">1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>,<a href="http://stackoverflow.com/documentation/numpy/1296/the-basics/9742/broadcasting-array-operations#t=201609152142178194547" target="_blank" rel="noopener noreferrer">2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></sup>.</li> <li>A comparison between the <a href="http://stackoverflow.com/questions/42559922/how-much-faster-is-implicit-expansion-compared-with-bsxfun" target="_blank" rel="noopener noreferrer">speed of computing using <code>bsxfun</code> vs. implicit array expansion<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</li></ul> <h2 id="element-wise-operations"><a href="#element-wise-operations" class="header-anchor">#</a> Element-wise operations</h2> <p>MATLAB supports (and encourages) vectorized operations on vectors and matrices.<br>
For example, suppose we have <code>A</code> and <code>B</code>, two <code>n</code>-by-<code>m</code> matrices and we want <code>C</code> to be the element-wise product of the corresponding elements (i.e., <code>C(i,j) = A(i,j)*B(i,j)</code>).</p> <p>The un-vectorized way, using nested loops is as follows:</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>C <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> ii<span class="token operator">=</span><span class="token number">1</span><span class="token operator">:</span>n
    <span class="token keyword">for</span> jj<span class="token operator">=</span><span class="token number">1</span><span class="token operator">:</span>m
        <span class="token function">C</span><span class="token punctuation">(</span>ii<span class="token punctuation">,</span>jj<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">A</span><span class="token punctuation">(</span>ii<span class="token punctuation">,</span>jj<span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">B</span><span class="token punctuation">(</span>ii<span class="token punctuation">,</span>jj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>
<span class="token keyword">end</span>

</code></pre></div><p>However, the vectorized way of doing this is by using the element-wise operator <code>.*</code>:</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>C <span class="token operator">=</span> A<span class="token operator">.*</span>B<span class="token punctuation">;</span>

</code></pre></div><ul><li>For more information on the element-wise multiplication in MATLAB see the documentation of <a href="http://www.mathworks.com/help/matlab/ref/times.html" target="_blank" rel="noopener noreferrer"><code>times</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</li> <li>For more information about the difference between array and matrix operations see <a href="http://ch.mathworks.com/help/matlab/matlab_prog/array-vs-matrix-operations.html" target="_blank" rel="noopener noreferrer">Array vs. Matrix Operations<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> in the MATLAB documentation.</li></ul> <h2 id="logical-masking"><a href="#logical-masking" class="header-anchor">#</a> Logical Masking</h2> <p>MATLAB supports the use of logical masking in order to perform selection on a matrix without the use of for loops or if statements.</p> <p>A logical mask is defined as a matrix composed of only <code>1</code> and <code>0</code>.</p> <p>For example:</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>mask <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span> <span class="token number">0</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token number">0</span> <span class="token number">1</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

</code></pre></div><p>is a logical matrix representing the identity matrix.</p> <p>We can generate a logical mask using a predicate to query a matrix.</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>A <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token number">4</span> <span class="token number">5</span> <span class="token number">6</span><span class="token punctuation">;</span> <span class="token number">7</span> <span class="token number">8</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
B <span class="token operator">=</span> A <span class="token operator">&gt;</span> <span class="token number">4</span><span class="token punctuation">;</span>

</code></pre></div><p>We first create a 3x3 matrix, <code>A</code>, containing the numbers 1 through 9. We then query <code>A</code> for values that are greater than 4 and store the result in a new matrix called <code>B</code>.</p> <p><code>B</code> is a logical matrix of the form:</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>B <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span>
     <span class="token number">0</span> <span class="token number">1</span> <span class="token number">1</span>
     <span class="token number">1</span> <span class="token number">1</span> <span class="token number">1</span><span class="token punctuation">]</span>

</code></pre></div><p>Or <code>1</code> when the predicate <code>A &gt; 4</code> was true. And <code>0</code> when it was false.</p> <p>We can use logical matrices to access elements of a matrix. If a logical matrix is used to select elements, indices where a <code>1</code> appear in the logical matrix will be selected in the matrix you are selecting from.</p> <p>Using the same <code>B</code> from above, we could do the following:</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>C <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">C</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>

</code></pre></div><p>This would select all of the elements of <code>C</code> where <code>B</code> has a <code>1</code> in that index. Those indices in <code>C</code> are then set to <code>5</code>.</p> <p>Our <code>C</code> now looks like:</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>C <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span>
     <span class="token number">0</span> <span class="token number">5</span> <span class="token number">5</span>
     <span class="token number">5</span> <span class="token number">5</span> <span class="token number">5</span><span class="token punctuation">]</span>

</code></pre></div><p>We can reduce complicated code blocks containing <code>if</code> and <code>for</code> by using logical masks.</p> <p>Take the non-vectorized code:</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>A <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span> <span class="token number">3</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token number">7</span> <span class="token number">9</span> <span class="token number">11</span><span class="token punctuation">;</span> <span class="token number">11</span> <span class="token number">9</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token number">j</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token function">length</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token function">A</span><span class="token punctuation">(</span><span class="token number">j</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">5</span>
    <span class="token function">A</span><span class="token punctuation">(</span><span class="token number">j</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">A</span><span class="token punctuation">(</span><span class="token number">j</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>

</code></pre></div><p>This can be shortened using logical masking to the following code:</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>A <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span> <span class="token number">3</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token number">7</span> <span class="token number">9</span> <span class="token number">11</span><span class="token punctuation">;</span> <span class="token number">11</span> <span class="token number">9</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
B <span class="token operator">=</span> A <span class="token operator">&gt;</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token function">A</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">A</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">;</span>

</code></pre></div><p>Or even shorter:</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>A <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span> <span class="token number">3</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token number">7</span> <span class="token number">9</span> <span class="token number">11</span><span class="token punctuation">;</span> <span class="token number">11</span> <span class="token number">9</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">A</span><span class="token punctuation">(</span>A <span class="token operator">&gt;</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">A</span><span class="token punctuation">(</span>A <span class="token operator">&gt;</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="sum-mean-prod-co"><a href="#sum-mean-prod-co" class="header-anchor">#</a> Sum, mean, prod &amp; co</h2> <p>Given a random vector</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>v <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>if you want the sum of its elements, do <strong>NOT</strong> use a loop</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>s <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> ii <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span>
    s <span class="token operator">=</span> s <span class="token operator">+</span> <span class="token function">v</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span> 

</code></pre></div><p>but use the vectorized capability of the <a href="http://uk.mathworks.com/help/matlab/ref/sum.html" target="_blank" rel="noopener noreferrer"><code>sum()</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> function</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>s <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>Functions like <a href="http://uk.mathworks.com/help/matlab/ref/sum.html" target="_blank" rel="noopener noreferrer"><code>sum()</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <a href="http://uk.mathworks.com/help/matlab/ref/mean.html" target="_blank" rel="noopener noreferrer"><code>mean()</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <a href="http://uk.mathworks.com/help/matlab/ref/prod.html" target="_blank" rel="noopener noreferrer"><code>prod()</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and others, have the ability to operate directly along rows, columns or other dimensions.</p> <p>For instance, given a random matrix</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>A <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>the average for each <strong>column</strong> is</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>m <span class="token operator">=</span> <span class="token function">mean</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>the average for each <strong>row</strong> is</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>m <span class="token operator">=</span> <span class="token function">mean</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>

</code></pre></div><p>All the functions above work only on one dimension, but what if you want to sum the whole matrix? You could use:</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>s <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><p>But what if have an ND-array? applying <code>sum</code> on <code>sum</code> on <code>sum</code>... don't seem like the best option, instead use the <code>:</code> operator to vectorize your array:</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>s <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token function">A</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><p>and this will result in one number which is the sum of all your array, doesn't matter how many dimensions it have.</p> <h2 id="get-the-value-of-a-function-of-two-or-more-arguments"><a href="#get-the-value-of-a-function-of-two-or-more-arguments" class="header-anchor">#</a> Get the  value of a function  of two or more arguments</h2> <p>In many application it is necessary to compute the function of two or more arguments.</p> <p>Traditionally, we use <code>for</code>-loops. For example, if we need to calculate the <code>f = exp(-x^2-y^2)</code> (do not use this if you need <strong>fast simulations</strong>):</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code><span class="token comment">% code1</span>
x <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1.2</span><span class="token operator">:</span><span class="token number">0.2</span><span class="token operator">:</span><span class="token number">1.4</span><span class="token punctuation">;</span>
y <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2</span><span class="token operator">:</span><span class="token number">0.25</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> nx<span class="token operator">=</span><span class="token number">1</span><span class="token operator">:</span><span class="token function">lenght</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
   <span class="token keyword">for</span> ny<span class="token operator">=</span><span class="token number">1</span><span class="token operator">:</span><span class="token function">lenght</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span>
      <span class="token function">f</span><span class="token punctuation">(</span>nx<span class="token punctuation">,</span>ny<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token function">x</span><span class="token punctuation">(</span>nx<span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">2</span><span class="token operator">-</span><span class="token function">y</span><span class="token punctuation">(</span>ny<span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">end</span>
<span class="token keyword">end</span>

</code></pre></div><p>But vectorized version is more elegant and faster:</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code><span class="token comment">% code2</span>
<span class="token punctuation">[</span>x<span class="token punctuation">,</span>y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">ndgrid</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1.2</span><span class="token operator">:</span><span class="token number">0.2</span><span class="token operator">:</span><span class="token number">1.4</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token operator">:</span><span class="token number">0.25</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
f <span class="token operator">=</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token operator">-</span>x<span class="token operator">.^</span><span class="token number">2</span><span class="token operator">-</span>y<span class="token operator">.^</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>than we can visualize it:</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code><span class="token function">surf</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>f<span class="token punctuation">)</span>

</code></pre></div><p><strong>Note1</strong> - Grids: Usually, the matrix storage is organized <strong>row-by-row</strong>. But in the MATLAB, it is the <strong>column-by-column</strong> storage as in FORTRAN. Thus, there are two simular functions <code>ndgrid</code> and <code>meshgrid</code> in MATLAB  to implement the two aforementioned models. To visualise the function in the case of <code>meshgrid</code>, we can use:</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code><span class="token function">surf</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span>x<span class="token punctuation">,</span>f<span class="token punctuation">)</span>

</code></pre></div><p><strong>Note2</strong> - Memory consumption: Let size of <code>x</code> or <code>y</code> is 1000. Thus, we need to store <code>1000*1000+2*1000 ~ 1e6</code> elements for non-vectorized <strong><strong>code1</strong></strong>.
But we need <code>3*(1000*1000) = 3e6</code> elements in the case of vectorized <strong><strong>code2</strong></strong>.
In the 3D case (let <code>z</code> has the same size as<code>x</code> or <code>y</code>), memory consumption increases dramatically: <code>4*(1000*1000*1000)</code> (~32GB for doubles) in the case of the vectorized <strong><strong>code2</strong></strong> vs <code>~1000*1000*1000</code> (just ~8GB) in the case of <strong><strong>code1</strong></strong>. Thus, we have to choose either the memory or speed.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/matlab/vectorization.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/matlab/object-oriented-programming.html" class="prev">
        Object-Oriented Programming
      </a></span> <span class="next"><a href="/matlab/matrix-decompositions.html">
        Matrix decompositions
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/1943.f1d8c2b4.js" defer></script>
  </body>
</html>
