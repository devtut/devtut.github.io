<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>C++ | C++ Debugging and Debug-prevention Tools &amp; Techniques</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Segfault analysis with GDB, Static analysis, Clean code, My C++ program ends with segfault - valgrind, Safe-stack (Stack corruptions)">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="C++ | C++ Debugging and Debug-prevention Tools & Techniques">
    <meta property="og:description" content="Segfault analysis with GDB, Static analysis, Clean code, My C++ program ends with segfault - valgrind, Safe-stack (Stack corruptions)">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/cpp/c-debugging-and-debug-prevention-tools-techniques.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="C++ | C++ Debugging and Debug-prevention Tools & Techniques">
    <meta name="twitter:description" content="Segfault analysis with GDB, Static analysis, Clean code, My C++ program ends with segfault - valgrind, Safe-stack (Stack corruptions)">
    <meta name="twitter:url" content="/cpp/c-debugging-and-debug-prevention-tools-techniques.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/625.08da53b7.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>C++</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/cpp/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/cpp/getting-started-with-cpp.html" class="sidebar-link">Getting started with C++</a></li><li><a href="/cpp/literals.html" class="sidebar-link">Literals</a></li><li><a href="/cpp/operator-precedence.html" class="sidebar-link">operator precedence</a></li><li><a href="/cpp/floating-point-arithmetic.html" class="sidebar-link">Floating Point Arithmetic</a></li><li><a href="/cpp/bit-operators.html" class="sidebar-link">Bit Operators</a></li><li><a href="/cpp/bit-manipulation.html" class="sidebar-link">Bit Manipulation</a></li><li><a href="/cpp/bit-fields.html" class="sidebar-link">Bit fields</a></li><li><a href="/cpp/arrays.html" class="sidebar-link">Arrays</a></li><li><a href="/cpp/iterators.html" class="sidebar-link">Iterators</a></li><li><a href="/cpp/basic-input-output-in-c.html" class="sidebar-link">Basic input/output in c++</a></li><li><a href="/cpp/loops.html" class="sidebar-link">Loops</a></li><li><a href="/cpp/file-i-o.html" class="sidebar-link">File I/O</a></li><li><a href="/cpp/cpp-streams.html" class="sidebar-link">C++ Streams</a></li><li><a href="/cpp/stream-manipulators.html" class="sidebar-link">Stream manipulators</a></li><li><a href="/cpp/flow-control.html" class="sidebar-link">Flow Control</a></li><li><a href="/cpp/metaprogramming.html" class="sidebar-link">Metaprogramming</a></li><li><a href="/cpp/const-keyword.html" class="sidebar-link">const keyword</a></li><li><a href="/cpp/mutable-keyword.html" class="sidebar-link">mutable keyword</a></li><li><a href="/cpp/friend-keyword.html" class="sidebar-link">Friend keyword</a></li><li><a href="/cpp/type-keywords.html" class="sidebar-link">Type Keywords</a></li><li><a href="/cpp/basic-type-keywords.html" class="sidebar-link">Basic Type Keywords</a></li><li><a href="/cpp/variable-declaration-keywords.html" class="sidebar-link">Variable Declaration Keywords</a></li><li><a href="/cpp/keywords.html" class="sidebar-link">Keywords</a></li><li><a href="/cpp/returning-several-values-from-a-function.html" class="sidebar-link">Returning several values from a function</a></li><li><a href="/cpp/polymorphism.html" class="sidebar-link">Polymorphism</a></li><li><a href="/cpp/references.html" class="sidebar-link">References</a></li><li><a href="/cpp/value-and-reference-semantics.html" class="sidebar-link">Value and Reference Semantics</a></li><li><a href="/cpp/c-function-call-by-value-vs-call-by-reference.html" class="sidebar-link">C++ function &quot;call by value&quot; vs. &quot;call by reference&quot;</a></li><li><a href="/cpp/copying-vs-assignment.html" class="sidebar-link">Copying vs Assignment</a></li><li><a href="/cpp/pointers.html" class="sidebar-link">Pointers</a></li><li><a href="/cpp/pointers-to-members.html" class="sidebar-link">Pointers to members</a></li><li><a href="/cpp/the-this-pointer.html" class="sidebar-link">The This Pointer</a></li><li><a href="/cpp/smart-pointers.html" class="sidebar-link">Smart Pointers</a></li><li><a href="/cpp/classes-structures.html" class="sidebar-link">Classes/Structures</a></li><li><a href="/cpp/function-overloading.html" class="sidebar-link">Function Overloading</a></li><li><a href="/cpp/operator-overloading.html" class="sidebar-link">Operator Overloading</a></li><li><a href="/cpp/function-template-overloading.html" class="sidebar-link">Function Template Overloading</a></li><li><a href="/cpp/virtual-member-functions.html" class="sidebar-link">Virtual Member Functions</a></li><li><a href="/cpp/inline-functions.html" class="sidebar-link">Inline functions</a></li><li><a href="/cpp/special-member-functions.html" class="sidebar-link">Special Member Functions</a></li><li><a href="/cpp/non-static-member-functions.html" class="sidebar-link">Non-Static Member Functions</a></li><li><a href="/cpp/constant-class-member-functions.html" class="sidebar-link">Constant class member functions</a></li><li><a href="/cpp/c-containers.html" class="sidebar-link">C++ Containers</a></li><li><a href="/cpp/namespaces.html" class="sidebar-link">Namespaces</a></li><li><a href="/cpp/header-files.html" class="sidebar-link">Header Files</a></li><li><a href="/cpp/using-declaration.html" class="sidebar-link">Using declaration</a></li><li><a href="/cpp/std-string.html" class="sidebar-link">std::string</a></li><li><a href="/cpp/std-array.html" class="sidebar-link">std::array</a></li><li><a href="/cpp/std-vector.html" class="sidebar-link">std::vector</a></li><li><a href="/cpp/std-map.html" class="sidebar-link">std::map</a></li><li><a href="/cpp/std-optional.html" class="sidebar-link">std::optional</a></li><li><a href="/cpp/std-function-to-wrap-any-element-that-is-callable.html" class="sidebar-link">std::function: To wrap any element that is callable</a></li><li><a href="/cpp/std-forward-list.html" class="sidebar-link">std::forward_list</a></li><li><a href="/cpp/std-pair.html" class="sidebar-link">std::pair</a></li><li><a href="/cpp/std-atomics.html" class="sidebar-link">std::atomics</a></li><li><a href="/cpp/std-variant.html" class="sidebar-link">std::variant</a></li><li><a href="/cpp/std-iomanip.html" class="sidebar-link">std::iomanip</a></li><li><a href="/cpp/std-any.html" class="sidebar-link">std::any</a></li><li><a href="/cpp/std-set-and-std-multiset.html" class="sidebar-link">std::set and std::multiset</a></li><li><a href="/cpp/std-integer-sequence.html" class="sidebar-link">std::integer_sequence</a></li><li><a href="/cpp/using-std-unordered-map.html" class="sidebar-link">Using std::unordered_map</a></li><li><a href="/cpp/standard-library-algorithms.html" class="sidebar-link">Standard Library Algorithms</a></li><li><a href="/cpp/the-iso-c-standard.html" class="sidebar-link">The ISO C++ Standard</a></li><li><a href="/cpp/inline-variables.html" class="sidebar-link">Inline variables</a></li><li><a href="/cpp/random-number-generation.html" class="sidebar-link">Random number generation</a></li><li><a href="/cpp/date-and-time-using-chrono-header.html" class="sidebar-link">Date and time using  header</a></li><li><a href="/cpp/sorting.html" class="sidebar-link">Sorting</a></li><li><a href="/cpp/enumeration.html" class="sidebar-link">Enumeration</a></li><li><a href="/cpp/iteration.html" class="sidebar-link">Iteration</a></li><li><a href="/cpp/regular-expressions.html" class="sidebar-link">Regular expressions</a></li><li><a href="/cpp/implementation-defined-behavior.html" class="sidebar-link">Implementation-defined behavior</a></li><li><a href="/cpp/exceptions.html" class="sidebar-link">Exceptions</a></li><li><a href="/cpp/lambdas.html" class="sidebar-link">Lambdas</a></li><li><a href="/cpp/value-categories.html" class="sidebar-link">Value Categories</a></li><li><a href="/cpp/preprocessor.html" class="sidebar-link">Preprocessor</a></li><li><a href="/cpp/data-structures-in-c.html" class="sidebar-link">Data Structures in C++</a></li><li><a href="/cpp/templates.html" class="sidebar-link">Templates</a></li><li><a href="/cpp/expression-templates.html" class="sidebar-link">Expression templates</a></li><li><a href="/cpp/curiously-recurring-template-pattern-crtp.html" class="sidebar-link">Curiously Recurring Template Pattern (CRTP)</a></li><li><a href="/cpp/threading.html" class="sidebar-link">Threading</a></li><li><a href="/cpp/thread-synchronization-structures.html" class="sidebar-link">Thread synchronization structures</a></li><li><a href="/cpp/the-rule-of-three-five-and-zero.html" class="sidebar-link">The Rule of Three, Five, And Zero</a></li><li><a href="/cpp/raii-resource-acquisition-is-initialization.html" class="sidebar-link">RAII: Resource Acquisition Is Initialization</a></li><li><a href="/cpp/rtti-run-time-type-information.html" class="sidebar-link">RTTI: Run-Time Type Information</a></li><li><a href="/cpp/mutexes.html" class="sidebar-link">Mutexes</a></li><li><a href="/cpp/recursive-mutex.html" class="sidebar-link">Recursive Mutex</a></li><li><a href="/cpp/semaphore.html" class="sidebar-link">Semaphore</a></li><li><a href="/cpp/futures-and-promises.html" class="sidebar-link">Futures and Promises</a></li><li><a href="/cpp/atomic-types.html" class="sidebar-link">Atomic Types</a></li><li><a href="/cpp/type-erasure.html" class="sidebar-link">Type Erasure</a></li><li><a href="/cpp/explicit-type-conversions.html" class="sidebar-link">Explicit type conversions</a></li><li><a href="/cpp/unnamed-types.html" class="sidebar-link">Unnamed types</a></li><li><a href="/cpp/type-traits.html" class="sidebar-link">Type Traits</a></li><li><a href="/cpp/return-type-covariance.html" class="sidebar-link">Return Type Covariance</a></li><li><a href="/cpp/layout-of-object-types.html" class="sidebar-link">Layout of object types</a></li><li><a href="/cpp/type-inference.html" class="sidebar-link">Type Inference</a></li><li><a href="/cpp/typedef-and-type-aliases.html" class="sidebar-link">Typedef and type aliases</a></li><li><a href="/cpp/type-deduction.html" class="sidebar-link">type deduction</a></li><li><a href="/cpp/trailing-return-type.html" class="sidebar-link">Trailing return type</a></li><li><a href="/cpp/alignment.html" class="sidebar-link">Alignment</a></li><li><a href="/cpp/perfect-forwarding.html" class="sidebar-link">Perfect Forwarding</a></li><li><a href="/cpp/decltype.html" class="sidebar-link">decltype</a></li><li><a href="/cpp/sfinae-substitution-failure-is-not-an-error.html" class="sidebar-link">SFINAE (Substitution Failure Is Not An Error)</a></li><li><a href="/cpp/undefined-behavior.html" class="sidebar-link">Undefined Behavior</a></li><li><a href="/cpp/overload-resolution.html" class="sidebar-link">Overload resolution</a></li><li><a href="/cpp/move-semantics.html" class="sidebar-link">Move Semantics</a></li><li><a href="/cpp/pimpl-idiom.html" class="sidebar-link">Pimpl Idiom</a></li><li><a href="/cpp/auto.html" class="sidebar-link">auto</a></li><li><a href="/cpp/copy-elision.html" class="sidebar-link">Copy Elision</a></li><li><a href="/cpp/fold-expressions.html" class="sidebar-link">Fold Expressions</a></li><li><a href="/cpp/unions.html" class="sidebar-link">Unions</a></li><li><a href="/cpp/design-pattern-implementation-in-c.html" class="sidebar-link">Design pattern implementation in C++</a></li><li><a href="/cpp/singleton-design-pattern.html" class="sidebar-link">Singleton Design Pattern</a></li><li><a href="/cpp/user-defined-literals.html" class="sidebar-link">User-Defined Literals</a></li><li><a href="/cpp/memory-management.html" class="sidebar-link">Memory management</a></li><li><a href="/cpp/c-11-memory-model.html" class="sidebar-link">C++11 Memory Model</a></li><li><a href="/cpp/scopes.html" class="sidebar-link">Scopes</a></li><li><a href="/cpp/static-assert.html" class="sidebar-link">static_assert</a></li><li><a href="/cpp/constexpr.html" class="sidebar-link">constexpr</a></li><li><a href="/cpp/one-definition-rule-odr.html" class="sidebar-link">One Definition Rule (ODR)</a></li><li><a href="/cpp/unspecified-behavior.html" class="sidebar-link">Unspecified behavior</a></li><li><a href="/cpp/argument-dependent-name-lookup.html" class="sidebar-link">Argument Dependent Name Lookup</a></li><li><a href="/cpp/attributes.html" class="sidebar-link">Attributes</a></li><li><a href="/cpp/recursion-in-c.html" class="sidebar-link">Recursion in C++</a></li><li><a href="/cpp/arithmitic-metaprogramming.html" class="sidebar-link">Arithmitic Metaprogramming</a></li><li><a href="/cpp/callable-objects.html" class="sidebar-link">Callable Objects</a></li><li><a href="/cpp/client-server-examples.html" class="sidebar-link">Client server examples</a></li><li><a href="/cpp/const-correctness.html" class="sidebar-link">Const Correctness</a></li><li><a href="/cpp/parameter-packs.html" class="sidebar-link">Parameter packs</a></li><li><a href="/cpp/build-systems.html" class="sidebar-link">Build Systems</a></li><li><a href="/cpp/concurrency-with-openmp.html" class="sidebar-link">Concurrency With OpenMP</a></li><li><a href="/cpp/resource-management.html" class="sidebar-link">Resource Management</a></li><li><a href="/cpp/storage-class-specifiers.html" class="sidebar-link">Storage class specifiers</a></li><li><a href="/cpp/linkage-specifications.html" class="sidebar-link">Linkage specifications</a></li><li><a href="/cpp/digit-separators.html" class="sidebar-link">Digit separators</a></li><li><a href="/cpp/c-incompatibilities.html" class="sidebar-link">C incompatibilities</a></li><li><a href="/cpp/side-by-side-comparisons-of-classic-c-examples-solved-via-c-vs-c-11-vs-c-14-vs-c-17.html" class="sidebar-link">Side by Side Comparisons of classic C++ examples solved via C++ vs C++11 vs C++14 vs C++17</a></li><li><a href="/cpp/compiling-and-building.html" class="sidebar-link">Compiling and Building</a></li><li><a href="/cpp/common-compile-linker-errors-gcc.html" class="sidebar-link">Common compile/linker errors (GCC)</a></li><li><a href="/cpp/more-undefined-behaviors-in-c.html" class="sidebar-link">More undefined behaviors in C++</a></li><li><a href="/cpp/unit-testing-in-c.html" class="sidebar-link">Unit Testing in C++</a></li><li><a href="/cpp/c-debugging-and-debug-prevention-tools-techniques.html" aria-current="page" class="active sidebar-link">C++ Debugging and Debug-prevention Tools &amp; Techniques</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cpp/c-debugging-and-debug-prevention-tools-techniques.html#segfault-analysis-with-gdb" class="sidebar-link">Segfault analysis with GDB</a></li><li class="sidebar-sub-header"><a href="/cpp/c-debugging-and-debug-prevention-tools-techniques.html#static-analysis" class="sidebar-link">Static analysis</a></li><li class="sidebar-sub-header"><a href="/cpp/c-debugging-and-debug-prevention-tools-techniques.html#clean-code" class="sidebar-link">Clean code</a></li><li class="sidebar-sub-header"><a href="/cpp/c-debugging-and-debug-prevention-tools-techniques.html#my-c-program-ends-with-segfault-valgrind" class="sidebar-link">My C++ program ends with segfault - valgrind</a></li><li class="sidebar-sub-header"><a href="/cpp/c-debugging-and-debug-prevention-tools-techniques.html#safe-stack-stack-corruptions" class="sidebar-link">Safe-stack (Stack corruptions)</a></li></ul></li><li><a href="/cpp/optimization-in-c.html" class="sidebar-link">Optimization in C++</a></li><li><a href="/cpp/optimization.html" class="sidebar-link">Optimization</a></li><li><a href="/cpp/profiling.html" class="sidebar-link">Profiling</a></li><li><a href="/cpp/refactoring-techniques.html" class="sidebar-link">Refactoring Techniques</a></li><li><a href="/cpp/internationalization-in-c.html" class="sidebar-link">Internationalization in C++</a></li><li><a href="/cpp/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="c-debugging-and-debug-prevention-tools-techniques"><a href="#c-debugging-and-debug-prevention-tools-techniques" class="header-anchor">#</a> C++ Debugging and Debug-prevention Tools &amp; Techniques</h1> <p>A lot of time from C++ developers is spent debugging. This topic is meant to assist with this task and give inspiration for techniques. Don't expect an extensive list of issues and solutions fixed by the tools or a manual on the mentioned tools.</p> <h2 id="segfault-analysis-with-gdb"><a href="#segfault-analysis-with-gdb" class="header-anchor">#</a> Segfault analysis with GDB</h2> <p>Lets use the same code as above for this example.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

<span class="token keyword">void</span> <span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> <span class="token operator">*</span>p1<span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token operator">*</span><span class="token function">p2</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token operator">*</span>p3 <span class="token operator">=</span> p1<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>p3<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token operator">*</span>p2 <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>First lets compile it</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>g<span class="token operator">++</span> <span class="token operator">-</span>g <span class="token operator">-</span>o main main<span class="token punctuation">.</span>cpp

</code></pre></div><p>Lets run it with gdb</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>gdb <span class="token punctuation">.</span><span class="token operator">/</span>main

</code></pre></div><p>Now we will be in gdb shell. Type run.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> run
The program being debugged has been started already<span class="token punctuation">.</span>
Start it from the beginning<span class="token operator">?</span> <span class="token punctuation">(</span>y <span class="token operator">or</span> n<span class="token punctuation">)</span> y
Starting program<span class="token operator">:</span> <span class="token operator">/</span>home<span class="token operator">/</span>opencog<span class="token operator">/</span>code<span class="token operator">-</span>snippets<span class="token operator">/</span>stackoverflow<span class="token operator">/</span>a<span class="token punctuation">.</span>out 

Program received signal SIGSEGV<span class="token punctuation">,</span> Segmentation fault<span class="token punctuation">.</span>
<span class="token number">0x0000000000400850</span> in <span class="token function">fail</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> at debugging_with_gdb<span class="token punctuation">.</span>cc<span class="token operator">:</span><span class="token number">11</span>
<span class="token number">11</span>            std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token operator">*</span>p2 <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

</code></pre></div><p>We see the segmentation fault is happening at line 11. So the only variable being used at this line is pointer p2. Lets examine its content typing print.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> print p2
$<span class="token number">1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token number">0x0</span> 

</code></pre></div><p>Now we see that p2 was initialized to 0x0 which stands for NULL. At this line, we know that we are trying to dereference a NULL pointer. So we go and fix it.</p> <h2 id="static-analysis"><a href="#static-analysis" class="header-anchor">#</a> Static analysis</h2> <p>Static analysis is the technique in which on checks the code for patterns linked to known bugs. Using this technique is less time consuming than a code review, though, its checks are only limited to those programmed in the tool.</p> <p>Checks can include the incorrect semi-colon behind the if-statement (<code>if (var);</code>) till advanced graph algorithms which determine if a variable is not initialized.</p> <h3 id="compiler-warnings"><a href="#compiler-warnings" class="header-anchor">#</a> Compiler warnings</h3> <p>Enabling static analysis is easy, the most simplistic version is already build-in in your compiler:</p> <ul><li><a href="https://clang.llvm.org/docs/DiagnosticsReference.html" target="_blank" rel="noopener noreferrer"><code>clang++ -Wall -Weverything -Werror ...</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html" target="_blank" rel="noopener noreferrer"><code>g++ -Wall -Weverything -Werror ...</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://docs.microsoft.com/en-us/cpp/build/reference/compiler-option-warning-level" target="_blank" rel="noopener noreferrer"><code>cl.exe /W4 /WX ...</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>If you enable these options, you will notice that each compiler will find bugs the others don't and that you will get errors on techniques which might be valid or valid in a specific context. <code>while (staticAtomicBool);</code> might be acceptable even if <code>while (localBool);</code> ain't.</p> <p>So unlike code review, you are fighting a tool which understands your code, tells you a lot of useful bugs and sometimes disagrees with you. In this last case, you might have to suppress the warning locally.</p> <p>As the options above enable all warnings, they might enable warnings you don't want. (Why should your code be C++98 compatible?) If so, you can simply disable that specific warning:</p> <ul><li><code>clang++ -Wall -Weverything -Werror -Wno-errortoaccept ...</code></li> <li><code>g++ -Wall -Weverything -Werror -Wno-errortoaccept ...</code></li> <li><code>cl.exe /W4 /WX /wd&lt;no of warning&gt;...</code></li></ul> <p>Where compiler warnings assist you during development, they slow down compilation quite a bit. That is why you might not always want to enable them by default. Either you run them by default or you enable some continuous integration with the more expensive checks (or all of them).</p> <h3 id="external-tools"><a href="#external-tools" class="header-anchor">#</a> External tools</h3> <p>If you decide to have some continuous integration, the use of other tools ain't such a stretch. A tool like <a href="http://clang.llvm.org/extra/clang-tidy/" target="_blank" rel="noopener noreferrer">clang-tidy<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> has an <a href="http://clang.llvm.org/extra/clang-tidy/checks/list.html" target="_blank" rel="noopener noreferrer">list of checks<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> which covers a wide range of issues, some examples:</p> <li>Actual bugs
<ul>
- Prevention of slicing
- Asserts with side effects
<ul><li><p>Misleading indentation</p></li> <li><p>Check identifier naming</p></li> <li><p>Use make_unique()</p></li> <li><p>Use nullptr</p></li> <li><p>Find unneeded copies</p></li> <li><p>Find inefficient algorithm calls</p></li></ul> <p>The list might not be that large, as Clang already has a lot of compiler warnings, however it will bring you one step closer to a high quality code base.</p> <h3 id="other-tools"><a href="#other-tools" class="header-anchor">#</a> Other tools</h3> <p>Other tools with similar purpose exist, like:</p> <ul><li><a href="https://blogs.msdn.microsoft.com/hkamel/2013/10/24/visual-studio-2013-static-code-analysis-in-depth-what-when-and-how/" target="_blank" rel="noopener noreferrer">the visual studio static analyzer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> as external tool</li> <li><a href="https://blogs.kde.org/2015/11/15/new-cqt-code-checks-clazy-static-analyzer" target="_blank" rel="noopener noreferrer">clazy<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, a Clang compiler plugin for checking Qt code</li></ul> <h3 id="conclusion"><a href="#conclusion" class="header-anchor">#</a> Conclusion</h3> <p>A lot static analysis tools exist for C++, both build-in in the compiler as external tools. Trying them out doesn't take that much time for easy setups and they will find bugs you might miss in code review.</p> <h2 id="clean-code"><a href="#clean-code" class="header-anchor">#</a> Clean code</h2> <p>Debugging starts with understanding the code you are trying to debug.</p> <p>Bad code:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> value<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> vectorToSort<span class="token punctuation">;</span>
    vectorToSort<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span> vectorToSort<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">52</span><span class="token punctuation">;</span> i<span class="token punctuation">;</span> i <span class="token operator">=</span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
    vectorToSort<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i <span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/// Optimized for sorting small vectors</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>vectorToSort<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>vectorToSort<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">2</span><span class="token punctuation">)</span>
            std<span class="token double-colon punctuation">::</span><span class="token function">sort</span><span class="token punctuation">(</span>vectorToSort<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span><span class="token function">end</span><span class="token punctuation">(</span>vectorToSort<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>value <span class="token operator">:</span> vectorToSort<span class="token punctuation">)</span> std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> value <span class="token operator">&lt;&lt;</span> <span class="token string">' '</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

</code></pre></div><p>Better code:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token function">createSemiRandomData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> data<span class="token punctuation">;</span>
    data<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    data<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">52</span><span class="token punctuation">;</span> i<span class="token punctuation">;</span> <span class="token operator">--</span>i<span class="token punctuation">)</span>
        vectorToSort<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i <span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> data<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/// Optimized for sorting small vectors</span>
<span class="token keyword">void</span> <span class="token function">sortVector</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>vector <span class="token operator">&amp;</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>vectorToSort<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>vectorToSort<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>

    std<span class="token double-colon punctuation">::</span><span class="token function">sort</span><span class="token punctuation">(</span>vectorToSort<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> vectorToSort<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">printVector</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token operator">&amp;</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> i <span class="token operator">:</span> v<span class="token punctuation">)</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> i <span class="token operator">&lt;&lt;</span> <span class="token string">' '</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">auto</span> vectorToSort <span class="token operator">=</span> <span class="token function">createSemiRandomData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sortVector</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">ref</span><span class="token punctuation">(</span>vectorToSort<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printVector</span><span class="token punctuation">(</span>vectorToSort<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>

</code></pre></div><p>Regardless of the coding styles you prefer and use, having a consistent coding (and formatting) style will help you understanding the code.</p> <p>Looking at the code above, one can identify a couple of improvements to improve readability and debuggability:</p> <h3 id="the-use-of-separate-functions-for-separate-actions"><a href="#the-use-of-separate-functions-for-separate-actions" class="header-anchor">#</a> The use of separate functions for separate actions</h3> <p>The use of separate functions allow you to skip over some functions in the debugger if you ain't interested in the details. In this specific case, you might not be interested in the creation or printing of the data and only want to step into the sorting.</p> <p>Another advantage is that you need to read less code (and memorize it) while stepping through the code. You now only need to read 3 lines of code in <code>main()</code> in order to understand it, instead of the whole function.</p> <p>The third advantage is that you simply have less code to look at, which helps a trained eye in spotting this bug within seconds.</p> <h3 id="using-consistent-formatting-constructions"><a href="#using-consistent-formatting-constructions" class="header-anchor">#</a> Using consistent formatting/constructions</h3> <p>The use of consistent formatting and constructions will remove clutter from the code making it easier to focus on the code instead of text. A lot of discussions have been fed on the 'right' formatting style. Regardless of that style, having a single consistent style in the code will improve familiarity and make it easier to focus on the code.</p> <p>As formatting code is time consuming task, it is recommended to use a dedicated tool for this. Most IDEs have at least some kind of support for this and can do formatting more consistent than humans.</p> <p>You might note that the style is not limited to spaces and newlines as we no longer mix the free-style and the member functions to get begin/end of the container. (<code>v.begin()</code> vs <code>std::end(v)</code>).</p> <h3 id="point-attention-to-the-important-parts-of-your-code"><a href="#point-attention-to-the-important-parts-of-your-code" class="header-anchor">#</a> Point attention to the important parts of your code.</h3> <p>Regardless of the style you determine to choose, the above code contains a couple of markers which might give you a hint on what might be important:</p> <ul><li>A comment stating <code>optimized</code>, this indicates some fancy techniques</li> <li>Some early returns in <code>sortVector()</code> indicate that we are doing something special</li> <li>The <code>std::ref()</code> indicates that something is going on with the <code>sortVector()</code></li></ul> <h3 id="conclusion-2"><a href="#conclusion-2" class="header-anchor">#</a> Conclusion</h3> <p>Having clean code will help you understanding the code and will reduce the time you need to debug it. In the second example, a code reviewer might even spot the bug at first glance, while the bug might be hidden in the details in the first one. (PS: The bug is in the compare with <code>2</code>.)</p> <h2 id="my-c-program-ends-with-segfault-valgrind"><a href="#my-c-program-ends-with-segfault-valgrind" class="header-anchor">#</a> My C++ program ends with segfault - valgrind</h2> <p>Let's have a basic failing program:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

<span class="token keyword">void</span> <span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> <span class="token operator">*</span>p1<span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token operator">*</span><span class="token function">p2</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token operator">*</span>p3 <span class="token operator">=</span> p1<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>p3<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token operator">*</span>p3 <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>Build it (add -g to include debug info):</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>g<span class="token operator">++</span> <span class="token operator">-</span>g <span class="token operator">-</span>o main main<span class="token punctuation">.</span>cpp

</code></pre></div><p>Run:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>$ <span class="token punctuation">.</span><span class="token operator">/</span>main
Segmentation <span class="token function">fault</span> <span class="token punctuation">(</span>core dumped<span class="token punctuation">)</span>
$

</code></pre></div><p>Let's debug it with valgrind:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>$ valgrind <span class="token punctuation">.</span><span class="token operator">/</span>main
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span> Memcheck<span class="token punctuation">,</span> a memory error detector
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span> <span class="token function">Copyright</span> <span class="token punctuation">(</span>C<span class="token punctuation">)</span> <span class="token number">2002</span><span class="token operator">-</span><span class="token number">2015</span><span class="token punctuation">,</span> <span class="token operator">and</span> GNU GPL<span class="token number">'</span>d<span class="token punctuation">,</span> by Julian Seward et al<span class="token punctuation">.</span>
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span> Using Valgrind<span class="token operator">-</span><span class="token number">3.11</span><span class="token punctuation">.</span><span class="token number">0</span> <span class="token operator">and</span> LibVEX<span class="token punctuation">;</span> rerun with <span class="token operator">-</span>h <span class="token keyword">for</span> copyright info
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span> Command<span class="token operator">:</span> <span class="token punctuation">.</span><span class="token operator">/</span>main
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span> Conditional jump <span class="token operator">or</span> move depends on uninitialised <span class="token function">value</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span>    at <span class="token number">0x400813</span><span class="token operator">:</span> <span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>cpp<span class="token operator">:</span><span class="token number">7</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span>    by <span class="token number">0x40083F</span><span class="token operator">:</span> <span class="token function">main</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>cpp<span class="token operator">:</span><span class="token number">13</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span> Invalid read of size <span class="token number">4</span>
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span>    at <span class="token number">0x400819</span><span class="token operator">:</span> <span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>cpp<span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span>    by <span class="token number">0x40083F</span><span class="token operator">:</span> <span class="token function">main</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>cpp<span class="token operator">:</span><span class="token number">13</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span>  Address <span class="token number">0x0</span> is <span class="token operator">not</span> stack<span class="token string">'d, malloc'</span>d <span class="token function">or</span> <span class="token punctuation">(</span>recently<span class="token punctuation">)</span> free<span class="token number">'</span>d
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span> Process terminating with <span class="token keyword">default</span> action of signal <span class="token number">11</span> <span class="token punctuation">(</span>SIGSEGV<span class="token punctuation">)</span><span class="token operator">:</span> dumping core
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span>  Access <span class="token operator">not</span> within mapped region at address <span class="token number">0x0</span>
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span>    at <span class="token number">0x400819</span><span class="token operator">:</span> <span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>cpp<span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span>    by <span class="token number">0x40083F</span><span class="token operator">:</span> <span class="token function">main</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>cpp<span class="token operator">:</span><span class="token number">13</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span>  If you believe <span class="token keyword">this</span> happened as a result of a stack
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span>  overflow in your program<span class="token number">'</span>s main <span class="token function">thread</span> <span class="token punctuation">(</span>unlikely but
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span>  possible<span class="token punctuation">)</span><span class="token punctuation">,</span> you can <span class="token keyword">try</span> to increase the size of the
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span>  main thread stack <span class="token keyword">using</span> the <span class="token operator">--</span>main<span class="token operator">-</span>stacksize<span class="token operator">=</span> flag<span class="token punctuation">.</span>
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span>  The main thread stack size used in <span class="token keyword">this</span> run was <span class="token number">8388608.</span>
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span> HEAP SUMMARY<span class="token operator">:</span>
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span>     in use at exit<span class="token operator">:</span> <span class="token number">72</span><span class="token punctuation">,</span><span class="token number">704</span> bytes in <span class="token number">1</span> blocks
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span>   total heap usage<span class="token operator">:</span> <span class="token number">1</span> allocs<span class="token punctuation">,</span> <span class="token number">0</span> frees<span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">,</span><span class="token number">704</span> bytes allocated
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span> LEAK SUMMARY<span class="token operator">:</span>
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span>    definitely lost<span class="token operator">:</span> <span class="token number">0</span> bytes in <span class="token number">0</span> blocks
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span>    indirectly lost<span class="token operator">:</span> <span class="token number">0</span> bytes in <span class="token number">0</span> blocks
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span>      possibly lost<span class="token operator">:</span> <span class="token number">0</span> bytes in <span class="token number">0</span> blocks
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span>    still reachable<span class="token operator">:</span> <span class="token number">72</span><span class="token punctuation">,</span><span class="token number">704</span> bytes in <span class="token number">1</span> blocks
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span>         suppressed<span class="token operator">:</span> <span class="token number">0</span> bytes in <span class="token number">0</span> blocks
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span> Rerun with <span class="token operator">--</span>leak<span class="token operator">-</span>check<span class="token operator">=</span>full to see details of leaked memory
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span> For counts of detected <span class="token operator">and</span> suppressed errors<span class="token punctuation">,</span> rerun with<span class="token operator">:</span> <span class="token operator">-</span>v
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span> Use <span class="token operator">--</span>track<span class="token operator">-</span>origins<span class="token operator">=</span>yes to see where uninitialised values come from
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span> ERROR SUMMARY<span class="token operator">:</span> <span class="token number">2</span> errors from <span class="token number">2</span> <span class="token function">contexts</span> <span class="token punctuation">(</span>suppressed<span class="token operator">:</span> <span class="token number">0</span> from <span class="token number">0</span><span class="token punctuation">)</span>
$

</code></pre></div><p>First we focus on this block:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span> Invalid read of size <span class="token number">4</span>
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span>    at <span class="token number">0x400819</span><span class="token operator">:</span> <span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>cpp<span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span>    by <span class="token number">0x40083F</span><span class="token operator">:</span> <span class="token function">main</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>cpp<span class="token operator">:</span><span class="token number">13</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span>  Address <span class="token number">0x0</span> is <span class="token operator">not</span> stack<span class="token string">'d, malloc'</span>d <span class="token function">or</span> <span class="token punctuation">(</span>recently<span class="token punctuation">)</span> free<span class="token number">'</span>d

</code></pre></div><p>The first line tells us that segfault is caused by reading 4 bytes. The second and the third lines are call stack. It means that the invalid read is performed at the <code>fail()</code> function, line 8 of main.cpp, which is called by main, line 13 of main.cpp.</p> <p>Looking at line 8 of main.cpp we see</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token operator">*</span>p3 <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

</code></pre></div><p>But we check the pointer first, so what's wrong? Lets check the other block:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span> Conditional jump <span class="token operator">or</span> move depends on uninitialised <span class="token function">value</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span>    at <span class="token number">0x400813</span><span class="token operator">:</span> <span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>cpp<span class="token operator">:</span><span class="token number">7</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">8515</span><span class="token operator">==</span>    by <span class="token number">0x40083F</span><span class="token operator">:</span> <span class="token function">main</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>cpp<span class="token operator">:</span><span class="token number">13</span><span class="token punctuation">)</span>

</code></pre></div><p>It tells us that there is an unitialized variable at line 7 and we read it:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>p3<span class="token punctuation">)</span> <span class="token punctuation">{</span>

</code></pre></div><p>Which points us to the line where we check p3 instead of p2. But how is it possible that p3 is uninitialized? We initialize it by:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token operator">*</span>p3 <span class="token operator">=</span> p1<span class="token punctuation">;</span>

</code></pre></div><p>Valgrind advices us to rerun with <code>--track-origins=yes</code>, let's do it:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>valgrind <span class="token operator">--</span>track<span class="token operator">-</span>origins<span class="token operator">=</span>yes <span class="token punctuation">.</span><span class="token operator">/</span>main

</code></pre></div><p>The argument for valgrind is just after valgrind. If we put it after our program, it would be passed to our program.</p> <p>The output is almost the same, there is only one difference:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token operator">==</span><span class="token number">8517</span><span class="token operator">==</span> Conditional jump <span class="token operator">or</span> move depends on uninitialised <span class="token function">value</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">8517</span><span class="token operator">==</span>    at <span class="token number">0x400813</span><span class="token operator">:</span> <span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>cpp<span class="token operator">:</span><span class="token number">7</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">8517</span><span class="token operator">==</span>    by <span class="token number">0x40083F</span><span class="token operator">:</span> <span class="token function">main</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>cpp<span class="token operator">:</span><span class="token number">13</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">8517</span><span class="token operator">==</span>  Uninitialised value was created by a stack allocation
<span class="token operator">==</span><span class="token number">8517</span><span class="token operator">==</span>    at <span class="token number">0x4007F6</span><span class="token operator">:</span> <span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>cpp<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span>

</code></pre></div><p>Which tells us that the uninitialized value we used at line 7 was created at line 3:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token operator">*</span>p1<span class="token punctuation">;</span>

</code></pre></div><p>which guides us to our uninitialized pointer.</p> <h2 id="safe-stack-stack-corruptions"><a href="#safe-stack-stack-corruptions" class="header-anchor">#</a> Safe-stack (Stack corruptions)</h2> <p>Stack corruptions are annoying bugs to look at. As the stack is corrupted, the debugger often can't give you a good stack trace of where you are and how you got there.</p> <p>This is where safe-stack comes into play. Instead of using a single stack for your threads, it will use two: A safe stack and a dangerous stack. The safe stack works exactly like it did before, except that some parts are moved to the dangerous stack.</p> <h3 id="which-parts-of-the-stack-get-moved"><a href="#which-parts-of-the-stack-get-moved" class="header-anchor">#</a> Which parts of the stack get moved?</h3> <p>Every part which has the potential of corrupting the stack will get moved out of the safe stack. As soon as a variable on the stack gets passed by reference or one takes the address of this variable, the compiler will decide to allocate this on the second stack instead of the safe one.</p> <p>As a result, any operation you do with those pointers, any modification you make on the memory (based on those pointers/references) can only effect the memory in the second stack. As one never gets a pointer which is close to the safe stack, the stack cannot corrupt the stack and the debugger can still read all functions on the stack to give a nice trace.</p> <h3 id="what-is-it-actually-used-for"><a href="#what-is-it-actually-used-for" class="header-anchor">#</a> What is it actually used for?</h3> <p>The safe stack was not invented to give you better debugging experience, however, it is a nice side effect for nasty bugs. It's original purpose is as part of the <a href="http://dslab.epfl.ch/proj/cpi/" target="_blank" rel="noopener noreferrer">Code-Pointer Integrity (CPI) Project<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, in which they try to prevent overriding the return addresses to prevent code injection. In other words, they try to prevent executing a hackers code.</p> <p>For this reason, the feature has been activated on chromium and has been <a href="http://linuxplumbersconf.org/2015/ocw//system/presentations/3261/original/Beyond%20Traditional%20Compilation.pdf" target="_blank" rel="noopener noreferrer">reported<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to have a &lt;1% CPU overhead.</p> <h3 id="how-to-enable-it"><a href="#how-to-enable-it" class="header-anchor">#</a> How to enable it?</h3> <p>Right now, the option is only available in the <a href="https://clang.llvm.org/docs/SafeStack.html" target="_blank" rel="noopener noreferrer">clang compiler<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, where one can pass <code>-fsanitize=safe-stack</code> to the compiler. A <a href="https://gcc.gnu.org/ml/gcc/2016-04/msg00083.html" target="_blank" rel="noopener noreferrer">proposal<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> was made to implement the same feature in GCC.</p> <h3 id="conclusion-3"><a href="#conclusion-3" class="header-anchor">#</a> Conclusion</h3> <p>Stack corruptions can become easier to debug when safe stack is enabled. Due to a low performance overhead, you can even activated by default in your build configuration.</p> <h4 id="remarks"><a href="#remarks" class="header-anchor">#</a> Remarks</h4> <p>This topic ain't complete yet, examples on following techniques/tools would be useful:</p> <ul><li>Mention more static analysis tools</li> <li>Binary instrumentation tools (like UBSan, TSan, MSan, ESan ...)</li> <li>Hardening (CFI ...)</li> <li>Fuzzing</li></ul></ul></li></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/cpp/c-debugging-and-debug-prevention-tools-techniques.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/cpp/unit-testing-in-c.html" class="prev">
        Unit Testing in C++
      </a></span> <span class="next"><a href="/cpp/optimization-in-c.html">
        Optimization in C++
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/625.08da53b7.js" defer></script>
  </body>
</html>
