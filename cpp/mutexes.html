<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>C++ | Mutexes</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="std::unique_lock, std::shared_lock, std::lock_guard, Strategies for lock classes: std::try_to_lock, std::adopt_lock, std::defer_lock, std::mutex, std::scoped_lock (C++ 17), Mutex Types, std::lock">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="C++ | Mutexes">
    <meta property="og:description" content="std::unique_lock, std::shared_lock, std::lock_guard, Strategies for lock classes: std::try_to_lock, std::adopt_lock, std::defer_lock, std::mutex, std::scoped_lock (C++ 17), Mutex Types, std::lock">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/cpp/mutexes.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="C++ | Mutexes">
    <meta name="twitter:description" content="std::unique_lock, std::shared_lock, std::lock_guard, Strategies for lock classes: std::try_to_lock, std::adopt_lock, std::defer_lock, std::mutex, std::scoped_lock (C++ 17), Mutex Types, std::lock">
    <meta name="twitter:url" content="/cpp/mutexes.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/679.06e044ba.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>C++</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/cpp/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/cpp/getting-started-with-cpp.html" class="sidebar-link">Getting started with C++</a></li><li><a href="/cpp/literals.html" class="sidebar-link">Literals</a></li><li><a href="/cpp/operator-precedence.html" class="sidebar-link">operator precedence</a></li><li><a href="/cpp/floating-point-arithmetic.html" class="sidebar-link">Floating Point Arithmetic</a></li><li><a href="/cpp/bit-operators.html" class="sidebar-link">Bit Operators</a></li><li><a href="/cpp/bit-manipulation.html" class="sidebar-link">Bit Manipulation</a></li><li><a href="/cpp/bit-fields.html" class="sidebar-link">Bit fields</a></li><li><a href="/cpp/arrays.html" class="sidebar-link">Arrays</a></li><li><a href="/cpp/iterators.html" class="sidebar-link">Iterators</a></li><li><a href="/cpp/basic-input-output-in-c.html" class="sidebar-link">Basic input/output in c++</a></li><li><a href="/cpp/loops.html" class="sidebar-link">Loops</a></li><li><a href="/cpp/file-i-o.html" class="sidebar-link">File I/O</a></li><li><a href="/cpp/cpp-streams.html" class="sidebar-link">C++ Streams</a></li><li><a href="/cpp/stream-manipulators.html" class="sidebar-link">Stream manipulators</a></li><li><a href="/cpp/flow-control.html" class="sidebar-link">Flow Control</a></li><li><a href="/cpp/metaprogramming.html" class="sidebar-link">Metaprogramming</a></li><li><a href="/cpp/const-keyword.html" class="sidebar-link">const keyword</a></li><li><a href="/cpp/mutable-keyword.html" class="sidebar-link">mutable keyword</a></li><li><a href="/cpp/friend-keyword.html" class="sidebar-link">Friend keyword</a></li><li><a href="/cpp/type-keywords.html" class="sidebar-link">Type Keywords</a></li><li><a href="/cpp/basic-type-keywords.html" class="sidebar-link">Basic Type Keywords</a></li><li><a href="/cpp/variable-declaration-keywords.html" class="sidebar-link">Variable Declaration Keywords</a></li><li><a href="/cpp/keywords.html" class="sidebar-link">Keywords</a></li><li><a href="/cpp/returning-several-values-from-a-function.html" class="sidebar-link">Returning several values from a function</a></li><li><a href="/cpp/polymorphism.html" class="sidebar-link">Polymorphism</a></li><li><a href="/cpp/references.html" class="sidebar-link">References</a></li><li><a href="/cpp/value-and-reference-semantics.html" class="sidebar-link">Value and Reference Semantics</a></li><li><a href="/cpp/c-function-call-by-value-vs-call-by-reference.html" class="sidebar-link">C++ function &quot;call by value&quot; vs. &quot;call by reference&quot;</a></li><li><a href="/cpp/copying-vs-assignment.html" class="sidebar-link">Copying vs Assignment</a></li><li><a href="/cpp/pointers.html" class="sidebar-link">Pointers</a></li><li><a href="/cpp/pointers-to-members.html" class="sidebar-link">Pointers to members</a></li><li><a href="/cpp/the-this-pointer.html" class="sidebar-link">The This Pointer</a></li><li><a href="/cpp/smart-pointers.html" class="sidebar-link">Smart Pointers</a></li><li><a href="/cpp/classes-structures.html" class="sidebar-link">Classes/Structures</a></li><li><a href="/cpp/function-overloading.html" class="sidebar-link">Function Overloading</a></li><li><a href="/cpp/operator-overloading.html" class="sidebar-link">Operator Overloading</a></li><li><a href="/cpp/function-template-overloading.html" class="sidebar-link">Function Template Overloading</a></li><li><a href="/cpp/virtual-member-functions.html" class="sidebar-link">Virtual Member Functions</a></li><li><a href="/cpp/inline-functions.html" class="sidebar-link">Inline functions</a></li><li><a href="/cpp/special-member-functions.html" class="sidebar-link">Special Member Functions</a></li><li><a href="/cpp/non-static-member-functions.html" class="sidebar-link">Non-Static Member Functions</a></li><li><a href="/cpp/constant-class-member-functions.html" class="sidebar-link">Constant class member functions</a></li><li><a href="/cpp/c-containers.html" class="sidebar-link">C++ Containers</a></li><li><a href="/cpp/namespaces.html" class="sidebar-link">Namespaces</a></li><li><a href="/cpp/header-files.html" class="sidebar-link">Header Files</a></li><li><a href="/cpp/using-declaration.html" class="sidebar-link">Using declaration</a></li><li><a href="/cpp/std-string.html" class="sidebar-link">std::string</a></li><li><a href="/cpp/std-array.html" class="sidebar-link">std::array</a></li><li><a href="/cpp/std-vector.html" class="sidebar-link">std::vector</a></li><li><a href="/cpp/std-map.html" class="sidebar-link">std::map</a></li><li><a href="/cpp/std-optional.html" class="sidebar-link">std::optional</a></li><li><a href="/cpp/std-function-to-wrap-any-element-that-is-callable.html" class="sidebar-link">std::function: To wrap any element that is callable</a></li><li><a href="/cpp/std-forward-list.html" class="sidebar-link">std::forward_list</a></li><li><a href="/cpp/std-pair.html" class="sidebar-link">std::pair</a></li><li><a href="/cpp/std-atomics.html" class="sidebar-link">std::atomics</a></li><li><a href="/cpp/std-variant.html" class="sidebar-link">std::variant</a></li><li><a href="/cpp/std-iomanip.html" class="sidebar-link">std::iomanip</a></li><li><a href="/cpp/std-any.html" class="sidebar-link">std::any</a></li><li><a href="/cpp/std-set-and-std-multiset.html" class="sidebar-link">std::set and std::multiset</a></li><li><a href="/cpp/std-integer-sequence.html" class="sidebar-link">std::integer_sequence</a></li><li><a href="/cpp/using-std-unordered-map.html" class="sidebar-link">Using std::unordered_map</a></li><li><a href="/cpp/standard-library-algorithms.html" class="sidebar-link">Standard Library Algorithms</a></li><li><a href="/cpp/the-iso-c-standard.html" class="sidebar-link">The ISO C++ Standard</a></li><li><a href="/cpp/inline-variables.html" class="sidebar-link">Inline variables</a></li><li><a href="/cpp/random-number-generation.html" class="sidebar-link">Random number generation</a></li><li><a href="/cpp/date-and-time-using-chrono-header.html" class="sidebar-link">Date and time using  header</a></li><li><a href="/cpp/sorting.html" class="sidebar-link">Sorting</a></li><li><a href="/cpp/enumeration.html" class="sidebar-link">Enumeration</a></li><li><a href="/cpp/iteration.html" class="sidebar-link">Iteration</a></li><li><a href="/cpp/regular-expressions.html" class="sidebar-link">Regular expressions</a></li><li><a href="/cpp/implementation-defined-behavior.html" class="sidebar-link">Implementation-defined behavior</a></li><li><a href="/cpp/exceptions.html" class="sidebar-link">Exceptions</a></li><li><a href="/cpp/lambdas.html" class="sidebar-link">Lambdas</a></li><li><a href="/cpp/value-categories.html" class="sidebar-link">Value Categories</a></li><li><a href="/cpp/preprocessor.html" class="sidebar-link">Preprocessor</a></li><li><a href="/cpp/data-structures-in-c.html" class="sidebar-link">Data Structures in C++</a></li><li><a href="/cpp/templates.html" class="sidebar-link">Templates</a></li><li><a href="/cpp/expression-templates.html" class="sidebar-link">Expression templates</a></li><li><a href="/cpp/curiously-recurring-template-pattern-crtp.html" class="sidebar-link">Curiously Recurring Template Pattern (CRTP)</a></li><li><a href="/cpp/threading.html" class="sidebar-link">Threading</a></li><li><a href="/cpp/thread-synchronization-structures.html" class="sidebar-link">Thread synchronization structures</a></li><li><a href="/cpp/the-rule-of-three-five-and-zero.html" class="sidebar-link">The Rule of Three, Five, And Zero</a></li><li><a href="/cpp/raii-resource-acquisition-is-initialization.html" class="sidebar-link">RAII: Resource Acquisition Is Initialization</a></li><li><a href="/cpp/rtti-run-time-type-information.html" class="sidebar-link">RTTI: Run-Time Type Information</a></li><li><a href="/cpp/mutexes.html" aria-current="page" class="active sidebar-link">Mutexes</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cpp/mutexes.html#std-unique-lock-std-shared-lock-std-lock-guard" class="sidebar-link">std::uniquelock, std::sharedlock, std::lock_guard</a></li><li class="sidebar-sub-header"><a href="/cpp/mutexes.html#strategies-for-lock-classes-std-try-to-lock-std-adopt-lock-std-defer-lock" class="sidebar-link">Strategies for lock classes: std::trytolock, std::adoptlock, std::deferlock</a></li><li class="sidebar-sub-header"><a href="/cpp/mutexes.html#std-mutex" class="sidebar-link">std::mutex</a></li><li class="sidebar-sub-header"><a href="/cpp/mutexes.html#std-scoped-lock-c-17" class="sidebar-link">std::scoped_lock (C++ 17)</a></li><li class="sidebar-sub-header"><a href="/cpp/mutexes.html#mutex-types" class="sidebar-link">Mutex Types</a></li><li class="sidebar-sub-header"><a href="/cpp/mutexes.html#std-lock" class="sidebar-link">std::lock</a></li></ul></li><li><a href="/cpp/recursive-mutex.html" class="sidebar-link">Recursive Mutex</a></li><li><a href="/cpp/semaphore.html" class="sidebar-link">Semaphore</a></li><li><a href="/cpp/futures-and-promises.html" class="sidebar-link">Futures and Promises</a></li><li><a href="/cpp/atomic-types.html" class="sidebar-link">Atomic Types</a></li><li><a href="/cpp/type-erasure.html" class="sidebar-link">Type Erasure</a></li><li><a href="/cpp/explicit-type-conversions.html" class="sidebar-link">Explicit type conversions</a></li><li><a href="/cpp/unnamed-types.html" class="sidebar-link">Unnamed types</a></li><li><a href="/cpp/type-traits.html" class="sidebar-link">Type Traits</a></li><li><a href="/cpp/return-type-covariance.html" class="sidebar-link">Return Type Covariance</a></li><li><a href="/cpp/layout-of-object-types.html" class="sidebar-link">Layout of object types</a></li><li><a href="/cpp/type-inference.html" class="sidebar-link">Type Inference</a></li><li><a href="/cpp/typedef-and-type-aliases.html" class="sidebar-link">Typedef and type aliases</a></li><li><a href="/cpp/type-deduction.html" class="sidebar-link">type deduction</a></li><li><a href="/cpp/trailing-return-type.html" class="sidebar-link">Trailing return type</a></li><li><a href="/cpp/alignment.html" class="sidebar-link">Alignment</a></li><li><a href="/cpp/perfect-forwarding.html" class="sidebar-link">Perfect Forwarding</a></li><li><a href="/cpp/decltype.html" class="sidebar-link">decltype</a></li><li><a href="/cpp/sfinae-substitution-failure-is-not-an-error.html" class="sidebar-link">SFINAE (Substitution Failure Is Not An Error)</a></li><li><a href="/cpp/undefined-behavior.html" class="sidebar-link">Undefined Behavior</a></li><li><a href="/cpp/overload-resolution.html" class="sidebar-link">Overload resolution</a></li><li><a href="/cpp/move-semantics.html" class="sidebar-link">Move Semantics</a></li><li><a href="/cpp/pimpl-idiom.html" class="sidebar-link">Pimpl Idiom</a></li><li><a href="/cpp/auto.html" class="sidebar-link">auto</a></li><li><a href="/cpp/copy-elision.html" class="sidebar-link">Copy Elision</a></li><li><a href="/cpp/fold-expressions.html" class="sidebar-link">Fold Expressions</a></li><li><a href="/cpp/unions.html" class="sidebar-link">Unions</a></li><li><a href="/cpp/design-pattern-implementation-in-c.html" class="sidebar-link">Design pattern implementation in C++</a></li><li><a href="/cpp/singleton-design-pattern.html" class="sidebar-link">Singleton Design Pattern</a></li><li><a href="/cpp/user-defined-literals.html" class="sidebar-link">User-Defined Literals</a></li><li><a href="/cpp/memory-management.html" class="sidebar-link">Memory management</a></li><li><a href="/cpp/c-11-memory-model.html" class="sidebar-link">C++11 Memory Model</a></li><li><a href="/cpp/scopes.html" class="sidebar-link">Scopes</a></li><li><a href="/cpp/static-assert.html" class="sidebar-link">static_assert</a></li><li><a href="/cpp/constexpr.html" class="sidebar-link">constexpr</a></li><li><a href="/cpp/one-definition-rule-odr.html" class="sidebar-link">One Definition Rule (ODR)</a></li><li><a href="/cpp/unspecified-behavior.html" class="sidebar-link">Unspecified behavior</a></li><li><a href="/cpp/argument-dependent-name-lookup.html" class="sidebar-link">Argument Dependent Name Lookup</a></li><li><a href="/cpp/attributes.html" class="sidebar-link">Attributes</a></li><li><a href="/cpp/recursion-in-c.html" class="sidebar-link">Recursion in C++</a></li><li><a href="/cpp/arithmitic-metaprogramming.html" class="sidebar-link">Arithmitic Metaprogramming</a></li><li><a href="/cpp/callable-objects.html" class="sidebar-link">Callable Objects</a></li><li><a href="/cpp/client-server-examples.html" class="sidebar-link">Client server examples</a></li><li><a href="/cpp/const-correctness.html" class="sidebar-link">Const Correctness</a></li><li><a href="/cpp/parameter-packs.html" class="sidebar-link">Parameter packs</a></li><li><a href="/cpp/build-systems.html" class="sidebar-link">Build Systems</a></li><li><a href="/cpp/concurrency-with-openmp.html" class="sidebar-link">Concurrency With OpenMP</a></li><li><a href="/cpp/resource-management.html" class="sidebar-link">Resource Management</a></li><li><a href="/cpp/storage-class-specifiers.html" class="sidebar-link">Storage class specifiers</a></li><li><a href="/cpp/linkage-specifications.html" class="sidebar-link">Linkage specifications</a></li><li><a href="/cpp/digit-separators.html" class="sidebar-link">Digit separators</a></li><li><a href="/cpp/c-incompatibilities.html" class="sidebar-link">C incompatibilities</a></li><li><a href="/cpp/side-by-side-comparisons-of-classic-c-examples-solved-via-c-vs-c-11-vs-c-14-vs-c-17.html" class="sidebar-link">Side by Side Comparisons of classic C++ examples solved via C++ vs C++11 vs C++14 vs C++17</a></li><li><a href="/cpp/compiling-and-building.html" class="sidebar-link">Compiling and Building</a></li><li><a href="/cpp/common-compile-linker-errors-gcc.html" class="sidebar-link">Common compile/linker errors (GCC)</a></li><li><a href="/cpp/more-undefined-behaviors-in-c.html" class="sidebar-link">More undefined behaviors in C++</a></li><li><a href="/cpp/unit-testing-in-c.html" class="sidebar-link">Unit Testing in C++</a></li><li><a href="/cpp/c-debugging-and-debug-prevention-tools-techniques.html" class="sidebar-link">C++ Debugging and Debug-prevention Tools &amp; Techniques</a></li><li><a href="/cpp/optimization-in-c.html" class="sidebar-link">Optimization in C++</a></li><li><a href="/cpp/optimization.html" class="sidebar-link">Optimization</a></li><li><a href="/cpp/profiling.html" class="sidebar-link">Profiling</a></li><li><a href="/cpp/refactoring-techniques.html" class="sidebar-link">Refactoring Techniques</a></li><li><a href="/cpp/internationalization-in-c.html" class="sidebar-link">Internationalization in C++</a></li><li><a href="/cpp/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mutexes"><a href="#mutexes" class="header-anchor">#</a> Mutexes</h1> <h2 id="std-unique-lock-std-shared-lock-std-lock-guard"><a href="#std-unique-lock-std-shared-lock-std-lock-guard" class="header-anchor">#</a> std::unique_lock, std::shared_lock, std::lock_guard</h2> <p>Used for the RAII style acquiring  of try locks, timed try locks and recursive locks.</p> <p><code>std::unique_lock</code> allows for exclusive ownership of mutexes.</p> <p><code>std::shared_lock</code> allows for shared ownership of mutexes. Several threads can hold <code>std::shared_locks</code> on a <code>std::shared_mutex</code>. Available from C++ 14.</p> <p><code>std::lock_guard</code> is a lightweight alternative to <code>std::unique_lock</code> and <code>std::shared_lock</code>.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unordered_map&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;mutex&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;shared_mutex&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;thread&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

<span class="token keyword">class</span> <span class="token class-name">PhoneBook</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    std<span class="token double-colon punctuation">::</span>string <span class="token function">getPhoneNo</span><span class="token punctuation">(</span> <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string <span class="token operator">&amp;</span> name <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>shared_lock<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>shared_timed_mutex<span class="token operator">&gt;</span> <span class="token function">l</span><span class="token punctuation">(</span>_protect<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">auto</span> it <span class="token operator">=</span>  _phonebook<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span> name <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> it <span class="token operator">!=</span> _phonebook<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">*</span>it<span class="token punctuation">)</span><span class="token punctuation">.</span>second<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">void</span> <span class="token function">addPhoneNo</span> <span class="token punctuation">(</span> <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string <span class="token operator">&amp;</span> name<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string <span class="token operator">&amp;</span> phone <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>unique_lock<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>shared_timed_mutex<span class="token operator">&gt;</span> <span class="token function">l</span><span class="token punctuation">(</span>_protect<span class="token punctuation">)</span><span class="token punctuation">;</span>
        _phonebook<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> phone<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    std<span class="token double-colon punctuation">::</span>shared_timed_mutex _protect<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>unordered_map<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token punctuation">,</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&gt;</span>  _phonebook<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="strategies-for-lock-classes-std-try-to-lock-std-adopt-lock-std-defer-lock"><a href="#strategies-for-lock-classes-std-try-to-lock-std-adopt-lock-std-defer-lock" class="header-anchor">#</a> Strategies for lock classes: std::try_to_lock, std::adopt_lock, std::defer_lock</h2> <p>When creating a std::unique_lock, there are three different locking strategies to choose from: <code>std::try_to_lock</code>, <code>std::defer_lock</code> and <code>std::adopt_lock</code></p> <ol><li><code>std::try_to_lock</code> allows for trying a lock without blocking:</li></ol> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>atomic_int temp <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>mutex _mutex<span class="token punctuation">;</span>
    
    std<span class="token double-colon punctuation">::</span>thread <span class="token function">t</span><span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        
        <span class="token keyword">while</span><span class="token punctuation">(</span> temp<span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            std<span class="token double-colon punctuation">::</span>this_thread<span class="token double-colon punctuation">::</span><span class="token function">sleep_for</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>chrono<span class="token double-colon punctuation">::</span><span class="token function">seconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            std<span class="token double-colon punctuation">::</span>unique_lock<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">&gt;</span> <span class="token function">lock</span><span class="token punctuation">(</span> _mutex<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>try_to_lock<span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token keyword">if</span><span class="token punctuation">(</span>lock<span class="token punctuation">.</span><span class="token function">owns_lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">//do something</span>
                temp<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token boolean">true</span> <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>this_thread<span class="token double-colon punctuation">::</span><span class="token function">sleep_for</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>chrono<span class="token double-colon punctuation">::</span><span class="token function">seconds</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span>unique_lock<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">&gt;</span> <span class="token function">lock</span><span class="token punctuation">(</span> _mutex<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>try_to_lock<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>lock<span class="token punctuation">.</span><span class="token function">owns_lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>temp <span class="token operator">&lt;</span> INT_MAX<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token operator">++</span>temp<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> temp <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><li>`std::defer_lock` allows for creating a lock structure without acquiring the lock. When locking more than one mutex, there is  a window of
opportunity for a deadlock if two function callers try to acquire the
locks at the same time:</li> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>unique_lock<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">&gt;</span> <span class="token function">lock1</span><span class="token punctuation">(</span>_mutex1<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>defer_lock<span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>unique_lock<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">&gt;</span> <span class="token function">lock2</span><span class="token punctuation">(</span>_mutex2<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>defer_lock<span class="token punctuation">)</span><span class="token punctuation">;</span>
    lock1<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    lock2<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// deadlock here</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> &quot;Locked<span class="token operator">!</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span>

</code></pre></div><p>With the following code, whatever happens in
the function, the locks are acquired and released in appropriate order:</p> <div class="language- extra-class"><pre class="language-text"><code>
  {
       std::unique_lock&lt;std::mutex&gt; lock1(_mutex1, std::defer_lock);
       std::unique_lock&lt;std::mutex&gt; lock2(_mutex2, std::defer_lock);
       std::lock(lock1,lock2); // no deadlock possible
       std::cout &lt;&lt; &quot;Locked! &lt;&lt; std::endl;
       //...
       
   }

</code></pre></div><ol><li><code>std::adopt_lock</code> does not attempt to lock a second time if the calling thread currently owns the lock.</li></ol> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>unique_lock<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">&gt;</span> <span class="token function">lock1</span><span class="token punctuation">(</span>_mutex1<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>adopt_lock<span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>unique_lock<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">&gt;</span> <span class="token function">lock2</span><span class="token punctuation">(</span>_mutex2<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>adopt_lock<span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> &quot;Locked<span class="token operator">!</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span>

</code></pre></div><p>Something to keep in mind is that std::adopt_lock is not a substitute for  recursive mutex usage. When the lock goes out of scope the mutex is <strong>released</strong>.</p> <h2 id="std-mutex"><a href="#std-mutex" class="header-anchor">#</a> std::mutex</h2> <p>std::mutex is a simple, non-recursive synchronization structure that is used to protect data which is accessed by multiple threads.</p> <div class="language- extra-class"><pre class="language-text"><code>
   std::atomic_int temp{0};
    std::mutex _mutex;
    
    std::thread t( [&amp;](){
                      
                      while( temp!= -1){
                          std::this_thread::sleep_for(std::chrono::seconds(5));
                          std::unique_lock&lt;std::mutex&gt; lock( _mutex);
                          
                              temp=0;
                      }
                  });
    
    
    while ( true )
    {
        std::this_thread::sleep_for(std::chrono::milliseconds(1));
        std::unique_lock&lt;std::mutex&gt; lock( _mutex, std::try_to_lock);
        if ( temp &lt; INT_MAX )
            temp++;
        cout &lt;&lt; temp &lt;&lt; endl;
        
    }

</code></pre></div><h2 id="std-scoped-lock-c-17"><a href="#std-scoped-lock-c-17" class="header-anchor">#</a> std::scoped_lock (C++ 17)</h2> <p><code>std::scoped_lock</code> provides RAII style semantics for owning one more mutexes, combined with the lock avoidance algorithms used by <code>std::lock</code>. When <code>std::scoped_lock</code> is destroyed, mutexes are released in the reverse order from which they where acquired.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>scoped_lock lock<span class="token punctuation">{</span>_mutex1<span class="token punctuation">,</span>_mutex2<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">//do something</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="mutex-types"><a href="#mutex-types" class="header-anchor">#</a> Mutex Types</h2> <p>C++1x offers a selection of mutex classes:</p> <ul><li><a href="http://stackoverflow.com/documentation/c%2B%2B/9895/mutexes/30441/stdmutex#t=201705100643590643715" target="_blank" rel="noopener noreferrer">std::mutex<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - offers simple locking functionality.</li> <li>std::timed_mutex - offers try_to_lock functionality</li> <li><a href="http://stackoverflow.com/documentation/c%2B%2B/9929/recursive-mutex/30442/stdrecursive-mutex#t=201705100822554334632" target="_blank" rel="noopener noreferrer">std::recursive_mutex<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - allows recursive locking by the same thread.</li> <li>std::shared_mutex, std::shared_timed_mutex - offers shared and unique lock functionality.</li></ul> <h2 id="std-lock"><a href="#std-lock" class="header-anchor">#</a> std::lock</h2> <p><code>std::lock</code> uses deadlock avoidance algorithms to lock one or more mutexes. If an exception is thrown during a call to lock multiple objects, <code>std::lock</code> unlocks the successfully locked objects before re-throwing the exception.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>std<span class="token double-colon punctuation">::</span><span class="token function">lock</span><span class="token punctuation">(</span>_mutex1<span class="token punctuation">,</span> _mutex2<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h4 id="remarks"><a href="#remarks" class="header-anchor">#</a> Remarks</h4> <h3 id="it-is-better-to-use-std-shared-mutex-than-std-shared-timed-mutex"><a href="#it-is-better-to-use-std-shared-mutex-than-std-shared-timed-mutex" class="header-anchor">#</a> It is better to use <strong>std::shared_mutex</strong> than <strong>std::shared_timed_mutex</strong>.</h3> <p><strong>The performance difference is more than double.</strong></p> <p>If you want to use RWLock, you will find that there are two options.<br>
It is std::shared_mutex and shared_timed_mutex.<br>
you may think std::shared_timed_mutex is just the version 'std::shared_mutex + time method'.</p> <p><strong>But the implementation is totally different.</strong></p> <h3 id="the-code-below-is-msvc14-1-implementation-of-std-shared-mutex"><a href="#the-code-below-is-msvc14-1-implementation-of-std-shared-mutex" class="header-anchor">#</a> The code below is MSVC14.1 implementation of std::shared_mutex.</h3> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">class</span> <span class="token class-name">shared_mutex</span>
<span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span> 
<span class="token keyword">typedef</span> _Smtx_t <span class="token operator">*</span> native_handle_type<span class="token punctuation">;</span>

<span class="token function">shared_mutex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> _NOEXCEPT
    <span class="token operator">:</span> <span class="token function">_Myhandle</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>    <span class="token comment">// default construct</span>
    <span class="token punctuation">}</span>

<span class="token operator">~</span><span class="token function">shared_mutex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> _NOEXCEPT
    <span class="token punctuation">{</span>    <span class="token comment">// destroy the object</span>
    <span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> _NOEXCEPT
    <span class="token punctuation">{</span>    <span class="token comment">// lock exclusive</span>
    <span class="token function">_Smtx_lock_exclusive</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>_Myhandle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token keyword">bool</span> <span class="token function">try_lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> _NOEXCEPT
    <span class="token punctuation">{</span>    <span class="token comment">// try to lock exclusive</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">_Smtx_try_lock_exclusive</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>_Myhandle<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> _NOEXCEPT
    <span class="token punctuation">{</span>    <span class="token comment">// unlock exclusive</span>
    <span class="token function">_Smtx_unlock_exclusive</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>_Myhandle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">lock_shared</span><span class="token punctuation">(</span><span class="token punctuation">)</span> _NOEXCEPT
    <span class="token punctuation">{</span>    <span class="token comment">// lock non-exclusive</span>
    <span class="token function">_Smtx_lock_shared</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>_Myhandle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token keyword">bool</span> <span class="token function">try_lock_shared</span><span class="token punctuation">(</span><span class="token punctuation">)</span> _NOEXCEPT
    <span class="token punctuation">{</span>    <span class="token comment">// try to lock non-exclusive</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">_Smtx_try_lock_shared</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>_Myhandle<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">unlock_shared</span><span class="token punctuation">(</span><span class="token punctuation">)</span> _NOEXCEPT
    <span class="token punctuation">{</span>    <span class="token comment">// unlock non-exclusive</span>
    <span class="token function">_Smtx_unlock_shared</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>_Myhandle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

native_handle_type <span class="token function">native_handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> _NOEXCEPT
    <span class="token punctuation">{</span>    <span class="token comment">// get native handle</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>_Myhandle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token function">shared_mutex</span><span class="token punctuation">(</span><span class="token keyword">const</span> shared_mutex<span class="token operator">&amp;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span>
shared_mutex<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> shared_mutex<span class="token operator">&amp;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span>
<span class="token keyword">private</span><span class="token operator">:</span> 
    _Smtx_t _Myhandle<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> __cdecl <span class="token function">_Smtx_lock_exclusive</span><span class="token punctuation">(</span>_Smtx_t <span class="token operator">*</span> smtx<span class="token punctuation">)</span>
<span class="token punctuation">{</span>    <span class="token comment">/* lock shared mutex exclusively */</span>
<span class="token function">AcquireSRWLockExclusive</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">reinterpret_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>PSRWLOCK<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>smtx<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> __cdecl <span class="token function">_Smtx_lock_shared</span><span class="token punctuation">(</span>_Smtx_t <span class="token operator">*</span> smtx<span class="token punctuation">)</span>
<span class="token punctuation">{</span>    <span class="token comment">/* lock shared mutex non-exclusively */</span>
<span class="token function">AcquireSRWLockShared</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">reinterpret_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>PSRWLOCK<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>smtx<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> __cdecl <span class="token function">_Smtx_try_lock_exclusive</span><span class="token punctuation">(</span>_Smtx_t <span class="token operator">*</span> smtx<span class="token punctuation">)</span>
<span class="token punctuation">{</span>    <span class="token comment">/* try to lock shared mutex exclusively */</span>
<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">TryAcquireSRWLockExclusive</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">reinterpret_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>PSRWLOCK<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>smtx<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> __cdecl <span class="token function">_Smtx_try_lock_shared</span><span class="token punctuation">(</span>_Smtx_t <span class="token operator">*</span> smtx<span class="token punctuation">)</span>
<span class="token punctuation">{</span>    <span class="token comment">/* try to lock shared mutex non-exclusively */</span>
<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">TryAcquireSRWLockShared</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">reinterpret_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>PSRWLOCK<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>smtx<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> __cdecl <span class="token function">_Smtx_unlock_exclusive</span><span class="token punctuation">(</span>_Smtx_t <span class="token operator">*</span> smtx<span class="token punctuation">)</span>
<span class="token punctuation">{</span>    <span class="token comment">/* unlock exclusive shared mutex */</span>
<span class="token function">ReleaseSRWLockExclusive</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">reinterpret_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>PSRWLOCK<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>smtx<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> __cdecl <span class="token function">_Smtx_unlock_shared</span><span class="token punctuation">(</span>_Smtx_t <span class="token operator">*</span> smtx<span class="token punctuation">)</span>
<span class="token punctuation">{</span>    <span class="token comment">/* unlock non-exclusive shared mutex */</span>
<span class="token function">ReleaseSRWLockShared</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">reinterpret_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>PSRWLOCK<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>smtx<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>You can see that std::shared_mutex is implemented in Windows Slim Reader/Write Locks(<a href="https://msdn.microsoft.com/ko-kr/library/windows/desktop/aa904937(v=vs.85).aspx" target="_blank" rel="noopener noreferrer">https://msdn.microsoft.com/ko-kr/library/windows/desktop/aa904937(v=vs.85).aspx)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)</p> <p>Now Let's look at the implementation of std::shared_timed_mutex.</p> <h3 id="the-code-below-is-msvc14-1-implementation-of-std-shared-timed-mutex"><a href="#the-code-below-is-msvc14-1-implementation-of-std-shared-timed-mutex" class="header-anchor">#</a> The code below is MSVC14.1 implementation of std::shared_timed_mutex.</h3> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">class</span> <span class="token class-name">shared_timed_mutex</span>
<span class="token punctuation">{</span>
<span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> _Read_cnt_t<span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">constexpr</span> _Read_cnt_t _Max_readers <span class="token operator">=</span> <span class="token function">_Read_cnt_t</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
<span class="token function">shared_timed_mutex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> _NOEXCEPT
    <span class="token operator">:</span> <span class="token function">_Mymtx</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_Read_queue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_Write_queue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">_Readers</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_Writing</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>    <span class="token comment">// default construct</span>
    <span class="token punctuation">}</span>

<span class="token operator">~</span><span class="token function">shared_timed_mutex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> _NOEXCEPT
    <span class="token punctuation">{</span>    <span class="token comment">// destroy the object</span>
    <span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>    <span class="token comment">// lock exclusive</span>
    unique_lock<span class="token operator">&lt;</span>mutex<span class="token operator">&gt;</span> <span class="token function">_Lock</span><span class="token punctuation">(</span>_Mymtx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>_Writing<span class="token punctuation">)</span>
        _Write_queue<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span>_Lock<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _Writing <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;</span> _Readers<span class="token punctuation">)</span>
        _Read_queue<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span>_Lock<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// wait for writing, no readers</span>
    <span class="token punctuation">}</span>

<span class="token keyword">bool</span> <span class="token function">try_lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>    <span class="token comment">// try to lock exclusive</span>
    lock_guard<span class="token operator">&lt;</span>mutex<span class="token operator">&gt;</span> <span class="token function">_Lock</span><span class="token punctuation">(</span>_Mymtx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_Writing <span class="token operator">||</span> <span class="token number">0</span> <span class="token operator">&lt;</span> _Readers<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token punctuation">{</span>    <span class="token comment">// set writing, no readers</span>
        _Writing <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">_Rep</span><span class="token punctuation">,</span>
    <span class="token keyword">class</span> <span class="token class-name">_Period</span><span class="token operator">&gt;</span>
    <span class="token keyword">bool</span> <span class="token function">try_lock_for</span><span class="token punctuation">(</span>
        <span class="token keyword">const</span> chrono<span class="token double-colon punctuation">::</span>duration<span class="token operator">&lt;</span>_Rep<span class="token punctuation">,</span> _Period<span class="token operator">&gt;</span><span class="token operator">&amp;</span> _Rel_time<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>    <span class="token comment">// try to lock for duration</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">try_lock_until</span><span class="token punctuation">(</span>chrono<span class="token double-colon punctuation">::</span>steady_clock<span class="token double-colon punctuation">::</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> _Rel_time<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">_Clock</span><span class="token punctuation">,</span>
    <span class="token keyword">class</span> <span class="token class-name">_Duration</span><span class="token operator">&gt;</span>
    <span class="token keyword">bool</span> <span class="token function">try_lock_until</span><span class="token punctuation">(</span>
        <span class="token keyword">const</span> chrono<span class="token double-colon punctuation">::</span>time_point<span class="token operator">&lt;</span>_Clock<span class="token punctuation">,</span> _Duration<span class="token operator">&gt;</span><span class="token operator">&amp;</span> _Abs_time<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>    <span class="token comment">// try to lock until time point</span>
    <span class="token keyword">auto</span> _Not_writing <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">!</span>_Writing<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">auto</span> _Zero_readers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">(</span>_Readers <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    unique_lock<span class="token operator">&lt;</span>mutex<span class="token operator">&gt;</span> <span class="token function">_Lock</span><span class="token punctuation">(</span>_Mymtx<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_Write_queue<span class="token punctuation">.</span><span class="token function">wait_until</span><span class="token punctuation">(</span>_Lock<span class="token punctuation">,</span> _Abs_time<span class="token punctuation">,</span> _Not_writing<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    _Writing <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_Read_queue<span class="token punctuation">.</span><span class="token function">wait_until</span><span class="token punctuation">(</span>_Lock<span class="token punctuation">,</span> _Abs_time<span class="token punctuation">,</span> _Zero_readers<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>    <span class="token comment">// timeout, leave writing state</span>
        _Writing <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        _Lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// unlock before notifying, for efficiency</span>
        _Write_queue<span class="token punctuation">.</span><span class="token function">notify_all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>    <span class="token comment">// unlock exclusive</span>
        <span class="token punctuation">{</span>    <span class="token comment">// unlock before notifying, for efficiency</span>
        lock_guard<span class="token operator">&lt;</span>mutex<span class="token operator">&gt;</span> <span class="token function">_Lock</span><span class="token punctuation">(</span>_Mymtx<span class="token punctuation">)</span><span class="token punctuation">;</span>

        _Writing <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    _Write_queue<span class="token punctuation">.</span><span class="token function">notify_all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">lock_shared</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>    <span class="token comment">// lock non-exclusive</span>
    unique_lock<span class="token operator">&lt;</span>mutex<span class="token operator">&gt;</span> <span class="token function">_Lock</span><span class="token punctuation">(</span>_Mymtx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>_Writing <span class="token operator">||</span> _Readers <span class="token operator">==</span> _Max_readers<span class="token punctuation">)</span>
        _Write_queue<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span>_Lock<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">++</span>_Readers<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token keyword">bool</span> <span class="token function">try_lock_shared</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>    <span class="token comment">// try to lock non-exclusive</span>
    lock_guard<span class="token operator">&lt;</span>mutex<span class="token operator">&gt;</span> <span class="token function">_Lock</span><span class="token punctuation">(</span>_Mymtx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_Writing <span class="token operator">||</span> _Readers <span class="token operator">==</span> _Max_readers<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token punctuation">{</span>    <span class="token comment">// count another reader</span>
        <span class="token operator">++</span>_Readers<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">_Rep</span><span class="token punctuation">,</span>
    <span class="token keyword">class</span> <span class="token class-name">_Period</span><span class="token operator">&gt;</span>
    <span class="token keyword">bool</span> <span class="token function">try_lock_shared_for</span><span class="token punctuation">(</span>
        <span class="token keyword">const</span> chrono<span class="token double-colon punctuation">::</span>duration<span class="token operator">&lt;</span>_Rep<span class="token punctuation">,</span> _Period<span class="token operator">&gt;</span><span class="token operator">&amp;</span> _Rel_time<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>    <span class="token comment">// try to lock non-exclusive for relative time</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">try_lock_shared_until</span><span class="token punctuation">(</span>_Rel_time
        <span class="token operator">+</span> chrono<span class="token double-colon punctuation">::</span>steady_clock<span class="token double-colon punctuation">::</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">_Time</span><span class="token operator">&gt;</span>
    <span class="token keyword">bool</span> <span class="token function">_Try_lock_shared_until</span><span class="token punctuation">(</span>_Time _Abs_time<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>    <span class="token comment">// try to lock non-exclusive until absolute time</span>
    <span class="token keyword">auto</span> _Can_acquire <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">!</span>_Writing <span class="token operator">&amp;&amp;</span> _Readers <span class="token operator">&lt;</span> _Max_readers<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

    unique_lock<span class="token operator">&lt;</span>mutex<span class="token operator">&gt;</span> <span class="token function">_Lock</span><span class="token punctuation">(</span>_Mymtx<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_Write_queue<span class="token punctuation">.</span><span class="token function">wait_until</span><span class="token punctuation">(</span>_Lock<span class="token punctuation">,</span> _Abs_time<span class="token punctuation">,</span> _Can_acquire<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token operator">++</span>_Readers<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">_Clock</span><span class="token punctuation">,</span>
    <span class="token keyword">class</span> <span class="token class-name">_Duration</span><span class="token operator">&gt;</span>
    <span class="token keyword">bool</span> <span class="token function">try_lock_shared_until</span><span class="token punctuation">(</span>
        <span class="token keyword">const</span> chrono<span class="token double-colon punctuation">::</span>time_point<span class="token operator">&lt;</span>_Clock<span class="token punctuation">,</span> _Duration<span class="token operator">&gt;</span><span class="token operator">&amp;</span> _Abs_time<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>    <span class="token comment">// try to lock non-exclusive until absolute time</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">_Try_lock_shared_until</span><span class="token punctuation">(</span>_Abs_time<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token keyword">bool</span> <span class="token function">try_lock_shared_until</span><span class="token punctuation">(</span><span class="token keyword">const</span> xtime <span class="token operator">*</span>_Abs_time<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>    <span class="token comment">// try to lock non-exclusive until absolute time</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">_Try_lock_shared_until</span><span class="token punctuation">(</span>_Abs_time<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">unlock_shared</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>    <span class="token comment">// unlock non-exclusive</span>
    _Read_cnt_t _Local_readers<span class="token punctuation">;</span>
    <span class="token keyword">bool</span> _Local_writing<span class="token punctuation">;</span>

        <span class="token punctuation">{</span>    <span class="token comment">// unlock before notifying, for efficiency</span>
        lock_guard<span class="token operator">&lt;</span>mutex<span class="token operator">&gt;</span> <span class="token function">_Lock</span><span class="token punctuation">(</span>_Mymtx<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">--</span>_Readers<span class="token punctuation">;</span>
        _Local_readers <span class="token operator">=</span> _Readers<span class="token punctuation">;</span>
        _Local_writing <span class="token operator">=</span> _Writing<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>_Local_writing <span class="token operator">&amp;&amp;</span> _Local_readers <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        _Read_queue<span class="token punctuation">.</span><span class="token function">notify_one</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_Local_writing <span class="token operator">&amp;&amp;</span> _Local_readers <span class="token operator">==</span> _Max_readers <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
        _Write_queue<span class="token punctuation">.</span><span class="token function">notify_all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token function">shared_timed_mutex</span><span class="token punctuation">(</span><span class="token keyword">const</span> shared_timed_mutex<span class="token operator">&amp;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span>
shared_timed_mutex<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> shared_timed_mutex<span class="token operator">&amp;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
mutex _Mymtx<span class="token punctuation">;</span>
condition_variable _Read_queue<span class="token punctuation">,</span> _Write_queue<span class="token punctuation">;</span>
_Read_cnt_t _Readers<span class="token punctuation">;</span>
<span class="token keyword">bool</span> _Writing<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">stl_condition_variable_win7</span> <span class="token keyword">final</span> <span class="token operator">:</span> <span class="token keyword">public</span> stl_condition_variable_interface
<span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">stl_condition_variable_win7</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">__crtInitializeConditionVariable</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>m_condition_variable<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token operator">~</span><span class="token function">stl_condition_variable_win7</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span>
    <span class="token function">stl_condition_variable_win7</span><span class="token punctuation">(</span><span class="token keyword">const</span> stl_condition_variable_win7<span class="token operator">&amp;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span>
    stl_condition_variable_win7<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> stl_condition_variable_win7<span class="token operator">&amp;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span>

    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">wait</span><span class="token punctuation">(</span>stl_critical_section_interface <span class="token operator">*</span>lock<span class="token punctuation">)</span> <span class="token keyword">override</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>stl_condition_variable_win7<span class="token double-colon punctuation">::</span><span class="token function">wait_for</span><span class="token punctuation">(</span>lock<span class="token punctuation">,</span> INFINITE<span class="token punctuation">)</span><span class="token punctuation">)</span>
            std<span class="token double-colon punctuation">::</span><span class="token function">terminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">virtual</span> <span class="token keyword">bool</span> <span class="token function">wait_for</span><span class="token punctuation">(</span>stl_critical_section_interface <span class="token operator">*</span>lock<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> timeout<span class="token punctuation">)</span> <span class="token keyword">override</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">__crtSleepConditionVariableSRW</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>m_condition_variable<span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>stl_critical_section_win7 <span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>lock<span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">native_handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> timeout<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">notify_one</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">override</span>
    <span class="token punctuation">{</span>
        <span class="token function">__crtWakeConditionVariable</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>m_condition_variable<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">notify_all</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">override</span>
    <span class="token punctuation">{</span>
        <span class="token function">__crtWakeAllConditionVariable</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>m_condition_variable<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
    CONDITION_VARIABLE m_condition_variable<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><p>You can see that std::shared_timed_mutex is implemented in std::condition_value.</p> <p>This is a huge difference.</p> <p>So Let's check the performance of two of them.</p> <p><a href="https://i.stack.imgur.com/xdKwe.png" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/xdKwe.png" alt="TEST RESULTS"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>This is the result of read/write test for 1000 millisecond.</p> <h3 id="std-shared-mutex-processed-read-write-over-2-times-more-than-std-shared-timed-mutex"><a href="#std-shared-mutex-processed-read-write-over-2-times-more-than-std-shared-timed-mutex" class="header-anchor">#</a> std::shared_mutex processed read/write <strong>over 2 times</strong> more than std::shared_timed_mutex.</h3> <p>In this example, the read / write ratio is the same, but the read rate is more frequent than the write rate in real.<br>
Therefore, the performance difference can be larger.</p> <p>the code below is the code in this example.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">useSTLSharedMutex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>shared_mutex shared_mtx_lock<span class="token punctuation">;</span>

    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>thread<span class="token operator">&gt;</span> readThreads<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>thread<span class="token operator">&gt;</span> writeThreads<span class="token punctuation">;</span>

    std<span class="token double-colon punctuation">::</span>list<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> data <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">volatile</span> <span class="token keyword">bool</span> exit <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    std<span class="token double-colon punctuation">::</span>atomic<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token function">readProcessedCnt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>atomic<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token function">writeProcessedCnt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> std<span class="token double-colon punctuation">::</span>thread<span class="token double-colon punctuation">::</span><span class="token function">hardware_concurrency</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>

        readThreads<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">thread</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">&amp;</span>data<span class="token punctuation">,</span> <span class="token operator">&amp;</span>exit<span class="token punctuation">,</span> <span class="token operator">&amp;</span>shared_mtx_lock<span class="token punctuation">,</span> <span class="token operator">&amp;</span>readProcessedCnt<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            std<span class="token double-colon punctuation">::</span>list<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> mydata<span class="token punctuation">;</span>
            <span class="token keyword">int</span> localProcessCnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                shared_mtx_lock<span class="token punctuation">.</span><span class="token function">lock_shared</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                mydata<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token operator">++</span>localProcessCnt<span class="token punctuation">;</span>

                shared_mtx_lock<span class="token punctuation">.</span><span class="token function">unlock_shared</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>exit<span class="token punctuation">)</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            std<span class="token double-colon punctuation">::</span><span class="token function">atomic_fetch_add</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>readProcessedCnt<span class="token punctuation">,</span> localProcessCnt<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        writeThreads<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">thread</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">&amp;</span>data<span class="token punctuation">,</span> <span class="token operator">&amp;</span>exit<span class="token punctuation">,</span> <span class="token operator">&amp;</span>shared_mtx_lock<span class="token punctuation">,</span> <span class="token operator">&amp;</span>writeProcessedCnt<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token keyword">int</span> localProcessCnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                shared_mtx_lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                data<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token operator">++</span>localProcessCnt<span class="token punctuation">;</span>

                shared_mtx_lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>exit<span class="token punctuation">)</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            std<span class="token double-colon punctuation">::</span><span class="token function">atomic_fetch_add</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>writeProcessedCnt<span class="token punctuation">,</span> localProcessCnt<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    std<span class="token double-colon punctuation">::</span>this_thread<span class="token double-colon punctuation">::</span><span class="token function">sleep_for</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>chrono<span class="token double-colon punctuation">::</span><span class="token function">milliseconds</span><span class="token punctuation">(</span>MAIN_WAIT_MILLISECONDS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    exit <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token operator">&amp;</span>r <span class="token operator">:</span> readThreads<span class="token punctuation">)</span>
        r<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token operator">&amp;</span>w <span class="token operator">:</span> writeThreads<span class="token punctuation">)</span>
        w<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;STLSharedMutex READ :           &quot;</span> <span class="token operator">&lt;&lt;</span> readProcessedCnt <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;STLSharedMutex WRITE :          &quot;</span> <span class="token operator">&lt;&lt;</span> writeProcessedCnt <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;TOTAL READ&amp;WRITE :              &quot;</span> <span class="token operator">&lt;&lt;</span> readProcessedCnt <span class="token operator">+</span> writeProcessedCnt <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">useSTLSharedTimedMutex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>shared_timed_mutex shared_mtx_lock<span class="token punctuation">;</span>

    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>thread<span class="token operator">&gt;</span> readThreads<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>thread<span class="token operator">&gt;</span> writeThreads<span class="token punctuation">;</span>

    std<span class="token double-colon punctuation">::</span>list<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> data <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">volatile</span> <span class="token keyword">bool</span> exit <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    std<span class="token double-colon punctuation">::</span>atomic<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token function">readProcessedCnt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>atomic<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token function">writeProcessedCnt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> std<span class="token double-colon punctuation">::</span>thread<span class="token double-colon punctuation">::</span><span class="token function">hardware_concurrency</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>

        readThreads<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">thread</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">&amp;</span>data<span class="token punctuation">,</span> <span class="token operator">&amp;</span>exit<span class="token punctuation">,</span> <span class="token operator">&amp;</span>shared_mtx_lock<span class="token punctuation">,</span> <span class="token operator">&amp;</span>readProcessedCnt<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            std<span class="token double-colon punctuation">::</span>list<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> mydata<span class="token punctuation">;</span>
            <span class="token keyword">int</span> localProcessCnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                shared_mtx_lock<span class="token punctuation">.</span><span class="token function">lock_shared</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                mydata<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token operator">++</span>localProcessCnt<span class="token punctuation">;</span>

                shared_mtx_lock<span class="token punctuation">.</span><span class="token function">unlock_shared</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>exit<span class="token punctuation">)</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            std<span class="token double-colon punctuation">::</span><span class="token function">atomic_fetch_add</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>readProcessedCnt<span class="token punctuation">,</span> localProcessCnt<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        writeThreads<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">thread</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">&amp;</span>data<span class="token punctuation">,</span> <span class="token operator">&amp;</span>exit<span class="token punctuation">,</span> <span class="token operator">&amp;</span>shared_mtx_lock<span class="token punctuation">,</span> <span class="token operator">&amp;</span>writeProcessedCnt<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token keyword">int</span> localProcessCnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                shared_mtx_lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                data<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token operator">++</span>localProcessCnt<span class="token punctuation">;</span>

                shared_mtx_lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>exit<span class="token punctuation">)</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            std<span class="token double-colon punctuation">::</span><span class="token function">atomic_fetch_add</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>writeProcessedCnt<span class="token punctuation">,</span> localProcessCnt<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    std<span class="token double-colon punctuation">::</span>this_thread<span class="token double-colon punctuation">::</span><span class="token function">sleep_for</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>chrono<span class="token double-colon punctuation">::</span><span class="token function">milliseconds</span><span class="token punctuation">(</span>MAIN_WAIT_MILLISECONDS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    exit <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token operator">&amp;</span>r <span class="token operator">:</span> readThreads<span class="token punctuation">)</span>
        r<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token operator">&amp;</span>w <span class="token operator">:</span> writeThreads<span class="token punctuation">)</span>
        w<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;STLSharedTimedMutex READ :      &quot;</span> <span class="token operator">&lt;&lt;</span> readProcessedCnt <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;STLSharedTimedMutex WRITE :     &quot;</span> <span class="token operator">&lt;&lt;</span> writeProcessedCnt <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;TOTAL READ&amp;WRITE :              &quot;</span> <span class="token operator">&lt;&lt;</span> readProcessedCnt <span class="token operator">+</span> writeProcessedCnt <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/cpp/mutexes.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/cpp/rtti-run-time-type-information.html" class="prev">
        RTTI: Run-Time Type Information
      </a></span> <span class="next"><a href="/cpp/recursive-mutex.html">
        Recursive Mutex
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/679.06e044ba.js" defer></script>
  </body>
</html>
