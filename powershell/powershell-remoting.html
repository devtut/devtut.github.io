<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>PowerShell - Powershell Remoting</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Enabling PowerShell Remoting, Connecting to a Remote Server via PowerShell, Run commands on a Remote Computer, A best practise for automatically cleaning-up PSSessions">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="PowerShell - Powershell Remoting">
    <meta property="og:description" content="Enabling PowerShell Remoting, Connecting to a Remote Server via PowerShell, Run commands on a Remote Computer, A best practise for automatically cleaning-up PSSessions">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/powershell/powershell-remoting.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="PowerShell - Powershell Remoting">
    <meta name="twitter:description" content="Enabling PowerShell Remoting, Connecting to a Remote Server via PowerShell, Run commands on a Remote Computer, A best practise for automatically cleaning-up PSSessions">
    <meta name="twitter:url" content="/powershell/powershell-remoting.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/2616.e328b0bc.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>PowerShell</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/powershell/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/powershell/getting-started-with-powershell.html" class="sidebar-link">Getting started with PowerShell</a></li><li><a href="/powershell/variables-in-powershell.html" class="sidebar-link">Variables in PowerShell</a></li><li><a href="/powershell/operators.html" class="sidebar-link">Operators</a></li><li><a href="/powershell/special-operators.html" class="sidebar-link">Special Operators</a></li><li><a href="/powershell/basic-set-operations.html" class="sidebar-link">Basic Set Operations</a></li><li><a href="/powershell/conditional-logic.html" class="sidebar-link">Conditional logic</a></li><li><a href="/powershell/loops.html" class="sidebar-link">Loops</a></li><li><a href="/powershell/switch-statement.html" class="sidebar-link">Switch statement</a></li><li><a href="/powershell/strings.html" class="sidebar-link">Strings</a></li><li><a href="/powershell/hashtables.html" class="sidebar-link">HashTables</a></li><li><a href="/powershell/working-with-objects.html" class="sidebar-link">Working with Objects</a></li><li><a href="/powershell/powershell-functions.html" class="sidebar-link">PowerShell Functions</a></li><li><a href="/powershell/powershell-classes.html" class="sidebar-link">PowerShell Classes</a></li><li><a href="/powershell/powershell-modules.html" class="sidebar-link">Powershell Modules</a></li><li><a href="/powershell/powershell-profiles.html" class="sidebar-link">Powershell profiles</a></li><li><a href="/powershell/calculated-properties.html" class="sidebar-link">Calculated Properties</a></li><li><a href="/powershell/using-existing-static-classes.html" class="sidebar-link">Using existing static classes</a></li><li><a href="/powershell/built-in-variables.html" class="sidebar-link">Built-in variables</a></li><li><a href="/powershell/automatic-variables.html" class="sidebar-link">Automatic Variables</a></li><li><a href="/powershell/automatic-variables-part-2.html" class="sidebar-link">Automatic Variables - part 2</a></li><li><a href="/powershell/environment-variables.html" class="sidebar-link">Environment Variables</a></li><li><a href="/powershell/splatting.html" class="sidebar-link">Splatting</a></li><li><a href="/powershell/powershell-streams-debug-verbose-warning-error-output-and-information.html" class="sidebar-link">PowerShell &quot;Streams&quot;; Debug, Verbose, Warning, Error, Output and Information</a></li><li><a href="/powershell/sending-email.html" class="sidebar-link">Sending Email</a></li><li><a href="/powershell/powershell-remoting.html" aria-current="page" class="active sidebar-link">Powershell Remoting</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/powershell/powershell-remoting.html#enabling-powershell-remoting" class="sidebar-link">Enabling PowerShell Remoting</a></li><li class="sidebar-sub-header"><a href="/powershell/powershell-remoting.html#connecting-to-a-remote-server-via-powershell" class="sidebar-link">Connecting to a Remote Server via PowerShell</a></li><li class="sidebar-sub-header"><a href="/powershell/powershell-remoting.html#run-commands-on-a-remote-computer" class="sidebar-link">Run commands on a Remote Computer</a></li><li class="sidebar-sub-header"><a href="/powershell/powershell-remoting.html#a-best-practise-for-automatically-cleaning-up-pssessions" class="sidebar-link">A best practise for automatically cleaning-up PSSessions</a></li></ul></li><li><a href="/powershell/working-with-the-powershell-pipeline.html" class="sidebar-link">Working with the PowerShell pipeline</a></li><li><a href="/powershell/powershell-background-jobs.html" class="sidebar-link">PowerShell Background Jobs</a></li><li><a href="/powershell/return-behavior-in-powershell.html" class="sidebar-link">Return behavior in PowerShell</a></li><li><a href="/powershell/csv-parsing.html" class="sidebar-link">CSV parsing</a></li><li><a href="/powershell/working-with-xml-files.html" class="sidebar-link">Working with XML Files</a></li><li><a href="/powershell/communicating-with-restful-apis.html" class="sidebar-link">Communicating with RESTful APIs</a></li><li><a href="/powershell/powershell-sql-queries.html" class="sidebar-link">powershell sql queries</a></li><li><a href="/powershell/regular-expressions.html" class="sidebar-link">Regular Expressions</a></li><li><a href="/powershell/aliases.html" class="sidebar-link">Aliases</a></li><li><a href="/powershell/using-the-progress-bar.html" class="sidebar-link">Using the progress bar</a></li><li><a href="/powershell/powershell-exe-command-line.html" class="sidebar-link">PowerShell.exe Command-Line</a></li><li><a href="/powershell/cmdlet-naming.html" class="sidebar-link">Cmdlet Naming</a></li><li><a href="/powershell/running-executables.html" class="sidebar-link">Running Executables</a></li><li><a href="/powershell/enforcing-script-prerequisites.html" class="sidebar-link">Enforcing script prerequisites</a></li><li><a href="/powershell/using-the-help-system.html" class="sidebar-link">Using the Help System</a></li><li><a href="/powershell/modules-scripts-and-functions.html" class="sidebar-link">Modules, Scripts and Functions</a></li><li><a href="/powershell/naming-conventions.html" class="sidebar-link">Naming Conventions</a></li><li><a href="/powershell/common-parameters.html" class="sidebar-link">Common parameters</a></li><li><a href="/powershell/parameter-sets.html" class="sidebar-link">Parameter sets</a></li><li><a href="/powershell/powershell-dynamic-parameters.html" class="sidebar-link">PowerShell Dynamic Parameters</a></li><li><a href="/powershell/gui-in-powershell.html" class="sidebar-link">GUI in Powershell</a></li><li><a href="/powershell/url-encode-decode.html" class="sidebar-link">URL Encode/Decode</a></li><li><a href="/powershell/error-handling.html" class="sidebar-link">Error handling</a></li><li><a href="/powershell/package-management.html" class="sidebar-link">Package management</a></li><li><a href="/powershell/tcp-communication-with-powershell.html" class="sidebar-link">TCP Communication with PowerShell</a></li><li><a href="/powershell/powershell-workflows.html" class="sidebar-link">PowerShell Workflows</a></li><li><a href="/powershell/embedding-managed-code-c-vb.html" class="sidebar-link">Embedding Managed Code (C# | VB)</a></li><li><a href="/powershell/how-to-download-latest-artifact-from-artifactory-using-powershell-script-v2-0-or-below.html" class="sidebar-link">How to download latest artifact from Artifactory using Powershell script (v2.0 or below)?</a></li><li><a href="/powershell/comment-based-help.html" class="sidebar-link">Comment-based help</a></li><li><a href="/powershell/archive-module.html" class="sidebar-link">Archive Module</a></li><li><a href="/powershell/infrastructure-automation.html" class="sidebar-link">Infrastructure Automation</a></li><li><a href="/powershell/psscriptanalyzer-powershell-script-analyzer.html" class="sidebar-link">PSScriptAnalyzer - PowerShell Script Analyzer</a></li><li><a href="/powershell/desired-state-configuration.html" class="sidebar-link">Desired State Configuration</a></li><li><a href="/powershell/using-shouldprocess.html" class="sidebar-link">Using ShouldProcess</a></li><li><a href="/powershell/scheduled-tasks-module.html" class="sidebar-link">Scheduled tasks module</a></li><li><a href="/powershell/ise-module.html" class="sidebar-link">ISE module</a></li><li><a href="/powershell/creating-dsc-class-based-resources.html" class="sidebar-link">Creating DSC Class-Based Resources</a></li><li><a href="/powershell/wmi-and-cim.html" class="sidebar-link">WMI and CIM</a></li><li><a href="/powershell/activedirectory-module.html" class="sidebar-link">ActiveDirectory module</a></li><li><a href="/powershell/sharepoint-module.html" class="sidebar-link">SharePoint Module</a></li><li><a href="/powershell/introduction-to-psake.html" class="sidebar-link">Introduction to Psake</a></li><li><a href="/powershell/introduction-to-pester.html" class="sidebar-link">Introduction to Pester</a></li><li><a href="/powershell/handling-secrets-and-credentials.html" class="sidebar-link">Handling Secrets and Credentials</a></li><li><a href="/powershell/security-and-cryptography.html" class="sidebar-link">Security and Cryptography</a></li><li><a href="/powershell/signing-scripts.html" class="sidebar-link">Signing Scripts</a></li><li><a href="/powershell/anonymize-ip-v4-and-v6-in-text-file-with-powershell.html" class="sidebar-link">Anonymize IP (v4 and v6) in text file with Powershell</a></li><li><a href="/powershell/amazon-web-services-aws-rekognition.html" class="sidebar-link">Amazon Web Services (AWS) Rekognition</a></li><li><a href="/powershell/amazon-web-services-aws-simple-storage-service-s3.html" class="sidebar-link">Amazon Web Services (AWS) Simple Storage Service (S3)</a></li><li><a href="/powershell/mongodb.html" class="sidebar-link">MongoDB</a></li><li><a href="/powershell/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="powershell-remoting"><a href="#powershell-remoting" class="header-anchor">#</a> Powershell Remoting</h1> <h2 id="enabling-powershell-remoting"><a href="#enabling-powershell-remoting" class="header-anchor">#</a> Enabling PowerShell Remoting</h2> <p>PowerShell remoting must first be enabled on the server to which you wish to remotely connect.</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token function">Enable-PSRemoting</span> <span class="token operator">-</span>Force

</code></pre></div><p>This command does the following:</p> <ul><li>Runs the Set-WSManQuickConfig cmdlet, which performs the following tasks:</li> <li>Starts the WinRM service.</li> <li>Sets the startup type on the WinRM service to Automatic.</li> <li>Creates a listener to accept requests on any IP address, if one does not already exist.</li> <li>Enables a firewall exception for WS-Management communications.</li> <li>Registers the Microsoft.PowerShell and Microsoft.PowerShell.Workflow session configurations, if it they are not already registered.</li> <li>Registers the Microsoft.PowerShell32 session configuration on 64-bit computers, if it is not already registered.</li> <li>Enables all session configurations.</li> <li>Changes the security descriptor of all session configurations to allow remote access.</li> <li>Restarts the WinRM service to make the preceding changes effective.</li></ul> <h3 id="only-for-non-domain-environments"><a href="#only-for-non-domain-environments" class="header-anchor">#</a> Only for non-domain environments</h3> <p>For servers in an AD Domain the PS remoting authentication is done through Kerberos ('Default'), or NTLM ('Negotiate'). If you want to allow remoting to a non-domain server you have two options.</p> <p>Either set up WSMan communication over HTTPS (which requires certificate generation) or enable basic authentication which sends your credentials across the wire base64-encoded (that's basically the same as plain-text so be careful with this).</p> <p>In either case you'll have to add the remote systems to your WSMan trusted hosts list.</p> <h3 id="enabling-basic-authentication"><a href="#enabling-basic-authentication" class="header-anchor">#</a> Enabling Basic Authentication</h3> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token function">Set-Item</span> WSMan:\localhost\Service\AllowUnencrypted <span class="token boolean">$true</span>  

</code></pre></div><p>Then on the computer you wish to connect <strong>from</strong>, you must tell it to trust the computer you're connecting <strong>to</strong>.</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token function">Set-Item</span> WSMan:\localhost\Client\TrustedHosts <span class="token string">'192.168.1.1,192.168.1.2'</span>

</code></pre></div><div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token function">Set-Item</span> WSMan:\localhost\Client\TrustedHosts <span class="token operator">*</span><span class="token punctuation">.</span>contoso<span class="token punctuation">.</span>com

</code></pre></div><div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token function">Set-Item</span> WSMan:\localhost\Client\TrustedHosts <span class="token operator">*</span>

</code></pre></div><p><strong>Important</strong>: You must tell your client to trust the computer addressed in the way you want to connect (e.g. if you connect via IP, it must trust the IP not the hostname)</p> <h2 id="connecting-to-a-remote-server-via-powershell"><a href="#connecting-to-a-remote-server-via-powershell" class="header-anchor">#</a> Connecting to a Remote Server via PowerShell</h2> <p>Using credentials from your local computer:</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token function">Enter-PSSession</span> 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>1<span class="token punctuation">.</span>1

</code></pre></div><p>Prompting for credentials on the remote computer</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token function">Enter-PSSession</span> 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>1<span class="token punctuation">.</span>1 <span class="token operator">-</span>Credential $<span class="token punctuation">(</span><span class="token function">Get-Credential</span><span class="token punctuation">)</span>

</code></pre></div><h2 id="run-commands-on-a-remote-computer"><a href="#run-commands-on-a-remote-computer" class="header-anchor">#</a> Run commands on a Remote Computer</h2> <p>Once Powershell remoting is enabled (Enable-PSRemoting) You can run commands on the remote computer like this:</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token function">Invoke-Command</span> <span class="token operator">-</span>ComputerName <span class="token string">&quot;RemoteComputerName&quot;</span> <span class="token operator">-</span>ScriptBlock <span class="token punctuation">{</span>
    <span class="token function">Write</span> host <span class="token string">&quot;Remote Computer Name: <span class="token variable">$ENV</span>:ComputerName&quot;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>The above method creates a temporary session and closes it right after the command or scriptblock ends.</p> <p>To leave the session open and run other command in it later, you need to create a remote session first:</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token variable">$Session</span> = <span class="token function">New-PSSession</span> <span class="token operator">-</span>ComputerName <span class="token string">&quot;RemoteComputerName&quot;</span>

</code></pre></div><p>Then you can use this session each time you invoke commands on the remote computer:</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token function">Invoke-Command</span> <span class="token operator">-</span>Session <span class="token variable">$Session</span> <span class="token operator">-</span>ScriptBlock <span class="token punctuation">{</span>
    <span class="token function">Write</span> host <span class="token string">&quot;Remote Computer Name: <span class="token variable">$ENV</span>:ComputerName&quot;</span>
<span class="token punctuation">}</span>

<span class="token function">Invoke-Command</span> <span class="token operator">-</span>Session <span class="token variable">$Session</span> <span class="token operator">-</span>ScriptBlock <span class="token punctuation">{</span>
    <span class="token function">Get-Date</span>
<span class="token punctuation">}</span>

</code></pre></div><p>If you need to use different Credentials, you can add them with the <code>-Credential</code> Parameter:</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token variable">$Cred</span> = <span class="token function">Get-Credential</span>
<span class="token function">Invoke-Command</span> <span class="token operator">-</span>Session <span class="token variable">$Session</span> <span class="token operator">-</span>Credential <span class="token variable">$Cred</span> <span class="token operator">-</span>ScriptBlock <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>

</code></pre></div><h3 id="remoting-serialization-warning"><a href="#remoting-serialization-warning" class="header-anchor">#</a> Remoting serialization warning</h3> <blockquote></blockquote> <p>Note:
</p><p>It is important to know that remoting serializes PowerShell
objects on the remote system and deserializes them on your end of the
remoting session, i.e. they are converted to XML during transport and
lose all of their methods.</p><p></p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token variable">$output</span> = <span class="token function">Invoke-Command</span> <span class="token operator">-</span>Session <span class="token variable">$Session</span> <span class="token operator">-</span>ScriptBlock <span class="token punctuation">{</span>
    <span class="token function">Get-WmiObject</span> <span class="token operator">-</span><span class="token keyword">Class</span> win32_printer
<span class="token punctuation">}</span>

<span class="token variable">$output</span> <span class="token punctuation">|</span> <span class="token function">Get-Member</span> <span class="token operator">-</span>MemberType Method

  TypeName: Deserialized<span class="token punctuation">.</span>System<span class="token punctuation">.</span>Management<span class="token punctuation">.</span>ManagementObject<span class="token comment">#root\cimv2\Win32_Printer</span>

Name     MemberType Definition
<span class="token operator">--</span>-<span class="token operator">-</span>     <span class="token operator">--</span>-<span class="token operator">--</span>-<span class="token operator">--</span>-<span class="token operator">-</span> <span class="token operator">--</span>-<span class="token operator">--</span>-<span class="token operator">--</span>-<span class="token operator">-</span>
GetType  Method     <span class="token function">type</span> GetType<span class="token punctuation">(</span><span class="token punctuation">)</span>
ToString Method     string ToString<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> string ToString<span class="token punctuation">(</span>string format<span class="token punctuation">,</span> System<span class="token punctuation">.</span>IFormatProvi<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

</code></pre></div><p>Whereas you have the methods on the regular PS object:</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token function">Get-WmiObject</span> <span class="token operator">-</span><span class="token keyword">Class</span> win32_printer <span class="token punctuation">|</span> <span class="token function">Get-Member</span> <span class="token operator">-</span>MemberType Method

 TypeName: System<span class="token punctuation">.</span>Management<span class="token punctuation">.</span>ManagementObject<span class="token comment">#root\cimv2\Win32_Printer</span>

Name                  MemberType Definition                                                                                                                          
<span class="token operator">--</span>-<span class="token operator">-</span>                  <span class="token operator">--</span>-<span class="token operator">--</span>-<span class="token operator">--</span>-<span class="token operator">-</span> <span class="token operator">--</span>-<span class="token operator">--</span>-<span class="token operator">--</span>-<span class="token operator">-</span>                                                                                                                          
CancelAllJobs         Method     System<span class="token punctuation">.</span>Management<span class="token punctuation">.</span>ManagementBaseObject CancelAllJobs<span class="token punctuation">(</span><span class="token punctuation">)</span>                                                                              
GetSecurityDescriptor Method     System<span class="token punctuation">.</span>Management<span class="token punctuation">.</span>ManagementBaseObject GetSecurityDescriptor<span class="token punctuation">(</span><span class="token punctuation">)</span>                                                                      
Pause                 Method     System<span class="token punctuation">.</span>Management<span class="token punctuation">.</span>ManagementBaseObject Pause<span class="token punctuation">(</span><span class="token punctuation">)</span>                                                                                      
PrintTestPage         Method     System<span class="token punctuation">.</span>Management<span class="token punctuation">.</span>ManagementBaseObject PrintTestPage<span class="token punctuation">(</span><span class="token punctuation">)</span>                                                                              
RenamePrinter         Method     System<span class="token punctuation">.</span>Management<span class="token punctuation">.</span>ManagementBaseObject RenamePrinter<span class="token punctuation">(</span>System<span class="token punctuation">.</span>String NewPrinterName<span class="token punctuation">)</span>                                                  
Reset                 Method     System<span class="token punctuation">.</span>Management<span class="token punctuation">.</span>ManagementBaseObject Reset<span class="token punctuation">(</span><span class="token punctuation">)</span>                                                                                      
Resume                Method     System<span class="token punctuation">.</span>Management<span class="token punctuation">.</span>ManagementBaseObject Resume<span class="token punctuation">(</span><span class="token punctuation">)</span>                                                                                     
SetDefaultPrinter     Method     System<span class="token punctuation">.</span>Management<span class="token punctuation">.</span>ManagementBaseObject SetDefaultPrinter<span class="token punctuation">(</span><span class="token punctuation">)</span>                                                                          
SetPowerState         Method     System<span class="token punctuation">.</span>Management<span class="token punctuation">.</span>ManagementBaseObject SetPowerState<span class="token punctuation">(</span>System<span class="token punctuation">.</span>UInt16 PowerState<span class="token punctuation">,</span> System<span class="token punctuation">.</span>String Time<span class="token punctuation">)</span>                                  
SetSecurityDescriptor Method     System<span class="token punctuation">.</span>Management<span class="token punctuation">.</span>ManagementBaseObject SetSecurityDescriptor<span class="token punctuation">(</span>System<span class="token punctuation">.</span>Management<span class="token punctuation">.</span>ManagementObject<span class="token comment">#Win32_SecurityDescriptor Descriptor)</span>

</code></pre></div><h3 id="argument-usage"><a href="#argument-usage" class="header-anchor">#</a> Argument Usage</h3> <p>To use arguments as parameters for the remote scripting block, one might either use the <code>ArgumentList</code> parameter of <code>Invoke-Command</code>, or use the <code>$Using:</code> syntax.</p> <p>Using <code>ArgumentList</code> with unnamed parameters (i.e. in the order they are passed to the scriptblock):</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token variable">$servicesToShow</span> = <span class="token string">&quot;service1&quot;</span>
<span class="token variable">$fileName</span> = <span class="token string">&quot;C:\temp\servicestatus.csv&quot;</span>
<span class="token function">Invoke-Command</span> <span class="token operator">-</span>Session <span class="token variable">$session</span> <span class="token operator">-</span>ArgumentList <span class="token variable">$servicesToShow</span><span class="token punctuation">,</span><span class="token variable">$fileName</span> <span class="token operator">-</span>ScriptBlock <span class="token punctuation">{</span>
    <span class="token function">Write-Host</span> <span class="token string">&quot;Calling script block remotely with <span class="token function">$<span class="token punctuation">(</span><span class="token variable">$Args</span><span class="token punctuation">.</span>Count<span class="token punctuation">)</span></span>&quot;</span>
    <span class="token function">Get-Service</span> <span class="token operator">-</span>Name <span class="token variable">$args</span><span class="token punctuation">[</span>0<span class="token punctuation">]</span>
    <span class="token function">Remove-Item</span> <span class="token operator">-</span>Path <span class="token variable">$args</span><span class="token punctuation">[</span>1<span class="token punctuation">]</span> <span class="token operator">-</span>ErrorAction SilentlyContinue <span class="token operator">-</span>Force
<span class="token punctuation">}</span>

</code></pre></div><p>Using <code>ArgumentList</code> with named parameters:</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token variable">$servicesToShow</span> = <span class="token string">&quot;service1&quot;</span>
<span class="token variable">$fileName</span> = <span class="token string">&quot;C:\temp\servicestatus.csv&quot;</span>
<span class="token function">Invoke-Command</span> <span class="token operator">-</span>Session <span class="token variable">$session</span> <span class="token operator">-</span>ArgumentList <span class="token variable">$servicesToShow</span><span class="token punctuation">,</span><span class="token variable">$fileName</span> <span class="token operator">-</span>ScriptBlock <span class="token punctuation">{</span>
    <span class="token keyword">Param</span><span class="token punctuation">(</span><span class="token variable">$serviceToShowInRemoteSession</span><span class="token punctuation">,</span><span class="token variable">$fileToDelete</span><span class="token punctuation">)</span>

    <span class="token function">Write-Host</span> <span class="token string">&quot;Calling script block remotely with <span class="token function">$<span class="token punctuation">(</span><span class="token variable">$Args</span><span class="token punctuation">.</span>Count<span class="token punctuation">)</span></span>&quot;</span>
    <span class="token function">Get-Service</span> <span class="token operator">-</span>Name <span class="token variable">$serviceToShowInRemoteSession</span>
    <span class="token function">Remove-Item</span> <span class="token operator">-</span>Path <span class="token variable">$fileToDelete</span> <span class="token operator">-</span>ErrorAction SilentlyContinue <span class="token operator">-</span>Force
<span class="token punctuation">}</span>

</code></pre></div><p>Using <code>$Using:</code> syntax:</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token variable">$servicesToShow</span> = <span class="token string">&quot;service1&quot;</span>
<span class="token variable">$fileName</span> = <span class="token string">&quot;C:\temp\servicestatus.csv&quot;</span>
<span class="token function">Invoke-Command</span> <span class="token operator">-</span>Session <span class="token variable">$session</span> <span class="token operator">-</span>ScriptBlock <span class="token punctuation">{</span>
    <span class="token function">Get-Service</span> <span class="token variable">$Using</span>:servicesToShow
    <span class="token function">Remove-Item</span> <span class="token operator">-</span>Path <span class="token variable">$fileName</span> <span class="token operator">-</span>ErrorAction SilentlyContinue <span class="token operator">-</span>Force
<span class="token punctuation">}</span>

</code></pre></div><h2 id="a-best-practise-for-automatically-cleaning-up-pssessions"><a href="#a-best-practise-for-automatically-cleaning-up-pssessions" class="header-anchor">#</a> A best practise for automatically cleaning-up PSSessions</h2> <p>When a remote session is created via the <code>New-PSsession</code> cmdlet, the PSSession persists until the current PowerShell session ends.
Meaning that, by default, the <code>PSSession</code> and all associated resources will continue to be used until the current PowerShell session ends.</p> <p>Multiple active <code>PSSessions</code> can become a strain on resources, particularly for long running or interlinked scripts that create hundreds of <code>PSSessions</code> in a single PowerShell session.</p> <p>It is best practise to explicitly remove each <code>PSSession</code> after it is finished being used. [1]</p> <p>The following code template utilises <code>try-catch-finally</code> in order to achieve the above, combining error handling with a secure way to ensure all created <code>PSSessions</code> are removed when they are finished being used:</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token keyword">try</span>
<span class="token punctuation">{</span>
    <span class="token variable">$session</span> = <span class="token function">New-PSsession</span> <span class="token operator">-</span>Computername <span class="token string">&quot;RemoteMachineName&quot;</span>
    <span class="token function">Invoke-Command</span> <span class="token operator">-</span>Session <span class="token variable">$session</span> <span class="token operator">-</span>ScriptBlock <span class="token punctuation">{</span><span class="token function">write-host</span> <span class="token string">&quot;This is running on <span class="token variable">$ENV</span>:ComputerName&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">catch</span>
<span class="token punctuation">{</span>
    <span class="token function">Write-Output</span> <span class="token string">&quot;ERROR: <span class="token variable">$_</span>&quot;</span>
<span class="token punctuation">}</span>
<span class="token keyword">finally</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$session</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">Remove-PSSession</span> <span class="token variable">$session</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>References:
[1] <a href="https://msdn.microsoft.com/en-us/powershell/reference/5.1/microsoft.powershell.core/new-pssession" target="_blank" rel="noopener noreferrer">https://msdn.microsoft.com/en-us/powershell/reference/5.1/microsoft.powershell.core/new-pssession<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="remarks"><a href="#remarks" class="header-anchor">#</a> Remarks</h4> <ul><li><a href="https://technet.microsoft.com/en-us/library/hh847900.aspx" target="_blank" rel="noopener noreferrer">about_Remote<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://technet.microsoft.com/en-us/library/hh847845.aspx" target="_blank" rel="noopener noreferrer">about_RemoteFAQ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://technet.microsoft.com/en-us/library/hh847850.aspx" target="_blank" rel="noopener noreferrer">about_RemoteTroubleshooting<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/powershell/powershell-remoting.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/powershell/sending-email.html" class="prev">
        Sending Email
      </a></span> <span class="next"><a href="/powershell/working-with-the-powershell-pipeline.html">
        Working with the PowerShell pipeline
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/2616.e328b0bc.js" defer></script>
  </body>
</html>
