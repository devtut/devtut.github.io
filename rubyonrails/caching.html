<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Ruby on Rails - Caching</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Russian Doll Caching, SQL Caching, Fragment caching, Page caching, HTTP caching, Action caching">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="Ruby on Rails - Caching">
    <meta property="og:description" content="Russian Doll Caching, SQL Caching, Fragment caching, Page caching, HTTP caching, Action caching">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/rubyonrails/caching.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="Ruby on Rails - Caching">
    <meta name="twitter:description" content="Russian Doll Caching, SQL Caching, Fragment caching, Page caching, HTTP caching, Action caching">
    <meta name="twitter:url" content="/rubyonrails/caching.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    <link rel="preload" href="/assets/css/0.styles.8b877eb8.css" as="style"><link rel="preload" href="/assets/js/app.ced448ab.js" as="script"><link rel="preload" href="/assets/js/3.f1d73125.js" as="script"><link rel="preload" href="/assets/js/3140.1f291d7a.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.8b877eb8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Ruby on Rails</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rubyonrails/" class="sidebar-link">Disclaimer</a></li><li><a href="/rubyonrails/getting-started-with-ruby-on-rails.html" class="sidebar-link">Getting started with Ruby on Rails</a></li><li><a href="/rubyonrails/routing.html" class="sidebar-link">Routing</a></li><li><a href="/rubyonrails/activerecord.html" class="sidebar-link">ActiveRecord</a></li><li><a href="/rubyonrails/views.html" class="sidebar-link">Views</a></li><li><a href="/rubyonrails/activerecord-migrations.html" class="sidebar-link">ActiveRecord Migrations</a></li><li><a href="/rubyonrails/rails-best-practices.html" class="sidebar-link">Rails Best Practices</a></li><li><a href="/rubyonrails/naming-conventions.html" class="sidebar-link">Naming Conventions</a></li><li><a href="/rubyonrails/actioncable.html" class="sidebar-link">ActionCable</a></li><li><a href="/rubyonrails/activemodel.html" class="sidebar-link">ActiveModel</a></li><li><a href="/rubyonrails/user-authentication-in-rails.html" class="sidebar-link">User Authentication in Rails</a></li><li><a href="/rubyonrails/activerecord-associations.html" class="sidebar-link">ActiveRecord Associations</a></li><li><a href="/rubyonrails/activerecord-validations.html" class="sidebar-link">ActiveRecord Validations</a></li><li><a href="/rubyonrails/activerecord-query-interface.html" class="sidebar-link">ActiveRecord Query Interface</a></li><li><a href="/rubyonrails/actionmailer.html" class="sidebar-link">ActionMailer</a></li><li><a href="/rubyonrails/rails-generate-commands.html" class="sidebar-link">Rails generate commands</a></li><li><a href="/rubyonrails/configuration.html" class="sidebar-link">Configuration</a></li><li><a href="/rubyonrails/i18n-internationalization.html" class="sidebar-link">I18n - Internationalization</a></li><li><a href="/rubyonrails/using-googlemaps-with-rails.html" class="sidebar-link">Using GoogleMaps with Rails</a></li><li><a href="/rubyonrails/file-uploads.html" class="sidebar-link">File Uploads</a></li><li><a href="/rubyonrails/caching.html" class="active sidebar-link">Caching</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rubyonrails/caching.html#russian-doll-caching" class="sidebar-link">Russian Doll Caching</a></li><li class="sidebar-sub-header"><a href="/rubyonrails/caching.html#sql-caching" class="sidebar-link">SQL Caching</a></li><li class="sidebar-sub-header"><a href="/rubyonrails/caching.html#fragment-caching" class="sidebar-link">Fragment caching</a></li><li class="sidebar-sub-header"><a href="/rubyonrails/caching.html#page-caching" class="sidebar-link">Page caching</a></li><li class="sidebar-sub-header"><a href="/rubyonrails/caching.html#http-caching" class="sidebar-link">HTTP caching</a></li><li class="sidebar-sub-header"><a href="/rubyonrails/caching.html#action-caching" class="sidebar-link">Action caching</a></li></ul></li><li><a href="/rubyonrails/actioncontroller.html" class="sidebar-link">ActionController</a></li><li><a href="/rubyonrails/configuration.html" class="sidebar-link">Configuration</a></li><li><a href="/rubyonrails/safe-constantize.html" class="sidebar-link">Safe Constantize</a></li><li><a href="/rubyonrails/rails-5.html" class="sidebar-link">Rails 5</a></li><li><a href="/rubyonrails/authorization-with-cancan.html" class="sidebar-link">Authorization with CanCan</a></li><li><a href="/rubyonrails/mongoid.html" class="sidebar-link">Mongoid</a></li><li><a href="/rubyonrails/gems.html" class="sidebar-link">Gems</a></li><li><a href="/rubyonrails/change-default-timezone.html" class="sidebar-link">Change default timezone</a></li><li><a href="/rubyonrails/asset-pipeline.html" class="sidebar-link">Asset Pipeline</a></li><li><a href="/rubyonrails/upgrading-rails.html" class="sidebar-link">Upgrading Rails</a></li><li><a href="/rubyonrails/activerecord-locking.html" class="sidebar-link">ActiveRecord Locking</a></li><li><a href="/rubyonrails/debugging.html" class="sidebar-link">Debugging</a></li><li><a href="/rubyonrails/configure-angular-with-rails.html" class="sidebar-link">Configure Angular with Rails</a></li><li><a href="/rubyonrails/rails-logger.html" class="sidebar-link">Rails logger</a></li><li><a href="/rubyonrails/prawn-pdf.html" class="sidebar-link">Prawn PDF</a></li><li><a href="/rubyonrails/rails-api.html" class="sidebar-link">Rails API</a></li><li><a href="/rubyonrails/deploying-a-rails-app-on-heroku.html" class="sidebar-link">Deploying a Rails app on Heroku</a></li><li><a href="/rubyonrails/activesupport.html" class="sidebar-link">ActiveSupport</a></li><li><a href="/rubyonrails/form-helpers.html" class="sidebar-link">Form Helpers</a></li><li><a href="/rubyonrails/activerecord-transactions.html" class="sidebar-link">ActiveRecord Transactions</a></li><li><a href="/rubyonrails/rspec-and-ruby-on-rails.html" class="sidebar-link">RSpec and Ruby on Rails</a></li><li><a href="/rubyonrails/decorator-pattern.html" class="sidebar-link">Decorator pattern</a></li><li><a href="/rubyonrails/elasticsearch.html" class="sidebar-link">Elasticsearch</a></li><li><a href="/rubyonrails/react-with-rails-using-react-rails-gem.html" class="sidebar-link">React with Rails using react-rails gem</a></li><li><a href="/rubyonrails/rails-cookbook-advanced-rails-recipes-learnings-and-coding-techniques.html" class="sidebar-link">Rails Cookbook - Advanced rails recipes/learnings and coding techniques</a></li><li><a href="/rubyonrails/multipurpose-activerecord-columns.html" class="sidebar-link">Multipurpose ActiveRecord columns</a></li><li><a href="/rubyonrails/class-organization.html" class="sidebar-link">Class Organization</a></li><li><a href="/rubyonrails/shallow-routing.html" class="sidebar-link">Shallow Routing</a></li><li><a href="/rubyonrails/model-states-aasm.html" class="sidebar-link">Model states: AASM</a></li><li><a href="/rubyonrails/rails-5-api-authetication.html" class="sidebar-link">Rails 5 API Authetication</a></li><li><a href="/rubyonrails/testing-rails-applications.html" class="sidebar-link">Testing Rails Applications</a></li><li><a href="/rubyonrails/active-jobs.html" class="sidebar-link">Active Jobs</a></li><li><a href="/rubyonrails/rails-frameworks-over-the-years.html" class="sidebar-link">Rails frameworks over the years</a></li><li><a href="/rubyonrails/nested-form-in-ruby-on-rails.html" class="sidebar-link">Nested form in Ruby on Rails</a></li><li><a href="/rubyonrails/factory-girl.html" class="sidebar-link">Factory Girl</a></li><li><a href="/rubyonrails/import-whole-csv-files-from-specific-folder.html" class="sidebar-link">Import whole CSV files from specific folder</a></li><li><a href="/rubyonrails/tools-for-ruby-on-rails-code-optimization-and-cleanup.html" class="sidebar-link">Tools for Ruby on Rails code optimization and cleanup</a></li><li><a href="/rubyonrails/activejob.html" class="sidebar-link">ActiveJob</a></li><li><a href="/rubyonrails/active-model-serializers.html" class="sidebar-link">Active Model Serializers</a></li><li><a href="/rubyonrails/rails-engine-modular-rails.html" class="sidebar-link">Rails Engine -  Modular Rails</a></li><li><a href="/rubyonrails/single-table-inheritance.html" class="sidebar-link">Single Table Inheritance</a></li><li><a href="/rubyonrails/activerecord-transactions.html" class="sidebar-link">ActiveRecord Transactions</a></li><li><a href="/rubyonrails/turbolinks.html" class="sidebar-link">Turbolinks</a></li><li><a href="/rubyonrails/friendly-id.html" class="sidebar-link">Friendly ID</a></li><li><a href="/rubyonrails/securely-storing-authentication-keys.html" class="sidebar-link">Securely storing authentication keys</a></li><li><a href="/rubyonrails/authenticate-api-using-devise.html" class="sidebar-link">Authenticate Api using Devise</a></li><li><a href="/rubyonrails/integrating-react-js-with-rails-using-hyperloop.html" class="sidebar-link">Integrating React.js with Rails Using Hyperloop</a></li><li><a href="/rubyonrails/change-a-default-rails-application-enviornment.html" class="sidebar-link">Change a default Rails application enviornment</a></li><li><a href="/rubyonrails/rails-engines.html" class="sidebar-link">Rails -Engines</a></li><li><a href="/rubyonrails/adding-an-amazon-rds-to-your-rails-application.html" class="sidebar-link">Adding an Amazon RDS to your rails application</a></li><li><a href="/rubyonrails/payment-feature-in-rails.html" class="sidebar-link">Payment feature in rails</a></li><li><a href="/rubyonrails/rails-on-docker.html" class="sidebar-link">Rails on docker</a></li><li><a href="/rubyonrails/reserved-words.html" class="sidebar-link">Reserved Words</a></li><li><a href="/rubyonrails/add-admin-panel.html" class="sidebar-link">Add Admin Panel</a></li><li><a href="/rubyonrails/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="caching"><a href="#caching" class="header-anchor">#</a> Caching</h1> <h2 id="russian-doll-caching"><a href="#russian-doll-caching" class="header-anchor">#</a> Russian Doll Caching</h2> <p>You may want to nest cached fragments inside other cached fragments. This is called <code>Russian doll caching</code>.</p> <p>The advantage of <code>Russian doll caching</code> is that if a single product is updated, all the other inner fragments can be reused when regenerating the outer fragment.</p> <p>As explained in the previous section, a cached file will expire if the value of <code>updated_at</code> changes for a record on which the cached file directly depends. However, this will not expire any cache the fragment is nested within.</p> <p>For example, take the following view:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token operator">&lt;</span><span class="token operator">%</span> cache product <span class="token keyword">do</span> <span class="token string">%&gt;
  &lt;%= render product.games %&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token keyword">end</span> <span class="token operator">%</span><span class="token operator">&gt;</span>

</code></pre></div><p>Which in turn renders this view:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token operator">&lt;</span><span class="token operator">%</span> cache game <span class="token keyword">do</span> <span class="token string">%&gt;
  &lt;%= render game %&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token keyword">end</span> <span class="token operator">%</span><span class="token operator">&gt;</span>

</code></pre></div><p>If any attribute of game is changed, the <code>updated_at</code> value will be set to the current time, thereby expiring the cache.</p> <p>However, because <code>updated_at</code> will not be changed for the product object, that cache will not be expired and your app will serve stale data. To fix this, we tie the models together with the touch method:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token operator">&lt;</span> <span class="token constant">ApplicationRecord</span>
  has_many <span class="token symbol">:games</span>
<span class="token keyword">end</span>

<span class="token keyword">class</span> <span class="token class-name">Game</span> <span class="token operator">&lt;</span> <span class="token constant">ApplicationRecord</span>
  belongs_to <span class="token symbol">:product</span><span class="token punctuation">,</span> touch<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token keyword">end</span>

</code></pre></div><h2 id="sql-caching"><a href="#sql-caching" class="header-anchor">#</a> SQL Caching</h2> <p>Query caching is a <code>Rails</code> feature that caches the result set returned by each query. If <code>Rails</code> encounters the same query again for that request, it will use the cached result set as opposed to running the query against the database again.</p> <p>For example:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">ProductsController</span> <span class="token operator">&lt;</span> <span class="token constant">ApplicationController</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">index</span></span>
    <span class="token comment"># Run a find query</span>
    <span class="token variable">@products</span> <span class="token operator">=</span> <span class="token constant">Product</span><span class="token punctuation">.</span>all

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token comment"># Run the same query again</span>
    <span class="token variable">@products</span> <span class="token operator">=</span> <span class="token constant">Product</span><span class="token punctuation">.</span>all
  <span class="token keyword">end</span>

<span class="token keyword">end</span>

</code></pre></div><p>The second time the same query is run against the database, it's not actually going to hit the database. The first time the result is returned from the query it is stored in the query cache (in memory) and the second time it's pulled from memory.</p> <p>However, it's important to note that query caches are created at the start of an action and destroyed at the end of that action and thus persist only for the duration of the action. If you'd like to store query results in a more persistent fashion, you can with low level caching.</p> <h2 id="fragment-caching"><a href="#fragment-caching" class="header-anchor">#</a> Fragment caching</h2> <p><code>Rails.cache</code>, provided by ActiveSupport, can be used to cache any serializable Ruby object across requests.</p> <p>To fetch a value from the cache for a given key, use <code>cache.read</code>:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">Rails</span><span class="token punctuation">.</span>cache<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token string">'city'</span><span class="token punctuation">)</span>
<span class="token comment"># =&gt; nil</span>

</code></pre></div><p>Use <code>cache.write</code> to write a value to the cache:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">Rails</span><span class="token punctuation">.</span>cache<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'city'</span><span class="token punctuation">,</span> <span class="token string">'Duckburgh'</span><span class="token punctuation">)</span>
<span class="token constant">Rails</span><span class="token punctuation">.</span>cache<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token string">'city'</span><span class="token punctuation">)</span>
<span class="token comment"># =&gt; 'Duckburgh'</span>

</code></pre></div><p>Alternatively, use <code>cache.fetch</code> to read a value from the cache and optionally write a default if there is no value:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">Rails</span><span class="token punctuation">.</span>cache<span class="token punctuation">.</span>fetch<span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span> <span class="token keyword">do</span>
  <span class="token constant">User</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span><span class="token symbol">:is_awesome</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

</code></pre></div><p>The return value of the passed block will be assigned to the cache under the given key, and then returned.</p> <p>You can also specify a cache expiry:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">Rails</span><span class="token punctuation">.</span>cache<span class="token punctuation">.</span>fetch<span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token symbol">:expires_in</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">30.</span>minutes<span class="token punctuation">)</span> <span class="token keyword">do</span>
  <span class="token constant">User</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span><span class="token symbol">:is_awesome</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

</code></pre></div><h2 id="page-caching"><a href="#page-caching" class="header-anchor">#</a> Page caching</h2> <p>You can use the <a href="https://github.com/rails/actionpack-page_caching" target="_blank" rel="noopener noreferrer">ActionPack page_caching gem<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to cache individual pages. This stores the result of one dynamic request as a static HTML file, which is served in place of the dynamic request on subsequent requests. The README contains full setup instructions. Once set up, use the <code>caches_page</code> class method in a controller to cache the result of an action:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">UsersController</span> <span class="token operator">&lt;</span> <span class="token constant">ActionController</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Base</span>
  caches_page <span class="token symbol">:index</span>
<span class="token keyword">end</span>

</code></pre></div><p>Use <code>expire_page</code> to force expiration of the cache by deleting the stored HTML file:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">UsersController</span> <span class="token operator">&lt;</span> <span class="token constant">ActionController</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Base</span>
  caches_page <span class="token symbol">:index</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">index</span></span>
    <span class="token variable">@users</span> <span class="token operator">=</span> <span class="token constant">User</span><span class="token punctuation">.</span>all
  <span class="token keyword">end</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">create</span></span>
    expire_page <span class="token symbol">:action</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token symbol">:index</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>

</code></pre></div><p>The syntax of <code>expire_page</code> mimics that of <code>url_for</code> and friends.</p> <h2 id="http-caching"><a href="#http-caching" class="header-anchor">#</a> HTTP caching</h2> <p>Rails &gt;= 3 comes with HTTP caching abilities out of the box. This uses the <code>Cache-Control</code> and <code>ETag</code> headers to control how long a client or intermediary (such as a CDN) can cache a page.</p> <p>In a controller action, use <code>expires_in</code> to set the length of caching for that action:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token keyword">def</span> <span class="token method-definition"><span class="token function">show</span></span>
  <span class="token variable">@user</span> <span class="token operator">=</span> <span class="token constant">User</span><span class="token punctuation">.</span>find params<span class="token punctuation">[</span><span class="token symbol">:id</span><span class="token punctuation">]</span>
  expires_in <span class="token number">30.</span>minutes<span class="token punctuation">,</span> <span class="token symbol">:public</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">true</span>
<span class="token keyword">end</span>

</code></pre></div><p>Use <code>expires_now</code> to force immediate expiration of a cached resource on any visiting client or intermediary:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token keyword">def</span> <span class="token method-definition"><span class="token function">show</span></span>
  <span class="token variable">@users</span> <span class="token operator">=</span> <span class="token constant">User</span><span class="token punctuation">.</span>find params<span class="token punctuation">[</span><span class="token symbol">:id</span><span class="token punctuation">]</span>
  expires_now <span class="token keyword">if</span> params<span class="token punctuation">[</span><span class="token symbol">:id</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>
<span class="token keyword">end</span>

</code></pre></div><h2 id="action-caching"><a href="#action-caching" class="header-anchor">#</a> Action caching</h2> <p>Like page caching, action caching caches the whole page. The difference is that the request hits the Rails stack so before filters are run before the cache is served.
It's extracted from Rails to <a href="https://github.com/rails/actionpack-action_caching" target="_blank" rel="noopener noreferrer">actionpack-action_caching gem<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>A common example is caching of an action that requires authentication:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">SecretIngredientsController</span> <span class="token operator">&lt;</span> <span class="token constant">ApplicationController</span>
  before_action <span class="token symbol">:authenticate_user!</span><span class="token punctuation">,</span> only<span class="token punctuation">:</span> <span class="token symbol">:index</span><span class="token punctuation">,</span> <span class="token symbol">:show</span>
  caches_action <span class="token symbol">:index</span>
  
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">index</span></span>
    <span class="token variable">@secret_ingredients</span> <span class="token operator">=</span> <span class="token constant">Recipe</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token symbol">:recipe_id</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>secret_ingredients
  <span class="token keyword">end</span>
<span class="token keyword">end</span>

</code></pre></div><p>Options include <code>:expires_in</code>, a custom <code>:cache_path</code> (for actions with multiple routes that should be cached differently) and <code>:if</code>/<code>:unless</code> to control when the action should be cached.</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">RecipesController</span> <span class="token operator">&lt;</span> <span class="token constant">ApplicationController</span>
  before_action <span class="token symbol">:authenticate_user!</span><span class="token punctuation">,</span> except<span class="token punctuation">:</span> <span class="token symbol">:show</span>
  caches_page <span class="token symbol">:show</span>
  caches_action <span class="token symbol">:archive</span><span class="token punctuation">,</span> expires_in<span class="token punctuation">:</span> <span class="token number">1.</span>day
  caches_action <span class="token symbol">:index</span><span class="token punctuation">,</span> <span class="token keyword">unless</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> request<span class="token punctuation">.</span>format<span class="token punctuation">.</span>json<span class="token operator">?</span> <span class="token punctuation">}</span>
<span class="token keyword">end</span>

</code></pre></div><p>When the layout has dynamic content, cache only the action content by passing <code>layout: false</code>.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/rubyonrails/caching.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/rubyonrails/file-uploads.html" class="prev">
        File Uploads
      </a></span> <span class="next"><a href="/rubyonrails/actioncontroller.html">
        ActionController
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.ced448ab.js" defer></script><script src="/assets/js/3.f1d73125.js" defer></script><script src="/assets/js/3140.1f291d7a.js" defer></script>
  </body>
</html>
