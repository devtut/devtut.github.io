<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Ruby on Rails - Using GoogleMaps with Rails</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Add the google maps javascript tag to the layout header, Geocode the model, Show addresses on a google map in the profile view, Set the markers on the map with javascript, Initialize the map using a coffee script class., Initialize the map markers using a coffee script class, Auto-zoom a map using a coffee script class, Exposing the model properties as json">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="Ruby on Rails - Using GoogleMaps with Rails">
    <meta property="og:description" content="Add the google maps javascript tag to the layout header, Geocode the model, Show addresses on a google map in the profile view, Set the markers on the map with javascript, Initialize the map using a coffee script class., Initialize the map markers using a coffee script class, Auto-zoom a map using a coffee script class, Exposing the model properties as json">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/rubyonrails/using-googlemaps-with-rails.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="Ruby on Rails - Using GoogleMaps with Rails">
    <meta name="twitter:description" content="Add the google maps javascript tag to the layout header, Geocode the model, Show addresses on a google map in the profile view, Set the markers on the map with javascript, Initialize the map using a coffee script class., Initialize the map markers using a coffee script class, Auto-zoom a map using a coffee script class, Exposing the model properties as json">
    <meta name="twitter:url" content="/rubyonrails/using-googlemaps-with-rails.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/3193.7711c754.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Ruby on Rails</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rubyonrails/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/rubyonrails/getting-started-with-ruby-on-rails.html" class="sidebar-link">Getting started with Ruby on Rails</a></li><li><a href="/rubyonrails/routing.html" class="sidebar-link">Routing</a></li><li><a href="/rubyonrails/activerecord.html" class="sidebar-link">ActiveRecord</a></li><li><a href="/rubyonrails/views.html" class="sidebar-link">Views</a></li><li><a href="/rubyonrails/activerecord-migrations.html" class="sidebar-link">ActiveRecord Migrations</a></li><li><a href="/rubyonrails/rails-best-practices.html" class="sidebar-link">Rails Best Practices</a></li><li><a href="/rubyonrails/naming-conventions.html" class="sidebar-link">Naming Conventions</a></li><li><a href="/rubyonrails/actioncable.html" class="sidebar-link">ActionCable</a></li><li><a href="/rubyonrails/activemodel.html" class="sidebar-link">ActiveModel</a></li><li><a href="/rubyonrails/user-authentication-in-rails.html" class="sidebar-link">User Authentication in Rails</a></li><li><a href="/rubyonrails/activerecord-associations.html" class="sidebar-link">ActiveRecord Associations</a></li><li><a href="/rubyonrails/activerecord-validations.html" class="sidebar-link">ActiveRecord Validations</a></li><li><a href="/rubyonrails/activerecord-query-interface.html" class="sidebar-link">ActiveRecord Query Interface</a></li><li><a href="/rubyonrails/actionmailer.html" class="sidebar-link">ActionMailer</a></li><li><a href="/rubyonrails/rails-generate-commands.html" class="sidebar-link">Rails generate commands</a></li><li><a href="/rubyonrails/configuration.html" class="sidebar-link">Configuration</a></li><li><a href="/rubyonrails/i18n-internationalization.html" class="sidebar-link">I18n - Internationalization</a></li><li><a href="/rubyonrails/using-googlemaps-with-rails.html" aria-current="page" class="active sidebar-link">Using GoogleMaps with Rails</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rubyonrails/using-googlemaps-with-rails.html#add-the-google-maps-javascript-tag-to-the-layout-header" class="sidebar-link">Add the google maps javascript tag to the layout header</a></li><li class="sidebar-sub-header"><a href="/rubyonrails/using-googlemaps-with-rails.html#geocode-the-model" class="sidebar-link">Geocode the model</a></li><li class="sidebar-sub-header"><a href="/rubyonrails/using-googlemaps-with-rails.html#show-addresses-on-a-google-map-in-the-profile-view" class="sidebar-link">Show addresses on a google map in the profile view</a></li><li class="sidebar-sub-header"><a href="/rubyonrails/using-googlemaps-with-rails.html#set-the-markers-on-the-map-with-javascript" class="sidebar-link">Set the markers on the map with javascript</a></li><li class="sidebar-sub-header"><a href="/rubyonrails/using-googlemaps-with-rails.html#initialize-the-map-using-a-coffee-script-class" class="sidebar-link">Initialize the map using a coffee script class.</a></li><li class="sidebar-sub-header"><a href="/rubyonrails/using-googlemaps-with-rails.html#initialize-the-map-markers-using-a-coffee-script-class" class="sidebar-link">Initialize the map markers using a coffee script class</a></li><li class="sidebar-sub-header"><a href="/rubyonrails/using-googlemaps-with-rails.html#auto-zoom-a-map-using-a-coffee-script-class" class="sidebar-link">Auto-zoom a map using a coffee script class</a></li><li class="sidebar-sub-header"><a href="/rubyonrails/using-googlemaps-with-rails.html#exposing-the-model-properties-as-json" class="sidebar-link">Exposing the model properties as json</a></li></ul></li><li><a href="/rubyonrails/file-uploads.html" class="sidebar-link">File Uploads</a></li><li><a href="/rubyonrails/caching.html" class="sidebar-link">Caching</a></li><li><a href="/rubyonrails/actioncontroller.html" class="sidebar-link">ActionController</a></li><li><a href="/rubyonrails/configuration.html" class="sidebar-link">Configuration</a></li><li><a href="/rubyonrails/safe-constantize.html" class="sidebar-link">Safe Constantize</a></li><li><a href="/rubyonrails/rails-5.html" class="sidebar-link">Rails 5</a></li><li><a href="/rubyonrails/authorization-with-cancan.html" class="sidebar-link">Authorization with CanCan</a></li><li><a href="/rubyonrails/mongoid.html" class="sidebar-link">Mongoid</a></li><li><a href="/rubyonrails/gems.html" class="sidebar-link">Gems</a></li><li><a href="/rubyonrails/change-default-timezone.html" class="sidebar-link">Change default timezone</a></li><li><a href="/rubyonrails/asset-pipeline.html" class="sidebar-link">Asset Pipeline</a></li><li><a href="/rubyonrails/upgrading-rails.html" class="sidebar-link">Upgrading Rails</a></li><li><a href="/rubyonrails/activerecord-locking.html" class="sidebar-link">ActiveRecord Locking</a></li><li><a href="/rubyonrails/debugging.html" class="sidebar-link">Debugging</a></li><li><a href="/rubyonrails/configure-angular-with-rails.html" class="sidebar-link">Configure Angular with Rails</a></li><li><a href="/rubyonrails/rails-logger.html" class="sidebar-link">Rails logger</a></li><li><a href="/rubyonrails/prawn-pdf.html" class="sidebar-link">Prawn PDF</a></li><li><a href="/rubyonrails/rails-api.html" class="sidebar-link">Rails API</a></li><li><a href="/rubyonrails/deploying-a-rails-app-on-heroku.html" class="sidebar-link">Deploying a Rails app on Heroku</a></li><li><a href="/rubyonrails/activesupport.html" class="sidebar-link">ActiveSupport</a></li><li><a href="/rubyonrails/form-helpers.html" class="sidebar-link">Form Helpers</a></li><li><a href="/rubyonrails/activerecord-transactions.html" class="sidebar-link">ActiveRecord Transactions</a></li><li><a href="/rubyonrails/rspec-and-ruby-on-rails.html" class="sidebar-link">RSpec and Ruby on Rails</a></li><li><a href="/rubyonrails/decorator-pattern.html" class="sidebar-link">Decorator pattern</a></li><li><a href="/rubyonrails/elasticsearch.html" class="sidebar-link">Elasticsearch</a></li><li><a href="/rubyonrails/react-with-rails-using-react-rails-gem.html" class="sidebar-link">React with Rails using react-rails gem</a></li><li><a href="/rubyonrails/rails-cookbook-advanced-rails-recipes-learnings-and-coding-techniques.html" class="sidebar-link">Rails Cookbook - Advanced rails recipes/learnings and coding techniques</a></li><li><a href="/rubyonrails/multipurpose-activerecord-columns.html" class="sidebar-link">Multipurpose ActiveRecord columns</a></li><li><a href="/rubyonrails/class-organization.html" class="sidebar-link">Class Organization</a></li><li><a href="/rubyonrails/shallow-routing.html" class="sidebar-link">Shallow Routing</a></li><li><a href="/rubyonrails/model-states-aasm.html" class="sidebar-link">Model states: AASM</a></li><li><a href="/rubyonrails/rails-5-api-authetication.html" class="sidebar-link">Rails 5 API Authetication</a></li><li><a href="/rubyonrails/testing-rails-applications.html" class="sidebar-link">Testing Rails Applications</a></li><li><a href="/rubyonrails/active-jobs.html" class="sidebar-link">Active Jobs</a></li><li><a href="/rubyonrails/rails-frameworks-over-the-years.html" class="sidebar-link">Rails frameworks over the years</a></li><li><a href="/rubyonrails/nested-form-in-ruby-on-rails.html" class="sidebar-link">Nested form in Ruby on Rails</a></li><li><a href="/rubyonrails/factory-girl.html" class="sidebar-link">Factory Girl</a></li><li><a href="/rubyonrails/import-whole-csv-files-from-specific-folder.html" class="sidebar-link">Import whole CSV files from specific folder</a></li><li><a href="/rubyonrails/tools-for-ruby-on-rails-code-optimization-and-cleanup.html" class="sidebar-link">Tools for Ruby on Rails code optimization and cleanup</a></li><li><a href="/rubyonrails/activejob.html" class="sidebar-link">ActiveJob</a></li><li><a href="/rubyonrails/active-model-serializers.html" class="sidebar-link">Active Model Serializers</a></li><li><a href="/rubyonrails/rails-engine-modular-rails.html" class="sidebar-link">Rails Engine -  Modular Rails</a></li><li><a href="/rubyonrails/single-table-inheritance.html" class="sidebar-link">Single Table Inheritance</a></li><li><a href="/rubyonrails/activerecord-transactions.html" class="sidebar-link">ActiveRecord Transactions</a></li><li><a href="/rubyonrails/turbolinks.html" class="sidebar-link">Turbolinks</a></li><li><a href="/rubyonrails/friendly-id.html" class="sidebar-link">Friendly ID</a></li><li><a href="/rubyonrails/securely-storing-authentication-keys.html" class="sidebar-link">Securely storing authentication keys</a></li><li><a href="/rubyonrails/authenticate-api-using-devise.html" class="sidebar-link">Authenticate Api using Devise</a></li><li><a href="/rubyonrails/integrating-react-js-with-rails-using-hyperloop.html" class="sidebar-link">Integrating React.js with Rails Using Hyperloop</a></li><li><a href="/rubyonrails/change-a-default-rails-application-enviornment.html" class="sidebar-link">Change a default Rails application enviornment</a></li><li><a href="/rubyonrails/rails-engines.html" class="sidebar-link">Rails -Engines</a></li><li><a href="/rubyonrails/adding-an-amazon-rds-to-your-rails-application.html" class="sidebar-link">Adding an Amazon RDS to your rails application</a></li><li><a href="/rubyonrails/payment-feature-in-rails.html" class="sidebar-link">Payment feature in rails</a></li><li><a href="/rubyonrails/rails-on-docker.html" class="sidebar-link">Rails on docker</a></li><li><a href="/rubyonrails/reserved-words.html" class="sidebar-link">Reserved Words</a></li><li><a href="/rubyonrails/add-admin-panel.html" class="sidebar-link">Add Admin Panel</a></li><li><a href="/rubyonrails/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="using-googlemaps-with-rails"><a href="#using-googlemaps-with-rails" class="header-anchor">#</a> Using GoogleMaps with Rails</h1> <h2 id="add-the-google-maps-javascript-tag-to-the-layout-header"><a href="#add-the-google-maps-javascript-tag-to-the-layout-header" class="header-anchor">#</a> Add the google maps javascript tag to the layout header</h2> <p>In order to have google maps work properly with <a href="https://github.com/turbolinks/turbolinks" target="_blank" rel="noopener noreferrer">turbolinks<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, add the javascript tag directly to the layout header rather than including it in a view.</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment"># app/views/layouts/my_layout.html.haml</span>
<span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span>
<span class="token operator">%</span>html<span class="token punctuation">{</span><span class="token symbol">:lang</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'en'</span><span class="token punctuation">}</span>
  <span class="token operator">%</span>head
    <span class="token operator">-</span> <span class="token comment"># ...</span>
    <span class="token operator">=</span> google_maps_api_script_tag

</code></pre></div><p>The <code>google_maps_api_script_tag</code> is best defined in a helper.</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment"># app/helpers/google_maps_helper.rb</span>
<span class="token keyword">module</span> <span class="token constant">GoogleMapsHelper</span>
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">google_maps_api_script_tag</span></span>
    javascript_include_tag google_maps_api_source
  <span class="token keyword">end</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">google_maps_api_source</span></span>
    <span class="token string">&quot;https://maps.googleapis.com/maps/api/js?key=<span class="token interpolation"><span class="token delimiter tag">#{</span>google_maps_api_key<span class="token delimiter tag">}</span></span>&quot;</span>
  <span class="token keyword">end</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">google_maps_api_key</span></span>
    <span class="token constant">Rails</span><span class="token punctuation">.</span>application<span class="token punctuation">.</span>secrets<span class="token punctuation">.</span>google_maps_api_key
  <span class="token keyword">end</span>
<span class="token keyword">end</span>

</code></pre></div><p>You can register your application with google and get your api key in the <a href="https://console.developers.google.com" target="_blank" rel="noopener noreferrer">google api console<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Google has a short <a href="https://developers.google.com/maps/documentation/javascript/get-api-key?hl=de" target="_blank" rel="noopener noreferrer">guide how to request an api key for the google maps javascript api<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>The api key is stored in the <code>secrets.yml</code>file:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment"># config/secrets.yml</span>
development<span class="token punctuation">:</span>
  google_maps_api_key<span class="token punctuation">:</span> <span class="token string">'...'</span>
  <span class="token comment"># ...</span>
production<span class="token punctuation">:</span>
  google_maps_api_key<span class="token punctuation">:</span> <span class="token string">'...'</span>
  <span class="token comment"># ...</span>

</code></pre></div><p>Don't forget to add <code>config/secrets.yml</code> to your <code>.gitignore</code> file and makre sure you don't commit the api key to the repository.</p> <h2 id="geocode-the-model"><a href="#geocode-the-model" class="header-anchor">#</a> Geocode the model</h2> <p>Suppose, your users and/or groups have profiles and you want to display address profile fields on a google map.</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment"># app/models/profile_fields/address.rb</span>
<span class="token keyword">class</span> <span class="token class-name">ProfileFields</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Address</span> <span class="token operator">&lt;</span> <span class="token constant">ProfileFields</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Base</span>
  <span class="token comment"># Attributes: </span>
  <span class="token comment"># label, e.g. &quot;Work address&quot;</span>
  <span class="token comment"># value, e.g. &quot;Willy-Brandt-Straße 1\n10557 Berlin&quot;</span>
<span class="token keyword">end</span>

</code></pre></div><p>A great way to geocode the addresses, i.e. provide <code>longitude</code> and <code>latitude</code> is the <a href="https://github.com/alexreisner/geocoder" target="_blank" rel="noopener noreferrer">geocoder gem<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>Add geocoder to your <code>Gemfile</code> and run <code>bundle</code> to install it.</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment"># Gemfile</span>
gem <span class="token string">'geocoder'</span><span class="token punctuation">,</span> <span class="token string">'~&gt; 1.3'</span>

</code></pre></div><p>Add database columns for <code>latitude</code> and <code>longitude</code> in order to save the location in the database. This is more efficient than querying the geocoding service every time you need the location. It's faster and you're not hitting the query limit so quickly.</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>➜ bin<span class="token operator">/</span>rails generate migration add_latitude_and_longitude_to_profile_fields \
    latitude<span class="token symbol">:float</span> longitude<span class="token symbol">:float</span>
➜ bin<span class="token operator">/</span>rails db<span class="token symbol">:migrate</span>  <span class="token comment"># Rails 5, or:</span>
➜ rake db<span class="token symbol">:migrate</span>       <span class="token comment"># Rails 3, 4</span>

</code></pre></div><p>Add the geocoding mechanism to your model. In this example, the address string is stored in the <code>value</code> attribute. Configure the geocoding to perform when the record has changed, and only whan a value is present:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment"># app/models/profile_fields/address.rb</span>
<span class="token keyword">class</span> <span class="token class-name">ProfileFields</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Address</span> <span class="token operator">&lt;</span> <span class="token constant">ProfileFields</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Base</span>
  geocoded_by <span class="token symbol">:value</span>
  after_validation <span class="token symbol">:geocode</span><span class="token punctuation">,</span> <span class="token keyword">if</span><span class="token punctuation">:</span> <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>address_field<span class="token punctuation">)</span><span class="token punctuation">{</span> 
    address_field<span class="token punctuation">.</span>value<span class="token punctuation">.</span>present<span class="token operator">?</span> <span class="token keyword">and</span> address_field<span class="token punctuation">.</span>value_changed<span class="token operator">?</span> 
  <span class="token punctuation">}</span>

<span class="token keyword">end</span>

</code></pre></div><p>By default, geocoder uses google as lookup service. It has lots of interesting features like distance calculations or proximity search. Fore more information, have a look at the <a href="https://github.com/alexreisner/geocoder" target="_blank" rel="noopener noreferrer">geocoder README<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="show-addresses-on-a-google-map-in-the-profile-view"><a href="#show-addresses-on-a-google-map-in-the-profile-view" class="header-anchor">#</a> Show addresses on a google map in the profile view</h2> <p>On the profile view, show the profile fields of a user or group in a list as well as the address fields on a google map.</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token operator">-</span> <span class="token comment"># app/views/profiles/show.html.haml</span>
<span class="token operator">%</span>h1 <span class="token constant">Contact</span> <span class="token constant">Information</span>
<span class="token punctuation">.</span>profile_fields
  <span class="token operator">=</span> render <span class="token variable">@profile_fields</span>
<span class="token punctuation">.</span>google_map<span class="token punctuation">{</span>data<span class="token punctuation">:</span> address_fields<span class="token punctuation">:</span> <span class="token variable">@address_fields</span><span class="token punctuation">.</span>to_json <span class="token punctuation">}</span>

</code></pre></div><p>The appropriate <code>@profile_fields</code> and <code>@address_fields</code> are set in the controller:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment"># app/controllers/profiles_controller.rb</span>
<span class="token keyword">class</span> <span class="token class-name">ProfilesController</span> <span class="token operator">&lt;</span> <span class="token constant">ApplicationController</span>
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">show</span></span>
    <span class="token comment"># ...</span>
    <span class="token variable">@profile_fields</span> <span class="token operator">=</span> <span class="token variable">@user_or_group</span><span class="token punctuation">.</span>profile_fields
    <span class="token variable">@address_fields</span> <span class="token operator">=</span> <span class="token variable">@profile_fields</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>type<span class="token punctuation">:</span> <span class="token string">'ProfileFields::Address'</span><span class="token punctuation">)</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>

</code></pre></div><p>Initialize the map, place the markers, set the zoom and other map settings with javascript.</p> <p><a href="http://i.stack.imgur.com/2n8le.png" target="_blank" rel="noopener noreferrer"><img src="http://i.stack.imgur.com/2n8le.png" alt="Example profile view"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="set-the-markers-on-the-map-with-javascript"><a href="#set-the-markers-on-the-map-with-javascript" class="header-anchor">#</a> Set the markers on the map with javascript</h2> <p>Suppose, there is a <code>.google_map</code> div, which will become the map, and which has the address fields to show as markers as <code>data</code> attribute.</p> <p>For example:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token punctuation">:</span><span class="token number">3000</span><span class="token operator">/</span>profiles<span class="token operator">/</span><span class="token number">123</span> <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;google_map&quot;</span> data<span class="token operator">-</span>address<span class="token operator">-</span>fields<span class="token operator">=</span>&quot;<span class="token punctuation">[</span>
  <span class="token punctuation">{</span>label<span class="token punctuation">:</span> <span class="token string">'Work address'</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token string">'Willy-Brandt-Straße 1\n10557 Berlin'</span><span class="token punctuation">,</span> 
  position<span class="token punctuation">:</span> <span class="token punctuation">{</span>lng<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> lat<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">]</span>&quot;<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>

</code></pre></div><p>To make use of the <code>$(document).ready</code> event with <a href="https://github.com/turbolinks/turbolinks" target="_blank" rel="noopener noreferrer">turbolinks<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> without managing the turbolinks events by hand, use the <a href="https://github.com/kossnocorp/jquery.turbolinks" target="_blank" rel="noopener noreferrer">jquery.turbolinks gem<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>If you want to perform some other operations with the map, later, for example filtering or info windows, it's convenient to have the map managed by a <a href="http://coffeescript.org/#classes" target="_blank" rel="noopener noreferrer">coffee script class<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment"># app/assets/javascripts/google_maps.js.coffee</span>
window<span class="token punctuation">.</span><span class="token constant">App</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">unless</span> <span class="token constant">App?</span>
<span class="token keyword">class</span> <span class="token class-name">App<span class="token punctuation">.</span>GoogleMap</span>
  constructor<span class="token punctuation">:</span> <span class="token punctuation">(</span>map_div<span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>
    <span class="token comment"># TODO: initialize the map</span>
    <span class="token comment"># TODO: set the markers</span>

</code></pre></div><p>When using several coffee script files, which are namespaced by default, it's convenient to define a global <code>App</code> namespace, which is shared by all coffee script files.</p> <p>Then, loop through (possibly several) <code>.google_map</code> divs and create one instance of the <code>App.GoogleMap</code> class for each of them.</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment"># app/assets/javascripts/google_maps.js.coffee</span>
<span class="token comment"># ...</span>
$<span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span>ready <span class="token operator">-</span><span class="token operator">&gt;</span>
  <span class="token constant">App</span><span class="token punctuation">.</span>google_maps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  $<span class="token punctuation">(</span><span class="token string">'.google_map'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">each</span> <span class="token operator">-</span><span class="token operator">&gt;</span>
    map_div <span class="token operator">=</span> $<span class="token punctuation">(</span>this<span class="token punctuation">)</span>
    map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constant">App</span><span class="token punctuation">.</span><span class="token constant">GoogleMap</span> map_div
    <span class="token constant">App</span><span class="token punctuation">.</span>google_maps<span class="token punctuation">.</span>push map

</code></pre></div><h2 id="initialize-the-map-using-a-coffee-script-class"><a href="#initialize-the-map-using-a-coffee-script-class" class="header-anchor">#</a> Initialize the map using a coffee script class.</h2> <p>Provided an <code>App.GoogleMap</code> <a href="http://coffeescript.org/#classes" target="_blank" rel="noopener noreferrer">coffee script class<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, the google map can be initialized like this:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment"># app/assets/javascripts/google_maps.js.coffee</span>
<span class="token comment"># ...</span>
<span class="token keyword">class</span> <span class="token class-name">App<span class="token punctuation">.</span>GoogleMap</span>
  map_div<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  map<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  
  constructor<span class="token punctuation">:</span> <span class="token punctuation">(</span>map_div<span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>
    <span class="token variable">@map_div</span> <span class="token operator">=</span> map_div
    <span class="token variable">@init_map</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token variable">@reference_the_map_as_data_attribute</span>

  <span class="token comment"># To access the GoogleMap object or the map object itself</span>
  <span class="token comment"># later via the DOM, for example </span>
  <span class="token comment"># </span>
  <span class="token comment">#     $('.google_map').data('GoogleMap')</span>
  <span class="token comment">#</span>
  <span class="token comment"># store references as data attribute of the map_div.</span>
  <span class="token comment">#</span>
  reference_the_map_as_data_attribute<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token operator">&gt;</span>
    <span class="token variable">@map_div</span><span class="token punctuation">.</span>data <span class="token string">'GoogleMap'</span><span class="token punctuation">,</span> this
    <span class="token variable">@map_div</span><span class="token punctuation">.</span>data <span class="token string">'map'</span><span class="token punctuation">,</span> <span class="token variable">@map</span>

  init_map<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token operator">&gt;</span>
    <span class="token variable">@map</span> <span class="token operator">=</span> <span class="token keyword">new</span> google<span class="token punctuation">.</span>maps<span class="token punctuation">.</span><span class="token constant">Map</span><span class="token punctuation">(</span><span class="token variable">@dom_element</span><span class="token punctuation">,</span> <span class="token variable">@map_configuration</span><span class="token punctuation">)</span> <span class="token keyword">if</span> google<span class="token operator">?</span>

  <span class="token comment"># `@map_div` is the jquery object. But google maps needs</span>
  <span class="token comment"># the real DOM element.</span>
  <span class="token comment">#</span>
  dom_element<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token operator">&gt;</span>
    <span class="token variable">@map_div</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

  map_configuration<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    scrollWheel<span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>

</code></pre></div><p>To learn more about the possible <code>map_configuration</code> options, have a look at google's <a href="https://developers.google.com/maps/documentation/javascript/3.exp/reference#MapOptions" target="_blank" rel="noopener noreferrer">MapOptions documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and their <a href="https://developers.google.com/maps/documentation/javascript/controls" target="_blank" rel="noopener noreferrer">guide to adding control elements<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>For reference, the class <a href="https://developers.google.com/maps/documentation/javascript/3.exp/reference#Map" target="_blank" rel="noopener noreferrer"><code>google.maps.Map</code>is extensively documented here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="initialize-the-map-markers-using-a-coffee-script-class"><a href="#initialize-the-map-markers-using-a-coffee-script-class" class="header-anchor">#</a> Initialize the map markers using a coffee script class</h2> <p>Provided an <code>App.GoogleMap</code> <a href="http://coffeescript.org/#classes" target="_blank" rel="noopener noreferrer">coffee script class<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and the marker information being stored in the <code>data-address-fields</code> attribute of the <code>.google_map</code> div, the map markers can be initialized on the map like this:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment"># app/assets/javascripts/google_maps.js.coffee</span>
<span class="token comment"># ...</span>
<span class="token keyword">class</span> <span class="token class-name">App<span class="token punctuation">.</span>GoogleMap</span>
  <span class="token comment"># ...</span>
  markers<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

  constructor<span class="token punctuation">:</span> <span class="token punctuation">(</span>map_div<span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>
    <span class="token comment"># ...</span>
    <span class="token variable">@init_markers</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  address_fields<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token operator">&gt;</span>
    <span class="token variable">@map_div</span><span class="token punctuation">.</span>data<span class="token punctuation">(</span><span class="token string">'address-fields'</span><span class="token punctuation">)</span>

  init_markers<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token operator">&gt;</span>
    <span class="token keyword">self</span> <span class="token operator">=</span> this  <span class="token comment"># to reference the instance as `self` when `this` is redefined.</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>markers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> address_field <span class="token keyword">in</span> <span class="token keyword">self</span><span class="token punctuation">.</span>address_fields<span class="token punctuation">(</span><span class="token punctuation">)</span>
      marker <span class="token operator">=</span> <span class="token keyword">new</span> google<span class="token punctuation">.</span>maps<span class="token punctuation">.</span><span class="token constant">Marker</span> <span class="token punctuation">{</span>
        map<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>map<span class="token punctuation">,</span>
        position<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          lng<span class="token punctuation">:</span> address_field<span class="token punctuation">.</span>longitude<span class="token punctuation">,</span>
          lat<span class="token punctuation">:</span> address_field<span class="token punctuation">.</span>latitude
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment"># # or, if `position` is defined in `ProfileFields::Address#as_json`:</span>
        <span class="token comment"># position: address_field.position,</span>
        title<span class="token punctuation">:</span> address_field<span class="token punctuation">.</span>value
      <span class="token punctuation">}</span>
      <span class="token keyword">self</span><span class="token punctuation">.</span>markers<span class="token punctuation">.</span>push marker

</code></pre></div><p>To learn more about marker options, have a look at google's <a href="https://developers.google.com/maps/documentation/javascript/3.exp/reference#MarkerOptions" target="_blank" rel="noopener noreferrer">MarkerOptions documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and their <a href="https://developers.google.com/maps/documentation/javascript/markers" target="_blank" rel="noopener noreferrer">guide to markers<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="auto-zoom-a-map-using-a-coffee-script-class"><a href="#auto-zoom-a-map-using-a-coffee-script-class" class="header-anchor">#</a> Auto-zoom a map using a coffee script class</h2> <p>Provided an <code>App.GoogleMap</code> <a href="http://coffeescript.org/#classes" target="_blank" rel="noopener noreferrer">coffee script class<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>  with the <code>google.maps.Map</code> stored as <code>@map</code> and the <code>google.maps.Marker</code>s stored as <code>@markers</code>, the map can be auto-zoomed, i.e. adjusted that all markers are visible, like this:
on the map like this:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment"># app/assets/javascripts/google_maps.js.coffee</span>
<span class="token comment"># ...</span>
<span class="token keyword">class</span> <span class="token class-name">App<span class="token punctuation">.</span>GoogleMap</span>
  <span class="token comment"># ...</span>
  bounds<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  constructor<span class="token punctuation">:</span> <span class="token punctuation">(</span>map_div<span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>
    <span class="token comment"># ...</span>
    <span class="token variable">@auto_zoom</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  auto_zoom<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token operator">&gt;</span>
    <span class="token variable">@init_bounds</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># TODO: Maybe, adjust the zoom to have a maximum or </span>
    <span class="token comment"># minimum zoom level, here.</span>

  init_bounds<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token operator">&gt;</span>
    <span class="token variable">@bounds</span> <span class="token operator">=</span> <span class="token keyword">new</span> google<span class="token punctuation">.</span>maps<span class="token punctuation">.</span><span class="token constant">LatLngBounds</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> marker <span class="token keyword">in</span> <span class="token variable">@markers</span>
      <span class="token variable">@bounds</span><span class="token punctuation">.</span><span class="token keyword">extend</span> marker<span class="token punctuation">.</span>position
    <span class="token variable">@map</span><span class="token punctuation">.</span>fitBounds <span class="token variable">@bounds</span>

</code></pre></div><p>To learn more about bounds, have a look at google's <a href="https://developers.google.com/maps/documentation/javascript/3.exp/reference#LatLngBounds" target="_blank" rel="noopener noreferrer">LatLngBounds documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="exposing-the-model-properties-as-json"><a href="#exposing-the-model-properties-as-json" class="header-anchor">#</a> Exposing the model properties as json</h2> <p>To display address profile fields as markers on a google map, the address field objects need to be passed as json objects to javascript.</p> <h3 id="regular-database-attributes"><a href="#regular-database-attributes" class="header-anchor">#</a> Regular database attributes</h3> <p>When calling <code>to_json</code> on an <a href="http://guides.rubyonrails.org/active_record_basics.html#creating-active-record-models" target="_blank" rel="noopener noreferrer"><code>ApplicationRecord</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> object, the database attributes are automatically exposed.</p> <p>Given a <code>ProfileFields::Address</code> model with <code>label</code>, <code>value</code>, <code>longitude</code> and <code>latitude</code> attributes, <code>address_field.as_json</code> results in a <code>Hash</code>, e.g. representation,</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>address_field<span class="token punctuation">.</span>as_json  <span class="token comment"># =&gt;</span>
  <span class="token punctuation">{</span>label<span class="token punctuation">:</span> <span class="token string">&quot;Work address&quot;</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token string">&quot;Willy-Brandt-Straße 1\n10557 Berlin&quot;</span><span class="token punctuation">,</span>
    longitude<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> latitude<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>

</code></pre></div><p>which is converted to a json string by <code>to_json</code>:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>address_field<span class="token punctuation">.</span>to_json  <span class="token comment"># =&gt;</span>
  &quot;<span class="token punctuation">{</span>\&quot;label\&quot;<span class="token punctuation">:</span>\&quot;<span class="token constant">Work</span> address\&quot;<span class="token punctuation">,</span>\&quot;value\&quot;<span class="token punctuation">:</span>\&quot;<span class="token constant">Willy</span><span class="token operator">-</span><span class="token constant">Brandt</span><span class="token operator">-</span><span class="token constant">Stra</span>ße <span class="token number">1</span>\\n
    <span class="token number">10557</span> <span class="token constant">Berlin</span>\<span class="token string">&quot;,\&quot;longitude\&quot;:...,\&quot;latitude\&quot;:...}&quot;</span>

</code></pre></div><p>This is useful because it allows to use <code>label</code> and <code>value</code> later in javascript, for example to show tool tips for the map markers.</p> <h3 id="other-attributes"><a href="#other-attributes" class="header-anchor">#</a> Other attributes</h3> <p>Other virtual attributes can be exposed by overriding the <code>as_json</code> method.</p> <p>For example, to expose a <code>title</code> attribute, include it in the merged <code>as_json</code> hash:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment"># app/models/profile_fields/address.rb</span>
<span class="token keyword">class</span> <span class="token class-name">ProfileFields</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Address</span> <span class="token operator">&lt;</span> <span class="token constant">ProfileFields</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Base</span>
  <span class="token comment"># ...</span>

  <span class="token comment"># For example: &quot;John Doe, Work address&quot;</span>
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">title</span></span>
    <span class="token string">&quot;<span class="token interpolation"><span class="token delimiter tag">#{</span><span class="token keyword">self</span><span class="token punctuation">.</span>parent<span class="token punctuation">.</span>name<span class="token delimiter tag">}</span></span>, <span class="token interpolation"><span class="token delimiter tag">#{</span><span class="token keyword">self</span><span class="token punctuation">.</span>label<span class="token delimiter tag">}</span></span>&quot;</span>
  <span class="token keyword">end</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">as_json</span></span>
    <span class="token keyword">super</span><span class="token punctuation">.</span>merge <span class="token punctuation">{</span>
      title<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>title
    <span class="token punctuation">}</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>

</code></pre></div><p>The above example uses <a href="http://rubylearning.com/satishtalim/ruby_overriding_methods.html" target="_blank" rel="noopener noreferrer"><code>super</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to call the original <code>as_json</code> method, which returns the original attribute hash of the object, and merges it with the required position hash.</p> <p>To understand the difference between <code>as_json</code> and <code>to_json</code>, have a look at <a href="http://jonathanjulian.com/2010/04/rails-to_json-or-as_json/" target="_blank" rel="noopener noreferrer">this blog post by jjulian<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h3 id="position"><a href="#position" class="header-anchor">#</a> Position</h3> <p>To render markers, the google maps api, by default, requires a <code>position</code> hash which has longitude and latitude stored as <code>lng</code> and <code>lat</code> respectively.</p> <p>This position hash can be created in javascript, later, or here when defining the json representation of the address field:</p> <p>To provide this <code>position</code> as json attribute of the address field, just override the <code>as_json</code> method on the model.</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment"># app/models/profile_fields/address.rb</span>
<span class="token keyword">class</span> <span class="token class-name">ProfileFields</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Address</span> <span class="token operator">&lt;</span> <span class="token constant">ProfileFields</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Base</span>
  <span class="token comment"># ...</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">as_json</span></span>
    <span class="token keyword">super</span><span class="token punctuation">.</span>merge <span class="token punctuation">{</span>
      <span class="token comment"># ...</span>
      position<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        lng<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>longitude<span class="token punctuation">,</span>
        lat<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>latitude
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>

</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/rubyonrails/using-googlemaps-with-rails.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/rubyonrails/i18n-internationalization.html" class="prev">
        I18n - Internationalization
      </a></span> <span class="next"><a href="/rubyonrails/file-uploads.html">
        File Uploads
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/3193.7711c754.js" defer></script>
  </body>
</html>
