<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Ruby on Rails - ActionMailer</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Basic Mailer, Generating a new mailer, Adding Attachments, ActionMailer Callbacks, ActionMailer Interceptor, Generate a Scheduled Newsletter">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="Ruby on Rails - ActionMailer">
    <meta property="og:description" content="Basic Mailer, Generating a new mailer, Adding Attachments, ActionMailer Callbacks, ActionMailer Interceptor, Generate a Scheduled Newsletter">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/rubyonrails/actionmailer.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="Ruby on Rails - ActionMailer">
    <meta name="twitter:description" content="Basic Mailer, Generating a new mailer, Adding Attachments, ActionMailer Callbacks, ActionMailer Interceptor, Generate a Scheduled Newsletter">
    <meta name="twitter:url" content="/rubyonrails/actionmailer.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/3124.121921aa.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Ruby on Rails</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rubyonrails/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/rubyonrails/getting-started-with-ruby-on-rails.html" class="sidebar-link">Getting started with Ruby on Rails</a></li><li><a href="/rubyonrails/routing.html" class="sidebar-link">Routing</a></li><li><a href="/rubyonrails/activerecord.html" class="sidebar-link">ActiveRecord</a></li><li><a href="/rubyonrails/views.html" class="sidebar-link">Views</a></li><li><a href="/rubyonrails/activerecord-migrations.html" class="sidebar-link">ActiveRecord Migrations</a></li><li><a href="/rubyonrails/rails-best-practices.html" class="sidebar-link">Rails Best Practices</a></li><li><a href="/rubyonrails/naming-conventions.html" class="sidebar-link">Naming Conventions</a></li><li><a href="/rubyonrails/actioncable.html" class="sidebar-link">ActionCable</a></li><li><a href="/rubyonrails/activemodel.html" class="sidebar-link">ActiveModel</a></li><li><a href="/rubyonrails/user-authentication-in-rails.html" class="sidebar-link">User Authentication in Rails</a></li><li><a href="/rubyonrails/activerecord-associations.html" class="sidebar-link">ActiveRecord Associations</a></li><li><a href="/rubyonrails/activerecord-validations.html" class="sidebar-link">ActiveRecord Validations</a></li><li><a href="/rubyonrails/activerecord-query-interface.html" class="sidebar-link">ActiveRecord Query Interface</a></li><li><a href="/rubyonrails/actionmailer.html" aria-current="page" class="active sidebar-link">ActionMailer</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rubyonrails/actionmailer.html#basic-mailer" class="sidebar-link">Basic Mailer</a></li><li class="sidebar-sub-header"><a href="/rubyonrails/actionmailer.html#generating-a-new-mailer" class="sidebar-link">Generating a new mailer</a></li><li class="sidebar-sub-header"><a href="/rubyonrails/actionmailer.html#adding-attachments" class="sidebar-link">Adding Attachments</a></li><li class="sidebar-sub-header"><a href="/rubyonrails/actionmailer.html#actionmailer-callbacks" class="sidebar-link">ActionMailer Callbacks</a></li><li class="sidebar-sub-header"><a href="/rubyonrails/actionmailer.html#actionmailer-interceptor" class="sidebar-link">ActionMailer Interceptor</a></li><li class="sidebar-sub-header"><a href="/rubyonrails/actionmailer.html#generate-a-scheduled-newsletter" class="sidebar-link">Generate a Scheduled Newsletter</a></li></ul></li><li><a href="/rubyonrails/rails-generate-commands.html" class="sidebar-link">Rails generate commands</a></li><li><a href="/rubyonrails/configuration.html" class="sidebar-link">Configuration</a></li><li><a href="/rubyonrails/i18n-internationalization.html" class="sidebar-link">I18n - Internationalization</a></li><li><a href="/rubyonrails/using-googlemaps-with-rails.html" class="sidebar-link">Using GoogleMaps with Rails</a></li><li><a href="/rubyonrails/file-uploads.html" class="sidebar-link">File Uploads</a></li><li><a href="/rubyonrails/caching.html" class="sidebar-link">Caching</a></li><li><a href="/rubyonrails/actioncontroller.html" class="sidebar-link">ActionController</a></li><li><a href="/rubyonrails/configuration.html" class="sidebar-link">Configuration</a></li><li><a href="/rubyonrails/safe-constantize.html" class="sidebar-link">Safe Constantize</a></li><li><a href="/rubyonrails/rails-5.html" class="sidebar-link">Rails 5</a></li><li><a href="/rubyonrails/authorization-with-cancan.html" class="sidebar-link">Authorization with CanCan</a></li><li><a href="/rubyonrails/mongoid.html" class="sidebar-link">Mongoid</a></li><li><a href="/rubyonrails/gems.html" class="sidebar-link">Gems</a></li><li><a href="/rubyonrails/change-default-timezone.html" class="sidebar-link">Change default timezone</a></li><li><a href="/rubyonrails/asset-pipeline.html" class="sidebar-link">Asset Pipeline</a></li><li><a href="/rubyonrails/upgrading-rails.html" class="sidebar-link">Upgrading Rails</a></li><li><a href="/rubyonrails/activerecord-locking.html" class="sidebar-link">ActiveRecord Locking</a></li><li><a href="/rubyonrails/debugging.html" class="sidebar-link">Debugging</a></li><li><a href="/rubyonrails/configure-angular-with-rails.html" class="sidebar-link">Configure Angular with Rails</a></li><li><a href="/rubyonrails/rails-logger.html" class="sidebar-link">Rails logger</a></li><li><a href="/rubyonrails/prawn-pdf.html" class="sidebar-link">Prawn PDF</a></li><li><a href="/rubyonrails/rails-api.html" class="sidebar-link">Rails API</a></li><li><a href="/rubyonrails/deploying-a-rails-app-on-heroku.html" class="sidebar-link">Deploying a Rails app on Heroku</a></li><li><a href="/rubyonrails/activesupport.html" class="sidebar-link">ActiveSupport</a></li><li><a href="/rubyonrails/form-helpers.html" class="sidebar-link">Form Helpers</a></li><li><a href="/rubyonrails/activerecord-transactions.html" class="sidebar-link">ActiveRecord Transactions</a></li><li><a href="/rubyonrails/rspec-and-ruby-on-rails.html" class="sidebar-link">RSpec and Ruby on Rails</a></li><li><a href="/rubyonrails/decorator-pattern.html" class="sidebar-link">Decorator pattern</a></li><li><a href="/rubyonrails/elasticsearch.html" class="sidebar-link">Elasticsearch</a></li><li><a href="/rubyonrails/react-with-rails-using-react-rails-gem.html" class="sidebar-link">React with Rails using react-rails gem</a></li><li><a href="/rubyonrails/rails-cookbook-advanced-rails-recipes-learnings-and-coding-techniques.html" class="sidebar-link">Rails Cookbook - Advanced rails recipes/learnings and coding techniques</a></li><li><a href="/rubyonrails/multipurpose-activerecord-columns.html" class="sidebar-link">Multipurpose ActiveRecord columns</a></li><li><a href="/rubyonrails/class-organization.html" class="sidebar-link">Class Organization</a></li><li><a href="/rubyonrails/shallow-routing.html" class="sidebar-link">Shallow Routing</a></li><li><a href="/rubyonrails/model-states-aasm.html" class="sidebar-link">Model states: AASM</a></li><li><a href="/rubyonrails/rails-5-api-authetication.html" class="sidebar-link">Rails 5 API Authetication</a></li><li><a href="/rubyonrails/testing-rails-applications.html" class="sidebar-link">Testing Rails Applications</a></li><li><a href="/rubyonrails/active-jobs.html" class="sidebar-link">Active Jobs</a></li><li><a href="/rubyonrails/rails-frameworks-over-the-years.html" class="sidebar-link">Rails frameworks over the years</a></li><li><a href="/rubyonrails/nested-form-in-ruby-on-rails.html" class="sidebar-link">Nested form in Ruby on Rails</a></li><li><a href="/rubyonrails/factory-girl.html" class="sidebar-link">Factory Girl</a></li><li><a href="/rubyonrails/import-whole-csv-files-from-specific-folder.html" class="sidebar-link">Import whole CSV files from specific folder</a></li><li><a href="/rubyonrails/tools-for-ruby-on-rails-code-optimization-and-cleanup.html" class="sidebar-link">Tools for Ruby on Rails code optimization and cleanup</a></li><li><a href="/rubyonrails/activejob.html" class="sidebar-link">ActiveJob</a></li><li><a href="/rubyonrails/active-model-serializers.html" class="sidebar-link">Active Model Serializers</a></li><li><a href="/rubyonrails/rails-engine-modular-rails.html" class="sidebar-link">Rails Engine -  Modular Rails</a></li><li><a href="/rubyonrails/single-table-inheritance.html" class="sidebar-link">Single Table Inheritance</a></li><li><a href="/rubyonrails/activerecord-transactions.html" class="sidebar-link">ActiveRecord Transactions</a></li><li><a href="/rubyonrails/turbolinks.html" class="sidebar-link">Turbolinks</a></li><li><a href="/rubyonrails/friendly-id.html" class="sidebar-link">Friendly ID</a></li><li><a href="/rubyonrails/securely-storing-authentication-keys.html" class="sidebar-link">Securely storing authentication keys</a></li><li><a href="/rubyonrails/authenticate-api-using-devise.html" class="sidebar-link">Authenticate Api using Devise</a></li><li><a href="/rubyonrails/integrating-react-js-with-rails-using-hyperloop.html" class="sidebar-link">Integrating React.js with Rails Using Hyperloop</a></li><li><a href="/rubyonrails/change-a-default-rails-application-enviornment.html" class="sidebar-link">Change a default Rails application enviornment</a></li><li><a href="/rubyonrails/rails-engines.html" class="sidebar-link">Rails -Engines</a></li><li><a href="/rubyonrails/adding-an-amazon-rds-to-your-rails-application.html" class="sidebar-link">Adding an Amazon RDS to your rails application</a></li><li><a href="/rubyonrails/payment-feature-in-rails.html" class="sidebar-link">Payment feature in rails</a></li><li><a href="/rubyonrails/rails-on-docker.html" class="sidebar-link">Rails on docker</a></li><li><a href="/rubyonrails/reserved-words.html" class="sidebar-link">Reserved Words</a></li><li><a href="/rubyonrails/add-admin-panel.html" class="sidebar-link">Add Admin Panel</a></li><li><a href="/rubyonrails/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="actionmailer"><a href="#actionmailer" class="header-anchor">#</a> ActionMailer</h1> <p>Action Mailer allows you to send emails from your application using mailer classes and views. Mailers work very similarly to controllers. They inherit from ActionMailer::Base and live in app/mailers, and they have associated views that appear in app/views.</p> <h2 id="basic-mailer"><a href="#basic-mailer" class="header-anchor">#</a> Basic Mailer</h2> <p>This example uses four different files:</p> <ul><li>The User model</li> <li>The User mailer</li> <li>The html template for the email</li> <li>The plain-text template for the email</li></ul> <p>In this case, the user model calls the <code>approved</code> method in the mailer and passes the <code>post</code> that has been approved (the <code>approved</code> method in the model may be called by a callback, from a controller method, etc). Then, the mailer generates the email from either the html or plain-text template using the information from the passed-in <code>post</code> (e.g. the title). By default, the mailer uses the template with the same name as the method in the mailer (which is why both the mailer method and the templates have the name 'approved').</p> <h3 id="user-mailer-rb"><a href="#user-mailer-rb" class="header-anchor">#</a> user_mailer.rb</h3> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">UserMailer</span> <span class="token operator">&lt;</span> <span class="token constant">ActionMailer</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Base</span>
  default from<span class="token punctuation">:</span> <span class="token string">&quot;donotreply@example.com&quot;</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">approved</span></span><span class="token punctuation">(</span>post<span class="token punctuation">)</span>
      <span class="token variable">@title</span> <span class="token operator">=</span> post<span class="token punctuation">.</span>title
      <span class="token variable">@user</span> <span class="token operator">=</span> post<span class="token punctuation">.</span>user
      mail<span class="token punctuation">(</span>to<span class="token punctuation">:</span> <span class="token variable">@user</span><span class="token punctuation">.</span>email<span class="token punctuation">,</span> subject<span class="token punctuation">:</span> <span class="token string">&quot;Your Post was Approved!&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>

</code></pre></div><h3 id="user-rb"><a href="#user-rb" class="header-anchor">#</a> user.rb</h3> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token keyword">def</span> <span class="token method-definition"><span class="token function">approved</span></span><span class="token punctuation">(</span>post<span class="token punctuation">)</span>
    <span class="token constant">UserMailer</span><span class="token punctuation">.</span>approved<span class="token punctuation">(</span>post<span class="token punctuation">)</span>
<span class="token keyword">end</span>

</code></pre></div><h3 id="approved-html-erb"><a href="#approved-html-erb" class="header-anchor">#</a> approved.html.erb</h3> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html <span class="token constant">PUBLIC</span> <span class="token string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="token string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>meta http<span class="token operator">-</span>equiv<span class="token operator">=</span><span class="token string">&quot;Content-Type&quot;</span> content<span class="token operator">=</span><span class="token string">&quot;text/html; charset=utf-8&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span><span class="token constant">Post</span> <span class="token constant">Approved</span><span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span><span class="token constant">Congrats</span> <span class="token operator">&lt;</span><span class="token string">%= @user.name %&gt;! Your post (#&lt;%=</span> <span class="token variable">@title</span> <span class="token string">%&gt;) has been approved!&lt;/h2&gt;</span>
        <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token constant">We</span> look forward to your future posts<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>

</code></pre></div><h3 id="approved-text-erb"><a href="#approved-text-erb" class="header-anchor">#</a> approved.text.erb</h3> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">Congrats</span> <span class="token operator">&lt;</span><span class="token string">%= @user.name %&gt;! Your post (#&lt;%=</span> <span class="token variable">@title</span> <span class="token operator">%</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> has been approved<span class="token operator">!</span>
<span class="token constant">We</span> look forward to your future posts<span class="token operator">!</span>

</code></pre></div><h2 id="generating-a-new-mailer"><a href="#generating-a-new-mailer" class="header-anchor">#</a> Generating a new mailer</h2> <p>To generate a new mailer, enter the following command</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>rails generate mailer <span class="token constant">PostMailer</span> 

</code></pre></div><p>This will generate a blank template file in <code>app/mailers/post_mailer.rb</code> named <strong>PostMailer</strong></p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">PostMailer</span> <span class="token operator">&lt;</span> <span class="token constant">ApplicationMailer</span>
<span class="token keyword">end</span>

</code></pre></div><p>Two layout files will also be generated for the email view, one for the html format and one for the text format.</p> <p>If you prefer not to use the generator, you can create your own mailers. Make sure they inherit from <code>ActionMailer::Base</code></p> <h2 id="adding-attachments"><a href="#adding-attachments" class="header-anchor">#</a> Adding Attachments</h2> <p><code>ActionMailer</code> also allows attaching files.</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>attachments<span class="token punctuation">[</span><span class="token string">'filename.jpg'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">File</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token string">'/path/to/filename.jpg'</span><span class="token punctuation">)</span>

</code></pre></div><p>By default, attachments will be encoded with <code>Base64</code>. To change this, you can add a hash to the attachments method.</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>attachments<span class="token punctuation">[</span><span class="token string">'filename.jpg'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  mime_type<span class="token punctuation">:</span> <span class="token string">'application/gzip'</span><span class="token punctuation">,</span>
  encoding<span class="token punctuation">:</span> <span class="token string">'SpecialEncoding'</span><span class="token punctuation">,</span>
  content<span class="token punctuation">:</span> encoded_content
<span class="token punctuation">}</span>

</code></pre></div><p>You can also add inline attachments</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>attachments<span class="token punctuation">.</span>inline<span class="token punctuation">[</span><span class="token string">'image.jpg'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">File</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token string">'/path/to/image.jpg'</span><span class="token punctuation">)</span>

</code></pre></div><h2 id="actionmailer-callbacks"><a href="#actionmailer-callbacks" class="header-anchor">#</a> ActionMailer Callbacks</h2> <p>ActionMailer supports three callbacks</p> <ul><li>before_action</li> <li>after_action</li> <li>around_action</li></ul> <p>Provide these in your Mailer class</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">UserMailer</span> <span class="token operator">&lt;</span> <span class="token constant">ApplicationMailer</span>
  after_action <span class="token symbol">:set_delivery_options</span><span class="token punctuation">,</span> <span class="token symbol">:prevent_delivery_to_guests</span><span class="token punctuation">,</span> <span class="token symbol">:set_business_headers</span>

</code></pre></div><p>Then create these methods under the <code>private</code> keyword</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token keyword">private</span>
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">set_delivery_options</span></span>
  <span class="token keyword">end</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">prevent_delivery_to_guests</span></span>
  <span class="token keyword">end</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">set_business_headers</span></span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>

</code></pre></div><h2 id="actionmailer-interceptor"><a href="#actionmailer-interceptor" class="header-anchor">#</a> ActionMailer Interceptor</h2> <p>Action Mailer provides hooks into the interceptor methods. These allow you to register classes that are called during the mail delivery life cycle.</p> <p>An interceptor class must implement the :delivering_email(message) method which will be called before the email is sent, allowing you to make modifications to the email before it hits the delivery agents. Your class should make any needed modifications directly to the passed in Mail::Message instance.</p> <p>It can be useful for developers to send email to themselves not real users.</p> <p>Example of registering an actionmailer interceptor:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment"># config/initializers/override_mail_recipient.rb</span>

<span class="token keyword">if</span> <span class="token constant">Rails</span><span class="token punctuation">.</span>env<span class="token punctuation">.</span>development<span class="token operator">?</span> <span class="token keyword">or</span> <span class="token constant">Rails</span><span class="token punctuation">.</span>env<span class="token punctuation">.</span>test<span class="token operator">?</span>
  <span class="token keyword">class</span> <span class="token class-name">OverrideMailRecipient</span>
    <span class="token keyword">def</span> <span class="token method-definition"><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">delivering_email</span></span><span class="token punctuation">(</span>mail<span class="token punctuation">)</span>
      mail<span class="token punctuation">.</span>subject <span class="token operator">=</span> <span class="token string">'This is dummy subject'</span>
      mail<span class="token punctuation">.</span>bcc <span class="token operator">=</span> <span class="token string">'test_bcc@noemail.com'</span>
      mail<span class="token punctuation">.</span>to <span class="token operator">=</span> <span class="token string">'test@noemail.com'</span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
  <span class="token constant">ActionMailer</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Base</span><span class="token punctuation">.</span>register_interceptor<span class="token punctuation">(</span><span class="token constant">OverrideMailRecipient</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

</code></pre></div><h2 id="generate-a-scheduled-newsletter"><a href="#generate-a-scheduled-newsletter" class="header-anchor">#</a> Generate a Scheduled Newsletter</h2> <p>Create the <strong>Newsletter</strong> model:</p> <p>Create the <strong>Newsletter</strong> controller:</p> <p>After that, change the <strong>create.html.erb</strong> view to the nex name. We will convert this file to and <strong>partial view</strong> which will be stored inside the <strong>Footer</strong>. The name will be <strong>_form.html.erb</strong>.</p> <th align="left">Change name file from:</th><th align="left">To:</th>
|---|---|---|---|---|---|---|---|---|---
<td align="left">app/views/**newsletters/create.html.erb**</td><td align="left">app/views/**newsletters/_form.html.erb**</td> <p>After that set the routes:</p> <p>Later on, we need to set the form we will use to save each mail:</p> <p>And after that, insert on the footer:</p> <p>Now, install the -<strong>letter_opener</strong>- to can preview email in the default browser instead of sending it. This means you do not need to set up email delivery in your development environment, and you no longer need to worry about accidentally sending a test email to someone else's address.</p> <p>First add the gem to your development environment and run the bundle command to install it.</p> <p>Then set the delivery method in the Development Environment:</p> <p>Now, create an <strong>Mailer Structure</strong> to manage the whole mailers which we will work. In terminal</p> <p>And inside the <strong>UserMailer</strong>, we have to create a method called <strong>Newsletter Mailer</strong> which will be created to contain inside on the lastest blog post and will be fired with a rake action. We will assume that you had a blog structure created before.</p> <p>After that, create the <strong>Mailer Template</strong>:</p> <p>Since we want to send the email as a separate process, let’s create a Rake task to fire off the email. Add a new file called email_tasks.rake to lib/tasks directory of your Rails application:</p> <p>The send_digest_email: :environment means to load the Rails environment before running the task, so you can access the application classes (like UserMailer) within the task.</p> <p>Now, running the command rake -T will list the newly created Rake task. Test everything works by running the task and checking whether the email is sent or not.</p> <p>To test if the mailer method works, run the rake command:</p> <p>At this point, we have a working rake task which can be scheduled using <strong>crontab</strong>. So we will install the <strong>Whenever Gem</strong> which is used to provide a clear syntax for writing and deploying cron jobs.</p> <p>After that, run the next command to create an initial config/schedule.rb file for you (as long as the config folder is already present in your project).</p> <p>Now, inside the schedule file, we have to create our <strong>CRON JOB</strong> and call the mailer method inside determining the CRON JOB to operate some tasks without assistance and in a selected range of time. You can use different types of syntax as is explained on this <a href="https://github.com/javan/whenever" target="_blank" rel="noopener noreferrer">link<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <img src="https://s3-us-west-2.amazonaws.com/webres-studio.com/wiki_tuto_images/Cron+Job+Syntax" alt="Cron Job Basic Syntax"> <img src="https://s3-us-west-2.amazonaws.com/webres-studio.com/wiki_tuto_images/Cron+Jobs+translated+with+Whenever+Gem" alt="Cron Jobs with Whenever"> <p>Now to test the <strong>Cron Job</strong> was succesfully created we can use the next command to read since terminal, our scheduled job in CRON SYNTAX:</p> <p>Now, to run the test in Development Environment, is wise to set the next line on the <strong>application.rb</strong> principal file to let the application knows where are the models it will use.</p> <p>Now to let <strong>Capistrano V3</strong> save the new <strong>Cron Job</strong> inside the server and the trigger which will fired up the execution of this task, we have to add the next requirement:</p> <p>And insert into the <strong>deploy</strong> file the identifier which <strong>CRON JOB</strong> will use about the <strong>environment</strong> and the name of the <strong>application</strong>.</p> <p>And ready, after save changes on each file, run the capistrano deploy command:</p> <p>And now your JOB was created and calendarize to run the Mailer Method which is what i want and in the range of time we set on this files.</p> <h4 id="remarks"><a href="#remarks" class="header-anchor">#</a> Remarks</h4> <p>It is advisable to process the sending of email asynchronously so as not to tie up your web server. This can be done through various services such as <code>delayed_job</code>.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/rubyonrails/actionmailer.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/rubyonrails/activerecord-query-interface.html" class="prev">
        ActiveRecord Query Interface
      </a></span> <span class="next"><a href="/rubyonrails/rails-generate-commands.html">
        Rails generate commands
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/3124.121921aa.js" defer></script>
  </body>
</html>
