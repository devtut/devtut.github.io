<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Ruby on Rails - ActiveRecord Query Interface</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content=".where, .where with an array, Scopes, Get first and last record, where.not, Ordering, Includes, .find_by, .delete_all, ActiveRecord case insensitive search, .group and .count, .distinct (or .uniq), Joins, Limit and Offset, ActiveRecord Bang (!) methods">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="Ruby on Rails - ActiveRecord Query Interface">
    <meta property="og:description" content=".where, .where with an array, Scopes, Get first and last record, where.not, Ordering, Includes, .find_by, .delete_all, ActiveRecord case insensitive search, .group and .count, .distinct (or .uniq), Joins, Limit and Offset, ActiveRecord Bang (!) methods">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/rubyonrails/activerecord-query-interface.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="Ruby on Rails - ActiveRecord Query Interface">
    <meta name="twitter:description" content=".where, .where with an array, Scopes, Get first and last record, where.not, Ordering, Includes, .find_by, .delete_all, ActiveRecord case insensitive search, .group and .count, .distinct (or .uniq), Joins, Limit and Offset, ActiveRecord Bang (!) methods">
    <meta name="twitter:url" content="/rubyonrails/activerecord-query-interface.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/3132.f3f3dbdc.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Ruby on Rails</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rubyonrails/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/rubyonrails/getting-started-with-ruby-on-rails.html" class="sidebar-link">Getting started with Ruby on Rails</a></li><li><a href="/rubyonrails/routing.html" class="sidebar-link">Routing</a></li><li><a href="/rubyonrails/activerecord.html" class="sidebar-link">ActiveRecord</a></li><li><a href="/rubyonrails/views.html" class="sidebar-link">Views</a></li><li><a href="/rubyonrails/activerecord-migrations.html" class="sidebar-link">ActiveRecord Migrations</a></li><li><a href="/rubyonrails/rails-best-practices.html" class="sidebar-link">Rails Best Practices</a></li><li><a href="/rubyonrails/naming-conventions.html" class="sidebar-link">Naming Conventions</a></li><li><a href="/rubyonrails/actioncable.html" class="sidebar-link">ActionCable</a></li><li><a href="/rubyonrails/activemodel.html" class="sidebar-link">ActiveModel</a></li><li><a href="/rubyonrails/user-authentication-in-rails.html" class="sidebar-link">User Authentication in Rails</a></li><li><a href="/rubyonrails/activerecord-associations.html" class="sidebar-link">ActiveRecord Associations</a></li><li><a href="/rubyonrails/activerecord-validations.html" class="sidebar-link">ActiveRecord Validations</a></li><li><a href="/rubyonrails/activerecord-query-interface.html" aria-current="page" class="active sidebar-link">ActiveRecord Query Interface</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rubyonrails/activerecord-query-interface.html#where" class="sidebar-link">.where</a></li><li class="sidebar-sub-header"><a href="/rubyonrails/activerecord-query-interface.html#where-with-an-array" class="sidebar-link">.where with an array</a></li><li class="sidebar-sub-header"><a href="/rubyonrails/activerecord-query-interface.html#scopes" class="sidebar-link">Scopes</a></li><li class="sidebar-sub-header"><a href="/rubyonrails/activerecord-query-interface.html#get-first-and-last-record" class="sidebar-link">Get first and last record</a></li><li class="sidebar-sub-header"><a href="/rubyonrails/activerecord-query-interface.html#where-not" class="sidebar-link">where.not</a></li><li class="sidebar-sub-header"><a href="/rubyonrails/activerecord-query-interface.html#ordering" class="sidebar-link">Ordering</a></li><li class="sidebar-sub-header"><a href="/rubyonrails/activerecord-query-interface.html#includes" class="sidebar-link">Includes</a></li><li class="sidebar-sub-header"><a href="/rubyonrails/activerecord-query-interface.html#find-by" class="sidebar-link">.find_by</a></li><li class="sidebar-sub-header"><a href="/rubyonrails/activerecord-query-interface.html#delete-all" class="sidebar-link">.delete_all</a></li><li class="sidebar-sub-header"><a href="/rubyonrails/activerecord-query-interface.html#activerecord-case-insensitive-search" class="sidebar-link">ActiveRecord case insensitive search</a></li><li class="sidebar-sub-header"><a href="/rubyonrails/activerecord-query-interface.html#group-and-count" class="sidebar-link">.group and .count</a></li><li class="sidebar-sub-header"><a href="/rubyonrails/activerecord-query-interface.html#distinct-or-uniq" class="sidebar-link">.distinct (or .uniq)</a></li><li class="sidebar-sub-header"><a href="/rubyonrails/activerecord-query-interface.html#joins" class="sidebar-link">Joins</a></li><li class="sidebar-sub-header"><a href="/rubyonrails/activerecord-query-interface.html#limit-and-offset" class="sidebar-link">Limit and Offset</a></li><li class="sidebar-sub-header"><a href="/rubyonrails/activerecord-query-interface.html#activerecord-bang-methods" class="sidebar-link">ActiveRecord Bang (!) methods</a></li></ul></li><li><a href="/rubyonrails/actionmailer.html" class="sidebar-link">ActionMailer</a></li><li><a href="/rubyonrails/rails-generate-commands.html" class="sidebar-link">Rails generate commands</a></li><li><a href="/rubyonrails/configuration.html" class="sidebar-link">Configuration</a></li><li><a href="/rubyonrails/i18n-internationalization.html" class="sidebar-link">I18n - Internationalization</a></li><li><a href="/rubyonrails/using-googlemaps-with-rails.html" class="sidebar-link">Using GoogleMaps with Rails</a></li><li><a href="/rubyonrails/file-uploads.html" class="sidebar-link">File Uploads</a></li><li><a href="/rubyonrails/caching.html" class="sidebar-link">Caching</a></li><li><a href="/rubyonrails/actioncontroller.html" class="sidebar-link">ActionController</a></li><li><a href="/rubyonrails/configuration.html" class="sidebar-link">Configuration</a></li><li><a href="/rubyonrails/safe-constantize.html" class="sidebar-link">Safe Constantize</a></li><li><a href="/rubyonrails/rails-5.html" class="sidebar-link">Rails 5</a></li><li><a href="/rubyonrails/authorization-with-cancan.html" class="sidebar-link">Authorization with CanCan</a></li><li><a href="/rubyonrails/mongoid.html" class="sidebar-link">Mongoid</a></li><li><a href="/rubyonrails/gems.html" class="sidebar-link">Gems</a></li><li><a href="/rubyonrails/change-default-timezone.html" class="sidebar-link">Change default timezone</a></li><li><a href="/rubyonrails/asset-pipeline.html" class="sidebar-link">Asset Pipeline</a></li><li><a href="/rubyonrails/upgrading-rails.html" class="sidebar-link">Upgrading Rails</a></li><li><a href="/rubyonrails/activerecord-locking.html" class="sidebar-link">ActiveRecord Locking</a></li><li><a href="/rubyonrails/debugging.html" class="sidebar-link">Debugging</a></li><li><a href="/rubyonrails/configure-angular-with-rails.html" class="sidebar-link">Configure Angular with Rails</a></li><li><a href="/rubyonrails/rails-logger.html" class="sidebar-link">Rails logger</a></li><li><a href="/rubyonrails/prawn-pdf.html" class="sidebar-link">Prawn PDF</a></li><li><a href="/rubyonrails/rails-api.html" class="sidebar-link">Rails API</a></li><li><a href="/rubyonrails/deploying-a-rails-app-on-heroku.html" class="sidebar-link">Deploying a Rails app on Heroku</a></li><li><a href="/rubyonrails/activesupport.html" class="sidebar-link">ActiveSupport</a></li><li><a href="/rubyonrails/form-helpers.html" class="sidebar-link">Form Helpers</a></li><li><a href="/rubyonrails/activerecord-transactions.html" class="sidebar-link">ActiveRecord Transactions</a></li><li><a href="/rubyonrails/rspec-and-ruby-on-rails.html" class="sidebar-link">RSpec and Ruby on Rails</a></li><li><a href="/rubyonrails/decorator-pattern.html" class="sidebar-link">Decorator pattern</a></li><li><a href="/rubyonrails/elasticsearch.html" class="sidebar-link">Elasticsearch</a></li><li><a href="/rubyonrails/react-with-rails-using-react-rails-gem.html" class="sidebar-link">React with Rails using react-rails gem</a></li><li><a href="/rubyonrails/rails-cookbook-advanced-rails-recipes-learnings-and-coding-techniques.html" class="sidebar-link">Rails Cookbook - Advanced rails recipes/learnings and coding techniques</a></li><li><a href="/rubyonrails/multipurpose-activerecord-columns.html" class="sidebar-link">Multipurpose ActiveRecord columns</a></li><li><a href="/rubyonrails/class-organization.html" class="sidebar-link">Class Organization</a></li><li><a href="/rubyonrails/shallow-routing.html" class="sidebar-link">Shallow Routing</a></li><li><a href="/rubyonrails/model-states-aasm.html" class="sidebar-link">Model states: AASM</a></li><li><a href="/rubyonrails/rails-5-api-authetication.html" class="sidebar-link">Rails 5 API Authetication</a></li><li><a href="/rubyonrails/testing-rails-applications.html" class="sidebar-link">Testing Rails Applications</a></li><li><a href="/rubyonrails/active-jobs.html" class="sidebar-link">Active Jobs</a></li><li><a href="/rubyonrails/rails-frameworks-over-the-years.html" class="sidebar-link">Rails frameworks over the years</a></li><li><a href="/rubyonrails/nested-form-in-ruby-on-rails.html" class="sidebar-link">Nested form in Ruby on Rails</a></li><li><a href="/rubyonrails/factory-girl.html" class="sidebar-link">Factory Girl</a></li><li><a href="/rubyonrails/import-whole-csv-files-from-specific-folder.html" class="sidebar-link">Import whole CSV files from specific folder</a></li><li><a href="/rubyonrails/tools-for-ruby-on-rails-code-optimization-and-cleanup.html" class="sidebar-link">Tools for Ruby on Rails code optimization and cleanup</a></li><li><a href="/rubyonrails/activejob.html" class="sidebar-link">ActiveJob</a></li><li><a href="/rubyonrails/active-model-serializers.html" class="sidebar-link">Active Model Serializers</a></li><li><a href="/rubyonrails/rails-engine-modular-rails.html" class="sidebar-link">Rails Engine -  Modular Rails</a></li><li><a href="/rubyonrails/single-table-inheritance.html" class="sidebar-link">Single Table Inheritance</a></li><li><a href="/rubyonrails/activerecord-transactions.html" class="sidebar-link">ActiveRecord Transactions</a></li><li><a href="/rubyonrails/turbolinks.html" class="sidebar-link">Turbolinks</a></li><li><a href="/rubyonrails/friendly-id.html" class="sidebar-link">Friendly ID</a></li><li><a href="/rubyonrails/securely-storing-authentication-keys.html" class="sidebar-link">Securely storing authentication keys</a></li><li><a href="/rubyonrails/authenticate-api-using-devise.html" class="sidebar-link">Authenticate Api using Devise</a></li><li><a href="/rubyonrails/integrating-react-js-with-rails-using-hyperloop.html" class="sidebar-link">Integrating React.js with Rails Using Hyperloop</a></li><li><a href="/rubyonrails/change-a-default-rails-application-enviornment.html" class="sidebar-link">Change a default Rails application enviornment</a></li><li><a href="/rubyonrails/rails-engines.html" class="sidebar-link">Rails -Engines</a></li><li><a href="/rubyonrails/adding-an-amazon-rds-to-your-rails-application.html" class="sidebar-link">Adding an Amazon RDS to your rails application</a></li><li><a href="/rubyonrails/payment-feature-in-rails.html" class="sidebar-link">Payment feature in rails</a></li><li><a href="/rubyonrails/rails-on-docker.html" class="sidebar-link">Rails on docker</a></li><li><a href="/rubyonrails/reserved-words.html" class="sidebar-link">Reserved Words</a></li><li><a href="/rubyonrails/add-admin-panel.html" class="sidebar-link">Add Admin Panel</a></li><li><a href="/rubyonrails/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="activerecord-query-interface"><a href="#activerecord-query-interface" class="header-anchor">#</a> ActiveRecord Query Interface</h1> <p>ActiveRecord is the M in MVC which is the layer of the system responsible for representing business data and logic. The technique that connects the rich objects of an application to tables in a relational database management system is <strong>O</strong>bject <strong>R</strong>elational <strong>M</strong>apper(<strong>ORM</strong>).</p> <p>ActiveRecord will perform queries on the database for you and is compatible with most database systems. Regardless of which database system you're using, the ActiveRecord method format will always be the same.</p> <h2 id="where"><a href="#where" class="header-anchor">#</a> .where</h2> <p>The <code>where</code> method is available on any <code>ActiveRecord</code> model and allows querying the database for a set of records matching the given criteria.</p> <p>The <code>where</code> method accepts a hash where the keys correspond to the column names on the table that the model represents.</p> <p>As a simple example, we will use the following model:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token operator">&lt;</span> <span class="token constant">ActiveRecord</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Base</span>
  <span class="token comment">#attribute :first_name, :string</span>
  <span class="token comment">#attribute :last_name, :string</span>
<span class="token keyword">end</span>

</code></pre></div><p>To find all people with the first name of <code>Sven</code>:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>people <span class="token operator">=</span> <span class="token constant">Person</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>first_name<span class="token punctuation">:</span> <span class="token string">'Sven'</span><span class="token punctuation">)</span>
people<span class="token punctuation">.</span>to_sql <span class="token comment"># &quot;SELECT * FROM people WHERE first_name='Sven'&quot;</span>

</code></pre></div><p>To find all people with the first name of <code>Sven</code> and last name of <code>Schrodinger</code>:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>people <span class="token operator">=</span> <span class="token constant">Person</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>first_name<span class="token punctuation">:</span> <span class="token string">'Sven'</span><span class="token punctuation">,</span> last_name<span class="token punctuation">:</span> <span class="token string">'Schrodinger'</span><span class="token punctuation">)</span>
people<span class="token punctuation">.</span>to_sql <span class="token comment"># &quot;SELECT * FROM people WHERE first_name='Sven' AND last_name='Schrodinger'&quot;</span>

</code></pre></div><p>In the above example, the sql output shows that records will only be returned if both the <code>first_name</code> and the <code>last_name</code> match.</p> <p><strong>query with OR condition</strong></p> <p>To find records with <code>first_name == 'Bruce'</code> OR <code>last_name == 'Wayne'</code></p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">User</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span><span class="token string">'first_name = ? or last_name = ?'</span><span class="token punctuation">,</span> <span class="token string">'Bruce'</span><span class="token punctuation">,</span> <span class="token string">'Wayne'</span><span class="token punctuation">)</span>
<span class="token comment"># SELECT &quot;users&quot;.* FROM &quot;users&quot; WHERE (first_name = 'Bruce' or last_name = 'Wayne')</span>

</code></pre></div><h2 id="where-with-an-array"><a href="#where-with-an-array" class="header-anchor">#</a> .where with an array</h2> <p>The <code>where</code> method on any ActiveRecord model can be used to generate SQL of the form <code>WHERE column_name IN (a, b, c, ...)</code>.  This is achieved by passing an array as argument.</p> <p>As a simple example, we will use the following model:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token operator">&lt;</span> <span class="token constant">ActiveRecord</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Base</span>
  <span class="token comment">#attribute :first_name, :string</span>
  <span class="token comment">#attribute :last_name, :string</span>
<span class="token keyword">end</span>

people <span class="token operator">=</span> <span class="token constant">Person</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>first_name<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'Mark'</span><span class="token punctuation">,</span> <span class="token string">'Mary'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
people<span class="token punctuation">.</span>to_sql <span class="token comment"># &quot;SELECT * FROM people WHERE first_name IN ('Mark', 'Mary')&quot;</span>

</code></pre></div><p>If the array contains a <code>nil</code>, the SQL will be modified to check if the column is <code>null</code>:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>people <span class="token operator">=</span> <span class="token constant">Person</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>first_name<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'Mark'</span><span class="token punctuation">,</span> <span class="token string">'Mary'</span><span class="token punctuation">,</span> <span class="token keyword">nil</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
people<span class="token punctuation">.</span>to_sql <span class="token comment"># &quot;SELECT * FROM people WHERE first_name IN ('Mark', 'Mary') OR first_name IS NULL&quot;</span>

</code></pre></div><h2 id="scopes"><a href="#scopes" class="header-anchor">#</a> Scopes</h2> <p>Scopes act as predefined filters on <code>ActiveRecord</code> models.</p> <p>A scope is defined using the <code>scope</code> class method.</p> <p>As a simple example, we will use the following model:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token operator">&lt;</span> <span class="token constant">ActiveRecord</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Base</span>
  <span class="token comment">#attribute :first_name, :string</span>
  <span class="token comment">#attribute :last_name, :string</span>
  <span class="token comment">#attribute :age, :integer</span>

  <span class="token comment"># define a scope to get all people under 17</span>
  scope <span class="token symbol">:minors</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> where<span class="token punctuation">(</span>age<span class="token punctuation">:</span> <span class="token number">0.</span><span class="token number">.17</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>

  <span class="token comment"># define a scope to search a person by last name</span>
  scope <span class="token symbol">:with_last_name</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span> where<span class="token punctuation">(</span>last_name<span class="token punctuation">:</span> name<span class="token punctuation">)</span> <span class="token punctuation">}</span>

<span class="token keyword">end</span>

</code></pre></div><p>Scopes can be called directly off the model class:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>minors <span class="token operator">=</span> <span class="token constant">Person</span><span class="token punctuation">.</span>minors

</code></pre></div><p>Scopes can be chained:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>peters_children <span class="token operator">=</span> <span class="token constant">Person</span><span class="token punctuation">.</span>minors<span class="token punctuation">.</span>with_last_name<span class="token punctuation">(</span><span class="token string">'Peters'</span><span class="token punctuation">)</span>

</code></pre></div><p>The <code>where</code> method and other query type methods can also be chained:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>mary_smith <span class="token operator">=</span> <span class="token constant">Person</span><span class="token punctuation">.</span>with_last_name<span class="token punctuation">(</span><span class="token string">'Smith'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>first_name<span class="token punctuation">:</span> <span class="token string">'Mary'</span><span class="token punctuation">)</span>

</code></pre></div><p>Behind the scenes, scopes are simply syntactic sugar for a standard class method. For example, these methods are functionally identical:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>scope <span class="token symbol">:with_last_name</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span> where<span class="token punctuation">(</span>name<span class="token punctuation">:</span> name<span class="token punctuation">)</span> <span class="token punctuation">}</span>

<span class="token comment"># This ^ is the same as this:</span>

<span class="token keyword">def</span> <span class="token method-definition"><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">with_last_name</span></span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
  where<span class="token punctuation">(</span>name<span class="token punctuation">:</span> name<span class="token punctuation">)</span>
<span class="token keyword">end</span>

</code></pre></div><p><strong>Default Scope</strong></p> <p>in your model to set a default scope for all operations on the model.</p> <blockquote></blockquote> <p>There is one notable difference between the <code>scope</code> method and a class method: <code>scope</code>-defined scopes will <strong>always</strong> return an <code>ActiveRecord::Relation</code>, even if the logic within returns nil. Class methods, however, have no such safety net and can break chainability if they return something else.</p> <h2 id="get-first-and-last-record"><a href="#get-first-and-last-record" class="header-anchor">#</a> Get first and last record</h2> <p>Rails have very easy way to get <code>first</code> and <code>last</code> record from database.</p> <p>To get the <code>first</code> record from <code>users</code> table we need to type following command:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">User</span><span class="token punctuation">.</span>first

</code></pre></div><p>It will generate following <code>sql</code> query:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">SELECT</span>  `users`<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token constant">FROM</span> `users`  <span class="token constant">ORDER</span> <span class="token constant">BY</span> `users`<span class="token punctuation">.</span>`id` <span class="token constant">ASC</span> <span class="token constant">LIMIT</span> <span class="token number">1</span>

</code></pre></div><p>And will return following record:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment">#&lt;User:0x007f8a6db09920 id: 1, first_name: foo, created_at: Thu, 16 Jun 2016 21:43:03 UTC +00:00, updated_at: Thu, 16 Jun 2016 21:43:03 UTC +00:00 &gt;</span>

</code></pre></div><p>To get the <code>last</code> record from <code>users</code> table we need to type following command:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">User</span><span class="token punctuation">.</span>last

</code></pre></div><p>It will generate following <code>sql</code> query:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">SELECT</span>  `users`<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token constant">FROM</span> `users`  <span class="token constant">ORDER</span> <span class="token constant">BY</span> `users`<span class="token punctuation">.</span>`id` <span class="token constant">DESC</span> <span class="token constant">LIMIT</span> <span class="token number">1</span>

</code></pre></div><p>And will return following record:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment">#&lt;User:0x007f8a6db09920 id: 10, first_name: bar, created_at: Thu, 16 Jun 2016 21:43:03 UTC +00:00, updated_at: Thu, 16 Jun 2016 21:43:03 UTC +00:00 &gt;</span>

</code></pre></div><p>Passing an integer to <strong>first</strong> and <strong>last</strong> method creates a <strong>LIMIT</strong> query and returns array of objects.</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">User</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>

</code></pre></div><p>It will generate following <code>sql</code> query.</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">SELECT</span>  <span class="token string">&quot;users&quot;</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token constant">FROM</span> <span class="token string">&quot;users&quot;</span>  <span class="token constant">ORDER</span> <span class="token constant">BY</span> <span class="token string">&quot;users&quot;</span><span class="token punctuation">.</span><span class="token string">&quot;id&quot;</span> <span class="token constant">ASC</span> <span class="token constant">LIMIT</span> <span class="token number">5</span>

</code></pre></div><p>And</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">User</span><span class="token punctuation">.</span>last<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>

</code></pre></div><p>It will generate following <code>sql</code> query.</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">SELECT</span>  <span class="token string">&quot;users&quot;</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token constant">FROM</span> <span class="token string">&quot;users&quot;</span>  <span class="token constant">ORDER</span> <span class="token constant">BY</span> <span class="token string">&quot;users&quot;</span><span class="token punctuation">.</span><span class="token string">&quot;id&quot;</span> <span class="token constant">DESC</span> <span class="token constant">LIMIT</span> <span class="token number">5</span>

</code></pre></div><h2 id="where-not"><a href="#where-not" class="header-anchor">#</a> where.not</h2> <p><code>where</code> clauses can be negated using the <code>where.not</code> syntax:</p> <p>Supported by ActiveRecord 4.0 and later.</p> <h2 id="ordering"><a href="#ordering" class="header-anchor">#</a> Ordering</h2> <p>You can order <strong>ActiveRecord</strong> query results by using <strong><code>.order</code></strong>:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">User</span><span class="token punctuation">.</span>order<span class="token punctuation">(</span><span class="token symbol">:created_at</span><span class="token punctuation">)</span>
<span class="token comment">#=&gt; =&gt; [#&lt;User id: 2, created_at: &quot;2015-08-12 21:36:23&quot;&gt;, #&lt;User id: 11, created_at: &quot;2015-08-15 10:21:48&quot;&gt;]</span>

</code></pre></div><p>If not specified, ordering will be performed in ascending order. You can specify it by doing:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">User</span><span class="token punctuation">.</span>order<span class="token punctuation">(</span>created_at<span class="token punctuation">:</span> <span class="token symbol">:asc</span><span class="token punctuation">)</span>
<span class="token comment">#=&gt; =&gt; [#&lt;User id: 2, created_at: &quot;2015-08-12 21:36:23&quot;&gt;, #&lt;User id: 11, created_at: &quot;2015-08-15 10:21:48&quot;&gt;]</span>

<span class="token constant">User</span><span class="token punctuation">.</span>order<span class="token punctuation">(</span>created_at<span class="token punctuation">:</span> <span class="token symbol">:desc</span><span class="token punctuation">)</span>
<span class="token comment">#=&gt; [#&lt;User id: 7585, created_at: &quot;2016-07-13 17:15:27&quot;&gt;, #&lt;User id: 7583, created_at: &quot;2016-07-13 16:51:18&quot;&gt;]</span>

</code></pre></div><p><strong><code>.order</code></strong> also accepts a string, so you could also do</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">User</span><span class="token punctuation">.</span>order<span class="token punctuation">(</span><span class="token string">&quot;created_at DESC&quot;</span><span class="token punctuation">)</span>
<span class="token comment">#=&gt; [#&lt;User id: 7585, created_at: &quot;2016-07-13 17:15:27&quot;&gt;, #&lt;User id: 7583, created_at: &quot;2016-07-13 16:51:18&quot;&gt;]</span>

</code></pre></div><p>As the string is raw SQL, you can also specify a table and not only an attribute. Assuming you want to order <code>users</code> according to their <code>role</code> name, you can do this:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token builtin">Class</span> <span class="token class-name">User</span> <span class="token operator">&lt;</span> <span class="token constant">ActiveRecord</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Base</span>
    belongs_to <span class="token symbol">:role</span>
<span class="token keyword">end</span>

<span class="token builtin">Class</span> <span class="token class-name">Role</span> <span class="token operator">&lt;</span> <span class="token constant">ActiveRecord</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Base</span>
  has_many <span class="token symbol">:users</span>
<span class="token keyword">end</span>

<span class="token constant">User</span><span class="token punctuation">.</span>includes<span class="token punctuation">(</span><span class="token symbol">:role</span><span class="token punctuation">)</span><span class="token punctuation">.</span>order<span class="token punctuation">(</span><span class="token string">&quot;roles.name ASC&quot;</span><span class="token punctuation">)</span>

</code></pre></div><p>The <code>order</code> scope can also accept an Arel node:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">User</span><span class="token punctuation">.</span>includes<span class="token punctuation">(</span><span class="token symbol">:role</span><span class="token punctuation">)</span><span class="token punctuation">.</span>order<span class="token punctuation">(</span><span class="token constant">User</span><span class="token punctuation">.</span>arel_table<span class="token punctuation">[</span><span class="token symbol">:name</span><span class="token punctuation">]</span><span class="token punctuation">.</span>asc<span class="token punctuation">)</span>

</code></pre></div><h2 id="includes"><a href="#includes" class="header-anchor">#</a> Includes</h2> <p>ActiveRecord with <code>includes</code> ensures that all of the specified associations are loaded using the minimum possible number of queries. So when querying a table for data with an associated table, both tables are loaded into memory.</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token variable">@authors</span> <span class="token operator">=</span> <span class="token constant">Author</span><span class="token punctuation">.</span>includes<span class="token punctuation">(</span><span class="token symbol">:books</span><span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>books<span class="token punctuation">:</span> <span class="token punctuation">{</span> bestseller<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>

<span class="token comment"># this will print  results without additional db hitting</span>
<span class="token variable">@authors</span><span class="token punctuation">.</span><span class="token keyword">each</span> <span class="token keyword">do</span> <span class="token operator">|</span>author<span class="token operator">|</span> 
  author<span class="token punctuation">.</span>books<span class="token punctuation">.</span><span class="token keyword">each</span> <span class="token keyword">do</span> <span class="token operator">|</span>book<span class="token operator">|</span>
    puts book<span class="token punctuation">.</span>title
  <span class="token keyword">end</span>
<span class="token keyword">end</span>

</code></pre></div><p><code>Author.joins(:books).where(books: { bestseller: true } )</code> will load only <strong>authors</strong> with conditions into memory <strong>without loading books</strong>. Use <code>joins</code> when additional information about nested associations isn't required.</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token variable">@authors</span> <span class="token operator">=</span> <span class="token constant">Author</span><span class="token punctuation">.</span>joins<span class="token punctuation">(</span><span class="token symbol">:books</span><span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>books<span class="token punctuation">:</span> <span class="token punctuation">{</span> bestseller<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>

<span class="token comment"># this will print results without additional queries</span>
<span class="token variable">@authors</span><span class="token punctuation">.</span><span class="token keyword">each</span> <span class="token punctuation">{</span> <span class="token operator">|</span>author<span class="token operator">|</span> puts author<span class="token punctuation">.</span>name <span class="token punctuation">}</span>

<span class="token comment"># this will print results with additional db queries</span>
<span class="token variable">@authors</span><span class="token punctuation">.</span><span class="token keyword">each</span> <span class="token keyword">do</span> <span class="token operator">|</span>author<span class="token operator">|</span> 
  author<span class="token punctuation">.</span>books<span class="token punctuation">.</span><span class="token keyword">each</span> <span class="token keyword">do</span> <span class="token operator">|</span>book<span class="token operator">|</span>
    puts book<span class="token punctuation">.</span>title
  <span class="token keyword">end</span>
<span class="token keyword">end</span>

</code></pre></div><h2 id="find-by"><a href="#find-by" class="header-anchor">#</a> .find_by</h2> <p>You can find records by any field in your table using <code>find_by</code>.</p> <p>So, if you have a <code>User</code> model with a <code>first_name</code> attribute you can do:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">User</span><span class="token punctuation">.</span>find_by<span class="token punctuation">(</span>first_name<span class="token punctuation">:</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">)</span>
<span class="token comment">#=&gt; #&lt;User id: 2005, first_name: &quot;John&quot;, last_name: &quot;Smith&quot;&gt;</span>

</code></pre></div><p>Mind that <code>find_by</code> doesn't throw any exception by default. If the result is an empty set, it returns <code>nil</code> instead of <code>find</code>.</p> <p>If the exception is needed may use <code>find_by!</code> that raises an <code>ActiveRecord::RecordNotFound</code> error like <code>find</code>.</p> <h2 id="delete-all"><a href="#delete-all" class="header-anchor">#</a> .delete_all</h2> <p>If you need to delete a lot of records quickly, <strong>ActiveRecord</strong> gives <strong><code>.delete_all</code></strong> method. to be called directly on a model, to delete all records in that table, or a collection. Beware though, as <strong><code>.delete_all</code></strong> does not instantiate any object hence does not provide any callback (<code>before_*</code> and <code>after_destroy</code> don't get triggered).</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">User</span><span class="token punctuation">.</span>delete_all
<span class="token comment">#=&gt; 39  &lt;-- .delete_all return the number of rows deleted</span>

<span class="token constant">User</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>delete_all 

</code></pre></div><h2 id="activerecord-case-insensitive-search"><a href="#activerecord-case-insensitive-search" class="header-anchor">#</a> ActiveRecord case insensitive search</h2> <p>If you need to search an ActiveRecord model for similar values, you might be tempted to use <code>LIKE</code> or <code>ILIKE</code> but this isn't portable between database engines.  Similarly, resorting to always downcasing or upcasing can create performance issues.</p> <p>You can use ActiveRecord's underlying Arel <code>matches</code> method to do this in a safe way:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>addresses <span class="token operator">=</span> <span class="token constant">Address</span><span class="token punctuation">.</span>arel_table
<span class="token constant">Address</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>addresses<span class="token punctuation">[</span><span class="token symbol">:address</span><span class="token punctuation">]</span><span class="token punctuation">.</span>matches<span class="token punctuation">(</span><span class="token string">&quot;%street%&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><p>Arel will apply the appropriate LIKE or ILIKE construct for the database engine configured.</p> <h2 id="group-and-count"><a href="#group-and-count" class="header-anchor">#</a> .group and .count</h2> <p>We have a <code>Product</code> model and we want to group them by their <code>category</code>.</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">Product</span><span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token symbol">:category</span><span class="token punctuation">)</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token symbol">:category</span><span class="token punctuation">)</span>

</code></pre></div><p>This will query the database as follows:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">SELECT</span> <span class="token string">&quot;product&quot;</span><span class="token punctuation">.</span><span class="token string">&quot;category&quot;</span> <span class="token constant">FROM</span> <span class="token string">&quot;product&quot;</span> <span class="token constant">GROUP</span> <span class="token constant">BY</span> <span class="token string">&quot;product&quot;</span><span class="token punctuation">.</span><span class="token string">&quot;category&quot;</span>

</code></pre></div><p>Make sure that the grouped field is also selected. Grouping is especially useful for counting the occurrence - in this case - of <code>categories</code>.</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">Product</span><span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token symbol">:category</span><span class="token punctuation">)</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token symbol">:category</span><span class="token punctuation">)</span><span class="token punctuation">.</span>count

</code></pre></div><p>As the query shows, it will use the database for counting, which is much more efficient, than retrieving all record first and do the counting in the code:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">SELECT</span> <span class="token constant">COUNT</span><span class="token punctuation">(</span><span class="token string">&quot;products&quot;</span><span class="token punctuation">.</span><span class="token string">&quot;category&quot;</span><span class="token punctuation">)</span> <span class="token constant">AS</span> count_categories<span class="token punctuation">,</span> <span class="token string">&quot;products&quot;</span><span class="token punctuation">.</span><span class="token string">&quot;category&quot;</span> <span class="token constant">AS</span> products_category <span class="token constant">FROM</span> <span class="token string">&quot;products&quot;</span> <span class="token constant">GROUP</span> <span class="token constant">BY</span> <span class="token string">&quot;products&quot;</span><span class="token punctuation">.</span><span class="token string">&quot;category&quot;</span>

</code></pre></div><h2 id="distinct-or-uniq"><a href="#distinct-or-uniq" class="header-anchor">#</a> .distinct (or .uniq)</h2> <p>If you want to remove duplicates from a result, you can use <code>.distinct()</code>:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">Customers</span><span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token symbol">:country</span><span class="token punctuation">)</span><span class="token punctuation">.</span>distinct

</code></pre></div><p>This queries the database as follows:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">SELECT</span> <span class="token constant">DISTINCT</span> <span class="token string">&quot;customers&quot;</span><span class="token punctuation">.</span><span class="token string">&quot;country&quot;</span> <span class="token constant">FROM</span> <span class="token string">&quot;customers&quot;</span>

</code></pre></div><p><code>.uniq()</code> has the same effect. With Rails 5.0 it got deprecated and it will be removed from Rails with version 5.1. The reason is, that the word <code>unique</code> doesn't have the same meaning as distinct and it can be misleading. Furthermore <code>distinct</code> is closer to the SQL syntax.</p> <h2 id="joins"><a href="#joins" class="header-anchor">#</a> Joins</h2> <p><code>joins()</code> allows you to join tables to your current model. For ex.</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">User</span><span class="token punctuation">.</span>joins<span class="token punctuation">(</span><span class="token symbol">:posts</span><span class="token punctuation">)</span>

</code></pre></div><p>will produce the following SQL query:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token string">&quot;SELECT &quot;</span>users<span class="token string">&quot;.* FROM &quot;</span>users<span class="token string">&quot; INNER JOIN &quot;</span>posts<span class="token string">&quot; ON &quot;</span>posts<span class="token string">&quot;.&quot;</span>user_id<span class="token string">&quot; = &quot;</span>users<span class="token string">&quot;.&quot;</span>id<span class="token string">&quot;&quot;</span>

</code></pre></div><p>Having table joined, you will have access to it:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">User</span><span class="token punctuation">.</span>joins<span class="token punctuation">(</span><span class="token symbol">:posts</span><span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>posts<span class="token punctuation">:</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&quot;Hello world&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><p>Pay attention on plural form. If your relation is <code>:has_many</code>, then the <code>joins()</code> argument should be pluralized. Otherwise, use singular.</p> <p>Nested <code>joins</code>:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">User</span><span class="token punctuation">.</span>joins<span class="token punctuation">(</span>posts<span class="token punctuation">:</span> <span class="token symbol">:images</span><span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>images<span class="token punctuation">:</span> <span class="token punctuation">{</span> caption<span class="token punctuation">:</span> <span class="token string">'First post'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><p>which will produce:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token string">&quot;SELECT &quot;</span>users<span class="token string">&quot;.* FROM &quot;</span>users<span class="token string">&quot; INNER JOIN &quot;</span>posts<span class="token string">&quot; ON &quot;</span>posts<span class="token string">&quot;.&quot;</span>user_id<span class="token string">&quot; = &quot;</span>users<span class="token string">&quot;.&quot;</span>id<span class="token string">&quot; INNER JOIN &quot;</span>images<span class="token string">&quot; ON &quot;</span>images<span class="token string">&quot;.&quot;</span>post_id<span class="token string">&quot; = &quot;</span>images<span class="token string">&quot;.&quot;</span>id<span class="token string">&quot;&quot;</span>

</code></pre></div><h2 id="limit-and-offset"><a href="#limit-and-offset" class="header-anchor">#</a> Limit and Offset</h2> <p>You can use <code>limit</code> to tell the number of records to be fetched, and use <code>offset</code> to tell the number of records to skip before starting to return the records.</p> <p>For Example</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">User</span><span class="token punctuation">.</span>limit<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">#returns first three records</span>

</code></pre></div><p>It will generate following sql query.</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token string">&quot;SELECT  `users`.* FROM `users` LIMIT 3&quot;</span>

</code></pre></div><p>As offset is not mentioned in above query so it will return first three records.</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">User</span><span class="token punctuation">.</span>limit<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>offset<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token comment">#returns 5 records starting from 31th i.e from 31 to 35</span>

</code></pre></div><p>It will generate following sql query.</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token string">&quot;SELECT  `users`.* FROM `users` LIMIT 5 OFFSET 30&quot;</span>

</code></pre></div><h2 id="activerecord-bang-methods"><a href="#activerecord-bang-methods" class="header-anchor">#</a> ActiveRecord Bang (!) methods</h2> <p>If you need an <strong>ActiveRecord</strong> method to raise an exception instead of a <code>false</code> value in case of failure, you can add <strong><code>!</code></strong> to them. This is very important. As some exceptions/failures are hard to catch if you don't use ! on them. I recommended doing this in your development cycle to write all your ActiveRecord code this way to save you time and trouble.</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token builtin">Class</span> <span class="token class-name">User</span> <span class="token operator">&lt;</span> <span class="token constant">ActiveRecord</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Base</span>
  validates <span class="token symbol">:last_name</span><span class="token punctuation">,</span> presence<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token keyword">end</span>

<span class="token constant">User</span><span class="token punctuation">.</span>create<span class="token operator">!</span><span class="token punctuation">(</span>first_name<span class="token punctuation">:</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">)</span>
<span class="token comment">#=&gt; ActiveRecord::RecordInvalid: Validation failed: Last name can't be blank</span>

</code></pre></div><p>The <strong>ActiveRecord</strong> methods which accept a <strong>bang</strong> (<code>!</code>) are:</p> <ul><li><code>.create!</code></li> <li><code>.take!</code></li> <li><code>.first!</code></li> <li><code>.last!</code></li> <li><code>.find_by!</code></li> <li><code>.find_or_create_by!</code></li> <li><code>#save!</code></li> <li><code>#update!</code></li> <li>all AR dynamic finders</li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/rubyonrails/activerecord-query-interface.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/rubyonrails/activerecord-validations.html" class="prev">
        ActiveRecord Validations
      </a></span> <span class="next"><a href="/rubyonrails/actionmailer.html">
        ActionMailer
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/3132.f3f3dbdc.js" defer></script>
  </body>
</html>
