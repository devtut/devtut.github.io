<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Ruby on Rails - ActiveRecord</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Creating a Model via generator, Creating a Model manually, Introduction to Callbacks, Manually Testing Your Models, Creating A Migration, Create a Join Table using Migrations, Using a model instance to update a row">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="Ruby on Rails - ActiveRecord">
    <meta property="og:description" content="Creating a Model via generator, Creating a Model manually, Introduction to Callbacks, Manually Testing Your Models, Creating A Migration, Create a Join Table using Migrations, Using a model instance to update a row">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/rubyonrails/activerecord.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="Ruby on Rails - ActiveRecord">
    <meta name="twitter:description" content="Creating a Model via generator, Creating a Model manually, Introduction to Callbacks, Manually Testing Your Models, Creating A Migration, Create a Join Table using Migrations, Using a model instance to update a row">
    <meta name="twitter:url" content="/rubyonrails/activerecord.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    <link rel="preload" href="/assets/css/0.styles.8b877eb8.css" as="style"><link rel="preload" href="/assets/js/app.ced448ab.js" as="script"><link rel="preload" href="/assets/js/3.f1d73125.js" as="script"><link rel="preload" href="/assets/js/3133.5d8ee0b0.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.8b877eb8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Ruby on Rails</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rubyonrails/" class="sidebar-link">Disclaimer</a></li><li><a href="/rubyonrails/getting-started-with-ruby-on-rails.html" class="sidebar-link">Getting started with Ruby on Rails</a></li><li><a href="/rubyonrails/routing.html" class="sidebar-link">Routing</a></li><li><a href="/rubyonrails/activerecord.html" class="active sidebar-link">ActiveRecord</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rubyonrails/activerecord.html#creating-a-model-via-generator" class="sidebar-link">Creating a Model via generator</a></li><li class="sidebar-sub-header"><a href="/rubyonrails/activerecord.html#creating-a-model-manually" class="sidebar-link">Creating a Model manually</a></li><li class="sidebar-sub-header"><a href="/rubyonrails/activerecord.html#introduction-to-callbacks" class="sidebar-link">Introduction to Callbacks</a></li><li class="sidebar-sub-header"><a href="/rubyonrails/activerecord.html#manually-testing-your-models" class="sidebar-link">Manually Testing Your Models</a></li><li class="sidebar-sub-header"><a href="/rubyonrails/activerecord.html#creating-a-migration" class="sidebar-link">Creating A Migration</a></li><li class="sidebar-sub-header"><a href="/rubyonrails/activerecord.html#create-a-join-table-using-migrations" class="sidebar-link">Create a Join Table using Migrations</a></li><li class="sidebar-sub-header"><a href="/rubyonrails/activerecord.html#using-a-model-instance-to-update-a-row" class="sidebar-link">Using a model instance to update a row</a></li></ul></li><li><a href="/rubyonrails/views.html" class="sidebar-link">Views</a></li><li><a href="/rubyonrails/activerecord-migrations.html" class="sidebar-link">ActiveRecord Migrations</a></li><li><a href="/rubyonrails/rails-best-practices.html" class="sidebar-link">Rails Best Practices</a></li><li><a href="/rubyonrails/naming-conventions.html" class="sidebar-link">Naming Conventions</a></li><li><a href="/rubyonrails/actioncable.html" class="sidebar-link">ActionCable</a></li><li><a href="/rubyonrails/activemodel.html" class="sidebar-link">ActiveModel</a></li><li><a href="/rubyonrails/user-authentication-in-rails.html" class="sidebar-link">User Authentication in Rails</a></li><li><a href="/rubyonrails/activerecord-associations.html" class="sidebar-link">ActiveRecord Associations</a></li><li><a href="/rubyonrails/activerecord-validations.html" class="sidebar-link">ActiveRecord Validations</a></li><li><a href="/rubyonrails/activerecord-query-interface.html" class="sidebar-link">ActiveRecord Query Interface</a></li><li><a href="/rubyonrails/actionmailer.html" class="sidebar-link">ActionMailer</a></li><li><a href="/rubyonrails/rails-generate-commands.html" class="sidebar-link">Rails generate commands</a></li><li><a href="/rubyonrails/configuration.html" class="sidebar-link">Configuration</a></li><li><a href="/rubyonrails/i18n-internationalization.html" class="sidebar-link">I18n - Internationalization</a></li><li><a href="/rubyonrails/using-googlemaps-with-rails.html" class="sidebar-link">Using GoogleMaps with Rails</a></li><li><a href="/rubyonrails/file-uploads.html" class="sidebar-link">File Uploads</a></li><li><a href="/rubyonrails/caching.html" class="sidebar-link">Caching</a></li><li><a href="/rubyonrails/actioncontroller.html" class="sidebar-link">ActionController</a></li><li><a href="/rubyonrails/configuration.html" class="sidebar-link">Configuration</a></li><li><a href="/rubyonrails/safe-constantize.html" class="sidebar-link">Safe Constantize</a></li><li><a href="/rubyonrails/rails-5.html" class="sidebar-link">Rails 5</a></li><li><a href="/rubyonrails/authorization-with-cancan.html" class="sidebar-link">Authorization with CanCan</a></li><li><a href="/rubyonrails/mongoid.html" class="sidebar-link">Mongoid</a></li><li><a href="/rubyonrails/gems.html" class="sidebar-link">Gems</a></li><li><a href="/rubyonrails/change-default-timezone.html" class="sidebar-link">Change default timezone</a></li><li><a href="/rubyonrails/asset-pipeline.html" class="sidebar-link">Asset Pipeline</a></li><li><a href="/rubyonrails/upgrading-rails.html" class="sidebar-link">Upgrading Rails</a></li><li><a href="/rubyonrails/activerecord-locking.html" class="sidebar-link">ActiveRecord Locking</a></li><li><a href="/rubyonrails/debugging.html" class="sidebar-link">Debugging</a></li><li><a href="/rubyonrails/configure-angular-with-rails.html" class="sidebar-link">Configure Angular with Rails</a></li><li><a href="/rubyonrails/rails-logger.html" class="sidebar-link">Rails logger</a></li><li><a href="/rubyonrails/prawn-pdf.html" class="sidebar-link">Prawn PDF</a></li><li><a href="/rubyonrails/rails-api.html" class="sidebar-link">Rails API</a></li><li><a href="/rubyonrails/deploying-a-rails-app-on-heroku.html" class="sidebar-link">Deploying a Rails app on Heroku</a></li><li><a href="/rubyonrails/activesupport.html" class="sidebar-link">ActiveSupport</a></li><li><a href="/rubyonrails/form-helpers.html" class="sidebar-link">Form Helpers</a></li><li><a href="/rubyonrails/activerecord-transactions.html" class="sidebar-link">ActiveRecord Transactions</a></li><li><a href="/rubyonrails/rspec-and-ruby-on-rails.html" class="sidebar-link">RSpec and Ruby on Rails</a></li><li><a href="/rubyonrails/decorator-pattern.html" class="sidebar-link">Decorator pattern</a></li><li><a href="/rubyonrails/elasticsearch.html" class="sidebar-link">Elasticsearch</a></li><li><a href="/rubyonrails/react-with-rails-using-react-rails-gem.html" class="sidebar-link">React with Rails using react-rails gem</a></li><li><a href="/rubyonrails/rails-cookbook-advanced-rails-recipes-learnings-and-coding-techniques.html" class="sidebar-link">Rails Cookbook - Advanced rails recipes/learnings and coding techniques</a></li><li><a href="/rubyonrails/multipurpose-activerecord-columns.html" class="sidebar-link">Multipurpose ActiveRecord columns</a></li><li><a href="/rubyonrails/class-organization.html" class="sidebar-link">Class Organization</a></li><li><a href="/rubyonrails/shallow-routing.html" class="sidebar-link">Shallow Routing</a></li><li><a href="/rubyonrails/model-states-aasm.html" class="sidebar-link">Model states: AASM</a></li><li><a href="/rubyonrails/rails-5-api-authetication.html" class="sidebar-link">Rails 5 API Authetication</a></li><li><a href="/rubyonrails/testing-rails-applications.html" class="sidebar-link">Testing Rails Applications</a></li><li><a href="/rubyonrails/active-jobs.html" class="sidebar-link">Active Jobs</a></li><li><a href="/rubyonrails/rails-frameworks-over-the-years.html" class="sidebar-link">Rails frameworks over the years</a></li><li><a href="/rubyonrails/nested-form-in-ruby-on-rails.html" class="sidebar-link">Nested form in Ruby on Rails</a></li><li><a href="/rubyonrails/factory-girl.html" class="sidebar-link">Factory Girl</a></li><li><a href="/rubyonrails/import-whole-csv-files-from-specific-folder.html" class="sidebar-link">Import whole CSV files from specific folder</a></li><li><a href="/rubyonrails/tools-for-ruby-on-rails-code-optimization-and-cleanup.html" class="sidebar-link">Tools for Ruby on Rails code optimization and cleanup</a></li><li><a href="/rubyonrails/activejob.html" class="sidebar-link">ActiveJob</a></li><li><a href="/rubyonrails/active-model-serializers.html" class="sidebar-link">Active Model Serializers</a></li><li><a href="/rubyonrails/rails-engine-modular-rails.html" class="sidebar-link">Rails Engine -  Modular Rails</a></li><li><a href="/rubyonrails/single-table-inheritance.html" class="sidebar-link">Single Table Inheritance</a></li><li><a href="/rubyonrails/activerecord-transactions.html" class="sidebar-link">ActiveRecord Transactions</a></li><li><a href="/rubyonrails/turbolinks.html" class="sidebar-link">Turbolinks</a></li><li><a href="/rubyonrails/friendly-id.html" class="sidebar-link">Friendly ID</a></li><li><a href="/rubyonrails/securely-storing-authentication-keys.html" class="sidebar-link">Securely storing authentication keys</a></li><li><a href="/rubyonrails/authenticate-api-using-devise.html" class="sidebar-link">Authenticate Api using Devise</a></li><li><a href="/rubyonrails/integrating-react-js-with-rails-using-hyperloop.html" class="sidebar-link">Integrating React.js with Rails Using Hyperloop</a></li><li><a href="/rubyonrails/change-a-default-rails-application-enviornment.html" class="sidebar-link">Change a default Rails application enviornment</a></li><li><a href="/rubyonrails/rails-engines.html" class="sidebar-link">Rails -Engines</a></li><li><a href="/rubyonrails/adding-an-amazon-rds-to-your-rails-application.html" class="sidebar-link">Adding an Amazon RDS to your rails application</a></li><li><a href="/rubyonrails/payment-feature-in-rails.html" class="sidebar-link">Payment feature in rails</a></li><li><a href="/rubyonrails/rails-on-docker.html" class="sidebar-link">Rails on docker</a></li><li><a href="/rubyonrails/reserved-words.html" class="sidebar-link">Reserved Words</a></li><li><a href="/rubyonrails/add-admin-panel.html" class="sidebar-link">Add Admin Panel</a></li><li><a href="/rubyonrails/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="activerecord"><a href="#activerecord" class="header-anchor">#</a> ActiveRecord</h1> <h2 id="creating-a-model-via-generator"><a href="#creating-a-model-via-generator" class="header-anchor">#</a> Creating a Model via generator</h2> <p>Ruby on Rails provides a <code>model</code> generator you can use to create ActiveRecord models. Simply use <code>rails generate model</code> and provide the model name.</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>$ rails g model user

</code></pre></div><p>In addition to the model file in <code>app/models</code>, the generator will also create:</p> <ul><li>the Test in <code>test/models/user_test.rb</code></li> <li>the Fixtures in <code>test/fixtures/users.yml</code></li> <li>the database Migration in <code>db/migrate/XXX_create_users.rb</code></li></ul> <p>You can also generate some fields for the model when generating it.</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>$ rails g model user email<span class="token symbol">:string</span> sign_in_count<span class="token symbol">:integer</span> birthday<span class="token symbol">:date</span>

</code></pre></div><p>This will create the columns email, sign_in_count and birthday in your database, with the appropriate types.</p> <h2 id="creating-a-model-manually"><a href="#creating-a-model-manually" class="header-anchor">#</a> Creating a Model manually</h2> <p>While using scaffolding is a fast and easy if you are new to Rails or you are creating a new application, later it can be useful just to do it on your own ato avoid the need to go through the scaffold-generated code to slim it down (remove unused parts, etc.).</p> <p>Creating a model can be as simple as creating a file under <code>app/models</code>.</p> <p>The most simple model, in <code>ActiveRecord</code>, is a class that extends <code>ActiveRecord::Base</code>.</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token operator">&lt;</span> <span class="token constant">ActiveRecord</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Base</span>
<span class="token keyword">end</span>

</code></pre></div><p>Model files are stored in <code>app/models/</code>, and the file name corresponds to the singular name of the class:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment"># user</span>
app<span class="token operator">/</span>models<span class="token operator">/</span>user<span class="token punctuation">.</span>rb

<span class="token comment"># SomeModel</span>
app<span class="token operator">/</span>models<span class="token operator">/</span>some_model<span class="token punctuation">.</span>rb

</code></pre></div><p>The class will inherit all the ActiveRecord features: query methods, validations, callbacks, etc.</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment"># Searches the User with ID 1</span>
<span class="token constant">User</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

</code></pre></div><p>Note: Make sure that the table for the corresponding model exists. If not, you can create the table by creating a <a href="http://stackoverflow.com/documentation/ruby-on-rails/828/activerecord/2879/creating-a-migration" target="_blank" rel="noopener noreferrer">Migration<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>You can generate a model and it's migration by terminal from the following command</p> <p><code>rails g model column_name1:data_type1, column_name2:data_type2, ...</code></p> <p>and  can also assign foreign key(relationship) to the model by following command</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>rails g model column_name<span class="token symbol">:data_type</span><span class="token punctuation">,</span> model_name<span class="token symbol">:references</span>

</code></pre></div><h2 id="introduction-to-callbacks"><a href="#introduction-to-callbacks" class="header-anchor">#</a> Introduction to Callbacks</h2> <p>A callback is a method that gets called at specific moments of an object's lifecycle (right before or after creation, deletion, update, validation, saving or loading from the database).</p> <p>For instance, say you have a listing that expires within 30 days of creation.</p> <p>One way to do that is like this:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">Listing</span> <span class="token operator">&lt;</span> <span class="token constant">ApplicationRecord</span>
  after_create <span class="token symbol">:set_expiry_date</span>

  <span class="token keyword">private</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">set_expiry_date</span></span>
    expiry_date <span class="token operator">=</span> <span class="token constant">Date</span><span class="token punctuation">.</span>today <span class="token operator">+</span> <span class="token number">30.</span>days
    <span class="token keyword">self</span><span class="token punctuation">.</span>update_column<span class="token punctuation">(</span><span class="token symbol">:expires_on</span><span class="token punctuation">,</span> expiry_date<span class="token punctuation">)</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>

</code></pre></div><p>All of the available methods for callbacks are as follows, in the same order that they are called during the operation of each object:</p> <p><strong>Creating an Object</strong></p> <ul><li>before_validation</li> <li>after_validation</li> <li>before_save</li> <li>around_save</li> <li>before_create</li> <li>around_create</li> <li>after_create</li> <li>after_save</li> <li>after_commit/after_rollback</li></ul> <p><strong>Updating an Object</strong></p> <ul><li>before_validation</li> <li>after_validation</li> <li>before_save</li> <li>around_save</li> <li>before_update</li> <li>around_update</li> <li>after_update</li> <li>after_save</li> <li>after_commit/after_rollback</li></ul> <p><strong>Destroying an Object</strong></p> <ul><li>before_destroy</li> <li>around_destroy</li> <li>after_destroy</li> <li>after_commit/after_rollback</li></ul> <p><strong><strong>NOTE:</strong> after_save runs both on create and update, but always after the more specific callbacks after_create and after_update, no matter the order in which the macro calls were executed.</strong></p> <h2 id="manually-testing-your-models"><a href="#manually-testing-your-models" class="header-anchor">#</a> Manually Testing Your Models</h2> <p>Testing your Active Record models through your command line interface is simple.
Navigate to the app directory in your terminal and type in <code>rails console</code> to start the Rails console. From here, you can run active record methods on your database.</p> <p>For example, if you had a database schema with a Users table having a <code>name:string</code> column and <code>email:string</code>, you could run:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">User</span><span class="token punctuation">.</span>create name<span class="token punctuation">:</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span> email<span class="token punctuation">:</span> <span class="token string">&quot;john@example.com&quot;</span>

</code></pre></div><p>Then, to show that record, you could run:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">User</span><span class="token punctuation">.</span>find_by email<span class="token punctuation">:</span> <span class="token string">&quot;john@example.com&quot;</span>

</code></pre></div><p>Or if this is your first or only record, you could simply get the first record by running:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">User</span><span class="token punctuation">.</span>first

</code></pre></div><h2 id="creating-a-migration"><a href="#creating-a-migration" class="header-anchor">#</a> Creating A Migration</h2> <h3 id="add-remove-fields-in-existing-tables"><a href="#add-remove-fields-in-existing-tables" class="header-anchor">#</a> Add/remove fields in existing tables</h3> <p>Create a migration by running:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>rails generate migration <span class="token constant">AddTitleToCategories</span> title<span class="token symbol">:string</span>

</code></pre></div><p>This will create a migration that adds a <code>title</code> column to a <code>categories</code> table:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">AddTitleToCategories</span> <span class="token operator">&lt;</span> <span class="token constant">ActiveRecord</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Migration</span><span class="token punctuation">[</span><span class="token number">5.0</span><span class="token punctuation">]</span>
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">change</span></span>
    add_column <span class="token symbol">:categories</span><span class="token punctuation">,</span> <span class="token symbol">:title</span><span class="token punctuation">,</span> <span class="token symbol">:string</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>

</code></pre></div><p>Similarly, you can generate a migration to remove a column: <code>rails generate migration RemoveTitleFromCategories title:string</code></p> <p>This will create a migration that removes a <code>title</code> column from the <code>categories</code> table:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">RemoveTitleFromCategories</span> <span class="token operator">&lt;</span> <span class="token constant">ActiveRecord</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Migration</span><span class="token punctuation">[</span><span class="token number">5.0</span><span class="token punctuation">]</span>
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">change</span></span>
    remove_column <span class="token symbol">:categories</span><span class="token punctuation">,</span> <span class="token symbol">:title</span><span class="token punctuation">,</span> <span class="token symbol">:string</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>

</code></pre></div><p>While, strictly speaking, specifying <strong>type</strong> (<code>:string</code> in this case) is <strong>not necessary</strong> for removing a column, <strong>it's helpful</strong>, since it provides the information necessary for <strong>rolling it back</strong>.</p> <h3 id="create-a-table"><a href="#create-a-table" class="header-anchor">#</a> Create a table</h3> <p>Create a migration by running:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>rails g <span class="token constant">CreateUsers</span> name bio

</code></pre></div><p>Rails recognizes the intent to create a table from the <code>Create</code> prefix, the rest of the migration name will be used as a table name. The given example generates the following:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">CreateUsers</span> <span class="token operator">&lt;</span> <span class="token constant">ActiveRecord</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Migration</span>
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">change</span></span>
    create_table <span class="token symbol">:users</span> <span class="token keyword">do</span> <span class="token operator">|</span>t<span class="token operator">|</span>
      t<span class="token punctuation">.</span>string <span class="token symbol">:name</span>
      t<span class="token punctuation">.</span>string <span class="token symbol">:bio</span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>

</code></pre></div><p>Notice that the creation command didn't specify types of columns and the default <code>string</code> was used.</p> <h3 id="create-a-join-table"><a href="#create-a-join-table" class="header-anchor">#</a> Create a join table</h3> <p>Create a migration by running:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>rails g <span class="token constant">CreateJoinTableParticipation</span> user<span class="token symbol">:references</span> group<span class="token symbol">:references</span>

</code></pre></div><p>Rails detects the intent to create a join table by finding <code>JoinTable</code> in migration name. Everything else is determined from the names of the fields you give after the name.</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">CreateJoinTableParticipation</span> <span class="token operator">&lt;</span> <span class="token constant">ActiveRecord</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Migration</span>
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">change</span></span>
    create_join_table <span class="token symbol">:users</span><span class="token punctuation">,</span> <span class="token symbol">:groups</span> <span class="token keyword">do</span> <span class="token operator">|</span>t<span class="token operator">|</span>
      <span class="token comment"># t.index [:user_id, :group_id]</span>
      <span class="token comment"># t.index [:group_id, :user_id]</span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>

</code></pre></div><p>Uncomment the necessary <code>index</code> statements and delete the rest.</p> <h3 id="precedence"><a href="#precedence" class="header-anchor">#</a> Precedence</h3> <p>Notice that the example migration name <code>CreateJoinTableParticipation</code> matches the rule for table creation: it has a <code>Create</code> prefix. But it did not generate a simple <code>create_table</code>. This is because migration generator (<a href="https://github.com/rails/rails/blob/ff044c3c3a0a85d26d7c000abeeed835a3bee0bf/activerecord/lib/rails/generators/active_record/migration/migration_generator.rb#L19" target="_blank" rel="noopener noreferrer">source code<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>) uses a <strong>first match</strong> of the following list:</p> <li>
`(Add|Remove)<ignored>(To|From)<table_name>`
</table_name></ignored></li> <li>
`<ignored>JoinTable<ignored>`
</ignored></ignored></li> <li>
`Create<table_name>`
</table_name></li> <h2 id="create-a-join-table-using-migrations"><a href="#create-a-join-table-using-migrations" class="header-anchor">#</a> Create a Join Table using Migrations</h2> <p>Specially useful for <code>has_and_belongs_to_many</code> relation, you can manually create a join table using the <code>create_table</code> method.
Suppose you have two models <code>Tags</code> and <code>Proyects</code>, and you'd like to associate them using a <code>has_and_belongs_to_many</code> relation. You need a join table to associate instances of both classes.</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">CreateProjectsTagsJoinTableMigration</span> <span class="token operator">&lt;</span> <span class="token constant">ActiveRecord</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Migration</span>
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">change</span></span>
    create_table <span class="token symbol">:projects_tags</span><span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token keyword">do</span> <span class="token operator">|</span>t<span class="token operator">|</span>
      t<span class="token punctuation">.</span>integer <span class="token symbol">:project_id</span>
      t<span class="token punctuation">.</span>integer <span class="token symbol">:tag_id</span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>

</code></pre></div><p>The actual name of the table needs to follow this convention: the model which alphabetically precedes the other must go first. <strong>P</strong>roject preceds <strong>T</strong>ags so the name of the table is projects_tags.</p> <p>Also since the purpose of this table is to route the association between the instances of two models, the actual id of every record in this table is not necessary. You specify this by passing <code>id: false</code></p> <p>Finally, as is convention in Rails, the table name must be the compound plural form of the individual models, but the column of the table must be in singular form.</p> <h2 id="using-a-model-instance-to-update-a-row"><a href="#using-a-model-instance-to-update-a-row" class="header-anchor">#</a> Using a model instance to update a row</h2> <p>Let's say you have a <code>User</code> model</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token operator">&lt;</span> <span class="token constant">ActiveRecord</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Base</span>
<span class="token keyword">end</span>

</code></pre></div><p>Now to update the <code>first_name</code> and <code>last_name</code> of a user with <code>id = 1</code>, you can write the following code.</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>user <span class="token operator">=</span> <span class="token constant">User</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
user<span class="token punctuation">.</span>update<span class="token punctuation">(</span>first_name<span class="token punctuation">:</span> <span class="token string">'Kashif'</span><span class="token punctuation">,</span> last_name<span class="token punctuation">:</span> <span class="token string">'Liaqat'</span><span class="token punctuation">)</span>

</code></pre></div><p>Calling <code>update</code> will attempt to update the given attributes in a single transaction, returning <code>true</code> if successful and <code>false</code> if not.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/rubyonrails/activerecord.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/rubyonrails/routing.html" class="prev">
        Routing
      </a></span> <span class="next"><a href="/rubyonrails/views.html">
        Views
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.ced448ab.js" defer></script><script src="/assets/js/3.f1d73125.js" defer></script><script src="/assets/js/3133.5d8ee0b0.js" defer></script>
  </body>
</html>
