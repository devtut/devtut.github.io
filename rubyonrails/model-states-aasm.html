<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Ruby on Rails - Model states: AASM</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Basic state with AASM">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="Ruby on Rails - Model states: AASM">
    <meta property="og:description" content="Basic state with AASM">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/rubyonrails/model-states-aasm.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="Ruby on Rails - Model states: AASM">
    <meta name="twitter:description" content="Basic state with AASM">
    <meta name="twitter:url" content="/rubyonrails/model-states-aasm.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    <link rel="preload" href="/assets/css/0.styles.8b877eb8.css" as="style"><link rel="preload" href="/assets/js/app.ced448ab.js" as="script"><link rel="preload" href="/assets/js/3.f1d73125.js" as="script"><link rel="preload" href="/assets/js/3160.9e1ae9f1.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.8b877eb8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Ruby on Rails</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/rubyonrails/" class="sidebar-link">Disclaimer</a></li><li><a href="/rubyonrails/getting-started-with-ruby-on-rails.html" class="sidebar-link">Getting started with Ruby on Rails</a></li><li><a href="/rubyonrails/routing.html" class="sidebar-link">Routing</a></li><li><a href="/rubyonrails/activerecord.html" class="sidebar-link">ActiveRecord</a></li><li><a href="/rubyonrails/views.html" class="sidebar-link">Views</a></li><li><a href="/rubyonrails/activerecord-migrations.html" class="sidebar-link">ActiveRecord Migrations</a></li><li><a href="/rubyonrails/rails-best-practices.html" class="sidebar-link">Rails Best Practices</a></li><li><a href="/rubyonrails/naming-conventions.html" class="sidebar-link">Naming Conventions</a></li><li><a href="/rubyonrails/actioncable.html" class="sidebar-link">ActionCable</a></li><li><a href="/rubyonrails/activemodel.html" class="sidebar-link">ActiveModel</a></li><li><a href="/rubyonrails/user-authentication-in-rails.html" class="sidebar-link">User Authentication in Rails</a></li><li><a href="/rubyonrails/activerecord-associations.html" class="sidebar-link">ActiveRecord Associations</a></li><li><a href="/rubyonrails/activerecord-validations.html" class="sidebar-link">ActiveRecord Validations</a></li><li><a href="/rubyonrails/activerecord-query-interface.html" class="sidebar-link">ActiveRecord Query Interface</a></li><li><a href="/rubyonrails/actionmailer.html" class="sidebar-link">ActionMailer</a></li><li><a href="/rubyonrails/rails-generate-commands.html" class="sidebar-link">Rails generate commands</a></li><li><a href="/rubyonrails/configuration.html" class="sidebar-link">Configuration</a></li><li><a href="/rubyonrails/i18n-internationalization.html" class="sidebar-link">I18n - Internationalization</a></li><li><a href="/rubyonrails/using-googlemaps-with-rails.html" class="sidebar-link">Using GoogleMaps with Rails</a></li><li><a href="/rubyonrails/file-uploads.html" class="sidebar-link">File Uploads</a></li><li><a href="/rubyonrails/caching.html" class="sidebar-link">Caching</a></li><li><a href="/rubyonrails/actioncontroller.html" class="sidebar-link">ActionController</a></li><li><a href="/rubyonrails/configuration.html" class="sidebar-link">Configuration</a></li><li><a href="/rubyonrails/safe-constantize.html" class="sidebar-link">Safe Constantize</a></li><li><a href="/rubyonrails/rails-5.html" class="sidebar-link">Rails 5</a></li><li><a href="/rubyonrails/authorization-with-cancan.html" class="sidebar-link">Authorization with CanCan</a></li><li><a href="/rubyonrails/mongoid.html" class="sidebar-link">Mongoid</a></li><li><a href="/rubyonrails/gems.html" class="sidebar-link">Gems</a></li><li><a href="/rubyonrails/change-default-timezone.html" class="sidebar-link">Change default timezone</a></li><li><a href="/rubyonrails/asset-pipeline.html" class="sidebar-link">Asset Pipeline</a></li><li><a href="/rubyonrails/upgrading-rails.html" class="sidebar-link">Upgrading Rails</a></li><li><a href="/rubyonrails/activerecord-locking.html" class="sidebar-link">ActiveRecord Locking</a></li><li><a href="/rubyonrails/debugging.html" class="sidebar-link">Debugging</a></li><li><a href="/rubyonrails/configure-angular-with-rails.html" class="sidebar-link">Configure Angular with Rails</a></li><li><a href="/rubyonrails/rails-logger.html" class="sidebar-link">Rails logger</a></li><li><a href="/rubyonrails/prawn-pdf.html" class="sidebar-link">Prawn PDF</a></li><li><a href="/rubyonrails/rails-api.html" class="sidebar-link">Rails API</a></li><li><a href="/rubyonrails/deploying-a-rails-app-on-heroku.html" class="sidebar-link">Deploying a Rails app on Heroku</a></li><li><a href="/rubyonrails/activesupport.html" class="sidebar-link">ActiveSupport</a></li><li><a href="/rubyonrails/form-helpers.html" class="sidebar-link">Form Helpers</a></li><li><a href="/rubyonrails/activerecord-transactions.html" class="sidebar-link">ActiveRecord Transactions</a></li><li><a href="/rubyonrails/rspec-and-ruby-on-rails.html" class="sidebar-link">RSpec and Ruby on Rails</a></li><li><a href="/rubyonrails/decorator-pattern.html" class="sidebar-link">Decorator pattern</a></li><li><a href="/rubyonrails/elasticsearch.html" class="sidebar-link">Elasticsearch</a></li><li><a href="/rubyonrails/react-with-rails-using-react-rails-gem.html" class="sidebar-link">React with Rails using react-rails gem</a></li><li><a href="/rubyonrails/rails-cookbook-advanced-rails-recipes-learnings-and-coding-techniques.html" class="sidebar-link">Rails Cookbook - Advanced rails recipes/learnings and coding techniques</a></li><li><a href="/rubyonrails/multipurpose-activerecord-columns.html" class="sidebar-link">Multipurpose ActiveRecord columns</a></li><li><a href="/rubyonrails/class-organization.html" class="sidebar-link">Class Organization</a></li><li><a href="/rubyonrails/shallow-routing.html" class="sidebar-link">Shallow Routing</a></li><li><a href="/rubyonrails/model-states-aasm.html" class="active sidebar-link">Model states: AASM</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rubyonrails/model-states-aasm.html#basic-state-with-aasm" class="sidebar-link">Basic state with AASM</a></li></ul></li><li><a href="/rubyonrails/rails-5-api-authetication.html" class="sidebar-link">Rails 5 API Authetication</a></li><li><a href="/rubyonrails/testing-rails-applications.html" class="sidebar-link">Testing Rails Applications</a></li><li><a href="/rubyonrails/active-jobs.html" class="sidebar-link">Active Jobs</a></li><li><a href="/rubyonrails/rails-frameworks-over-the-years.html" class="sidebar-link">Rails frameworks over the years</a></li><li><a href="/rubyonrails/nested-form-in-ruby-on-rails.html" class="sidebar-link">Nested form in Ruby on Rails</a></li><li><a href="/rubyonrails/factory-girl.html" class="sidebar-link">Factory Girl</a></li><li><a href="/rubyonrails/import-whole-csv-files-from-specific-folder.html" class="sidebar-link">Import whole CSV files from specific folder</a></li><li><a href="/rubyonrails/tools-for-ruby-on-rails-code-optimization-and-cleanup.html" class="sidebar-link">Tools for Ruby on Rails code optimization and cleanup</a></li><li><a href="/rubyonrails/activejob.html" class="sidebar-link">ActiveJob</a></li><li><a href="/rubyonrails/active-model-serializers.html" class="sidebar-link">Active Model Serializers</a></li><li><a href="/rubyonrails/rails-engine-modular-rails.html" class="sidebar-link">Rails Engine -  Modular Rails</a></li><li><a href="/rubyonrails/single-table-inheritance.html" class="sidebar-link">Single Table Inheritance</a></li><li><a href="/rubyonrails/activerecord-transactions.html" class="sidebar-link">ActiveRecord Transactions</a></li><li><a href="/rubyonrails/turbolinks.html" class="sidebar-link">Turbolinks</a></li><li><a href="/rubyonrails/friendly-id.html" class="sidebar-link">Friendly ID</a></li><li><a href="/rubyonrails/securely-storing-authentication-keys.html" class="sidebar-link">Securely storing authentication keys</a></li><li><a href="/rubyonrails/authenticate-api-using-devise.html" class="sidebar-link">Authenticate Api using Devise</a></li><li><a href="/rubyonrails/integrating-react-js-with-rails-using-hyperloop.html" class="sidebar-link">Integrating React.js with Rails Using Hyperloop</a></li><li><a href="/rubyonrails/change-a-default-rails-application-enviornment.html" class="sidebar-link">Change a default Rails application enviornment</a></li><li><a href="/rubyonrails/rails-engines.html" class="sidebar-link">Rails -Engines</a></li><li><a href="/rubyonrails/adding-an-amazon-rds-to-your-rails-application.html" class="sidebar-link">Adding an Amazon RDS to your rails application</a></li><li><a href="/rubyonrails/payment-feature-in-rails.html" class="sidebar-link">Payment feature in rails</a></li><li><a href="/rubyonrails/rails-on-docker.html" class="sidebar-link">Rails on docker</a></li><li><a href="/rubyonrails/reserved-words.html" class="sidebar-link">Reserved Words</a></li><li><a href="/rubyonrails/add-admin-panel.html" class="sidebar-link">Add Admin Panel</a></li><li><a href="/rubyonrails/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="model-states-aasm"><a href="#model-states-aasm" class="header-anchor">#</a> Model states: AASM</h1> <h2 id="basic-state-with-aasm"><a href="#basic-state-with-aasm" class="header-anchor">#</a> Basic state with AASM</h2> <p>Usually you'll end up creating models which will contain a state, and that state will be changing during the lifespan of the object.</p> <p><a href="https://github.com/aasm/aasm" target="_blank" rel="noopener noreferrer">AASM<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> is a finite state machine enabler library that can help you out with dealing with having an easy passing through the process design of your objects.</p> <p>Having something like this in your model goes pretty aligned with the <a href="http://stackoverflow.com/documentation/ruby-on-rails/1207/rails-best-practices/9609/fat-model-skinny-controller#t=201611091524540826623" target="_blank" rel="noopener noreferrer">Fat Model, Skinny Controller<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> idea, one of Rails best practices. The model is the sole responsible of managing its state, its changes and of generating the events triggered by those changes.</p> <p>To install, in Gemfile</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>gem <span class="token string">'aasm'</span>

</code></pre></div><p>Consider an App where the user Quotes a product for a price.</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">Quote</span>

  <span class="token keyword">include</span> <span class="token constant">AASM</span>

  aasm <span class="token keyword">do</span>
    state <span class="token symbol">:requested</span><span class="token punctuation">,</span> initial<span class="token punctuation">:</span> <span class="token boolean">true</span>  <span class="token comment"># User sees a product and requests a quote</span>
    state <span class="token symbol">:priced</span>                    <span class="token comment"># Seller sets the price </span>
    state <span class="token symbol">:payed</span>                     <span class="token comment"># Buyer pays the price</span>
    state <span class="token symbol">:canceled</span>                  <span class="token comment"># The buyer is not willing to pay the price</span>
    state <span class="token symbol">:completed</span>                 <span class="token comment"># The product has been delivered.</span>

    event <span class="token symbol">:price</span> <span class="token keyword">do</span>
        transitions from<span class="token punctuation">:</span> requested<span class="token punctuation">,</span> to<span class="token punctuation">:</span> <span class="token symbol">:priced</span>
    <span class="token keyword">end</span>

    event <span class="token symbol">:pay</span> <span class="token keyword">do</span>
        transitions from<span class="token punctuation">:</span> <span class="token symbol">:priced</span><span class="token punctuation">,</span> to<span class="token punctuation">:</span> <span class="token symbol">:payed</span><span class="token punctuation">,</span> success<span class="token punctuation">:</span> <span class="token symbol">:set_payment_date</span>
    <span class="token keyword">end</span>

    event <span class="token symbol">:complete</span> <span class="token keyword">do</span>
        transitions from<span class="token punctuation">:</span> <span class="token symbol">:payed</span><span class="token punctuation">,</span> to<span class="token punctuation">:</span> <span class="token symbol">:completed</span><span class="token punctuation">,</span> guard<span class="token punctuation">:</span> product_delivered<span class="token operator">?</span>
    <span class="token keyword">end</span>

    event <span class="token symbol">:cancel</span> <span class="token keyword">do</span>
        transitions from<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token symbol">:requested</span><span class="token punctuation">,</span> <span class="token symbol">:priced</span><span class="token punctuation">]</span><span class="token punctuation">,</span> to<span class="token punctuation">:</span> <span class="token symbol">:canceled</span>
        transitions from<span class="token punctuation">:</span> <span class="token symbol">:payed</span><span class="token punctuation">,</span> to<span class="token punctuation">:</span> canceled<span class="token punctuation">,</span> success<span class="token punctuation">:</span> <span class="token symbol">:reverse_charges</span>
    <span class="token keyword">end</span>

   
  <span class="token keyword">end</span>

  <span class="token keyword">private</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">set_payment_date</span></span>
    update payed_at<span class="token punctuation">:</span> <span class="token builtin">Time</span><span class="token punctuation">.</span>zone<span class="token punctuation">.</span>now
  <span class="token keyword">end</span>
<span class="token keyword">end</span>

</code></pre></div><p>The Quote class' states can go however it's best for your process.</p> <p>You can think of the states as being past, like in the previous example or algo in other tense, for example: pricing, paying, delivering, etc. The naming of the states depends on you. From a personal point a view, past states work better because your end state will surely be a past action and links up better with the event names, which will be explained later.</p> <p><strong>NOTE:</strong> Be careful what names you use, you have to worry about not using Ruby or Ruby on Rails reserved keywords, like <code>valid</code>, <code>end</code>, <code>being</code>, etc.</p> <p>Having defined the states and transitions we can now access some methods created by AASM.</p> <p>For example:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">Quote</span><span class="token punctuation">.</span>priced  <span class="token comment"># Shows all Quotes with priced events</span>
quote<span class="token punctuation">.</span>priced<span class="token operator">?</span> <span class="token comment"># Indicates if that specific quote has been priced</span>
quote<span class="token punctuation">.</span>price<span class="token operator">!</span>  <span class="token comment"># Triggers the event the would transition from requested to priced.</span>

</code></pre></div><p>As you can see the event has transitions, this transitions determine the way the state will change upon the event call. If the event is invalid due to the current state an Error will be raised.</p> <p>The events and transitions also have some other callbacks, for example</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>guard<span class="token punctuation">:</span> product_delivered<span class="token operator">?</span>

</code></pre></div><p>Will call the <code>product_delivered?</code> method which will return a boolean. If it turns out false, the transition will not be applied and if the no other transitions are available, the state won't change.</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>success<span class="token punctuation">:</span> <span class="token symbol">:reverse_charges</span>

</code></pre></div><p>If that translation successfully happens the <code>:reverse_charges</code> method will be invoked.</p> <p>There are several other methods in AASM with more callbacks in the process but this will help you creating your first models with finite states.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/rubyonrails/model-states-aasm.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/rubyonrails/shallow-routing.html" class="prev">
        Shallow Routing
      </a></span> <span class="next"><a href="/rubyonrails/rails-5-api-authetication.html">
        Rails 5 API Authetication
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.ced448ab.js" defer></script><script src="/assets/js/3.f1d73125.js" defer></script><script src="/assets/js/3160.9e1ae9f1.js" defer></script>
  </body>
</html>
