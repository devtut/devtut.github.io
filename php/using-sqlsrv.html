<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>PHP - Using SQLSRV</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Fetching Query Results, Retrieving Error Messages, Creating a Connection, Making a Simple Query, Invoking a Stored Procedure, Making a Parameterised Query">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="PHP - Using SQLSRV">
    <meta property="og:description" content="Fetching Query Results, Retrieving Error Messages, Creating a Connection, Making a Simple Query, Invoking a Stored Procedure, Making a Parameterised Query">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/php/using-sqlsrv.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="PHP - Using SQLSRV">
    <meta name="twitter:description" content="Fetching Query Results, Retrieving Error Messages, Creating a Connection, Making a Simple Query, Invoking a Stored Procedure, Making a Parameterised Query">
    <meta name="twitter:url" content="/php/using-sqlsrv.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/2529.9d8e7109.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>PHP</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/php/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/php/installing-a-php-environment-on-windows.html" class="sidebar-link">Installing a PHP environment on Windows</a></li><li><a href="/php/installing-on-linux-unix-environments.html" class="sidebar-link">Installing on Linux/Unix Environments</a></li><li><a href="/php/getting-started-with-php.html" class="sidebar-link">Getting started with PHP</a></li><li><a href="/php/variables.html" class="sidebar-link">Variables</a></li><li><a href="/php/variable-scope.html" class="sidebar-link">Variable Scope</a></li><li><a href="/php/superglobal-variables-php.html" class="sidebar-link">Superglobal Variables PHP</a></li><li><a href="/php/outputting-the-value-of-a-variable.html" class="sidebar-link">Outputting the Value of a Variable</a></li><li><a href="/php/constants.html" class="sidebar-link">Constants</a></li><li><a href="/php/magic-constants.html" class="sidebar-link">Magic Constants</a></li><li><a href="/php/comments.html" class="sidebar-link">Comments</a></li><li><a href="/php/types.html" class="sidebar-link">Types</a></li><li><a href="/php/operators.html" class="sidebar-link">Operators</a></li><li><a href="/php/references.html" class="sidebar-link">References</a></li><li><a href="/php/arrays.html" class="sidebar-link">Arrays</a></li><li><a href="/php/array-iteration.html" class="sidebar-link">Array iteration</a></li><li><a href="/php/executing-upon-an-array.html" class="sidebar-link">Executing Upon an Array</a></li><li><a href="/php/manipulating-an-array.html" class="sidebar-link">Manipulating an Array</a></li><li><a href="/php/processing-multiple-arrays-together.html" class="sidebar-link">Processing Multiple Arrays Together</a></li><li><a href="/php/datetime-class.html" class="sidebar-link">Datetime Class</a></li><li><a href="/php/working-with-dates-and-time.html" class="sidebar-link">Working with Dates and Time</a></li><li><a href="/php/control-structures.html" class="sidebar-link">Control Structures</a></li><li><a href="/php/loops.html" class="sidebar-link">Loops</a></li><li><a href="/php/functions.html" class="sidebar-link">Functions</a></li><li><a href="/php/functional-programming.html" class="sidebar-link">Functional Programming</a></li><li><a href="/php/alternative-syntax-for-control-structures.html" class="sidebar-link">Alternative Syntax for Control Structures</a></li><li><a href="/php/string-formatting.html" class="sidebar-link">String formatting</a></li><li><a href="/php/string-parsing.html" class="sidebar-link">String Parsing</a></li><li><a href="/php/classes-and-objects.html" class="sidebar-link">Classes and Objects</a></li><li><a href="/php/namespaces.html" class="sidebar-link">Namespaces</a></li><li><a href="/php/sessions.html" class="sidebar-link">Sessions</a></li><li><a href="/php/cookies.html" class="sidebar-link">Cookies</a></li><li><a href="/php/output-buffering.html" class="sidebar-link">Output Buffering</a></li><li><a href="/php/json.html" class="sidebar-link">JSON</a></li><li><a href="/php/soap-client.html" class="sidebar-link">SOAP Client</a></li><li><a href="/php/using-curl-in-php.html" class="sidebar-link">Using cURL in PHP</a></li><li><a href="/php/reflection.html" class="sidebar-link">Reflection</a></li><li><a href="/php/dependency-injection.html" class="sidebar-link">Dependency Injection</a></li><li><a href="/php/xml.html" class="sidebar-link">XML</a></li><li><a href="/php/simplexml.html" class="sidebar-link">SimpleXML</a></li><li><a href="/php/parsing-html.html" class="sidebar-link">Parsing HTML</a></li><li><a href="/php/regular-expressions-regexp-pcre.html" class="sidebar-link">Regular Expressions (regexp/PCRE)</a></li><li><a href="/php/traits.html" class="sidebar-link">Traits</a></li><li><a href="/php/composer-dependency-manager.html" class="sidebar-link">Composer Dependency Manager</a></li><li><a href="/php/magic-methods.html" class="sidebar-link">Magic Methods</a></li><li><a href="/php/file-handling.html" class="sidebar-link">File handling</a></li><li><a href="/php/streams.html" class="sidebar-link">Streams</a></li><li><a href="/php/type-hinting.html" class="sidebar-link">Type hinting</a></li><li><a href="/php/filters-filter-functions.html" class="sidebar-link">Filters &amp; Filter Functions</a></li><li><a href="/php/generators.html" class="sidebar-link">Generators</a></li><li><a href="/php/utf-8.html" class="sidebar-link">UTF-8</a></li><li><a href="/php/how-to-break-down-an-url.html" class="sidebar-link">How to break down an URL</a></li><li><a href="/php/object-serialization.html" class="sidebar-link">Object Serialization</a></li><li><a href="/php/serialization.html" class="sidebar-link">Serialization</a></li><li><a href="/php/closure.html" class="sidebar-link">Closure</a></li><li><a href="/php/reading-request-data.html" class="sidebar-link">Reading Request Data</a></li><li><a href="/php/type-juggling-and-non-strict-comparison-issues.html" class="sidebar-link">Type juggling and Non-Strict Comparison Issues</a></li><li><a href="/php/sockets.html" class="sidebar-link">Sockets</a></li><li><a href="/php/pdo.html" class="sidebar-link">PDO</a></li><li><a href="/php/php-mysqli.html" class="sidebar-link">PHP MySQLi</a></li><li><a href="/php/sqlite3.html" class="sidebar-link">SQLite3</a></li><li><a href="/php/using-mongodb.html" class="sidebar-link">Using MongoDB</a></li><li><a href="/php/mongo-php.html" class="sidebar-link">mongo-php</a></li><li><a href="/php/using-redis-with-php.html" class="sidebar-link">Using Redis with PHP</a></li><li><a href="/php/sending-email.html" class="sidebar-link">Sending Email</a></li><li><a href="/php/using-sqlsrv.html" aria-current="page" class="active sidebar-link">Using SQLSRV</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/php/using-sqlsrv.html#fetching-query-results" class="sidebar-link">Fetching Query Results</a></li><li class="sidebar-sub-header"><a href="/php/using-sqlsrv.html#retrieving-error-messages" class="sidebar-link">Retrieving Error Messages</a></li><li class="sidebar-sub-header"><a href="/php/using-sqlsrv.html#creating-a-connection" class="sidebar-link">Creating a Connection</a></li><li class="sidebar-sub-header"><a href="/php/using-sqlsrv.html#making-a-simple-query" class="sidebar-link">Making a Simple Query</a></li><li class="sidebar-sub-header"><a href="/php/using-sqlsrv.html#invoking-a-stored-procedure" class="sidebar-link">Invoking a Stored Procedure</a></li><li class="sidebar-sub-header"><a href="/php/using-sqlsrv.html#making-a-parameterised-query" class="sidebar-link">Making a Parameterised Query</a></li></ul></li><li><a href="/php/command-line-interface-cli.html" class="sidebar-link">Command Line Interface (CLI)</a></li><li><a href="/php/localization.html" class="sidebar-link">Localization</a></li><li><a href="/php/headers-manipulation.html" class="sidebar-link">Headers Manipulation</a></li><li><a href="/php/coding-conventions.html" class="sidebar-link">Coding Conventions</a></li><li><a href="/php/asynchronous-programming.html" class="sidebar-link">Asynchronous programming</a></li><li><a href="/php/how-to-detect-client-ip-address.html" class="sidebar-link">How to Detect Client IP Address</a></li><li><a href="/php/create-pdf-files-in-php.html" class="sidebar-link">Create PDF files in PHP</a></li><li><a href="/php/yaml-in-php.html" class="sidebar-link">YAML in PHP</a></li><li><a href="/php/image-processing-with-gd.html" class="sidebar-link">Image Processing with GD</a></li><li><a href="/php/imagick.html" class="sidebar-link">Imagick</a></li><li><a href="/php/soap-server.html" class="sidebar-link">SOAP Server</a></li><li><a href="/php/machine-learning.html" class="sidebar-link">Machine learning</a></li><li><a href="/php/cache.html" class="sidebar-link">Cache</a></li><li><a href="/php/autoloading-primer.html" class="sidebar-link">Autoloading Primer</a></li><li><a href="/php/spl-data-structures.html" class="sidebar-link">SPL data structures</a></li><li><a href="/php/imap.html" class="sidebar-link">IMAP</a></li><li><a href="/php/http-authentication.html" class="sidebar-link">HTTP Authentication</a></li><li><a href="/php/websockets.html" class="sidebar-link">WebSockets</a></li><li><a href="/php/bc-math-binary-calculator.html" class="sidebar-link">BC Math (Binary Calculator)</a></li><li><a href="/php/docker-deployment.html" class="sidebar-link">Docker deployment</a></li><li><a href="/php/apcu.html" class="sidebar-link">APCu</a></li><li><a href="/php/php-built-in-server.html" class="sidebar-link">PHP Built in server</a></li><li><a href="/php/psr.html" class="sidebar-link">PSR</a></li><li><a href="/php/phpdoc.html" class="sidebar-link">PHPDoc</a></li><li><a href="/php/design-patterns.html" class="sidebar-link">Design Patterns</a></li><li><a href="/php/compile-php-extensions.html" class="sidebar-link">Compile PHP Extensions</a></li><li><a href="/php/common-errors.html" class="sidebar-link">Common Errors</a></li><li><a href="/php/compilation-of-errors-and-warnings.html" class="sidebar-link">Compilation of Errors and Warnings</a></li><li><a href="/php/exception-handling-and-error-reporting.html" class="sidebar-link">Exception Handling and Error Reporting</a></li><li><a href="/php/debugging.html" class="sidebar-link">Debugging</a></li><li><a href="/php/unit-testing.html" class="sidebar-link">Unit Testing</a></li><li><a href="/php/performance.html" class="sidebar-link">Performance</a></li><li><a href="/php/multiprocessing.html" class="sidebar-link">Multiprocessing</a></li><li><a href="/php/multi-threading-extension.html" class="sidebar-link">Multi Threading Extension</a></li><li><a href="/php/secure-remeber-me.html" class="sidebar-link">Secure Remeber Me</a></li><li><a href="/php/security.html" class="sidebar-link">Security</a></li><li><a href="/php/cryptography.html" class="sidebar-link">Cryptography</a></li><li><a href="/php/password-hashing-functions.html" class="sidebar-link">Password Hashing Functions</a></li><li><a href="/php/urls.html" class="sidebar-link">URLs</a></li><li><a href="/php/unicode-support-in-php.html" class="sidebar-link">Unicode Support in PHP</a></li><li><a href="/php/getting-started-with-php-7.html" class="sidebar-link">Getting started with php-7</a></li><li><a href="/php/null-coalesce-operator.html" class="sidebar-link">Null Coalesce Operator</a></li><li><a href="/php/spaceship-operator.html" class="sidebar-link">Spaceship operator</a></li><li><a href="/php/anonymous-class.html" class="sidebar-link">Anonymous class</a></li><li><a href="/php/contributing-to-the-php-manual.html" class="sidebar-link">Contributing to the PHP Manual</a></li><li><a href="/php/contributing-to-the-php-core.html" class="sidebar-link">Contributing to the PHP Core</a></li><li><a href="/php/getting-started-with-composer-php.html" class="sidebar-link">Getting started with composer-php</a></li><li><a href="/php/auto-loading-with-composer.html" class="sidebar-link">Auto loading with composer</a></li><li><a href="/php/how-to-use-private-repositories-with-composer.html" class="sidebar-link">How to use private repositories with Composer</a></li><li><a href="/php/getting-started-with-phpunit.html" class="sidebar-link">Getting Started with PHPUnit</a></li><li><a href="/php/assertions.html" class="sidebar-link">Assertions</a></li><li><a href="/php/test-doubles-mocks-and-stubs.html" class="sidebar-link">Test Doubles (Mocks and Stubs)</a></li><li><a href="/php/recipes.html" class="sidebar-link">Recipes</a></li><li><a href="/php/php-mysqli-affected-rows-returns-0-when-it-should-return-a-positive-integer.html" class="sidebar-link">php mysqli affected rows returns 0 when it should return a positive integer</a></li><li><a href="/php/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="using-sqlsrv"><a href="#using-sqlsrv" class="header-anchor">#</a> Using SQLSRV</h1> <h2 id="fetching-query-results"><a href="#fetching-query-results" class="header-anchor">#</a> Fetching Query Results</h2> <p>There are 3 main ways to fetch results from a query:</p> <h3 id="sqlsrv-fetch-array"><a href="#sqlsrv-fetch-array" class="header-anchor">#</a> sqlsrv_fetch_array()</h3> <p><code>sqlsrv_fetch_array()</code> retrieves the next row as an array.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$stmt</span> <span class="token operator">=</span> <span class="token function">sqlsrv_query</span><span class="token punctuation">(</span><span class="token variable">$conn</span><span class="token punctuation">,</span> <span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token variable">$row</span> <span class="token operator">=</span> <span class="token function">sqlsrv_fetch_array</span><span class="token punctuation">(</span><span class="token variable">$stmt</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token variable">$row</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$var</span> <span class="token operator">=</span> <span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span>

</code></pre></div><p><code>sqlsrv_fetch_array()</code> has an optional second parameter to fetch back different types of array: <code>SQLSRV_FETCH_ASSOC</code>, <code>SQLSRV_FETCH_NUMERIC</code> and <code>SQLSRV_FETCH_BOTH</code><strong>(default)</strong> can be used; each returns the associative, numeric, or associative and numeric arrays, respectively.</p> <h3 id="sqlsrv-fetch-object"><a href="#sqlsrv-fetch-object" class="header-anchor">#</a> sqlsrv_fetch_object()</h3> <p><code>sqlsrv_fetch_object()</code> retrieves the next row as an object.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$stmt</span> <span class="token operator">=</span> <span class="token function">sqlsrv_query</span><span class="token punctuation">(</span><span class="token variable">$conn</span><span class="token punctuation">,</span> <span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token variable">$obj</span> <span class="token operator">=</span> <span class="token function">sqlsrv_fetch_object</span><span class="token punctuation">(</span><span class="token variable">$stmt</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token variable">$obj</span><span class="token operator">-&gt;</span><span class="token property">field</span><span class="token punctuation">;</span> <span class="token comment">// Object property names are the names of the fields from the query</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="sqlsrv-fetch"><a href="#sqlsrv-fetch" class="header-anchor">#</a> sqlsrv_fetch()</h3> <p><code>sqlsrv_fetch()</code> makes the next row available for reading.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$stmt</span> <span class="token operator">=</span> <span class="token function">sqlsrv_query</span><span class="token punctuation">(</span><span class="token variable">$conn</span><span class="token punctuation">,</span> <span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">sqlsrv_fetch</span><span class="token punctuation">(</span><span class="token variable">$stmt</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$foo</span> <span class="token operator">=</span> <span class="token function">sqlsrv_get_field</span><span class="token punctuation">(</span><span class="token variable">$stmt</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//gets the first field -</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="retrieving-error-messages"><a href="#retrieving-error-messages" class="header-anchor">#</a> Retrieving Error Messages</h2> <p>When a query goes wrong, it is important to fetch the error message(s) returned by the driver to identify the cause of the problem. The syntax is:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token function">sqlsrv_errors</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token keyword type-declaration">int</span> <span class="token variable">$errorsOrWarnings</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>This returns an array with:</p> <table><thead><tr><th>Key</th> <th>Description</th></tr></thead> <tbody><tr><td>SQLSTATE</td> <td>The state that the SQL Server / OBDC Driver is in</td></tr> <tr><td>code</td> <td>The SQL Server error code</td></tr> <tr><td>message</td> <td>The description of the error</td></tr></tbody></table> <p>It is common to use the above function like so:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$brokenQuery</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT BadColumnName FROM Table_1&quot;</span><span class="token punctuation">;</span>
<span class="token variable">$stmt</span> <span class="token operator">=</span> <span class="token function">sqlsrv_query</span><span class="token punctuation">(</span><span class="token variable">$conn</span><span class="token punctuation">,</span> <span class="token variable">$brokenQuery</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$stmt</span> <span class="token operator">===</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$errors</span> <span class="token operator">=</span> <span class="token function">sqlsrv_errors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$errors</span> <span class="token keyword">as</span> <span class="token variable">$error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">echo</span> <span class="token string double-quoted-string">&quot;SQLSTATE: &quot;</span><span class="token operator">.</span><span class="token variable">$error</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'SQLSTATE'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;br /&gt;&quot;</span><span class="token punctuation">;</span>
            <span class="token keyword">echo</span> <span class="token string double-quoted-string">&quot;code: &quot;</span><span class="token operator">.</span><span class="token variable">$error</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;br /&gt;&quot;</span><span class="token punctuation">;</span>
            <span class="token keyword">echo</span> <span class="token string double-quoted-string">&quot;message: &quot;</span><span class="token operator">.</span><span class="token variable">$error</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'message'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;br /&gt;&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="creating-a-connection"><a href="#creating-a-connection" class="header-anchor">#</a> Creating a Connection</h2> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$dbServer</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;localhost,1234&quot;</span><span class="token punctuation">;</span> <span class="token comment">//Name of the server/instance, including optional port number (default is 1433)</span>
<span class="token variable">$dbName</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;db001&quot;</span><span class="token punctuation">;</span> <span class="token comment">//Name of the database</span>
<span class="token variable">$dbUser</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;user&quot;</span><span class="token punctuation">;</span> <span class="token comment">//Name of the user</span>
<span class="token variable">$dbPassword</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;password&quot;</span><span class="token punctuation">;</span> <span class="token comment">//DB Password of that user</span>

<span class="token variable">$connectionInfo</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
    <span class="token string double-quoted-string">&quot;Database&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$dbName</span><span class="token punctuation">,</span> 
    <span class="token string double-quoted-string">&quot;UID&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$dbUser</span><span class="token punctuation">,</span>
    <span class="token string double-quoted-string">&quot;PWD&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$dbPassword</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$conn</span> <span class="token operator">=</span> <span class="token function">sqlsrv_connect</span><span class="token punctuation">(</span><span class="token variable">$dbServer</span><span class="token punctuation">,</span> <span class="token variable">$connectionInfo</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>SQLSRV also has a PDO Driver. To connect using PDO:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$conn</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PDO</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;sqlsrv:Server=localhost,1234;Database=db001&quot;</span><span class="token punctuation">,</span> <span class="token variable">$dbUser</span><span class="token punctuation">,</span> <span class="token variable">$dbPassword</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="making-a-simple-query"><a href="#making-a-simple-query" class="header-anchor">#</a> Making a Simple Query</h2> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">//Create Connection</span>
<span class="token variable">$conn</span> <span class="token operator">=</span> <span class="token function">sqlsrv_connect</span><span class="token punctuation">(</span><span class="token variable">$dbServer</span><span class="token punctuation">,</span> <span class="token variable">$connectionInfo</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$query</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT * FROM [table]&quot;</span><span class="token punctuation">;</span> 
<span class="token variable">$stmt</span> <span class="token operator">=</span> <span class="token function">sqlsrv_query</span><span class="token punctuation">(</span><span class="token variable">$conn</span><span class="token punctuation">,</span> <span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p><strong>Note: the use of square brackets</strong> <code>[]</code> <strong>is to escape the word</strong> <code>table</code> <strong>as it is a <a href="https://msdn.microsoft.com/en-us/library/ms189822.aspx" target="_blank" rel="noopener noreferrer">reserved word<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. These work in the same way as backticks</strong> ```php <strong>do in MySQL</strong>.</p> <h2 id="invoking-a-stored-procedure"><a href="#invoking-a-stored-procedure" class="header-anchor">#</a> Invoking a Stored Procedure</h2> <p>To call a stored procedure on the server:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$query</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;{call [dbo].[myStoredProcedure](?,?,?)}&quot;</span><span class="token punctuation">;</span> <span class="token comment">//Parameters '?' includes OUT parameters</span>

<span class="token variable">$params</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
    <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token constant">SQLSRV_PARAM_IN</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$age</span><span class="token punctuation">,</span> <span class="token constant">SQLSRV_PARAM_IN</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$count</span><span class="token punctuation">,</span> <span class="token constant">SQLSRV_PARAM_OUT</span><span class="token punctuation">,</span> <span class="token constant">SQLSRV_PHPTYPE_INT</span><span class="token punctuation">)</span> <span class="token comment">//$count must already be initialised</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">sqlsrv_query</span><span class="token punctuation">(</span><span class="token variable">$conn</span><span class="token punctuation">,</span> <span class="token variable">$query</span><span class="token punctuation">,</span> <span class="token variable">$params</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="making-a-parameterised-query"><a href="#making-a-parameterised-query" class="header-anchor">#</a> Making a Parameterised Query</h2> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$conn</span> <span class="token operator">=</span> <span class="token function">sqlsrv_connect</span><span class="token punctuation">(</span><span class="token variable">$dbServer</span><span class="token punctuation">,</span> <span class="token variable">$connectionInfo</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$query</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;SELECT * FROM [users] WHERE [name] = ? AND [password] = ?&quot;</span><span class="token punctuation">;</span>
<span class="token variable">$params</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;joebloggs&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;pa55w0rd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$stmt</span> <span class="token operator">=</span> <span class="token function">sqlsrv_query</span><span class="token punctuation">(</span><span class="token variable">$conn</span><span class="token punctuation">,</span> <span class="token variable">$query</span><span class="token punctuation">,</span> <span class="token variable">$params</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>If you plan on using the same query statement more than once, with different parameters, the same can be achieved with the <code>sqlsrv_prepare()</code> and <code>sqlsrv_execute()</code> functions, as shown below:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$cart</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
    <span class="token string double-quoted-string">&quot;apple&quot;</span> <span class="token operator">=&gt;</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token string double-quoted-string">&quot;banana&quot;</span> <span class="token operator">=&gt;</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token string double-quoted-string">&quot;chocolate&quot;</span> <span class="token operator">=&gt;</span> <span class="token number">2</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$query</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;INSERT INTO [order_items]([item], [quantity]) VALUES(?,?)&quot;</span><span class="token punctuation">;</span>
<span class="token variable">$params</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$item</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token variable">$qty</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Variables as parameters must be passed by reference</span>

<span class="token variable">$stmt</span> <span class="token operator">=</span> <span class="token function">sqlsrv_prepare</span><span class="token punctuation">(</span><span class="token variable">$conn</span><span class="token punctuation">,</span> <span class="token variable">$query</span><span class="token punctuation">,</span> <span class="token variable">$params</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$cart</span> <span class="token keyword">as</span> <span class="token variable">$item</span> <span class="token operator">=&gt;</span> <span class="token variable">$qty</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">sqlsrv_execute</span><span class="token punctuation">(</span><span class="token variable">$stmt</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">sqlsrv_errors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="remarks"><a href="#remarks" class="header-anchor">#</a> Remarks</h4> <p>The SQLSRV driver is a Microsoft supported PHP extension that allows you to access Microsoft SQL Server and SQL Azure databases. It is an alternative for the MSSQL drivers that were deprecated as of PHP 5.3, and have been removed from PHP 7.</p> <p>The SQLSRV extension can be used on the following operating systems:</p> <ul><li>Windows Vista Service Pack 2 or later</li> <li>Windows Server 2008 Service Pack 2 or later</li> <li>Windows Server 2008 R2</li> <li>Windows 7</li></ul> <p>The SQLSRV extension requires that the Microsoft SQL Server 2012 Native Client be installed on the same computer that is running PHP. If the Microsoft SQL Server 2012 Native Client is not already installed, click the appropriate link at the <a href="http://php.net/manual/en/sqlsrv.requirements.php" target="_blank" rel="noopener noreferrer">&quot;Requirements&quot; documentation page<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>To download the latest SQLSRV drivers, go to the following: <a href="https://msdn.microsoft.com/en-us/library/mt683517.aspx" target="_blank" rel="noopener noreferrer">Download<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>A full list of system requirements for the SQLSRV Drivers can be found here: <a href="https://msdn.microsoft.com/en-us/library/cc296170.aspx" target="_blank" rel="noopener noreferrer">System Requirements<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Those using SQLSRV 3.1+ must download the <a href="https://www.microsoft.com/en-us/download/details.aspx?id=36434" target="_blank" rel="noopener noreferrer">Microsoft ODBC Driver 11 for SQL Server<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>PHP7 users can download the latest drivers from <a href="https://github.com/Azure/msphpsql/tree/PHP-7.0" target="_blank" rel="noopener noreferrer">GitHub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.microsoft.com/en-us/download/details.aspx?id=50420" target="_blank" rel="noopener noreferrer">Microsoft® ODBC Driver 13 for SQL Server<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> supports Microsoft SQL Server 2008, SQL Server 2008 R2, SQL Server 2012, SQL Server 2014, SQL Server 2016 (Preview), Analytics Platform System, Azure SQL Database and Azure SQL Data Warehouse.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/php/using-sqlsrv.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/php/sending-email.html" class="prev">
        Sending Email
      </a></span> <span class="next"><a href="/php/command-line-interface-cli.html">
        Command Line Interface (CLI)
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/2529.9d8e7109.js" defer></script>
  </body>
</html>
