<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>PHP - Sockets</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="TCP client socket, TCP server socket, UDP server socket, Handling socket errors">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="PHP - Sockets">
    <meta property="og:description" content="TCP client socket, TCP server socket, UDP server socket, Handling socket errors">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/php/sockets.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="PHP - Sockets">
    <meta name="twitter:description" content="TCP client socket, TCP server socket, UDP server socket, Handling socket errors">
    <meta name="twitter:url" content="/php/sockets.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/2510.f90d3610.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>PHP</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/php/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/php/installing-a-php-environment-on-windows.html" class="sidebar-link">Installing a PHP environment on Windows</a></li><li><a href="/php/installing-on-linux-unix-environments.html" class="sidebar-link">Installing on Linux/Unix Environments</a></li><li><a href="/php/getting-started-with-php.html" class="sidebar-link">Getting started with PHP</a></li><li><a href="/php/variables.html" class="sidebar-link">Variables</a></li><li><a href="/php/variable-scope.html" class="sidebar-link">Variable Scope</a></li><li><a href="/php/superglobal-variables-php.html" class="sidebar-link">Superglobal Variables PHP</a></li><li><a href="/php/outputting-the-value-of-a-variable.html" class="sidebar-link">Outputting the Value of a Variable</a></li><li><a href="/php/constants.html" class="sidebar-link">Constants</a></li><li><a href="/php/magic-constants.html" class="sidebar-link">Magic Constants</a></li><li><a href="/php/comments.html" class="sidebar-link">Comments</a></li><li><a href="/php/types.html" class="sidebar-link">Types</a></li><li><a href="/php/operators.html" class="sidebar-link">Operators</a></li><li><a href="/php/references.html" class="sidebar-link">References</a></li><li><a href="/php/arrays.html" class="sidebar-link">Arrays</a></li><li><a href="/php/array-iteration.html" class="sidebar-link">Array iteration</a></li><li><a href="/php/executing-upon-an-array.html" class="sidebar-link">Executing Upon an Array</a></li><li><a href="/php/manipulating-an-array.html" class="sidebar-link">Manipulating an Array</a></li><li><a href="/php/processing-multiple-arrays-together.html" class="sidebar-link">Processing Multiple Arrays Together</a></li><li><a href="/php/datetime-class.html" class="sidebar-link">Datetime Class</a></li><li><a href="/php/working-with-dates-and-time.html" class="sidebar-link">Working with Dates and Time</a></li><li><a href="/php/control-structures.html" class="sidebar-link">Control Structures</a></li><li><a href="/php/loops.html" class="sidebar-link">Loops</a></li><li><a href="/php/functions.html" class="sidebar-link">Functions</a></li><li><a href="/php/functional-programming.html" class="sidebar-link">Functional Programming</a></li><li><a href="/php/alternative-syntax-for-control-structures.html" class="sidebar-link">Alternative Syntax for Control Structures</a></li><li><a href="/php/string-formatting.html" class="sidebar-link">String formatting</a></li><li><a href="/php/string-parsing.html" class="sidebar-link">String Parsing</a></li><li><a href="/php/classes-and-objects.html" class="sidebar-link">Classes and Objects</a></li><li><a href="/php/namespaces.html" class="sidebar-link">Namespaces</a></li><li><a href="/php/sessions.html" class="sidebar-link">Sessions</a></li><li><a href="/php/cookies.html" class="sidebar-link">Cookies</a></li><li><a href="/php/output-buffering.html" class="sidebar-link">Output Buffering</a></li><li><a href="/php/json.html" class="sidebar-link">JSON</a></li><li><a href="/php/soap-client.html" class="sidebar-link">SOAP Client</a></li><li><a href="/php/using-curl-in-php.html" class="sidebar-link">Using cURL in PHP</a></li><li><a href="/php/reflection.html" class="sidebar-link">Reflection</a></li><li><a href="/php/dependency-injection.html" class="sidebar-link">Dependency Injection</a></li><li><a href="/php/xml.html" class="sidebar-link">XML</a></li><li><a href="/php/simplexml.html" class="sidebar-link">SimpleXML</a></li><li><a href="/php/parsing-html.html" class="sidebar-link">Parsing HTML</a></li><li><a href="/php/regular-expressions-regexp-pcre.html" class="sidebar-link">Regular Expressions (regexp/PCRE)</a></li><li><a href="/php/traits.html" class="sidebar-link">Traits</a></li><li><a href="/php/composer-dependency-manager.html" class="sidebar-link">Composer Dependency Manager</a></li><li><a href="/php/magic-methods.html" class="sidebar-link">Magic Methods</a></li><li><a href="/php/file-handling.html" class="sidebar-link">File handling</a></li><li><a href="/php/streams.html" class="sidebar-link">Streams</a></li><li><a href="/php/type-hinting.html" class="sidebar-link">Type hinting</a></li><li><a href="/php/filters-filter-functions.html" class="sidebar-link">Filters &amp; Filter Functions</a></li><li><a href="/php/generators.html" class="sidebar-link">Generators</a></li><li><a href="/php/utf-8.html" class="sidebar-link">UTF-8</a></li><li><a href="/php/how-to-break-down-an-url.html" class="sidebar-link">How to break down an URL</a></li><li><a href="/php/object-serialization.html" class="sidebar-link">Object Serialization</a></li><li><a href="/php/serialization.html" class="sidebar-link">Serialization</a></li><li><a href="/php/closure.html" class="sidebar-link">Closure</a></li><li><a href="/php/reading-request-data.html" class="sidebar-link">Reading Request Data</a></li><li><a href="/php/type-juggling-and-non-strict-comparison-issues.html" class="sidebar-link">Type juggling and Non-Strict Comparison Issues</a></li><li><a href="/php/sockets.html" aria-current="page" class="active sidebar-link">Sockets</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/php/sockets.html#tcp-client-socket" class="sidebar-link">TCP client socket</a></li><li class="sidebar-sub-header"><a href="/php/sockets.html#tcp-server-socket" class="sidebar-link">TCP server socket</a></li><li class="sidebar-sub-header"><a href="/php/sockets.html#udp-server-socket" class="sidebar-link">UDP server socket</a></li><li class="sidebar-sub-header"><a href="/php/sockets.html#handling-socket-errors" class="sidebar-link">Handling socket errors</a></li></ul></li><li><a href="/php/pdo.html" class="sidebar-link">PDO</a></li><li><a href="/php/php-mysqli.html" class="sidebar-link">PHP MySQLi</a></li><li><a href="/php/sqlite3.html" class="sidebar-link">SQLite3</a></li><li><a href="/php/using-mongodb.html" class="sidebar-link">Using MongoDB</a></li><li><a href="/php/mongo-php.html" class="sidebar-link">mongo-php</a></li><li><a href="/php/using-redis-with-php.html" class="sidebar-link">Using Redis with PHP</a></li><li><a href="/php/sending-email.html" class="sidebar-link">Sending Email</a></li><li><a href="/php/using-sqlsrv.html" class="sidebar-link">Using SQLSRV</a></li><li><a href="/php/command-line-interface-cli.html" class="sidebar-link">Command Line Interface (CLI)</a></li><li><a href="/php/localization.html" class="sidebar-link">Localization</a></li><li><a href="/php/headers-manipulation.html" class="sidebar-link">Headers Manipulation</a></li><li><a href="/php/coding-conventions.html" class="sidebar-link">Coding Conventions</a></li><li><a href="/php/asynchronous-programming.html" class="sidebar-link">Asynchronous programming</a></li><li><a href="/php/how-to-detect-client-ip-address.html" class="sidebar-link">How to Detect Client IP Address</a></li><li><a href="/php/create-pdf-files-in-php.html" class="sidebar-link">Create PDF files in PHP</a></li><li><a href="/php/yaml-in-php.html" class="sidebar-link">YAML in PHP</a></li><li><a href="/php/image-processing-with-gd.html" class="sidebar-link">Image Processing with GD</a></li><li><a href="/php/imagick.html" class="sidebar-link">Imagick</a></li><li><a href="/php/soap-server.html" class="sidebar-link">SOAP Server</a></li><li><a href="/php/machine-learning.html" class="sidebar-link">Machine learning</a></li><li><a href="/php/cache.html" class="sidebar-link">Cache</a></li><li><a href="/php/autoloading-primer.html" class="sidebar-link">Autoloading Primer</a></li><li><a href="/php/spl-data-structures.html" class="sidebar-link">SPL data structures</a></li><li><a href="/php/imap.html" class="sidebar-link">IMAP</a></li><li><a href="/php/http-authentication.html" class="sidebar-link">HTTP Authentication</a></li><li><a href="/php/websockets.html" class="sidebar-link">WebSockets</a></li><li><a href="/php/bc-math-binary-calculator.html" class="sidebar-link">BC Math (Binary Calculator)</a></li><li><a href="/php/docker-deployment.html" class="sidebar-link">Docker deployment</a></li><li><a href="/php/apcu.html" class="sidebar-link">APCu</a></li><li><a href="/php/php-built-in-server.html" class="sidebar-link">PHP Built in server</a></li><li><a href="/php/psr.html" class="sidebar-link">PSR</a></li><li><a href="/php/phpdoc.html" class="sidebar-link">PHPDoc</a></li><li><a href="/php/design-patterns.html" class="sidebar-link">Design Patterns</a></li><li><a href="/php/compile-php-extensions.html" class="sidebar-link">Compile PHP Extensions</a></li><li><a href="/php/common-errors.html" class="sidebar-link">Common Errors</a></li><li><a href="/php/compilation-of-errors-and-warnings.html" class="sidebar-link">Compilation of Errors and Warnings</a></li><li><a href="/php/exception-handling-and-error-reporting.html" class="sidebar-link">Exception Handling and Error Reporting</a></li><li><a href="/php/debugging.html" class="sidebar-link">Debugging</a></li><li><a href="/php/unit-testing.html" class="sidebar-link">Unit Testing</a></li><li><a href="/php/performance.html" class="sidebar-link">Performance</a></li><li><a href="/php/multiprocessing.html" class="sidebar-link">Multiprocessing</a></li><li><a href="/php/multi-threading-extension.html" class="sidebar-link">Multi Threading Extension</a></li><li><a href="/php/secure-remeber-me.html" class="sidebar-link">Secure Remeber Me</a></li><li><a href="/php/security.html" class="sidebar-link">Security</a></li><li><a href="/php/cryptography.html" class="sidebar-link">Cryptography</a></li><li><a href="/php/password-hashing-functions.html" class="sidebar-link">Password Hashing Functions</a></li><li><a href="/php/urls.html" class="sidebar-link">URLs</a></li><li><a href="/php/unicode-support-in-php.html" class="sidebar-link">Unicode Support in PHP</a></li><li><a href="/php/getting-started-with-php-7.html" class="sidebar-link">Getting started with php-7</a></li><li><a href="/php/null-coalesce-operator.html" class="sidebar-link">Null Coalesce Operator</a></li><li><a href="/php/spaceship-operator.html" class="sidebar-link">Spaceship operator</a></li><li><a href="/php/anonymous-class.html" class="sidebar-link">Anonymous class</a></li><li><a href="/php/contributing-to-the-php-manual.html" class="sidebar-link">Contributing to the PHP Manual</a></li><li><a href="/php/contributing-to-the-php-core.html" class="sidebar-link">Contributing to the PHP Core</a></li><li><a href="/php/getting-started-with-composer-php.html" class="sidebar-link">Getting started with composer-php</a></li><li><a href="/php/auto-loading-with-composer.html" class="sidebar-link">Auto loading with composer</a></li><li><a href="/php/how-to-use-private-repositories-with-composer.html" class="sidebar-link">How to use private repositories with Composer</a></li><li><a href="/php/getting-started-with-phpunit.html" class="sidebar-link">Getting Started with PHPUnit</a></li><li><a href="/php/assertions.html" class="sidebar-link">Assertions</a></li><li><a href="/php/test-doubles-mocks-and-stubs.html" class="sidebar-link">Test Doubles (Mocks and Stubs)</a></li><li><a href="/php/recipes.html" class="sidebar-link">Recipes</a></li><li><a href="/php/php-mysqli-affected-rows-returns-0-when-it-should-return-a-positive-integer.html" class="sidebar-link">php mysqli affected rows returns 0 when it should return a positive integer</a></li><li><a href="/php/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="sockets"><a href="#sockets" class="header-anchor">#</a> Sockets</h1> <h2 id="tcp-client-socket"><a href="#tcp-client-socket" class="header-anchor">#</a> TCP client socket</h2> <h3 id="creating-a-socket-that-uses-the-tcp-transmission-control-protocol"><a href="#creating-a-socket-that-uses-the-tcp-transmission-control-protocol" class="header-anchor">#</a> Creating a socket that uses the TCP (Transmission Control Protocol)</h3> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$socket</span> <span class="token operator">=</span> <span class="token function">socket_create</span><span class="token punctuation">(</span><span class="token constant">AF_INET</span><span class="token punctuation">,</span> <span class="token constant">SOCK_STREAM</span><span class="token punctuation">,</span> <span class="token constant">SOL_TCP</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>Make sure the socket is successfully created. The <code>onSocketFailure</code> function comes from <a href="http://stackoverflow.com/documentation/php/6138/sockets/23034/handling-socket-errors" target="_blank" rel="noopener noreferrer">Handling socket errors<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> example in this topic.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_resource</span><span class="token punctuation">(</span><span class="token variable">$socket</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">onSocketFailure</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;Failed to create socket&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h3 id="connect-the-socket-to-a-specified-address"><a href="#connect-the-socket-to-a-specified-address" class="header-anchor">#</a> Connect the socket to a specified address</h3> <p>The second line fails gracefully if connection failed.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token function">socket_connect</span><span class="token punctuation">(</span><span class="token variable">$socket</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;chat.stackoverflow.com&quot;</span><span class="token punctuation">,</span> <span class="token number">6667</span><span class="token punctuation">)</span>
        <span class="token keyword">or</span> <span class="token function">onSocketFailure</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;Failed to connect to chat.stackoverflow.com:6667&quot;</span><span class="token punctuation">,</span> <span class="token variable">$socket</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h3 id="sending-data-to-the-server"><a href="#sending-data-to-the-server" class="header-anchor">#</a> Sending data to the server</h3> <p>The <code>socket_write</code> function sends bytes through a socket. In PHP, a byte array is represented by a string, which is normally encoding-insensitive.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token function">socket_write</span><span class="token punctuation">(</span><span class="token variable">$socket</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;NICK Alice\r\nUSER alice 0 * :Alice\r\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h3 id="receiving-data-from-the-server"><a href="#receiving-data-from-the-server" class="header-anchor">#</a> Receiving data from the server</h3> <p>The following snippet receives some data from the server using the <code>socket_read</code> function.</p> <p>Passing <code>PHP_NORMAL_READ</code> as the third parameter reads until a <code>\r</code>/<code>\n</code> byte, and this byte is included in the return value.</p> <p>Passing <code>PHP_BINARY_READ</code>, on the contrary, reads the required amount of data from the stream.</p> <p>If <code>socket_set_nonblock</code> was called in prior, and <code>PHP_BINARY_READ</code> is used, <code>socket_read</code> will return <code>false</code> immediately. Otherwise, the method blocks until enough data (to reach the length in the second parameter, or to reach a line ending) are received, or the socket is closed.</p> <p>This example reads data from a supposedly IRC server.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token constant boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// read a line from the socket</span>
    <span class="token variable">$line</span> <span class="token operator">=</span> <span class="token function">socket_read</span><span class="token punctuation">(</span><span class="token variable">$socket</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token constant">PHP_NORMAL_READ</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$line</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string double-quoted-string">&quot;\r&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// read/skip one byte from the socket</span>
        <span class="token comment">// we assume that the next byte in the stream must be a \n.</span>
        <span class="token comment">// this is actually bad in practice; the script is vulnerable to unexpected values</span>
        <span class="token function">socket_read</span><span class="token punctuation">(</span><span class="token variable">$socket</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token constant">PHP_BINARY_READ</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token variable">$message</span> <span class="token operator">=</span> <span class="token function">parseLine</span><span class="token punctuation">(</span><span class="token variable">$line</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$message</span><span class="token operator">-&gt;</span><span class="token property">type</span> <span class="token operator">===</span> <span class="token string double-quoted-string">&quot;QUIT&quot;</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="closing-the-socket"><a href="#closing-the-socket" class="header-anchor">#</a> Closing the socket</h3> <p>Closing the socket frees the socket and its associated resources.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token function">socket_close</span><span class="token punctuation">(</span><span class="token variable">$socket</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="tcp-server-socket"><a href="#tcp-server-socket" class="header-anchor">#</a> TCP server socket</h2> <h3 id="socket-creation"><a href="#socket-creation" class="header-anchor">#</a> Socket creation</h3> <p>Create a socket that uses the TCP. It is the same as creating a client socket.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$socket</span> <span class="token operator">=</span> <span class="token function">socket_create</span><span class="token punctuation">(</span><span class="token constant">AF_INET</span><span class="token punctuation">,</span> <span class="token constant">SOCK_STREAM</span><span class="token punctuation">,</span> <span class="token constant">SOL_TCP</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h3 id="socket-binding"><a href="#socket-binding" class="header-anchor">#</a> Socket binding</h3> <p>Bind connections from a given network (parameter 2) for a specific port (parameter 3) to the socket.</p> <p>The second parameter is usually <code>&quot;0.0.0.0&quot;</code>, which accepts connection from all networks. It can also</p> <p>One common cause of errors from <code>socket_bind</code> is that <a href="https://www.google.com.hk/search?q=site%3Astackexchange.com%20OR%20site%3Astackoverflow.com%20kill%20processes%20bound%20to%20address" target="_blank" rel="noopener noreferrer">the address specified is already bound to another process<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Other processes are usually killed (usually manually to prevent accidentally killing critical processes) so that the sockets would be freed.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token function">socket_bind</span><span class="token punctuation">(</span><span class="token variable">$socket</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;0.0.0.0&quot;</span><span class="token punctuation">,</span> <span class="token number">6667</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token function">onSocketFailure</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;Failed to bind to 0.0.0.0:6667&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h3 id="set-a-socket-to-listening"><a href="#set-a-socket-to-listening" class="header-anchor">#</a> Set a socket to listening</h3> <p>Make the socket listen to incoming connections using <code>socket_listen</code>. The second parameter is the maximum number of connections to allow queuing before they are accepted.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token function">socket_listen</span><span class="token punctuation">(</span><span class="token variable">$socket</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h3 id="handling-connection"><a href="#handling-connection" class="header-anchor">#</a> Handling connection</h3> <p>A TCP server is actually a server that handles child connections. <code>socket_accept</code> creates a new child connection.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$conn</span> <span class="token operator">=</span> <span class="token function">socket_accept</span><span class="token punctuation">(</span><span class="token variable">$socket</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>Data transferring for a connection from <code>socket_accept</code> is the same as that for a <a href="http://stackoverflow.com/documentation/php/6138/sockets/23032/tcp-client-socket" target="_blank" rel="noopener noreferrer">TCP client socket<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>When this connection should be closed, call <code>socket_close($conn);</code> directly. This will not affect the original TCP server socket.</p> <h3 id="closing-the-server"><a href="#closing-the-server" class="header-anchor">#</a> Closing the server</h3> <p>On the other hand, <code>socket_close($socket);</code> should be called when the server is no longer used. This will free the TCP address as well, allowing other processes to bind to the address.</p> <h2 id="udp-server-socket"><a href="#udp-server-socket" class="header-anchor">#</a> UDP server socket</h2> <p>A UDP (user datagram protocol) server, unlike TCP, is not stream-based. It is packet-based, i.e. a client sends data in units called &quot;packets&quot; to the server, and the client identifies clients by their address. There is no builtin function that relates different packets sent from the same client (unlike TCP, where data from the same client are handled by a specific resource created by <code>socket_accept</code>). It can be thought as a new TCP connection is accepted and closed every time a UDP packet arrives.</p> <h3 id="creating-a-udp-server-socket"><a href="#creating-a-udp-server-socket" class="header-anchor">#</a> Creating a UDP server socket</h3> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$socket</span> <span class="token operator">=</span> <span class="token function">socket_create</span><span class="token punctuation">(</span><span class="token constant">AF_INET</span><span class="token punctuation">,</span> <span class="token constant">SOCK_DGRAM</span><span class="token punctuation">,</span> <span class="token constant">SOL_UDP</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h3 id="binding-a-socket-to-an-address"><a href="#binding-a-socket-to-an-address" class="header-anchor">#</a> Binding a socket to an address</h3> <p>The parameters are same as that for a TCP server.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token function">socket_bind</span><span class="token punctuation">(</span><span class="token variable">$socket</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;0.0.0.0&quot;</span><span class="token punctuation">,</span> <span class="token number">9000</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token function">onSocketFailure</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;Failed to bind to 0.0.0.0:9000&quot;</span><span class="token punctuation">,</span> <span class="token variable">$socket</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h3 id="sending-a-packet"><a href="#sending-a-packet" class="header-anchor">#</a> Sending a packet</h3> <p>This line sends <code>$data</code> in a UDP packet to <code>$address</code>:<code>$port</code>.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token function">socket_sendto</span><span class="token punctuation">(</span><span class="token variable">$socket</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$address</span><span class="token punctuation">,</span> <span class="token variable">$port</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h3 id="receiving-a-packet"><a href="#receiving-a-packet" class="header-anchor">#</a> Receiving a packet</h3> <p>The following snippet attempts to manage UDP packets in a client-indexed manner.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$clients</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">socket_recvfrom</span><span class="token punctuation">(</span><span class="token variable">$socket</span><span class="token punctuation">,</span> <span class="token variable">$buffer</span><span class="token punctuation">,</span> <span class="token number">32768</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$ip</span><span class="token punctuation">,</span> <span class="token variable">$port</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant boolean">true</span>
            <span class="token keyword">or</span> <span class="token function">onSocketFailure</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;Failed to receive packet&quot;</span><span class="token punctuation">,</span> <span class="token variable">$socket</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$address</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;<span class="token interpolation"><span class="token variable">$ip</span></span>:<span class="token interpolation"><span class="token variable">$port</span></span>&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$clients</span><span class="token punctuation">[</span><span class="token variable">$address</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token variable">$clients</span><span class="token punctuation">[</span><span class="token variable">$address</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$clients</span><span class="token punctuation">[</span><span class="token variable">$address</span><span class="token punctuation">]</span><span class="token operator">-&gt;</span><span class="token function">handlePacket</span><span class="token punctuation">(</span><span class="token variable">$buffer</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="closing-the-server-2"><a href="#closing-the-server-2" class="header-anchor">#</a> Closing the server</h3> <p><code>socket_close</code> can be used on the UDP server socket resource. This will free the UDP address, allowing other processes to bind to this address.</p> <h2 id="handling-socket-errors"><a href="#handling-socket-errors" class="header-anchor">#</a> Handling socket errors</h2> <p><code>socket_last_error</code> can be used to get the error ID of the last error from the sockets extension.</p> <p><code>socket_strerror</code> can be used to convert the ID to human-readable strings.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">function</span> <span class="token function-definition function">onSocketFailure</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$message</span><span class="token punctuation">,</span> <span class="token variable">$socket</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_resource</span><span class="token punctuation">(</span><span class="token variable">$socket</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$message</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">&quot;: &quot;</span> <span class="token operator">.</span> <span class="token function">socket_strerror</span><span class="token punctuation">(</span><span class="token function">socket_last_error</span><span class="token punctuation">(</span><span class="token variable">$socket</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token variable">$message</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/php/sockets.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/php/type-juggling-and-non-strict-comparison-issues.html" class="prev">
        Type juggling and Non-Strict Comparison Issues
      </a></span> <span class="next"><a href="/php/pdo.html">
        PDO
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/2510.f90d3610.js" defer></script>
  </body>
</html>
