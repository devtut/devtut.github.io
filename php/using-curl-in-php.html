<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>PHP - Using cURL in PHP</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="POST Requests, Basic Usage (GET Requests), Using Cookies, Using multi_curl to make multiple POST requests, Creating and sending a request with a custom method, Sending multi-dimensional data and multiple files with CurlFile in one request, Get and Set custom http headers in php">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="PHP - Using cURL in PHP">
    <meta property="og:description" content="POST Requests, Basic Usage (GET Requests), Using Cookies, Using multi_curl to make multiple POST requests, Creating and sending a request with a custom method, Sending multi-dimensional data and multiple files with CurlFile in one request, Get and Set custom http headers in php">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/php/using-curl-in-php.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="PHP - Using cURL in PHP">
    <meta name="twitter:description" content="POST Requests, Basic Usage (GET Requests), Using Cookies, Using multi_curl to make multiple POST requests, Creating and sending a request with a custom method, Sending multi-dimensional data and multiple files with CurlFile in one request, Get and Set custom http headers in php">
    <meta name="twitter:url" content="/php/using-curl-in-php.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/2526.5d88bc7c.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>PHP</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/php/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/php/installing-a-php-environment-on-windows.html" class="sidebar-link">Installing a PHP environment on Windows</a></li><li><a href="/php/installing-on-linux-unix-environments.html" class="sidebar-link">Installing on Linux/Unix Environments</a></li><li><a href="/php/getting-started-with-php.html" class="sidebar-link">Getting started with PHP</a></li><li><a href="/php/variables.html" class="sidebar-link">Variables</a></li><li><a href="/php/variable-scope.html" class="sidebar-link">Variable Scope</a></li><li><a href="/php/superglobal-variables-php.html" class="sidebar-link">Superglobal Variables PHP</a></li><li><a href="/php/outputting-the-value-of-a-variable.html" class="sidebar-link">Outputting the Value of a Variable</a></li><li><a href="/php/constants.html" class="sidebar-link">Constants</a></li><li><a href="/php/magic-constants.html" class="sidebar-link">Magic Constants</a></li><li><a href="/php/comments.html" class="sidebar-link">Comments</a></li><li><a href="/php/types.html" class="sidebar-link">Types</a></li><li><a href="/php/operators.html" class="sidebar-link">Operators</a></li><li><a href="/php/references.html" class="sidebar-link">References</a></li><li><a href="/php/arrays.html" class="sidebar-link">Arrays</a></li><li><a href="/php/array-iteration.html" class="sidebar-link">Array iteration</a></li><li><a href="/php/executing-upon-an-array.html" class="sidebar-link">Executing Upon an Array</a></li><li><a href="/php/manipulating-an-array.html" class="sidebar-link">Manipulating an Array</a></li><li><a href="/php/processing-multiple-arrays-together.html" class="sidebar-link">Processing Multiple Arrays Together</a></li><li><a href="/php/datetime-class.html" class="sidebar-link">Datetime Class</a></li><li><a href="/php/working-with-dates-and-time.html" class="sidebar-link">Working with Dates and Time</a></li><li><a href="/php/control-structures.html" class="sidebar-link">Control Structures</a></li><li><a href="/php/loops.html" class="sidebar-link">Loops</a></li><li><a href="/php/functions.html" class="sidebar-link">Functions</a></li><li><a href="/php/functional-programming.html" class="sidebar-link">Functional Programming</a></li><li><a href="/php/alternative-syntax-for-control-structures.html" class="sidebar-link">Alternative Syntax for Control Structures</a></li><li><a href="/php/string-formatting.html" class="sidebar-link">String formatting</a></li><li><a href="/php/string-parsing.html" class="sidebar-link">String Parsing</a></li><li><a href="/php/classes-and-objects.html" class="sidebar-link">Classes and Objects</a></li><li><a href="/php/namespaces.html" class="sidebar-link">Namespaces</a></li><li><a href="/php/sessions.html" class="sidebar-link">Sessions</a></li><li><a href="/php/cookies.html" class="sidebar-link">Cookies</a></li><li><a href="/php/output-buffering.html" class="sidebar-link">Output Buffering</a></li><li><a href="/php/json.html" class="sidebar-link">JSON</a></li><li><a href="/php/soap-client.html" class="sidebar-link">SOAP Client</a></li><li><a href="/php/using-curl-in-php.html" aria-current="page" class="active sidebar-link">Using cURL in PHP</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/php/using-curl-in-php.html#post-requests" class="sidebar-link">POST Requests</a></li><li class="sidebar-sub-header"><a href="/php/using-curl-in-php.html#basic-usage-get-requests" class="sidebar-link">Basic Usage (GET Requests)</a></li><li class="sidebar-sub-header"><a href="/php/using-curl-in-php.html#using-cookies" class="sidebar-link">Using Cookies</a></li><li class="sidebar-sub-header"><a href="/php/using-curl-in-php.html#using-multi-curl-to-make-multiple-post-requests" class="sidebar-link">Using multi_curl to make multiple POST requests</a></li><li class="sidebar-sub-header"><a href="/php/using-curl-in-php.html#creating-and-sending-a-request-with-a-custom-method" class="sidebar-link">Creating and sending a request with a custom method</a></li><li class="sidebar-sub-header"><a href="/php/using-curl-in-php.html#sending-multi-dimensional-data-and-multiple-files-with-curlfile-in-one-request" class="sidebar-link">Sending multi-dimensional data and multiple files with CurlFile in one request</a></li><li class="sidebar-sub-header"><a href="/php/using-curl-in-php.html#get-and-set-custom-http-headers-in-php" class="sidebar-link">Get and Set custom http headers in php</a></li></ul></li><li><a href="/php/reflection.html" class="sidebar-link">Reflection</a></li><li><a href="/php/dependency-injection.html" class="sidebar-link">Dependency Injection</a></li><li><a href="/php/xml.html" class="sidebar-link">XML</a></li><li><a href="/php/simplexml.html" class="sidebar-link">SimpleXML</a></li><li><a href="/php/parsing-html.html" class="sidebar-link">Parsing HTML</a></li><li><a href="/php/regular-expressions-regexp-pcre.html" class="sidebar-link">Regular Expressions (regexp/PCRE)</a></li><li><a href="/php/traits.html" class="sidebar-link">Traits</a></li><li><a href="/php/composer-dependency-manager.html" class="sidebar-link">Composer Dependency Manager</a></li><li><a href="/php/magic-methods.html" class="sidebar-link">Magic Methods</a></li><li><a href="/php/file-handling.html" class="sidebar-link">File handling</a></li><li><a href="/php/streams.html" class="sidebar-link">Streams</a></li><li><a href="/php/type-hinting.html" class="sidebar-link">Type hinting</a></li><li><a href="/php/filters-filter-functions.html" class="sidebar-link">Filters &amp; Filter Functions</a></li><li><a href="/php/generators.html" class="sidebar-link">Generators</a></li><li><a href="/php/utf-8.html" class="sidebar-link">UTF-8</a></li><li><a href="/php/how-to-break-down-an-url.html" class="sidebar-link">How to break down an URL</a></li><li><a href="/php/object-serialization.html" class="sidebar-link">Object Serialization</a></li><li><a href="/php/serialization.html" class="sidebar-link">Serialization</a></li><li><a href="/php/closure.html" class="sidebar-link">Closure</a></li><li><a href="/php/reading-request-data.html" class="sidebar-link">Reading Request Data</a></li><li><a href="/php/type-juggling-and-non-strict-comparison-issues.html" class="sidebar-link">Type juggling and Non-Strict Comparison Issues</a></li><li><a href="/php/sockets.html" class="sidebar-link">Sockets</a></li><li><a href="/php/pdo.html" class="sidebar-link">PDO</a></li><li><a href="/php/php-mysqli.html" class="sidebar-link">PHP MySQLi</a></li><li><a href="/php/sqlite3.html" class="sidebar-link">SQLite3</a></li><li><a href="/php/using-mongodb.html" class="sidebar-link">Using MongoDB</a></li><li><a href="/php/mongo-php.html" class="sidebar-link">mongo-php</a></li><li><a href="/php/using-redis-with-php.html" class="sidebar-link">Using Redis with PHP</a></li><li><a href="/php/sending-email.html" class="sidebar-link">Sending Email</a></li><li><a href="/php/using-sqlsrv.html" class="sidebar-link">Using SQLSRV</a></li><li><a href="/php/command-line-interface-cli.html" class="sidebar-link">Command Line Interface (CLI)</a></li><li><a href="/php/localization.html" class="sidebar-link">Localization</a></li><li><a href="/php/headers-manipulation.html" class="sidebar-link">Headers Manipulation</a></li><li><a href="/php/coding-conventions.html" class="sidebar-link">Coding Conventions</a></li><li><a href="/php/asynchronous-programming.html" class="sidebar-link">Asynchronous programming</a></li><li><a href="/php/how-to-detect-client-ip-address.html" class="sidebar-link">How to Detect Client IP Address</a></li><li><a href="/php/create-pdf-files-in-php.html" class="sidebar-link">Create PDF files in PHP</a></li><li><a href="/php/yaml-in-php.html" class="sidebar-link">YAML in PHP</a></li><li><a href="/php/image-processing-with-gd.html" class="sidebar-link">Image Processing with GD</a></li><li><a href="/php/imagick.html" class="sidebar-link">Imagick</a></li><li><a href="/php/soap-server.html" class="sidebar-link">SOAP Server</a></li><li><a href="/php/machine-learning.html" class="sidebar-link">Machine learning</a></li><li><a href="/php/cache.html" class="sidebar-link">Cache</a></li><li><a href="/php/autoloading-primer.html" class="sidebar-link">Autoloading Primer</a></li><li><a href="/php/spl-data-structures.html" class="sidebar-link">SPL data structures</a></li><li><a href="/php/imap.html" class="sidebar-link">IMAP</a></li><li><a href="/php/http-authentication.html" class="sidebar-link">HTTP Authentication</a></li><li><a href="/php/websockets.html" class="sidebar-link">WebSockets</a></li><li><a href="/php/bc-math-binary-calculator.html" class="sidebar-link">BC Math (Binary Calculator)</a></li><li><a href="/php/docker-deployment.html" class="sidebar-link">Docker deployment</a></li><li><a href="/php/apcu.html" class="sidebar-link">APCu</a></li><li><a href="/php/php-built-in-server.html" class="sidebar-link">PHP Built in server</a></li><li><a href="/php/psr.html" class="sidebar-link">PSR</a></li><li><a href="/php/phpdoc.html" class="sidebar-link">PHPDoc</a></li><li><a href="/php/design-patterns.html" class="sidebar-link">Design Patterns</a></li><li><a href="/php/compile-php-extensions.html" class="sidebar-link">Compile PHP Extensions</a></li><li><a href="/php/common-errors.html" class="sidebar-link">Common Errors</a></li><li><a href="/php/compilation-of-errors-and-warnings.html" class="sidebar-link">Compilation of Errors and Warnings</a></li><li><a href="/php/exception-handling-and-error-reporting.html" class="sidebar-link">Exception Handling and Error Reporting</a></li><li><a href="/php/debugging.html" class="sidebar-link">Debugging</a></li><li><a href="/php/unit-testing.html" class="sidebar-link">Unit Testing</a></li><li><a href="/php/performance.html" class="sidebar-link">Performance</a></li><li><a href="/php/multiprocessing.html" class="sidebar-link">Multiprocessing</a></li><li><a href="/php/multi-threading-extension.html" class="sidebar-link">Multi Threading Extension</a></li><li><a href="/php/secure-remeber-me.html" class="sidebar-link">Secure Remeber Me</a></li><li><a href="/php/security.html" class="sidebar-link">Security</a></li><li><a href="/php/cryptography.html" class="sidebar-link">Cryptography</a></li><li><a href="/php/password-hashing-functions.html" class="sidebar-link">Password Hashing Functions</a></li><li><a href="/php/urls.html" class="sidebar-link">URLs</a></li><li><a href="/php/unicode-support-in-php.html" class="sidebar-link">Unicode Support in PHP</a></li><li><a href="/php/getting-started-with-php-7.html" class="sidebar-link">Getting started with php-7</a></li><li><a href="/php/null-coalesce-operator.html" class="sidebar-link">Null Coalesce Operator</a></li><li><a href="/php/spaceship-operator.html" class="sidebar-link">Spaceship operator</a></li><li><a href="/php/anonymous-class.html" class="sidebar-link">Anonymous class</a></li><li><a href="/php/contributing-to-the-php-manual.html" class="sidebar-link">Contributing to the PHP Manual</a></li><li><a href="/php/contributing-to-the-php-core.html" class="sidebar-link">Contributing to the PHP Core</a></li><li><a href="/php/getting-started-with-composer-php.html" class="sidebar-link">Getting started with composer-php</a></li><li><a href="/php/auto-loading-with-composer.html" class="sidebar-link">Auto loading with composer</a></li><li><a href="/php/how-to-use-private-repositories-with-composer.html" class="sidebar-link">How to use private repositories with Composer</a></li><li><a href="/php/getting-started-with-phpunit.html" class="sidebar-link">Getting Started with PHPUnit</a></li><li><a href="/php/assertions.html" class="sidebar-link">Assertions</a></li><li><a href="/php/test-doubles-mocks-and-stubs.html" class="sidebar-link">Test Doubles (Mocks and Stubs)</a></li><li><a href="/php/recipes.html" class="sidebar-link">Recipes</a></li><li><a href="/php/php-mysqli-affected-rows-returns-0-when-it-should-return-a-positive-integer.html" class="sidebar-link">php mysqli affected rows returns 0 when it should return a positive integer</a></li><li><a href="/php/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="using-curl-in-php"><a href="#using-curl-in-php" class="header-anchor">#</a> Using cURL in PHP</h1> <h2 id="post-requests"><a href="#post-requests" class="header-anchor">#</a> POST Requests</h2> <p>If you want to mimic HTML form POST action, you can use cURL.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// POST data in array</span>
<span class="token variable">$post</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">'a'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'apple'</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'b'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'banana'</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// Create a new cURL resource with URL to POST</span>
<span class="token variable">$ch</span> <span class="token operator">=</span> <span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'http://www.example.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// We set parameter CURLOPT_RETURNTRANSFER to read output</span>
<span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_RETURNTRANSFER</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Let's pass POST data</span>
<span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_POSTFIELDS</span><span class="token punctuation">,</span> <span class="token variable">$post</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// We execute our request, and get output in a $response variable</span>
<span class="token variable">$response</span> <span class="token operator">=</span> <span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Close the connection</span>
<span class="token function">curl_close</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="basic-usage-get-requests"><a href="#basic-usage-get-requests" class="header-anchor">#</a> Basic Usage (GET Requests)</h2> <p>cURL is a tool for transferring data with URL syntax. It support HTTP, FTP, SCP and many others(curl &gt;= 7.19.4). <strong>Remember, you need to <a href="http://php.net/manual/en/curl.installation.php" target="_blank" rel="noopener noreferrer">install and enable the cURL extension<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to use it.</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// a little script check is the cURL extension loaded or not</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">extension_loaded</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;curl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;cURL extension not loaded! Quit Now.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Actual script start</span>

<span class="token comment">// create a new cURL resource</span>
<span class="token comment">// $curl is the handle of the resource</span>
<span class="token variable">$curl</span> <span class="token operator">=</span> <span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// set the URL and other options</span>
<span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$curl</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_URL</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;http://www.example.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// execute and pass the result to browser</span>
<span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$curl</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// close the cURL resource</span>
<span class="token function">curl_close</span><span class="token punctuation">(</span><span class="token variable">$curl</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="using-cookies"><a href="#using-cookies" class="header-anchor">#</a> Using Cookies</h2> <p>cURL can keep cookies received in responses for use with subsequent requests. For simple session cookie handling in memory, this is achieved with a single line of code:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_COOKIEFILE</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>In cases where you are required to keep cookies after the cURL handle is destroyed, you can specify the file to store them in:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_COOKIEJAR</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;/tmp/cookies.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>Then, when you want to use them again, pass them as the cookie file:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_COOKIEFILE</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;/tmp/cookies.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>Remember, though, that these two steps are not necessary unless you need to carry cookies between different cURL handles. For most use cases, setting <code>CURLOPT_COOKIEFILE</code> to the empty string is all you need.</p> <p>Cookie handling can be used, for example, to retrieve resources from a web site that requires a login. This is typically a two-step procedure. First, POST to the login page.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token comment"># create a cURL handle</span>
<span class="token variable">$ch</span>  <span class="token operator">=</span> <span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># set the URL (this could also be passed to curl_init() if desired)</span>
<span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_URL</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;https://www.example.com/login.php&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># set the HTTP method to POST</span>
<span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_POST</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># setting this option to an empty string enables cookie handling</span>
<span class="token comment"># but does not load cookies from a file</span>
<span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_COOKIEFILE</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># set the values to be sent</span>
<span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_POSTFIELDS</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
    <span class="token string double-quoted-string">&quot;username&quot;</span><span class="token operator">=&gt;</span><span class="token string double-quoted-string">&quot;joe_bloggs&quot;</span><span class="token punctuation">,</span>
    <span class="token string double-quoted-string">&quot;password&quot;</span><span class="token operator">=&gt;</span><span class="token string double-quoted-string">&quot;<span class="token interpolation"><span class="token variable">$up3r_</span></span><span class="token interpolation"><span class="token variable">$3cr3t</span></span>&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># return the response body</span>
<span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_RETURNTRANSFER</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># send the request</span>
<span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</span></code></pre></div><p>The second step (after standard error checking is done) is usually a simple GET request. The important thing is to <strong>reuse the existing cURL handle</strong> for the second request. This ensures the cookies from the first response will be automatically included in the second request.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment"># we are not calling curl_init()</span>

<span class="token comment"># simply change the URL</span>
<span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_URL</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;https://www.example.com/show_me_the_foo.php&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># change the method back to GET</span>
<span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_HTTPGET</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># send the request</span>
<span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># finished with cURL</span>
<span class="token function">curl_close</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># do stuff with $result...</span>

</code></pre></div><p>This is only intended as an example of cookie handling. In real life, things are usually more complicated. Often you must perform an initial GET of the login page to pull a login token that needs to be included in your POST. Other sites might block the cURL client based on its User-Agent string, requiring you to change it.</p> <h2 id="using-multi-curl-to-make-multiple-post-requests"><a href="#using-multi-curl-to-make-multiple-post-requests" class="header-anchor">#</a> Using multi_curl to make multiple POST requests</h2> <p>Sometimes we need to make a lot of POST requests to one or many different endpoints. To deal with this scenario, we can use <code>multi_curl</code>.</p> <p>First of all, we create how many requests as needed exactly in the same way of the simple example and put them in an array.</p> <p>We use the curl_multi_init and add each handle to it.</p> <p>In this example, we are using 2 different endpoints:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">//array of data to POST</span>
<span class="token variable">$request_contents</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//array of URLs</span>
<span class="token variable">$urls</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//array of cURL handles</span>
<span class="token variable">$chs</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//first POST content</span>
<span class="token variable">$request_contents</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">'a'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'apple'</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'b'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'banana'</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//second POST content</span>
<span class="token variable">$request_contents</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">'a'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'fish'</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'b'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'shrimp'</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//set the urls</span>
<span class="token variable">$urls</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'http://www.example.com'</span><span class="token punctuation">;</span>
<span class="token variable">$urls</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'http://www.example2.com'</span><span class="token punctuation">;</span>

<span class="token comment">//create the array of cURL handles and add to a multi_curl</span>
<span class="token variable">$mh</span> <span class="token operator">=</span> <span class="token function">curl_multi_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$urls</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=&gt;</span> <span class="token variable">$url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$chs</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$chs</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_RETURNTRANSFER</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$chs</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_POST</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$chs</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_POSTFIELDS</span><span class="token punctuation">,</span> <span class="token variable">$request_contents</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">curl_multi_add_handle</span><span class="token punctuation">(</span><span class="token variable">$mh</span><span class="token punctuation">,</span> <span class="token variable">$chs</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>Then, we use curl_multi_exec to send the requests</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">//running the requests</span>
<span class="token variable">$running</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>
<span class="token keyword">do</span> <span class="token punctuation">{</span>
  <span class="token function">curl_multi_exec</span><span class="token punctuation">(</span><span class="token variable">$mh</span><span class="token punctuation">,</span> <span class="token variable">$running</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token variable">$running</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//getting the responses</span>
<span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token function">array_keys</span><span class="token punctuation">(</span><span class="token variable">$chs</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$error</span> <span class="token operator">=</span> <span class="token function">curl_error</span><span class="token punctuation">(</span><span class="token variable">$chs</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$last_effective_URL</span> <span class="token operator">=</span> <span class="token function">curl_getinfo</span><span class="token punctuation">(</span><span class="token variable">$chs</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">CURLINFO_EFFECTIVE_URL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$time</span> <span class="token operator">=</span> <span class="token function">curl_getinfo</span><span class="token punctuation">(</span><span class="token variable">$chs</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">CURLINFO_TOTAL_TIME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token function">curl_multi_getcontent</span><span class="token punctuation">(</span><span class="token variable">$chs</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// get results</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$error</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">echo</span> <span class="token string double-quoted-string">&quot;The request <span class="token interpolation"><span class="token variable">$key</span></span> return a error: <span class="token interpolation"><span class="token variable">$error</span></span>&quot;</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;\n&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">echo</span> <span class="token string double-quoted-string">&quot;The request to '<span class="token interpolation"><span class="token variable">$last_effective_URL</span></span>' returned '<span class="token interpolation"><span class="token variable">$response</span></span>' in <span class="token interpolation"><span class="token variable">$time</span></span> seconds.&quot;</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;\n&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">curl_multi_remove_handle</span><span class="token punctuation">(</span><span class="token variable">$mh</span><span class="token punctuation">,</span> <span class="token variable">$chs</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// close current handler</span>
<span class="token function">curl_multi_close</span><span class="token punctuation">(</span><span class="token variable">$mh</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>A possible return for this example could be:</p> <blockquote></blockquote> <p>The request to '<a href="http://www.example.com" target="_blank" rel="noopener noreferrer">http://www.example.com<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>' returned 'fruits' in 2 seconds.
The request to '<a href="http://www.example2.com" target="_blank" rel="noopener noreferrer">http://www.example2.com<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>' returned 'seafood' in 5 seconds.</p> <h2 id="creating-and-sending-a-request-with-a-custom-method"><a href="#creating-and-sending-a-request-with-a-custom-method" class="header-anchor">#</a> Creating and sending a request with a custom method</h2> <p>By default, PHP Curl supports <code>GET</code> and <code>POST</code> requests. It is possible to also send custom requests, such as <code>DELETE</code>, <code>PUT</code> or <code>PATCH</code> (or even non-standard methods) using the <code>CURLOPT_CUSTOMREQUEST</code> parameter.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$method</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'DELETE'</span><span class="token punctuation">;</span> <span class="token comment">// Create a DELETE request</span>

<span class="token variable">$ch</span> <span class="token operator">=</span> <span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_RETURNTRANSFER</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_CUSTOMREQUEST</span><span class="token punctuation">,</span> <span class="token variable">$method</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$content</span> <span class="token operator">=</span> <span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">curl_close</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="sending-multi-dimensional-data-and-multiple-files-with-curlfile-in-one-request"><a href="#sending-multi-dimensional-data-and-multiple-files-with-curlfile-in-one-request" class="header-anchor">#</a> Sending multi-dimensional data and multiple files with CurlFile in one request</h2> <p>Let's say we have a form like the one below. We want to send the data to our webserver via AJAX and from there to a script running on an external server.</p> <p><a href="https://i.stack.imgur.com/55fQ6.png" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/55fQ6.png" alt="This is the form we want to send"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>So we have normal inputs, a multi-select field and a file dropzone where we can upload multiple files.</p> <p>Assuming the AJAX POST request was successful we get the following data on PHP site:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// print_r($_POST)</span>

<span class="token keyword">Array</span>
<span class="token punctuation">(</span>
    <span class="token punctuation">[</span>first_name<span class="token punctuation">]</span> <span class="token operator">=&gt;</span> John
    <span class="token punctuation">[</span>last_name<span class="token punctuation">]</span> <span class="token operator">=&gt;</span> Doe
    <span class="token punctuation">[</span>activities<span class="token punctuation">]</span> <span class="token operator">=&gt;</span> <span class="token keyword">Array</span>
        <span class="token punctuation">(</span>
            <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span> soccer
            <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span> hiking
        <span class="token punctuation">)</span>
<span class="token punctuation">)</span>

</code></pre></div><p>and the files should look like this</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// print_r($_FILES)</span>

<span class="token keyword">Array</span>
<span class="token punctuation">(</span>
    <span class="token punctuation">[</span>upload<span class="token punctuation">]</span> <span class="token operator">=&gt;</span> <span class="token keyword">Array</span>
        <span class="token punctuation">(</span>
            <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=&gt;</span> <span class="token keyword">Array</span>
                <span class="token punctuation">(</span>
                    <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span> my_photo<span class="token operator">.</span>jpg
                    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span> my_life<span class="token operator">.</span>pdf
                <span class="token punctuation">)</span>

            <span class="token punctuation">[</span>type<span class="token punctuation">]</span> <span class="token operator">=&gt;</span> <span class="token keyword">Array</span>
                <span class="token punctuation">(</span>
                    <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span> image<span class="token operator">/</span>jpg
                    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span> application<span class="token operator">/</span>pdf
                <span class="token punctuation">)</span>

            <span class="token punctuation">[</span>tmp_name<span class="token punctuation">]</span> <span class="token operator">=&gt;</span> <span class="token keyword">Array</span>
                <span class="token punctuation">(</span>
                    <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span> <span class="token operator">/</span>tmp<span class="token operator">/</span>phpW5spji
                    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span> <span class="token operator">/</span>tmp<span class="token operator">/</span>phpWgnUeY
                <span class="token punctuation">)</span>

            <span class="token punctuation">[</span>error<span class="token punctuation">]</span> <span class="token operator">=&gt;</span> <span class="token keyword">Array</span>
                <span class="token punctuation">(</span>
                    <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span> <span class="token number">0</span>
                    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span> <span class="token number">0</span>
                <span class="token punctuation">)</span>

            <span class="token punctuation">[</span>size<span class="token punctuation">]</span> <span class="token operator">=&gt;</span> <span class="token keyword">Array</span>
                <span class="token punctuation">(</span>
                    <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span> <span class="token number">647548</span>
                    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span> <span class="token number">643223</span>
                <span class="token punctuation">)</span>

        <span class="token punctuation">)</span>

<span class="token punctuation">)</span>

</code></pre></div><p>So far, so good. Now we want to send this data and files to the external server using cURL with the CurlFile Class</p> <p>Since cURL only accepts a simple but not a multi-dimensional array, we have to flatten the $_POST array first.</p> <p>To do this, you could use <a href="http://codereview.stackexchange.com/a/14685" target="_blank" rel="noopener noreferrer">this function for example<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> which gives you the following:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// print_r($new_post_array)</span>

<span class="token keyword">Array</span>
<span class="token punctuation">(</span>
    <span class="token punctuation">[</span>first_name<span class="token punctuation">]</span> <span class="token operator">=&gt;</span> John
    <span class="token punctuation">[</span>last_name<span class="token punctuation">]</span> <span class="token operator">=&gt;</span> Doe
    <span class="token punctuation">[</span>activities<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span> soccer
    <span class="token punctuation">[</span>activities<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span> hiking
<span class="token punctuation">)</span>

</code></pre></div><p>The next step is to create CurlFile Objects for the uploaded files. This is done by the following loop:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$files</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;upload&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;error&quot;</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=&gt;</span> <span class="token variable">$error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$error</span> <span class="token operator">==</span> <span class="token constant">UPLOAD_ERR_OK</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token variable">$files</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;upload[<span class="token interpolation"><span class="token variable">$key</span></span>]&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">curl_file_create</span><span class="token punctuation">(</span>
            <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>curl_file_create is a helper function of the CurlFile Class and creates the CurlFile objects. We save each object in the $files array with keys named &quot;upload[0]&quot; and &quot;upload[1]&quot; for our two files.</p> <p>We now have to combine the flattened post array and the files array and save it as $data like this:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$new_post_array</span> <span class="token operator">+</span> <span class="token variable">$files</span><span class="token punctuation">;</span>

</code></pre></div><p>The last step is to send the cURL request:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$ch</span> <span class="token operator">=</span> <span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">curl_setopt_array</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
    <span class="token constant">CURLOPT_POST</span> <span class="token operator">=&gt;</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token constant">CURLOPT_URL</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;https://api.externalserver.com/upload.php&quot;</span><span class="token punctuation">,</span>
    <span class="token constant">CURLOPT_RETURNTRANSFER</span> <span class="token operator">=&gt;</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token constant">CURLINFO_HEADER_OUT</span> <span class="token operator">=&gt;</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token constant">CURLOPT_POSTFIELDS</span> <span class="token operator">=&gt;</span> <span class="token variable">$data</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">curl_close</span> <span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>Since $data is now a simple (flat) array, cURL automatically sends this POST request with Content Type: multipart/form-data</p> <p>In upload.php on the external server you can now get the post data and files with $_POST and $_FILES as you would normally do.</p> <h2 id="get-and-set-custom-http-headers-in-php"><a href="#get-and-set-custom-http-headers-in-php" class="header-anchor">#</a> Get and Set custom http headers in php</h2> <p><strong>Sending The Request Header</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$uri</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'http://localhost/http.php'</span><span class="token punctuation">;</span>
<span class="token variable">$ch</span> <span class="token operator">=</span> <span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token variable">$uri</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">curl_setopt_array</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
    <span class="token constant">CURLOPT_HTTPHEADER</span>  <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'X-User: admin'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'X-Authorization: 123456'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token constant">CURLOPT_RETURNTRANSFER</span>  <span class="token operator">=&gt;</span><span class="token constant boolean">true</span><span class="token punctuation">,</span>
    <span class="token constant">CURLOPT_VERBOSE</span>     <span class="token operator">=&gt;</span> <span class="token number">1</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$out</span> <span class="token operator">=</span> <span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">curl_close</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// echo response output</span>
<span class="token keyword">echo</span> <span class="token variable">$out</span><span class="token punctuation">;</span>

</code></pre></div><p><strong>Reading the custom header</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">apache_request_headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p><strong>OutPut :-</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">Array</span>
<span class="token punctuation">(</span>
    <span class="token punctuation">[</span>Host<span class="token punctuation">]</span> <span class="token operator">=&gt;</span> localhost
    <span class="token punctuation">[</span>Accept<span class="token punctuation">]</span> <span class="token operator">=&gt;</span> <span class="token operator">*</span><span class="token operator">/</span><span class="token operator">*</span>
    <span class="token punctuation">[</span><span class="token constant">X</span><span class="token operator">-</span>User<span class="token punctuation">]</span> <span class="token operator">=&gt;</span> admin
    <span class="token punctuation">[</span><span class="token constant">X</span><span class="token operator">-</span>Authorization<span class="token punctuation">]</span> <span class="token operator">=&gt;</span> <span class="token number">123456</span>
    <span class="token punctuation">[</span>Content<span class="token operator">-</span>Length<span class="token punctuation">]</span> <span class="token operator">=&gt;</span> <span class="token number">9</span>
    <span class="token punctuation">[</span>Content<span class="token operator">-</span>Type<span class="token punctuation">]</span> <span class="token operator">=&gt;</span> application<span class="token operator">/</span>x<span class="token operator">-</span>www<span class="token operator">-</span>form<span class="token operator">-</span>urlencoded
<span class="token punctuation">)</span>

</code></pre></div><p>We can also send the header using below syntax :-</p> <div class="language-php extra-class"><pre class="language-php"><code>curl <span class="token operator">--</span>header <span class="token string double-quoted-string">&quot;X-MyHeader: 123&quot;</span> www<span class="token operator">.</span>google<span class="token operator">.</span>com

</code></pre></div><h4 id="syntax"><a href="#syntax" class="header-anchor">#</a> Syntax</h4> <ul><li>resource curl_init ([ string $url = NULL ] )</li> <li>bool curl_setopt ( resource $ch , int $option , mixed $value )</li> <li>bool curl_setopt_array ( resource $ch, array $options )</li> <li>mixed curl_exec ( resource $ch )</li> <li>void curl_close ( resource $ch )</li></ul> <h4 id="parameters"><a href="#parameters" class="header-anchor">#</a> Parameters</h4> <table><thead><tr><th>Parameter</th> <th>Details</th></tr></thead> <tbody><tr><td><strong>curl_init</strong></td> <td>--  Initialize a cURL session</td></tr> <tr><td>url</td> <td>The url to be used in the cURL request</td></tr> <tr><td><strong>curl_setopt</strong></td> <td>-- Set an option for a cURL transfer</td></tr> <tr><td>ch</td> <td>The cURL handle (return value from <strong>curl_init()</strong>)</td></tr> <tr><td>option</td> <td>CURLOPT_XXX to be set - see <a href="http://php.net/manual/en/function.curl-setopt.php" target="_blank" rel="noopener noreferrer">PHP documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for the list of options and acceptable values</td></tr> <tr><td>value</td> <td>The value to be set on the cURL handle for the given option</td></tr> <tr><td><strong>curl_exec</strong></td> <td>--  Perform a cURL session</td></tr> <tr><td>ch</td> <td>The cURL handle (return value from <strong>curl_init()</strong>)</td></tr> <tr><td><strong>curl_close</strong></td> <td>--  Close a cURL session</td></tr> <tr><td>ch</td> <td>The cURL handle (return value from <strong>curl_init()</strong>)</td></tr></tbody></table></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/php/using-curl-in-php.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      
      <a href="/php/soap-client.html" class="prev">
        SOAP Client
      </a></span> <span class="next"><a href="/php/reflection.html">
        Reflection
      </a>
      
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/2526.5d88bc7c.js" defer></script>
  </body>
</html>
