<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>PHP - Image Processing with GD</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Image output, Creating an image, Image Cropping and Resizing">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="PHP - Image Processing with GD">
    <meta property="og:description" content="Image output, Creating an image, Image Cropping and Resizing">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/php/image-processing-with-gd.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="PHP - Image Processing with GD">
    <meta name="twitter:description" content="Image output, Creating an image, Image Cropping and Resizing">
    <meta name="twitter:url" content="/php/image-processing-with-gd.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    <link rel="preload" href="/assets/css/0.styles.8b877eb8.css" as="style"><link rel="preload" href="/assets/js/app.ced448ab.js" as="script"><link rel="preload" href="/assets/js/3.f1d73125.js" as="script"><link rel="preload" href="/assets/js/2464.79929c6e.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.8b877eb8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>PHP</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/php/" class="sidebar-link">Disclaimer</a></li><li><a href="/php/installing-a-php-environment-on-windows.html" class="sidebar-link">Installing a PHP environment on Windows</a></li><li><a href="/php/installing-on-linux-unix-environments.html" class="sidebar-link">Installing on Linux/Unix Environments</a></li><li><a href="/php/getting-started-with-php.html" class="sidebar-link">Getting started with PHP</a></li><li><a href="/php/variables.html" class="sidebar-link">Variables</a></li><li><a href="/php/variable-scope.html" class="sidebar-link">Variable Scope</a></li><li><a href="/php/superglobal-variables-php.html" class="sidebar-link">Superglobal Variables PHP</a></li><li><a href="/php/outputting-the-value-of-a-variable.html" class="sidebar-link">Outputting the Value of a Variable</a></li><li><a href="/php/constants.html" class="sidebar-link">Constants</a></li><li><a href="/php/magic-constants.html" class="sidebar-link">Magic Constants</a></li><li><a href="/php/comments.html" class="sidebar-link">Comments</a></li><li><a href="/php/types.html" class="sidebar-link">Types</a></li><li><a href="/php/operators.html" class="sidebar-link">Operators</a></li><li><a href="/php/references.html" class="sidebar-link">References</a></li><li><a href="/php/arrays.html" class="sidebar-link">Arrays</a></li><li><a href="/php/array-iteration.html" class="sidebar-link">Array iteration</a></li><li><a href="/php/executing-upon-an-array.html" class="sidebar-link">Executing Upon an Array</a></li><li><a href="/php/manipulating-an-array.html" class="sidebar-link">Manipulating an Array</a></li><li><a href="/php/processing-multiple-arrays-together.html" class="sidebar-link">Processing Multiple Arrays Together</a></li><li><a href="/php/datetime-class.html" class="sidebar-link">Datetime Class</a></li><li><a href="/php/working-with-dates-and-time.html" class="sidebar-link">Working with Dates and Time</a></li><li><a href="/php/control-structures.html" class="sidebar-link">Control Structures</a></li><li><a href="/php/loops.html" class="sidebar-link">Loops</a></li><li><a href="/php/functions.html" class="sidebar-link">Functions</a></li><li><a href="/php/functional-programming.html" class="sidebar-link">Functional Programming</a></li><li><a href="/php/alternative-syntax-for-control-structures.html" class="sidebar-link">Alternative Syntax for Control Structures</a></li><li><a href="/php/string-formatting.html" class="sidebar-link">String formatting</a></li><li><a href="/php/string-parsing.html" class="sidebar-link">String Parsing</a></li><li><a href="/php/classes-and-objects.html" class="sidebar-link">Classes and Objects</a></li><li><a href="/php/namespaces.html" class="sidebar-link">Namespaces</a></li><li><a href="/php/sessions.html" class="sidebar-link">Sessions</a></li><li><a href="/php/cookies.html" class="sidebar-link">Cookies</a></li><li><a href="/php/output-buffering.html" class="sidebar-link">Output Buffering</a></li><li><a href="/php/json.html" class="sidebar-link">JSON</a></li><li><a href="/php/soap-client.html" class="sidebar-link">SOAP Client</a></li><li><a href="/php/using-curl-in-php.html" class="sidebar-link">Using cURL in PHP</a></li><li><a href="/php/reflection.html" class="sidebar-link">Reflection</a></li><li><a href="/php/dependency-injection.html" class="sidebar-link">Dependency Injection</a></li><li><a href="/php/xml.html" class="sidebar-link">XML</a></li><li><a href="/php/simplexml.html" class="sidebar-link">SimpleXML</a></li><li><a href="/php/parsing-html.html" class="sidebar-link">Parsing HTML</a></li><li><a href="/php/regular-expressions-regexp-pcre.html" class="sidebar-link">Regular Expressions (regexp/PCRE)</a></li><li><a href="/php/traits.html" class="sidebar-link">Traits</a></li><li><a href="/php/composer-dependency-manager.html" class="sidebar-link">Composer Dependency Manager</a></li><li><a href="/php/magic-methods.html" class="sidebar-link">Magic Methods</a></li><li><a href="/php/file-handling.html" class="sidebar-link">File handling</a></li><li><a href="/php/streams.html" class="sidebar-link">Streams</a></li><li><a href="/php/type-hinting.html" class="sidebar-link">Type hinting</a></li><li><a href="/php/filters-filter-functions.html" class="sidebar-link">Filters &amp; Filter Functions</a></li><li><a href="/php/generators.html" class="sidebar-link">Generators</a></li><li><a href="/php/utf-8.html" class="sidebar-link">UTF-8</a></li><li><a href="/php/how-to-break-down-an-url.html" class="sidebar-link">How to break down an URL</a></li><li><a href="/php/object-serialization.html" class="sidebar-link">Object Serialization</a></li><li><a href="/php/serialization.html" class="sidebar-link">Serialization</a></li><li><a href="/php/closure.html" class="sidebar-link">Closure</a></li><li><a href="/php/reading-request-data.html" class="sidebar-link">Reading Request Data</a></li><li><a href="/php/type-juggling-and-non-strict-comparison-issues.html" class="sidebar-link">Type juggling and Non-Strict Comparison Issues</a></li><li><a href="/php/sockets.html" class="sidebar-link">Sockets</a></li><li><a href="/php/pdo.html" class="sidebar-link">PDO</a></li><li><a href="/php/php-mysqli.html" class="sidebar-link">PHP MySQLi</a></li><li><a href="/php/sqlite3.html" class="sidebar-link">SQLite3</a></li><li><a href="/php/using-mongodb.html" class="sidebar-link">Using MongoDB</a></li><li><a href="/php/mongo-php.html" class="sidebar-link">mongo-php</a></li><li><a href="/php/using-redis-with-php.html" class="sidebar-link">Using Redis with PHP</a></li><li><a href="/php/sending-email.html" class="sidebar-link">Sending Email</a></li><li><a href="/php/using-sqlsrv.html" class="sidebar-link">Using SQLSRV</a></li><li><a href="/php/command-line-interface-cli.html" class="sidebar-link">Command Line Interface (CLI)</a></li><li><a href="/php/localization.html" class="sidebar-link">Localization</a></li><li><a href="/php/headers-manipulation.html" class="sidebar-link">Headers Manipulation</a></li><li><a href="/php/coding-conventions.html" class="sidebar-link">Coding Conventions</a></li><li><a href="/php/asynchronous-programming.html" class="sidebar-link">Asynchronous programming</a></li><li><a href="/php/how-to-detect-client-ip-address.html" class="sidebar-link">How to Detect Client IP Address</a></li><li><a href="/php/create-pdf-files-in-php.html" class="sidebar-link">Create PDF files in PHP</a></li><li><a href="/php/yaml-in-php.html" class="sidebar-link">YAML in PHP</a></li><li><a href="/php/image-processing-with-gd.html" class="active sidebar-link">Image Processing with GD</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/php/image-processing-with-gd.html#image-output" class="sidebar-link">Image output</a></li><li class="sidebar-sub-header"><a href="/php/image-processing-with-gd.html#creating-an-image" class="sidebar-link">Creating an image</a></li><li class="sidebar-sub-header"><a href="/php/image-processing-with-gd.html#image-cropping-and-resizing" class="sidebar-link">Image Cropping and Resizing</a></li></ul></li><li><a href="/php/imagick.html" class="sidebar-link">Imagick</a></li><li><a href="/php/soap-server.html" class="sidebar-link">SOAP Server</a></li><li><a href="/php/machine-learning.html" class="sidebar-link">Machine learning</a></li><li><a href="/php/cache.html" class="sidebar-link">Cache</a></li><li><a href="/php/autoloading-primer.html" class="sidebar-link">Autoloading Primer</a></li><li><a href="/php/spl-data-structures.html" class="sidebar-link">SPL data structures</a></li><li><a href="/php/imap.html" class="sidebar-link">IMAP</a></li><li><a href="/php/http-authentication.html" class="sidebar-link">HTTP Authentication</a></li><li><a href="/php/websockets.html" class="sidebar-link">WebSockets</a></li><li><a href="/php/bc-math-binary-calculator.html" class="sidebar-link">BC Math (Binary Calculator)</a></li><li><a href="/php/docker-deployment.html" class="sidebar-link">Docker deployment</a></li><li><a href="/php/apcu.html" class="sidebar-link">APCu</a></li><li><a href="/php/php-built-in-server.html" class="sidebar-link">PHP Built in server</a></li><li><a href="/php/psr.html" class="sidebar-link">PSR</a></li><li><a href="/php/phpdoc.html" class="sidebar-link">PHPDoc</a></li><li><a href="/php/design-patterns.html" class="sidebar-link">Design Patterns</a></li><li><a href="/php/compile-php-extensions.html" class="sidebar-link">Compile PHP Extensions</a></li><li><a href="/php/common-errors.html" class="sidebar-link">Common Errors</a></li><li><a href="/php/compilation-of-errors-and-warnings.html" class="sidebar-link">Compilation of Errors and Warnings</a></li><li><a href="/php/exception-handling-and-error-reporting.html" class="sidebar-link">Exception Handling and Error Reporting</a></li><li><a href="/php/debugging.html" class="sidebar-link">Debugging</a></li><li><a href="/php/unit-testing.html" class="sidebar-link">Unit Testing</a></li><li><a href="/php/performance.html" class="sidebar-link">Performance</a></li><li><a href="/php/multiprocessing.html" class="sidebar-link">Multiprocessing</a></li><li><a href="/php/multi-threading-extension.html" class="sidebar-link">Multi Threading Extension</a></li><li><a href="/php/secure-remeber-me.html" class="sidebar-link">Secure Remeber Me</a></li><li><a href="/php/security.html" class="sidebar-link">Security</a></li><li><a href="/php/cryptography.html" class="sidebar-link">Cryptography</a></li><li><a href="/php/password-hashing-functions.html" class="sidebar-link">Password Hashing Functions</a></li><li><a href="/php/urls.html" class="sidebar-link">URLs</a></li><li><a href="/php/unicode-support-in-php.html" class="sidebar-link">Unicode Support in PHP</a></li><li><a href="/php/getting-started-with-php-7.html" class="sidebar-link">Getting started with php-7</a></li><li><a href="/php/null-coalesce-operator.html" class="sidebar-link">Null Coalesce Operator</a></li><li><a href="/php/spaceship-operator.html" class="sidebar-link">Spaceship operator</a></li><li><a href="/php/anonymous-class.html" class="sidebar-link">Anonymous class</a></li><li><a href="/php/contributing-to-the-php-manual.html" class="sidebar-link">Contributing to the PHP Manual</a></li><li><a href="/php/contributing-to-the-php-core.html" class="sidebar-link">Contributing to the PHP Core</a></li><li><a href="/php/getting-started-with-composer-php.html" class="sidebar-link">Getting started with composer-php</a></li><li><a href="/php/auto-loading-with-composer.html" class="sidebar-link">Auto loading with composer</a></li><li><a href="/php/how-to-use-private-repositories-with-composer.html" class="sidebar-link">How to use private repositories with Composer</a></li><li><a href="/php/getting-started-with-phpunit.html" class="sidebar-link">Getting Started with PHPUnit</a></li><li><a href="/php/assertions.html" class="sidebar-link">Assertions</a></li><li><a href="/php/test-doubles-mocks-and-stubs.html" class="sidebar-link">Test Doubles (Mocks and Stubs)</a></li><li><a href="/php/recipes.html" class="sidebar-link">Recipes</a></li><li><a href="/php/php-mysqli-affected-rows-returns-0-when-it-should-return-a-positive-integer.html" class="sidebar-link">php mysqli affected rows returns 0 when it should return a positive integer</a></li><li><a href="/php/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="image-processing-with-gd"><a href="#image-processing-with-gd" class="header-anchor">#</a> Image Processing with GD</h1> <h2 id="image-output"><a href="#image-output" class="header-anchor">#</a> Image output</h2> <p>An image can be created using <a href="http://php.net/manual/en/function.imagepng.php#refsect1-function.imagepng-seealso" target="_blank" rel="noopener noreferrer"><code>image*</code> functions<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, where <code>*</code> is the file format.</p> <p>They have this syntax in common:</p> <div class="language-php extra-class"><pre class="language-php"><code>bool <span class="token function">image___</span><span class="token punctuation">(</span>resource <span class="token variable">$im</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> mixed <span class="token variable">$to</span> <span class="token punctuation">[</span> other parameters<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>

</code></pre></div><h3 id="saving-to-a-file"><a href="#saving-to-a-file" class="header-anchor">#</a> Saving to a file</h3> <p>If you want to save the image to a file, you can pass the filename, or an opened file stream, as <code>$to</code>. If you pass a stream, you don't need to close it, because GD will automatically close it.</p> <p>For example, to save a PNG file:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token function">imagepng</span><span class="token punctuation">(</span><span class="token variable">$image</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">&quot;/path/to/target/file.png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$stream</span> <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;phar://path/to/target.phar/file.png&quot;</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">&quot;wb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">imagepng</span><span class="token punctuation">(</span><span class="token variable">$image2</span><span class="token punctuation">,</span> <span class="token variable">$stream</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Don't fclose($stream)</span>

</code></pre></div><p>When using <code>fopen</code>, make sure to use the <code>b</code> flag rather than the <code>t</code> flag, because the file is a binary output.</p> <p>Do <strong>not</strong> try to pass <code>fopen(&quot;php://temp&quot;, $f)</code> or <code>fopen(&quot;php://memory&quot;, $f)</code> to it. Since the stream is closed by the function after the call, you will be unable to use it further, such as to retrieve its contents.</p> <h3 id="output-as-an-http-response"><a href="#output-as-an-http-response" class="header-anchor">#</a> Output as an HTTP response</h3> <p>If you want to directly return this image as the response of the image (e.g. to create dynamic badges), you don't need to pass anything (or pass <code>null</code>) as the second argument. However, in the HTTP response, you need to specify your content type:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token function">header</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;Content-Type: <span class="token interpolation"><span class="token variable">$mimeType</span></span>&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p><code>$mimeType</code> is the MIME type of the format you are returning. Examples include <code>image/png</code>, <code>image/gif</code> and <code>image/jpeg</code>.</p> <h3 id="writing-into-a-variable"><a href="#writing-into-a-variable" class="header-anchor">#</a> Writing into a variable</h3> <p>There are two ways to write into a variable.</p> <h3 id="using-ob-output-buffering"><a href="#using-ob-output-buffering" class="header-anchor">#</a> Using OB (Output Buffering)</h3> <div class="language-php extra-class"><pre class="language-php"><code><span class="token function">ob_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">imagepng</span><span class="token punctuation">(</span><span class="token variable">$image</span><span class="token punctuation">,</span> <span class="token constant">null</span><span class="token punctuation">,</span> <span class="token variable">$quality</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// pass null to supposedly write to stdout</span>
<span class="token variable">$binary</span> <span class="token operator">=</span> <span class="token function">ob_get_clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h3 id="using-stream-wrappers"><a href="#using-stream-wrappers" class="header-anchor">#</a> Using stream wrappers</h3> <p>You may have many reasons that you don't want to use output buffering. For example, you may already have OB on. Therefore, an alternative is needed.</p> <p>Using the <code>stream_wrapper_register</code> function, a new stream wrapper can be registered. Hence, you can pass a stream to the image output function, and retrieve it later.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">class</span> <span class="token class-name">GlobalStream</span><span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token variable">$var</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">stream_open</span><span class="token punctuation">(</span>string <span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token keyword">var</span> <span class="token operator">=</span><span class="token operator">&amp;</span> <span class="token variable">$GLOBALS</span><span class="token punctuation">[</span><span class="token function">parse_url</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token double-quoted-string string">&quot;host&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean constant">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">stream_write</span><span class="token punctuation">(</span>string <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token keyword">var</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token variable">$data</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">stream_wrapper_register</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;global&quot;</span><span class="token punctuation">,</span> GlobalStream<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$image</span> <span class="token operator">=</span> <span class="token function">imagecreatetruecolor</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">imagefill</span><span class="token punctuation">(</span><span class="token variable">$image</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">imagecolorallocate</span><span class="token punctuation">(</span><span class="token variable">$image</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$stream</span> <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;global://myImage&quot;</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">imagepng</span><span class="token punctuation">(</span><span class="token variable">$image</span><span class="token punctuation">,</span> <span class="token variable">$stream</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$myImage</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</span></code></pre></div><p>In this example, the <code>GlobalStream</code> class writes any input into the reference variable (i.e. indirectly write to the global variable of the given name). The global variable can later be retrieved directly.</p> <p>There are some special things to note:</p> <ul><li>A fully implemented stream wrapper class should look like <a href="http://php.net/manual/en/stream.streamwrapper.example-1.php" target="_blank" rel="noopener noreferrer">this<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, but according to tests with the <code>__call</code> magic method, only <code>stream_open</code>, <code>stream_write</code> and <code>stream_close</code> are called from internal functions.</li> <li>No flags are required in the <code>fopen</code> call, but you should at least pass an empty string. This is because the <code>fopen</code> function expects such parameter, and even if you don't use it in your <code>stream_open</code> implementation, a dummy one is still required.</li> <li>According to tests, <code>stream_write</code> is called multiple times. Remember to use <code>.=</code> (concatenation assignment), not <code>=</code> (direct variable assignment).</li></ul> <h3 id="example-usage"><a href="#example-usage" class="header-anchor">#</a> Example usage</h3> <p>In the <code>&lt;img&gt;</code> HTML tag, an image can be directly provided rather than using an external link:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">echo</span> <span class="token single-quoted-string string">'&lt;img src=&quot;data:image/png;base64,'</span> <span class="token punctuation">.</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$binary</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token single-quoted-string string">'&quot;&gt;'</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="creating-an-image"><a href="#creating-an-image" class="header-anchor">#</a> Creating an image</h2> <p>To create a blank image, use the <code>imagecreatetruecolor</code> function:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$img</span> <span class="token operator">=</span> <span class="token function">imagecreatetruecolor</span><span class="token punctuation">(</span><span class="token variable">$width</span><span class="token punctuation">,</span> <span class="token variable">$height</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p><code>$img</code> is now a resource variable for an image resource with <code>$width</code>x<code>$height</code> pixels. Note that width counts from left to right, and height counts from top to bottom.</p> <p>Image resources can also be created from <a href="http://php.net/manual/en/ref.image.php" target="_blank" rel="noopener noreferrer">image creation functions<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, such as:</p> <ul><li><code>imagecreatefrompng</code></li> <li><code>imagecreatefromjpeg</code></li> <li>other <code>imagecreatefrom*</code> functions.</li></ul> <p>Image resources may be freed later when there are no more references to them. However, to free the memory immediately (this may be important if you are processing many large images), using <code>imagedestroy()</code> on an image when it is no longer used might be a good practice.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token function">imagedestroy</span><span class="token punctuation">(</span><span class="token variable">$image</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h3 id="converting-an-image"><a href="#converting-an-image" class="header-anchor">#</a> Converting an image</h3> <p>Images created by image conversion does not modify the image until you output it. Therefore, an image converter can be as simple as three lines of code:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">function</span> <span class="token function">convertJpegToPng</span><span class="token punctuation">(</span>string <span class="token variable">$filename</span><span class="token punctuation">,</span> string <span class="token variable">$outputFile</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$im</span> <span class="token operator">=</span> <span class="token function">imagecreatefromjpeg</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imagepng</span><span class="token punctuation">(</span><span class="token variable">$im</span><span class="token punctuation">,</span> <span class="token variable">$outputFile</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">imagedestroy</span><span class="token punctuation">(</span><span class="token variable">$im</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="image-cropping-and-resizing"><a href="#image-cropping-and-resizing" class="header-anchor">#</a> Image Cropping and Resizing</h2> <p>If you have an image and want to create a new image, with new dimensions, you can use <code>imagecopyresampled</code> function:</p> <p>first create a new <code>image</code> with desired dimensions:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// new image</span>
<span class="token variable">$dst_img</span> <span class="token operator">=</span> <span class="token function">imagecreatetruecolor</span><span class="token punctuation">(</span><span class="token variable">$width</span><span class="token punctuation">,</span> <span class="token variable">$height</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>and store the original image into a variable. To do so, you may use one of the <code>createimagefrom*</code> functions where * stands for:</p> <ul><li>jpeg</li> <li>gif</li> <li>png</li> <li>string</li></ul> <p>For example:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">//original image</span>
<span class="token variable">$src_img</span><span class="token operator">=</span><span class="token function">imagecreatefromstring</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$original_image_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>Now, copy all (or part of) original image (src_img) into the new image (dst_img) by <code>imagecopyresampled</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token function">imagecopyresampled</span><span class="token punctuation">(</span><span class="token variable">$dst_img</span><span class="token punctuation">,</span> <span class="token variable">$src_img</span><span class="token punctuation">,</span> 
    <span class="token variable">$dst_x</span> <span class="token punctuation">,</span><span class="token variable">$dst_y</span><span class="token punctuation">,</span> <span class="token variable">$src_x</span><span class="token punctuation">,</span> <span class="token variable">$src_y</span><span class="token punctuation">,</span> 
    <span class="token variable">$dst_width</span><span class="token punctuation">,</span> <span class="token variable">$dst_height</span><span class="token punctuation">,</span> <span class="token variable">$src_width</span><span class="token punctuation">,</span> <span class="token variable">$src_height</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>To set <code>src_*</code> and <code>dst_*</code> dimensions, use the below image:</p> <p><a href="https://i.stack.imgur.com/6MFxN.jpg" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/6MFxN.jpg" alt="enter image description here"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>Now, if you want to copy entire of source (initial) image, into entire of destination area (no cropping):</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$src_x</span> <span class="token operator">=</span> <span class="token variable">$src_y</span> <span class="token operator">=</span> <span class="token variable">$dst_x</span> <span class="token operator">=</span> <span class="token variable">$dst_y</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token variable">$dst_width</span> <span class="token operator">=</span> <span class="token variable">$width</span><span class="token punctuation">;</span><span class="token comment">// width of new image</span>
<span class="token variable">$dst_height</span> <span class="token operator">=</span> <span class="token variable">$height</span><span class="token punctuation">;</span> <span class="token comment">//height of new image</span>
<span class="token variable">$src_width</span> <span class="token operator">=</span> <span class="token function">imagesx</span><span class="token punctuation">(</span><span class="token variable">$src_img</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//width of initial image</span>
<span class="token variable">$src_height</span> <span class="token operator">=</span> <span class="token function">imagesy</span><span class="token punctuation">(</span><span class="token variable">$src_img</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//height of initial image</span>

</code></pre></div><h4 id="remarks"><a href="#remarks" class="header-anchor">#</a> Remarks</h4> <p>When using <code>header(&quot;Content-Type: $mimeType&quot;);</code> and <code>image____</code> to generate only an image to the output, be sure to output nothing else, note even a blank line after <code>?&gt;</code>.  (That can be a difficult 'bug' to track down -- you get no image and no clue as to why.)  The general advice is to not include ?&gt; at all here.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/php/image-processing-with-gd.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/php/yaml-in-php.html" class="prev">
        YAML in PHP
      </a></span> <span class="next"><a href="/php/imagick.html">
        Imagick
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.ced448ab.js" defer></script><script src="/assets/js/3.f1d73125.js" defer></script><script src="/assets/js/2464.79929c6e.js" defer></script>
  </body>
</html>
