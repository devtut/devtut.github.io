<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>iOS - UIKit Dynamics</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="The Falling Square, Flick View Based on Gesture Velocity, Sticky Corners Effect Using UIFieldBehaviors, UIDynamicBehavior Driven Custom Transition, Shade Transition with Real-World Physics Using UIDynamicBehaviors, Map Dynamic Animation Position Changes to Bounds">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="iOS - UIKit Dynamics">
    <meta property="og:description" content="The Falling Square, Flick View Based on Gesture Velocity, Sticky Corners Effect Using UIFieldBehaviors, UIDynamicBehavior Driven Custom Transition, Shade Transition with Real-World Physics Using UIDynamicBehaviors, Map Dynamic Animation Position Changes to Bounds">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/ios/uikit-dynamics.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="iOS - UIKit Dynamics">
    <meta name="twitter:description" content="The Falling Square, Flick View Based on Gesture Velocity, Sticky Corners Effect Using UIFieldBehaviors, UIDynamicBehavior Driven Custom Transition, Shade Transition with Real-World Physics Using UIDynamicBehaviors, Map Dynamic Animation Position Changes to Bounds">
    <meta name="twitter:url" content="/ios/uikit-dynamics.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    <link rel="preload" href="/assets/css/0.styles.8b877eb8.css" as="style"><link rel="preload" href="/assets/js/app.ced448ab.js" as="script"><link rel="preload" href="/assets/js/3.f1d73125.js" as="script"><link rel="preload" href="/assets/js/1474.9fbd9ddd.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.8b877eb8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>iOS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/ios/" class="sidebar-link">Disclaimer</a></li><li><a href="/ios/getting-started-with-ios.html" class="sidebar-link">Getting started with iOS</a></li><li><a href="/ios/uilabel.html" class="sidebar-link">UILabel</a></li><li><a href="/ios/uilabel-text-underlining.html" class="sidebar-link">UILabel text underlining</a></li><li><a href="/ios/attributedtext-in-uilabel.html" class="sidebar-link">attributedText in UILabel</a></li><li><a href="/ios/uibutton.html" class="sidebar-link">UIButton</a></li><li><a href="/ios/uidatepicker.html" class="sidebar-link">UIDatePicker</a></li><li><a href="/ios/uilocalnotification.html" class="sidebar-link">UILocalNotification</a></li><li><a href="/ios/uiimage.html" class="sidebar-link">UIImage</a></li><li><a href="/ios/convert-nsattributedstring-to-uiimage.html" class="sidebar-link">Convert NSAttributedString to UIImage</a></li><li><a href="/ios/uiimagepickercontroller.html" class="sidebar-link">UIImagePickerController</a></li><li><a href="/ios/uiimageview.html" class="sidebar-link">UIImageView</a></li><li><a href="/ios/resizing-uiimage.html" class="sidebar-link">Resizing UIImage</a></li><li><a href="/ios/cut-a-uiimage-into-a-circle.html" class="sidebar-link">Cut a UIImage into a circle</a></li><li><a href="/ios/uitableview.html" class="sidebar-link">UITableView</a></li><li><a href="/ios/uitableviewcontroller.html" class="sidebar-link">UITableViewController</a></li><li><a href="/ios/uirefreshcontrol-tableview.html" class="sidebar-link">UIRefreshControl TableView</a></li><li><a href="/ios/uitableviewcell.html" class="sidebar-link">UITableViewCell</a></li><li><a href="/ios/custom-methods-of-selection-of-uitableviewcells.html" class="sidebar-link">Custom methods of selection of UITableViewCells</a></li><li><a href="/ios/custom-methods-of-selection-of-uitableviewcells.html" class="sidebar-link">Custom methods of selection of UITableViewCells</a></li><li><a href="/ios/uiview.html" class="sidebar-link">UIView</a></li><li><a href="/ios/snapshot-of-uiview.html" class="sidebar-link">Snapshot of UIView</a></li><li><a href="/ios/uialertcontroller.html" class="sidebar-link">UIAlertController</a></li><li><a href="/ios/uicolor.html" class="sidebar-link">UIColor</a></li><li><a href="/ios/uitextview.html" class="sidebar-link">UITextView</a></li><li><a href="/ios/uitextfield-delegate.html" class="sidebar-link">UITextField Delegate</a></li><li><a href="/ios/uinavigationcontroller.html" class="sidebar-link">UINavigationController</a></li><li><a href="/ios/uigesturerecognizer.html" class="sidebar-link">UIGestureRecognizer</a></li><li><a href="/ios/uibarbuttonitem.html" class="sidebar-link">UIBarButtonItem</a></li><li><a href="/ios/uiscrollview.html" class="sidebar-link">UIScrollView</a></li><li><a href="/ios/uistackview.html" class="sidebar-link">UIStackView</a></li><li><a href="/ios/dynamically-updating-a-uistackview.html" class="sidebar-link">Dynamically updating a UIStackView</a></li><li><a href="/ios/uiscrollview-with-stackview-child.html" class="sidebar-link">UIScrollView with StackView child</a></li><li><a href="/ios/uiscrollview-autolayout.html" class="sidebar-link">UIScrollView AutoLayout</a></li><li><a href="/ios/uitextfield.html" class="sidebar-link">UITextField</a></li><li><a href="/ios/custom-uitextfield.html" class="sidebar-link">Custom UITextField</a></li><li><a href="/ios/uiviewcontroller.html" class="sidebar-link">UIViewController</a></li><li><a href="/ios/uiswitch.html" class="sidebar-link">UISwitch</a></li><li><a href="/ios/uicollectionview.html" class="sidebar-link">UICollectionView</a></li><li><a href="/ios/uisearchcontroller.html" class="sidebar-link">UISearchController</a></li><li><a href="/ios/uitabbarcontroller.html" class="sidebar-link">UITabBarController</a></li><li><a href="/ios/uiwebview.html" class="sidebar-link">UIWebView</a></li><li><a href="/ios/uiactivityviewcontroller.html" class="sidebar-link">UIActivityViewController</a></li><li><a href="/ios/uicontrol-event-handling-with-blocks.html" class="sidebar-link">UIControl - Event Handling with Blocks</a></li><li><a href="/ios/uisplitviewcontroller.html" class="sidebar-link">UISplitViewController</a></li><li><a href="/ios/uislider.html" class="sidebar-link">UISlider</a></li><li><a href="/ios/uistoryboard.html" class="sidebar-link">UIStoryboard</a></li><li><a href="/ios/uipageviewcontroller.html" class="sidebar-link">UIPageViewController</a></li><li><a href="/ios/uisplitviewcontroller.html" class="sidebar-link">UISplitViewController</a></li><li><a href="/ios/uifont.html" class="sidebar-link">UIFont</a></li><li><a href="/ios/uidevice.html" class="sidebar-link">UIDevice</a></li><li><a href="/ios/make-selective-uiview-corners-rounded.html" class="sidebar-link">Make selective UIView corners rounded</a></li><li><a href="/ios/custom-uiviews-from-xib-files.html" class="sidebar-link">Custom UIViews from XIB files</a></li><li><a href="/ios/uibezierpath.html" class="sidebar-link">UIBezierPath</a></li><li><a href="/ios/uipickerview.html" class="sidebar-link">UIPickerView</a></li><li><a href="/ios/uifeedbackgenerator.html" class="sidebar-link">UIFeedbackGenerator</a></li><li><a href="/ios/uiappearance.html" class="sidebar-link">UIAppearance</a></li><li><a href="/ios/uikit-dynamics-with-uicollectionview.html" class="sidebar-link">UIKit Dynamics with UICollectionView</a></li><li><a href="/ios/uipheonix-easy-flexible-dynamic-highly-scalable-ui-framework.html" class="sidebar-link">UIPheonix - easy, flexible, dynamic &amp; highly scalable UI framework</a></li><li><a href="/ios/uikit-dynamics.html" class="active sidebar-link">UIKit Dynamics</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ios/uikit-dynamics.html#the-falling-square" class="sidebar-link">The Falling Square</a></li><li class="sidebar-sub-header"><a href="/ios/uikit-dynamics.html#flick-view-based-on-gesture-velocity" class="sidebar-link">Flick View Based on Gesture Velocity</a></li><li class="sidebar-sub-header"><a href="/ios/uikit-dynamics.html#sticky-corners-effect-using-uifieldbehaviors" class="sidebar-link">&quot;Sticky Corners&quot; Effect Using UIFieldBehaviors</a></li><li class="sidebar-sub-header"><a href="/ios/uikit-dynamics.html#uidynamicbehavior-driven-custom-transition" class="sidebar-link">UIDynamicBehavior Driven Custom Transition</a></li><li class="sidebar-sub-header"><a href="/ios/uikit-dynamics.html#shade-transition-with-real-world-physics-using-uidynamicbehaviors" class="sidebar-link">Shade Transition with Real-World Physics Using UIDynamicBehaviors</a></li><li class="sidebar-sub-header"><a href="/ios/uikit-dynamics.html#map-dynamic-animation-position-changes-to-bounds" class="sidebar-link">Map Dynamic Animation Position Changes to Bounds</a></li></ul></li><li><a href="/ios/ui-testing.html" class="sidebar-link">UI Testing</a></li><li><a href="/ios/change-status-bar-color.html" class="sidebar-link">Change Status Bar Color</a></li><li><a href="/ios/uisegmentedcontrol.html" class="sidebar-link">UISegmentedControl</a></li><li><a href="/ios/passing-data-between-view-controllers.html" class="sidebar-link">Passing Data between View Controllers</a></li><li><a href="/ios/managing-the-keyboard.html" class="sidebar-link">Managing the Keyboard</a></li><li><a href="/ios/checking-for-network-connectivity.html" class="sidebar-link">Checking for Network Connectivity</a></li><li><a href="/ios/accessibility.html" class="sidebar-link">Accessibility</a></li><li><a href="/ios/auto-layout.html" class="sidebar-link">Auto Layout</a></li><li><a href="/ios/mkmapview.html" class="sidebar-link">MKMapView</a></li><li><a href="/ios/nsarray.html" class="sidebar-link">NSArray</a></li><li><a href="/ios/nsattributedstring.html" class="sidebar-link">NSAttributedString</a></li><li><a href="/ios/convert-html-to-nsattributed-string-and-vice-verse.html" class="sidebar-link">Convert HTML to NSAttributed string and vice verse</a></li><li><a href="/ios/nstimer.html" class="sidebar-link">NSTimer</a></li><li><a href="/ios/nsdate.html" class="sidebar-link">NSDate</a></li><li><a href="/ios/nsnotificationcenter.html" class="sidebar-link">NSNotificationCenter</a></li><li><a href="/ios/nsurlsession.html" class="sidebar-link">NSURLSession</a></li><li><a href="/ios/nsuserdefaults.html" class="sidebar-link">NSUserDefaults</a></li><li><a href="/ios/nshttpcookiestorage.html" class="sidebar-link">NSHTTPCookieStorage</a></li><li><a href="/ios/nsurlconnection.html" class="sidebar-link">NSURLConnection</a></li><li><a href="/ios/nsurl.html" class="sidebar-link">NSURL</a></li><li><a href="/ios/nsdata.html" class="sidebar-link">NSData</a></li><li><a href="/ios/nsinvocation.html" class="sidebar-link">NSInvocation</a></li><li><a href="/ios/nsuseractivity.html" class="sidebar-link">NSUserActivity</a></li><li><a href="/ios/nspredicate.html" class="sidebar-link">NSPredicate</a></li><li><a href="/ios/nsbundle.html" class="sidebar-link">NSBundle</a></li><li><a href="/ios/caanimation.html" class="sidebar-link">CAAnimation</a></li><li><a href="/ios/concurrency.html" class="sidebar-link">Concurrency</a></li><li><a href="/ios/cagradientlayer.html" class="sidebar-link">CAGradientLayer</a></li><li><a href="/ios/safari-services.html" class="sidebar-link">Safari Services</a></li><li><a href="/ios/calayer.html" class="sidebar-link">CALayer</a></li><li><a href="/ios/ios-implementation-of-xmpp-with-robbie-hanson-framework.html" class="sidebar-link">iOS - Implementation of XMPP with Robbie Hanson framework</a></li><li><a href="/ios/swift-and-objective-c-interoperability.html" class="sidebar-link">Swift and Objective-C interoperability</a></li><li><a href="/ios/custom-fonts.html" class="sidebar-link">Custom fonts</a></li><li><a href="/ios/avspeechsynthesizer.html" class="sidebar-link">AVSpeechSynthesizer</a></li><li><a href="/ios/localization.html" class="sidebar-link">Localization</a></li><li><a href="/ios/alamofire.html" class="sidebar-link">Alamofire</a></li><li><a href="/ios/ibeacon.html" class="sidebar-link">iBeacon</a></li><li><a href="/ios/cllocation.html" class="sidebar-link">CLLocation</a></li><li><a href="/ios/checking-ios-version.html" class="sidebar-link">Checking iOS version</a></li><li><a href="/ios/universal-links.html" class="sidebar-link">Universal Links</a></li><li><a href="/ios/pdf-creation-in-ios.html" class="sidebar-link">PDF Creation in iOS</a></li><li><a href="/ios/in-app-purchase.html" class="sidebar-link">In-App Purchase</a></li><li><a href="/ios/cgcontext-reference.html" class="sidebar-link">CGContext Reference</a></li><li><a href="/ios/core-location.html" class="sidebar-link">Core Location</a></li><li><a href="/ios/facebooksdk.html" class="sidebar-link">FacebookSDK</a></li><li><a href="/ios/afnetworking.html" class="sidebar-link">AFNetworking</a></li><li><a href="/ios/ctcallcenter.html" class="sidebar-link">CTCallCenter</a></li><li><a href="/ios/push-notifications.html" class="sidebar-link">Push Notifications</a></li><li><a href="/ios/extension-for-rich-push-notification-ios-10.html" class="sidebar-link">Extension for rich Push Notification - iOS 10.</a></li><li><a href="/ios/rich-notifications.html" class="sidebar-link">Rich Notifications</a></li><li><a href="/ios/key-value-coding-key-value-observation.html" class="sidebar-link">Key Value Coding-Key Value Observation</a></li><li><a href="/ios/initialization-idioms.html" class="sidebar-link">Initialization idioms</a></li><li><a href="/ios/storyboard.html" class="sidebar-link">Storyboard</a></li><li><a href="/ios/background-modes-and-events.html" class="sidebar-link">Background Modes and Events</a></li><li><a href="/ios/fastlane.html" class="sidebar-link">Fastlane</a></li><li><a href="/ios/cashapelayer.html" class="sidebar-link">CAShapeLayer</a></li><li><a href="/ios/wkwebview.html" class="sidebar-link">WKWebView</a></li><li><a href="/ios/uuid-universally-unique-identifier.html" class="sidebar-link">UUID (Universally Unique Identifier)</a></li><li><a href="/ios/categories.html" class="sidebar-link">Categories</a></li><li><a href="/ios/handling-url-schemes.html" class="sidebar-link">Handling URL Schemes</a></li><li><a href="/ios/realm.html" class="sidebar-link">Realm</a></li><li><a href="/ios/arc-automatic-reference-counting.html" class="sidebar-link">ARC (Automatic Reference Counting)</a></li><li><a href="/ios/dynamic-type.html" class="sidebar-link">Dynamic Type</a></li><li><a href="/ios/swrevealviewcontroller.html" class="sidebar-link">SWRevealViewController</a></li><li><a href="/ios/dispatchgroup.html" class="sidebar-link">DispatchGroup</a></li><li><a href="/ios/gcd-grand-central-dispatch.html" class="sidebar-link">GCD (Grand Central Dispatch)</a></li><li><a href="/ios/size-classes-and-adaptivity.html" class="sidebar-link">Size Classes and Adaptivity</a></li><li><a href="/ios/iboutlets.html" class="sidebar-link">IBOutlets</a></li><li><a href="/ios/aws-sdk.html" class="sidebar-link">AWS SDK</a></li><li><a href="/ios/debugging-crashes.html" class="sidebar-link">Debugging Crashes</a></li><li><a href="/ios/cloudkit.html" class="sidebar-link">CloudKit</a></li><li><a href="/ios/gameplaykit.html" class="sidebar-link">GameplayKit</a></li><li><a href="/ios/xcode-build-archive-from-command-line.html" class="sidebar-link">Xcode Build &amp; Archive From Command Line</a></li><li><a href="/ios/xctest-framework-unit-testing.html" class="sidebar-link">XCTest framework - Unit Testing</a></li><li><a href="/ios/avplayer-and-avplayerviewcontroller.html" class="sidebar-link">AVPlayer and AVPlayerViewController</a></li><li><a href="/ios/deep-linking-in-ios.html" class="sidebar-link">Deep Linking in iOS</a></li><li><a href="/ios/core-graphics.html" class="sidebar-link">Core Graphics</a></li><li><a href="/ios/segues.html" class="sidebar-link">Segues</a></li><li><a href="/ios/eventkit.html" class="sidebar-link">EventKit</a></li><li><a href="/ios/sirikit.html" class="sidebar-link">SiriKit</a></li><li><a href="/ios/contacts-framework.html" class="sidebar-link">Contacts Framework</a></li><li><a href="/ios/ios-10-speech-recognition-api.html" class="sidebar-link">iOS 10 Speech Recognition API</a></li><li><a href="/ios/storekit.html" class="sidebar-link">StoreKit</a></li><li><a href="/ios/code-signing.html" class="sidebar-link">Code signing</a></li><li><a href="/ios/create-ipa-file-to-upload-on-appstore-with-applicationloader.html" class="sidebar-link">Create .ipa File to upload on appstore with Applicationloader</a></li><li><a href="/ios/size-classes-and-adaptivity.html" class="sidebar-link">Size Classes and Adaptivity</a></li><li><a href="/ios/mkdistanceformatter.html" class="sidebar-link">MKDistanceFormatter</a></li><li><a href="/ios/3d-touch.html" class="sidebar-link">3D Touch</a></li><li><a href="/ios/gamecenter-leaderboards.html" class="sidebar-link">GameCenter Leaderboards</a></li><li><a href="/ios/keychain.html" class="sidebar-link">Keychain</a></li><li><a href="/ios/handle-multiple-environment-using-macro.html" class="sidebar-link">Handle Multiple Environment using Macro</a></li><li><a href="/ios/set-view-background.html" class="sidebar-link">Set View Background</a></li><li><a href="/ios/block.html" class="sidebar-link">Block</a></li><li><a href="/ios/content-hugging-content-compression-in-autolayout.html" class="sidebar-link">Content Hugging/Content Compression in Autolayout</a></li><li><a href="/ios/ios-google-places-api.html" class="sidebar-link">iOS Google Places API</a></li><li><a href="/ios/navigation-bar.html" class="sidebar-link">Navigation Bar</a></li><li><a href="/ios/app-wide-operations.html" class="sidebar-link">App wide operations</a></li><li><a href="/ios/coreimage-filters.html" class="sidebar-link">CoreImage Filters</a></li><li><a href="/ios/face-detection-using-coreimage-opencv.html" class="sidebar-link">Face Detection Using CoreImage/OpenCV</a></li><li><a href="/ios/mpmediapickerdelegate.html" class="sidebar-link">MPMediaPickerDelegate</a></li><li><a href="/ios/graph-coreplot.html" class="sidebar-link">Graph (Coreplot)</a></li><li><a href="/ios/fcm-messaging-in-swift.html" class="sidebar-link">FCM Messaging in Swift</a></li><li><a href="/ios/create-a-custom-framework-in-ios.html" class="sidebar-link">Create a Custom framework in iOS</a></li><li><a href="/ios/custom-keyboard.html" class="sidebar-link">Custom Keyboard</a></li><li><a href="/ios/airdrop.html" class="sidebar-link">AirDrop</a></li><li><a href="/ios/slcomposeviewcontroller.html" class="sidebar-link">SLComposeViewController</a></li><li><a href="/ios/airprint-tutorial-in-ios.html" class="sidebar-link">AirPrint tutorial in iOS</a></li><li><a href="/ios/carthage-ios-setup.html" class="sidebar-link">Carthage iOS Setup</a></li><li><a href="/ios/healthkit.html" class="sidebar-link">Healthkit</a></li><li><a href="/ios/core-spotlight-in-ios.html" class="sidebar-link">Core SpotLight in iOS</a></li><li><a href="/ios/core-motion.html" class="sidebar-link">Core Motion</a></li><li><a href="/ios/qr-code-scanner.html" class="sidebar-link">QR Code Scanner</a></li><li><a href="/ios/plist-ios.html" class="sidebar-link">plist iOS</a></li><li><a href="/ios/wcsessiondelegate.html" class="sidebar-link">WCSessionDelegate</a></li><li><a href="/ios/appdelegate.html" class="sidebar-link">AppDelegate</a></li><li><a href="/ios/app-submission-process.html" class="sidebar-link">App Submission Process</a></li><li><a href="/ios/filehandle.html" class="sidebar-link">FileHandle</a></li><li><a href="/ios/basic-text-file-i-o.html" class="sidebar-link">Basic text file I/O</a></li><li><a href="/ios/ios-tts.html" class="sidebar-link">iOS TTS</a></li><li><a href="/ios/mpvolumeview.html" class="sidebar-link">MPVolumeView</a></li><li><a href="/ios/objective-c-associated-objects.html" class="sidebar-link">Objective-C Associated Objects</a></li><li><a href="/ios/passing-data-between-view-controllers-with-messagebox-concept.html" class="sidebar-link">Passing Data between View Controllers (with MessageBox-Concept)</a></li><li><a href="/ios/mvvm.html" class="sidebar-link">MVVM</a></li><li><a href="/ios/cache-online-images.html" class="sidebar-link">Cache online images</a></li><li><a href="/ios/chain-blocks-in-a-queue-with-mkblockqueue.html" class="sidebar-link">Chain Blocks in a Queue (with MKBlockQueue)</a></li><li><a href="/ios/simulator.html" class="sidebar-link">Simulator</a></li><li><a href="/ios/background-modes.html" class="sidebar-link">Background Modes</a></li><li><a href="/ios/opengl.html" class="sidebar-link">OpenGL</a></li><li><a href="/ios/mvp-architecture.html" class="sidebar-link">MVP Architecture</a></li><li><a href="/ios/configure-beacons-with-corebluetooth.html" class="sidebar-link">Configure Beacons with CoreBluetooth</a></li><li><a href="/ios/core-data.html" class="sidebar-link">Core Data</a></li><li><a href="/ios/profile-with-instruments.html" class="sidebar-link">Profile with Instruments</a></li><li><a href="/ios/application-rating-review-request.html" class="sidebar-link">Application rating/review request</a></li><li><a href="/ios/mylayout.html" class="sidebar-link">MyLayout</a></li><li><a href="/ios/simulator-builds.html" class="sidebar-link">Simulator Builds</a></li><li><a href="/ios/simulating-location-using-gpx-files-ios.html" class="sidebar-link">Simulating Location Using GPX files iOS</a></li><li><a href="/ios/sqlcipher-integration.html" class="sidebar-link">SqlCipher integration</a></li><li><a href="/ios/security.html" class="sidebar-link">Security</a></li><li><a href="/ios/app-transport-security-ats.html" class="sidebar-link">App Transport Security (ATS)</a></li><li><a href="/ios/guideline-to-choose-best-ios-architecture-patterns.html" class="sidebar-link">Guideline to choose best iOS Architecture Patterns</a></li><li><a href="/ios/multicast-delegates.html" class="sidebar-link">Multicast Delegates</a></li><li><a href="/ios/using-image-aseets.html" class="sidebar-link">Using Image Aseets</a></li><li><a href="/ios/runtime-in-objective-c.html" class="sidebar-link">Runtime in Objective-C</a></li><li><a href="/ios/modelpresentationstyles.html" class="sidebar-link">ModelPresentationStyles</a></li><li><a href="/ios/cydiasubstrate-tweak.html" class="sidebar-link">CydiaSubstrate tweak</a></li><li><a href="/ios/create-a-video-from-images.html" class="sidebar-link">Create a video from images</a></li><li><a href="/ios/codable.html" class="sidebar-link">Codable</a></li><li><a href="/ios/load-images-async.html" class="sidebar-link">Load images async</a></li><li><a href="/ios/adding-a-swift-bridging-header.html" class="sidebar-link">ADDING A SWIFT BRIDGING HEADER</a></li><li><a href="/ios/creating-an-app-id.html" class="sidebar-link">Creating an App ID</a></li><li><a href="/ios/swift-changing-the-rootviewcontroller-in-appdelegate-to-present-main-or-login-onboarding-flow.html" class="sidebar-link">Swift: Changing the rootViewController in AppDelegate to present main or login/onboarding flow</a></li><li><a href="/ios/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="uikit-dynamics"><a href="#uikit-dynamics" class="header-anchor">#</a> UIKit Dynamics</h1> <p>UIKit Dynamics is a full real-world physics engine integrated into UIKit. It allows you to create interfaces that feel real by adding behaviors such as gravity, attachments, collision and forces. You define the physical traits that you would like your interface elements to adopt, and the dynamics engine takes care of the rest.</p> <h2 id="the-falling-square"><a href="#the-falling-square" class="header-anchor">#</a> The Falling Square</h2> <p>Lets draw a square in the middle of our view and make it fall to the bottom and stop at the bottom edge collising with the screen bottom boundary.</p> <p><a href="https://i.stack.imgur.com/Uikgg.gif" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/Uikgg.gif" alt="enter image description here"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token atrule">@IBOutlet</span> <span class="token keyword">var</span> animationView<span class="token punctuation">:</span> <span class="token builtin">UIView</span><span class="token operator">!</span>
<span class="token keyword">var</span> squareView<span class="token punctuation">:</span><span class="token builtin">UIView</span><span class="token operator">!</span>
<span class="token keyword">var</span> collision<span class="token punctuation">:</span> <span class="token builtin">UICollisionBehavior</span><span class="token operator">!</span>
<span class="token keyword">var</span> animator<span class="token punctuation">:</span> <span class="token builtin">UIDynamicAnimator</span><span class="token operator">!</span>
<span class="token keyword">var</span> gravity<span class="token punctuation">:</span> <span class="token builtin">UIGravityBehavior</span><span class="token operator">!</span>

<span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">viewDidLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">viewDidLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> squareSize <span class="token operator">=</span> <span class="token function">CGSize</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">30.0</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">30.0</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> centerPoint <span class="token operator">=</span> <span class="token function">CGPoint</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>animationView<span class="token punctuation">.</span>bounds<span class="token punctuation">.</span>midX <span class="token operator">-</span> <span class="token punctuation">(</span>squareSize<span class="token punctuation">.</span>width<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>animationView<span class="token punctuation">.</span>bounds<span class="token punctuation">.</span>midY <span class="token operator">-</span> <span class="token punctuation">(</span>squareSize<span class="token punctuation">.</span>height<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> frame <span class="token operator">=</span> <span class="token function">CGRect</span><span class="token punctuation">(</span>origin<span class="token punctuation">:</span> centerPoint<span class="token punctuation">,</span> size<span class="token punctuation">:</span> squareSize<span class="token punctuation">)</span>
    squareView <span class="token operator">=</span> <span class="token function">UIView</span><span class="token punctuation">(</span>frame<span class="token punctuation">:</span> frame<span class="token punctuation">)</span>
    squareView<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token builtin">UIColor</span><span class="token punctuation">.</span><span class="token function">orangeColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    animationView<span class="token punctuation">.</span><span class="token function">addSubview</span><span class="token punctuation">(</span>squareView<span class="token punctuation">)</span>
    animator <span class="token operator">=</span> <span class="token function">UIDynamicAnimator</span><span class="token punctuation">(</span>referenceView<span class="token punctuation">:</span> view<span class="token punctuation">)</span>
    gravity <span class="token operator">=</span> <span class="token function">UIGravityBehavior</span><span class="token punctuation">(</span>items<span class="token punctuation">:</span> <span class="token punctuation">[</span>squareView<span class="token punctuation">]</span><span class="token punctuation">)</span>
    animator<span class="token punctuation">.</span><span class="token function">addBehavior</span><span class="token punctuation">(</span>gravity<span class="token punctuation">)</span>
    collision <span class="token operator">=</span> <span class="token function">UICollisionBehavior</span><span class="token punctuation">(</span>items<span class="token punctuation">:</span> <span class="token punctuation">[</span>square<span class="token punctuation">]</span><span class="token punctuation">)</span>
    collision<span class="token punctuation">.</span>translatesReferenceBoundsIntoBoundary <span class="token operator">=</span> <span class="token boolean">true</span>
    animator<span class="token punctuation">.</span><span class="token function">addBehavior</span><span class="token punctuation">(</span>collision<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="flick-view-based-on-gesture-velocity"><a href="#flick-view-based-on-gesture-velocity" class="header-anchor">#</a> Flick View Based on Gesture Velocity</h2> <p>This example shows how to have a view track a pan gesture and depart in a physics-based manner.</p> <p><a href="https://i.stack.imgur.com/niErg.gif" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/niErg.gif" alt="enter image description here"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="swift"><a href="#swift" class="header-anchor">#</a> Swift</h3> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">class</span> <span class="token class-name">ViewController</span><span class="token punctuation">:</span> <span class="token builtin">UIViewController</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Adjust to change speed of view from flick</span>
    <span class="token keyword">let</span> magnitudeMultiplier<span class="token punctuation">:</span> <span class="token builtin">CGFloat</span> <span class="token operator">=</span> <span class="token number">0.0008</span>
    
    <span class="token keyword">lazy</span> <span class="token keyword">var</span> dynamicAnimator<span class="token punctuation">:</span> <span class="token builtin">UIDynamicAnimator</span> <span class="token operator">=</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">let</span> dynamicAnimator <span class="token operator">=</span> <span class="token function">UIDynamicAnimator</span><span class="token punctuation">(</span>referenceView<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">)</span>
        <span class="token keyword">return</span> dynamicAnimator
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">lazy</span> <span class="token keyword">var</span> gravity<span class="token punctuation">:</span> <span class="token builtin">UIGravityBehavior</span> <span class="token operator">=</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">let</span> gravity <span class="token operator">=</span> <span class="token function">UIGravityBehavior</span><span class="token punctuation">(</span>items<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>orangeView<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> gravity
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">lazy</span> <span class="token keyword">var</span> collision<span class="token punctuation">:</span> <span class="token builtin">UICollisionBehavior</span> <span class="token operator">=</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">let</span> collision <span class="token operator">=</span> <span class="token function">UICollisionBehavior</span><span class="token punctuation">(</span>items<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>orangeView<span class="token punctuation">]</span><span class="token punctuation">)</span>
        collision<span class="token punctuation">.</span>translatesReferenceBoundsIntoBoundary <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token keyword">return</span> collision
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">lazy</span> <span class="token keyword">var</span> orangeView<span class="token punctuation">:</span> <span class="token builtin">UIView</span> <span class="token operator">=</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">let</span> widthHeight<span class="token punctuation">:</span> <span class="token builtin">CGFloat</span> <span class="token operator">=</span> <span class="token number">40.0</span>
        <span class="token keyword">let</span> orangeView <span class="token operator">=</span> <span class="token function">UIView</span><span class="token punctuation">(</span>frame<span class="token punctuation">:</span> <span class="token function">CGRect</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> width<span class="token punctuation">:</span> widthHeight<span class="token punctuation">,</span> height<span class="token punctuation">:</span> widthHeight<span class="token punctuation">)</span><span class="token punctuation">)</span>
        orangeView<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token builtin">UIColor</span><span class="token punctuation">.</span>orange
        <span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span><span class="token function">addSubview</span><span class="token punctuation">(</span>orangeView<span class="token punctuation">)</span>
        <span class="token keyword">return</span> orangeView
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">lazy</span> <span class="token keyword">var</span> panGesture<span class="token punctuation">:</span> <span class="token builtin">UIPanGestureRecognizer</span> <span class="token operator">=</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">let</span> panGesture <span class="token operator">=</span> <span class="token function">UIPanGestureRecognizer</span><span class="token punctuation">(</span>target<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">,</span> action<span class="token punctuation">:</span> #<span class="token function">selector</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">handlePan</span><span class="token punctuation">(</span>sender<span class="token punctuation">:</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> panGesture
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">lazy</span> <span class="token keyword">var</span> attachment<span class="token punctuation">:</span> <span class="token builtin">UIAttachmentBehavior</span> <span class="token operator">=</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">let</span> attachment <span class="token operator">=</span> <span class="token function">UIAttachmentBehavior</span><span class="token punctuation">(</span>item<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>orangeView<span class="token punctuation">,</span> attachedToAnchor<span class="token punctuation">:</span> <span class="token punctuation">.</span>zero<span class="token punctuation">)</span>
        <span class="token keyword">return</span> attachment
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">viewDidLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">viewDidLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        dynamicAnimator<span class="token punctuation">.</span><span class="token function">addBehavior</span><span class="token punctuation">(</span>gravity<span class="token punctuation">)</span>
        dynamicAnimator<span class="token punctuation">.</span><span class="token function">addBehavior</span><span class="token punctuation">(</span>collision<span class="token punctuation">)</span>
        orangeView<span class="token punctuation">.</span><span class="token function">addGestureRecognizer</span><span class="token punctuation">(</span>panGesture<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">viewDidLayoutSubviews</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">viewDidLayoutSubviews</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        orangeView<span class="token punctuation">.</span>center <span class="token operator">=</span> view<span class="token punctuation">.</span>center
        dynamicAnimator<span class="token punctuation">.</span><span class="token function">updateItem</span><span class="token punctuation">(</span>usingCurrentState<span class="token punctuation">:</span> orangeView<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">func</span> <span class="token function">handlePan</span><span class="token punctuation">(</span>sender<span class="token punctuation">:</span> <span class="token builtin">UIPanGestureRecognizer</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">let</span> location <span class="token operator">=</span> sender<span class="token punctuation">.</span><span class="token function">location</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> view<span class="token punctuation">)</span>
        <span class="token keyword">let</span> velocity <span class="token operator">=</span> sender<span class="token punctuation">.</span><span class="token function">velocity</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> view<span class="token punctuation">)</span>
        <span class="token keyword">let</span> magnitude <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token punctuation">(</span>velocity<span class="token punctuation">.</span>x <span class="token operator">*</span> velocity<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>velocity<span class="token punctuation">.</span>y <span class="token operator">*</span> velocity<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">switch</span> sender<span class="token punctuation">.</span>state
        <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token punctuation">.</span>began<span class="token punctuation">:</span>
            attachment<span class="token punctuation">.</span>anchorPoint <span class="token operator">=</span> location
            dynamicAnimator<span class="token punctuation">.</span><span class="token function">addBehavior</span><span class="token punctuation">(</span>attachment<span class="token punctuation">)</span>
        <span class="token keyword">case</span> <span class="token punctuation">.</span>changed<span class="token punctuation">:</span>
            attachment<span class="token punctuation">.</span>anchorPoint <span class="token operator">=</span> location
        <span class="token keyword">case</span> <span class="token punctuation">.</span>cancelled<span class="token punctuation">,</span> <span class="token punctuation">.</span>ended<span class="token punctuation">,</span> <span class="token punctuation">.</span>failed<span class="token punctuation">,</span> <span class="token punctuation">.</span>possible<span class="token punctuation">:</span>
            <span class="token keyword">let</span> push <span class="token operator">=</span> <span class="token function">UIPushBehavior</span><span class="token punctuation">(</span>items<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>orangeView<span class="token punctuation">]</span><span class="token punctuation">,</span> mode<span class="token punctuation">:</span> <span class="token punctuation">.</span>instantaneous<span class="token punctuation">)</span>
            push<span class="token punctuation">.</span>pushDirection <span class="token operator">=</span> <span class="token function">CGVector</span><span class="token punctuation">(</span>dx<span class="token punctuation">:</span> velocity<span class="token punctuation">.</span>x<span class="token punctuation">,</span> dy<span class="token punctuation">:</span> velocity<span class="token punctuation">.</span>y<span class="token punctuation">)</span>
            push<span class="token punctuation">.</span>magnitude <span class="token operator">=</span> magnitude <span class="token operator">*</span> magnitudeMultiplier
            dynamicAnimator<span class="token punctuation">.</span><span class="token function">removeBehavior</span><span class="token punctuation">(</span>attachment<span class="token punctuation">)</span>
            dynamicAnimator<span class="token punctuation">.</span><span class="token function">addBehavior</span><span class="token punctuation">(</span>push<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="objective-c"><a href="#objective-c" class="header-anchor">#</a> Objective-C</h3> <div class="language-swift extra-class"><pre class="language-swift"><code>@interface <span class="token class-name">ViewController</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>

@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> assign<span class="token punctuation">)</span> <span class="token builtin">CGFloat</span> magnitudeMultiplier<span class="token punctuation">;</span>
@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> <span class="token builtin">UIDynamicAnimator</span> <span class="token operator">*</span>dynamicAnimator<span class="token punctuation">;</span>
@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> <span class="token builtin">UIGravityBehavior</span> <span class="token operator">*</span>gravity<span class="token punctuation">;</span>
@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> <span class="token builtin">UICollisionBehavior</span> <span class="token operator">*</span>collision<span class="token punctuation">;</span>
@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> <span class="token builtin">UIView</span> <span class="token operator">*</span>orangeView<span class="token punctuation">;</span>
@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> <span class="token builtin">UIPanGestureRecognizer</span> <span class="token operator">*</span>panGesture<span class="token punctuation">;</span>
@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> <span class="token builtin">UIAttachmentBehavior</span> <span class="token operator">*</span>attachment<span class="token punctuation">;</span>

@end

@implementation <span class="token builtin">ViewController</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>void<span class="token punctuation">)</span>viewDidLoad
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token keyword">super</span> viewDidLoad<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>dynamicAnimator addBehavior<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>gravity<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>dynamicAnimator addBehavior<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>collision<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>orangeView addGestureRecognizer<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>panGesture<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// Adjust to change speed of view from flick</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>magnitudeMultiplier <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">.</span>0008f<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>void<span class="token punctuation">)</span>viewDidLayoutSubviews
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token keyword">super</span> viewDidLayoutSubviews<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>orangeView<span class="token punctuation">.</span>center <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>center<span class="token punctuation">;</span>
    <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>dynamicAnimator updateItemUsingCurrentState<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>orangeView<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>void<span class="token punctuation">)</span>handlePan<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token builtin">UIPanGestureRecognizer</span> <span class="token operator">*</span><span class="token punctuation">)</span>sender
<span class="token punctuation">{</span>
    <span class="token builtin">CGPoint</span> location <span class="token operator">=</span> <span class="token punctuation">[</span>sender locationInView<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token builtin">CGPoint</span> velocity <span class="token operator">=</span> <span class="token punctuation">[</span>sender velocityInView<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token builtin">CGFloat</span> magnitude <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token punctuation">(</span>velocity<span class="token punctuation">.</span>x <span class="token operator">*</span> velocity<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>velocity<span class="token punctuation">.</span>y <span class="token operator">*</span> velocity<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>sender<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token builtin">UIGestureRecognizerStateBegan</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>attachment<span class="token punctuation">.</span>anchorPoint <span class="token operator">=</span> location<span class="token punctuation">;</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>dynamicAnimator addBehavior<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>attachment<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>sender<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token builtin">UIGestureRecognizerStateChanged</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>attachment<span class="token punctuation">.</span>anchorPoint <span class="token operator">=</span> location<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>sender<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token builtin">UIGestureRecognizerStateCancelled</span> <span class="token operator">||</span>
             sender<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token builtin">UIGestureRecognizerStateEnded</span> <span class="token operator">||</span>
             sender<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token builtin">UIGestureRecognizerStateFailed</span> <span class="token operator">||</span>
             sender<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token builtin">UIGestureRecognizerStatePossible</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token builtin">UIPushBehavior</span> <span class="token operator">*</span>push <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">UIPushBehavior</span> alloc<span class="token punctuation">]</span> initWithItems<span class="token punctuation">:</span>@<span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>orangeView<span class="token punctuation">]</span> mode<span class="token punctuation">:</span><span class="token builtin">UIPushBehaviorModeInstantaneous</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        push<span class="token punctuation">.</span>pushDirection <span class="token operator">=</span> <span class="token function">CGVectorMake</span><span class="token punctuation">(</span>velocity<span class="token punctuation">.</span>x<span class="token punctuation">,</span> velocity<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
        push<span class="token punctuation">.</span>magnitude <span class="token operator">=</span> magnitude <span class="token operator">*</span> <span class="token keyword">self</span><span class="token punctuation">.</span>magnitudeMultiplier<span class="token punctuation">;</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>dynamicAnimator removeBehavior<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>attachment<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>dynamicAnimator addBehavior<span class="token punctuation">:</span>push<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

#pragma mark <span class="token operator">-</span> <span class="token builtin">Lazy</span> <span class="token builtin">Init</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token builtin">UIDynamicAnimator</span> <span class="token operator">*</span><span class="token punctuation">)</span>dynamicAnimator
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_dynamicAnimator<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _dynamicAnimator <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">UIDynamicAnimator</span> alloc<span class="token punctuation">]</span>initWithReferenceView<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> _dynamicAnimator<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token builtin">UIGravityBehavior</span> <span class="token operator">*</span><span class="token punctuation">)</span>gravity
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_gravity<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _gravity <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">UIGravityBehavior</span> alloc<span class="token punctuation">]</span>initWithItems<span class="token punctuation">:</span>@<span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>orangeView<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> _gravity<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token builtin">UICollisionBehavior</span> <span class="token operator">*</span><span class="token punctuation">)</span>collision
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_collision<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _collision <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">UICollisionBehavior</span> alloc<span class="token punctuation">]</span>initWithItems<span class="token punctuation">:</span>@<span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>orangeView<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        _collision<span class="token punctuation">.</span>translatesReferenceBoundsIntoBoundary <span class="token operator">=</span> <span class="token constant">YES</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> _collision<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token builtin">UIView</span> <span class="token operator">*</span><span class="token punctuation">)</span>orangeView
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_orangeView<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token builtin">CGFloat</span> widthHeight <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">.</span>0f<span class="token punctuation">;</span>
        _orangeView <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">UIView</span> alloc<span class="token punctuation">]</span>initWithFrame<span class="token punctuation">:</span><span class="token function">CGRectMake</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> widthHeight<span class="token punctuation">,</span> widthHeight<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        _orangeView<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">UIColor</span> orangeColor<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>view addSubview<span class="token punctuation">:</span>_orangeView<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> _orangeView<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token builtin">UIPanGestureRecognizer</span> <span class="token operator">*</span><span class="token punctuation">)</span>panGesture
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_panGesture<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _panGesture <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">UIPanGestureRecognizer</span> alloc<span class="token punctuation">]</span>initWithTarget<span class="token punctuation">:</span><span class="token keyword">self</span> action<span class="token punctuation">:</span>@<span class="token function">selector</span><span class="token punctuation">(</span>handlePan<span class="token punctuation">:</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> _panGesture<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token builtin">UIAttachmentBehavior</span> <span class="token operator">*</span><span class="token punctuation">)</span>attachment
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_attachment<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _attachment <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">UIAttachmentBehavior</span> alloc<span class="token punctuation">]</span>initWithItem<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>orangeView attachedToAnchor<span class="token punctuation">:</span><span class="token builtin">CGPointZero</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> _attachment<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

@end

</code></pre></div><h2 id="sticky-corners-effect-using-uifieldbehaviors"><a href="#sticky-corners-effect-using-uifieldbehaviors" class="header-anchor">#</a> &quot;Sticky Corners&quot; Effect Using UIFieldBehaviors</h2> <p>This example shows how to achieve an effect similar to FaceTime were a view is attracted to point once it enters a particular region, in this case two regions a top and bottom.</p> <p><a href="https://i.stack.imgur.com/ICuEL.gif" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/ICuEL.gif" alt="enter image description here"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="swift-2"><a href="#swift-2" class="header-anchor">#</a> Swift</h3> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">class</span> <span class="token class-name">ViewController</span><span class="token punctuation">:</span> <span class="token builtin">UIViewController</span>
<span class="token punctuation">{</span>
    <span class="token keyword">lazy</span> <span class="token keyword">var</span> dynamicAnimator<span class="token punctuation">:</span> <span class="token builtin">UIDynamicAnimator</span> <span class="token operator">=</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">let</span> dynamicAnimator <span class="token operator">=</span> <span class="token function">UIDynamicAnimator</span><span class="token punctuation">(</span>referenceView<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">)</span>
        <span class="token keyword">return</span> dynamicAnimator
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">lazy</span> <span class="token keyword">var</span> collision<span class="token punctuation">:</span> <span class="token builtin">UICollisionBehavior</span> <span class="token operator">=</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">let</span> collision <span class="token operator">=</span> <span class="token function">UICollisionBehavior</span><span class="token punctuation">(</span>items<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>orangeView<span class="token punctuation">]</span><span class="token punctuation">)</span>
        collision<span class="token punctuation">.</span>translatesReferenceBoundsIntoBoundary <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token keyword">return</span> collision
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">lazy</span> <span class="token keyword">var</span> fieldBehaviors<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token builtin">UIFieldBehavior</span><span class="token punctuation">]</span> <span class="token operator">=</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">var</span> fieldBehaviors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">UIFieldBehavior</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> <span class="token number">_</span> <span class="token keyword">in</span> <span class="token number">0</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">&lt;</span> <span class="token number">2</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">let</span> field <span class="token operator">=</span> <span class="token builtin">UIFieldBehavior</span><span class="token punctuation">.</span><span class="token function">springField</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            field<span class="token punctuation">.</span><span class="token function">addItem</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>orangeView<span class="token punctuation">)</span>
            fieldBehaviors<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>field<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> fieldBehaviors
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">lazy</span> <span class="token keyword">var</span> itemBehavior<span class="token punctuation">:</span> <span class="token builtin">UIDynamicItemBehavior</span> <span class="token operator">=</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">let</span> itemBehavior <span class="token operator">=</span> <span class="token function">UIDynamicItemBehavior</span><span class="token punctuation">(</span>items<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>orangeView<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token comment">// Adjust these values to change the &quot;stickiness&quot; of the view</span>
        itemBehavior<span class="token punctuation">.</span>density <span class="token operator">=</span> <span class="token number">0.01</span>
        itemBehavior<span class="token punctuation">.</span>resistance <span class="token operator">=</span> <span class="token number">10</span>
        itemBehavior<span class="token punctuation">.</span>friction <span class="token operator">=</span> <span class="token number">0.0</span>
        itemBehavior<span class="token punctuation">.</span>allowsRotation <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token keyword">return</span> itemBehavior
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">lazy</span> <span class="token keyword">var</span> orangeView<span class="token punctuation">:</span> <span class="token builtin">UIView</span> <span class="token operator">=</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">let</span> widthHeight<span class="token punctuation">:</span> <span class="token builtin">CGFloat</span> <span class="token operator">=</span> <span class="token number">40.0</span>
        <span class="token keyword">let</span> orangeView <span class="token operator">=</span> <span class="token function">UIView</span><span class="token punctuation">(</span>frame<span class="token punctuation">:</span> <span class="token function">CGRect</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> width<span class="token punctuation">:</span> widthHeight<span class="token punctuation">,</span> height<span class="token punctuation">:</span> widthHeight<span class="token punctuation">)</span><span class="token punctuation">)</span>
        orangeView<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token builtin">UIColor</span><span class="token punctuation">.</span>orange
        <span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span><span class="token function">addSubview</span><span class="token punctuation">(</span>orangeView<span class="token punctuation">)</span>
        <span class="token keyword">return</span> orangeView
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">lazy</span> <span class="token keyword">var</span> panGesture<span class="token punctuation">:</span> <span class="token builtin">UIPanGestureRecognizer</span> <span class="token operator">=</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">let</span> panGesture <span class="token operator">=</span> <span class="token function">UIPanGestureRecognizer</span><span class="token punctuation">(</span>target<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">,</span> action<span class="token punctuation">:</span> #<span class="token function">selector</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">handlePan</span><span class="token punctuation">(</span>sender<span class="token punctuation">:</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> panGesture
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">lazy</span> <span class="token keyword">var</span> attachment<span class="token punctuation">:</span> <span class="token builtin">UIAttachmentBehavior</span> <span class="token operator">=</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">let</span> attachment <span class="token operator">=</span> <span class="token function">UIAttachmentBehavior</span><span class="token punctuation">(</span>item<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>orangeView<span class="token punctuation">,</span> attachedToAnchor<span class="token punctuation">:</span> <span class="token punctuation">.</span>zero<span class="token punctuation">)</span>
        <span class="token keyword">return</span> attachment
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">viewDidLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">viewDidLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        dynamicAnimator<span class="token punctuation">.</span><span class="token function">addBehavior</span><span class="token punctuation">(</span>collision<span class="token punctuation">)</span>
        dynamicAnimator<span class="token punctuation">.</span><span class="token function">addBehavior</span><span class="token punctuation">(</span>itemBehavior<span class="token punctuation">)</span>
        <span class="token keyword">for</span> field <span class="token keyword">in</span> fieldBehaviors
        <span class="token punctuation">{</span>
            dynamicAnimator<span class="token punctuation">.</span><span class="token function">addBehavior</span><span class="token punctuation">(</span>field<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        
        orangeView<span class="token punctuation">.</span><span class="token function">addGestureRecognizer</span><span class="token punctuation">(</span>panGesture<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">viewDidLayoutSubviews</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">viewDidLayoutSubviews</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        orangeView<span class="token punctuation">.</span>center <span class="token operator">=</span> view<span class="token punctuation">.</span>center
        dynamicAnimator<span class="token punctuation">.</span><span class="token function">updateItem</span><span class="token punctuation">(</span>usingCurrentState<span class="token punctuation">:</span> orangeView<span class="token punctuation">)</span>
        
        <span class="token keyword">for</span> <span class="token punctuation">(</span>index<span class="token punctuation">,</span> field<span class="token punctuation">)</span> <span class="token keyword">in</span> fieldBehaviors<span class="token punctuation">.</span><span class="token function">enumerated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            field<span class="token punctuation">.</span>position <span class="token operator">=</span> <span class="token function">CGPoint</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> view<span class="token punctuation">.</span>bounds
                <span class="token punctuation">.</span>midX<span class="token punctuation">,</span> y<span class="token punctuation">:</span>  view<span class="token punctuation">.</span>bounds<span class="token punctuation">.</span>height <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">0.25</span> <span class="token operator">+</span> <span class="token number">0.5</span> <span class="token operator">*</span> <span class="token function">CGFloat</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            field<span class="token punctuation">.</span>region <span class="token operator">=</span> <span class="token function">UIRegion</span><span class="token punctuation">(</span>size<span class="token punctuation">:</span> <span class="token function">CGSize</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> view<span class="token punctuation">.</span>bounds<span class="token punctuation">.</span>width<span class="token punctuation">,</span> height<span class="token punctuation">:</span> view<span class="token punctuation">.</span>bounds<span class="token punctuation">.</span>height <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">func</span> <span class="token function">handlePan</span><span class="token punctuation">(</span>sender<span class="token punctuation">:</span> <span class="token builtin">UIPanGestureRecognizer</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">let</span> location <span class="token operator">=</span> sender<span class="token punctuation">.</span><span class="token function">location</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> view<span class="token punctuation">)</span>
        <span class="token keyword">let</span> velocity <span class="token operator">=</span> sender<span class="token punctuation">.</span><span class="token function">velocity</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> view<span class="token punctuation">)</span>
        <span class="token keyword">switch</span> sender<span class="token punctuation">.</span>state
        <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token punctuation">.</span>began<span class="token punctuation">:</span>
            attachment<span class="token punctuation">.</span>anchorPoint <span class="token operator">=</span> location
            dynamicAnimator<span class="token punctuation">.</span><span class="token function">addBehavior</span><span class="token punctuation">(</span>attachment<span class="token punctuation">)</span>
        <span class="token keyword">case</span> <span class="token punctuation">.</span>changed<span class="token punctuation">:</span>
            attachment<span class="token punctuation">.</span>anchorPoint <span class="token operator">=</span> location
        <span class="token keyword">case</span> <span class="token punctuation">.</span>cancelled<span class="token punctuation">,</span> <span class="token punctuation">.</span>ended<span class="token punctuation">,</span> <span class="token punctuation">.</span>failed<span class="token punctuation">,</span> <span class="token punctuation">.</span>possible<span class="token punctuation">:</span>
            itemBehavior<span class="token punctuation">.</span><span class="token function">addLinearVelocity</span><span class="token punctuation">(</span>velocity<span class="token punctuation">,</span> <span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>orangeView<span class="token punctuation">)</span>
            dynamicAnimator<span class="token punctuation">.</span><span class="token function">removeBehavior</span><span class="token punctuation">(</span>attachment<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="objective-c-2"><a href="#objective-c-2" class="header-anchor">#</a> Objective-C</h3> <div class="language-swift extra-class"><pre class="language-swift"><code>@interface <span class="token class-name">ViewController</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>

@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> <span class="token builtin">UIDynamicAnimator</span> <span class="token operator">*</span>dynamicAnimator<span class="token punctuation">;</span>
@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> <span class="token builtin">UICollisionBehavior</span> <span class="token operator">*</span>collision<span class="token punctuation">;</span>
@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> <span class="token builtin">UIAttachmentBehavior</span> <span class="token operator">*</span>attachment<span class="token punctuation">;</span>
@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> <span class="token builtin">UIDynamicItemBehavior</span> <span class="token operator">*</span>itemBehavior<span class="token punctuation">;</span>
@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> <span class="token builtin">NSArray</span> <span class="token operator">&lt;</span><span class="token builtin">UIFieldBehavior</span> <span class="token operator">*</span><span class="token operator">&gt;</span> <span class="token operator">*</span>fieldBehaviors<span class="token punctuation">;</span>
@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> <span class="token builtin">UIView</span> <span class="token operator">*</span>orangeView<span class="token punctuation">;</span>
@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> <span class="token builtin">UIPanGestureRecognizer</span> <span class="token operator">*</span>panGesture<span class="token punctuation">;</span>

@end

@implementation <span class="token builtin">ViewController</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>void<span class="token punctuation">)</span>viewDidLoad
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token keyword">super</span> viewDidLoad<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>dynamicAnimator addBehavior<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>collision<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>dynamicAnimator addBehavior<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>itemBehavior<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token builtin">UIFieldBehavior</span> <span class="token operator">*</span>field <span class="token keyword">in</span> <span class="token keyword">self</span><span class="token punctuation">.</span>fieldBehaviors<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>dynamicAnimator addBehavior<span class="token punctuation">:</span>field<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>orangeView addGestureRecognizer<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>panGesture<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>void<span class="token punctuation">)</span>viewDidLayoutSubviews
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token keyword">super</span> viewDidLayoutSubviews<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>orangeView<span class="token punctuation">.</span>center <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>center<span class="token punctuation">;</span>
    <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>dynamicAnimator updateItemUsingCurrentState<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>orangeView<span class="token punctuation">]</span><span class="token punctuation">;</span>
    
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token builtin">NSInteger</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">self</span><span class="token punctuation">.</span>fieldBehaviors<span class="token punctuation">.</span><span class="token builtin">count</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token builtin">UIFieldBehavior</span> <span class="token operator">*</span>field <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>fieldBehaviors<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        field<span class="token punctuation">.</span>position <span class="token operator">=</span> <span class="token function">CGPointMake</span><span class="token punctuation">(</span><span class="token function">CGRectGetMidX</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>bounds<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">CGRectGetHeight</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>bounds<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">.</span>25f <span class="token operator">+</span> <span class="token number">0</span><span class="token punctuation">.</span>5f <span class="token operator">*</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        field<span class="token punctuation">.</span>region <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">UIRegion</span> alloc<span class="token punctuation">]</span>initWithSize<span class="token punctuation">:</span><span class="token function">CGSizeMake</span><span class="token punctuation">(</span><span class="token function">CGRectGetWidth</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>bounds<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">CGRectGetHeight</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>bounds<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>void<span class="token punctuation">)</span>handlePan<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token builtin">UIPanGestureRecognizer</span> <span class="token operator">*</span><span class="token punctuation">)</span>sender
<span class="token punctuation">{</span>
    <span class="token builtin">CGPoint</span> location <span class="token operator">=</span> <span class="token punctuation">[</span>sender locationInView<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token builtin">CGPoint</span> velocity <span class="token operator">=</span> <span class="token punctuation">[</span>sender velocityInView<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>sender<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token builtin">UIGestureRecognizerStateBegan</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>attachment<span class="token punctuation">.</span>anchorPoint <span class="token operator">=</span> location<span class="token punctuation">;</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>dynamicAnimator addBehavior<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>attachment<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>sender<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token builtin">UIGestureRecognizerStateChanged</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>attachment<span class="token punctuation">.</span>anchorPoint <span class="token operator">=</span> location<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>sender<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token builtin">UIGestureRecognizerStateCancelled</span> <span class="token operator">||</span>
             sender<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token builtin">UIGestureRecognizerStateEnded</span> <span class="token operator">||</span>
             sender<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token builtin">UIGestureRecognizerStateFailed</span> <span class="token operator">||</span>
             sender<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token builtin">UIGestureRecognizerStatePossible</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>itemBehavior addLinearVelocity<span class="token punctuation">:</span>velocity forItem<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>orangeView<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>dynamicAnimator removeBehavior<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>attachment<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

#pragma mark <span class="token operator">-</span> <span class="token builtin">Lazy</span> <span class="token builtin">Init</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token builtin">UIDynamicAnimator</span> <span class="token operator">*</span><span class="token punctuation">)</span>dynamicAnimator
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_dynamicAnimator<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _dynamicAnimator <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">UIDynamicAnimator</span> alloc<span class="token punctuation">]</span>initWithReferenceView<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> _dynamicAnimator<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token builtin">UICollisionBehavior</span> <span class="token operator">*</span><span class="token punctuation">)</span>collision
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_collision<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _collision <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">UICollisionBehavior</span> alloc<span class="token punctuation">]</span>initWithItems<span class="token punctuation">:</span>@<span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>orangeView<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        _collision<span class="token punctuation">.</span>translatesReferenceBoundsIntoBoundary <span class="token operator">=</span> <span class="token constant">YES</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> _collision<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token builtin">NSArray</span> <span class="token operator">&lt;</span><span class="token builtin">UIFieldBehavior</span> <span class="token operator">*</span><span class="token operator">&gt;</span> <span class="token operator">*</span><span class="token punctuation">)</span>fieldBehaviors
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_fieldBehaviors<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token builtin">NSMutableArray</span> <span class="token operator">*</span>fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">NSMutableArray</span> alloc<span class="token punctuation">]</span><span class="token keyword">init</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token builtin">NSInteger</span> i <span class="token operator">=</span>  <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token builtin">UIFieldBehavior</span> <span class="token operator">*</span>field <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">UIFieldBehavior</span> springField<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">[</span>field addItem<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>orangeView<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">[</span>fields addObject<span class="token punctuation">:</span>field<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        _fieldBehaviors <span class="token operator">=</span> fields<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> _fieldBehaviors<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token builtin">UIDynamicItemBehavior</span> <span class="token operator">*</span><span class="token punctuation">)</span>itemBehavior
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_itemBehavior<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _itemBehavior <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">UIDynamicItemBehavior</span> alloc<span class="token punctuation">]</span>initWithItems<span class="token punctuation">:</span>@<span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>orangeView<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">// Adjust these values to change the &quot;stickiness&quot; of the view</span>
        _itemBehavior<span class="token punctuation">.</span>density <span class="token operator">=</span> <span class="token number">0.01</span><span class="token punctuation">;</span>
        _itemBehavior<span class="token punctuation">.</span>resistance <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
        _itemBehavior<span class="token punctuation">.</span>friction <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
        _itemBehavior<span class="token punctuation">.</span>allowsRotation <span class="token operator">=</span> <span class="token constant">NO</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> _itemBehavior<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token builtin">UIView</span> <span class="token operator">*</span><span class="token punctuation">)</span>orangeView
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_orangeView<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token builtin">CGFloat</span> widthHeight <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">.</span>0f<span class="token punctuation">;</span>
        _orangeView <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">UIView</span> alloc<span class="token punctuation">]</span>initWithFrame<span class="token punctuation">:</span><span class="token function">CGRectMake</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> widthHeight<span class="token punctuation">,</span> widthHeight<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        _orangeView<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">UIColor</span> orangeColor<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>view addSubview<span class="token punctuation">:</span>_orangeView<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> _orangeView<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token builtin">UIPanGestureRecognizer</span> <span class="token operator">*</span><span class="token punctuation">)</span>panGesture
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_panGesture<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _panGesture <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">UIPanGestureRecognizer</span> alloc<span class="token punctuation">]</span>initWithTarget<span class="token punctuation">:</span><span class="token keyword">self</span> action<span class="token punctuation">:</span>@<span class="token function">selector</span><span class="token punctuation">(</span>handlePan<span class="token punctuation">:</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> _panGesture<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token builtin">UIAttachmentBehavior</span> <span class="token operator">*</span><span class="token punctuation">)</span>attachment
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_attachment<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _attachment <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">UIAttachmentBehavior</span> alloc<span class="token punctuation">]</span>initWithItem<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>orangeView attachedToAnchor<span class="token punctuation">:</span><span class="token builtin">CGPointZero</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> _attachment<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

@end

</code></pre></div><p>For more information about <code>UIFieldBehaviors</code> you can see the <a href="https://developer.apple.com/videos/play/wwdc2015/229/" target="_blank" rel="noopener noreferrer">2015 WWDC Session &quot;What's New in UIKit Dynamics and Visual Effects&quot;<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and accompanying <a href="https://developer.apple.com/library/content/samplecode/StickyCorners/Introduction/Intro.html" target="_blank" rel="noopener noreferrer">sample code<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h2 id="uidynamicbehavior-driven-custom-transition"><a href="#uidynamicbehavior-driven-custom-transition" class="header-anchor">#</a> UIDynamicBehavior Driven Custom Transition</h2> <p><a href="https://i.stack.imgur.com/VAeNo.gif" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/VAeNo.gif" alt="enter image description here"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>This example shows how to create a custom presentation transition that is driven by a composite <code>UIDynamicBehavior</code>. We can start by creating a presenting view controller that will present a modal.</p> <h3 id="swift-3"><a href="#swift-3" class="header-anchor">#</a> Swift</h3> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">class</span> <span class="token class-name">PresentingViewController</span><span class="token punctuation">:</span> <span class="token builtin">UIViewController</span>
<span class="token punctuation">{</span>
    <span class="token keyword">lazy</span> <span class="token keyword">var</span> button<span class="token punctuation">:</span> <span class="token builtin">UIButton</span> <span class="token operator">=</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">let</span> button <span class="token operator">=</span> <span class="token function">UIButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        button<span class="token punctuation">.</span>translatesAutoresizingMaskIntoConstraints <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span><span class="token function">addSubview</span><span class="token punctuation">(</span>button<span class="token punctuation">)</span>
        button<span class="token punctuation">.</span>centerXAnchor<span class="token punctuation">.</span><span class="token function">constraint</span><span class="token punctuation">(</span>equalTo<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>centerXAnchor<span class="token punctuation">)</span><span class="token punctuation">.</span>isActive
            <span class="token operator">=</span> <span class="token boolean">true</span>
        button<span class="token punctuation">.</span>centerYAnchor<span class="token punctuation">.</span><span class="token function">constraint</span><span class="token punctuation">(</span>equalTo<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>centerYAnchor<span class="token punctuation">)</span><span class="token punctuation">.</span>isActive <span class="token operator">=</span> <span class="token boolean">true</span>
        button<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token string">&quot;Present&quot;</span><span class="token punctuation">,</span> <span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>normal<span class="token punctuation">)</span>
        button<span class="token punctuation">.</span><span class="token function">setTextColor</span><span class="token punctuation">(</span><span class="token builtin">UIColor</span><span class="token punctuation">.</span>blue<span class="token punctuation">,</span> <span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>normal<span class="token punctuation">)</span>
        
        <span class="token keyword">return</span> button
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">viewDidLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">viewDidLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        button<span class="token punctuation">.</span><span class="token function">addTarget</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> action<span class="token punctuation">:</span> #<span class="token function">selector</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>didPressPresent<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>touchUpInside<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">func</span> <span class="token function">didPressPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">let</span> modal <span class="token operator">=</span> <span class="token function">ModalViewController</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        modal<span class="token punctuation">.</span>view<span class="token punctuation">.</span>frame <span class="token operator">=</span> <span class="token function">CGRect</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> width<span class="token punctuation">:</span> <span class="token number">200.0</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">200.0</span><span class="token punctuation">)</span>
        modal<span class="token punctuation">.</span>modalPresentationStyle <span class="token operator">=</span> <span class="token punctuation">.</span>custom
        modal<span class="token punctuation">.</span>transitioningDelegate <span class="token operator">=</span> modal
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">present</span><span class="token punctuation">(</span>modal<span class="token punctuation">,</span> animated<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="objective-c-3"><a href="#objective-c-3" class="header-anchor">#</a> Objective-C</h3> <div class="language-swift extra-class"><pre class="language-swift"><code>@interface <span class="token class-name">PresentingViewController</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> <span class="token builtin">UIButton</span> <span class="token operator">*</span>button<span class="token punctuation">;</span>
@end

@implementation <span class="token builtin">PresentingViewController</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>void<span class="token punctuation">)</span>viewDidLoad
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token keyword">super</span> viewDidLoad<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>button addTarget<span class="token punctuation">:</span><span class="token keyword">self</span> action<span class="token punctuation">:</span>@<span class="token function">selector</span><span class="token punctuation">(</span>didPressPresent<span class="token punctuation">)</span> forControlEvents<span class="token punctuation">:</span><span class="token builtin">UIControlEventTouchUpInside</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>void<span class="token punctuation">)</span>didPressPresent
<span class="token punctuation">{</span>
    <span class="token builtin">ModalViewController</span> <span class="token operator">*</span>modal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">ModalViewController</span> alloc<span class="token punctuation">]</span> <span class="token keyword">init</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    modal<span class="token punctuation">.</span>view<span class="token punctuation">.</span>frame <span class="token operator">=</span> <span class="token function">CGRectMake</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">200.0</span><span class="token punctuation">,</span> <span class="token number">200.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    modal<span class="token punctuation">.</span>modalPresentationStyle <span class="token operator">=</span> <span class="token builtin">UIModalPresentationCustom</span><span class="token punctuation">;</span>
    modal<span class="token punctuation">.</span>transitioningDelegate <span class="token operator">=</span> modal<span class="token punctuation">;</span>
    <span class="token punctuation">[</span><span class="token keyword">self</span> presentViewController<span class="token punctuation">:</span>modal animated<span class="token punctuation">:</span><span class="token constant">YES</span> completion<span class="token punctuation">:</span><span class="token constant">nil</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token builtin">UIButton</span> <span class="token operator">*</span><span class="token punctuation">)</span>button
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_button<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _button <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">UIButton</span> alloc<span class="token punctuation">]</span> <span class="token keyword">init</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        _button<span class="token punctuation">.</span>translatesAutoresizingMaskIntoConstraints <span class="token operator">=</span> <span class="token constant">NO</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>view addSubview<span class="token punctuation">:</span>_button<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span>_button<span class="token punctuation">.</span>centerXAnchor constraintEqualToAnchor<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>centerXAnchor<span class="token punctuation">]</span><span class="token punctuation">.</span>active <span class="token operator">=</span> <span class="token constant">YES</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span>_button<span class="token punctuation">.</span>centerYAnchor constraintEqualToAnchor<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>centerYAnchor<span class="token punctuation">]</span><span class="token punctuation">.</span>active <span class="token operator">=</span> <span class="token constant">YES</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span>_button setTitle<span class="token punctuation">:</span>@<span class="token string">&quot;Present&quot;</span> forState<span class="token punctuation">:</span><span class="token builtin">UIControlStateNormal</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span>_button setTitleColor<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token builtin">UIColor</span> blueColor<span class="token punctuation">]</span> forState<span class="token punctuation">:</span><span class="token builtin">UIControlStateNormal</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> _button<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

@end

</code></pre></div><p>When the present button is tapped, we create a <code>ModalViewController</code> and set its presentation style to <code>.custom</code> and set its <code>transitionDelegate</code> to itself. This will allow us to vend an animator that will drive its modal transition. We also set <code>modal</code>'s view's frame so it will be smaller than the full screen.</p> <p>Let's now look at <code>ModalViewController</code>:</p> <h3 id="swift-4"><a href="#swift-4" class="header-anchor">#</a> Swift</h3> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">class</span> <span class="token class-name">ModalViewController</span><span class="token punctuation">:</span> <span class="token builtin">UIViewController</span>
<span class="token punctuation">{</span>
    <span class="token keyword">lazy</span> <span class="token keyword">var</span> button<span class="token punctuation">:</span> <span class="token builtin">UIButton</span> <span class="token operator">=</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">let</span> button <span class="token operator">=</span> <span class="token function">UIButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        button<span class="token punctuation">.</span>translatesAutoresizingMaskIntoConstraints <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span><span class="token function">addSubview</span><span class="token punctuation">(</span>button<span class="token punctuation">)</span>
        button<span class="token punctuation">.</span>centerXAnchor<span class="token punctuation">.</span><span class="token function">constraint</span><span class="token punctuation">(</span>equalTo<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>centerXAnchor<span class="token punctuation">)</span><span class="token punctuation">.</span>isActive
         <span class="token operator">=</span> <span class="token boolean">true</span>
        button<span class="token punctuation">.</span>centerYAnchor<span class="token punctuation">.</span><span class="token function">constraint</span><span class="token punctuation">(</span>equalTo<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>centerYAnchor<span class="token punctuation">)</span><span class="token punctuation">.</span>isActive <span class="token operator">=</span> <span class="token boolean">true</span>
        button<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token string">&quot;Dismiss&quot;</span><span class="token punctuation">,</span> <span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>normal<span class="token punctuation">)</span>
        button<span class="token punctuation">.</span><span class="token function">setTitleColor</span><span class="token punctuation">(</span><span class="token punctuation">.</span>white<span class="token punctuation">,</span> <span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>normal<span class="token punctuation">)</span>
        
        <span class="token keyword">return</span> button
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">viewDidLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">viewDidLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        button<span class="token punctuation">.</span><span class="token function">addTarget</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> action<span class="token punctuation">:</span> #<span class="token function">selector</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>didPressDismiss<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>touchUpInside<span class="token punctuation">)</span>
        view<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token punctuation">.</span>red
        view<span class="token punctuation">.</span>layer<span class="token punctuation">.</span>cornerRadius <span class="token operator">=</span> <span class="token number">15.0</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">func</span> <span class="token function">didPressDismiss</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">dismiss</span><span class="token punctuation">(</span>animated<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">extension</span> <span class="token builtin">ModalViewController</span><span class="token punctuation">:</span> <span class="token builtin">UIViewControllerTransitioningDelegate</span>
<span class="token punctuation">{</span>
    <span class="token keyword">func</span> <span class="token function">animationController</span><span class="token punctuation">(</span>forPresented presented<span class="token punctuation">:</span> <span class="token builtin">UIViewController</span><span class="token punctuation">,</span> presenting<span class="token punctuation">:</span> <span class="token builtin">UIViewController</span><span class="token punctuation">,</span> source<span class="token punctuation">:</span> <span class="token builtin">UIViewController</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">UIViewControllerAnimatedTransitioning</span><span class="token operator">?</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">DropOutAnimator</span><span class="token punctuation">(</span>duration<span class="token punctuation">:</span> <span class="token number">1.5</span><span class="token punctuation">,</span> isAppearing<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">func</span> <span class="token function">animationController</span><span class="token punctuation">(</span>forDismissed dismissed<span class="token punctuation">:</span> <span class="token builtin">UIViewController</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">UIViewControllerAnimatedTransitioning</span><span class="token operator">?</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">DropOutAnimator</span><span class="token punctuation">(</span>duration<span class="token punctuation">:</span> <span class="token number">4.0</span><span class="token punctuation">,</span> isAppearing<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="objective-c-4"><a href="#objective-c-4" class="header-anchor">#</a> Objective-C</h3> <div class="language-swift extra-class"><pre class="language-swift"><code>@interface <span class="token class-name">ModalViewController</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token builtin">UIViewControllerTransitioningDelegate</span><span class="token operator">&gt;</span>
@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> <span class="token builtin">UIButton</span> <span class="token operator">*</span>button<span class="token punctuation">;</span>
@end

@implementation <span class="token builtin">ModalViewController</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>void<span class="token punctuation">)</span>viewDidLoad
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token keyword">super</span> viewDidLoad<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>button addTarget<span class="token punctuation">:</span><span class="token keyword">self</span> action<span class="token punctuation">:</span>@<span class="token function">selector</span><span class="token punctuation">(</span>didPressPresent<span class="token punctuation">)</span> forControlEvents<span class="token punctuation">:</span><span class="token builtin">UIControlEventTouchUpInside</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">UIColor</span> redColor<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>layer<span class="token punctuation">.</span>cornerRadius <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">.</span>0f<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>void<span class="token punctuation">)</span>didPressPresent
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token keyword">self</span> dismissViewControllerAnimated<span class="token punctuation">:</span><span class="token constant">YES</span> completion<span class="token punctuation">:</span><span class="token constant">nil</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token builtin">UIButton</span> <span class="token operator">*</span><span class="token punctuation">)</span>button
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_button<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _button <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">UIButton</span> alloc<span class="token punctuation">]</span> <span class="token keyword">init</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        _button<span class="token punctuation">.</span>translatesAutoresizingMaskIntoConstraints <span class="token operator">=</span> <span class="token constant">NO</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>view addSubview<span class="token punctuation">:</span>_button<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span>_button<span class="token punctuation">.</span>centerXAnchor constraintEqualToAnchor<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>centerXAnchor<span class="token punctuation">]</span><span class="token punctuation">.</span>active <span class="token operator">=</span> <span class="token constant">YES</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span>_button<span class="token punctuation">.</span>centerYAnchor constraintEqualToAnchor<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>centerYAnchor<span class="token punctuation">]</span><span class="token punctuation">.</span>active <span class="token operator">=</span> <span class="token constant">YES</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span>_button setTitle<span class="token punctuation">:</span>@<span class="token string">&quot;Dismiss&quot;</span> forState<span class="token punctuation">:</span><span class="token builtin">UIControlStateNormal</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span>_button setTitleColor<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token builtin">UIColor</span> blueColor<span class="token punctuation">]</span> forState<span class="token punctuation">:</span><span class="token builtin">UIControlStateNormal</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> _button<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>id<span class="token operator">&lt;</span><span class="token builtin">UIViewControllerAnimatedTransitioning</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>animationControllerForPresentedController<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token builtin">UIViewController</span> <span class="token operator">*</span><span class="token punctuation">)</span>presented presentingController<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token builtin">UIViewController</span> <span class="token operator">*</span><span class="token punctuation">)</span>presenting sourceController<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token builtin">UIViewController</span> <span class="token operator">*</span><span class="token punctuation">)</span>source
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">DropOutAnimator</span> alloc<span class="token punctuation">]</span>initWithDuration<span class="token punctuation">:</span> <span class="token number">1.5</span> appearing<span class="token punctuation">:</span><span class="token constant">YES</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>id<span class="token operator">&lt;</span><span class="token builtin">UIViewControllerAnimatedTransitioning</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>animationControllerForDismissedController<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token builtin">UIViewController</span> <span class="token operator">*</span><span class="token punctuation">)</span>dismissed
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">DropOutAnimator</span> alloc<span class="token punctuation">]</span> initWithDuration<span class="token punctuation">:</span><span class="token number">4.0</span> appearing<span class="token punctuation">:</span><span class="token constant">NO</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

@end

</code></pre></div><p>Here we create the view controller that is presented. Also because <code>ModalViewController</code> is it's own <code>transitioningDelegate</code> it is also responsible for vending an object that will manage its transition animation. For us that means passing on an instance of our composite <code>UIDynamicBehavior</code> subclass.</p> <p>Our animator will have two different transitions: one for presenting and one for dismissing. For presenting, the presenting view controller's view will drop in from above. And for dismissing, the view will seem to swing from a rope and then drop out. Because <code>DropOutAnimator</code> conforms to <code>UIViewControllerAnimatedTransitioning</code> most of this work will be done in its implementation of <code>func animateTransition(using transitionContext: UIViewControllerContextTransitioning)</code>.</p> <h3 id="swift-5"><a href="#swift-5" class="header-anchor">#</a> Swift</h3> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">class</span> <span class="token class-name">DropOutAnimator</span><span class="token punctuation">:</span> <span class="token builtin">UIDynamicBehavior</span>
<span class="token punctuation">{</span>
    <span class="token keyword">let</span> duration<span class="token punctuation">:</span> <span class="token builtin">TimeInterval</span>
    <span class="token keyword">let</span> isAppearing<span class="token punctuation">:</span> <span class="token builtin">Bool</span>

    <span class="token keyword">var</span> transitionContext<span class="token punctuation">:</span> <span class="token builtin">UIViewControllerContextTransitioning</span><span class="token operator">?</span>
    <span class="token keyword">var</span> hasElapsedTimeExceededDuration <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token keyword">var</span> finishTime<span class="token punctuation">:</span> <span class="token builtin">TimeInterval</span> <span class="token operator">=</span> <span class="token number">0.0</span>
    <span class="token keyword">var</span> collisionBehavior<span class="token punctuation">:</span> <span class="token builtin">UICollisionBehavior</span><span class="token operator">?</span>
    <span class="token keyword">var</span> attachmentBehavior<span class="token punctuation">:</span> <span class="token builtin">UIAttachmentBehavior</span><span class="token operator">?</span>
    <span class="token keyword">var</span> animator<span class="token punctuation">:</span> <span class="token builtin">UIDynamicAnimator</span><span class="token operator">?</span>

    <span class="token keyword">init</span><span class="token punctuation">(</span>duration<span class="token punctuation">:</span> <span class="token builtin">TimeInterval</span> <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">,</span>  isAppearing<span class="token punctuation">:</span> <span class="token builtin">Bool</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>duration <span class="token operator">=</span> duration
        <span class="token keyword">self</span><span class="token punctuation">.</span>isAppearing <span class="token operator">=</span> isAppearing
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">extension</span> <span class="token builtin">DropOutAnimator</span><span class="token punctuation">:</span> <span class="token builtin">UIViewControllerAnimatedTransitioning</span>
<span class="token punctuation">{</span>
    <span class="token keyword">func</span> <span class="token function">animateTransition</span><span class="token punctuation">(</span>using transitionContext<span class="token punctuation">:</span> <span class="token builtin">UIViewControllerContextTransitioning</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Get relevant views and view controllers from transitionContext</span>
        <span class="token keyword">guard</span> <span class="token keyword">let</span> fromVC <span class="token operator">=</span> transitionContext<span class="token punctuation">.</span><span class="token function">viewController</span><span class="token punctuation">(</span>forKey<span class="token punctuation">:</span> <span class="token punctuation">.</span>from<span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token keyword">let</span> toVC <span class="token operator">=</span> transitionContext<span class="token punctuation">.</span><span class="token function">viewController</span><span class="token punctuation">(</span>forKey<span class="token punctuation">:</span> <span class="token punctuation">.</span>to<span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token keyword">let</span> fromView <span class="token operator">=</span> fromVC<span class="token punctuation">.</span>view<span class="token punctuation">,</span>
              <span class="token keyword">let</span> toView <span class="token operator">=</span> toVC<span class="token punctuation">.</span>view <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
    
        <span class="token keyword">let</span> containerView <span class="token operator">=</span> transitionContext<span class="token punctuation">.</span>containerView
        <span class="token keyword">let</span> duration <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">transitionDuration</span><span class="token punctuation">(</span>using<span class="token punctuation">:</span> transitionContext<span class="token punctuation">)</span>
    
        <span class="token comment">// Hold refrence to transitionContext to notify it of completion</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext <span class="token operator">=</span> transitionContext
    
        <span class="token comment">// Create dynamic animator</span>
        <span class="token keyword">let</span> animator <span class="token operator">=</span> <span class="token function">UIDynamicAnimator</span><span class="token punctuation">(</span>referenceView<span class="token punctuation">:</span> containerView<span class="token punctuation">)</span>
        animator<span class="token punctuation">.</span>delegate <span class="token operator">=</span> <span class="token keyword">self</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>animator <span class="token operator">=</span> animator
    
        <span class="token comment">// Presenting Animation</span>
        <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>isAppearing
        <span class="token punctuation">{</span>
            fromView<span class="token punctuation">.</span>isUserInteractionEnabled <span class="token operator">=</span> <span class="token boolean">false</span>
        
            <span class="token comment">// Position toView  just off-screen</span>
            <span class="token keyword">let</span> fromViewInitialFrame <span class="token operator">=</span> transitionContext<span class="token punctuation">.</span><span class="token function">initialFrame</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> fromVC<span class="token punctuation">)</span>
            <span class="token keyword">var</span> toViewInitialFrame <span class="token operator">=</span> toView<span class="token punctuation">.</span>frame
            toViewInitialFrame<span class="token punctuation">.</span>origin<span class="token punctuation">.</span>y <span class="token operator">-</span><span class="token operator">=</span> toViewInitialFrame<span class="token punctuation">.</span>height
            toViewInitialFrame<span class="token punctuation">.</span>origin<span class="token punctuation">.</span>x <span class="token operator">=</span> fromViewInitialFrame<span class="token punctuation">.</span>width <span class="token operator">*</span> <span class="token number">0.5</span> <span class="token operator">-</span> toViewInitialFrame<span class="token punctuation">.</span>width <span class="token operator">*</span> <span class="token number">0.5</span>
            toView<span class="token punctuation">.</span>frame <span class="token operator">=</span> toViewInitialFrame
        
            containerView<span class="token punctuation">.</span><span class="token function">addSubview</span><span class="token punctuation">(</span>toView<span class="token punctuation">)</span>
        
            <span class="token comment">// Prevent rotation and adjust bounce</span>
            <span class="token keyword">let</span> bodyBehavior <span class="token operator">=</span> <span class="token function">UIDynamicItemBehavior</span><span class="token punctuation">(</span>items<span class="token punctuation">:</span> <span class="token punctuation">[</span>toView<span class="token punctuation">]</span><span class="token punctuation">)</span>
            bodyBehavior<span class="token punctuation">.</span>elasticity <span class="token operator">=</span> <span class="token number">0.7</span>
            bodyBehavior<span class="token punctuation">.</span>allowsRotation <span class="token operator">=</span> <span class="token boolean">false</span>
        
            <span class="token comment">// Add gravity at exaggerated magnitude so animation doesn't seem slow</span>
            <span class="token keyword">let</span> gravityBehavior <span class="token operator">=</span> <span class="token function">UIGravityBehavior</span><span class="token punctuation">(</span>items<span class="token punctuation">:</span> <span class="token punctuation">[</span>toView<span class="token punctuation">]</span><span class="token punctuation">)</span>
            gravityBehavior<span class="token punctuation">.</span>magnitude <span class="token operator">=</span> <span class="token number">10.0</span>
        
            <span class="token comment">// Set collision bounds to include off-screen view and have collision in center </span>
            <span class="token comment">// where our final view should come to rest</span>
            <span class="token keyword">let</span> collisionBehavior <span class="token operator">=</span> <span class="token function">UICollisionBehavior</span><span class="token punctuation">(</span>items<span class="token punctuation">:</span> <span class="token punctuation">[</span>toView<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">let</span> insets <span class="token operator">=</span> <span class="token function">UIEdgeInsets</span><span class="token punctuation">(</span>top<span class="token punctuation">:</span> toViewInitialFrame<span class="token punctuation">.</span>minY<span class="token punctuation">,</span> <span class="token keyword">left</span><span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> bottom<span class="token punctuation">:</span> fromViewInitialFrame<span class="token punctuation">.</span>height <span class="token operator">*</span> <span class="token number">0.5</span> <span class="token operator">-</span> toViewInitialFrame<span class="token punctuation">.</span>height <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token keyword">right</span><span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">)</span>
            collisionBehavior<span class="token punctuation">.</span><span class="token function">setTranslatesReferenceBoundsIntoBoundary</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> insets<span class="token punctuation">)</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>collisionBehavior <span class="token operator">=</span> collisionBehavior
        
            <span class="token comment">// Keep track of finish time in case we need to end the animator befor the animator pauses</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>finishTime <span class="token operator">=</span> duration <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>animator<span class="token operator">?</span><span class="token punctuation">.</span>elapsedTime <span class="token operator">?</span><span class="token operator">?</span> <span class="token number">0.0</span><span class="token punctuation">)</span>
        
            <span class="token comment">// Closure that is called after every &quot;tick&quot; of the animator</span>
            <span class="token comment">// Check if we exceed duration</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>action <span class="token operator">=</span>
            <span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token keyword">weak</span> <span class="token keyword">self</span><span class="token punctuation">]</span> <span class="token keyword">in</span>
                <span class="token keyword">guard</span> <span class="token keyword">let</span> strongSelf <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">,</span>
                  <span class="token punctuation">(</span>strongSelf<span class="token punctuation">.</span>animator<span class="token operator">?</span><span class="token punctuation">.</span>elapsedTime <span class="token operator">?</span><span class="token operator">?</span> <span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> strongSelf<span class="token punctuation">.</span>finishTime <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
                strongSelf<span class="token punctuation">.</span>hasElapsedTimeExceededDuration <span class="token operator">=</span> <span class="token boolean">true</span>
                strongSelf<span class="token punctuation">.</span>animator<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">removeBehavior</span><span class="token punctuation">(</span>strongSelf<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        
            <span class="token comment">// `DropOutAnimator` is a composit behavior, so add child behaviors to self</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">addChildBehavior</span><span class="token punctuation">(</span>collisionBehavior<span class="token punctuation">)</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">addChildBehavior</span><span class="token punctuation">(</span>bodyBehavior<span class="token punctuation">)</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">addChildBehavior</span><span class="token punctuation">(</span>gravityBehavior<span class="token punctuation">)</span>
        
            <span class="token comment">// Add self to dynamic animator</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>animator<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">addBehavior</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// Dismissing Animation</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Create allow rotation and have a elastic item</span>
            <span class="token keyword">let</span> bodyBehavior <span class="token operator">=</span> <span class="token function">UIDynamicItemBehavior</span><span class="token punctuation">(</span>items<span class="token punctuation">:</span> <span class="token punctuation">[</span>fromView<span class="token punctuation">]</span><span class="token punctuation">)</span>
            bodyBehavior<span class="token punctuation">.</span>elasticity <span class="token operator">=</span> <span class="token number">0.8</span>
            bodyBehavior<span class="token punctuation">.</span>angularResistance <span class="token operator">=</span> <span class="token number">5.0</span>
            bodyBehavior<span class="token punctuation">.</span>allowsRotation <span class="token operator">=</span> <span class="token boolean">true</span>
        
            <span class="token comment">// Create gravity with exaggerated magnitude</span>
            <span class="token keyword">let</span> gravityBehavior <span class="token operator">=</span> <span class="token function">UIGravityBehavior</span><span class="token punctuation">(</span>items<span class="token punctuation">:</span> <span class="token punctuation">[</span>fromView<span class="token punctuation">]</span><span class="token punctuation">)</span>
            gravityBehavior<span class="token punctuation">.</span>magnitude <span class="token operator">=</span> <span class="token number">10.0</span>
        
            <span class="token comment">// Collision boundary is set to have a floor just below the bottom of the screen</span>
            <span class="token keyword">let</span> collisionBehavior <span class="token operator">=</span> <span class="token function">UICollisionBehavior</span><span class="token punctuation">(</span>items<span class="token punctuation">:</span> <span class="token punctuation">[</span>fromView<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">let</span> insets <span class="token operator">=</span> <span class="token function">UIEdgeInsets</span><span class="token punctuation">(</span>top<span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token keyword">left</span><span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1000</span><span class="token punctuation">,</span> bottom<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">225</span><span class="token punctuation">,</span> <span class="token keyword">right</span><span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1000</span><span class="token punctuation">)</span>
            collisionBehavior<span class="token punctuation">.</span><span class="token function">setTranslatesReferenceBoundsIntoBoundary</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> insets<span class="token punctuation">)</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>collisionBehavior <span class="token operator">=</span> collisionBehavior
        
            <span class="token comment">// Attachment behavior so view will have effect of hanging from a rope</span>
            <span class="token keyword">let</span> offset <span class="token operator">=</span> <span class="token function">UIOffset</span><span class="token punctuation">(</span>horizontal<span class="token punctuation">:</span> <span class="token number">70.0</span><span class="token punctuation">,</span> vertical<span class="token punctuation">:</span> fromView<span class="token punctuation">.</span>bounds<span class="token punctuation">.</span>height <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">)</span>
            <span class="token keyword">var</span> anchorPoint <span class="token operator">=</span> <span class="token function">CGPoint</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> fromView<span class="token punctuation">.</span>bounds<span class="token punctuation">.</span>maxX <span class="token operator">-</span> <span class="token number">40.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> fromView<span class="token punctuation">.</span>bounds<span class="token punctuation">.</span>minY<span class="token punctuation">)</span>
            anchorPoint <span class="token operator">=</span> containerView<span class="token punctuation">.</span><span class="token function">convert</span><span class="token punctuation">(</span>anchorPoint<span class="token punctuation">,</span> from<span class="token punctuation">:</span> fromView<span class="token punctuation">)</span>
            <span class="token keyword">let</span> attachmentBehavior <span class="token operator">=</span> <span class="token function">UIAttachmentBehavior</span><span class="token punctuation">(</span>item<span class="token punctuation">:</span> fromView<span class="token punctuation">,</span> offsetFromCenter<span class="token punctuation">:</span> offset<span class="token punctuation">,</span> attachedToAnchor<span class="token punctuation">:</span> anchorPoint<span class="token punctuation">)</span>
            attachmentBehavior<span class="token punctuation">.</span>frequency <span class="token operator">=</span> <span class="token number">3.0</span>
            attachmentBehavior<span class="token punctuation">.</span>damping <span class="token operator">=</span> <span class="token number">3.0</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>attachmentBehavior <span class="token operator">=</span> attachmentBehavior
        
            <span class="token comment">// `DropOutAnimator` is a composit behavior, so add child behaviors to self</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">addChildBehavior</span><span class="token punctuation">(</span>collisionBehavior<span class="token punctuation">)</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">addChildBehavior</span><span class="token punctuation">(</span>bodyBehavior<span class="token punctuation">)</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">addChildBehavior</span><span class="token punctuation">(</span>gravityBehavior<span class="token punctuation">)</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">addChildBehavior</span><span class="token punctuation">(</span>attachmentBehavior<span class="token punctuation">)</span>
        
            <span class="token comment">// Add self to dynamic animator</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>animator<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">addBehavior</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span>
        
            <span class="token comment">// Animation has two parts part one is hanging from rope. </span>
            <span class="token comment">// Part two is bouncying off-screen</span>
            <span class="token comment">// Divide duration in two</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>finishTime <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2.0</span> <span class="token operator">/</span> <span class="token number">3.0</span><span class="token punctuation">)</span> <span class="token operator">*</span> duration <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>animator<span class="token operator">?</span><span class="token punctuation">.</span>elapsedTime <span class="token operator">?</span><span class="token operator">?</span> <span class="token number">0.0</span><span class="token punctuation">)</span>
        
             <span class="token comment">// After every &quot;tick&quot; of animator check if past time limit</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>action <span class="token operator">=</span>
            <span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token keyword">weak</span> <span class="token keyword">self</span><span class="token punctuation">]</span> <span class="token keyword">in</span>
                <span class="token keyword">guard</span> <span class="token keyword">let</span> strongSelf <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">,</span>
                  <span class="token punctuation">(</span>strongSelf<span class="token punctuation">.</span>animator<span class="token operator">?</span><span class="token punctuation">.</span>elapsedTime <span class="token operator">?</span><span class="token operator">?</span> <span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> strongSelf<span class="token punctuation">.</span>finishTime <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
                strongSelf<span class="token punctuation">.</span>hasElapsedTimeExceededDuration <span class="token operator">=</span> <span class="token boolean">true</span>
                strongSelf<span class="token punctuation">.</span>animator<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">removeBehavior</span><span class="token punctuation">(</span>strongSelf<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    
    <span class="token punctuation">}</span>

    <span class="token keyword">func</span> <span class="token function">transitionDuration</span><span class="token punctuation">(</span>using transitionContext<span class="token punctuation">:</span> <span class="token builtin">UIViewControllerContextTransitioning</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">TimeInterval</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Return the duration of the animation</span>
        <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">.</span>duration
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">extension</span> <span class="token builtin">DropOutAnimator</span><span class="token punctuation">:</span> <span class="token builtin">UIDynamicAnimatorDelegate</span>
<span class="token punctuation">{</span>
    <span class="token keyword">func</span> <span class="token function">dynamicAnimatorDidPause</span><span class="token punctuation">(</span><span class="token number">_</span> animator<span class="token punctuation">:</span> <span class="token builtin">UIDynamicAnimator</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// Animator has reached stasis</span>
      <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>isAppearing
      <span class="token punctuation">{</span>
            <span class="token comment">// Check if we are out of time</span>
            <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>hasElapsedTimeExceededDuration
            <span class="token punctuation">{</span>
                <span class="token comment">// Move to final positions</span>
                <span class="token keyword">let</span> toView <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">viewController</span><span class="token punctuation">(</span>forKey<span class="token punctuation">:</span> <span class="token punctuation">.</span>to<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span>view
                <span class="token keyword">let</span> containerView <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext<span class="token operator">?</span><span class="token punctuation">.</span>containerView
                toView<span class="token operator">?</span><span class="token punctuation">.</span>center <span class="token operator">=</span> containerView<span class="token operator">?</span><span class="token punctuation">.</span>center <span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">.</span>zero
                <span class="token keyword">self</span><span class="token punctuation">.</span>hasElapsedTimeExceededDuration <span class="token operator">=</span> <span class="token boolean">false</span>
            <span class="token punctuation">}</span>
            
            <span class="token comment">// Clean up and call completion</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">completeTransition</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext<span class="token operator">?</span><span class="token punctuation">.</span>transitionWasCancelled <span class="token operator">?</span><span class="token operator">?</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>childBehaviors<span class="token punctuation">.</span>forEach <span class="token punctuation">{</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">removeChildBehavior</span><span class="token punctuation">(</span>$<span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
            animator<span class="token punctuation">.</span><span class="token function">removeAllBehaviors</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext <span class="token operator">=</span> <span class="token constant">nil</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token keyword">let</span> attachmentBehavior <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>attachmentBehavior
        <span class="token punctuation">{</span>
            <span class="token comment">// If we have an attachment, we are at the end of part one and start part two.</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">removeChildBehavior</span><span class="token punctuation">(</span>attachmentBehavior<span class="token punctuation">)</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>attachmentBehavior <span class="token operator">=</span> <span class="token constant">nil</span>
            animator<span class="token punctuation">.</span><span class="token function">addBehavior</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span>
            <span class="token keyword">let</span> duration <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">transitionDuration</span><span class="token punctuation">(</span>using<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext<span class="token punctuation">)</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>finishTime <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">/</span> <span class="token number">3.0</span> <span class="token operator">*</span> duration <span class="token operator">+</span> animator<span class="token punctuation">.</span>elapsedTime
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Clean up and call completion</span>
            <span class="token keyword">let</span> fromView <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">viewController</span><span class="token punctuation">(</span>forKey<span class="token punctuation">:</span> <span class="token punctuation">.</span>from<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span>view
            <span class="token keyword">let</span> toView <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">viewController</span><span class="token punctuation">(</span>forKey<span class="token punctuation">:</span> <span class="token punctuation">.</span>to<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span>view
            fromView<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">removeFromSuperview</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            toView<span class="token operator">?</span><span class="token punctuation">.</span>isUserInteractionEnabled <span class="token operator">=</span> <span class="token boolean">true</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">completeTransition</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext<span class="token operator">?</span><span class="token punctuation">.</span>transitionWasCancelled <span class="token operator">?</span><span class="token operator">?</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>childBehaviors<span class="token punctuation">.</span>forEach <span class="token punctuation">{</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">removeChildBehavior</span><span class="token punctuation">(</span>$<span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
            animator<span class="token punctuation">.</span><span class="token function">removeAllBehaviors</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext <span class="token operator">=</span> <span class="token constant">nil</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="objective-c-5"><a href="#objective-c-5" class="header-anchor">#</a> Objective-C</h3> <div class="language-swift extra-class"><pre class="language-swift"><code>@interface <span class="token class-name">ObjcDropOutAnimator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token builtin">UIDynamicAnimatorDelegate</span><span class="token punctuation">,</span> <span class="token builtin">UIViewControllerAnimatedTransitioning</span><span class="token operator">&gt;</span>
@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> id<span class="token operator">&lt;</span><span class="token builtin">UIViewControllerContextTransitioning</span><span class="token operator">&gt;</span> transitionContext<span class="token punctuation">;</span>
@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> <span class="token builtin">UIDynamicAnimator</span> <span class="token operator">*</span>animator<span class="token punctuation">;</span>
@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> assign<span class="token punctuation">)</span> <span class="token builtin">NSTimeInterval</span> finishTime<span class="token punctuation">;</span>
@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> assign<span class="token punctuation">)</span> <span class="token constant">BOOL</span> elapsedTimeExceededDuration<span class="token punctuation">;</span>
@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> assign<span class="token punctuation">,</span> getter<span class="token operator">=</span>isAppearing<span class="token punctuation">)</span> <span class="token constant">BOOL</span> appearing<span class="token punctuation">;</span>
@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> assign<span class="token punctuation">)</span> <span class="token builtin">NSTimeInterval</span> duration<span class="token punctuation">;</span>
@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> <span class="token builtin">UIAttachmentBehavior</span> <span class="token operator">*</span>attachBehavior<span class="token punctuation">;</span>
@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> <span class="token builtin">UICollisionBehavior</span> <span class="token operator">*</span> collisionBehavior<span class="token punctuation">;</span>

@end

@implementation <span class="token builtin">ObjcDropOutAnimator</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>instancetype<span class="token punctuation">)</span>initWithDuration<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token builtin">NSTimeInterval</span><span class="token punctuation">)</span>duration appearing<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token constant">BOOL</span><span class="token punctuation">)</span>appearing
<span class="token punctuation">{</span>
    <span class="token keyword">self</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">super</span> <span class="token keyword">init</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _duration <span class="token operator">=</span> duration<span class="token punctuation">;</span>
        _appearing <span class="token operator">=</span> appearing<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>void<span class="token punctuation">)</span> animateTransition<span class="token punctuation">:</span><span class="token punctuation">(</span>id<span class="token operator">&lt;</span><span class="token builtin">UIViewControllerContextTransitioning</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>transitionContext
<span class="token punctuation">{</span>
    <span class="token comment">// Get relevant views and view controllers from transitionContext</span>
    <span class="token builtin">UIViewController</span> <span class="token operator">*</span>fromVC <span class="token operator">=</span> <span class="token punctuation">[</span>transitionContext viewControllerForKey<span class="token punctuation">:</span><span class="token builtin">UITransitionContextFromViewControllerKey</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token builtin">UIViewController</span> <span class="token operator">*</span>toVC <span class="token operator">=</span> <span class="token punctuation">[</span>transitionContext viewControllerForKey<span class="token punctuation">:</span><span class="token builtin">UITransitionContextToViewControllerKey</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token builtin">UIView</span> <span class="token operator">*</span>fromView <span class="token operator">=</span> fromVC<span class="token punctuation">.</span>view<span class="token punctuation">;</span>
    <span class="token builtin">UIView</span> <span class="token operator">*</span>toView <span class="token operator">=</span> toVC<span class="token punctuation">.</span>view<span class="token punctuation">;</span>
    
    <span class="token builtin">UIView</span> <span class="token operator">*</span>containerView <span class="token operator">=</span> transitionContext<span class="token punctuation">.</span>containerView<span class="token punctuation">;</span>
    <span class="token builtin">NSTimeInterval</span> duration <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">self</span> transitionDuration<span class="token punctuation">:</span>transitionContext<span class="token punctuation">]</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Hold refrence to transitionContext to notify it of completion</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext <span class="token operator">=</span> transitionContext<span class="token punctuation">;</span>
    
    <span class="token comment">// Create dynamic animator</span>
    <span class="token builtin">UIDynamicAnimator</span> <span class="token operator">*</span>animator <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">UIDynamicAnimator</span> alloc<span class="token punctuation">]</span>initWithReferenceView<span class="token punctuation">:</span>containerView<span class="token punctuation">]</span><span class="token punctuation">;</span>
    animator<span class="token punctuation">.</span>delegate <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">;</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>animator <span class="token operator">=</span> animator<span class="token punctuation">;</span>
    
    <span class="token comment">// Presenting Animation</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>isAppearing<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        fromView<span class="token punctuation">.</span>userInteractionEnabled <span class="token operator">=</span> <span class="token constant">NO</span><span class="token punctuation">;</span>
        
        <span class="token comment">// Position toView  just above screen</span>
        <span class="token builtin">CGRect</span> fromViewInitialFrame <span class="token operator">=</span> <span class="token punctuation">[</span>transitionContext initialFrameForViewController<span class="token punctuation">:</span>fromVC<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token builtin">CGRect</span> toViewInitialFrame <span class="token operator">=</span> toView<span class="token punctuation">.</span>frame<span class="token punctuation">;</span>
        toViewInitialFrame<span class="token punctuation">.</span>origin<span class="token punctuation">.</span>y <span class="token operator">-</span><span class="token operator">=</span> <span class="token function">CGRectGetHeight</span><span class="token punctuation">(</span>toViewInitialFrame<span class="token punctuation">)</span><span class="token punctuation">;</span>
        toViewInitialFrame<span class="token punctuation">.</span>origin<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token function">CGRectGetWidth</span><span class="token punctuation">(</span>fromViewInitialFrame<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.5</span> <span class="token operator">-</span> <span class="token function">CGRectGetWidth</span><span class="token punctuation">(</span>toViewInitialFrame<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
        toView<span class="token punctuation">.</span>frame <span class="token operator">=</span> toViewInitialFrame<span class="token punctuation">;</span>
        
        <span class="token punctuation">[</span>containerView addSubview<span class="token punctuation">:</span>toView<span class="token punctuation">]</span><span class="token punctuation">;</span>
        
        <span class="token comment">// Prevent rotation and adjust bounce</span>
        <span class="token builtin">UIDynamicItemBehavior</span> <span class="token operator">*</span>bodyBehavior <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">UIDynamicItemBehavior</span> alloc<span class="token punctuation">]</span>initWithItems<span class="token punctuation">:</span>@<span class="token punctuation">[</span>toView<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        bodyBehavior<span class="token punctuation">.</span>elasticity <span class="token operator">=</span> <span class="token number">0.7</span><span class="token punctuation">;</span>
        bodyBehavior<span class="token punctuation">.</span>allowsRotation <span class="token operator">=</span> <span class="token constant">NO</span><span class="token punctuation">;</span>
        
        <span class="token comment">// Add gravity at exaggerated magnitude so animation doesn't seem slow</span>
        <span class="token builtin">UIGravityBehavior</span> <span class="token operator">*</span>gravityBehavior <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">UIGravityBehavior</span> alloc<span class="token punctuation">]</span>initWithItems<span class="token punctuation">:</span>@<span class="token punctuation">[</span>toView<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        gravityBehavior<span class="token punctuation">.</span>magnitude <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">.</span>0f<span class="token punctuation">;</span>
        
        <span class="token comment">// Set collision bounds to include off-screen view and have collision floor in center</span>
        <span class="token comment">// where our final view should come to rest</span>
        <span class="token builtin">UICollisionBehavior</span> <span class="token operator">*</span>collisionBehavior <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">UICollisionBehavior</span> alloc<span class="token punctuation">]</span>initWithItems<span class="token punctuation">:</span>@<span class="token punctuation">[</span>toView<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token builtin">UIEdgeInsets</span> insets <span class="token operator">=</span> <span class="token function">UIEdgeInsetsMake</span><span class="token punctuation">(</span><span class="token function">CGRectGetMinY</span><span class="token punctuation">(</span>toViewInitialFrame<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token function">CGRectGetHeight</span><span class="token punctuation">(</span>fromViewInitialFrame<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.5</span> <span class="token operator">-</span> <span class="token function">CGRectGetHeight</span><span class="token punctuation">(</span>toViewInitialFrame<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span>collisionBehavior setTranslatesReferenceBoundsIntoBoundaryWithInsets<span class="token punctuation">:</span>insets<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>collisionBehavior <span class="token operator">=</span> collisionBehavior<span class="token punctuation">;</span>
        
        <span class="token comment">// Keep track of finish time in case we need to end the animator befor the animator pauses</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>finishTime <span class="token operator">=</span> duration <span class="token operator">+</span> <span class="token keyword">self</span><span class="token punctuation">.</span>animator<span class="token punctuation">.</span>elapsedTime<span class="token punctuation">;</span>
        
        <span class="token comment">// Closure that is called after every &quot;tick&quot; of the animator</span>
        <span class="token comment">// Check if we exceed duration</span>
        __weak <span class="token builtin">ObjcDropOutAnimator</span> <span class="token operator">*</span>weakSelf <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>action <span class="token operator">=</span> <span class="token operator">^</span><span class="token punctuation">{</span>
            __strong <span class="token builtin">ObjcDropOutAnimator</span> <span class="token operator">*</span>strongSelf <span class="token operator">=</span> weakSelf<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>strongSelf<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>strongSelf<span class="token punctuation">.</span>animator<span class="token punctuation">.</span>elapsedTime <span class="token operator">&gt;=</span> strongSelf<span class="token punctuation">.</span>finishTime<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    strongSelf<span class="token punctuation">.</span>elapsedTimeExceededDuration <span class="token operator">=</span> <span class="token constant">YES</span><span class="token punctuation">;</span>
                    <span class="token punctuation">[</span>strongSelf<span class="token punctuation">.</span>animator removeBehavior<span class="token punctuation">:</span>strongSelf<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        
        <span class="token comment">// `DropOutAnimator` is a composit behavior, so add child behaviors to self</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span> addChildBehavior<span class="token punctuation">:</span>collisionBehavior<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span> addChildBehavior<span class="token punctuation">:</span>bodyBehavior<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span> addChildBehavior<span class="token punctuation">:</span>gravityBehavior<span class="token punctuation">]</span><span class="token punctuation">;</span>
        
        <span class="token comment">// Add self to dynamic animator</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>animator addBehavior<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Dismissing Animation</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Allow rotation and have a elastic item</span>
        <span class="token builtin">UIDynamicItemBehavior</span> <span class="token operator">*</span>bodyBehavior <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">UIDynamicItemBehavior</span> alloc<span class="token punctuation">]</span> initWithItems<span class="token punctuation">:</span>@<span class="token punctuation">[</span>fromView<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        bodyBehavior<span class="token punctuation">.</span>elasticity <span class="token operator">=</span> <span class="token number">0.8</span><span class="token punctuation">;</span>
        bodyBehavior<span class="token punctuation">.</span>angularResistance <span class="token operator">=</span> <span class="token number">5.0</span><span class="token punctuation">;</span>
        bodyBehavior<span class="token punctuation">.</span>allowsRotation <span class="token operator">=</span> <span class="token constant">YES</span><span class="token punctuation">;</span>
        
        <span class="token comment">// Create gravity with exaggerated magnitude</span>
        <span class="token builtin">UIGravityBehavior</span> <span class="token operator">*</span>gravityBehavior <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">UIGravityBehavior</span> alloc<span class="token punctuation">]</span> initWithItems<span class="token punctuation">:</span>@<span class="token punctuation">[</span>fromView<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        gravityBehavior<span class="token punctuation">.</span>magnitude <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">.</span>0f<span class="token punctuation">;</span>
        
        <span class="token comment">// Collision boundary is set to have a floor just below the bottom of the screen</span>
        <span class="token builtin">UICollisionBehavior</span> <span class="token operator">*</span>collisionBehavior <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">UICollisionBehavior</span> alloc<span class="token punctuation">]</span> initWithItems<span class="token punctuation">:</span>@<span class="token punctuation">[</span>fromView<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token builtin">UIEdgeInsets</span> insets <span class="token operator">=</span> <span class="token function">UIEdgeInsetsMake</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">225</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span>collisionBehavior setTranslatesReferenceBoundsIntoBoundaryWithInsets<span class="token punctuation">:</span>insets<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>collisionBehavior <span class="token operator">=</span> collisionBehavior<span class="token punctuation">;</span>
        
        <span class="token comment">// Attachment behavior so view will have effect of hanging from a rope</span>
        <span class="token builtin">UIOffset</span> offset <span class="token operator">=</span> <span class="token function">UIOffsetMake</span><span class="token punctuation">(</span><span class="token number">70</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token punctuation">(</span><span class="token function">CGRectGetHeight</span><span class="token punctuation">(</span>fromView<span class="token punctuation">.</span>bounds<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token builtin">CGPoint</span> anchorPoint <span class="token operator">=</span> <span class="token function">CGPointMake</span><span class="token punctuation">(</span><span class="token function">CGRectGetMaxX</span><span class="token punctuation">(</span>fromView<span class="token punctuation">.</span>bounds<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">40</span><span class="token punctuation">,</span>
                                          <span class="token function">CGRectGetMinY</span><span class="token punctuation">(</span>fromView<span class="token punctuation">.</span>bounds<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        anchorPoint <span class="token operator">=</span> <span class="token punctuation">[</span>containerView convertPoint<span class="token punctuation">:</span>anchorPoint fromView<span class="token punctuation">:</span>fromView<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token builtin">UIAttachmentBehavior</span> <span class="token operator">*</span>attachBehavior <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">UIAttachmentBehavior</span> alloc<span class="token punctuation">]</span> initWithItem<span class="token punctuation">:</span>fromView offsetFromCenter<span class="token punctuation">:</span>offset attachedToAnchor<span class="token punctuation">:</span>anchorPoint<span class="token punctuation">]</span><span class="token punctuation">;</span>
        attachBehavior<span class="token punctuation">.</span>frequency <span class="token operator">=</span> <span class="token number">3.0</span><span class="token punctuation">;</span>
        attachBehavior<span class="token punctuation">.</span>damping <span class="token operator">=</span> <span class="token number">0.3</span><span class="token punctuation">;</span>
        attachBehavior<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>attachBehavior <span class="token operator">=</span> attachBehavior<span class="token punctuation">;</span>
        
        <span class="token comment">// `DropOutAnimator` is a composit behavior, so add child behaviors to self</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span> addChildBehavior<span class="token punctuation">:</span>collisionBehavior<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span> addChildBehavior<span class="token punctuation">:</span>bodyBehavior<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span> addChildBehavior<span class="token punctuation">:</span>gravityBehavior<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span> addChildBehavior<span class="token punctuation">:</span>attachBehavior<span class="token punctuation">]</span><span class="token punctuation">;</span>
        
        <span class="token comment">// Add self to dynamic animator</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>animator addBehavior<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        
        <span class="token comment">// Animation has two parts part one is hanging from rope.</span>
        <span class="token comment">// Part two is bouncying off-screen</span>
        <span class="token comment">// Divide duration in two</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>finishTime <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token number">3</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token operator">*</span> duration <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>animator elapsedTime<span class="token punctuation">]</span><span class="token punctuation">;</span>
        
        <span class="token comment">// After every &quot;tick&quot; of animator check if past time limit</span>
        __weak <span class="token builtin">ObjcDropOutAnimator</span> <span class="token operator">*</span>weakSelf <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>action <span class="token operator">=</span> <span class="token operator">^</span><span class="token punctuation">{</span>
            __strong <span class="token builtin">ObjcDropOutAnimator</span> <span class="token operator">*</span>strongSelf <span class="token operator">=</span> weakSelf<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>strongSelf<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>strongSelf<span class="token punctuation">.</span>animator elapsedTime<span class="token punctuation">]</span> <span class="token operator">&gt;=</span> strongSelf<span class="token punctuation">.</span>finishTime<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    strongSelf<span class="token punctuation">.</span>elapsedTimeExceededDuration <span class="token operator">=</span> <span class="token constant">YES</span><span class="token punctuation">;</span>
                    <span class="token punctuation">[</span>strongSelf<span class="token punctuation">.</span>animator removeBehavior<span class="token punctuation">:</span>strongSelf<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token builtin">NSTimeInterval</span><span class="token punctuation">)</span>transitionDuration<span class="token punctuation">:</span><span class="token punctuation">(</span>id<span class="token operator">&lt;</span><span class="token builtin">UIViewControllerContextTransitioning</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>transitionContext
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">.</span>duration<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>void<span class="token punctuation">)</span>dynamicAnimatorDidPause<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token builtin">UIDynamicAnimator</span> <span class="token operator">*</span><span class="token punctuation">)</span>animator
<span class="token punctuation">{</span>
    <span class="token comment">// Animator has reached stasis</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>isAppearing<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Check if we are out of time</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>elapsedTimeExceededDuration<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Move to final positions</span>
            <span class="token builtin">UIView</span> <span class="token operator">*</span>toView <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext viewControllerForKey<span class="token punctuation">:</span><span class="token builtin">UITransitionContextToViewControllerKey</span><span class="token punctuation">]</span><span class="token punctuation">.</span>view<span class="token punctuation">;</span>
            <span class="token builtin">UIView</span> <span class="token operator">*</span>containerView <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext containerView<span class="token punctuation">]</span><span class="token punctuation">;</span>
            toView<span class="token punctuation">.</span>center <span class="token operator">=</span> containerView<span class="token punctuation">.</span>center<span class="token punctuation">;</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>elapsedTimeExceededDuration <span class="token operator">=</span> <span class="token constant">NO</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">// Clean up and call completion</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext completeTransition<span class="token punctuation">:</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext transitionWasCancelled<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token builtin">UIDynamicBehavior</span> <span class="token operator">*</span>behavior <span class="token keyword">in</span> <span class="token keyword">self</span><span class="token punctuation">.</span>childBehaviors<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token punctuation">[</span><span class="token keyword">self</span> removeChildBehavior<span class="token punctuation">:</span>behavior<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">[</span>animator removeAllBehaviors<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext <span class="token operator">=</span> <span class="token constant">nil</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Dismissing</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>attachBehavior<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// If we have an attachment, we are at the end of part one and start part two.</span>
            <span class="token punctuation">[</span><span class="token keyword">self</span> removeChildBehavior<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>attachBehavior<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>attachBehavior <span class="token operator">=</span> <span class="token constant">nil</span><span class="token punctuation">;</span>
            <span class="token punctuation">[</span>animator addBehavior<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token builtin">NSTimeInterval</span> duration <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">self</span> transitionDuration<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>finishTime <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token number">3</span><span class="token punctuation">.</span> <span class="token operator">*</span> duration <span class="token operator">+</span> <span class="token punctuation">[</span>animator elapsedTime<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Clean up and call completion</span>
            <span class="token builtin">UIView</span> <span class="token operator">*</span>fromView <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext viewControllerForKey<span class="token punctuation">:</span><span class="token builtin">UITransitionContextFromViewControllerKey</span><span class="token punctuation">]</span><span class="token punctuation">.</span>view<span class="token punctuation">;</span>
            <span class="token builtin">UIView</span> <span class="token operator">*</span>toView <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext viewControllerForKey<span class="token punctuation">:</span><span class="token builtin">UITransitionContextToViewControllerKey</span><span class="token punctuation">]</span><span class="token punctuation">.</span>view<span class="token punctuation">;</span>
            <span class="token punctuation">[</span>fromView removeFromSuperview<span class="token punctuation">]</span><span class="token punctuation">;</span>
            toView<span class="token punctuation">.</span>userInteractionEnabled <span class="token operator">=</span> <span class="token constant">YES</span><span class="token punctuation">;</span>
            
            <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext completeTransition<span class="token punctuation">:</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext transitionWasCancelled<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token builtin">UIDynamicBehavior</span> <span class="token operator">*</span>behavior <span class="token keyword">in</span> <span class="token keyword">self</span><span class="token punctuation">.</span>childBehaviors<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token punctuation">[</span><span class="token keyword">self</span> removeChildBehavior<span class="token punctuation">:</span>behavior<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token punctuation">[</span>animator removeAllBehaviors<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext <span class="token operator">=</span> <span class="token constant">nil</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>As composite behavior, <code>DropOutAnimator</code>, can combine a number of different behaviors to perform its presenting and dismissing animations. <code>DropOutAnimator</code> also demonstrates how to use the <code>action</code> block of a behavior to inspect the locations of its items as well as the time elapsed a technique that can be used to remove views that move offscreen or truncate animations that have yet to reach stasis.</p> <p>For more information <a href="https://developer.apple.com/videos/play/wwdc2013/221/" target="_blank" rel="noopener noreferrer">2013 WWDC Session &quot;Advanced Techniques with UIKit Dynamics&quot;<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> as well as <a href="https://github.com/soleares/SOLPresentingFun" target="_blank" rel="noopener noreferrer">SOLPresentingFun<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="shade-transition-with-real-world-physics-using-uidynamicbehaviors"><a href="#shade-transition-with-real-world-physics-using-uidynamicbehaviors" class="header-anchor">#</a> Shade Transition with Real-World Physics Using UIDynamicBehaviors</h2> <p>This example shows how to make an interactive presentation transition with &quot;real-world&quot; physics similar to iOS's notifications screen.</p> <p><a href="https://i.stack.imgur.com/j0oBa.gif" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/j0oBa.gif" alt="enter image description here"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>To start with, we need a presenting view controller that the shade will appear over. This view controller will also act as our <code>UIViewControllerTransitioningDelegate</code> for our presented view controller and will vend animators for our transition.  So we'll create instances of our interactive animators (one for presenting, one for dismissing). We'll also create an instance of the shade view controller, which, in this example, is just a view controller with a label. Because we want the same pan gesture to drive the entire interaction we pass references to the presenting view controller and the shade into our interactive animators.</p> <h3 id="swift-6"><a href="#swift-6" class="header-anchor">#</a> Swift</h3> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">class</span> <span class="token class-name">ViewController</span><span class="token punctuation">:</span> <span class="token builtin">UIViewController</span>
<span class="token punctuation">{</span>
    <span class="token keyword">var</span> presentingAnimator<span class="token punctuation">:</span> <span class="token builtin">ShadeAnimator</span><span class="token operator">!</span>
    <span class="token keyword">var</span> dismissingAnimator<span class="token punctuation">:</span> <span class="token builtin">ShadeAnimator</span><span class="token operator">!</span>
    <span class="token keyword">let</span> shadeVC <span class="token operator">=</span> <span class="token function">ShadeViewController</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">lazy</span> <span class="token keyword">var</span> label<span class="token punctuation">:</span> <span class="token builtin">UILabel</span> <span class="token operator">=</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">let</span> label <span class="token operator">=</span> <span class="token function">UILabel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        label<span class="token punctuation">.</span>textColor <span class="token operator">=</span> <span class="token punctuation">.</span>blue
        label<span class="token punctuation">.</span>translatesAutoresizingMaskIntoConstraints <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span><span class="token function">addSubview</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span>
        label<span class="token punctuation">.</span>centerXAnchor<span class="token punctuation">.</span><span class="token function">constraint</span><span class="token punctuation">(</span>equalTo<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>centerXAnchor<span class="token punctuation">)</span><span class="token punctuation">.</span>isActive <span class="token operator">=</span> <span class="token boolean">true</span>
        label<span class="token punctuation">.</span>centerYAnchor<span class="token punctuation">.</span><span class="token function">constraint</span><span class="token punctuation">(</span>equalTo<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>centerYAnchor<span class="token punctuation">)</span><span class="token punctuation">.</span>isActive <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token keyword">return</span> label
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">viewDidLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">viewDidLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        label<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">&quot;Swipe Down From Top&quot;</span>
        presentingAnimator <span class="token operator">=</span> <span class="token function">ShadeAnimator</span><span class="token punctuation">(</span>isAppearing<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> presentingVC<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">,</span> presentedVC<span class="token punctuation">:</span> shadeVC<span class="token punctuation">,</span> transitionDelegate<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">)</span>
        dismissingAnimator <span class="token operator">=</span> <span class="token function">ShadeAnimator</span><span class="token punctuation">(</span>isAppearing<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> presentingVC<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">,</span> presentedVC<span class="token punctuation">:</span> shadeVC<span class="token punctuation">,</span> transitionDelegate<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">extension</span> <span class="token builtin">ViewController</span><span class="token punctuation">:</span> <span class="token builtin">UIViewControllerTransitioningDelegate</span>
<span class="token punctuation">{</span>
    <span class="token keyword">func</span> <span class="token function">animationController</span><span class="token punctuation">(</span>forPresented presented<span class="token punctuation">:</span> <span class="token builtin">UIViewController</span><span class="token punctuation">,</span> presenting<span class="token punctuation">:</span> <span class="token builtin">UIViewController</span><span class="token punctuation">,</span> source<span class="token punctuation">:</span> <span class="token builtin">UIViewController</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">UIViewControllerAnimatedTransitioning</span><span class="token operator">?</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">EmptyAnimator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">func</span> <span class="token function">animationController</span><span class="token punctuation">(</span>forDismissed dismissed<span class="token punctuation">:</span> <span class="token builtin">UIViewController</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">UIViewControllerAnimatedTransitioning</span><span class="token operator">?</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">EmptyAnimator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">func</span> <span class="token function">interactionControllerForPresentation</span><span class="token punctuation">(</span>using animator<span class="token punctuation">:</span> <span class="token builtin">UIViewControllerAnimatedTransitioning</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">UIViewControllerInteractiveTransitioning</span><span class="token operator">?</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> presentingAnimator
    <span class="token punctuation">}</span>
    
    <span class="token keyword">func</span> <span class="token function">interactionControllerForDismissal</span><span class="token punctuation">(</span>using animator<span class="token punctuation">:</span> <span class="token builtin">UIViewControllerAnimatedTransitioning</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">UIViewControllerInteractiveTransitioning</span><span class="token operator">?</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> dismissingAnimator
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="objective-c-6"><a href="#objective-c-6" class="header-anchor">#</a> Objective-C</h3> <div class="language-swift extra-class"><pre class="language-swift"><code>@interface <span class="token class-name">ObjCViewController</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token builtin">UIViewControllerTransitioningDelegate</span><span class="token operator">&gt;</span>
@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> <span class="token builtin">ShadeAnimator</span> <span class="token operator">*</span>presentingAnimator<span class="token punctuation">;</span>
@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> <span class="token builtin">ShadeAnimator</span> <span class="token operator">*</span>dismissingAnimator<span class="token punctuation">;</span>
@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> <span class="token builtin">UILabel</span> <span class="token operator">*</span>label<span class="token punctuation">;</span>
@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> <span class="token builtin">ShadeViewController</span> <span class="token operator">*</span>shadeVC<span class="token punctuation">;</span>
@end

@implementation <span class="token builtin">ObjCViewController</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>void<span class="token punctuation">)</span>viewDidLoad
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token keyword">super</span> viewDidLoad<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>label<span class="token punctuation">.</span>text <span class="token operator">=</span> @<span class="token string">&quot;Swipe Down From Top&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>shadeVC <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">ShadeViewController</span> alloc<span class="token punctuation">]</span> <span class="token keyword">init</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>presentingAnimator <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">ShadeAnimator</span> alloc<span class="token punctuation">]</span> initWithIsAppearing<span class="token punctuation">:</span><span class="token constant">YES</span> presentingVC<span class="token punctuation">:</span><span class="token keyword">self</span> presentedVC<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>shadeVC transitionDelegate<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>dismissingAnimator <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">ShadeAnimator</span> alloc<span class="token punctuation">]</span> initWithIsAppearing<span class="token punctuation">:</span><span class="token constant">NO</span> presentingVC<span class="token punctuation">:</span><span class="token keyword">self</span> presentedVC<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>shadeVC transitionDelegate<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token builtin">UILabel</span> <span class="token operator">*</span><span class="token punctuation">)</span>label
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_label<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _label <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">UILabel</span> alloc<span class="token punctuation">]</span> <span class="token keyword">init</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        _label<span class="token punctuation">.</span>textColor <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">UIColor</span> blueColor<span class="token punctuation">]</span><span class="token punctuation">;</span>
        _label<span class="token punctuation">.</span>translatesAutoresizingMaskIntoConstraints <span class="token operator">=</span> <span class="token constant">NO</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>view addSubview<span class="token punctuation">:</span>_label<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span>_label<span class="token punctuation">.</span>centerXAnchor constraintEqualToAnchor<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>centerXAnchor<span class="token punctuation">]</span><span class="token punctuation">.</span>active <span class="token operator">=</span> <span class="token constant">YES</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span>_label<span class="token punctuation">.</span>centerYAnchor constraintEqualToAnchor<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>centerYAnchor<span class="token punctuation">]</span><span class="token punctuation">.</span>active <span class="token operator">=</span> <span class="token constant">YES</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> _label<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

#pragma mark <span class="token operator">-</span> <span class="token builtin">UIViewControllerTransitioningDelegate</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>id<span class="token operator">&lt;</span><span class="token builtin">UIViewControllerAnimatedTransitioning</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>animationControllerForPresentedController<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token builtin">UIViewController</span> <span class="token operator">*</span><span class="token punctuation">)</span>presented presentingController<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token builtin">UIViewController</span> <span class="token operator">*</span><span class="token punctuation">)</span>presenting sourceController<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token builtin">UIViewController</span> <span class="token operator">*</span><span class="token punctuation">)</span>source
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">EmptyAnimator</span> alloc<span class="token punctuation">]</span> <span class="token keyword">init</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>id<span class="token operator">&lt;</span><span class="token builtin">UIViewControllerAnimatedTransitioning</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>animationControllerForDismissedController<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token builtin">UIViewController</span> <span class="token operator">*</span><span class="token punctuation">)</span>dismissed
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">EmptyAnimator</span> alloc<span class="token punctuation">]</span> <span class="token keyword">init</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>id<span class="token operator">&lt;</span><span class="token builtin">UIViewControllerInteractiveTransitioning</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>interactionControllerForPresentation<span class="token punctuation">:</span><span class="token punctuation">(</span>id<span class="token operator">&lt;</span><span class="token builtin">UIViewControllerAnimatedTransitioning</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>animator
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">.</span>presentingAnimator<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>id<span class="token operator">&lt;</span><span class="token builtin">UIViewControllerInteractiveTransitioning</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>interactionControllerForDismissal<span class="token punctuation">:</span><span class="token punctuation">(</span>id<span class="token operator">&lt;</span><span class="token builtin">UIViewControllerAnimatedTransitioning</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>animator
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">.</span>dismissingAnimator<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

@end

</code></pre></div><p>We want really only ever want to present our shade through an interactive transition but because of how <code>UIViewControllerTransitioningDelegate</code> works if we don't return a regular animation controller our interactive controller will never be used. Because of that we create an <code>EmptyAnimator</code> class that conforms to <code>UIViewControllerAnimatedTransitioning</code>.</p> <h3 id="swift-7"><a href="#swift-7" class="header-anchor">#</a> Swift</h3> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">class</span> <span class="token class-name">EmptyAnimator</span><span class="token punctuation">:</span> <span class="token builtin">NSObject</span>
<span class="token punctuation">{</span>

<span class="token punctuation">}</span>

<span class="token keyword">extension</span> <span class="token builtin">EmptyAnimator</span><span class="token punctuation">:</span> <span class="token builtin">UIViewControllerAnimatedTransitioning</span>
<span class="token punctuation">{</span>
    <span class="token keyword">func</span> <span class="token function">animateTransition</span><span class="token punctuation">(</span>using transitionContext<span class="token punctuation">:</span> <span class="token builtin">UIViewControllerContextTransitioning</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        
    <span class="token punctuation">}</span>
    
    <span class="token keyword">func</span> <span class="token function">transitionDuration</span><span class="token punctuation">(</span>using transitionContext<span class="token punctuation">:</span> <span class="token builtin">UIViewControllerContextTransitioning</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">TimeInterval</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0.0</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="objective-c-7"><a href="#objective-c-7" class="header-anchor">#</a> Objective-C</h3> <div class="language-swift extra-class"><pre class="language-swift"><code>@implementation <span class="token builtin">EmptyAnimator</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>void<span class="token punctuation">)</span>animateTransition<span class="token punctuation">:</span><span class="token punctuation">(</span>id<span class="token operator">&lt;</span><span class="token builtin">UIViewControllerContextTransitioning</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>transitionContext
<span class="token punctuation">{</span>
    
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token builtin">NSTimeInterval</span><span class="token punctuation">)</span>transitionDuration<span class="token punctuation">:</span><span class="token punctuation">(</span>id<span class="token operator">&lt;</span><span class="token builtin">UIViewControllerContextTransitioning</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>transitionContext
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

@end

</code></pre></div><p>Finally we need to actually create the <code>ShadeAnimator</code> which is a subclass of <code>UIDynamicBehavior</code> which conforms to <code>UIViewControllerInteractiveTransitioning</code>.</p> <h3 id="swift-8"><a href="#swift-8" class="header-anchor">#</a> Swift</h3> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">class</span> <span class="token class-name">ShadeAnimator</span><span class="token punctuation">:</span> <span class="token builtin">UIDynamicBehavior</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Whether we are presenting or dismissing</span>
    <span class="token keyword">let</span> isAppearing<span class="token punctuation">:</span> <span class="token builtin">Bool</span>

    <span class="token comment">// The view controller that is not the shade</span>
    <span class="token keyword">weak</span> <span class="token keyword">var</span> presentingVC<span class="token punctuation">:</span> <span class="token builtin">UIViewController</span><span class="token operator">?</span>

    <span class="token comment">// The view controller that is the shade</span>
    <span class="token keyword">weak</span> <span class="token keyword">var</span> presentedVC<span class="token punctuation">:</span> <span class="token builtin">UIViewController</span><span class="token operator">?</span>

    <span class="token comment">// The delegate will vend the animator</span>
    <span class="token keyword">weak</span> <span class="token keyword">var</span> transitionDelegate<span class="token punctuation">:</span> <span class="token builtin">UIViewControllerTransitioningDelegate</span><span class="token operator">?</span>
    
    <span class="token comment">// Feedback generator for haptics on collisions</span>
    <span class="token keyword">let</span> impactFeedbackGenerator <span class="token operator">=</span> <span class="token function">UIImpactFeedbackGenerator</span><span class="token punctuation">(</span>style<span class="token punctuation">:</span> <span class="token punctuation">.</span>light<span class="token punctuation">)</span>
    
    <span class="token comment">// The context given to the animator at the start of the transition</span>
    <span class="token keyword">var</span> transitionContext<span class="token punctuation">:</span> <span class="token builtin">UIViewControllerContextTransitioning</span><span class="token operator">?</span>
    
    <span class="token comment">// Time limit of the dynamic part of the animation</span>
    <span class="token keyword">var</span> finishTime<span class="token punctuation">:</span> <span class="token builtin">TimeInterval</span> <span class="token operator">=</span> <span class="token number">4.0</span>
    
    <span class="token comment">// The Pan Gesture that drives the transition. Not using EdgePan because triggers Notifications screen</span>
    <span class="token keyword">lazy</span> <span class="token keyword">var</span> pan<span class="token punctuation">:</span> <span class="token builtin">UIPanGestureRecognizer</span> <span class="token operator">=</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">let</span> pan <span class="token operator">=</span> <span class="token function">UIPanGestureRecognizer</span><span class="token punctuation">(</span>target<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">,</span> action<span class="token punctuation">:</span> #<span class="token function">selector</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">handlePan</span><span class="token punctuation">(</span>sender<span class="token punctuation">:</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> pan
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment">// The dynamic animator that we add `ShadeAnimator` to</span>
    <span class="token keyword">lazy</span> <span class="token keyword">var</span> animator<span class="token punctuation">:</span> <span class="token builtin">UIDynamicAnimator</span><span class="token operator">!</span> <span class="token operator">=</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">let</span> animator <span class="token operator">=</span> <span class="token function">UIDynamicAnimator</span><span class="token punctuation">(</span>referenceView<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext<span class="token operator">!</span><span class="token punctuation">.</span>containerView<span class="token punctuation">)</span>
        <span class="token keyword">return</span> animator
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment">// init with all of our dependencies</span>
    <span class="token keyword">init</span><span class="token punctuation">(</span>isAppearing<span class="token punctuation">:</span> <span class="token builtin">Bool</span><span class="token punctuation">,</span> presentingVC<span class="token punctuation">:</span> <span class="token builtin">UIViewController</span><span class="token punctuation">,</span> presentedVC<span class="token punctuation">:</span> <span class="token builtin">UIViewController</span><span class="token punctuation">,</span> transitionDelegate<span class="token punctuation">:</span> <span class="token builtin">UIViewControllerTransitioningDelegate</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>isAppearing <span class="token operator">=</span> isAppearing
        <span class="token keyword">self</span><span class="token punctuation">.</span>presentingVC <span class="token operator">=</span> presentingVC
        <span class="token keyword">self</span><span class="token punctuation">.</span>presentedVC <span class="token operator">=</span> presentedVC
        <span class="token keyword">self</span><span class="token punctuation">.</span>transitionDelegate <span class="token operator">=</span> transitionDelegate
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>impactFeedbackGenerator<span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token keyword">if</span> isAppearing
        <span class="token punctuation">{</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>presentingVC<span class="token operator">?</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span><span class="token function">addGestureRecognizer</span><span class="token punctuation">(</span>pan<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>presentedVC<span class="token operator">?</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span><span class="token function">addGestureRecognizer</span><span class="token punctuation">(</span>pan<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        
    <span class="token punctuation">}</span>
    
    <span class="token comment">// Setup and moves shade view controller to just above screen if appearing</span>
    <span class="token keyword">func</span> <span class="token function">setupViewsForTransition</span><span class="token punctuation">(</span>with transitionContext<span class="token punctuation">:</span> <span class="token builtin">UIViewControllerContextTransitioning</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Get relevant views and view controllers from transitionContext</span>
        <span class="token keyword">guard</span> <span class="token keyword">let</span> fromVC <span class="token operator">=</span> transitionContext<span class="token punctuation">.</span><span class="token function">viewController</span><span class="token punctuation">(</span>forKey<span class="token punctuation">:</span> <span class="token punctuation">.</span>from<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">let</span> toVC <span class="token operator">=</span> transitionContext<span class="token punctuation">.</span><span class="token function">viewController</span><span class="token punctuation">(</span>forKey<span class="token punctuation">:</span> <span class="token punctuation">.</span>to<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">let</span> toView <span class="token operator">=</span> toVC<span class="token punctuation">.</span>view <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
        
        <span class="token keyword">let</span> containerView <span class="token operator">=</span> transitionContext<span class="token punctuation">.</span>containerView
        
        <span class="token comment">// Hold refrence to transitionContext to notify it of completion</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext <span class="token operator">=</span> transitionContext
        <span class="token keyword">if</span> isAppearing
        <span class="token punctuation">{</span>
            <span class="token comment">// Position toView  just off-screen</span>
            <span class="token keyword">let</span> fromViewInitialFrame <span class="token operator">=</span> transitionContext<span class="token punctuation">.</span><span class="token function">initialFrame</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> fromVC<span class="token punctuation">)</span>
            <span class="token keyword">var</span> toViewInitialFrame <span class="token operator">=</span> toView<span class="token punctuation">.</span>frame
            toViewInitialFrame<span class="token punctuation">.</span>origin<span class="token punctuation">.</span>y <span class="token operator">-</span><span class="token operator">=</span> toViewInitialFrame<span class="token punctuation">.</span>height
            toViewInitialFrame<span class="token punctuation">.</span>origin<span class="token punctuation">.</span>x <span class="token operator">=</span> fromViewInitialFrame<span class="token punctuation">.</span>width <span class="token operator">*</span> <span class="token number">0.5</span> <span class="token operator">-</span> toViewInitialFrame<span class="token punctuation">.</span>width <span class="token operator">*</span> <span class="token number">0.5</span>
            toView<span class="token punctuation">.</span>frame <span class="token operator">=</span> toViewInitialFrame
            
            containerView<span class="token punctuation">.</span><span class="token function">addSubview</span><span class="token punctuation">(</span>toView<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
            fromVC<span class="token punctuation">.</span>view<span class="token punctuation">.</span><span class="token function">addGestureRecognizer</span><span class="token punctuation">(</span>pan<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// Handles the entire interaction from presenting/dismissing to completion</span>
    <span class="token keyword">func</span> <span class="token function">handlePan</span><span class="token punctuation">(</span>sender<span class="token punctuation">:</span> <span class="token builtin">UIPanGestureRecognizer</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">let</span> location <span class="token operator">=</span> sender<span class="token punctuation">.</span><span class="token function">location</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> transitionContext<span class="token operator">?</span><span class="token punctuation">.</span>containerView<span class="token punctuation">)</span>
        <span class="token keyword">let</span> velocity <span class="token operator">=</span> sender<span class="token punctuation">.</span><span class="token function">velocity</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> transitionContext<span class="token operator">?</span><span class="token punctuation">.</span>containerView<span class="token punctuation">)</span>
        <span class="token keyword">let</span> fromVC <span class="token operator">=</span> transitionContext<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">viewController</span><span class="token punctuation">(</span>forKey<span class="token punctuation">:</span> <span class="token punctuation">.</span>from<span class="token punctuation">)</span>
        <span class="token keyword">let</span> toVC <span class="token operator">=</span> transitionContext<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">viewController</span><span class="token punctuation">(</span>forKey<span class="token punctuation">:</span> <span class="token punctuation">.</span>to<span class="token punctuation">)</span>
        
        <span class="token keyword">let</span> touchStartHeight<span class="token punctuation">:</span> <span class="token builtin">CGFloat</span> <span class="token operator">=</span> <span class="token number">90.0</span>
        <span class="token keyword">let</span> touchLocationFromBottom<span class="token punctuation">:</span> <span class="token builtin">CGFloat</span> <span class="token operator">=</span> <span class="token number">20.0</span>
        
        <span class="token keyword">switch</span> sender<span class="token punctuation">.</span>state
        <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token punctuation">.</span>began<span class="token punctuation">:</span>
            <span class="token keyword">let</span> beginLocation <span class="token operator">=</span> sender<span class="token punctuation">.</span><span class="token function">location</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> sender<span class="token punctuation">.</span>view<span class="token punctuation">)</span>
            <span class="token keyword">if</span> isAppearing
            <span class="token punctuation">{</span>
                <span class="token keyword">guard</span> beginLocation<span class="token punctuation">.</span>y <span class="token operator">&lt;=</span> touchStartHeight<span class="token punctuation">,</span>
                      <span class="token keyword">let</span> presentedVC <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>presentedVC <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">break</span> <span class="token punctuation">}</span>
                presentedVC<span class="token punctuation">.</span>modalPresentationStyle <span class="token operator">=</span> <span class="token punctuation">.</span>custom
                presentedVC<span class="token punctuation">.</span>transitioningDelegate <span class="token operator">=</span> transitionDelegate
                presentingVC<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">present</span><span class="token punctuation">(</span>presentedVC<span class="token punctuation">,</span> animated<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">guard</span> beginLocation<span class="token punctuation">.</span>y <span class="token operator">&gt;=</span> <span class="token punctuation">(</span>sender<span class="token punctuation">.</span>view<span class="token operator">?</span><span class="token punctuation">.</span>frame<span class="token punctuation">.</span>height <span class="token operator">?</span><span class="token operator">?</span> <span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token operator">-</span> touchStartHeight <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">break</span> <span class="token punctuation">}</span>
                presentedVC<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">dismiss</span><span class="token punctuation">(</span>animated<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token keyword">case</span> <span class="token punctuation">.</span>changed<span class="token punctuation">:</span>
            <span class="token keyword">guard</span> <span class="token keyword">let</span> view <span class="token operator">=</span> isAppearing <span class="token operator">?</span> toVC<span class="token operator">?</span><span class="token punctuation">.</span>view <span class="token punctuation">:</span> fromVC<span class="token operator">?</span><span class="token punctuation">.</span>view <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
            <span class="token builtin">UIView</span><span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span>withDuration<span class="token punctuation">:</span> <span class="token number">0.2</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                view<span class="token punctuation">.</span>frame<span class="token punctuation">.</span>origin<span class="token punctuation">.</span>y <span class="token operator">=</span> location<span class="token punctuation">.</span>y <span class="token operator">-</span> view<span class="token punctuation">.</span>bounds<span class="token punctuation">.</span>height <span class="token operator">+</span> touchLocationFromBottom
            <span class="token punctuation">}</span>
            
            transitionContext<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">updateInteractiveTransition</span><span class="token punctuation">(</span>view<span class="token punctuation">.</span>frame<span class="token punctuation">.</span>maxY <span class="token operator">/</span> view<span class="token punctuation">.</span>frame<span class="token punctuation">.</span>height
            <span class="token punctuation">)</span>
        <span class="token keyword">case</span> <span class="token punctuation">.</span>ended<span class="token punctuation">,</span> <span class="token punctuation">.</span>cancelled<span class="token punctuation">:</span>
            <span class="token keyword">guard</span> <span class="token keyword">let</span> view <span class="token operator">=</span> isAppearing <span class="token operator">?</span> toVC<span class="token operator">?</span><span class="token punctuation">.</span>view <span class="token punctuation">:</span> fromVC<span class="token operator">?</span><span class="token punctuation">.</span>view <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
            <span class="token keyword">let</span> isCancelled <span class="token operator">=</span> isAppearing <span class="token operator">?</span> <span class="token punctuation">(</span>velocity<span class="token punctuation">.</span>y <span class="token operator">&lt;</span> <span class="token number">0.5</span> <span class="token operator">||</span> view<span class="token punctuation">.</span>center<span class="token punctuation">.</span>y <span class="token operator">&lt;</span> <span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span>velocity<span class="token punctuation">.</span>y <span class="token operator">&gt;</span> <span class="token number">0.5</span> <span class="token operator">||</span> view<span class="token punctuation">.</span>center<span class="token punctuation">.</span>y <span class="token operator">&gt;</span> <span class="token number">0.0</span><span class="token punctuation">)</span>
            <span class="token function">addAttachmentBehavior</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> view<span class="token punctuation">,</span> isCancelled<span class="token punctuation">:</span> isCancelled<span class="token punctuation">)</span>
            <span class="token function">addCollisionBehavior</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> view<span class="token punctuation">)</span>
            <span class="token function">addItemBehavior</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> view<span class="token punctuation">)</span>
            
            animator<span class="token punctuation">.</span><span class="token function">addBehavior</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span>
            animator<span class="token punctuation">.</span>delegate <span class="token operator">=</span> <span class="token keyword">self</span>
            
            <span class="token keyword">self</span><span class="token punctuation">.</span>action <span class="token operator">=</span>
            <span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token keyword">weak</span> <span class="token keyword">self</span><span class="token punctuation">]</span> <span class="token keyword">in</span>
                <span class="token keyword">guard</span> <span class="token keyword">let</span> strongSelf <span class="token operator">=</span> <span class="token keyword">self</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
                <span class="token keyword">if</span> strongSelf<span class="token punctuation">.</span>animator<span class="token punctuation">.</span>elapsedTime <span class="token operator">&gt;</span> strongSelf<span class="token punctuation">.</span>finishTime
                <span class="token punctuation">{</span>
                    strongSelf<span class="token punctuation">.</span>animator<span class="token punctuation">.</span><span class="token function">removeAllBehaviors</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span>
                <span class="token punctuation">{</span>
                    strongSelf<span class="token punctuation">.</span>transitionContext<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">updateInteractiveTransition</span><span class="token punctuation">(</span>view<span class="token punctuation">.</span>frame<span class="token punctuation">.</span>maxY <span class="token operator">/</span> view<span class="token punctuation">.</span>frame<span class="token punctuation">.</span>height
                    <span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token keyword">default</span><span class="token punctuation">:</span>
            <span class="token keyword">break</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// Add collision behavior that causes bounce when finished</span>
    <span class="token keyword">func</span> <span class="token function">addCollisionBehavior</span><span class="token punctuation">(</span>with view<span class="token punctuation">:</span> <span class="token builtin">UIView</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">let</span> collisionBehavior <span class="token operator">=</span> <span class="token function">UICollisionBehavior</span><span class="token punctuation">(</span>items<span class="token punctuation">:</span> <span class="token punctuation">[</span>view<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">let</span> insets <span class="token operator">=</span> <span class="token function">UIEdgeInsets</span><span class="token punctuation">(</span>top<span class="token punctuation">:</span> <span class="token operator">-</span>view<span class="token punctuation">.</span>bounds<span class="token punctuation">.</span>height<span class="token punctuation">,</span> <span class="token keyword">left</span><span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> bottom<span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token keyword">right</span><span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">)</span>
        collisionBehavior<span class="token punctuation">.</span><span class="token function">setTranslatesReferenceBoundsIntoBoundary</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> insets<span class="token punctuation">)</span>
        collisionBehavior<span class="token punctuation">.</span>collisionDelegate <span class="token operator">=</span> <span class="token keyword">self</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">addChildBehavior</span><span class="token punctuation">(</span>collisionBehavior<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// Add attachment behavior that pulls shade either to top or bottom</span>
    <span class="token keyword">func</span> <span class="token function">addAttachmentBehavior</span><span class="token punctuation">(</span>with view<span class="token punctuation">:</span> <span class="token builtin">UIView</span><span class="token punctuation">,</span> isCancelled<span class="token punctuation">:</span> <span class="token builtin">Bool</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">let</span> anchor<span class="token punctuation">:</span> <span class="token builtin">CGPoint</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>isAppearing<span class="token punctuation">,</span> isCancelled<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            anchor <span class="token operator">=</span> <span class="token function">CGPoint</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> view<span class="token punctuation">.</span>center<span class="token punctuation">.</span>x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token operator">-</span>view<span class="token punctuation">.</span>frame<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
        <span class="token keyword">case</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            anchor <span class="token operator">=</span> <span class="token function">CGPoint</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> view<span class="token punctuation">.</span>center<span class="token punctuation">.</span>x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> view<span class="token punctuation">.</span>frame<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">let</span> attachmentBehavior <span class="token operator">=</span> <span class="token function">UIAttachmentBehavior</span><span class="token punctuation">(</span>item<span class="token punctuation">:</span> view<span class="token punctuation">,</span> attachedToAnchor<span class="token punctuation">:</span> anchor<span class="token punctuation">)</span>
        attachmentBehavior<span class="token punctuation">.</span>damping <span class="token operator">=</span> <span class="token number">0.1</span>
        attachmentBehavior<span class="token punctuation">.</span>frequency <span class="token operator">=</span> <span class="token number">3.0</span>
        attachmentBehavior<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0.5</span> <span class="token operator">*</span> view<span class="token punctuation">.</span>frame<span class="token punctuation">.</span>height
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">addChildBehavior</span><span class="token punctuation">(</span>attachmentBehavior<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// Makes view more bouncy </span>
    <span class="token keyword">func</span> <span class="token function">addItemBehavior</span><span class="token punctuation">(</span>with view<span class="token punctuation">:</span> <span class="token builtin">UIView</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">let</span> itemBehavior <span class="token operator">=</span> <span class="token function">UIDynamicItemBehavior</span><span class="token punctuation">(</span>items<span class="token punctuation">:</span> <span class="token punctuation">[</span>view<span class="token punctuation">]</span><span class="token punctuation">)</span>
        itemBehavior<span class="token punctuation">.</span>allowsRotation <span class="token operator">=</span> <span class="token boolean">false</span>
        itemBehavior<span class="token punctuation">.</span>elasticity <span class="token operator">=</span> <span class="token number">0.6</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">addChildBehavior</span><span class="token punctuation">(</span>itemBehavior<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
<span class="token keyword">extension</span> <span class="token builtin">ShadeAnimator</span><span class="token punctuation">:</span> <span class="token builtin">UIDynamicAnimatorDelegate</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Determines transition has ended</span>
    <span class="token keyword">func</span> <span class="token function">dynamicAnimatorDidPause</span><span class="token punctuation">(</span><span class="token number">_</span> animator<span class="token punctuation">:</span> <span class="token builtin">UIDynamicAnimator</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">guard</span> <span class="token keyword">let</span> transitionContext <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
        <span class="token keyword">let</span> fromVC <span class="token operator">=</span> transitionContext<span class="token punctuation">.</span><span class="token function">viewController</span><span class="token punctuation">(</span>forKey<span class="token punctuation">:</span> <span class="token punctuation">.</span>from<span class="token punctuation">)</span>
        <span class="token keyword">let</span> toVC <span class="token operator">=</span> transitionContext<span class="token punctuation">.</span><span class="token function">viewController</span><span class="token punctuation">(</span>forKey<span class="token punctuation">:</span> <span class="token punctuation">.</span>to<span class="token punctuation">)</span>
        <span class="token keyword">guard</span> <span class="token keyword">let</span> view <span class="token operator">=</span> isAppearing <span class="token operator">?</span> toVC<span class="token operator">?</span><span class="token punctuation">.</span>view <span class="token punctuation">:</span> fromVC<span class="token operator">?</span><span class="token punctuation">.</span>view <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>view<span class="token punctuation">.</span>center<span class="token punctuation">.</span>y <span class="token operator">&lt;</span> <span class="token number">0.0</span><span class="token punctuation">,</span> isAppearing<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            view<span class="token punctuation">.</span><span class="token function">removeFromSuperview</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            transitionContext<span class="token punctuation">.</span><span class="token function">finishInteractiveTransition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            transitionContext<span class="token punctuation">.</span><span class="token function">completeTransition</span><span class="token punctuation">(</span><span class="token operator">!</span>isAppearing<span class="token punctuation">)</span>
        <span class="token keyword">case</span> <span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            toVC<span class="token operator">?</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>frame <span class="token operator">=</span> transitionContext<span class="token punctuation">.</span><span class="token function">finalFrame</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> toVC<span class="token operator">!</span><span class="token punctuation">)</span>
            transitionContext<span class="token punctuation">.</span><span class="token function">finishInteractiveTransition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            transitionContext<span class="token punctuation">.</span><span class="token function">completeTransition</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
        <span class="token keyword">case</span> <span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            fromVC<span class="token operator">?</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>frame <span class="token operator">=</span> transitionContext<span class="token punctuation">.</span><span class="token function">initialFrame</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> fromVC<span class="token operator">!</span><span class="token punctuation">)</span>
            transitionContext<span class="token punctuation">.</span><span class="token function">cancelInteractiveTransition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            transitionContext<span class="token punctuation">.</span><span class="token function">completeTransition</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        childBehaviors<span class="token punctuation">.</span>forEach <span class="token punctuation">{</span> <span class="token function">removeChildBehavior</span><span class="token punctuation">(</span>$<span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
        animator<span class="token punctuation">.</span><span class="token function">removeAllBehaviors</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>animator <span class="token operator">=</span> <span class="token constant">nil</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext <span class="token operator">=</span> <span class="token constant">nil</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">extension</span> <span class="token builtin">ShadeAnimator</span><span class="token punctuation">:</span> <span class="token builtin">UICollisionBehaviorDelegate</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Triggers haptics</span>
    <span class="token keyword">func</span> <span class="token function">collisionBehavior</span><span class="token punctuation">(</span><span class="token number">_</span> behavior<span class="token punctuation">:</span> <span class="token builtin">UICollisionBehavior</span><span class="token punctuation">,</span> beganContactFor item<span class="token punctuation">:</span> <span class="token builtin">UIDynamicItem</span><span class="token punctuation">,</span> withBoundaryIdentifier identifier<span class="token punctuation">:</span> <span class="token builtin">NSCopying</span><span class="token operator">?</span><span class="token punctuation">,</span> at p<span class="token punctuation">:</span> <span class="token builtin">CGPoint</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">guard</span> p<span class="token punctuation">.</span>y <span class="token operator">&gt;</span> <span class="token number">0.0</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
        impactFeedbackGenerator<span class="token punctuation">.</span><span class="token function">impactOccurred</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">extension</span> <span class="token builtin">ShadeAnimator</span><span class="token punctuation">:</span> <span class="token builtin">UIViewControllerInteractiveTransitioning</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Starts transition</span>
    <span class="token keyword">func</span> <span class="token function">startInteractiveTransition</span><span class="token punctuation">(</span><span class="token number">_</span> transitionContext<span class="token punctuation">:</span> <span class="token builtin">UIViewControllerContextTransitioning</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">setupViewsForTransition</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> transitionContext<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="objective-c-8"><a href="#objective-c-8" class="header-anchor">#</a> Objective-C</h3> <div class="language-swift extra-class"><pre class="language-swift"><code>@interface <span class="token class-name">ShadeAnimator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token builtin">UIDynamicAnimatorDelegate</span><span class="token punctuation">,</span> <span class="token builtin">UICollisionBehaviorDelegate</span><span class="token operator">&gt;</span>
@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> assign<span class="token punctuation">)</span> <span class="token constant">BOOL</span> isAppearing<span class="token punctuation">;</span>
@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> <span class="token keyword">weak</span><span class="token punctuation">)</span> <span class="token builtin">UIViewController</span> <span class="token operator">*</span>presentingVC<span class="token punctuation">;</span>
@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> <span class="token keyword">weak</span><span class="token punctuation">)</span> <span class="token builtin">UIViewController</span> <span class="token operator">*</span>presentedVC<span class="token punctuation">;</span>
@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> <span class="token keyword">weak</span><span class="token punctuation">)</span> <span class="token builtin">NSObject</span><span class="token operator">&lt;</span><span class="token builtin">UIViewControllerTransitioningDelegate</span><span class="token operator">&gt;</span> <span class="token operator">*</span>transitionDelegate<span class="token punctuation">;</span>
@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> <span class="token builtin">UIImpactFeedbackGenerator</span> <span class="token operator">*</span>impactFeedbackGenerator<span class="token punctuation">;</span>
@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> id<span class="token operator">&lt;</span><span class="token builtin">UIViewControllerContextTransitioning</span><span class="token operator">&gt;</span> transitionContext<span class="token punctuation">;</span>
@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> assign<span class="token punctuation">)</span> <span class="token builtin">NSTimeInterval</span> finishTime<span class="token punctuation">;</span>
@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> <span class="token builtin">UIPanGestureRecognizer</span> <span class="token operator">*</span>pan<span class="token punctuation">;</span>
@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> <span class="token builtin">UIDynamicAnimator</span> <span class="token operator">*</span>animator<span class="token punctuation">;</span>
@end

@implementation <span class="token builtin">ShadeAnimator</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>instancetype<span class="token punctuation">)</span>initWithIsAppearing<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token constant">BOOL</span><span class="token punctuation">)</span>isAppearing presentingVC<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token builtin">UIViewController</span> <span class="token operator">*</span><span class="token punctuation">)</span>presentingVC presentedVC<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token builtin">UIViewController</span> <span class="token operator">*</span><span class="token punctuation">)</span>presentedVC transitionDelegate<span class="token punctuation">:</span><span class="token punctuation">(</span>id<span class="token operator">&lt;</span><span class="token builtin">UIViewControllerTransitioningDelegate</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>transitionDelegate
<span class="token punctuation">{</span>
    <span class="token keyword">self</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">super</span> <span class="token keyword">init</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _isAppearing <span class="token operator">=</span> isAppearing<span class="token punctuation">;</span>
        _presentingVC <span class="token operator">=</span> presentingVC<span class="token punctuation">;</span>
        _presentedVC <span class="token operator">=</span> presentedVC<span class="token punctuation">;</span>
        _transitionDelegate <span class="token operator">=</span> transitionDelegate<span class="token punctuation">;</span>
        _impactFeedbackGenerator <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">UIImpactFeedbackGenerator</span> alloc<span class="token punctuation">]</span>initWithStyle<span class="token punctuation">:</span><span class="token builtin">UIImpactFeedbackStyleLight</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span>_impactFeedbackGenerator prepare<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>_isAppearing<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token punctuation">[</span>_presentingVC<span class="token punctuation">.</span>view addGestureRecognizer<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>pan<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
            <span class="token punctuation">[</span>_presentedVC<span class="token punctuation">.</span>view addGestureRecognizer<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>pan<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

#pragma mark <span class="token operator">-</span> <span class="token builtin">Lazy</span> <span class="token builtin">Init</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token builtin">UIPanGestureRecognizer</span> <span class="token operator">*</span><span class="token punctuation">)</span>pan
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_pan<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _pan <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">UIPanGestureRecognizer</span> alloc<span class="token punctuation">]</span>initWithTarget<span class="token punctuation">:</span><span class="token keyword">self</span> action<span class="token punctuation">:</span>@<span class="token function">selector</span><span class="token punctuation">(</span>handlePan<span class="token punctuation">:</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> _pan<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token builtin">UIDynamicAnimator</span> <span class="token operator">*</span><span class="token punctuation">)</span>animator
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_animator<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _animator <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">UIDynamicAnimator</span> alloc<span class="token punctuation">]</span>initWithReferenceView<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext<span class="token punctuation">.</span>containerView<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> _animator<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

#pragma mark <span class="token operator">-</span> <span class="token builtin">Setup</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>void<span class="token punctuation">)</span>setupViewForTransitionWithContext<span class="token punctuation">:</span><span class="token punctuation">(</span>id<span class="token operator">&lt;</span><span class="token builtin">UIViewControllerContextTransitioning</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>transitionContext
<span class="token punctuation">{</span>
    <span class="token builtin">UIViewController</span> <span class="token operator">*</span>fromVC <span class="token operator">=</span> <span class="token punctuation">[</span>transitionContext viewControllerForKey<span class="token punctuation">:</span><span class="token builtin">UITransitionContextFromViewControllerKey</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token builtin">UIViewController</span> <span class="token operator">*</span>toVC <span class="token operator">=</span> <span class="token punctuation">[</span>transitionContext viewControllerForKey<span class="token punctuation">:</span><span class="token builtin">UITransitionContextToViewControllerKey</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token builtin">UIView</span> <span class="token operator">*</span>toView <span class="token operator">=</span> toVC<span class="token punctuation">.</span>view<span class="token punctuation">;</span>
    <span class="token builtin">UIView</span> <span class="token operator">*</span>containerView <span class="token operator">=</span> transitionContext<span class="token punctuation">.</span>containerView<span class="token punctuation">;</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext <span class="token operator">=</span> transitionContext<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>isAppearing<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token builtin">CGRect</span> fromViewInitialFrame <span class="token operator">=</span> <span class="token punctuation">[</span>transitionContext initialFrameForViewController<span class="token punctuation">:</span>fromVC<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token builtin">CGRect</span> toViewInitialFrame <span class="token operator">=</span> toView<span class="token punctuation">.</span>frame<span class="token punctuation">;</span>
        toViewInitialFrame<span class="token punctuation">.</span>origin<span class="token punctuation">.</span>y <span class="token operator">-</span><span class="token operator">=</span> <span class="token function">CGRectGetHeight</span><span class="token punctuation">(</span>toViewInitialFrame<span class="token punctuation">)</span><span class="token punctuation">;</span>
        toViewInitialFrame<span class="token punctuation">.</span>origin<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token function">CGRectGetWidth</span><span class="token punctuation">(</span>fromViewInitialFrame<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.5</span> <span class="token operator">-</span> <span class="token function">CGRectGetWidth</span><span class="token punctuation">(</span>toViewInitialFrame<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
        
        <span class="token punctuation">[</span>containerView addSubview<span class="token punctuation">:</span>toView<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">[</span>fromVC<span class="token punctuation">.</span>view addGestureRecognizer<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>pan<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

#pragma mark <span class="token operator">-</span> <span class="token builtin">Gesture</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>void<span class="token punctuation">)</span>handlePan<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token builtin">UIPanGestureRecognizer</span> <span class="token operator">*</span><span class="token punctuation">)</span>sender
<span class="token punctuation">{</span>
    <span class="token builtin">CGPoint</span> location <span class="token operator">=</span> <span class="token punctuation">[</span>sender locationInView<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext<span class="token punctuation">.</span>containerView<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token builtin">CGPoint</span> velocity <span class="token operator">=</span> <span class="token punctuation">[</span>sender velocityInView<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext<span class="token punctuation">.</span>containerView<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token builtin">UIViewController</span> <span class="token operator">*</span>fromVC <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext viewControllerForKey<span class="token punctuation">:</span><span class="token builtin">UITransitionContextFromViewControllerKey</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token builtin">UIViewController</span> <span class="token operator">*</span>toVC <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext viewControllerForKey<span class="token punctuation">:</span><span class="token builtin">UITransitionContextToViewControllerKey</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    
    <span class="token builtin">CGFloat</span> touchStartHeight <span class="token operator">=</span> <span class="token number">90.0</span><span class="token punctuation">;</span>
    <span class="token builtin">CGFloat</span> touchLocationFromBottom <span class="token operator">=</span> <span class="token number">20.0</span><span class="token punctuation">;</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span>sender<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token builtin">UIGestureRecognizerStateBegan</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token builtin">CGPoint</span> beginLocation <span class="token operator">=</span> <span class="token punctuation">[</span>sender locationInView<span class="token punctuation">:</span>sender<span class="token punctuation">.</span>view<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>isAppearing<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>beginLocation<span class="token punctuation">.</span>y <span class="token operator">&lt;=</span> touchStartHeight<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">self</span><span class="token punctuation">.</span>presentedVC<span class="token punctuation">.</span>modalPresentationStyle <span class="token operator">=</span> <span class="token builtin">UIModalPresentationCustom</span><span class="token punctuation">;</span>
                <span class="token keyword">self</span><span class="token punctuation">.</span>presentedVC<span class="token punctuation">.</span>transitioningDelegate <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>transitionDelegate<span class="token punctuation">;</span>
                <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>presentingVC presentViewController<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>presentedVC animated<span class="token punctuation">:</span><span class="token constant">YES</span> completion<span class="token punctuation">:</span><span class="token constant">nil</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>beginLocation<span class="token punctuation">.</span>y <span class="token operator">&gt;=</span> <span class="token punctuation">[</span>sender locationInView<span class="token punctuation">:</span>sender<span class="token punctuation">.</span>view<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">-</span> touchStartHeight<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>presentedVC dismissViewControllerAnimated<span class="token punctuation">:</span><span class="token boolean">true</span> completion<span class="token punctuation">:</span><span class="token constant">nil</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>sender<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token builtin">UIGestureRecognizerStateChanged</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token builtin">UIView</span> <span class="token operator">*</span>view <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>isAppearing <span class="token operator">?</span> toVC<span class="token punctuation">.</span>view <span class="token punctuation">:</span> fromVC<span class="token punctuation">.</span>view<span class="token punctuation">;</span>
        <span class="token punctuation">[</span><span class="token builtin">UIView</span> animateWithDuration<span class="token punctuation">:</span><span class="token number">0.2</span> animations<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">{</span>
            <span class="token builtin">CGRect</span> frame <span class="token operator">=</span> view<span class="token punctuation">.</span>frame<span class="token punctuation">;</span>
            frame<span class="token punctuation">.</span>origin<span class="token punctuation">.</span>y <span class="token operator">=</span> location<span class="token punctuation">.</span>y <span class="token operator">-</span> <span class="token function">CGRectGetHeight</span><span class="token punctuation">(</span>view<span class="token punctuation">.</span>bounds<span class="token punctuation">)</span> <span class="token operator">+</span> touchLocationFromBottom<span class="token punctuation">;</span>
            view<span class="token punctuation">.</span>frame <span class="token operator">=</span> frame<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext updateInteractiveTransition<span class="token punctuation">:</span><span class="token function">CGRectGetMaxY</span><span class="token punctuation">(</span>view<span class="token punctuation">.</span>frame<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">CGRectGetHeight</span><span class="token punctuation">(</span>view<span class="token punctuation">.</span>frame<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>sender<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token builtin">UIGestureRecognizerStateEnded</span> <span class="token operator">||</span> sender<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token builtin">UIGestureRecognizerStateCancelled</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token builtin">UIView</span> <span class="token operator">*</span>view <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>isAppearing <span class="token operator">?</span> toVC<span class="token punctuation">.</span>view <span class="token punctuation">:</span> fromVC<span class="token punctuation">.</span>view<span class="token punctuation">;</span>
        <span class="token constant">BOOL</span> isCancelled <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>isAppearing <span class="token operator">?</span> <span class="token punctuation">(</span>velocity<span class="token punctuation">.</span>y <span class="token operator">&lt;</span> <span class="token number">0.5</span> <span class="token operator">||</span> view<span class="token punctuation">.</span>center<span class="token punctuation">.</span>y <span class="token operator">&lt;</span> <span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span>velocity<span class="token punctuation">.</span>y <span class="token operator">&gt;</span> <span class="token number">0.5</span> <span class="token operator">||</span> view<span class="token punctuation">.</span>center<span class="token punctuation">.</span>y <span class="token operator">&gt;</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span> addAttachmentBehaviorWithView<span class="token punctuation">:</span>view isCancelled<span class="token punctuation">:</span>isCancelled<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span> addCollisionBehaviorWithView<span class="token punctuation">:</span>view<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span> addItemBehaviorWithView<span class="token punctuation">:</span>view<span class="token punctuation">]</span><span class="token punctuation">;</span>
        
        <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>animator addBehavior<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>animator<span class="token punctuation">.</span>delegate <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">;</span>
        
        __weak <span class="token builtin">ShadeAnimator</span> <span class="token operator">*</span>weakSelf <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>action <span class="token operator">=</span>
        <span class="token operator">^</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>weakSelf<span class="token punctuation">.</span>animator<span class="token punctuation">.</span>elapsedTime <span class="token operator">&gt;</span> weakSelf<span class="token punctuation">.</span>finishTime<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token punctuation">[</span>weakSelf<span class="token punctuation">.</span>animator removeAllBehaviors<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{</span>
                <span class="token punctuation">[</span>weakSelf<span class="token punctuation">.</span>transitionContext updateInteractiveTransition<span class="token punctuation">:</span><span class="token function">CGRectGetMaxY</span><span class="token punctuation">(</span>view<span class="token punctuation">.</span>frame<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">CGRectGetHeight</span><span class="token punctuation">(</span>view<span class="token punctuation">.</span>frame<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

#pragma mark <span class="token operator">-</span> <span class="token builtin">UIViewControllerInteractiveTransitioning</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>void<span class="token punctuation">)</span>startInteractiveTransition<span class="token punctuation">:</span><span class="token punctuation">(</span>id<span class="token operator">&lt;</span><span class="token builtin">UIViewControllerContextTransitioning</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>transitionContext
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token keyword">self</span> setupViewForTransitionWithContext<span class="token punctuation">:</span>transitionContext<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

#pragma mark <span class="token operator">-</span> <span class="token builtin">Behaviors</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>void<span class="token punctuation">)</span>addCollisionBehaviorWithView<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token builtin">UIView</span> <span class="token operator">*</span><span class="token punctuation">)</span>view
<span class="token punctuation">{</span>
    <span class="token builtin">UICollisionBehavior</span> <span class="token operator">*</span>collisionBehavior <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">UICollisionBehavior</span> alloc<span class="token punctuation">]</span>initWithItems<span class="token punctuation">:</span>@<span class="token punctuation">[</span>view<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token builtin">UIEdgeInsets</span> insets <span class="token operator">=</span> <span class="token function">UIEdgeInsetsMake</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token function">CGRectGetHeight</span><span class="token punctuation">(</span>view<span class="token punctuation">.</span>bounds<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span>collisionBehavior setTranslatesReferenceBoundsIntoBoundaryWithInsets<span class="token punctuation">:</span>insets<span class="token punctuation">]</span><span class="token punctuation">;</span>
    collisionBehavior<span class="token punctuation">.</span>collisionDelegate <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span><span class="token keyword">self</span> addChildBehavior<span class="token punctuation">:</span>collisionBehavior<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>void<span class="token punctuation">)</span>addItemBehaviorWithView<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token builtin">UIView</span> <span class="token operator">*</span><span class="token punctuation">)</span>view
<span class="token punctuation">{</span>
    <span class="token builtin">UIDynamicItemBehavior</span> <span class="token operator">*</span>itemBehavior <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">UIDynamicItemBehavior</span> alloc<span class="token punctuation">]</span>initWithItems<span class="token punctuation">:</span>@<span class="token punctuation">[</span>view<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    itemBehavior<span class="token punctuation">.</span>allowsRotation <span class="token operator">=</span> <span class="token constant">NO</span><span class="token punctuation">;</span>
    itemBehavior<span class="token punctuation">.</span>elasticity <span class="token operator">=</span> <span class="token number">0.6</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span><span class="token keyword">self</span> addChildBehavior<span class="token punctuation">:</span>itemBehavior<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>void<span class="token punctuation">)</span>addAttachmentBehaviorWithView<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token builtin">UIView</span> <span class="token operator">*</span><span class="token punctuation">)</span>view isCancelled<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token constant">BOOL</span><span class="token punctuation">)</span>isCancelled
<span class="token punctuation">{</span>
    <span class="token builtin">CGPoint</span> anchor<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>isAppearing <span class="token operator">&amp;&amp;</span> isCancelled<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">self</span><span class="token punctuation">.</span>isAppearing <span class="token operator">&amp;&amp;</span> isCancelled<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        anchor <span class="token operator">=</span> <span class="token function">CGPointMake</span><span class="token punctuation">(</span>view<span class="token punctuation">.</span>center<span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token function">CGRectGetHeight</span><span class="token punctuation">(</span>view<span class="token punctuation">.</span>frame<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        anchor <span class="token operator">=</span> <span class="token function">CGPointMake</span><span class="token punctuation">(</span>view<span class="token punctuation">.</span>center<span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token function">CGRectGetHeight</span><span class="token punctuation">(</span>view<span class="token punctuation">.</span>frame<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token builtin">UIAttachmentBehavior</span> <span class="token operator">*</span>attachmentBehavior <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">UIAttachmentBehavior</span> alloc<span class="token punctuation">]</span>initWithItem<span class="token punctuation">:</span>view attachedToAnchor<span class="token punctuation">:</span>anchor<span class="token punctuation">]</span><span class="token punctuation">;</span>
    attachmentBehavior<span class="token punctuation">.</span>damping <span class="token operator">=</span> <span class="token number">0.1</span><span class="token punctuation">;</span>
    attachmentBehavior<span class="token punctuation">.</span>frequency <span class="token operator">=</span> <span class="token number">3.0</span><span class="token punctuation">;</span>
    attachmentBehavior<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0.5</span> <span class="token operator">*</span> <span class="token function">CGRectGetHeight</span><span class="token punctuation">(</span>view<span class="token punctuation">.</span>frame<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span><span class="token keyword">self</span> addChildBehavior<span class="token punctuation">:</span>attachmentBehavior<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

#pragma mark <span class="token operator">-</span> <span class="token builtin">UICollisionBehaviorDelegate</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>void<span class="token punctuation">)</span>collisionBehavior<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token builtin">UICollisionBehavior</span> <span class="token operator">*</span><span class="token punctuation">)</span>behavior beganContactForItem<span class="token punctuation">:</span><span class="token punctuation">(</span>id<span class="token operator">&lt;</span><span class="token builtin">UIDynamicItem</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>item withBoundaryIdentifier<span class="token punctuation">:</span><span class="token punctuation">(</span>id<span class="token operator">&lt;</span><span class="token builtin">NSCopying</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>identifier atPoint<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token builtin">CGPoint</span><span class="token punctuation">)</span>p
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>y <span class="token operator">&gt;</span> <span class="token number">0.0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>impactFeedbackGenerator impactOccurred<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

#pragma mark <span class="token operator">-</span> <span class="token builtin">UIDynamicAnimatorDelegate</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>void<span class="token punctuation">)</span>dynamicAnimatorDidPause<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token builtin">UIDynamicAnimator</span> <span class="token operator">*</span><span class="token punctuation">)</span>animator
<span class="token punctuation">{</span>
    <span class="token builtin">UIViewController</span> <span class="token operator">*</span>fromVC <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext viewControllerForKey<span class="token punctuation">:</span><span class="token builtin">UITransitionContextFromViewControllerKey</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token builtin">UIViewController</span> <span class="token operator">*</span>toVC <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext viewControllerForKey<span class="token punctuation">:</span><span class="token builtin">UITransitionContextToViewControllerKey</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token builtin">UIView</span> <span class="token operator">*</span>view <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>isAppearing <span class="token operator">?</span> toVC<span class="token punctuation">.</span>view <span class="token punctuation">:</span> fromVC<span class="token punctuation">.</span>view<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>view<span class="token punctuation">.</span>center<span class="token punctuation">.</span>y <span class="token operator">&lt;</span> <span class="token number">0.0</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>isAppearing <span class="token operator">||</span>  <span class="token operator">!</span><span class="token keyword">self</span><span class="token punctuation">.</span>isAppearing<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">[</span>view removeFromSuperview<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext finishInteractiveTransition<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext completeTransition<span class="token punctuation">:</span><span class="token operator">!</span><span class="token keyword">self</span><span class="token punctuation">.</span>isAppearing<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>view<span class="token punctuation">.</span>center<span class="token punctuation">.</span>y <span class="token operator">&gt;=</span> <span class="token number">0.0</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">self</span><span class="token punctuation">.</span>isAppearing<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        toVC<span class="token punctuation">.</span>view<span class="token punctuation">.</span>frame <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext finalFrameForViewController<span class="token punctuation">:</span>toVC<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext finishInteractiveTransition<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext completeTransition<span class="token punctuation">:</span><span class="token constant">YES</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        fromVC<span class="token punctuation">.</span>view<span class="token punctuation">.</span>frame <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext initialFrameForViewController<span class="token punctuation">:</span>fromVC<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext cancelInteractiveTransition<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext completeTransition<span class="token punctuation">:</span><span class="token constant">NO</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token builtin">UIDynamicBehavior</span> <span class="token operator">*</span>behavior <span class="token keyword">in</span> <span class="token keyword">self</span><span class="token punctuation">.</span>childBehaviors<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span> removeChildBehavior<span class="token punctuation">:</span>behavior<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">[</span>animator removeAllBehaviors<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>animator <span class="token operator">=</span> <span class="token constant">nil</span><span class="token punctuation">;</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>transitionContext <span class="token operator">=</span> <span class="token constant">nil</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

@end

</code></pre></div><p>The animator triggers the start of the transition when the pan gesture begins. And simply moves the view as the gesture changes. But when the gesture ends that is when <code>UIDynamicBehaviors</code> determines if the transition should be completed or cancelled. To do so it uses an attachment and collision behavior. For more information see the <a href="https://developer.apple.com/videos/play/wwdc2013/221/" target="_blank" rel="noopener noreferrer">2013 WWDC Session &quot;Advanced Techniques with UIKit Dynamics<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h2 id="map-dynamic-animation-position-changes-to-bounds"><a href="#map-dynamic-animation-position-changes-to-bounds" class="header-anchor">#</a> Map Dynamic Animation Position Changes to Bounds</h2> <p>This example shows how to customize the <code>UIDynamicItem</code> protocol to map position changes of a view being dynamically animated to bounds changes to create a <code>UIButton</code> that expands and contracts in a elastic fashion.</p> <p><a href="https://i.stack.imgur.com/9R0zL.gif" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/9R0zL.gif" alt="enter image description here"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>To start we need to create a new protocol that implements <code>UIDynamicItem</code> but that also has a settable and gettable <code>bounds</code> property.</p> <h3 id="swift-9"><a href="#swift-9" class="header-anchor">#</a> Swift</h3> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">protocol</span> <span class="token builtin">ResizableDynamicItem</span><span class="token punctuation">:</span> <span class="token builtin">UIDynamicItem</span>
<span class="token punctuation">{</span>
    <span class="token keyword">var</span> bounds<span class="token punctuation">:</span> <span class="token builtin">CGRect</span> <span class="token punctuation">{</span> <span class="token keyword">set</span> <span class="token keyword">get</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">extension</span> <span class="token builtin">UIView</span><span class="token punctuation">:</span> <span class="token builtin">ResizableDynamicItem</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

</code></pre></div><h3 id="objective-c-9"><a href="#objective-c-9" class="header-anchor">#</a> Objective-C</h3> <div class="language-swift extra-class"><pre class="language-swift"><code>@<span class="token keyword">protocol</span> <span class="token builtin">ResizableDynamicItem</span> <span class="token operator">&lt;</span><span class="token builtin">UIDynamicItem</span><span class="token operator">&gt;</span>
@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> readwrite<span class="token punctuation">)</span> <span class="token builtin">CGRect</span> bounds<span class="token punctuation">;</span>
@end

</code></pre></div><p>We'll then create a wrapper object that will wrap a <code>UIDynamicItem</code> but will map center changes to the item's width and height. We will also provide passthroughs for <code>bounds</code> and <code>transform</code> of the underlying item. This will cause any changes the dynamic animator makes to the center x and y values of the underlying item will be applied to the items width and height.</p> <h3 id="swift-10"><a href="#swift-10" class="header-anchor">#</a> Swift</h3> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">PositionToBoundsMapping</span><span class="token punctuation">:</span> <span class="token builtin">NSObject</span><span class="token punctuation">,</span> <span class="token builtin">UIDynamicItem</span>
<span class="token punctuation">{</span>
    <span class="token keyword">var</span> target<span class="token punctuation">:</span> <span class="token builtin">ResizableDynamicItem</span>
    
    <span class="token keyword">init</span><span class="token punctuation">(</span>target<span class="token punctuation">:</span> <span class="token builtin">ResizableDynamicItem</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>target <span class="token operator">=</span> target
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">var</span> bounds<span class="token punctuation">:</span> <span class="token builtin">CGRect</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">get</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">.</span>target<span class="token punctuation">.</span>bounds
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">var</span> center<span class="token punctuation">:</span> <span class="token builtin">CGPoint</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">get</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">CGPoint</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>target<span class="token punctuation">.</span>bounds<span class="token punctuation">.</span>width<span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>target<span class="token punctuation">.</span>bounds<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">set</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>target<span class="token punctuation">.</span>bounds <span class="token operator">=</span> <span class="token function">CGRect</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> width<span class="token punctuation">:</span> newValue<span class="token punctuation">.</span>x<span class="token punctuation">,</span> height<span class="token punctuation">:</span> newValue<span class="token punctuation">.</span>y<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">var</span> transform<span class="token punctuation">:</span> <span class="token builtin">CGAffineTransform</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">get</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">.</span>target<span class="token punctuation">.</span>transform
        <span class="token punctuation">}</span>
        
        <span class="token keyword">set</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>target<span class="token punctuation">.</span>transform <span class="token operator">=</span> newValue
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="objective-c-10"><a href="#objective-c-10" class="header-anchor">#</a> Objective-C</h3> <div class="language-swift extra-class"><pre class="language-swift"><code>@interface <span class="token class-name">PositionToBoundsMapping</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> id<span class="token operator">&lt;</span><span class="token builtin">ResizableDynamicItem</span><span class="token operator">&gt;</span> target<span class="token punctuation">;</span>
@end

@implementation <span class="token builtin">PositionToBoundsMapping</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>instancetype<span class="token punctuation">)</span>initWithTarget<span class="token punctuation">:</span><span class="token punctuation">(</span>id<span class="token operator">&lt;</span><span class="token builtin">ResizableDynamicItem</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>target
<span class="token punctuation">{</span>
    <span class="token keyword">self</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">super</span> <span class="token keyword">init</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _target <span class="token operator">=</span> target<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token builtin">CGRect</span><span class="token punctuation">)</span>bounds
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">.</span>target<span class="token punctuation">.</span>bounds<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token builtin">CGPoint</span><span class="token punctuation">)</span>center
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">CGPointMake</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>target<span class="token punctuation">.</span>bounds<span class="token punctuation">.</span>size<span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>target<span class="token punctuation">.</span>bounds<span class="token punctuation">.</span>size<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>void<span class="token punctuation">)</span>setCenter<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token builtin">CGPoint</span><span class="token punctuation">)</span>center
<span class="token punctuation">{</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>target<span class="token punctuation">.</span>bounds <span class="token operator">=</span> <span class="token function">CGRectMake</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> center<span class="token punctuation">.</span>x<span class="token punctuation">,</span> center<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token builtin">CGAffineTransform</span><span class="token punctuation">)</span>transform
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">.</span>target<span class="token punctuation">.</span>transform<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>void<span class="token punctuation">)</span>setTransform<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token builtin">CGAffineTransform</span><span class="token punctuation">)</span>transform
<span class="token punctuation">{</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>target<span class="token punctuation">.</span>transform <span class="token operator">=</span> transform<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

@end

</code></pre></div><p>Finally, we'll create a <code>UIViewController</code> that will have a button. When the button is pressed we will create <code>PositionToBoundsMapping</code> with the button as the wrapped dynamic item. We create a <code>UIAttachmentBehavior</code> to it's current position then add an instantaneous <code>UIPushBehavior</code> to it. However because we have mapped changes its bounds, the button does not move but rather grows and shrinks.</p> <h3 id="swift-11"><a href="#swift-11" class="header-anchor">#</a> Swift</h3> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">ViewController</span><span class="token punctuation">:</span> <span class="token builtin">UIViewController</span>
<span class="token punctuation">{</span>
    <span class="token keyword">lazy</span> <span class="token keyword">var</span> button<span class="token punctuation">:</span> <span class="token builtin">UIButton</span> <span class="token operator">=</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">let</span> button <span class="token operator">=</span> <span class="token function">UIButton</span><span class="token punctuation">(</span>frame<span class="token punctuation">:</span> <span class="token function">CGRect</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> width<span class="token punctuation">:</span> <span class="token number">300.0</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">200.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        button<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token punctuation">.</span>red
        button<span class="token punctuation">.</span>layer<span class="token punctuation">.</span>cornerRadius <span class="token operator">=</span> <span class="token number">15.0</span>
        button<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token string">&quot;Tap Me&quot;</span><span class="token punctuation">,</span> <span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>normal<span class="token punctuation">)</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span><span class="token function">addSubview</span><span class="token punctuation">(</span>button<span class="token punctuation">)</span>
        <span class="token keyword">return</span> button
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">var</span> buttonBounds <span class="token operator">=</span> <span class="token builtin">CGRect</span><span class="token punctuation">.</span>zero
    <span class="token keyword">var</span> animator<span class="token punctuation">:</span> <span class="token builtin">UIDynamicAnimator</span><span class="token operator">?</span>
    
    <span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">viewDidLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">viewDidLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        view<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token punctuation">.</span>white
        button<span class="token punctuation">.</span><span class="token function">addTarget</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> action<span class="token punctuation">:</span> #<span class="token function">selector</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">didPressButton</span><span class="token punctuation">(</span>sender<span class="token punctuation">:</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>touchUpInside<span class="token punctuation">)</span>
        buttonBounds <span class="token operator">=</span> button<span class="token punctuation">.</span>bounds
    <span class="token punctuation">}</span>
    
    <span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">viewDidLayoutSubviews</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">viewDidLayoutSubviews</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        button<span class="token punctuation">.</span>center <span class="token operator">=</span> view<span class="token punctuation">.</span>center
    <span class="token punctuation">}</span>
    
    <span class="token keyword">func</span> <span class="token function">didPressButton</span><span class="token punctuation">(</span>sender<span class="token punctuation">:</span> <span class="token builtin">UIButton</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Reset bounds so if button is press twice in a row, previous changes don't propogate</span>
        button<span class="token punctuation">.</span>bounds <span class="token operator">=</span> buttonBounds
        <span class="token keyword">let</span> animator <span class="token operator">=</span> <span class="token function">UIDynamicAnimator</span><span class="token punctuation">(</span>referenceView<span class="token punctuation">:</span> view<span class="token punctuation">)</span>
        
        <span class="token comment">// Create mapping</span>
        <span class="token keyword">let</span> buttonBoundsDynamicItem <span class="token operator">=</span> <span class="token function">PositionToBoundsMapping</span><span class="token punctuation">(</span>target<span class="token punctuation">:</span> button<span class="token punctuation">)</span>
        
        <span class="token comment">// Add Attachment behavior</span>
        <span class="token keyword">let</span> attachmentBehavior <span class="token operator">=</span> <span class="token function">UIAttachmentBehavior</span><span class="token punctuation">(</span>item<span class="token punctuation">:</span> buttonBoundsDynamicItem<span class="token punctuation">,</span> attachedToAnchor<span class="token punctuation">:</span> buttonBoundsDynamicItem<span class="token punctuation">.</span>center<span class="token punctuation">)</span>
        
        <span class="token comment">// Higher frequency faster oscillation</span>
        attachmentBehavior<span class="token punctuation">.</span>frequency <span class="token operator">=</span> <span class="token number">2.0</span>
        
        <span class="token comment">// Lower damping longer oscillation lasts</span>
        attachmentBehavior<span class="token punctuation">.</span>damping <span class="token operator">=</span> <span class="token number">0.1</span>
        animator<span class="token punctuation">.</span><span class="token function">addBehavior</span><span class="token punctuation">(</span>attachmentBehavior<span class="token punctuation">)</span>
        
        <span class="token keyword">let</span> pushBehavior <span class="token operator">=</span> <span class="token function">UIPushBehavior</span><span class="token punctuation">(</span>items<span class="token punctuation">:</span> <span class="token punctuation">[</span>buttonBoundsDynamicItem<span class="token punctuation">]</span><span class="token punctuation">,</span> mode<span class="token punctuation">:</span> <span class="token punctuation">.</span>instantaneous<span class="token punctuation">)</span>
        
        <span class="token comment">// Change angle to determine how much height/ width should change 45 means heigh:width is 1:1</span>
        pushBehavior<span class="token punctuation">.</span>angle <span class="token operator">=</span> <span class="token punctuation">.</span>pi <span class="token operator">/</span> <span class="token number">4.0</span>
        
        <span class="token comment">// Larger magnitude means bigger change</span>
        pushBehavior<span class="token punctuation">.</span>magnitude <span class="token operator">=</span> <span class="token number">30.0</span>
        animator<span class="token punctuation">.</span><span class="token function">addBehavior</span><span class="token punctuation">(</span>pushBehavior<span class="token punctuation">)</span>
        pushBehavior<span class="token punctuation">.</span>active <span class="token operator">=</span> <span class="token boolean">true</span>
        
        <span class="token comment">// Hold refrence so animator is not released</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>animator <span class="token operator">=</span> animator
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="objective-c-11"><a href="#objective-c-11" class="header-anchor">#</a> Objective-C</h3> <div class="language-swift extra-class"><pre class="language-swift"><code>@interface <span class="token class-name">ViewController</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> <span class="token builtin">UIButton</span> <span class="token operator">*</span>button<span class="token punctuation">;</span>
@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> assign<span class="token punctuation">)</span> <span class="token builtin">CGRect</span> buttonBounds<span class="token punctuation">;</span>
@property <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> <span class="token builtin">UIDynamicAnimator</span> <span class="token operator">*</span>animator<span class="token punctuation">;</span>
@end

@implementation <span class="token builtin">ViewController</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>void<span class="token punctuation">)</span>viewDidLoad
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token keyword">super</span> viewDidLoad<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">UIColor</span> whiteColor<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>button addTarget<span class="token punctuation">:</span><span class="token keyword">self</span> action<span class="token punctuation">:</span>@<span class="token function">selector</span><span class="token punctuation">(</span>didTapButton<span class="token punctuation">:</span><span class="token punctuation">)</span> forControlEvents<span class="token punctuation">:</span><span class="token builtin">UIControlEventTouchUpInside</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>buttonBounds <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>button<span class="token punctuation">.</span>bounds<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>void<span class="token punctuation">)</span>viewDidLayoutSubviews
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token keyword">super</span> viewDidLayoutSubviews<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>button<span class="token punctuation">.</span>center <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>center<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token builtin">UIButton</span> <span class="token operator">*</span><span class="token punctuation">)</span>button
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_button<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _button <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">UIButton</span> alloc<span class="token punctuation">]</span>initWithFrame<span class="token punctuation">:</span><span class="token function">CGRectMake</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">200.0</span><span class="token punctuation">,</span> <span class="token number">200.0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        _button<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">UIColor</span> redColor<span class="token punctuation">]</span><span class="token punctuation">;</span>
        _button<span class="token punctuation">.</span>layer<span class="token punctuation">.</span>cornerRadius <span class="token operator">=</span> <span class="token number">15.0</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span>_button setTitle<span class="token punctuation">:</span>@<span class="token string">&quot;Tap Me&quot;</span> forState<span class="token punctuation">:</span><span class="token builtin">UIControlStateNormal</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>view addSubview<span class="token punctuation">:</span>_button<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> _button<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>void<span class="token punctuation">)</span>didTapButton<span class="token punctuation">:</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>sender
<span class="token punctuation">{</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>button<span class="token punctuation">.</span>bounds <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>buttonBounds<span class="token punctuation">;</span>
    <span class="token builtin">UIDynamicAnimator</span> <span class="token operator">*</span>animator <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">UIDynamicAnimator</span> alloc<span class="token punctuation">]</span> initWithReferenceView<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token builtin">PositionToBoundsMapping</span> <span class="token operator">*</span>buttonBoundsDynamicItem <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">PositionToBoundsMapping</span> alloc<span class="token punctuation">]</span>initWithTarget<span class="token punctuation">:</span>sender<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token builtin">UIAttachmentBehavior</span> <span class="token operator">*</span>attachmentBehavior <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">UIAttachmentBehavior</span> alloc<span class="token punctuation">]</span>initWithItem<span class="token punctuation">:</span>buttonBoundsDynamicItem attachedToAnchor<span class="token punctuation">:</span>buttonBoundsDynamicItem<span class="token punctuation">.</span>center<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span>attachmentBehavior setFrequency<span class="token punctuation">:</span><span class="token number">2.0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span>attachmentBehavior setDamping<span class="token punctuation">:</span><span class="token number">0.3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span>animator addBehavior<span class="token punctuation">:</span>attachmentBehavior<span class="token punctuation">]</span><span class="token punctuation">;</span>
    
    <span class="token builtin">UIPushBehavior</span> <span class="token operator">*</span>pushBehavior <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">UIPushBehavior</span> alloc<span class="token punctuation">]</span> initWithItems<span class="token punctuation">:</span>@<span class="token punctuation">[</span>buttonBoundsDynamicItem<span class="token punctuation">]</span> mode<span class="token punctuation">:</span><span class="token builtin">UIPushBehaviorModeInstantaneous</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    pushBehavior<span class="token punctuation">.</span>angle <span class="token operator">=</span> <span class="token builtin">M_PI_4</span><span class="token punctuation">;</span>
    pushBehavior<span class="token punctuation">.</span>magnitude <span class="token operator">=</span> <span class="token number">2.0</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span>animator addBehavior<span class="token punctuation">:</span>pushBehavior<span class="token punctuation">]</span><span class="token punctuation">;</span>
    
    <span class="token punctuation">[</span>pushBehavior setActive<span class="token punctuation">:</span><span class="token constant">TRUE</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    
    <span class="token keyword">self</span><span class="token punctuation">.</span>animator <span class="token operator">=</span> animator<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

@end

</code></pre></div><p>For more information see <a href="https://developer.apple.com/library/content/samplecode/DynamicsCatalog/Introduction/Intro.html" target="_blank" rel="noopener noreferrer">UIKit Dynamics Catalog<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h4 id="remarks"><a href="#remarks" class="header-anchor">#</a> Remarks</h4> <p>An import thing to keep in mind when using UIKit Dynamics is views that are positioned by the animator cannot readily be positioned by other common iOS layout methods.</p> <p>Newcomers to UIKit Dynamics often struggle with this important caveat. Placing constraints on a view that is also an item of a <code>UIDynamicBehavior</code> will likely cause confusion as a both the auto layout engine and the dynamic animator engine fight over the appropriate position. Similarly, attempting to set the frame directly of a view being controlled by the animator will typically result in jittery animation and unexpected placement. Adding a view as an item to a <code>UIDynamicBehavior</code> means that the animator will take on the responsibility of positioning a view and as such changes of view positions should be implemented through the animator.</p> <p>A view's frame that is being updated by a dynamic animator can be set, but that should be immediately followed by messaging the animator to update the animator's internal model of the view hierarchy. For example, if I have <code>UILabel</code>, <code>label</code> that is an item of a <code>UIGravityBehavior</code> I can move it to the top of the screen to watch it fall again by saying:</p> <h3 id="swift-12"><a href="#swift-12" class="header-anchor">#</a> Swift</h3> <div class="language-swift extra-class"><pre class="language-swift"><code>label<span class="token punctuation">.</span>frame <span class="token operator">=</span> <span class="token function">CGRect</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> width<span class="token punctuation">:</span> label<span class="token punctuation">.</span>intrinsicContentSize<span class="token punctuation">.</span>width<span class="token punctuation">,</span> height<span class="token punctuation">:</span> label<span class="token punctuation">.</span>intrinsicContentSize<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
dynamicAnimator<span class="token punctuation">.</span><span class="token function">updateItem</span><span class="token punctuation">(</span>usingCurrentState<span class="token punctuation">:</span> label<span class="token punctuation">)</span>

</code></pre></div><h3 id="objective-c-12"><a href="#objective-c-12" class="header-anchor">#</a> Objective-C</h3> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">self</span><span class="token punctuation">.</span>label<span class="token punctuation">.</span>frame <span class="token operator">=</span> <span class="token function">CGRectMake</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>label<span class="token punctuation">.</span>intrinsicContentSize<span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>label<span class="token punctuation">.</span>intrinsicContentSize<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>dynamicAnimator updateItemUsingCurrentState<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>label<span class="token punctuation">]</span><span class="token punctuation">;</span>

</code></pre></div><p>After which the animator will apply the gravity behavior from the label's new location.</p> <p>Another common technique is to use <code>UIDynamicBehaviors</code> to position views. For example if positioning a view under a touch event is desired, creating a <code>UIAttachmentBehavior</code> and updating its <code>anchorPoint</code> in either <code>touchesMoved</code> or a <code>UIGestureRecognizer</code>'s action is an effective strategy.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/ios/uikit-dynamics.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      
      <a href="/ios/uipheonix-easy-flexible-dynamic-highly-scalable-ui-framework.html" class="prev">
        UIPheonix - easy, flexible, dynamic &amp; highly scalable UI framework
      </a></span> <span class="next"><a href="/ios/ui-testing.html">
        UI Testing
      </a>
      
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.ced448ab.js" defer></script><script src="/assets/js/3.f1d73125.js" defer></script><script src="/assets/js/1474.9fbd9ddd.js" defer></script>
  </body>
</html>
