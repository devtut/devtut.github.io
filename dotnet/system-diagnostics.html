<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>.NET Framework - System.Diagnostics</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Stopwatch, Run shell commands, Send Command to CMD and Receive Output">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content=".NET Framework - System.Diagnostics">
    <meta property="og:description" content="Stopwatch, Run shell commands, Send Command to CMD and Receive Output">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/dotnet/system-diagnostics.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content=".NET Framework - System.Diagnostics">
    <meta name="twitter:description" content="Stopwatch, Run shell commands, Send Command to CMD and Receive Output">
    <meta name="twitter:url" content="/dotnet/system-diagnostics.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/1025.fa3dbc0f.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>.NET Framework</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dotnet/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/dotnet/getting-started-with-net-framework.html" class="sidebar-link">Getting started with .NET Framework</a></li><li><a href="/dotnet/strings.html" class="sidebar-link">Strings</a></li><li><a href="/dotnet/datetime-parsing.html" class="sidebar-link">DateTime parsing</a></li><li><a href="/dotnet/dictionaries.html" class="sidebar-link">Dictionaries</a></li><li><a href="/dotnet/collections.html" class="sidebar-link">Collections</a></li><li><a href="/dotnet/readonlycollections.html" class="sidebar-link">ReadOnlyCollections</a></li><li><a href="/dotnet/stack-and-heap.html" class="sidebar-link">Stack and Heap</a></li><li><a href="/dotnet/linq.html" class="sidebar-link">LINQ</a></li><li><a href="/dotnet/foreach.html" class="sidebar-link">ForEach</a></li><li><a href="/dotnet/reflection.html" class="sidebar-link">Reflection</a></li><li><a href="/dotnet/expression-trees.html" class="sidebar-link">Expression Trees</a></li><li><a href="/dotnet/custom-types.html" class="sidebar-link">Custom Types</a></li><li><a href="/dotnet/code-contracts.html" class="sidebar-link">Code Contracts</a></li><li><a href="/dotnet/settings.html" class="sidebar-link">Settings</a></li><li><a href="/dotnet/regular-expressions-system-text-regularexpressions.html" class="sidebar-link">Regular Expressions (System.Text.RegularExpressions)</a></li><li><a href="/dotnet/file-input-output.html" class="sidebar-link">File Input/Output</a></li><li><a href="/dotnet/system-io.html" class="sidebar-link">System.IO</a></li><li><a href="/dotnet/system-io-file-class.html" class="sidebar-link">System.IO.File class</a></li><li><a href="/dotnet/reading-and-writing-zip-files.html" class="sidebar-link">Reading and writing Zip files</a></li><li><a href="/dotnet/managed-extensibility-framework.html" class="sidebar-link">Managed Extensibility Framework</a></li><li><a href="/dotnet/speechrecognitionengine-class-to-recognize-speech.html" class="sidebar-link">SpeechRecognitionEngine class to recognize speech</a></li><li><a href="/dotnet/system-runtime-caching-memorycache-objectcache.html" class="sidebar-link">System.Runtime.Caching.MemoryCache (ObjectCache)</a></li><li><a href="/dotnet/system-reflection-emit-namespace.html" class="sidebar-link">System.Reflection.Emit namespace</a></li><li><a href="/dotnet/net-core.html" class="sidebar-link">.NET Core</a></li><li><a href="/dotnet/ado-net.html" class="sidebar-link">ADO.NET</a></li><li><a href="/dotnet/dependency-injection.html" class="sidebar-link">Dependency Injection</a></li><li><a href="/dotnet/platform-invoke.html" class="sidebar-link">Platform Invoke</a></li><li><a href="/dotnet/nuget-packaging-system.html" class="sidebar-link">NuGet packaging system</a></li><li><a href="/dotnet/globalization-in-asp-net-mvc-using-smart-internationalization-for-asp-net.html" class="sidebar-link">Globalization in ASP.NET MVC using Smart internationalization for ASP.NET</a></li><li><a href="/dotnet/system-net-mail.html" class="sidebar-link">System.Net.Mail</a></li><li><a href="/dotnet/using-progress-t-and-iprogress-t.html" class="sidebar-link">Using Progress</a></li><li><a href="/dotnet/json-serialization.html" class="sidebar-link">JSON Serialization</a></li><li><a href="/dotnet/json-in-net-with-newtonsoft-json.html" class="sidebar-link">JSON in .NET with Newtonsoft.Json</a></li><li><a href="/dotnet/xmlserializer.html" class="sidebar-link">XmlSerializer</a></li><li><a href="/dotnet/vb-forms.html" class="sidebar-link">VB Forms</a></li><li><a href="/dotnet/jit-compiler.html" class="sidebar-link">JIT compiler</a></li><li><a href="/dotnet/clr.html" class="sidebar-link">CLR</a></li><li><a href="/dotnet/tpl-dataflow.html" class="sidebar-link">TPL Dataflow</a></li><li><a href="/dotnet/threading.html" class="sidebar-link">Threading</a></li><li><a href="/dotnet/process-and-thread-affinity-setting.html" class="sidebar-link">Process and Thread affinity setting</a></li><li><a href="/dotnet/parallel-processing-using-net-framework.html" class="sidebar-link">Parallel processing using .Net framework</a></li><li><a href="/dotnet/task-parallel-library-tpl.html" class="sidebar-link">Task Parallel Library (TPL)</a></li><li><a href="/dotnet/task-parallel-library-tpl-api-overviews.html" class="sidebar-link">Task Parallel Library (TPL) API Overviews</a></li><li><a href="/dotnet/synchronization-contexts.html" class="sidebar-link">Synchronization Contexts</a></li><li><a href="/dotnet/memory-management.html" class="sidebar-link">Memory management</a></li><li><a href="/dotnet/garbage-collection.html" class="sidebar-link">Garbage Collection</a></li><li><a href="/dotnet/exceptions.html" class="sidebar-link">Exceptions</a></li><li><a href="/dotnet/system-diagnostics.html" aria-current="page" class="active sidebar-link">System.Diagnostics</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dotnet/system-diagnostics.html#stopwatch" class="sidebar-link">Stopwatch</a></li><li class="sidebar-sub-header"><a href="/dotnet/system-diagnostics.html#run-shell-commands" class="sidebar-link">Run shell commands</a></li><li class="sidebar-sub-header"><a href="/dotnet/system-diagnostics.html#send-command-to-cmd-and-receive-output" class="sidebar-link">Send Command to CMD and Receive Output</a></li></ul></li><li><a href="/dotnet/encryption-cryptography.html" class="sidebar-link">Encryption / Cryptography</a></li><li><a href="/dotnet/work-with-sha1-in-c.html" class="sidebar-link">Work with SHA1 in C#</a></li><li><a href="/dotnet/unit-testing.html" class="sidebar-link">Unit testing</a></li><li><a href="/dotnet/write-to-and-read-from-stderr-stream.html" class="sidebar-link">Write to and read from StdErr stream</a></li><li><a href="/dotnet/upload-file-and-post-data-to-webserver.html" class="sidebar-link">Upload file and POST data to webserver</a></li><li><a href="/dotnet/networking.html" class="sidebar-link">Networking</a></li><li><a href="/dotnet/http-servers.html" class="sidebar-link">HTTP servers</a></li><li><a href="/dotnet/http-clients.html" class="sidebar-link">HTTP clients</a></li><li><a href="/dotnet/serial-ports.html" class="sidebar-link">Serial Ports</a></li><li><a href="/dotnet/acronym-glossary.html" class="sidebar-link">Acronym Glossary</a></li><li><a href="/dotnet/work-with-sha1-in-c.html" class="sidebar-link">Work with SHA1 in C#</a></li><li><a href="/dotnet/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="system-diagnostics"><a href="#system-diagnostics" class="header-anchor">#</a> System.Diagnostics</h1> <h2 id="stopwatch"><a href="#stopwatch" class="header-anchor">#</a> Stopwatch</h2> <p>This example shows how <code>Stopwatch</code> can be used to benchmark a block of code.</p> <div class="language-dotnet extra-class"><pre class="language-dotnet"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>            
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Diagnostics</span><span class="token punctuation">;</span>
        
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Benchmark</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IDisposable</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Stopwatch</span> sw<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">Benchmark</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        sw <span class="token operator">=</span> Stopwatch<span class="token punctuation">.</span><span class="token function">StartNew</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        sw<span class="token punctuation">.</span><span class="token function">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>sw<span class="token punctuation">.</span>Elapsed<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> bench <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Benchmark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="run-shell-commands"><a href="#run-shell-commands" class="header-anchor">#</a> Run shell commands</h2> <div class="language-dotnet extra-class"><pre class="language-dotnet"><code><span class="token class-name"><span class="token keyword">string</span></span> strCmdText <span class="token operator">=</span> <span class="token string">&quot;/C copy /b Image1.jpg + Archive.rar Image2.jpg&quot;</span><span class="token punctuation">;</span>
System<span class="token punctuation">.</span>Diagnostics<span class="token punctuation">.</span>Process<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token string">&quot;CMD.exe&quot;</span><span class="token punctuation">,</span>strCmdText<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>This is to hide the cmd window.</p> <div class="language-dotnet extra-class"><pre class="language-dotnet"><code><span class="token class-name">System<span class="token punctuation">.</span>Diagnostics<span class="token punctuation">.</span>Process</span> process <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">System<span class="token punctuation">.</span>Diagnostics<span class="token punctuation">.</span>Process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System<span class="token punctuation">.</span>Diagnostics<span class="token punctuation">.</span>ProcessStartInfo</span> startInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">System<span class="token punctuation">.</span>Diagnostics<span class="token punctuation">.</span>ProcessStartInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
startInfo<span class="token punctuation">.</span>WindowStyle <span class="token operator">=</span> System<span class="token punctuation">.</span>Diagnostics<span class="token punctuation">.</span>ProcessWindowStyle<span class="token punctuation">.</span>Hidden<span class="token punctuation">;</span>
startInfo<span class="token punctuation">.</span>FileName <span class="token operator">=</span> <span class="token string">&quot;cmd.exe&quot;</span><span class="token punctuation">;</span>
startInfo<span class="token punctuation">.</span>Arguments <span class="token operator">=</span> <span class="token string">&quot;/C copy /b Image1.jpg + Archive.rar Image2.jpg&quot;</span><span class="token punctuation">;</span>
process<span class="token punctuation">.</span>StartInfo <span class="token operator">=</span> startInfo<span class="token punctuation">;</span>
process<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="send-command-to-cmd-and-receive-output"><a href="#send-command-to-cmd-and-receive-output" class="header-anchor">#</a> Send Command to CMD and Receive Output</h2> <p>This method allows a <code>command</code> to be sent to <code>Cmd.exe</code>, and returns the standard output (including standard error) as a string:</p> <div class="language-dotnet extra-class"><pre class="language-dotnet"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">SendCommand</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> command<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> cmdOut <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span>
    
    <span class="token class-name"><span class="token keyword">var</span></span> startInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ProcessStartInfo</span><span class="token punctuation">(</span><span class="token string">&quot;cmd&quot;</span><span class="token punctuation">,</span> command<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        WorkingDirectory <span class="token operator">=</span> <span class="token string">@&quot;C:\Windows\System32&quot;</span><span class="token punctuation">,</span> <span class="token comment">// Directory to make the call from</span>
        WindowStyle <span class="token operator">=</span> ProcessWindowStyle<span class="token punctuation">.</span>Hidden<span class="token punctuation">,</span>   <span class="token comment">// Hide the window</span>
        UseShellExecute <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>                   <span class="token comment">// Do not use the OS shell to start the process</span>
        CreateNoWindow <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>                     <span class="token comment">// Start the process in a new window </span>
        RedirectStandardOutput <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>             <span class="token comment">// This is required to get STDOUT</span>
        RedirectStandardError <span class="token operator">=</span> <span class="token boolean">true</span>               <span class="token comment">// This is required to get STDERR</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">var</span></span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Process</span> <span class="token punctuation">{</span>StartInfo <span class="token operator">=</span> startInfo<span class="token punctuation">}</span><span class="token punctuation">;</span>

    p<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    p<span class="token punctuation">.</span>OutputDataReceived <span class="token operator">+=</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> cmdOut <span class="token operator">+=</span> y<span class="token punctuation">.</span>Data<span class="token punctuation">;</span>
    p<span class="token punctuation">.</span>ErrorDataReceived <span class="token operator">+=</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> cmdOut <span class="token operator">+=</span> y<span class="token punctuation">.</span>Data<span class="token punctuation">;</span>
    p<span class="token punctuation">.</span><span class="token function">BeginOutputReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    p<span class="token punctuation">.</span><span class="token function">BeginErrorReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    p<span class="token punctuation">.</span><span class="token function">WaitForExit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> cmdOut<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p><strong>Usage</strong></p> <div class="language-dotnet extra-class"><pre class="language-dotnet"><code><span class="token class-name"><span class="token keyword">var</span></span> servername <span class="token operator">=</span> <span class="token string">&quot;SVR-01.domain.co.za&quot;</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> currentUsers <span class="token operator">=</span> <span class="token function">SendCommand</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;/C QUERY USER /SERVER:</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">servername</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>

</code></pre></div><p><strong>Output</strong></p> <blockquote></blockquote> <p>string currentUsers = &quot;USERNAME              SESSIONNAME        ID  STATE   IDLE TIME  LOGON TIME Joe.Bloggs           ica-cgp#0           2  Active  24692+13:29  25/07/2016 07:50 Jim.McFlannegan             ica-cgp#1           3  Active          .  25/07/2016 08:33 Andy.McAnderson              ica-cgp#2           4  Active          .  25/07/2016 08:54 John.Smith                 ica-cgp#4           5  Active         14  25/07/2016 08:57 Bob.Bobbington                ica-cgp#5           6  Active  24692+13:29  25/07/2016 09:05 Tim.Tom           ica-cgp#6           7  Active          .  25/07/2016 09:08 Bob.Joges       ica-cgp#7           8  Active  24692+13:29  25/07/2016 09:13&quot;</p> <p>On some occasions, access to the server in question may be restricted to certain users. If you have the login credentials for this user, then it is possible to send queries with this method:</p> <div class="language-dotnet extra-class"><pre class="language-dotnet"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">SendCommand</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> command<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> cmdOut <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span>
    
    <span class="token class-name"><span class="token keyword">var</span></span> startInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ProcessStartInfo</span><span class="token punctuation">(</span><span class="token string">&quot;cmd&quot;</span><span class="token punctuation">,</span> command<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        WorkingDirectory <span class="token operator">=</span> <span class="token string">@&quot;C:\Windows\System32&quot;</span><span class="token punctuation">,</span>
        WindowStyle <span class="token operator">=</span> ProcessWindowStyle<span class="token punctuation">.</span>Hidden<span class="token punctuation">,</span>    <span class="token comment">// This does not actually work in conjunction with &quot;runas&quot; - the console window will still appear!</span>
        UseShellExecute <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        CreateNoWindow <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        RedirectStandardOutput <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> 
        RedirectStandardError <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

        Verb <span class="token operator">=</span> <span class="token string">&quot;runas&quot;</span><span class="token punctuation">,</span>
        Domain <span class="token operator">=</span> <span class="token string">&quot;doman1.co.za&quot;</span><span class="token punctuation">,</span>
        UserName <span class="token operator">=</span> <span class="token string">&quot;administrator&quot;</span><span class="token punctuation">,</span>
        Password <span class="token operator">=</span> <span class="token function">GetPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">var</span></span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Process</span> <span class="token punctuation">{</span>StartInfo <span class="token operator">=</span> startInfo<span class="token punctuation">}</span><span class="token punctuation">;</span>

    p<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    p<span class="token punctuation">.</span>OutputDataReceived <span class="token operator">+=</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> cmdOut <span class="token operator">+=</span> y<span class="token punctuation">.</span>Data<span class="token punctuation">;</span>
    p<span class="token punctuation">.</span>ErrorDataReceived <span class="token operator">+=</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> cmdOut <span class="token operator">+=</span> y<span class="token punctuation">.</span>Data<span class="token punctuation">;</span>
    p<span class="token punctuation">.</span><span class="token function">BeginOutputReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    p<span class="token punctuation">.</span><span class="token function">BeginErrorReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    p<span class="token punctuation">.</span><span class="token function">WaitForExit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> cmdOut<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>Getting the password:</p> <div class="language-dotnet extra-class"><pre class="language-dotnet"><code><span class="token keyword">static</span> <span class="token return-type class-name">SecureString</span> <span class="token function">GetPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> plainText <span class="token operator">=</span> <span class="token string">&quot;password123&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> ss <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SecureString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">char</span></span> c <span class="token keyword">in</span> plainText<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        ss<span class="token punctuation">.</span><span class="token function">AppendChar</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> ss<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p><strong>Notes</strong></p> <p>Both of the above methods will return a concatenation of STDOUT and STDERR, as <code>OutputDataReceived</code> and <code>ErrorDataReceived</code> are both appending to the same variable - <code>cmdOut</code>.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/dotnet/system-diagnostics.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/dotnet/exceptions.html" class="prev">
        Exceptions
      </a></span> <span class="next"><a href="/dotnet/encryption-cryptography.html">
        Encryption / Cryptography
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/1025.fa3dbc0f.js" defer></script>
  </body>
</html>
