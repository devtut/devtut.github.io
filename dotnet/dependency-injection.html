<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>.NET Framework - Dependency Injection</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Dependency Injection - Simple example, How Dependency Injection Makes Unit Testing Easier, Why We Use Dependency Injection Containers (IoC Containers)">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content=".NET Framework - Dependency Injection">
    <meta property="og:description" content="Dependency Injection - Simple example, How Dependency Injection Makes Unit Testing Easier, Why We Use Dependency Injection Containers (IoC Containers)">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/dotnet/dependency-injection.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content=".NET Framework - Dependency Injection">
    <meta name="twitter:description" content="Dependency Injection - Simple example, How Dependency Injection Makes Unit Testing Easier, Why We Use Dependency Injection Containers (IoC Containers)">
    <meta name="twitter:url" content="/dotnet/dependency-injection.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/991.043ecc82.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>.NET Framework</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dotnet/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/dotnet/getting-started-with-net-framework.html" class="sidebar-link">Getting started with .NET Framework</a></li><li><a href="/dotnet/strings.html" class="sidebar-link">Strings</a></li><li><a href="/dotnet/datetime-parsing.html" class="sidebar-link">DateTime parsing</a></li><li><a href="/dotnet/dictionaries.html" class="sidebar-link">Dictionaries</a></li><li><a href="/dotnet/collections.html" class="sidebar-link">Collections</a></li><li><a href="/dotnet/readonlycollections.html" class="sidebar-link">ReadOnlyCollections</a></li><li><a href="/dotnet/stack-and-heap.html" class="sidebar-link">Stack and Heap</a></li><li><a href="/dotnet/linq.html" class="sidebar-link">LINQ</a></li><li><a href="/dotnet/foreach.html" class="sidebar-link">ForEach</a></li><li><a href="/dotnet/reflection.html" class="sidebar-link">Reflection</a></li><li><a href="/dotnet/expression-trees.html" class="sidebar-link">Expression Trees</a></li><li><a href="/dotnet/custom-types.html" class="sidebar-link">Custom Types</a></li><li><a href="/dotnet/code-contracts.html" class="sidebar-link">Code Contracts</a></li><li><a href="/dotnet/settings.html" class="sidebar-link">Settings</a></li><li><a href="/dotnet/regular-expressions-system-text-regularexpressions.html" class="sidebar-link">Regular Expressions (System.Text.RegularExpressions)</a></li><li><a href="/dotnet/file-input-output.html" class="sidebar-link">File Input/Output</a></li><li><a href="/dotnet/system-io.html" class="sidebar-link">System.IO</a></li><li><a href="/dotnet/system-io-file-class.html" class="sidebar-link">System.IO.File class</a></li><li><a href="/dotnet/reading-and-writing-zip-files.html" class="sidebar-link">Reading and writing Zip files</a></li><li><a href="/dotnet/managed-extensibility-framework.html" class="sidebar-link">Managed Extensibility Framework</a></li><li><a href="/dotnet/speechrecognitionengine-class-to-recognize-speech.html" class="sidebar-link">SpeechRecognitionEngine class to recognize speech</a></li><li><a href="/dotnet/system-runtime-caching-memorycache-objectcache.html" class="sidebar-link">System.Runtime.Caching.MemoryCache (ObjectCache)</a></li><li><a href="/dotnet/system-reflection-emit-namespace.html" class="sidebar-link">System.Reflection.Emit namespace</a></li><li><a href="/dotnet/net-core.html" class="sidebar-link">.NET Core</a></li><li><a href="/dotnet/ado-net.html" class="sidebar-link">ADO.NET</a></li><li><a href="/dotnet/dependency-injection.html" aria-current="page" class="active sidebar-link">Dependency Injection</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dotnet/dependency-injection.html#dependency-injection-simple-example" class="sidebar-link">Dependency Injection - Simple example</a></li><li class="sidebar-sub-header"><a href="/dotnet/dependency-injection.html#how-dependency-injection-makes-unit-testing-easier" class="sidebar-link">How Dependency Injection Makes Unit Testing Easier</a></li><li class="sidebar-sub-header"><a href="/dotnet/dependency-injection.html#why-we-use-dependency-injection-containers-ioc-containers" class="sidebar-link">Why We Use Dependency Injection Containers (IoC Containers)</a></li></ul></li><li><a href="/dotnet/platform-invoke.html" class="sidebar-link">Platform Invoke</a></li><li><a href="/dotnet/nuget-packaging-system.html" class="sidebar-link">NuGet packaging system</a></li><li><a href="/dotnet/globalization-in-asp-net-mvc-using-smart-internationalization-for-asp-net.html" class="sidebar-link">Globalization in ASP.NET MVC using Smart internationalization for ASP.NET</a></li><li><a href="/dotnet/system-net-mail.html" class="sidebar-link">System.Net.Mail</a></li><li><a href="/dotnet/using-progress-t-and-iprogress-t.html" class="sidebar-link">Using Progress</a></li><li><a href="/dotnet/json-serialization.html" class="sidebar-link">JSON Serialization</a></li><li><a href="/dotnet/json-in-net-with-newtonsoft-json.html" class="sidebar-link">JSON in .NET with Newtonsoft.Json</a></li><li><a href="/dotnet/xmlserializer.html" class="sidebar-link">XmlSerializer</a></li><li><a href="/dotnet/vb-forms.html" class="sidebar-link">VB Forms</a></li><li><a href="/dotnet/jit-compiler.html" class="sidebar-link">JIT compiler</a></li><li><a href="/dotnet/clr.html" class="sidebar-link">CLR</a></li><li><a href="/dotnet/tpl-dataflow.html" class="sidebar-link">TPL Dataflow</a></li><li><a href="/dotnet/threading.html" class="sidebar-link">Threading</a></li><li><a href="/dotnet/process-and-thread-affinity-setting.html" class="sidebar-link">Process and Thread affinity setting</a></li><li><a href="/dotnet/parallel-processing-using-net-framework.html" class="sidebar-link">Parallel processing using .Net framework</a></li><li><a href="/dotnet/task-parallel-library-tpl.html" class="sidebar-link">Task Parallel Library (TPL)</a></li><li><a href="/dotnet/task-parallel-library-tpl-api-overviews.html" class="sidebar-link">Task Parallel Library (TPL) API Overviews</a></li><li><a href="/dotnet/synchronization-contexts.html" class="sidebar-link">Synchronization Contexts</a></li><li><a href="/dotnet/memory-management.html" class="sidebar-link">Memory management</a></li><li><a href="/dotnet/garbage-collection.html" class="sidebar-link">Garbage Collection</a></li><li><a href="/dotnet/exceptions.html" class="sidebar-link">Exceptions</a></li><li><a href="/dotnet/system-diagnostics.html" class="sidebar-link">System.Diagnostics</a></li><li><a href="/dotnet/encryption-cryptography.html" class="sidebar-link">Encryption / Cryptography</a></li><li><a href="/dotnet/work-with-sha1-in-c.html" class="sidebar-link">Work with SHA1 in C#</a></li><li><a href="/dotnet/unit-testing.html" class="sidebar-link">Unit testing</a></li><li><a href="/dotnet/write-to-and-read-from-stderr-stream.html" class="sidebar-link">Write to and read from StdErr stream</a></li><li><a href="/dotnet/upload-file-and-post-data-to-webserver.html" class="sidebar-link">Upload file and POST data to webserver</a></li><li><a href="/dotnet/networking.html" class="sidebar-link">Networking</a></li><li><a href="/dotnet/http-servers.html" class="sidebar-link">HTTP servers</a></li><li><a href="/dotnet/http-clients.html" class="sidebar-link">HTTP clients</a></li><li><a href="/dotnet/serial-ports.html" class="sidebar-link">Serial Ports</a></li><li><a href="/dotnet/acronym-glossary.html" class="sidebar-link">Acronym Glossary</a></li><li><a href="/dotnet/work-with-sha1-in-c.html" class="sidebar-link">Work with SHA1 in C#</a></li><li><a href="/dotnet/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="dependency-injection"><a href="#dependency-injection" class="header-anchor">#</a> Dependency Injection</h1> <h2 id="dependency-injection-simple-example"><a href="#dependency-injection-simple-example" class="header-anchor">#</a> Dependency Injection - Simple example</h2> <p>This class is called <code>Greeter</code>. Its responsibility is to output a greeting. It has two <strong>dependencies</strong>. It needs something that will give it the greeting to output, and then it needs a way to output that greeting. Those dependencies are both described as interfaces, <code>IGreetingProvider</code> and <code>IGreetingWriter</code>. In this example, those two dependencies are &quot;injected&quot; into <code>Greeter</code>. (Further explanation following the example.)</p> <div class="language-dotnet extra-class"><pre class="language-dotnet"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Greeter</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IGreetingProvider</span> _greetingProvider<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IGreetingWriter</span> _greetingWriter<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">Greeter</span><span class="token punctuation">(</span><span class="token class-name">IGreetingProvider</span> greetingProvider<span class="token punctuation">,</span> <span class="token class-name">IGreetingWriter</span> greetingWriter<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _greetingProvider <span class="token operator">=</span> greetingProvider<span class="token punctuation">;</span>
        _greetingWriter <span class="token operator">=</span> greetingWriter<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> greeting <span class="token operator">=</span> _greetingProvider<span class="token punctuation">.</span><span class="token function">GetGreeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        _greetingWriter<span class="token punctuation">.</span><span class="token function">WriteGreeting</span><span class="token punctuation">(</span>greeting<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IGreetingProvider</span>
<span class="token punctuation">{</span>
    <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GetGreeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IGreetingWriter</span>
<span class="token punctuation">{</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">WriteGreeting</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> greeting<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>The <code>Greeting</code> class depends on both <code>IGreetingProvider</code> and <code>IGreetingWriter</code>, but it is not responsible for creating instances of either. Instead it requires them in its constructor. Whatever creates an instance of <code>Greeting</code> must provide those two dependencies. We can call that &quot;injecting&quot; the dependencies.</p> <p>Because dependencies are provided to the class in its constructor, this is also called &quot;constructor injection.&quot;</p> <p>A few common conventions:</p> <ul><li>The constructor saves the dependencies as <code>private</code> fields. As soon as the class is instantiated, those dependencies are available to all other non-static methods of the class.</li> <li>The <code>private</code> fields are <code>readonly</code>. Once they are set in the constructor they cannot be changed. This indicates that those fields should not (and cannot) be modified outside of the constructor. That further ensures that those dependencies will be available for the lifetime of the class.</li> <li>The dependencies are interfaces. This is not strictly necessary, but is common because it makes it easier to substitute one implementation of the dependency with another. It also allows providing a mocked version of the interface for unit testing purposes.</li></ul> <h2 id="how-dependency-injection-makes-unit-testing-easier"><a href="#how-dependency-injection-makes-unit-testing-easier" class="header-anchor">#</a> How Dependency Injection Makes Unit Testing Easier</h2> <p>This builds on the previous example of the <code>Greeter</code> class which has two dependencies, <code>IGreetingProvider</code> and <code>IGreetingWriter</code>.</p> <p>The actual implementation of <code>IGreetingProvider</code> might retrieve a string from an API call or a database. The implementation of <code>IGreetingWriter</code> might display the greeting in the console. But because <code>Greeter</code> has its dependencies injected into its constructor, it's easy to write a unit test that injects mocked versions of those interfaces. In real life we might use a framework like <a href="http://www.moqthis.com/" target="_blank" rel="noopener noreferrer">Moq<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, but in this case I'll write those mocked implementations.</p> <div class="language-dotnet extra-class"><pre class="language-dotnet"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestGreetingProvider</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IGreetingProvider</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">string</span></span> TestGreeting <span class="token operator">=</span> <span class="token string">&quot;Hello!&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GetGreeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> TestGreeting<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestGreetingWriter</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">IGreetingWriter</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">WriteGreeting</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> greeting<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">Add</span><span class="token punctuation">(</span>greeting<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">TestClass</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GreeterTests</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">TestMethod</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Greeter_WritesGreeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> greetingProvider <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TestGreetingProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> greetingWriter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TestGreetingWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> greeter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Greeter</span><span class="token punctuation">(</span>greetingProvider<span class="token punctuation">,</span> greetingWriter<span class="token punctuation">)</span><span class="token punctuation">;</span>
        greeter<span class="token punctuation">.</span><span class="token function">Greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Assert<span class="token punctuation">.</span><span class="token function">AreEqual</span><span class="token punctuation">(</span>greetingWriter<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> TestGreetingProvider<span class="token punctuation">.</span>TestGreeting<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>The behavior of <code>IGreetingProvider</code> and <code>IGreetingWriter</code> are not relevant to this test. We want to test that <code>Greeter</code> gets a greeting and writes it. The design of <code>Greeter</code> (using dependency injection) allows us to inject mocked dependencies without any complicated moving parts. All we're testing is that <code>Greeter</code> interacts with those dependencies as we expect it to.</p> <h2 id="why-we-use-dependency-injection-containers-ioc-containers"><a href="#why-we-use-dependency-injection-containers-ioc-containers" class="header-anchor">#</a> Why We Use Dependency Injection Containers (IoC Containers)</h2> <p>Dependency injection means writing classes so that they do not control their dependencies - instead, their dependencies are provided to them (&quot;injected.&quot;)</p> <p>This is not the same thing as using a dependency injection framework (often called a &quot;DI container&quot;, &quot;IoC container&quot;, or just &quot;container&quot;) like Castle Windsor, Autofac, SimpleInjector, Ninject, Unity, or others.</p> <p>A container just makes dependency injection easier. For example, suppose you write a number of classes that rely on dependency injection. One class depends on several interfaces, the classes that implement those interfaces depend on other interfaces, and so on. Some depend on specific values. And just for fun, some of those classes implement <code>IDisposable</code> and need to be disposed.</p> <p>Each individual class is well-written and easy to test. But now there's a different problem: Creating an instance of a class has become much more complicated. Suppose we're creating an instance of a <code>CustomerService</code> class. It has dependencies and its dependencies have dependencies. Constructing an instance might look something like this:</p> <div class="language-dotnet extra-class"><pre class="language-dotnet"><code><span class="token keyword">public</span> <span class="token return-type class-name">CustomerData</span> <span class="token function">GetCustomerData</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> customerNumber<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> customerApiEndpoint <span class="token operator">=</span> ConfigurationManager<span class="token punctuation">.</span>AppSettings<span class="token punctuation">[</span><span class="token string">&quot;customerApi:customerApiEndpoint&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> logFilePath <span class="token operator">=</span> ConfigurationManager<span class="token punctuation">.</span>AppSettings<span class="token punctuation">[</span><span class="token string">&quot;logwriter:logFilePath&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> authConnectionString <span class="token operator">=</span> ConfigurationManager<span class="token punctuation">.</span>ConnectionStrings<span class="token punctuation">[</span><span class="token string">&quot;authorization&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ConnectionString<span class="token punctuation">;</span>
    <span class="token keyword">using</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> logWriter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">LogWriter</span><span class="token punctuation">(</span>logFilePath <span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">using</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> customerApiClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CustomerApiClient</span><span class="token punctuation">(</span>customerApiEndpoint<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> customerService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CustomerService</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlAuthorizationRepository</span><span class="token punctuation">(</span>authorizationConnectionString<span class="token punctuation">,</span> logWriter<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CustomerDataRepository</span><span class="token punctuation">(</span>customerApiClient<span class="token punctuation">,</span> logWriter<span class="token punctuation">)</span><span class="token punctuation">,</span>
                logWriter
            <span class="token punctuation">)</span><span class="token punctuation">;</span>   
            
            <span class="token comment">// All this just to create an instance of CustomerService!         </span>
            <span class="token keyword">return</span> customerService<span class="token punctuation">.</span><span class="token function">GetCustomerData</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> customerNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>You might wonder, why not put the whole giant construction in a separate function that just returns <code>CustomerService</code>? One reason is that because the dependencies for each class are injected into it, a class isn't responsible for knowing whether those dependencies are <code>IDisposable</code> or disposing them. It just uses them. So if a we had a <code>GetCustomerService()</code> function that returned a fully-constructed <code>CustomerService</code>, that class might contain a number of disposable resources and no way to access or dispose them.</p> <p>And aside from disposing <code>IDisposable</code>, who wants to call a series of nested constructors like that, ever? That's a short example. It could get much, much worse. Again, that doesn't mean that we wrote the classes the wrong way. The classes might be individually perfect. The challenge is composing them together.</p> <p>A dependency injection container simplifies that. It allows us to specify which class or value should be used to fulfill each dependency. This slightly oversimplified example uses Castle Windsor:</p> <div class="language-dotnet extra-class"><pre class="language-dotnet"><code><span class="token class-name"><span class="token keyword">var</span></span> container <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WindsorContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
container<span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span>
    Component<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">For</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>CustomerService<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Component<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">For</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ILogWriter<span class="token punctuation">,</span> LogWriter<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">DependsOn</span><span class="token punctuation">(</span>Dependency<span class="token punctuation">.</span><span class="token function">OnAppSettingsValue</span><span class="token punctuation">(</span><span class="token string">&quot;logFilePath&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;logWriter:logFilePath&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Component<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">For</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IAuthorizationRepository<span class="token punctuation">,</span> SqlAuthorizationRepository<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">DependsOn</span><span class="token punctuation">(</span>Dependency<span class="token punctuation">.</span><span class="token function">OnValue</span><span class="token punctuation">(</span>connectionString<span class="token punctuation">,</span> ConfigurationManager<span class="token punctuation">.</span>ConnectionStrings<span class="token punctuation">[</span><span class="token string">&quot;authorization&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ConnectionString<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Component<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">For</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ICustomerDataProvider<span class="token punctuation">,</span> CustomerApiClient<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token function">DependsOn</span><span class="token punctuation">(</span>Dependency<span class="token punctuation">.</span><span class="token function">OnAppSettingsValue</span><span class="token punctuation">(</span><span class="token string">&quot;apiEndpoint&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;customerApi:customerApiEndpoint&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   
<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>We call this &quot;registering dependencies&quot; or &quot;configuring the container.&quot; Translated, this tells our <code>WindsorContainer</code>:</p> <ul><li>If a class requires <code>ILogWriter</code>, create an instance of <code>LogWriter</code>. <code>LogWriter</code> requires a file path. Use this value from <code>AppSettings</code>.</li> <li>If a class requires <code>IAuthorizationRepository</code>, create an instance of <code>SqlAuthorizationRepository</code>. It requires a connection string. Use this value from the <code>ConnectionStrings</code> section.</li> <li>If a class requires <code>ICustomerDataProvider</code>, create a <code>CustomerApiClient</code> and provide the string it needs from <code>AppSettings</code>.</li></ul> <p>When we request a dependency from the container we call that &quot;resolving&quot; a dependency. It's bad practice to do that directly using the container, but that's a different story. For demonstration purposes, we could now do this:</p> <div class="language-dotnet extra-class"><pre class="language-dotnet"><code><span class="token class-name"><span class="token keyword">var</span></span> customerService <span class="token operator">=</span> container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Resolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>CustomerService<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> data <span class="token operator">=</span> customerService<span class="token punctuation">.</span><span class="token function">GetCustomerData</span><span class="token punctuation">(</span>customerNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>
container<span class="token punctuation">.</span><span class="token function">Release</span><span class="token punctuation">(</span>customerService<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>The container knows that <code>CustomerService</code> depends on <code>IAuthorizationRepository</code> and <code>ICustomerDataProvider</code>. It knows what classes it needs to create to fulfill those requirements. Those classes, in turn, have more dependencies, and the container knows how to fulfill those. It will create every class it needs to until it can return an instance of <code>CustomerService</code>.</p> <p>If it gets to a point where a class requires a dependency that we haven't registered, like <code>IDoesSomethingElse</code>, then when we try to resolve <code>CustomerService</code> it will throw a clear exception telling us that we haven't registered anything to fulfill that requirement.</p> <p>Each DI framework behaves a little differently, but typically they give us some control over how certain classes are instantiated. For example, do we want it to create one instance of <code>LogWriter</code> and provide it to every class that depends on <code>ILogWriter</code>, or do we want it to create a new one every time? Most containers have a way to specify that.</p> <p>What about classes that implement <code>IDisposable</code>? That's why we call <code>container.Release(customerService);</code> at the end. Most containers (including Windsor) will step back through all of the dependencies created and <code>Dispose</code> the ones that need disposing. If <code>CustomerService</code> is <code>IDisposable</code> it will dispose that too.</p> <p>Registering dependencies as seen above might just look like more code to write. But when we have lots of classes with lots of dependencies then it really pays off. And if we had to write those same classes <strong>without</strong> using dependency injection then that same application with lots of classes would become difficult to maintain and test.</p> <p>This scratches the surface of <strong>why</strong> we use dependency injection containers. <strong>How</strong> we configure our application to use one (and use it correctly) is not just one topic - it's a number of topics, as the instructions and examples vary from one container to the next.</p> <h4 id="remarks"><a href="#remarks" class="header-anchor">#</a> Remarks</h4> <p><strong>Problems Solved By Dependency Injection</strong></p> <p>If we didn't use dependency injection, the <code>Greeter</code> class might look more like this:</p> <div class="language-dotnet extra-class"><pre class="language-dotnet"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ControlFreakGreeter</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> greetingProvider <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlGreetingProvider</span><span class="token punctuation">(</span>
            ConfigurationManager<span class="token punctuation">.</span>ConnectionStrings<span class="token punctuation">[</span><span class="token string">&quot;myConnectionString&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ConnectionString<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> greeting <span class="token operator">=</span> greetingProvider<span class="token punctuation">.</span><span class="token function">GetGreeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>greeting<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>It's a &quot;control freak&quot; because it controls creating the class that provides the greeting, it controls where the SQL connection string comes from, and it controls the output.</p> <p>Using dependency injection, the <code>Greeter</code> class relinquishes those responsibilities in favor of a single responsibility, writing a greeting provided to it.</p> <p>The <a href="https://en.wikipedia.org/wiki/Dependency_inversion_principle" target="_blank" rel="noopener noreferrer">Dependency Inversion Principle<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> suggests that classes should depend on abstractions (like interfaces) rather than on other concrete classes. Direct dependencies (coupling) between classes can make maintenance progressively difficult. Depending on abstractions can reduce that coupling.</p> <p>Dependency injection helps us to achieve that dependency inversion because it leads to writing classes that depend on abstractions. The <code>Greeter</code> class &quot;knows&quot; nothing at all of the implementation details of <code>IGreetingProvider</code> and <code>IGreetingWriter</code>. It only knows that the injected dependencies implement those interfaces. That means that changes to the concrete classes that implement <code>IGreetingProvider</code> and <code>IGreetingWriter</code> will not affect <code>Greeter</code>. Neither will replacing them with entirely different implementations. Only changes to the interfaces will. <code>Greeter</code> is decoupled.</p> <p><code>ControlFreakGreeter</code> is impossible to properly unit test. We want to test one small unit of code, but instead our test would include connecting to SQL and executing a stored procedure. It would also include testing the console output. Because ControlFreakGreeter does so much it's impossible to test in isolation from other classes.</p> <p><code>Greeter</code> is easy to unit test because we can inject mocked implementations of its dependencies that are easier to execute and verify than calling a stored procedure or reading the output of the console. It doesn't require a connection string in app.config.</p> <p>The concrete implementations of <code>IGreetingProvider</code> and <code>IGreetingWriter</code> might become more complex. They, in turn might have their own dependencies which are injected into them. (For example, we'd inject the SQL connection string into <code>SqlGreetingProvider</code>.) But that complexity is &quot;hidden&quot; from other classes which only depend on the interfaces. That makes it easier to modify one class without a &quot;ripple effect&quot; that requires us to make corresponding changes to other classes.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/dotnet/dependency-injection.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/dotnet/ado-net.html" class="prev">
        ADO.NET
      </a></span> <span class="next"><a href="/dotnet/platform-invoke.html">
        Platform Invoke
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/991.043ecc82.js" defer></script>
  </body>
</html>
