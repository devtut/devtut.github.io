<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>.NET Framework - ADO.NET</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Best Practices - Executing Sql Statements, Executing SQL statements as a command, Using common interfaces to abstract away vendor specific classes">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content=".NET Framework - ADO.NET">
    <meta property="og:description" content="Best Practices - Executing Sql Statements, Executing SQL statements as a command, Using common interfaces to abstract away vendor specific classes">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/dotnet/ado-net.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content=".NET Framework - ADO.NET">
    <meta name="twitter:description" content="Best Practices - Executing Sql Statements, Executing SQL statements as a command, Using common interfaces to abstract away vendor specific classes">
    <meta name="twitter:url" content="/dotnet/ado-net.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    <link rel="preload" href="/assets/css/0.styles.8b877eb8.css" as="style"><link rel="preload" href="/assets/js/app.ced448ab.js" as="script"><link rel="preload" href="/assets/js/3.f1d73125.js" as="script"><link rel="preload" href="/assets/js/982.c325eb19.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.8b877eb8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>.NET Framework</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dotnet/" class="sidebar-link">Disclaimer</a></li><li><a href="/dotnet/getting-started-with-net-framework.html" class="sidebar-link">Getting started with .NET Framework</a></li><li><a href="/dotnet/strings.html" class="sidebar-link">Strings</a></li><li><a href="/dotnet/datetime-parsing.html" class="sidebar-link">DateTime parsing</a></li><li><a href="/dotnet/dictionaries.html" class="sidebar-link">Dictionaries</a></li><li><a href="/dotnet/collections.html" class="sidebar-link">Collections</a></li><li><a href="/dotnet/readonlycollections.html" class="sidebar-link">ReadOnlyCollections</a></li><li><a href="/dotnet/stack-and-heap.html" class="sidebar-link">Stack and Heap</a></li><li><a href="/dotnet/linq.html" class="sidebar-link">LINQ</a></li><li><a href="/dotnet/foreach.html" class="sidebar-link">ForEach</a></li><li><a href="/dotnet/reflection.html" class="sidebar-link">Reflection</a></li><li><a href="/dotnet/expression-trees.html" class="sidebar-link">Expression Trees</a></li><li><a href="/dotnet/custom-types.html" class="sidebar-link">Custom Types</a></li><li><a href="/dotnet/code-contracts.html" class="sidebar-link">Code Contracts</a></li><li><a href="/dotnet/settings.html" class="sidebar-link">Settings</a></li><li><a href="/dotnet/regular-expressions-system-text-regularexpressions.html" class="sidebar-link">Regular Expressions (System.Text.RegularExpressions)</a></li><li><a href="/dotnet/file-input-output.html" class="sidebar-link">File Input/Output</a></li><li><a href="/dotnet/system-io.html" class="sidebar-link">System.IO</a></li><li><a href="/dotnet/system-io-file-class.html" class="sidebar-link">System.IO.File class</a></li><li><a href="/dotnet/reading-and-writing-zip-files.html" class="sidebar-link">Reading and writing Zip files</a></li><li><a href="/dotnet/managed-extensibility-framework.html" class="sidebar-link">Managed Extensibility Framework</a></li><li><a href="/dotnet/speechrecognitionengine-class-to-recognize-speech.html" class="sidebar-link">SpeechRecognitionEngine class to recognize speech</a></li><li><a href="/dotnet/system-runtime-caching-memorycache-objectcache.html" class="sidebar-link">System.Runtime.Caching.MemoryCache (ObjectCache)</a></li><li><a href="/dotnet/system-reflection-emit-namespace.html" class="sidebar-link">System.Reflection.Emit namespace</a></li><li><a href="/dotnet/net-core.html" class="sidebar-link">.NET Core</a></li><li><a href="/dotnet/ado-net.html" class="active sidebar-link">ADO.NET</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dotnet/ado-net.html#best-practices-executing-sql-statements" class="sidebar-link">Best Practices - Executing Sql Statements</a></li><li class="sidebar-sub-header"><a href="/dotnet/ado-net.html#executing-sql-statements-as-a-command" class="sidebar-link">Executing SQL statements as a command</a></li><li class="sidebar-sub-header"><a href="/dotnet/ado-net.html#using-common-interfaces-to-abstract-away-vendor-specific-classes" class="sidebar-link">Using common interfaces to abstract away vendor specific classes</a></li></ul></li><li><a href="/dotnet/dependency-injection.html" class="sidebar-link">Dependency Injection</a></li><li><a href="/dotnet/platform-invoke.html" class="sidebar-link">Platform Invoke</a></li><li><a href="/dotnet/nuget-packaging-system.html" class="sidebar-link">NuGet packaging system</a></li><li><a href="/dotnet/globalization-in-asp-net-mvc-using-smart-internationalization-for-asp-net.html" class="sidebar-link">Globalization in ASP.NET MVC using Smart internationalization for ASP.NET</a></li><li><a href="/dotnet/system-net-mail.html" class="sidebar-link">System.Net.Mail</a></li><li><a href="/dotnet/using-progress-t-and-iprogress-t.html" class="sidebar-link">Using Progress</a></li><li><a href="/dotnet/json-serialization.html" class="sidebar-link">JSON Serialization</a></li><li><a href="/dotnet/json-in-net-with-newtonsoft-json.html" class="sidebar-link">JSON in .NET with Newtonsoft.Json</a></li><li><a href="/dotnet/xmlserializer.html" class="sidebar-link">XmlSerializer</a></li><li><a href="/dotnet/vb-forms.html" class="sidebar-link">VB Forms</a></li><li><a href="/dotnet/jit-compiler.html" class="sidebar-link">JIT compiler</a></li><li><a href="/dotnet/clr.html" class="sidebar-link">CLR</a></li><li><a href="/dotnet/tpl-dataflow.html" class="sidebar-link">TPL Dataflow</a></li><li><a href="/dotnet/threading.html" class="sidebar-link">Threading</a></li><li><a href="/dotnet/process-and-thread-affinity-setting.html" class="sidebar-link">Process and Thread affinity setting</a></li><li><a href="/dotnet/parallel-processing-using-net-framework.html" class="sidebar-link">Parallel processing using .Net framework</a></li><li><a href="/dotnet/task-parallel-library-tpl.html" class="sidebar-link">Task Parallel Library (TPL)</a></li><li><a href="/dotnet/task-parallel-library-tpl-api-overviews.html" class="sidebar-link">Task Parallel Library (TPL) API Overviews</a></li><li><a href="/dotnet/synchronization-contexts.html" class="sidebar-link">Synchronization Contexts</a></li><li><a href="/dotnet/memory-management.html" class="sidebar-link">Memory management</a></li><li><a href="/dotnet/garbage-collection.html" class="sidebar-link">Garbage Collection</a></li><li><a href="/dotnet/exceptions.html" class="sidebar-link">Exceptions</a></li><li><a href="/dotnet/system-diagnostics.html" class="sidebar-link">System.Diagnostics</a></li><li><a href="/dotnet/encryption-cryptography.html" class="sidebar-link">Encryption / Cryptography</a></li><li><a href="/dotnet/work-with-sha1-in-c.html" class="sidebar-link">Work with SHA1 in C#</a></li><li><a href="/dotnet/unit-testing.html" class="sidebar-link">Unit testing</a></li><li><a href="/dotnet/write-to-and-read-from-stderr-stream.html" class="sidebar-link">Write to and read from StdErr stream</a></li><li><a href="/dotnet/upload-file-and-post-data-to-webserver.html" class="sidebar-link">Upload file and POST data to webserver</a></li><li><a href="/dotnet/networking.html" class="sidebar-link">Networking</a></li><li><a href="/dotnet/http-servers.html" class="sidebar-link">HTTP servers</a></li><li><a href="/dotnet/http-clients.html" class="sidebar-link">HTTP clients</a></li><li><a href="/dotnet/serial-ports.html" class="sidebar-link">Serial Ports</a></li><li><a href="/dotnet/acronym-glossary.html" class="sidebar-link">Acronym Glossary</a></li><li><a href="/dotnet/work-with-sha1-in-c.html" class="sidebar-link">Work with SHA1 in C#</a></li><li><a href="/dotnet/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ado-net"><a href="#ado-net" class="header-anchor">#</a> ADO.NET</h1> <p>ADO(ActiveX Data Objects).Net is a tool provided by Microsoft which provides access to data sources such as SQL Server, Oracle, and XML through its components. .Net front-end applications can retrieve, create, and manipulate data, once they are connected to a data source through ADO.Net with appropriate privileges.</p> <p>ADO.Net provides a connection-less architecture. It is a secure approach to interact with a database, since, the connection doesn't have to be maintained during the entire session.</p> <h2 id="best-practices-executing-sql-statements"><a href="#best-practices-executing-sql-statements" class="header-anchor">#</a> Best Practices - Executing Sql Statements</h2> <div class="language-dotnet extra-class"><pre class="language-dotnet"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SaveNewEmployee</span><span class="token punctuation">(</span><span class="token class-name">Employee</span> newEmployee<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// best practice - wrap all database connections in a using block so they are always closed &amp; disposed even in the event of an Exception</span>
    <span class="token comment">// best practice - retrieve the connection string by name from the app.config or web.config (depending on the application type) (note, this requires an assembly reference to System.configuration)</span>
    <span class="token keyword">using</span><span class="token punctuation">(</span><span class="token class-name">SqlConnection</span> con <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>Configuration<span class="token punctuation">.</span>ConfigurationManager<span class="token punctuation">.</span>ConnectionStrings<span class="token punctuation">[</span><span class="token string">&quot;MyConnectionName&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ConnectionString<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// best practice - use column names in your INSERT statement so you are not dependent on the sql schema column order</span>
        <span class="token comment">// best practice - always use parameters to avoid sql injection attacks and errors if malformed text is used like including a single quote which is the sql equivalent of escaping or starting a string (varchar/nvarchar)</span>
        <span class="token comment">// best practice - give your parameters meaningful names just like you do variables in your code</span>
        <span class="token keyword">using</span><span class="token punctuation">(</span><span class="token class-name">SqlCommand</span> sc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlCommand</span><span class="token punctuation">(</span><span class="token string">&quot;INSERT INTO employee (FirstName, LastName, DateOfBirth /*etc*/) VALUES (@firstName, @lastName, @dateOfBirth /*etc*/)&quot;</span><span class="token punctuation">,</span> con<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// best practice - always specify the database data type of the column you are using</span>
            <span class="token comment">// best practice - check for valid values in your code and/or use a database constraint, if inserting NULL then use System.DbNull.Value</span>
            sc<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlParameter</span><span class="token punctuation">(</span><span class="token string">&quot;@firstName&quot;</span><span class="token punctuation">,</span> SqlDbType<span class="token punctuation">.</span>VarChar<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">{</span>Value <span class="token operator">=</span> newEmployee<span class="token punctuation">.</span>FirstName <span class="token operator">??</span> <span class="token punctuation">(</span><span class="token keyword">object</span><span class="token punctuation">)</span> System<span class="token punctuation">.</span>DBNull<span class="token punctuation">.</span>Value<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            sc<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlParameter</span><span class="token punctuation">(</span><span class="token string">&quot;@lastName&quot;</span><span class="token punctuation">,</span> SqlDbType<span class="token punctuation">.</span>VarChar<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">{</span>Value <span class="token operator">=</span> newEmployee<span class="token punctuation">.</span>LastName <span class="token operator">??</span> <span class="token punctuation">(</span><span class="token keyword">object</span><span class="token punctuation">)</span> System<span class="token punctuation">.</span>DBNull<span class="token punctuation">.</span>Value<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// best practice - always use the correct types when specifying your parameters, Value is assigned to a DateTime instance and not a string representation of a Date</span>
            sc<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlParameter</span><span class="token punctuation">(</span><span class="token string">&quot;@dateOfBirth&quot;</span><span class="token punctuation">,</span> SqlDbType<span class="token punctuation">.</span>Date<span class="token punctuation">)</span><span class="token punctuation">{</span> Value <span class="token operator">=</span> newEmployee<span class="token punctuation">.</span>DateOfBirth <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// best practice - open your connection as late as possible unless you need to verify that the database connection is valid and wont fail and the proceeding code execution takes a long time (not the case here)</span>
            con<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            sc<span class="token punctuation">.</span><span class="token function">ExecuteNonQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// the end of the using block will close and dispose the SqlConnection</span>
        <span class="token comment">// best practice - end the using block as soon as possible to release the database connection</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// supporting class used as parameter for example</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Employee</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> FirstName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> LastName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> DateOfBirth <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="best-practice-for-working-with-ado-net"><a href="#best-practice-for-working-with-ado-net" class="header-anchor">#</a> Best practice for working with <a href="https://msdn.microsoft.com/en-us/library/h43ks021(v=vs.110).aspx" target="_blank" rel="noopener noreferrer">ADO.NET<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <ul><li><p>Rule of thumb is to open connection for minimal time. Close the connection explicitly once your procedure execution is over this will return the connection object back to connection pool. Default connection pool max size = 100. As connection pooling enhances the performance of physical connection to SQL Server.<a href="https://msdn.microsoft.com/en-us/library/8xx3tyca(v=vs.110).aspx" target="_blank" rel="noopener noreferrer">Connection Pooling in SQL Server<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p>Wrap all database connections in a using block so they are always closed &amp; disposed even in the event of an Exception. See <a href="https://msdn.microsoft.com/en-us/library/yh598w02.aspx" target="_blank" rel="noopener noreferrer">using Statement (C# Reference)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for more information on using statements
</p></li><li>Retrieve the connection strings by name from the app.config or web.config (depending on the application type)
<ul><p></p></ul></li> <li><p>This requires an assembly reference to <code>System.configuration</code></p></li> <li><p>See <a href="https://msdn.microsoft.com/en-us/library/ms254494(v=vs.110).aspx" target="_blank" rel="noopener noreferrer">Connection Strings and Configuration Files<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for additional information on how to structure your configuration file</p></li> <li><p>Avoid <a href="https://en.wikipedia.org/wiki/SQL_injection" target="_blank" rel="noopener noreferrer">sql injection<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> attacks</p></li> <li><p>Avoid errors if malformed text is used like including a single quote which is the sql equivalent of escaping or starting a string (varchar/nvarchar)</p></li> <li><p>Letting the database provider reuse query plans (not supported by all database providers) which increases efficiency</p></li> <li><p>Sql parameters type and size mismatch is a common cause of insert/ updated/ select failure</p></li> <li><p>Give your Sql parameters meaningful names just like you do variables in your code</p></li> <li><p>Specify the database data type of the column you are using, this ensures the wrong parameter types is not used which could lead to unexpected results</p></li> <li><p>Validate your incoming parameters before you pass them into the command (as the saying goes, &quot;<a href="https://en.wikipedia.org/wiki/Garbage_in,_garbage_out" target="_blank" rel="noopener noreferrer">garbage in, garbage out<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>&quot;). Validate incoming values as early as possible in the stack</p></li> <li><p>Use the correct types when assigning your parameter values, example: do not assign the string value of a DateTime, instead assign an actual DateTime instance to the value of the parameter</p></li> <li><p>Specify the <a href="https://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlparameter.size(v=vs.110).aspx" target="_blank" rel="noopener noreferrer">size<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> of string-type parameters. This is because SQL Server can re-use execution plans if the parameters match in type <strong>and</strong> size. Use -1 for MAX</p></li> <li><p>Do not use the method <a href="https://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlparametercollection.addwithvalue(v=vs.110).aspx" target="_blank" rel="noopener noreferrer">AddWithValue<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, the main reason is it is very easy to forget to specify the parameter type or the precision/scale when needed. For additional information see <a href="http://blogs.msmvps.com/jcoehoorn/blog/2014/05/12/can-we-stop-using-addwithvalue-already/" target="_blank" rel="noopener noreferrer">Can we stop using AddWithValue already?<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p>Open the connection as late as possible and close it as soon as possible. This is a general guideline when working with any external resource
</p></li><li>Never share database connection instances (example: having a singleton host a shared instance of type <code>SqlConnection</code>). Have your code always create a new database connection instance when needed and then have the calling code dispose of it and &quot;throw it away&quot; when it is done. The reason for this is
<ul><p></p></ul></li> <li><p>Most database providers have some sort of connection pooling so creating new managed connections is cheap</p></li> <li><p>It eliminates any future errors if the code starts working with multiple threads</p></li></ul> <h2 id="executing-sql-statements-as-a-command"><a href="#executing-sql-statements-as-a-command" class="header-anchor">#</a> Executing SQL statements as a command</h2> <div class="language-dotnet extra-class"><pre class="language-dotnet"><code><span class="token comment">// Uses Windows authentication. Replace the Trusted_Connection parameter with</span>
<span class="token comment">// User Id=...;Password=...; to use SQL Server authentication instead. You may</span>
<span class="token comment">// want to find the appropriate connection string for your server.</span>
<span class="token class-name"><span class="token keyword">string</span></span> connectionString <span class="token operator">=</span> <span class="token string">@&quot;Server=myServer\myInstance;Database=myDataBase;Trusted_Connection=True;&quot;</span>

<span class="token class-name"><span class="token keyword">string</span></span> sql <span class="token operator">=</span> <span class="token string">&quot;INSERT INTO myTable (myDateTimeField, myIntField) &quot;</span> <span class="token operator">+</span>
    <span class="token string">&quot;VALUES (@someDateTime, @someInt);&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// Most ADO.NET objects are disposable and, thus, require the using keyword.</span>
<span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span>connectionString<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> command <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlCommand</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Use parameters instead of string concatenation to add user-supplied</span>
    <span class="token comment">// values to avoid SQL injection and formatting issues. Explicitly supply datatype.</span>

    <span class="token comment">// System.Data.SqlDbType is an enumeration. See Note1</span>
    command<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;@someDateTime&quot;</span><span class="token punctuation">,</span> SqlDbType<span class="token punctuation">.</span>DateTime<span class="token punctuation">)</span><span class="token punctuation">.</span>Value <span class="token operator">=</span> myDateTimeVariable<span class="token punctuation">;</span>
    command<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;@someInt&quot;</span><span class="token punctuation">,</span> SqlDbType<span class="token punctuation">.</span>Int<span class="token punctuation">)</span><span class="token punctuation">.</span>Value <span class="token operator">=</span> myInt32Variable<span class="token punctuation">;</span>

    <span class="token comment">// Execute the SQL statement. Use ExecuteScalar and ExecuteReader instead</span>
    <span class="token comment">// for query that return results (or see the more specific examples, once</span>
    <span class="token comment">// those have been added).</span>

    connection<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    command<span class="token punctuation">.</span><span class="token function">ExecuteNonQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p><strong><strong>Note 1:</strong></strong> Please see <a href="https://msdn.microsoft.com/en-us/library/system.data.sqldbtype(v=vs.110).aspx" target="_blank" rel="noopener noreferrer">SqlDbType Enumeration<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for the MSFT SQL Server-specific variation.</p> <p><strong><strong>Note 2:</strong></strong> Please see <a href="https://dev.mysql.com/doc/dev/connector-net/html/T_MySql_Data_MySqlClient_MySqlDbType.htm" target="_blank" rel="noopener noreferrer">MySqlDbType Enumeration<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for the MySQL-specific variation.</p> <h2 id="using-common-interfaces-to-abstract-away-vendor-specific-classes"><a href="#using-common-interfaces-to-abstract-away-vendor-specific-classes" class="header-anchor">#</a> Using common interfaces to abstract away vendor specific classes</h2> <div class="language-dotnet extra-class"><pre class="language-dotnet"><code><span class="token class-name"><span class="token keyword">var</span></span> providerName <span class="token operator">=</span> <span class="token string">&quot;System.Data.SqlClient&quot;</span><span class="token punctuation">;</span>    <span class="token comment">//Oracle.ManagedDataAccess.Client, IBM.Data.DB2</span>
<span class="token class-name"><span class="token keyword">var</span></span> connectionString <span class="token operator">=</span> <span class="token string">&quot;{your-connection-string}&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//you will probably get the above two values in the ConnectionStringSettings object from .config file</span>

<span class="token class-name"><span class="token keyword">var</span></span> factory <span class="token operator">=</span> DbProviderFactories<span class="token punctuation">.</span><span class="token function">GetFactory</span><span class="token punctuation">(</span>providerName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">using</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">CreateConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">//IDbConnection</span>
    connection<span class="token punctuation">.</span>ConnectionString <span class="token operator">=</span> connectionString<span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">using</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> command <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">CreateCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">//IDbCommand</span>
        command<span class="token punctuation">.</span>CommandText <span class="token operator">=</span> <span class="token string">&quot;{query}&quot;</span><span class="token punctuation">;</span>
        
        <span class="token keyword">using</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> reader <span class="token operator">=</span> command<span class="token punctuation">.</span><span class="token function">ExecuteReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">//IDataReader</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span>reader<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token range operator">..</span><span class="token punctuation">.</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="remarks"><a href="#remarks" class="header-anchor">#</a> Remarks</h4> <p><strong>A note on parameterizing SQLs with <code>Parameters.AddWithValue</code>:</strong> <code>AddWithValue</code> is never a good starting point. That method relies on inferring the type of the data from what is passed in. With this, you might end up in a situation where the conversion prevents your query from <a href="http://stackoverflow.com/q/799584/87698" target="_blank" rel="noopener noreferrer">using an index<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Note that some SQL Server data types, such as <code>char</code>/<code>varchar</code> (without preceding &quot;n&quot;) or <code>date</code> do not have a corresponding .NET data type. In those cases, <a href="http://blogs.msmvps.com/jcoehoorn/blog/2014/05/12/can-we-stop-using-addwithvalue-already/" target="_blank" rel="noopener noreferrer"><code>Add</code> with the correct data type should be used instead<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/dotnet/ado-net.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/dotnet/net-core.html" class="prev">
        .NET Core
      </a></span> <span class="next"><a href="/dotnet/dependency-injection.html">
        Dependency Injection
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.ced448ab.js" defer></script><script src="/assets/js/3.f1d73125.js" defer></script><script src="/assets/js/982.c325eb19.js" defer></script>
  </body>
</html>
