<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>.NET Framework - Expression Trees</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Simple Expression Tree Generated by the C# Compiler, building a predicate of form field == value, Expression for retrieving a static field, InvocationExpression Class">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content=".NET Framework - Expression Trees">
    <meta property="og:description" content="Simple Expression Tree Generated by the C# Compiler, building a predicate of form field == value, Expression for retrieving a static field, InvocationExpression Class">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/dotnet/expression-trees.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content=".NET Framework - Expression Trees">
    <meta name="twitter:description" content="Simple Expression Tree Generated by the C# Compiler, building a predicate of form field == value, Expression for retrieving a static field, InvocationExpression Class">
    <meta name="twitter:url" content="/dotnet/expression-trees.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/995.6ba93cae.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>.NET Framework</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dotnet/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/dotnet/getting-started-with-net-framework.html" class="sidebar-link">Getting started with .NET Framework</a></li><li><a href="/dotnet/strings.html" class="sidebar-link">Strings</a></li><li><a href="/dotnet/datetime-parsing.html" class="sidebar-link">DateTime parsing</a></li><li><a href="/dotnet/dictionaries.html" class="sidebar-link">Dictionaries</a></li><li><a href="/dotnet/collections.html" class="sidebar-link">Collections</a></li><li><a href="/dotnet/readonlycollections.html" class="sidebar-link">ReadOnlyCollections</a></li><li><a href="/dotnet/stack-and-heap.html" class="sidebar-link">Stack and Heap</a></li><li><a href="/dotnet/linq.html" class="sidebar-link">LINQ</a></li><li><a href="/dotnet/foreach.html" class="sidebar-link">ForEach</a></li><li><a href="/dotnet/reflection.html" class="sidebar-link">Reflection</a></li><li><a href="/dotnet/expression-trees.html" aria-current="page" class="active sidebar-link">Expression Trees</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dotnet/expression-trees.html#simple-expression-tree-generated-by-the-c-compiler" class="sidebar-link">Simple Expression Tree Generated by the C# Compiler</a></li><li class="sidebar-sub-header"><a href="/dotnet/expression-trees.html#building-a-predicate-of-form-field-value" class="sidebar-link">building a predicate of form field == value</a></li><li class="sidebar-sub-header"><a href="/dotnet/expression-trees.html#expression-for-retrieving-a-static-field" class="sidebar-link">Expression for retrieving a static field</a></li><li class="sidebar-sub-header"><a href="/dotnet/expression-trees.html#invocationexpression-class" class="sidebar-link">InvocationExpression Class</a></li></ul></li><li><a href="/dotnet/custom-types.html" class="sidebar-link">Custom Types</a></li><li><a href="/dotnet/code-contracts.html" class="sidebar-link">Code Contracts</a></li><li><a href="/dotnet/settings.html" class="sidebar-link">Settings</a></li><li><a href="/dotnet/regular-expressions-system-text-regularexpressions.html" class="sidebar-link">Regular Expressions (System.Text.RegularExpressions)</a></li><li><a href="/dotnet/file-input-output.html" class="sidebar-link">File Input/Output</a></li><li><a href="/dotnet/system-io.html" class="sidebar-link">System.IO</a></li><li><a href="/dotnet/system-io-file-class.html" class="sidebar-link">System.IO.File class</a></li><li><a href="/dotnet/reading-and-writing-zip-files.html" class="sidebar-link">Reading and writing Zip files</a></li><li><a href="/dotnet/managed-extensibility-framework.html" class="sidebar-link">Managed Extensibility Framework</a></li><li><a href="/dotnet/speechrecognitionengine-class-to-recognize-speech.html" class="sidebar-link">SpeechRecognitionEngine class to recognize speech</a></li><li><a href="/dotnet/system-runtime-caching-memorycache-objectcache.html" class="sidebar-link">System.Runtime.Caching.MemoryCache (ObjectCache)</a></li><li><a href="/dotnet/system-reflection-emit-namespace.html" class="sidebar-link">System.Reflection.Emit namespace</a></li><li><a href="/dotnet/net-core.html" class="sidebar-link">.NET Core</a></li><li><a href="/dotnet/ado-net.html" class="sidebar-link">ADO.NET</a></li><li><a href="/dotnet/dependency-injection.html" class="sidebar-link">Dependency Injection</a></li><li><a href="/dotnet/platform-invoke.html" class="sidebar-link">Platform Invoke</a></li><li><a href="/dotnet/nuget-packaging-system.html" class="sidebar-link">NuGet packaging system</a></li><li><a href="/dotnet/globalization-in-asp-net-mvc-using-smart-internationalization-for-asp-net.html" class="sidebar-link">Globalization in ASP.NET MVC using Smart internationalization for ASP.NET</a></li><li><a href="/dotnet/system-net-mail.html" class="sidebar-link">System.Net.Mail</a></li><li><a href="/dotnet/using-progress-t-and-iprogress-t.html" class="sidebar-link">Using Progress</a></li><li><a href="/dotnet/json-serialization.html" class="sidebar-link">JSON Serialization</a></li><li><a href="/dotnet/json-in-net-with-newtonsoft-json.html" class="sidebar-link">JSON in .NET with Newtonsoft.Json</a></li><li><a href="/dotnet/xmlserializer.html" class="sidebar-link">XmlSerializer</a></li><li><a href="/dotnet/vb-forms.html" class="sidebar-link">VB Forms</a></li><li><a href="/dotnet/jit-compiler.html" class="sidebar-link">JIT compiler</a></li><li><a href="/dotnet/clr.html" class="sidebar-link">CLR</a></li><li><a href="/dotnet/tpl-dataflow.html" class="sidebar-link">TPL Dataflow</a></li><li><a href="/dotnet/threading.html" class="sidebar-link">Threading</a></li><li><a href="/dotnet/process-and-thread-affinity-setting.html" class="sidebar-link">Process and Thread affinity setting</a></li><li><a href="/dotnet/parallel-processing-using-net-framework.html" class="sidebar-link">Parallel processing using .Net framework</a></li><li><a href="/dotnet/task-parallel-library-tpl.html" class="sidebar-link">Task Parallel Library (TPL)</a></li><li><a href="/dotnet/task-parallel-library-tpl-api-overviews.html" class="sidebar-link">Task Parallel Library (TPL) API Overviews</a></li><li><a href="/dotnet/synchronization-contexts.html" class="sidebar-link">Synchronization Contexts</a></li><li><a href="/dotnet/memory-management.html" class="sidebar-link">Memory management</a></li><li><a href="/dotnet/garbage-collection.html" class="sidebar-link">Garbage Collection</a></li><li><a href="/dotnet/exceptions.html" class="sidebar-link">Exceptions</a></li><li><a href="/dotnet/system-diagnostics.html" class="sidebar-link">System.Diagnostics</a></li><li><a href="/dotnet/encryption-cryptography.html" class="sidebar-link">Encryption / Cryptography</a></li><li><a href="/dotnet/work-with-sha1-in-c.html" class="sidebar-link">Work with SHA1 in C#</a></li><li><a href="/dotnet/unit-testing.html" class="sidebar-link">Unit testing</a></li><li><a href="/dotnet/write-to-and-read-from-stderr-stream.html" class="sidebar-link">Write to and read from StdErr stream</a></li><li><a href="/dotnet/upload-file-and-post-data-to-webserver.html" class="sidebar-link">Upload file and POST data to webserver</a></li><li><a href="/dotnet/networking.html" class="sidebar-link">Networking</a></li><li><a href="/dotnet/http-servers.html" class="sidebar-link">HTTP servers</a></li><li><a href="/dotnet/http-clients.html" class="sidebar-link">HTTP clients</a></li><li><a href="/dotnet/serial-ports.html" class="sidebar-link">Serial Ports</a></li><li><a href="/dotnet/acronym-glossary.html" class="sidebar-link">Acronym Glossary</a></li><li><a href="/dotnet/work-with-sha1-in-c.html" class="sidebar-link">Work with SHA1 in C#</a></li><li><a href="/dotnet/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="expression-trees"><a href="#expression-trees" class="header-anchor">#</a> Expression Trees</h1> <h2 id="simple-expression-tree-generated-by-the-c-compiler"><a href="#simple-expression-tree-generated-by-the-c-compiler" class="header-anchor">#</a> Simple Expression Tree Generated by the C# Compiler</h2> <p>Consider the following C# code</p> <div class="language-dotnet extra-class"><pre class="language-dotnet"><code><span class="token class-name">Expression<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> expression <span class="token operator">=</span> a <span class="token operator">=&gt;</span> a <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>

</code></pre></div><p>Because the C# compiler sees that the lambda expression is assigned to an Expression type rather than a delegate type it generates an expression tree roughly equivalent to this code</p> <div class="language-dotnet extra-class"><pre class="language-dotnet"><code><span class="token class-name">ParameterExpression</span> parameterA <span class="token operator">=</span> Expression<span class="token punctuation">.</span><span class="token function">Parameter</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name"><span class="token keyword">int</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> expression <span class="token operator">=</span> <span class="token punctuation">(</span>Expression<span class="token operator">&lt;</span>Func<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">)</span>Expression<span class="token punctuation">.</span><span class="token function">Lambda</span><span class="token punctuation">(</span>
                                                 Expression<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>
                                                     parameterA<span class="token punctuation">,</span>
                                                     Expression<span class="token punctuation">.</span><span class="token function">Constant</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                                 parameterA<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>The root of the tree is the lambda expression which contains a body and a list of parameters. The lambda has 1 parameter called &quot;a&quot;. The body is a single expression of CLR type BinaryExpression and NodeType of Add. This expression represents addition. It has two subexpressions denoted as Left and Right. Left is the ParameterExpression for the parameter &quot;a&quot; and Right is a ConstantExpression with the value 1.</p> <p>The simplest usage of this expression is printing it:</p> <div class="language-dotnet extra-class"><pre class="language-dotnet"><code>Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>expression<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//prints a =&gt; (a + 1)</span>

</code></pre></div><p>Which prints the equivalent C# code.</p> <p>The expression tree can be compiled into a C# delegate and executed by the CLR</p> <div class="language-dotnet extra-class"><pre class="language-dotnet"><code><span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">&gt;</span></span> lambda <span class="token operator">=</span> expression<span class="token punctuation">.</span><span class="token function">Compile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">lambda</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//prints 3</span>

</code></pre></div><p>Usually expressions are translated to other languages like SQL, but can be also used to invoke private, protected and internal members of public or non-public types as alternative to Reflection.</p> <h2 id="building-a-predicate-of-form-field-value"><a href="#building-a-predicate-of-form-field-value" class="header-anchor">#</a> building a predicate of form field == value</h2> <p>To build up an expression like <code>_ =&gt; _.Field == &quot;VALUE&quot;</code> at runtime.</p> <p>Given a predicate <code>_ =&gt; _.Field</code> and a string value <code>&quot;VALUE&quot;</code>, create an expression that tests whether or not the predicate is true.</p> <p>The expression is suitable for:</p> <ul><li><code>IQueryable&lt;T&gt;</code>, <code>IEnumerable&lt;T&gt;</code> to test the predicate.</li> <li>entity framework or <code>Linq</code> to <code>SQL</code> to create a <code>Where</code> clause that tests the predicate.</li></ul> <p>This method will build an appropriate <code>Equal</code> expression that tests whether or not <code>Field</code> equals <code>&quot;VALUE&quot;</code>.</p> <div class="language-dotnet extra-class"><pre class="language-dotnet"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">Expression<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token generic-method"><span class="token function">BuildEqualPredicate</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>
    <span class="token class-name">Expression<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> memberAccessor<span class="token punctuation">,</span>
    <span class="token class-name"><span class="token keyword">string</span></span> term<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> toString <span class="token operator">=</span> Expression<span class="token punctuation">.</span><span class="token function">Convert</span><span class="token punctuation">(</span>Expression<span class="token punctuation">.</span><span class="token function">Constant</span><span class="token punctuation">(</span>term<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name"><span class="token keyword">string</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Expression</span> expression <span class="token operator">=</span> Expression<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>memberAccessor<span class="token punctuation">.</span>Body<span class="token punctuation">,</span> toString<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> predicate <span class="token operator">=</span> Expression<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Lambda</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>
        expression<span class="token punctuation">,</span>
        memberAccessor<span class="token punctuation">.</span>Parameters<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> predicate<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>The predicate can be used by including the predicate in a <code>Where</code> extension method.</p> <div class="language-dotnet extra-class"><pre class="language-dotnet"><code><span class="token class-name"><span class="token keyword">var</span></span> predicate <span class="token operator">=</span> PredicateExtensions<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">BuildEqualPredicate</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Entity<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>
    _ <span class="token operator">=&gt;</span> _<span class="token punctuation">.</span>Field<span class="token punctuation">,</span>
    <span class="token string">&quot;VALUE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> results <span class="token operator">=</span> context<span class="token punctuation">.</span>Entity<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>predicate<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="expression-for-retrieving-a-static-field"><a href="#expression-for-retrieving-a-static-field" class="header-anchor">#</a> Expression for retrieving a static field</h2> <p>Having example type like this:</p> <div class="language-dotnet extra-class"><pre class="language-dotnet"><code><span class="token keyword">public</span> TestClass
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name"><span class="token keyword">string</span></span> StaticPublicField <span class="token operator">=</span> <span class="token string">&quot;StaticPublicFieldValue&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>We can retrieve value of StaticPublicField:</p> <div class="language-dotnet extra-class"><pre class="language-dotnet"><code><span class="token class-name"><span class="token keyword">var</span></span> fieldExpr <span class="token operator">=</span> Expression<span class="token punctuation">.</span><span class="token function">Field</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">TestClass</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;StaticPublicField&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> labmda <span class="token operator">=</span> Expression<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Lambda</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>fieldExpr<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>It can be then i.e. compiled into a delegate for retrieving field value.</p> <div class="language-dotnet extra-class"><pre class="language-dotnet"><code><span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> retriever <span class="token operator">=</span> lambda<span class="token punctuation">.</span><span class="token function">Compile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> fieldValue <span class="token operator">=</span> <span class="token function">retriever</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>//fieldValue result is StaticPublicFieldValue</p> <h2 id="invocationexpression-class"><a href="#invocationexpression-class" class="header-anchor">#</a> InvocationExpression Class</h2> <p><a href="https://msdn.microsoft.com/en-us/library/system.linq.expressions.invocationexpression(v=vs.110).aspx" target="_blank" rel="noopener noreferrer">InvocationExpression class<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> allows invocation of other lambda expressions that are parts of the same Expression tree.</p> <p>You create them with static <code>Expression.Invoke</code> method.</p> <p>Problem
We want to get on the items which have &quot;car&quot; in their description. We need to check it for null before searching for a string inside but we don't want it to be called excessively, as the computation could be expensive.</p> <div class="language-dotnet extra-class"><pre class="language-dotnet"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Linq</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Linq<span class="token punctuation">.</span>Expressions</span><span class="token punctuation">;</span>
                    
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> elements <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Element</span> <span class="token punctuation">{</span> Description <span class="token operator">=</span> <span class="token string">&quot;car&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Element</span> <span class="token punctuation">{</span> Description <span class="token operator">=</span> <span class="token string">&quot;cargo&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Element</span> <span class="token punctuation">{</span> Description <span class="token operator">=</span> <span class="token string">&quot;wheel&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Element</span> <span class="token punctuation">{</span> Description <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Element</span> <span class="token punctuation">{</span> Description <span class="token operator">=</span> <span class="token string">&quot;Madagascar&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    
        <span class="token class-name"><span class="token keyword">var</span></span> elementIsInterestingExpression <span class="token operator">=</span> <span class="token function">CreateSearchPredicate</span><span class="token punctuation">(</span>
            <span class="token named-parameter punctuation">searchTerm</span><span class="token punctuation">:</span> <span class="token string">&quot;car&quot;</span><span class="token punctuation">,</span>
            <span class="token named-parameter punctuation">whereToSearch</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token class-name">Element</span> e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>Description<span class="token punctuation">)</span><span class="token punctuation">;</span>
            
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>elementIsInterestingExpression<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
        <span class="token class-name"><span class="token keyword">var</span></span> elementIsInteresting <span class="token operator">=</span> elementIsInterestingExpression<span class="token punctuation">.</span><span class="token function">Compile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> interestingElements <span class="token operator">=</span> elements<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>elementIsInteresting<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> e <span class="token keyword">in</span> interestingElements<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>Description<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token class-name"><span class="token keyword">var</span></span> countExpensiveComputations <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token class-name">Action</span> incCount <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> countExpensiveComputations<span class="token operator">++</span><span class="token punctuation">;</span>
        elements
            <span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>
                <span class="token function">CreateSearchPredicate</span><span class="token punctuation">(</span>
                    <span class="token string">&quot;car&quot;</span><span class="token punctuation">,</span>
                    <span class="token punctuation">(</span><span class="token class-name">Element</span> e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">ExpensivelyComputed</span><span class="token punctuation">(</span>
                        e<span class="token punctuation">,</span> incCount
                    <span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Compile</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                   
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Property extractor is called {0} times.&quot;</span><span class="token punctuation">,</span> countExpensiveComputations<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">Element</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Description <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">ExpensivelyComputed</span><span class="token punctuation">(</span><span class="token class-name">Element</span> source<span class="token punctuation">,</span> <span class="token class-name">Action</span> count<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> source<span class="token punctuation">.</span>Description<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name">Expression<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token generic-method"><span class="token function">CreateSearchPredicate</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>
            <span class="token class-name"><span class="token keyword">string</span></span> searchTerm<span class="token punctuation">,</span>
            <span class="token class-name">Expression<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> whereToSearch<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> extracted <span class="token operator">=</span> Expression<span class="token punctuation">.</span><span class="token function">Parameter</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name"><span class="token keyword">string</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;extracted&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
        <span class="token class-name">Expression<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> coalesceNullCheckWithSearch <span class="token operator">=</span>
            Expression<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Lambda</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>
                Expression<span class="token punctuation">.</span><span class="token function">AndAlso</span><span class="token punctuation">(</span>
                    Expression<span class="token punctuation">.</span><span class="token function">Not</span><span class="token punctuation">(</span>
                        Expression<span class="token punctuation">.</span><span class="token function">Call</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name"><span class="token keyword">string</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;IsNullOrEmpty&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> extracted<span class="token punctuation">)</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    Expression<span class="token punctuation">.</span><span class="token function">Call</span><span class="token punctuation">(</span>extracted<span class="token punctuation">,</span> <span class="token string">&quot;Contains&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> Expression<span class="token punctuation">.</span><span class="token function">Constant</span><span class="token punctuation">(</span>searchTerm<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                extracted<span class="token punctuation">)</span><span class="token punctuation">;</span>
                
        <span class="token class-name"><span class="token keyword">var</span></span> elementParameter <span class="token operator">=</span> Expression<span class="token punctuation">.</span><span class="token function">Parameter</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">T</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;element&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                
        <span class="token keyword">return</span> Expression<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Lambda</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>
            Expression<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span>
                coalesceNullCheckWithSearch<span class="token punctuation">,</span>
                Expression<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span>whereToSearch<span class="token punctuation">,</span> elementParameter<span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            elementParameter
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>Output</p> <div class="language-dotnet extra-class"><pre class="language-dotnet"><code>element <span class="token operator">=&gt;</span> <span class="token function">Invoke</span><span class="token punctuation">(</span>extracted <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token function">Not</span><span class="token punctuation">(</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>extracted<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token return-type class-name">AndAlso</span> extracted<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span><span class="token string">&quot;car&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Invoke</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>Description<span class="token punctuation">,</span> element<span class="token punctuation">)</span><span class="token punctuation">)</span>
car
cargo
Madagascar
Predicate <span class="token keyword">is</span> <span class="token class-name">called</span> <span class="token number">5</span> times<span class="token punctuation">.</span>

</code></pre></div><p>First thing to note is how the actual propery access, wrapped in an Invoke:</p> <div class="language-dotnet extra-class"><pre class="language-dotnet"><code><span class="token function">Invoke</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>Description<span class="token punctuation">,</span> element<span class="token punctuation">)</span>

</code></pre></div><p>, and this is the only part that touches <code>e.Description</code>, and in place of it, <code>extracted</code> parameter of type <code>string</code> is passed to the next one:</p> <div class="language-dotnet extra-class"><pre class="language-dotnet"><code><span class="token punctuation">(</span><span class="token function">Not</span><span class="token punctuation">(</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>extracted<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token return-type class-name">AndAlso</span> extracted<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span><span class="token string">&quot;car&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><p>Another important thing to note here is <code>AndAlso</code>. It computes only the left part, if the first part returns 'false'. It's a common mistake to use the bitwise operator 'And' instead of it, which always computes both parts, and would fail with a NullReferenceException in this example.</p> <h4 id="remarks"><a href="#remarks" class="header-anchor">#</a> Remarks</h4> <p>Expression trees are data structures used to represent code expressions in the .NET Framework. They can be generated by code and traversed programmatically to translate the code to another language or execute it. The most popular generator of Expression Trees is the C# compiler itself. The C# compiler can generate expression trees if a lambda expression is assigned to a variable of type Expression&lt;Func&lt;...&gt;&gt;. Usually this happens in the context of LINQ. The most popular consumer is Entity Framework's LINQ provider. It consumes the expression trees given to Entity Framework and generates equivalent SQL code which is then executed against the database.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/dotnet/expression-trees.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/dotnet/reflection.html" class="prev">
        Reflection
      </a></span> <span class="next"><a href="/dotnet/custom-types.html">
        Custom Types
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/995.6ba93cae.js" defer></script>
  </body>
</html>
