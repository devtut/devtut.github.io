<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Oracle Database - Update with Joins</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Examples: what works and what doesn't">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="Oracle Database - Update with Joins">
    <meta property="og:description" content="Examples: what works and what doesn't">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/oracle/update-with-joins.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="Oracle Database - Update with Joins">
    <meta name="twitter:description" content="Examples: what works and what doesn't">
    <meta name="twitter:url" content="/oracle/update-with-joins.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    <link rel="preload" href="/assets/css/0.styles.8b877eb8.css" as="style"><link rel="preload" href="/assets/js/app.ced448ab.js" as="script"><link rel="preload" href="/assets/js/3.f1d73125.js" as="script"><link rel="preload" href="/assets/js/2370.1a349298.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.8b877eb8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Oracle Database</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/oracle/" class="sidebar-link">Disclaimer</a></li><li><a href="/oracle/getting-started-with-oracle-database.html" class="sidebar-link">Getting started with Oracle Database</a></li><li><a href="/oracle/anonymous-pl-sql-block.html" class="sidebar-link">Anonymous PL/SQL Block</a></li><li><a href="/oracle/data-dictionary.html" class="sidebar-link">Data Dictionary</a></li><li><a href="/oracle/dates.html" class="sidebar-link">Dates</a></li><li><a href="/oracle/working-with-dates.html" class="sidebar-link">Working with Dates</a></li><li><a href="/oracle/dual-table.html" class="sidebar-link">DUAL table</a></li><li><a href="/oracle/joins.html" class="sidebar-link">JOINS</a></li><li><a href="/oracle/handling-null-values.html" class="sidebar-link">Handling NULL values</a></li><li><a href="/oracle/string-manipulation.html" class="sidebar-link">String Manipulation</a></li><li><a href="/oracle/limiting-the-rows-returned-by-a-query-pagination.html" class="sidebar-link">Limiting the rows returned by a query (Pagination)</a></li><li><a href="/oracle/recursive-sub-query-factoring-using-the-with-clause-a-k-a-common-table-expressions.html" class="sidebar-link">Recursive Sub-Query Factoring using the WITH Clause (A.K.A. Common Table Expressions)</a></li><li><a href="/oracle/different-ways-to-update-records.html" class="sidebar-link">Different ways to update records</a></li><li><a href="/oracle/update-with-joins.html" class="active sidebar-link">Update with Joins</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/oracle/update-with-joins.html#examples-what-works-and-what-doesn-t" class="sidebar-link">Examples: what works and what doesn't</a></li></ul></li><li><a href="/oracle/statistical-functions.html" class="sidebar-link">Statistical functions</a></li><li><a href="/oracle/window-functions.html" class="sidebar-link">Window Functions</a></li><li><a href="/oracle/creating-a-context.html" class="sidebar-link">Creating a Context</a></li><li><a href="/oracle/splitting-delimited-strings.html" class="sidebar-link">Splitting Delimited Strings</a></li><li><a href="/oracle/sequences.html" class="sidebar-link">Sequences</a></li><li><a href="/oracle/indexes.html" class="sidebar-link">Indexes</a></li><li><a href="/oracle/hints.html" class="sidebar-link">Hints</a></li><li><a href="/oracle/error-logging.html" class="sidebar-link">Error logging</a></li><li><a href="/oracle/database-links.html" class="sidebar-link">Database Links</a></li><li><a href="/oracle/table-partitioning.html" class="sidebar-link">Table partitioning</a></li><li><a href="/oracle/oracle-advanced-queuing-aq.html" class="sidebar-link">Oracle Advanced Queuing (AQ)</a></li><li><a href="/oracle/constraints.html" class="sidebar-link">constraints</a></li><li><a href="/oracle/autonomous-transactions.html" class="sidebar-link">Autonomous Transactions</a></li><li><a href="/oracle/oracle-maf.html" class="sidebar-link">Oracle MAF</a></li><li><a href="/oracle/level-query.html" class="sidebar-link">level query</a></li><li><a href="/oracle/hierarchical-retrieval-with-oracle-database-12c.html" class="sidebar-link">Hierarchical Retrieval With Oracle Database 12C</a></li><li><a href="/oracle/data-pump.html" class="sidebar-link">Data Pump</a></li><li><a href="/oracle/real-application-security.html" class="sidebar-link">Real Application Security</a></li><li><a href="/oracle/dynamic-sql.html" class="sidebar-link">Dynamic SQL</a></li><li><a href="/oracle/delimiting-keywords-or-special-characters.html" class="sidebar-link">Delimiting keywords or special characters</a></li><li><a href="/oracle/getting-started-with-plsql.html" class="sidebar-link">Getting started with plsql</a></li><li><a href="/oracle/plsql-procedure.html" class="sidebar-link">PLSQL procedure</a></li><li><a href="/oracle/if-then-else-statement.html" class="sidebar-link">IF-THEN-ELSE Statement</a></li><li><a href="/oracle/functions.html" class="sidebar-link">Functions</a></li><li><a href="/oracle/collections-and-records.html" class="sidebar-link">Collections and Records</a></li><li><a href="/oracle/object-types.html" class="sidebar-link">Object Types</a></li><li><a href="/oracle/loop.html" class="sidebar-link">Loop</a></li><li><a href="/oracle/cursors.html" class="sidebar-link">Cursors</a></li><li><a href="/oracle/packages.html" class="sidebar-link">Packages</a></li><li><a href="/oracle/exception-handling.html" class="sidebar-link">Exception Handling</a></li><li><a href="/oracle/bulk-collect.html" class="sidebar-link">Bulk collect</a></li><li><a href="/oracle/assignments-model-and-language.html" class="sidebar-link">Assignments model and language</a></li><li><a href="/oracle/triggers.html" class="sidebar-link">Triggers</a></li><li><a href="/oracle/exception-handling.html" class="sidebar-link">Exception Handling</a></li><li><a href="/oracle/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="update-with-joins"><a href="#update-with-joins" class="header-anchor">#</a> Update with Joins</h1> <h2 id="examples-what-works-and-what-doesn-t"><a href="#examples-what-works-and-what-doesn-t" class="header-anchor">#</a> Examples: what works and what doesn't</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> tgt <span class="token punctuation">(</span> id<span class="token punctuation">,</span> val <span class="token punctuation">)</span> <span class="token keyword">as</span> 
  <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'a'</span> <span class="token keyword">from</span> dual <span class="token keyword">union</span> <span class="token keyword">all</span>
  <span class="token keyword">select</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'b'</span> <span class="token keyword">from</span> dual
<span class="token punctuation">;</span>

<span class="token keyword">Table</span> TGT created<span class="token punctuation">.</span>

<span class="token keyword">create</span> <span class="token keyword">table</span> src <span class="token punctuation">(</span> id<span class="token punctuation">,</span> val <span class="token punctuation">)</span> <span class="token keyword">as</span> 
  <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'x'</span> <span class="token keyword">from</span> dual <span class="token keyword">union</span> <span class="token keyword">all</span>
  <span class="token keyword">select</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'y'</span> <span class="token keyword">from</span> dual
<span class="token punctuation">;</span>

<span class="token keyword">Table</span> SRC created<span class="token punctuation">.</span>

<span class="token keyword">update</span>
  <span class="token punctuation">(</span> <span class="token keyword">select</span> t<span class="token punctuation">.</span>val <span class="token keyword">as</span> t_val<span class="token punctuation">,</span> s<span class="token punctuation">.</span>val <span class="token keyword">as</span> s_val
    <span class="token keyword">from</span>   tgt t <span class="token keyword">inner</span> <span class="token keyword">join</span> src s <span class="token keyword">on</span> t<span class="token punctuation">.</span>id <span class="token operator">=</span> s<span class="token punctuation">.</span>id
  <span class="token punctuation">)</span>
<span class="token keyword">set</span> t_val <span class="token operator">=</span> s_val
<span class="token punctuation">;</span>

<span class="token keyword">SQL</span> Error: ORA<span class="token operator">-</span><span class="token number">01779</span>: cannot <span class="token keyword">modify</span> a <span class="token keyword">column</span> which maps <span class="token keyword">to</span> a non <span class="token keyword">key</span><span class="token operator">-</span>preserved <span class="token keyword">table</span>
<span class="token number">01779.</span> <span class="token number">00000</span> <span class="token operator">-</span>  <span class="token string">&quot;cannot modify a column which maps to a non key-preserved table&quot;</span>
<span class="token operator">*</span>Cause:    An attempt was made <span class="token keyword">to</span> <span class="token keyword">insert</span> <span class="token operator">or</span> <span class="token keyword">update</span> <span class="token keyword">columns</span> <span class="token keyword">of</span> a <span class="token keyword">join</span> <span class="token keyword">view</span> which
           map <span class="token keyword">to</span> a non<span class="token operator">-</span><span class="token keyword">key</span><span class="token operator">-</span>preserved <span class="token keyword">table</span><span class="token punctuation">.</span>
<span class="token operator">*</span><span class="token keyword">Action</span>:   <span class="token keyword">Modify</span> the underlying base <span class="token keyword">tables</span> directly<span class="token punctuation">.</span>

</code></pre></div><p>Imagine what would happen if we had the value <code>1</code> in the column <code>src.id</code> more than once, with different values for <code>src.val</code>. Obviously, the update would make no sense (in ANY database - that's a logical issue). Now, <strong>we</strong> know that there are no duplicates in <code>src.id</code>, but the Oracle engine doesn't know that - so it's complaining. Perhaps this is why so many practitioners believe Oracle &quot;doesn't have UPDATE with joins&quot;?</p> <p>What Oracle expects is that <code>src.id</code> should be unique, and that it, Oracle, would know that beforehand. Easily fixed! Note that the same works with composite keys (on more than one column), if the matching for the update needs to use more than one column. In practice, <code>src.id</code> may be PK and <code>tgt.id</code> may be FK pointing to this PK, but that is not relevant for updates with join; what <strong>is</strong> relevant is the unique constraint.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">alter</span> <span class="token keyword">table</span> src <span class="token keyword">add</span> <span class="token keyword">constraint</span> src_uc <span class="token keyword">unique</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">Table</span> SRC altered<span class="token punctuation">.</span>

<span class="token keyword">update</span>
  <span class="token punctuation">(</span> <span class="token keyword">select</span> t<span class="token punctuation">.</span>val <span class="token keyword">as</span> t_val<span class="token punctuation">,</span> s<span class="token punctuation">.</span>val <span class="token keyword">as</span> s_val
    <span class="token keyword">from</span>   tgt t <span class="token keyword">inner</span> <span class="token keyword">join</span> src s <span class="token keyword">on</span> t<span class="token punctuation">.</span>id <span class="token operator">=</span> s<span class="token punctuation">.</span>id
  <span class="token punctuation">)</span>
<span class="token keyword">set</span> t_val <span class="token operator">=</span> s_val
<span class="token punctuation">;</span>

<span class="token number">2</span> <span class="token keyword">rows</span> updated<span class="token punctuation">.</span>

<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tgt<span class="token punctuation">;</span>

ID  VAL
<span class="token comment">--  ---</span>
 <span class="token number">1</span>  x
 <span class="token number">2</span>  y

</code></pre></div><p>The same result could be achieved with a MERGE statement (which deserves its own Documentation article), and I personally prefer MERGE in these cases, but the reason is not that &quot;Oracle doesn't do updates with joins.&quot; As this example shows, Oracle <strong>does</strong> do updates with joins.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/oracle/update-with-joins.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/oracle/different-ways-to-update-records.html" class="prev">
        Different ways to update records
      </a></span> <span class="next"><a href="/oracle/statistical-functions.html">
        Statistical functions
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.ced448ab.js" defer></script><script src="/assets/js/3.f1d73125.js" defer></script><script src="/assets/js/2370.1a349298.js" defer></script>
  </body>
</html>
