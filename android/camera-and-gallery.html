<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Android - Camera and Gallery</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Taking full-sized photo from camera, Take photo, How to start camera or gallery and save camera result to storage, Set camera resolution, Decode bitmap correctly rotated from the uri fetched with the intent">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="Android - Camera and Gallery">
    <meta property="og:description" content="Taking full-sized photo from camera, Take photo, How to start camera or gallery and save camera result to storage, Set camera resolution, Decode bitmap correctly rotated from the uri fetched with the intent">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/android/camera-and-gallery.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="Android - Camera and Gallery">
    <meta name="twitter:description" content="Taking full-sized photo from camera, Take photo, How to start camera or gallery and save camera result to storage, Set camera resolution, Decode bitmap correctly rotated from the uri fetched with the intent">
    <meta name="twitter:url" content="/android/camera-and-gallery.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/125.498b5a45.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Android</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/android/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/android/getting-started-with-android.html" class="sidebar-link">Getting started with Android</a></li><li><a href="/android/android-studio.html" class="sidebar-link">Android Studio</a></li><li><a href="/android/instant-run-in-android-studio.html" class="sidebar-link">Instant Run in Android Studio</a></li><li><a href="/android/textview.html" class="sidebar-link">TextView</a></li><li><a href="/android/autocompletetextview.html" class="sidebar-link">AutoCompleteTextView</a></li><li><a href="/android/autosizing-textviews.html" class="sidebar-link">Autosizing TextViews</a></li><li><a href="/android/listview.html" class="sidebar-link">ListView</a></li><li><a href="/android/layouts.html" class="sidebar-link">Layouts</a></li><li><a href="/android/constraintlayout.html" class="sidebar-link">ConstraintLayout</a></li><li><a href="/android/textinputlayout.html" class="sidebar-link">TextInputLayout</a></li><li><a href="/android/coordinatorlayout-and-behaviors.html" class="sidebar-link">CoordinatorLayout and Behaviors</a></li><li><a href="/android/tablayout.html" class="sidebar-link">TabLayout</a></li><li><a href="/android/viewpager.html" class="sidebar-link">ViewPager</a></li><li><a href="/android/cardview.html" class="sidebar-link">CardView</a></li><li><a href="/android/navigationview.html" class="sidebar-link">NavigationView</a></li><li><a href="/android/recyclerview.html" class="sidebar-link">RecyclerView</a></li><li><a href="/android/recyclerview-decorations.html" class="sidebar-link">RecyclerView Decorations</a></li><li><a href="/android/recyclerview-onclicklisteners.html" class="sidebar-link">RecyclerView onClickListeners</a></li><li><a href="/android/recyclerview-and-layoutmanagers.html" class="sidebar-link">RecyclerView and LayoutManagers</a></li><li><a href="/android/pagination-in-recyclerview.html" class="sidebar-link">Pagination in RecyclerView</a></li><li><a href="/android/imageview.html" class="sidebar-link">ImageView</a></li><li><a href="/android/videoview.html" class="sidebar-link">VideoView</a></li><li><a href="/android/optimized-videoview.html" class="sidebar-link">Optimized VideoView</a></li><li><a href="/android/webview.html" class="sidebar-link">WebView</a></li><li><a href="/android/searchview.html" class="sidebar-link">SearchView</a></li><li><a href="/android/bottomnavigationview.html" class="sidebar-link">BottomNavigationView</a></li><li><a href="/android/canvas-drawing-using-surfaceview.html" class="sidebar-link">Canvas drawing using SurfaceView</a></li><li><a href="/android/creating-custom-views.html" class="sidebar-link">Creating Custom Views</a></li><li><a href="/android/getting-calculated-view-dimensions.html" class="sidebar-link">Getting Calculated View Dimensions</a></li><li><a href="/android/adding-a-fuseview-to-an-android-project.html" class="sidebar-link">Adding a FuseView to an Android Project</a></li><li><a href="/android/supporting-screens-with-different-resolutions-sizes.html" class="sidebar-link">Supporting Screens With Different Resolutions, Sizes</a></li><li><a href="/android/viewflipper.html" class="sidebar-link">ViewFlipper</a></li><li><a href="/android/design-patterns.html" class="sidebar-link">Design Patterns</a></li><li><a href="/android/activity.html" class="sidebar-link">Activity</a></li><li><a href="/android/activity-recognition.html" class="sidebar-link">Activity Recognition</a></li><li><a href="/android/split-screen-multi-screen-activities.html" class="sidebar-link">Split Screen / Multi-Screen Activities</a></li><li><a href="/android/material-design.html" class="sidebar-link">Material Design</a></li><li><a href="/android/resources.html" class="sidebar-link">Resources</a></li><li><a href="/android/data-binding-library.html" class="sidebar-link">Data Binding Library</a></li><li><a href="/android/context.html" class="sidebar-link">Context</a></li><li><a href="/android/sharedpreferences.html" class="sidebar-link">SharedPreferences</a></li><li><a href="/android/intent.html" class="sidebar-link">Intent</a></li><li><a href="/android/fragments.html" class="sidebar-link">Fragments</a></li><li><a href="/android/button.html" class="sidebar-link">Button</a></li><li><a href="/android/emulator.html" class="sidebar-link">Emulator</a></li><li><a href="/android/service.html" class="sidebar-link">Service</a></li><li><a href="/android/the-manifest-file.html" class="sidebar-link">The Manifest File</a></li><li><a href="/android/gradle-for-android.html" class="sidebar-link">Gradle for Android</a></li><li><a href="/android/fileio-with-android.html" class="sidebar-link">FileIO with Android</a></li><li><a href="/android/fileprovider.html" class="sidebar-link">FileProvider</a></li><li><a href="/android/storing-files-in-internal-external-storage.html" class="sidebar-link">Storing Files in Internal &amp; External Storage</a></li><li><a href="/android/zip-file-in-android.html" class="sidebar-link">Zip file in android</a></li><li><a href="/android/unzip-file-in-android.html" class="sidebar-link">Unzip File in Android</a></li><li><a href="/android/camera-and-gallery.html" aria-current="page" class="active sidebar-link">Camera and Gallery</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/android/camera-and-gallery.html#taking-full-sized-photo-from-camera" class="sidebar-link">Taking full-sized photo from camera</a></li><li class="sidebar-sub-header"><a href="/android/camera-and-gallery.html#take-photo" class="sidebar-link">Take photo</a></li><li class="sidebar-sub-header"><a href="/android/camera-and-gallery.html#how-to-start-camera-or-gallery-and-save-camera-result-to-storage" class="sidebar-link">How to start camera or gallery and save camera result to storage</a></li><li class="sidebar-sub-header"><a href="/android/camera-and-gallery.html#set-camera-resolution" class="sidebar-link">Set camera resolution</a></li><li class="sidebar-sub-header"><a href="/android/camera-and-gallery.html#decode-bitmap-correctly-rotated-from-the-uri-fetched-with-the-intent" class="sidebar-link">Decode bitmap correctly rotated from the uri fetched with the intent</a></li></ul></li><li><a href="/android/camera-2-api.html" class="sidebar-link">Camera 2 API</a></li><li><a href="/android/fingerprint-api-in-android.html" class="sidebar-link">Fingerprint API in android</a></li><li><a href="/android/bluetooth-and-bluetooth-le-api.html" class="sidebar-link">Bluetooth and Bluetooth LE API</a></li><li><a href="/android/runtime-permissions-in-api-23.html" class="sidebar-link">Runtime Permissions in API-23 +</a></li><li><a href="/android/android-places-api.html" class="sidebar-link">Android Places API</a></li><li><a href="/android/android-ndk.html" class="sidebar-link">Android NDK</a></li><li><a href="/android/daynight-theme-appcompat-v23-2-api-14.html" class="sidebar-link">DayNight Theme (AppCompat v23.2 / API 14+)</a></li><li><a href="/android/glide.html" class="sidebar-link">Glide</a></li><li><a href="/android/dialog.html" class="sidebar-link">Dialog</a></li><li><a href="/android/enhancing-alert-dialogs.html" class="sidebar-link">Enhancing Alert Dialogs</a></li><li><a href="/android/animated-alertdialog-box.html" class="sidebar-link">Animated AlertDialog Box</a></li><li><a href="/android/greendao.html" class="sidebar-link">GreenDAO</a></li><li><a href="/android/tools-attributes.html" class="sidebar-link">Tools Attributes</a></li><li><a href="/android/formatting-strings.html" class="sidebar-link">Formatting Strings</a></li><li><a href="/android/spannablestring.html" class="sidebar-link">SpannableString</a></li><li><a href="/android/notifications.html" class="sidebar-link">Notifications</a></li><li><a href="/android/alarmmanager.html" class="sidebar-link">AlarmManager</a></li><li><a href="/android/handler.html" class="sidebar-link">Handler</a></li><li><a href="/android/broadcastreceiver.html" class="sidebar-link">BroadcastReceiver</a></li><li><a href="/android/ui-lifecycle.html" class="sidebar-link">UI Lifecycle</a></li><li><a href="/android/httpurlconnection.html" class="sidebar-link">HttpURLConnection</a></li><li><a href="/android/callback-url.html" class="sidebar-link">Callback URL</a></li><li><a href="/android/snackbar.html" class="sidebar-link">Snackbar</a></li><li><a href="/android/widgets.html" class="sidebar-link">Widgets</a></li><li><a href="/android/toast.html" class="sidebar-link">Toast</a></li><li><a href="/android/create-singleton-class-for-toast-message.html" class="sidebar-link">Create Singleton Class for Toast Message</a></li><li><a href="/android/interfaces.html" class="sidebar-link">Interfaces</a></li><li><a href="/android/animators.html" class="sidebar-link">Animators</a></li><li><a href="/android/location.html" class="sidebar-link">Location</a></li><li><a href="/android/theme-style-attribute.html" class="sidebar-link">Theme, Style, Attribute</a></li><li><a href="/android/mediaplayer.html" class="sidebar-link">MediaPlayer</a></li><li><a href="/android/android-sound-and-media.html" class="sidebar-link">Android Sound and Media</a></li><li><a href="/android/mediasession.html" class="sidebar-link">MediaSession</a></li><li><a href="/android/mediastore.html" class="sidebar-link">MediaStore</a></li><li><a href="/android/multidex-and-the-dex-method-limit.html" class="sidebar-link">Multidex and the Dex Method Limit</a></li><li><a href="/android/data-synchronization-with-sync-adapter.html" class="sidebar-link">Data Synchronization with Sync Adapter</a></li><li><a href="/android/porterduff-mode.html" class="sidebar-link">PorterDuff Mode</a></li><li><a href="/android/menu.html" class="sidebar-link">Menu</a></li><li><a href="/android/picasso.html" class="sidebar-link">Picasso</a></li><li><a href="/android/roboguice.html" class="sidebar-link">RoboGuice</a></li><li><a href="/android/acra.html" class="sidebar-link">ACRA</a></li><li><a href="/android/parcelable.html" class="sidebar-link">Parcelable</a></li><li><a href="/android/retrofit2.html" class="sidebar-link">Retrofit2</a></li><li><a href="/android/butterknife.html" class="sidebar-link">ButterKnife</a></li><li><a href="/android/volley.html" class="sidebar-link">Volley</a></li><li><a href="/android/date-and-time-pickers.html" class="sidebar-link">Date and Time Pickers</a></li><li><a href="/android/localized-date-time-in-android.html" class="sidebar-link">Localized Date/Time in Android</a></li><li><a href="/android/time-utils.html" class="sidebar-link">Time Utils</a></li><li><a href="/android/in-app-billing.html" class="sidebar-link">In-app Billing</a></li><li><a href="/android/floatingactionbutton.html" class="sidebar-link">FloatingActionButton</a></li><li><a href="/android/touch-events.html" class="sidebar-link">Touch Events</a></li><li><a href="/android/handling-touch-and-motion-events.html" class="sidebar-link">Handling touch and motion events</a></li><li><a href="/android/detect-shake-event-in-android.html" class="sidebar-link">Detect Shake Event in Android</a></li><li><a href="/android/hardware-button-events-intents-ptt-lwp-etc.html" class="sidebar-link">Hardware Button Events/Intents (PTT, LWP, etc.)</a></li><li><a href="/android/greenrobot-eventbus.html" class="sidebar-link">GreenRobot EventBus</a></li><li><a href="/android/otto-event-bus.html" class="sidebar-link">Otto Event Bus</a></li><li><a href="/android/vibration.html" class="sidebar-link">Vibration</a></li><li><a href="/android/contentprovider.html" class="sidebar-link">ContentProvider</a></li><li><a href="/android/dagger-2.html" class="sidebar-link">Dagger 2</a></li><li><a href="/android/realm.html" class="sidebar-link">Realm</a></li><li><a href="/android/android-versions.html" class="sidebar-link">Android Versions</a></li><li><a href="/android/wi-fi-connections.html" class="sidebar-link">Wi-Fi Connections</a></li><li><a href="/android/sensormanager.html" class="sidebar-link">SensorManager</a></li><li><a href="/android/progressbar.html" class="sidebar-link">ProgressBar</a></li><li><a href="/android/custom-fonts.html" class="sidebar-link">Custom Fonts</a></li><li><a href="/android/getting-system-font-names-and-using-the-fonts.html" class="sidebar-link">Getting system font names and using the fonts</a></li><li><a href="/android/text-to-speech-tts.html" class="sidebar-link">Text to Speech(TTS)</a></li><li><a href="/android/spinner.html" class="sidebar-link">Spinner</a></li><li><a href="/android/data-encryption-decryption.html" class="sidebar-link">Data Encryption/Decryption</a></li><li><a href="/android/okhttp.html" class="sidebar-link">OkHttp</a></li><li><a href="/android/handling-deep-links.html" class="sidebar-link">Handling Deep Links</a></li><li><a href="/android/crash-reporting-tools.html" class="sidebar-link">Crash Reporting Tools</a></li><li><a href="/android/check-internet-connectivity.html" class="sidebar-link">Check Internet Connectivity</a></li><li><a href="/android/creating-your-own-libraries-for-android-applications.html" class="sidebar-link">Creating your own libraries for Android applications</a></li><li><a href="/android/device-display-metrics.html" class="sidebar-link">Device Display Metrics</a></li><li><a href="/android/building-backwards-compatible-apps.html" class="sidebar-link">Building Backwards Compatible Apps</a></li><li><a href="/android/loader.html" class="sidebar-link">Loader</a></li><li><a href="/android/proguard-obfuscating-and-shrinking-your-code.html" class="sidebar-link">ProGuard - Obfuscating and Shrinking your code</a></li><li><a href="/android/typedef-annotations-intdef-stringdef.html" class="sidebar-link">Typedef Annotations: @IntDef, @StringDef</a></li><li><a href="/android/capturing-screenshots.html" class="sidebar-link">Capturing Screenshots</a></li><li><a href="/android/mvp-architecture.html" class="sidebar-link">MVP Architecture</a></li><li><a href="/android/orientation-changes.html" class="sidebar-link">Orientation Changes</a></li><li><a href="/android/xposed.html" class="sidebar-link">Xposed</a></li><li><a href="/android/packagemanager.html" class="sidebar-link">PackageManager</a></li><li><a href="/android/gesture-detection.html" class="sidebar-link">Gesture Detection</a></li><li><a href="/android/doze-mode.html" class="sidebar-link">Doze Mode</a></li><li><a href="/android/colors.html" class="sidebar-link">Colors</a></li><li><a href="/android/keyboard.html" class="sidebar-link">Keyboard</a></li><li><a href="/android/renderscript.html" class="sidebar-link">RenderScript</a></li><li><a href="/android/fresco.html" class="sidebar-link">Fresco</a></li><li><a href="/android/swipe-to-refresh.html" class="sidebar-link">Swipe to Refresh</a></li><li><a href="/android/creating-splash-screen.html" class="sidebar-link">Creating Splash screen</a></li><li><a href="/android/intentservice.html" class="sidebar-link">IntentService</a></li><li><a href="/android/implicit-intents.html" class="sidebar-link">Implicit Intents</a></li><li><a href="/android/publish-to-play-store.html" class="sidebar-link">Publish to Play Store</a></li><li><a href="/android/universal-image-loader.html" class="sidebar-link">Universal Image Loader</a></li><li><a href="/android/image-compression.html" class="sidebar-link">Image Compression</a></li><li><a href="/android/9-patch-images.html" class="sidebar-link">9-Patch Images</a></li><li><a href="/android/email-validation.html" class="sidebar-link">Email Validation</a></li><li><a href="/android/bottom-sheets.html" class="sidebar-link">Bottom Sheets</a></li><li><a href="/android/edittext.html" class="sidebar-link">EditText</a></li><li><a href="/android/speech-to-text-conversion.html" class="sidebar-link">Speech to Text Conversion</a></li><li><a href="/android/installing-apps-with-adb.html" class="sidebar-link">Installing apps with ADB</a></li><li><a href="/android/count-down-timer.html" class="sidebar-link">Count Down Timer</a></li><li><a href="/android/barcode-and-qr-code-reading.html" class="sidebar-link">Barcode and QR code reading</a></li><li><a href="/android/android-paypal-gateway-integration.html" class="sidebar-link">Android Paypal Gateway Integration</a></li><li><a href="/android/drawables.html" class="sidebar-link">Drawables</a></li><li><a href="/android/transitiondrawable.html" class="sidebar-link">TransitionDrawable</a></li><li><a href="/android/vector-drawables.html" class="sidebar-link">Vector Drawables</a></li><li><a href="/android/vectordrawable-and-animatedvectordrawable.html" class="sidebar-link">VectorDrawable and AnimatedVectorDrawable</a></li><li><a href="/android/port-mapping-using-cling-library-in-android.html" class="sidebar-link">Port Mapping using Cling library in Android</a></li><li><a href="/android/creating-overlay-always-on-top-windows.html" class="sidebar-link">Creating Overlay (always-on-top) Windows</a></li><li><a href="/android/exoplayer.html" class="sidebar-link">ExoPlayer</a></li><li><a href="/android/xmpp-register-login-and-chat-simple-example.html" class="sidebar-link">XMPP register login and chat simple example</a></li><li><a href="/android/android-authenticator.html" class="sidebar-link">Android Authenticator</a></li><li><a href="/android/audiomanager.html" class="sidebar-link">AudioManager</a></li><li><a href="/android/audiotrack.html" class="sidebar-link">AudioTrack</a></li><li><a href="/android/job-scheduling.html" class="sidebar-link">Job Scheduling</a></li><li><a href="/android/accounts-and-accountmanager.html" class="sidebar-link">Accounts and AccountManager</a></li><li><a href="/android/integrate-opencv-into-android-studio.html" class="sidebar-link">Integrate OpenCV into Android Studio</a></li><li><a href="/android/mvvm-architecture.html" class="sidebar-link">MVVM (Architecture)</a></li><li><a href="/android/ormlite-in-android.html" class="sidebar-link">ORMLite in android</a></li><li><a href="/android/retrofit2-with-rxjava.html" class="sidebar-link">Retrofit2 with RxJava</a></li><li><a href="/android/shortcutmanager.html" class="sidebar-link">ShortcutManager</a></li><li><a href="/android/lrucache.html" class="sidebar-link">LruCache</a></li><li><a href="/android/jenkins-ci-setup-for-android-projects.html" class="sidebar-link">Jenkins CI setup for Android Projects</a></li><li><a href="/android/fastlane.html" class="sidebar-link">fastlane</a></li><li><a href="/android/define-step-value-increment-for-custom-rangeseekbar.html" class="sidebar-link">Define step value (increment) for custom RangeSeekBar</a></li><li><a href="/android/getting-started-with-opengl-es-2-0.html" class="sidebar-link">Getting started with OpenGL ES 2.0+</a></li><li><a href="/android/check-data-connection.html" class="sidebar-link">Check Data Connection</a></li><li><a href="/android/java-on-android.html" class="sidebar-link">Java on Android</a></li><li><a href="/android/android-java-native-interface-jni.html" class="sidebar-link">Android Java Native Interface (JNI)</a></li><li><a href="/android/notification-channel-android-o.html" class="sidebar-link">Notification Channel Android O</a></li><li><a href="/android/robolectric.html" class="sidebar-link">Robolectric</a></li><li><a href="/android/moshi.html" class="sidebar-link">Moshi</a></li><li><a href="/android/strict-mode-policy-a-tool-to-catch-the-bug-in-the-compile-time.html" class="sidebar-link">Strict Mode Policy : A tool to catch the bug in the Compile Time.</a></li><li><a href="/android/internationalization-and-localization-i18n-and-l10n.html" class="sidebar-link">Internationalization and localization (I18N and L10N)</a></li><li><a href="/android/fast-way-to-setup-retrolambda-on-an-android-project.html" class="sidebar-link">Fast way to setup Retrolambda on an android project.</a></li><li><a href="/android/how-to-use-sparsearray.html" class="sidebar-link">How to use SparseArray</a></li><li><a href="/android/shared-element-transitions.html" class="sidebar-link">Shared Element Transitions</a></li><li><a href="/android/android-things.html" class="sidebar-link">Android Things</a></li><li><a href="/android/library-dagger-2-dependency-injection-in-applications.html" class="sidebar-link">Library Dagger 2: Dependency Injection in Applications</a></li><li><a href="/android/jcodec.html" class="sidebar-link">JCodec</a></li><li><a href="/android/formatting-phone-numbers-with-pattern.html" class="sidebar-link">Formatting phone numbers with pattern.</a></li><li><a href="/android/paint.html" class="sidebar-link">Paint</a></li><li><a href="/android/what-is-proguard-what-is-use-in-android.html" class="sidebar-link">What is ProGuard? What is use in Android?</a></li><li><a href="/android/create-android-custom-roms.html" class="sidebar-link">Create Android Custom ROMs</a></li><li><a href="/android/genymotion-for-android.html" class="sidebar-link">Genymotion for android</a></li><li><a href="/android/constraintset.html" class="sidebar-link">ConstraintSet</a></li><li><a href="/android/clevertap.html" class="sidebar-link">CleverTap</a></li><li><a href="/android/publish-a-library-to-maven-repositories.html" class="sidebar-link">Publish a library to Maven Repositories</a></li><li><a href="/android/adb-shell.html" class="sidebar-link">adb shell</a></li><li><a href="/android/ping-icmp.html" class="sidebar-link">Ping ICMP</a></li><li><a href="/android/aidl.html" class="sidebar-link">AIDL</a></li><li><a href="/android/android-game-development.html" class="sidebar-link">Android game development</a></li><li><a href="/android/android-programming-with-kotlin.html" class="sidebar-link">Android programming with Kotlin</a></li><li><a href="/android/android-x86-in-virtualbox.html" class="sidebar-link">Android-x86 in VirtualBox</a></li><li><a href="/android/leakcanary.html" class="sidebar-link">Leakcanary</a></li><li><a href="/android/okio.html" class="sidebar-link">Okio</a></li><li><a href="/android/bluetooth-low-energy.html" class="sidebar-link">Bluetooth Low Energy</a></li><li><a href="/android/looper.html" class="sidebar-link">Looper</a></li><li><a href="/android/annotation-processor.html" class="sidebar-link">Annotation Processor</a></li><li><a href="/android/syncadapter-with-periodically-do-sync-of-data.html" class="sidebar-link">SyncAdapter with periodically do sync of data</a></li><li><a href="/android/fastjson.html" class="sidebar-link">Fastjson</a></li><li><a href="/android/json-in-android-with-org-json.html" class="sidebar-link">JSON in Android with org.json</a></li><li><a href="/android/gson.html" class="sidebar-link">Gson</a></li><li><a href="/android/android-architecture-components.html" class="sidebar-link">Android Architecture Components</a></li><li><a href="/android/jackson.html" class="sidebar-link">Jackson</a></li><li><a href="/android/smartcard.html" class="sidebar-link">Smartcard</a></li><li><a href="/android/security.html" class="sidebar-link">Security</a></li><li><a href="/android/how-to-store-passwords-securely.html" class="sidebar-link">How to store passwords securely</a></li><li><a href="/android/secure-sharedpreferences.html" class="sidebar-link">Secure SharedPreferences</a></li><li><a href="/android/secure-sharedpreferences.html" class="sidebar-link">Secure SharedPreferences</a></li><li><a href="/android/sqlite.html" class="sidebar-link">SQLite</a></li><li><a href="/android/accessing-sqlite-databases-using-the-contentvalues-class.html" class="sidebar-link">Accessing SQLite databases using the ContentValues class</a></li><li><a href="/android/firebase.html" class="sidebar-link">Firebase</a></li><li><a href="/android/firebase-cloud-messaging.html" class="sidebar-link">Firebase Cloud Messaging</a></li><li><a href="/android/firebase-realtime-database.html" class="sidebar-link">Firebase Realtime DataBase</a></li><li><a href="/android/firebase-app-indexing.html" class="sidebar-link">Firebase App Indexing</a></li><li><a href="/android/firebase-crash-reporting.html" class="sidebar-link">Firebase Crash Reporting</a></li><li><a href="/android/twitter-apis.html" class="sidebar-link">Twitter APIs</a></li><li><a href="/android/youtube-api.html" class="sidebar-link">Youtube-API</a></li><li><a href="/android/integrate-google-sign-in.html" class="sidebar-link">Integrate Google Sign In</a></li><li><a href="/android/google-signin-integration-on-android.html" class="sidebar-link">Google signin integration on android</a></li><li><a href="/android/google-awareness-apis.html" class="sidebar-link">Google Awareness APIs</a></li><li><a href="/android/google-maps-api-v2-for-android.html" class="sidebar-link">Google Maps API v2 for Android</a></li><li><a href="/android/google-drive-api.html" class="sidebar-link">Google Drive API</a></li><li><a href="/android/displaying-google-ads.html" class="sidebar-link">Displaying Google Ads</a></li><li><a href="/android/admob.html" class="sidebar-link">AdMob</a></li><li><a href="/android/google-play-store.html" class="sidebar-link">Google Play Store</a></li><li><a href="/android/sign-your-android-app-for-release.html" class="sidebar-link">Sign your Android App for Release</a></li><li><a href="/android/tensorflow.html" class="sidebar-link">TensorFlow</a></li><li><a href="/android/android-vk-sdk.html" class="sidebar-link">Android Vk Sdk</a></li><li><a href="/android/project-sdk-versions.html" class="sidebar-link">Project SDK versions</a></li><li><a href="/android/facebook-sdk-for-android.html" class="sidebar-link">Facebook SDK for Android</a></li><li><a href="/android/thread.html" class="sidebar-link">Thread</a></li><li><a href="/android/asynctask.html" class="sidebar-link">AsyncTask</a></li><li><a href="/android/testing-ui-with-espresso.html" class="sidebar-link">Testing UI with Espresso</a></li><li><a href="/android/writing-ui-tests-android.html" class="sidebar-link">Writing UI tests - Android</a></li><li><a href="/android/unit-testing-in-android-with-junit.html" class="sidebar-link">Unit testing in Android with JUnit</a></li><li><a href="/android/inter-app-ui-testing-with-uiautomator.html" class="sidebar-link">Inter-app UI testing with UIAutomator</a></li><li><a href="/android/lint-warnings.html" class="sidebar-link">Lint Warnings</a></li><li><a href="/android/performance-optimization.html" class="sidebar-link">Performance Optimization</a></li><li><a href="/android/android-kernel-optimization.html" class="sidebar-link">Android Kernel Optimization</a></li><li><a href="/android/memory-leaks.html" class="sidebar-link">Memory Leaks</a></li><li><a href="/android/enhancing-android-performance-using-icon-fonts.html" class="sidebar-link">Enhancing Android Performance Using Icon Fonts</a></li><li><a href="/android/bitmap-cache.html" class="sidebar-link">Bitmap Cache</a></li><li><a href="/android/loading-bitmaps-effectively.html" class="sidebar-link">Loading Bitmaps Effectively</a></li><li><a href="/android/exceptions.html" class="sidebar-link">Exceptions</a></li><li><a href="/android/logging-and-using-logcat.html" class="sidebar-link">Logging and using Logcat</a></li><li><a href="/android/adb-android-debug-bridge.html" class="sidebar-link">ADB (Android Debug Bridge)</a></li><li><a href="/android/localization-with-resources-in-android.html" class="sidebar-link">Localization with resources in Android</a></li><li><a href="/android/convert-vietnamese-string-to-english-string-android.html" class="sidebar-link">Convert vietnamese string to english string Android</a></li><li><a href="/android/publish-aar-file-to-apache-archiva-with-gradle.html" class="sidebar-link">Publish .aar file to Apache Archiva with Gradle</a></li><li><a href="/android/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="camera-and-gallery"><a href="#camera-and-gallery" class="header-anchor">#</a> Camera and Gallery</h1> <h2 id="taking-full-sized-photo-from-camera"><a href="#taking-full-sized-photo-from-camera" class="header-anchor">#</a> Taking full-sized photo from camera</h2> <p>To take a photo, first we need to declare required permissions in <code>AndroidManifest.xml</code>. We need two permissions:</p> <ul><li><code>Camera</code> - to open camera app. If attribute <code>required</code> is set to <code>true</code> you will not be able to install this app if you don't have hardware camera.</li> <li><code>WRITE_EXTERNAL_STORAGE</code> - This permission is required to create new file, in which captured photo will be saved.</li></ul> <h3 id="androidmanifest-xml"><a href="#androidmanifest-xml" class="header-anchor">#</a> AndroidManifest.xml</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token operator">&lt;</span><span class="token keyword">uses</span><span class="token operator">-</span>feature android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">&quot;android.hardware.camera&quot;</span>
          android<span class="token operator">:</span>required<span class="token operator">=</span><span class="token string">&quot;true&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token keyword">uses</span><span class="token operator">-</span>permission android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>

</code></pre></div><p>The main idea in taking full-sized photo from camera is that we need to create new file for photo, before we open camera app and capture photo.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">dispatchTakePictureIntent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Intent</span> takePictureIntent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token class-name">MediaStore</span><span class="token punctuation">.</span>ACTION_IMAGE_CAPTURE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Ensure that there's a camera activity to handle the intent</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>takePictureIntent<span class="token punctuation">.</span><span class="token function">resolveActivity</span><span class="token punctuation">(</span><span class="token function">getPackageManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Create the File where the photo should go</span>
        <span class="token class-name">File</span> photoFile <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            photoFile <span class="token operator">=</span> <span class="token function">createImageFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token string">&quot;DEBUG_TAG&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;createFile&quot;</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// Continue only if the File was successfully created</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>photoFile <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            takePictureIntent<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token class-name">MediaStore</span><span class="token punctuation">.</span>EXTRA_OUTPUT<span class="token punctuation">,</span> <span class="token class-name">Uri</span><span class="token punctuation">.</span><span class="token function">fromFile</span><span class="token punctuation">(</span>photoFile<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">startActivityForResult</span><span class="token punctuation">(</span>takePictureIntent<span class="token punctuation">,</span> REQUEST_IMAGE_CAPTURE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token class-name">File</span> <span class="token function">createImageFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token comment">// Create an image file name</span>
    <span class="token class-name">String</span> timeStamp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyyMMdd_HHmmss&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Locale</span><span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> imageFileName <span class="token operator">=</span> <span class="token string">&quot;JPEG_&quot;</span> <span class="token operator">+</span> timeStamp <span class="token operator">+</span> <span class="token string">&quot;_&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">File</span> storageDir <span class="token operator">=</span> <span class="token function">getAlbumDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">File</span> image <span class="token operator">=</span> <span class="token class-name">File</span><span class="token punctuation">.</span><span class="token function">createTempFile</span><span class="token punctuation">(</span>
            imageFileName<span class="token punctuation">,</span>  <span class="token comment">/* prefix */</span>
            <span class="token string">&quot;.jpg&quot;</span><span class="token punctuation">,</span>         <span class="token comment">/* suffix */</span>
            storageDir      <span class="token comment">/* directory */</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Save a file: path for use with ACTION_VIEW intents</span>
    mCurrentPhotoPath <span class="token operator">=</span> image<span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> image<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token class-name">File</span> <span class="token function">getAlbumDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">File</span> storageDir <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Environment</span><span class="token punctuation">.</span>MEDIA_MOUNTED<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Environment</span><span class="token punctuation">.</span><span class="token function">getExternalStorageState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        storageDir <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token class-name">Environment</span><span class="token punctuation">.</span><span class="token function">getExternalStorageDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token operator">+</span> <span class="token string">&quot;/dcim/&quot;</span>
                <span class="token operator">+</span> <span class="token string">&quot;MyRecipes&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>storageDir<span class="token punctuation">.</span><span class="token function">mkdirs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>storageDir<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">&quot;CameraSample&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;failed to create directory&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>app_name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;External storage is not mounted READ/WRITE.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> storageDir<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">setPic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">/* There isn't enough memory to open up more than a couple camera photos */</span>
    <span class="token comment">/* So pre-scale the target bitmap into which the file is decoded */</span>

    <span class="token comment">/* Get the size of the ImageView */</span>
    <span class="token keyword">int</span> targetW <span class="token operator">=</span> recipeImage<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> targetH <span class="token operator">=</span> recipeImage<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* Get the size of the image */</span>
    <span class="token class-name">BitmapFactory<span class="token punctuation">.</span>Options</span> bmOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BitmapFactory<span class="token punctuation">.</span>Options</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    bmOptions<span class="token punctuation">.</span>inJustDecodeBounds <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token class-name">BitmapFactory</span><span class="token punctuation">.</span><span class="token function">decodeFile</span><span class="token punctuation">(</span>mCurrentPhotoPath<span class="token punctuation">,</span> bmOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> photoW <span class="token operator">=</span> bmOptions<span class="token punctuation">.</span>outWidth<span class="token punctuation">;</span>
    <span class="token keyword">int</span> photoH <span class="token operator">=</span> bmOptions<span class="token punctuation">.</span>outHeight<span class="token punctuation">;</span>

    <span class="token comment">/* Figure out which way needs to be reduced less */</span>
    <span class="token keyword">int</span> scaleFactor <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>targetW <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>targetH <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        scaleFactor <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>photoW <span class="token operator">/</span> targetW<span class="token punctuation">,</span> photoH <span class="token operator">/</span> targetH<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/* Set bitmap options to scale the image decode target */</span>
    bmOptions<span class="token punctuation">.</span>inJustDecodeBounds <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    bmOptions<span class="token punctuation">.</span>inSampleSize <span class="token operator">=</span> scaleFactor<span class="token punctuation">;</span>
    bmOptions<span class="token punctuation">.</span>inPurgeable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token class-name">Matrix</span> matrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    matrix<span class="token punctuation">.</span><span class="token function">postRotate</span><span class="token punctuation">(</span><span class="token function">getRotation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* Decode the JPEG file into a Bitmap */</span>
    <span class="token class-name">Bitmap</span> bitmap <span class="token operator">=</span> <span class="token class-name">BitmapFactory</span><span class="token punctuation">.</span><span class="token function">decodeFile</span><span class="token punctuation">(</span>mCurrentPhotoPath<span class="token punctuation">,</span> bmOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
    bitmap <span class="token operator">=</span> <span class="token class-name">Bitmap</span><span class="token punctuation">.</span><span class="token function">createBitmap</span><span class="token punctuation">(</span>bitmap<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> bitmap<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bitmap<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> matrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* Associate the Bitmap to the ImageView */</span>
    recipeImage<span class="token punctuation">.</span><span class="token function">setImageBitmap</span><span class="token punctuation">(</span>bitmap<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">float</span> <span class="token function">getRotation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">ExifInterface</span> ei <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ExifInterface</span><span class="token punctuation">(</span>mCurrentPhotoPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> orientation <span class="token operator">=</span> ei<span class="token punctuation">.</span><span class="token function">getAttributeInt</span><span class="token punctuation">(</span><span class="token class-name">ExifInterface</span><span class="token punctuation">.</span>TAG_ORIENTATION<span class="token punctuation">,</span> <span class="token class-name">ExifInterface</span><span class="token punctuation">.</span>ORIENTATION_NORMAL<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">switch</span> <span class="token punctuation">(</span>orientation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token class-name">ExifInterface</span><span class="token punctuation">.</span>ORIENTATION_ROTATE_90<span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token number">90f</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token class-name">ExifInterface</span><span class="token punctuation">.</span>ORIENTATION_ROTATE_180<span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token number">180f</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token class-name">ExifInterface</span><span class="token punctuation">.</span>ORIENTATION_ROTATE_270<span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token number">270f</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token number">0f</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token string">&quot;Add Recipe&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;getRotation&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">0f</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">galleryAddPic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Intent</span> mediaScanIntent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span>ACTION_MEDIA_SCANNER_SCAN_FILE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">File</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>mCurrentPhotoPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Uri</span> contentUri <span class="token operator">=</span> <span class="token class-name">Uri</span><span class="token punctuation">.</span><span class="token function">fromFile</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mediaScanIntent<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span>contentUri<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sendBroadcast</span><span class="token punctuation">(</span>mediaScanIntent<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">handleBigCameraPhoto</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>mCurrentPhotoPath <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setPic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">galleryAddPic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onActivityResult</span><span class="token punctuation">(</span><span class="token keyword">int</span> requestCode<span class="token punctuation">,</span> <span class="token keyword">int</span> resultCode<span class="token punctuation">,</span> <span class="token class-name">Intent</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onActivityResult</span><span class="token punctuation">(</span>requestCode<span class="token punctuation">,</span> resultCode<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>requestCode <span class="token operator">==</span> REQUEST_IMAGE_CAPTURE <span class="token operator">&amp;&amp;</span> resultCode <span class="token operator">==</span> <span class="token class-name">Activity</span><span class="token punctuation">.</span>RESULT_OK<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">handleBigCameraPhoto</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="take-photo"><a href="#take-photo" class="header-anchor">#</a> Take photo</h2> <p>Add a permission to access the camera to the AndroidManifest file:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token operator">&lt;</span><span class="token keyword">uses</span><span class="token operator">-</span>permission android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">&quot;android.permission.CAMERA&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">uses</span><span class="token operator">-</span>permission<span class="token operator">&gt;</span>  
<span class="token operator">&lt;</span><span class="token keyword">uses</span><span class="token operator">-</span>permission android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>

</code></pre></div><p>Xml file :</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">&quot;1.0&quot;</span> encoding<span class="token operator">=</span><span class="token string">&quot;utf-8&quot;</span><span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token class-name">LinearLayout</span> xmlns<span class="token operator">:</span>android<span class="token operator">=</span><span class="token string">&quot;http://schemas.android.com/apk/res/android&quot;</span>
    android<span class="token operator">:</span>orientation<span class="token operator">=</span><span class="token string">&quot;vertical&quot;</span>
    android<span class="token operator">:</span>layout_width<span class="token operator">=</span><span class="token string">&quot;fill_parent&quot;</span>
    android<span class="token operator">:</span>layout_height<span class="token operator">=</span><span class="token string">&quot;fill_parent&quot;</span>
    <span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token class-name">SurfaceView</span> android<span class="token operator">:</span>id<span class="token operator">=</span><span class="token string">&quot;@+id/surfaceView&quot;</span> android<span class="token operator">:</span>layout_height<span class="token operator">=</span><span class="token string">&quot;0dip&quot;</span> android<span class="token operator">:</span>layout_width<span class="token operator">=</span><span class="token string">&quot;0dip&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token class-name">SurfaceView</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token class-name">ImageView</span> android<span class="token operator">:</span>layout_width<span class="token operator">=</span><span class="token string">&quot;wrap_content&quot;</span> android<span class="token operator">:</span>layout_height<span class="token operator">=</span><span class="token string">&quot;wrap_content&quot;</span> android<span class="token operator">:</span>id<span class="token operator">=</span><span class="token string">&quot;@+id/imageView&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token class-name">ImageView</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token class-name">LinearLayout</span><span class="token operator">&gt;</span>

</code></pre></div><p>Activity</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>  
  
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>app<span class="token punctuation">.</span></span><span class="token class-name">Activity</span><span class="token punctuation">;</span>  
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span></span><span class="token class-name">Bitmap</span><span class="token punctuation">;</span>  
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span></span><span class="token class-name">BitmapFactory</span><span class="token punctuation">;</span>  
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>hardware<span class="token punctuation">.</span></span><span class="token class-name">Camera</span><span class="token punctuation">;</span>  
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>hardware<span class="token punctuation">.</span></span><span class="token class-name">Camera<span class="token punctuation">.</span>Parameters</span><span class="token punctuation">;</span>  
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span><span class="token class-name">Bundle</span><span class="token punctuation">;</span>  
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">SurfaceHolder</span><span class="token punctuation">;</span>  
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">SurfaceView</span><span class="token punctuation">;</span>  
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span></span><span class="token class-name">ImageView</span><span class="token punctuation">;</span>  
  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TakePicture</span> <span class="token keyword">extends</span> <span class="token class-name">Activity</span> <span class="token keyword">implements</span> <span class="token class-name">SurfaceHolder<span class="token punctuation">.</span>Callback</span>  
<span class="token punctuation">{</span>  
    <span class="token comment">//a variable to store a reference to the Image View at the main.xml file  </span>
    <span class="token keyword">private</span> <span class="token class-name">ImageView</span> iv_image<span class="token punctuation">;</span>  
    <span class="token comment">//a variable to store a reference to the Surface View at the main.xml file  </span>
    <span class="token keyword">private</span> <span class="token class-name">SurfaceView</span> sv<span class="token punctuation">;</span>  
  
    <span class="token comment">//a bitmap to display the captured image  </span>
    <span class="token keyword">private</span> <span class="token class-name">Bitmap</span> bmp<span class="token punctuation">;</span>  
  
    <span class="token comment">//Camera variables  </span>
    <span class="token comment">//a surface holder  </span>
    <span class="token keyword">private</span> <span class="token class-name">SurfaceHolder</span> sHolder<span class="token punctuation">;</span>  
    <span class="token comment">//a variable to control the camera  </span>
    <span class="token keyword">private</span> <span class="token class-name">Camera</span> mCamera<span class="token punctuation">;</span>  
    <span class="token comment">//the camera parameters  </span>
    <span class="token keyword">private</span> <span class="token class-name">Parameters</span> parameters<span class="token punctuation">;</span>  
  
    <span class="token comment">/** Called when the activity is first created. */</span>  
    <span class="token annotation punctuation">@Override</span>  
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span>  
    <span class="token punctuation">{</span>  
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>main<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
        <span class="token comment">//get the Image View at the main.xml file  </span>
        iv_image <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ImageView</span><span class="token punctuation">)</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>imageView<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
        <span class="token comment">//get the Surface View at the main.xml file  </span>
        sv <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SurfaceView</span><span class="token punctuation">)</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>surfaceView<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
        <span class="token comment">//Get a surface  </span>
        sHolder <span class="token operator">=</span> sv<span class="token punctuation">.</span><span class="token function">getHolder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
        <span class="token comment">//add the callback interface methods defined below as the Surface View callbacks  </span>
        sHolder<span class="token punctuation">.</span><span class="token function">addCallback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
        <span class="token comment">//tells Android that this surface will have its data constantly replaced  </span>
        sHolder<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token class-name">SurfaceHolder</span><span class="token punctuation">.</span>SURFACE_TYPE_PUSH_BUFFERS<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
  
    <span class="token annotation punctuation">@Override</span>  
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">surfaceChanged</span><span class="token punctuation">(</span><span class="token class-name">SurfaceHolder</span> arg0<span class="token punctuation">,</span> <span class="token keyword">int</span> arg1<span class="token punctuation">,</span> <span class="token keyword">int</span> arg2<span class="token punctuation">,</span> <span class="token keyword">int</span> arg3<span class="token punctuation">)</span>  
    <span class="token punctuation">{</span>  
         <span class="token comment">//get camera parameters  </span>
         parameters <span class="token operator">=</span> mCamera<span class="token punctuation">.</span><span class="token function">getParameters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
         <span class="token comment">//set camera parameters  </span>
         mCamera<span class="token punctuation">.</span><span class="token function">setParameters</span><span class="token punctuation">(</span>parameters<span class="token punctuation">)</span><span class="token punctuation">;</span>  
         mCamera<span class="token punctuation">.</span><span class="token function">startPreview</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
         <span class="token comment">//sets what code should be executed after the picture is taken  </span>
         <span class="token class-name">Camera<span class="token punctuation">.</span>PictureCallback</span> mCall <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Camera<span class="token punctuation">.</span>PictureCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  
         <span class="token punctuation">{</span>  
             <span class="token annotation punctuation">@Override</span>  
             <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onPictureTaken</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data<span class="token punctuation">,</span> <span class="token class-name">Camera</span> camera<span class="token punctuation">)</span>  
             <span class="token punctuation">{</span>  
                 <span class="token comment">//decode the data obtained by the camera into a Bitmap  </span>
                 bmp <span class="token operator">=</span> <span class="token class-name">BitmapFactory</span><span class="token punctuation">.</span><span class="token function">decodeByteArray</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>  
                <span class="token class-name">String</span> filename<span class="token operator">=</span><span class="token class-name">Environment</span><span class="token punctuation">.</span><span class="token function">getExternalStorageDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token string">&quot;testimage.jpg&quot;</span><span class="token punctuation">;</span>
                <span class="token class-name">FileOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    bmp<span class="token punctuation">.</span><span class="token function">compress</span><span class="token punctuation">(</span><span class="token class-name">Bitmap<span class="token punctuation">.</span>CompressFormat</span><span class="token punctuation">.</span>PNG<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// bmp is your Bitmap instance</span>
                    <span class="token comment">// PNG is a lossless format, the compression factor (100) is ignored</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>out <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                 <span class="token comment">//set the iv_image  </span>
                 iv_image<span class="token punctuation">.</span><span class="token function">setImageBitmap</span><span class="token punctuation">(</span>bmp<span class="token punctuation">)</span><span class="token punctuation">;</span>  
             <span class="token punctuation">}</span>  
         <span class="token punctuation">}</span><span class="token punctuation">;</span>  
  
         mCamera<span class="token punctuation">.</span><span class="token function">takePicture</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> mCall<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
  
    <span class="token annotation punctuation">@Override</span>  
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">surfaceCreated</span><span class="token punctuation">(</span><span class="token class-name">SurfaceHolder</span> holder<span class="token punctuation">)</span>  
    <span class="token punctuation">{</span>  
        <span class="token comment">// The Surface has been created, acquire the camera and tell it where  </span>
        <span class="token comment">// to draw the preview.  </span>
        mCamera <span class="token operator">=</span> <span class="token class-name">Camera</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token keyword">try</span> <span class="token punctuation">{</span>  
           mCamera<span class="token punctuation">.</span><span class="token function">setPreviewDisplay</span><span class="token punctuation">(</span>holder<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
            mCamera<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
            mCamera <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  
        <span class="token punctuation">}</span>  
    <span class="token punctuation">}</span>  
  
    <span class="token annotation punctuation">@Override</span>  
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">surfaceDestroyed</span><span class="token punctuation">(</span><span class="token class-name">SurfaceHolder</span> holder<span class="token punctuation">)</span>  
    <span class="token punctuation">{</span>  
        <span class="token comment">//stop the preview  </span>
        mCamera<span class="token punctuation">.</span><span class="token function">stopPreview</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token comment">//release the camera  </span>
        mCamera<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token comment">//unbind the camera from this object  </span>
        mCamera <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>  

</code></pre></div><h2 id="how-to-start-camera-or-gallery-and-save-camera-result-to-storage"><a href="#how-to-start-camera-or-gallery-and-save-camera-result-to-storage" class="header-anchor">#</a> How to start camera or gallery and save camera result to storage</h2> <p>First of all you need <code>Uri</code> and temp Folders and request codes :</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> REQUEST_SELECT_PICTURE <span class="token operator">=</span> <span class="token number">0x01</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> REQUEST_CODE_TAKE_PICTURE <span class="token operator">=</span> <span class="token number">0x2</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> TEMP_PHOTO_FILE_NAME <span class="token operator">=</span><span class="token string">&quot;photo_&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">Uri</span> mImageCaptureUri<span class="token punctuation">;</span>
<span class="token class-name">File</span> mFileTemp<span class="token punctuation">;</span>

</code></pre></div><p>Then init mFileTemp :</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initTempFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">String</span> state <span class="token operator">=</span> <span class="token class-name">Environment</span><span class="token punctuation">.</span><span class="token function">getExternalStorageState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Environment</span><span class="token punctuation">.</span>MEDIA_MOUNTED<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        mFileTemp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token class-name">Environment</span><span class="token punctuation">.</span><span class="token function">getExternalStorageDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator
                <span class="token operator">+</span> <span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>app_foldername<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator
                <span class="token operator">+</span> <span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>pictures_folder<span class="token punctuation">)</span>
                <span class="token punctuation">,</span> TEMP_PHOTO_FILE_NAME
                <span class="token operator">+</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mFileTemp<span class="token punctuation">.</span><span class="token function">getParentFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mkdirs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        mFileTemp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token function">getFilesDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator
                <span class="token operator">+</span> <span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>app_foldername<span class="token punctuation">)</span>
                <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>pictures_folder<span class="token punctuation">)</span>
                <span class="token punctuation">,</span> TEMP_PHOTO_FILE_NAME <span class="token operator">+</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mFileTemp<span class="token punctuation">.</span><span class="token function">getParentFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mkdirs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>Opening <code>Camera</code> and <code>Gallery</code> intents :</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">openCamera</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token class-name">MediaStore</span><span class="token punctuation">.</span>ACTION_IMAGE_CAPTURE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        mImageCaptureUri <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> state <span class="token operator">=</span> <span class="token class-name">Environment</span><span class="token punctuation">.</span><span class="token function">getExternalStorageState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Environment</span><span class="token punctuation">.</span>MEDIA_MOUNTED<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mImageCaptureUri <span class="token operator">=</span> <span class="token class-name">Uri</span><span class="token punctuation">.</span><span class="token function">fromFile</span><span class="token punctuation">(</span>mFileTemp<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>

            mImageCaptureUri <span class="token operator">=</span> <span class="token class-name">InternalStorageContentProvider</span><span class="token punctuation">.</span>CONTENT_URI<span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
        intent<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token class-name">MediaStore</span><span class="token punctuation">.</span>EXTRA_OUTPUT<span class="token punctuation">,</span> mImageCaptureUri<span class="token punctuation">)</span><span class="token punctuation">;</span>
        intent<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">&quot;return-data&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">startActivityForResult</span><span class="token punctuation">(</span>intent<span class="token punctuation">,</span> REQUEST_CODE_TAKE_PICTURE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;cannot take picture&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">openGallery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Build</span><span class="token punctuation">.</span>VERSION<span class="token punctuation">.</span>SDK_INT <span class="token operator">&gt;=</span> <span class="token class-name">Build</span><span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>JELLY_BEAN
            <span class="token operator">&amp;&amp;</span> <span class="token class-name">ActivityCompat</span><span class="token punctuation">.</span><span class="token function">checkSelfPermission</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token class-name">Manifest</span><span class="token punctuation">.</span>permission<span class="token punctuation">.</span>READ_EXTERNAL_STORAGE<span class="token punctuation">)</span>
            <span class="token operator">!=</span> <span class="token class-name">PackageManager</span><span class="token punctuation">.</span>PERMISSION_GRANTED<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">requestPermission</span><span class="token punctuation">(</span><span class="token class-name">Manifest</span><span class="token punctuation">.</span>permission<span class="token punctuation">.</span>READ_EXTERNAL_STORAGE<span class="token punctuation">,</span>
                <span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>permission_read_storage_rationale<span class="token punctuation">)</span><span class="token punctuation">,</span>
                REQUEST_STORAGE_READ_ACCESS_PERMISSION<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intent<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token string">&quot;image/*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intent<span class="token punctuation">.</span><span class="token function">setAction</span><span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span>ACTION_GET_CONTENT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        intent<span class="token punctuation">.</span><span class="token function">addCategory</span><span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span>CATEGORY_OPENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">startActivityForResult</span><span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token function">createChooser</span><span class="token punctuation">(</span>intent<span class="token punctuation">,</span> <span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>select_image<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> REQUEST_SELECT_PICTURE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre></div><p>Then in <code>onActivityResult</code> method :</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onActivityResult</span><span class="token punctuation">(</span><span class="token keyword">int</span> requestCode<span class="token punctuation">,</span> <span class="token keyword">int</span> resultCode<span class="token punctuation">,</span> <span class="token class-name">Intent</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>resultCode <span class="token operator">!=</span> RESULT_OK<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Bitmap</span> bitmap<span class="token punctuation">;</span>

    <span class="token keyword">switch</span> <span class="token punctuation">(</span>requestCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">case</span> REQUEST_SELECT_PICTURE<span class="token operator">:</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">Uri</span> uri <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    bitmap <span class="token operator">=</span> <span class="token class-name">MediaStore<span class="token punctuation">.</span>Images<span class="token punctuation">.</span>Media</span><span class="token punctuation">.</span><span class="token function">getBitmap</span><span class="token punctuation">(</span><span class="token function">getContentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> uri<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">Bitmap</span> bitmapScaled <span class="token operator">=</span> <span class="token class-name">Bitmap</span><span class="token punctuation">.</span><span class="token function">createScaledBitmap</span><span class="token punctuation">(</span>bitmap<span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">Drawable</span> drawable<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">BitmapDrawable</span><span class="token punctuation">(</span>bitmapScaled<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    mImage<span class="token punctuation">.</span><span class="token function">setImageDrawable</span><span class="token punctuation">(</span>drawable<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    mImage<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span>VISIBLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span><span class="token string">&quot;act result&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;there is an error : &quot;</span><span class="token operator">+</span>e<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span><span class="token string">&quot;act result&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;there is an error : &quot;</span><span class="token operator">+</span>e<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> REQUEST_CODE_TAKE_PICTURE<span class="token operator">:</span>
            <span class="token keyword">try</span><span class="token punctuation">{</span>
               <span class="token class-name">Bitmap</span> bitmappicture <span class="token operator">=</span> <span class="token class-name">MediaStore<span class="token punctuation">.</span>Images<span class="token punctuation">.</span>Media</span><span class="token punctuation">.</span><span class="token function">getBitmap</span><span class="token punctuation">(</span><span class="token function">getContentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">,</span> mImageCaptureUri<span class="token punctuation">)</span><span class="token punctuation">;</span>
               mImage<span class="token punctuation">.</span><span class="token function">setImageBitmap</span><span class="token punctuation">(</span>bitmappicture<span class="token punctuation">)</span><span class="token punctuation">;</span>
               mImage<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span>VISIBLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
              <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span><span class="token string">&quot;error camera&quot;</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
           <span class="token keyword">break</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onActivityResult</span><span class="token punctuation">(</span>requestCode<span class="token punctuation">,</span> resultCode<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>You need theese permissions in <code>AndroidManifest.xml</code> :</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token operator">&lt;</span><span class="token keyword">uses</span><span class="token operator">-</span>permission android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">&quot;android.permission.READ_EXTERNAL_STORAGE&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token keyword">uses</span><span class="token operator">-</span>permission android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token keyword">uses</span><span class="token operator">-</span>permission android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">&quot;android.permission.CAMERA&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>

</code></pre></div><p>And you need to handle <a href="https://developer.android.com/training/permissions/requesting.html" target="_blank" rel="noopener noreferrer">runtime permissions<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> such as Read/Write external storage etc ...</p> <p>I am checking <code>READ_EXTERNAL_STORAGE</code> permission in my <code>openGallery</code> method :</p> <p>My <code>requestPermission</code> method :</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">requestPermission</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> permission<span class="token punctuation">,</span> <span class="token class-name">String</span> rationale<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token keyword">int</span> requestCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ActivityCompat</span><span class="token punctuation">.</span><span class="token function">shouldShowRequestPermissionRationale</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> permission<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">showAlertDialog</span><span class="token punctuation">(</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>permission_title_rationale<span class="token punctuation">)</span><span class="token punctuation">,</span> rationale<span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">DialogInterface<span class="token punctuation">.</span>OnClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">DialogInterface</span> dialog<span class="token punctuation">,</span> <span class="token keyword">int</span> which<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">ActivityCompat</span><span class="token punctuation">.</span><span class="token function">requestPermissions</span><span class="token punctuation">(</span><span class="token class-name">BasePermissionActivity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span>
                                <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>permission<span class="token punctuation">}</span><span class="token punctuation">,</span> requestCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">android<span class="token punctuation">.</span></span>R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>ok<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">android<span class="token punctuation">.</span></span>R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>cancel<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token class-name">ActivityCompat</span><span class="token punctuation">.</span><span class="token function">requestPermissions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>permission<span class="token punctuation">}</span><span class="token punctuation">,</span> requestCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>Then Override  <code>onRequestPermissionsResult</code> method :</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onRequestPermissionsResult</span><span class="token punctuation">(</span><span class="token keyword">int</span> requestCode<span class="token punctuation">,</span> <span class="token annotation punctuation">@NonNull</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> permissions<span class="token punctuation">,</span> <span class="token annotation punctuation">@NonNull</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> grantResults<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>requestCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> REQUEST_STORAGE_READ_ACCESS_PERMISSION<span class="token operator">:</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>grantResults<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token class-name">PackageManager</span><span class="token punctuation">.</span>PERMISSION_GRANTED<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">handleGallery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onRequestPermissionsResult</span><span class="token punctuation">(</span>requestCode<span class="token punctuation">,</span> permissions<span class="token punctuation">,</span> grantResults<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p><code>showAlertDialog</code> method :</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">showAlertDialog</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> title<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> message<span class="token punctuation">,</span>
                               <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">DialogInterface<span class="token punctuation">.</span>OnClickListener</span> onPositiveButtonClickListener<span class="token punctuation">,</span>
                               <span class="token annotation punctuation">@NonNull</span> <span class="token class-name">String</span> positiveText<span class="token punctuation">,</span>
                               <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">DialogInterface<span class="token punctuation">.</span>OnClickListener</span> onNegativeButtonClickListener<span class="token punctuation">,</span>
                               <span class="token annotation punctuation">@NonNull</span> <span class="token class-name">String</span> negativeText<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">AlertDialog<span class="token punctuation">.</span>Builder</span> builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlertDialog<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    builder<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>
    builder<span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    builder<span class="token punctuation">.</span><span class="token function">setPositiveButton</span><span class="token punctuation">(</span>positiveText<span class="token punctuation">,</span> onPositiveButtonClickListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
    builder<span class="token punctuation">.</span><span class="token function">setNegativeButton</span><span class="token punctuation">(</span>negativeText<span class="token punctuation">,</span> onNegativeButtonClickListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mAlertDialog <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="set-camera-resolution"><a href="#set-camera-resolution" class="header-anchor">#</a> Set camera resolution</h2> <p>Set High resolution programmatically.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Camera</span> mCamera <span class="token operator">=</span> <span class="token class-name">Camera</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Camera<span class="token punctuation">.</span>Parameters</span> params <span class="token operator">=</span> mCamera<span class="token punctuation">.</span><span class="token function">getParameters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Check what resolutions are supported by your camera</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Size</span><span class="token punctuation">&gt;</span></span> sizes <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">getSupportedPictureSizes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Iterate through all available resolutions and choose one.</span>
<span class="token comment">// The chosen resolution will be stored in mSize.</span>
<span class="token class-name">Size</span> mSize<span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Size</span> size <span class="token operator">:</span> sizes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;Available resolution: &quot;</span><span class="token operator">+</span>size<span class="token punctuation">.</span>width<span class="token operator">+</span><span class="token string">&quot; &quot;</span><span class="token operator">+</span>size<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mSize <span class="token operator">=</span> size<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;Chosen resolution: &quot;</span><span class="token operator">+</span>mSize<span class="token punctuation">.</span>width<span class="token operator">+</span><span class="token string">&quot; &quot;</span><span class="token operator">+</span>mSize<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
params<span class="token punctuation">.</span><span class="token function">setPictureSize</span><span class="token punctuation">(</span>mSize<span class="token punctuation">.</span>width<span class="token punctuation">,</span> mSize<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
mCamera<span class="token punctuation">.</span><span class="token function">setParameters</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span> 

</code></pre></div><h2 id="decode-bitmap-correctly-rotated-from-the-uri-fetched-with-the-intent"><a href="#decode-bitmap-correctly-rotated-from-the-uri-fetched-with-the-intent" class="header-anchor">#</a> Decode bitmap correctly rotated from the uri fetched with the intent</h2> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> TAG <span class="token operator">=</span> <span class="token string">&quot;IntentBitmapFetch&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> COLON_SEPARATOR <span class="token operator">=</span> <span class="token string">&quot;:&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> IMAGE <span class="token operator">=</span> <span class="token string">&quot;image&quot;</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">public</span> <span class="token class-name">Bitmap</span> <span class="token function">getBitmap</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">Uri</span> bitmapUri<span class="token punctuation">,</span> <span class="token keyword">int</span> maxDimen<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">InputStream</span> is <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getContentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">openInputStream</span><span class="token punctuation">(</span>bitmapUri<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Bitmap</span> bitmap <span class="token operator">=</span> <span class="token class-name">BitmapFactory</span><span class="token punctuation">.</span><span class="token function">decodeStream</span><span class="token punctuation">(</span>is<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token function">getBitmapOptions</span><span class="token punctuation">(</span>bitmapUri<span class="token punctuation">,</span> maxDimen<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">int</span> imgRotation <span class="token operator">=</span> <span class="token function">getImageRotationDegrees</span><span class="token punctuation">(</span>bitmapUri<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> endRotation <span class="token operator">=</span> <span class="token punctuation">(</span>imgRotation <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token operator">-</span>imgRotation <span class="token operator">:</span> imgRotation<span class="token punctuation">;</span>
    endRotation <span class="token operator">%=</span> <span class="token number">360</span><span class="token punctuation">;</span>
    endRotation <span class="token operator">=</span> <span class="token number">90</span> <span class="token operator">*</span> <span class="token punctuation">(</span>endRotation <span class="token operator">/</span> <span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>endRotation <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> bitmap <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Matrix</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        m<span class="token punctuation">.</span><span class="token function">setRotate</span><span class="token punctuation">(</span>endRotation<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Bitmap</span> tmp <span class="token operator">=</span> <span class="token class-name">Bitmap</span><span class="token punctuation">.</span><span class="token function">createBitmap</span><span class="token punctuation">(</span>bitmap<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> bitmap<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bitmap<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>tmp <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            bitmap<span class="token punctuation">.</span><span class="token function">recycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            bitmap <span class="token operator">=</span> tmp<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> bitmap<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token class-name">BitmapFactory<span class="token punctuation">.</span>Options</span> <span class="token function">getBitmapOptions</span><span class="token punctuation">(</span><span class="token class-name">Uri</span> uri<span class="token punctuation">,</span> <span class="token keyword">int</span> imageMaxDimen<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">BitmapFactory<span class="token punctuation">.</span>Options</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BitmapFactory<span class="token punctuation">.</span>Options</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>imageMaxDimen <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        options<span class="token punctuation">.</span>inJustDecodeBounds <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token function">decodeImage</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> uri<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
        options<span class="token punctuation">.</span>inSampleSize <span class="token operator">=</span> <span class="token function">calculateScaleFactor</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> imageMaxDimen<span class="token punctuation">)</span><span class="token punctuation">;</span>
        options<span class="token punctuation">.</span>inJustDecodeBounds <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        options<span class="token punctuation">.</span>inPreferredConfig <span class="token operator">=</span> <span class="token class-name">Bitmap<span class="token punctuation">.</span>Config</span><span class="token punctuation">.</span>RGB_565<span class="token punctuation">;</span>
        <span class="token function">addInBitmapOptions</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">int</span> <span class="token function">calculateScaleFactor</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">BitmapFactory<span class="token punctuation">.</span>Options</span> bitmapOptionsMeasureOnly<span class="token punctuation">,</span> <span class="token keyword">int</span> imageMaxDimen<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> inSampleSize <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>bitmapOptionsMeasureOnly<span class="token punctuation">.</span>outHeight <span class="token operator">&gt;</span> imageMaxDimen <span class="token operator">||</span> bitmapOptionsMeasureOnly<span class="token punctuation">.</span>outWidth <span class="token operator">&gt;</span> imageMaxDimen<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> halfHeight <span class="token operator">=</span> bitmapOptionsMeasureOnly<span class="token punctuation">.</span>outHeight <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> halfWidth <span class="token operator">=</span> bitmapOptionsMeasureOnly<span class="token punctuation">.</span>outWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>halfHeight <span class="token operator">/</span> inSampleSize<span class="token punctuation">)</span> <span class="token operator">&gt;</span> imageMaxDimen <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>halfWidth <span class="token operator">/</span> inSampleSize<span class="token punctuation">)</span> <span class="token operator">&gt;</span> imageMaxDimen<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            inSampleSize <span class="token operator">*=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> inSampleSize<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getImageRotationDegrees</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">Uri</span> imgUri<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> photoRotation <span class="token operator">=</span> <span class="token class-name">ExifInterface</span><span class="token punctuation">.</span>ORIENTATION_UNDEFINED<span class="token punctuation">;</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">boolean</span> hasRotation <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token comment">//If image comes from the gallery and is not in the folder DCIM (Scheme: content://)</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> projection <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">MediaStore<span class="token punctuation">.</span>Images<span class="token punctuation">.</span>ImageColumns</span><span class="token punctuation">.</span>ORIENTATION<span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token class-name">Cursor</span> cursor <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getContentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>imgUri<span class="token punctuation">,</span> projection<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cursor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">.</span><span class="token function">getColumnCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> cursor<span class="token punctuation">.</span><span class="token function">moveToFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                photoRotation <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span><span class="token function">getColumnIndex</span><span class="token punctuation">(</span>projection<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                hasRotation <span class="token operator">=</span> photoRotation <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">&quot;Cursor orientation: &quot;</span><span class="token operator">+</span> photoRotation<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            cursor<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//If image comes from the camera (Scheme: file://) or is from the folder DCIM (Scheme: content://)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hasRotation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">ExifInterface</span> exif <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ExifInterface</span><span class="token punctuation">(</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span>imgUri<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> exifRotation <span class="token operator">=</span> exif<span class="token punctuation">.</span><span class="token function">getAttributeInt</span><span class="token punctuation">(</span><span class="token class-name">ExifInterface</span><span class="token punctuation">.</span>TAG_ORIENTATION<span class="token punctuation">,</span>
                    <span class="token class-name">ExifInterface</span><span class="token punctuation">.</span>ORIENTATION_NORMAL<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>exifRotation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">case</span> <span class="token class-name">ExifInterface</span><span class="token punctuation">.</span>ORIENTATION_ROTATE_90<span class="token operator">:</span> <span class="token punctuation">{</span>
                    photoRotation <span class="token operator">=</span> <span class="token number">90</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">case</span> <span class="token class-name">ExifInterface</span><span class="token punctuation">.</span>ORIENTATION_ROTATE_180<span class="token operator">:</span> <span class="token punctuation">{</span>
                    photoRotation <span class="token operator">=</span> <span class="token number">180</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">case</span> <span class="token class-name">ExifInterface</span><span class="token punctuation">.</span>ORIENTATION_ROTATE_270<span class="token operator">:</span> <span class="token punctuation">{</span>
                    photoRotation <span class="token operator">=</span> <span class="token number">270</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;Exif orientation: &quot;</span><span class="token operator">+</span> photoRotation<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;Error determining rotation for image&quot;</span><span class="token operator">+</span> imgUri<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> photoRotation<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@TargetApi</span><span class="token punctuation">(</span><span class="token class-name">Build</span><span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>KITKAT<span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token class-name">Uri</span> uri<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//Code snippet edited from: http://stackoverflow.com/a/20559418/2235133</span>
    <span class="token class-name">String</span> filePath <span class="token operator">=</span> uri<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Build</span><span class="token punctuation">.</span>VERSION<span class="token punctuation">.</span>SDK_INT <span class="token operator">&gt;=</span> <span class="token class-name">Build</span><span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>KITKAT <span class="token operator">&amp;&amp;</span> <span class="token class-name">DocumentsContract</span><span class="token punctuation">.</span><span class="token function">isDocumentUri</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> uri<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Will return &quot;image:x*&quot;</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> wholeID <span class="token operator">=</span> <span class="token class-name">TextUtils</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token class-name">DocumentsContract</span><span class="token punctuation">.</span><span class="token function">getDocumentId</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">,</span> COLON_SEPARATOR<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Split at colon, use second item in the array</span>
        <span class="token class-name">String</span> type <span class="token operator">=</span> wholeID<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>IMAGE<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//If it not type image, it means it comes from a remote location, like Google Photos</span>
            <span class="token class-name">String</span> id <span class="token operator">=</span> wholeID<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> column <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">MediaStore<span class="token punctuation">.</span>Images<span class="token punctuation">.</span>Media</span><span class="token punctuation">.</span>DATA<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token comment">// where id is equal to</span>
            <span class="token class-name">String</span> sel <span class="token operator">=</span> <span class="token class-name">MediaStore<span class="token punctuation">.</span>Images<span class="token punctuation">.</span>Media</span><span class="token punctuation">.</span>_ID <span class="token operator">+</span> <span class="token string">&quot;=?&quot;</span><span class="token punctuation">;</span>
            <span class="token class-name">Cursor</span> cursor <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getContentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                    <span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">MediaStore<span class="token punctuation">.</span>Images<span class="token punctuation">.</span>Media</span><span class="token punctuation">.</span>EXTERNAL_CONTENT_URI<span class="token punctuation">,</span>
                            column<span class="token punctuation">,</span> sel<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>id<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cursor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">int</span> columnIndex <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">getColumnIndex</span><span class="token punctuation">(</span>column<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">.</span><span class="token function">moveToFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    filePath <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>columnIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                cursor<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;Fetched absolute path for uri&quot;</span> <span class="token operator">+</span> uri<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> filePath<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/android/camera-and-gallery.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/android/unzip-file-in-android.html" class="prev">
        Unzip File in Android
      </a></span> <span class="next"><a href="/android/camera-2-api.html">
        Camera 2 API
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/125.498b5a45.js" defer></script>
  </body>
</html>
