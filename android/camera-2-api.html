<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Android - Camera 2 API</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Preview the main camera in a TextureView">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="Android - Camera 2 API">
    <meta property="og:description" content="Preview the main camera in a TextureView">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/android/camera-2-api.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="Android - Camera 2 API">
    <meta name="twitter:description" content="Preview the main camera in a TextureView">
    <meta name="twitter:url" content="/android/camera-2-api.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/124.d86a7eff.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Android</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/android/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/android/getting-started-with-android.html" class="sidebar-link">Getting started with Android</a></li><li><a href="/android/android-studio.html" class="sidebar-link">Android Studio</a></li><li><a href="/android/instant-run-in-android-studio.html" class="sidebar-link">Instant Run in Android Studio</a></li><li><a href="/android/textview.html" class="sidebar-link">TextView</a></li><li><a href="/android/autocompletetextview.html" class="sidebar-link">AutoCompleteTextView</a></li><li><a href="/android/autosizing-textviews.html" class="sidebar-link">Autosizing TextViews</a></li><li><a href="/android/listview.html" class="sidebar-link">ListView</a></li><li><a href="/android/layouts.html" class="sidebar-link">Layouts</a></li><li><a href="/android/constraintlayout.html" class="sidebar-link">ConstraintLayout</a></li><li><a href="/android/textinputlayout.html" class="sidebar-link">TextInputLayout</a></li><li><a href="/android/coordinatorlayout-and-behaviors.html" class="sidebar-link">CoordinatorLayout and Behaviors</a></li><li><a href="/android/tablayout.html" class="sidebar-link">TabLayout</a></li><li><a href="/android/viewpager.html" class="sidebar-link">ViewPager</a></li><li><a href="/android/cardview.html" class="sidebar-link">CardView</a></li><li><a href="/android/navigationview.html" class="sidebar-link">NavigationView</a></li><li><a href="/android/recyclerview.html" class="sidebar-link">RecyclerView</a></li><li><a href="/android/recyclerview-decorations.html" class="sidebar-link">RecyclerView Decorations</a></li><li><a href="/android/recyclerview-onclicklisteners.html" class="sidebar-link">RecyclerView onClickListeners</a></li><li><a href="/android/recyclerview-and-layoutmanagers.html" class="sidebar-link">RecyclerView and LayoutManagers</a></li><li><a href="/android/pagination-in-recyclerview.html" class="sidebar-link">Pagination in RecyclerView</a></li><li><a href="/android/imageview.html" class="sidebar-link">ImageView</a></li><li><a href="/android/videoview.html" class="sidebar-link">VideoView</a></li><li><a href="/android/optimized-videoview.html" class="sidebar-link">Optimized VideoView</a></li><li><a href="/android/webview.html" class="sidebar-link">WebView</a></li><li><a href="/android/searchview.html" class="sidebar-link">SearchView</a></li><li><a href="/android/bottomnavigationview.html" class="sidebar-link">BottomNavigationView</a></li><li><a href="/android/canvas-drawing-using-surfaceview.html" class="sidebar-link">Canvas drawing using SurfaceView</a></li><li><a href="/android/creating-custom-views.html" class="sidebar-link">Creating Custom Views</a></li><li><a href="/android/getting-calculated-view-dimensions.html" class="sidebar-link">Getting Calculated View Dimensions</a></li><li><a href="/android/adding-a-fuseview-to-an-android-project.html" class="sidebar-link">Adding a FuseView to an Android Project</a></li><li><a href="/android/supporting-screens-with-different-resolutions-sizes.html" class="sidebar-link">Supporting Screens With Different Resolutions, Sizes</a></li><li><a href="/android/viewflipper.html" class="sidebar-link">ViewFlipper</a></li><li><a href="/android/design-patterns.html" class="sidebar-link">Design Patterns</a></li><li><a href="/android/activity.html" class="sidebar-link">Activity</a></li><li><a href="/android/activity-recognition.html" class="sidebar-link">Activity Recognition</a></li><li><a href="/android/split-screen-multi-screen-activities.html" class="sidebar-link">Split Screen / Multi-Screen Activities</a></li><li><a href="/android/material-design.html" class="sidebar-link">Material Design</a></li><li><a href="/android/resources.html" class="sidebar-link">Resources</a></li><li><a href="/android/data-binding-library.html" class="sidebar-link">Data Binding Library</a></li><li><a href="/android/context.html" class="sidebar-link">Context</a></li><li><a href="/android/sharedpreferences.html" class="sidebar-link">SharedPreferences</a></li><li><a href="/android/intent.html" class="sidebar-link">Intent</a></li><li><a href="/android/fragments.html" class="sidebar-link">Fragments</a></li><li><a href="/android/button.html" class="sidebar-link">Button</a></li><li><a href="/android/emulator.html" class="sidebar-link">Emulator</a></li><li><a href="/android/service.html" class="sidebar-link">Service</a></li><li><a href="/android/the-manifest-file.html" class="sidebar-link">The Manifest File</a></li><li><a href="/android/gradle-for-android.html" class="sidebar-link">Gradle for Android</a></li><li><a href="/android/fileio-with-android.html" class="sidebar-link">FileIO with Android</a></li><li><a href="/android/fileprovider.html" class="sidebar-link">FileProvider</a></li><li><a href="/android/storing-files-in-internal-external-storage.html" class="sidebar-link">Storing Files in Internal &amp; External Storage</a></li><li><a href="/android/zip-file-in-android.html" class="sidebar-link">Zip file in android</a></li><li><a href="/android/unzip-file-in-android.html" class="sidebar-link">Unzip File in Android</a></li><li><a href="/android/camera-and-gallery.html" class="sidebar-link">Camera and Gallery</a></li><li><a href="/android/camera-2-api.html" aria-current="page" class="active sidebar-link">Camera 2 API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/android/camera-2-api.html#preview-the-main-camera-in-a-textureview" class="sidebar-link">Preview the main camera in a TextureView</a></li></ul></li><li><a href="/android/fingerprint-api-in-android.html" class="sidebar-link">Fingerprint API in android</a></li><li><a href="/android/bluetooth-and-bluetooth-le-api.html" class="sidebar-link">Bluetooth and Bluetooth LE API</a></li><li><a href="/android/runtime-permissions-in-api-23.html" class="sidebar-link">Runtime Permissions in API-23 +</a></li><li><a href="/android/android-places-api.html" class="sidebar-link">Android Places API</a></li><li><a href="/android/android-ndk.html" class="sidebar-link">Android NDK</a></li><li><a href="/android/daynight-theme-appcompat-v23-2-api-14.html" class="sidebar-link">DayNight Theme (AppCompat v23.2 / API 14+)</a></li><li><a href="/android/glide.html" class="sidebar-link">Glide</a></li><li><a href="/android/dialog.html" class="sidebar-link">Dialog</a></li><li><a href="/android/enhancing-alert-dialogs.html" class="sidebar-link">Enhancing Alert Dialogs</a></li><li><a href="/android/animated-alertdialog-box.html" class="sidebar-link">Animated AlertDialog Box</a></li><li><a href="/android/greendao.html" class="sidebar-link">GreenDAO</a></li><li><a href="/android/tools-attributes.html" class="sidebar-link">Tools Attributes</a></li><li><a href="/android/formatting-strings.html" class="sidebar-link">Formatting Strings</a></li><li><a href="/android/spannablestring.html" class="sidebar-link">SpannableString</a></li><li><a href="/android/notifications.html" class="sidebar-link">Notifications</a></li><li><a href="/android/alarmmanager.html" class="sidebar-link">AlarmManager</a></li><li><a href="/android/handler.html" class="sidebar-link">Handler</a></li><li><a href="/android/broadcastreceiver.html" class="sidebar-link">BroadcastReceiver</a></li><li><a href="/android/ui-lifecycle.html" class="sidebar-link">UI Lifecycle</a></li><li><a href="/android/httpurlconnection.html" class="sidebar-link">HttpURLConnection</a></li><li><a href="/android/callback-url.html" class="sidebar-link">Callback URL</a></li><li><a href="/android/snackbar.html" class="sidebar-link">Snackbar</a></li><li><a href="/android/widgets.html" class="sidebar-link">Widgets</a></li><li><a href="/android/toast.html" class="sidebar-link">Toast</a></li><li><a href="/android/create-singleton-class-for-toast-message.html" class="sidebar-link">Create Singleton Class for Toast Message</a></li><li><a href="/android/interfaces.html" class="sidebar-link">Interfaces</a></li><li><a href="/android/animators.html" class="sidebar-link">Animators</a></li><li><a href="/android/location.html" class="sidebar-link">Location</a></li><li><a href="/android/theme-style-attribute.html" class="sidebar-link">Theme, Style, Attribute</a></li><li><a href="/android/mediaplayer.html" class="sidebar-link">MediaPlayer</a></li><li><a href="/android/android-sound-and-media.html" class="sidebar-link">Android Sound and Media</a></li><li><a href="/android/mediasession.html" class="sidebar-link">MediaSession</a></li><li><a href="/android/mediastore.html" class="sidebar-link">MediaStore</a></li><li><a href="/android/multidex-and-the-dex-method-limit.html" class="sidebar-link">Multidex and the Dex Method Limit</a></li><li><a href="/android/data-synchronization-with-sync-adapter.html" class="sidebar-link">Data Synchronization with Sync Adapter</a></li><li><a href="/android/porterduff-mode.html" class="sidebar-link">PorterDuff Mode</a></li><li><a href="/android/menu.html" class="sidebar-link">Menu</a></li><li><a href="/android/picasso.html" class="sidebar-link">Picasso</a></li><li><a href="/android/roboguice.html" class="sidebar-link">RoboGuice</a></li><li><a href="/android/acra.html" class="sidebar-link">ACRA</a></li><li><a href="/android/parcelable.html" class="sidebar-link">Parcelable</a></li><li><a href="/android/retrofit2.html" class="sidebar-link">Retrofit2</a></li><li><a href="/android/butterknife.html" class="sidebar-link">ButterKnife</a></li><li><a href="/android/volley.html" class="sidebar-link">Volley</a></li><li><a href="/android/date-and-time-pickers.html" class="sidebar-link">Date and Time Pickers</a></li><li><a href="/android/localized-date-time-in-android.html" class="sidebar-link">Localized Date/Time in Android</a></li><li><a href="/android/time-utils.html" class="sidebar-link">Time Utils</a></li><li><a href="/android/in-app-billing.html" class="sidebar-link">In-app Billing</a></li><li><a href="/android/floatingactionbutton.html" class="sidebar-link">FloatingActionButton</a></li><li><a href="/android/touch-events.html" class="sidebar-link">Touch Events</a></li><li><a href="/android/handling-touch-and-motion-events.html" class="sidebar-link">Handling touch and motion events</a></li><li><a href="/android/detect-shake-event-in-android.html" class="sidebar-link">Detect Shake Event in Android</a></li><li><a href="/android/hardware-button-events-intents-ptt-lwp-etc.html" class="sidebar-link">Hardware Button Events/Intents (PTT, LWP, etc.)</a></li><li><a href="/android/greenrobot-eventbus.html" class="sidebar-link">GreenRobot EventBus</a></li><li><a href="/android/otto-event-bus.html" class="sidebar-link">Otto Event Bus</a></li><li><a href="/android/vibration.html" class="sidebar-link">Vibration</a></li><li><a href="/android/contentprovider.html" class="sidebar-link">ContentProvider</a></li><li><a href="/android/dagger-2.html" class="sidebar-link">Dagger 2</a></li><li><a href="/android/realm.html" class="sidebar-link">Realm</a></li><li><a href="/android/android-versions.html" class="sidebar-link">Android Versions</a></li><li><a href="/android/wi-fi-connections.html" class="sidebar-link">Wi-Fi Connections</a></li><li><a href="/android/sensormanager.html" class="sidebar-link">SensorManager</a></li><li><a href="/android/progressbar.html" class="sidebar-link">ProgressBar</a></li><li><a href="/android/custom-fonts.html" class="sidebar-link">Custom Fonts</a></li><li><a href="/android/getting-system-font-names-and-using-the-fonts.html" class="sidebar-link">Getting system font names and using the fonts</a></li><li><a href="/android/text-to-speech-tts.html" class="sidebar-link">Text to Speech(TTS)</a></li><li><a href="/android/spinner.html" class="sidebar-link">Spinner</a></li><li><a href="/android/data-encryption-decryption.html" class="sidebar-link">Data Encryption/Decryption</a></li><li><a href="/android/okhttp.html" class="sidebar-link">OkHttp</a></li><li><a href="/android/handling-deep-links.html" class="sidebar-link">Handling Deep Links</a></li><li><a href="/android/crash-reporting-tools.html" class="sidebar-link">Crash Reporting Tools</a></li><li><a href="/android/check-internet-connectivity.html" class="sidebar-link">Check Internet Connectivity</a></li><li><a href="/android/creating-your-own-libraries-for-android-applications.html" class="sidebar-link">Creating your own libraries for Android applications</a></li><li><a href="/android/device-display-metrics.html" class="sidebar-link">Device Display Metrics</a></li><li><a href="/android/building-backwards-compatible-apps.html" class="sidebar-link">Building Backwards Compatible Apps</a></li><li><a href="/android/loader.html" class="sidebar-link">Loader</a></li><li><a href="/android/proguard-obfuscating-and-shrinking-your-code.html" class="sidebar-link">ProGuard - Obfuscating and Shrinking your code</a></li><li><a href="/android/typedef-annotations-intdef-stringdef.html" class="sidebar-link">Typedef Annotations: @IntDef, @StringDef</a></li><li><a href="/android/capturing-screenshots.html" class="sidebar-link">Capturing Screenshots</a></li><li><a href="/android/mvp-architecture.html" class="sidebar-link">MVP Architecture</a></li><li><a href="/android/orientation-changes.html" class="sidebar-link">Orientation Changes</a></li><li><a href="/android/xposed.html" class="sidebar-link">Xposed</a></li><li><a href="/android/packagemanager.html" class="sidebar-link">PackageManager</a></li><li><a href="/android/gesture-detection.html" class="sidebar-link">Gesture Detection</a></li><li><a href="/android/doze-mode.html" class="sidebar-link">Doze Mode</a></li><li><a href="/android/colors.html" class="sidebar-link">Colors</a></li><li><a href="/android/keyboard.html" class="sidebar-link">Keyboard</a></li><li><a href="/android/renderscript.html" class="sidebar-link">RenderScript</a></li><li><a href="/android/fresco.html" class="sidebar-link">Fresco</a></li><li><a href="/android/swipe-to-refresh.html" class="sidebar-link">Swipe to Refresh</a></li><li><a href="/android/creating-splash-screen.html" class="sidebar-link">Creating Splash screen</a></li><li><a href="/android/intentservice.html" class="sidebar-link">IntentService</a></li><li><a href="/android/implicit-intents.html" class="sidebar-link">Implicit Intents</a></li><li><a href="/android/publish-to-play-store.html" class="sidebar-link">Publish to Play Store</a></li><li><a href="/android/universal-image-loader.html" class="sidebar-link">Universal Image Loader</a></li><li><a href="/android/image-compression.html" class="sidebar-link">Image Compression</a></li><li><a href="/android/9-patch-images.html" class="sidebar-link">9-Patch Images</a></li><li><a href="/android/email-validation.html" class="sidebar-link">Email Validation</a></li><li><a href="/android/bottom-sheets.html" class="sidebar-link">Bottom Sheets</a></li><li><a href="/android/edittext.html" class="sidebar-link">EditText</a></li><li><a href="/android/speech-to-text-conversion.html" class="sidebar-link">Speech to Text Conversion</a></li><li><a href="/android/installing-apps-with-adb.html" class="sidebar-link">Installing apps with ADB</a></li><li><a href="/android/count-down-timer.html" class="sidebar-link">Count Down Timer</a></li><li><a href="/android/barcode-and-qr-code-reading.html" class="sidebar-link">Barcode and QR code reading</a></li><li><a href="/android/android-paypal-gateway-integration.html" class="sidebar-link">Android Paypal Gateway Integration</a></li><li><a href="/android/drawables.html" class="sidebar-link">Drawables</a></li><li><a href="/android/transitiondrawable.html" class="sidebar-link">TransitionDrawable</a></li><li><a href="/android/vector-drawables.html" class="sidebar-link">Vector Drawables</a></li><li><a href="/android/vectordrawable-and-animatedvectordrawable.html" class="sidebar-link">VectorDrawable and AnimatedVectorDrawable</a></li><li><a href="/android/port-mapping-using-cling-library-in-android.html" class="sidebar-link">Port Mapping using Cling library in Android</a></li><li><a href="/android/creating-overlay-always-on-top-windows.html" class="sidebar-link">Creating Overlay (always-on-top) Windows</a></li><li><a href="/android/exoplayer.html" class="sidebar-link">ExoPlayer</a></li><li><a href="/android/xmpp-register-login-and-chat-simple-example.html" class="sidebar-link">XMPP register login and chat simple example</a></li><li><a href="/android/android-authenticator.html" class="sidebar-link">Android Authenticator</a></li><li><a href="/android/audiomanager.html" class="sidebar-link">AudioManager</a></li><li><a href="/android/audiotrack.html" class="sidebar-link">AudioTrack</a></li><li><a href="/android/job-scheduling.html" class="sidebar-link">Job Scheduling</a></li><li><a href="/android/accounts-and-accountmanager.html" class="sidebar-link">Accounts and AccountManager</a></li><li><a href="/android/integrate-opencv-into-android-studio.html" class="sidebar-link">Integrate OpenCV into Android Studio</a></li><li><a href="/android/mvvm-architecture.html" class="sidebar-link">MVVM (Architecture)</a></li><li><a href="/android/ormlite-in-android.html" class="sidebar-link">ORMLite in android</a></li><li><a href="/android/retrofit2-with-rxjava.html" class="sidebar-link">Retrofit2 with RxJava</a></li><li><a href="/android/shortcutmanager.html" class="sidebar-link">ShortcutManager</a></li><li><a href="/android/lrucache.html" class="sidebar-link">LruCache</a></li><li><a href="/android/jenkins-ci-setup-for-android-projects.html" class="sidebar-link">Jenkins CI setup for Android Projects</a></li><li><a href="/android/fastlane.html" class="sidebar-link">fastlane</a></li><li><a href="/android/define-step-value-increment-for-custom-rangeseekbar.html" class="sidebar-link">Define step value (increment) for custom RangeSeekBar</a></li><li><a href="/android/getting-started-with-opengl-es-2-0.html" class="sidebar-link">Getting started with OpenGL ES 2.0+</a></li><li><a href="/android/check-data-connection.html" class="sidebar-link">Check Data Connection</a></li><li><a href="/android/java-on-android.html" class="sidebar-link">Java on Android</a></li><li><a href="/android/android-java-native-interface-jni.html" class="sidebar-link">Android Java Native Interface (JNI)</a></li><li><a href="/android/notification-channel-android-o.html" class="sidebar-link">Notification Channel Android O</a></li><li><a href="/android/robolectric.html" class="sidebar-link">Robolectric</a></li><li><a href="/android/moshi.html" class="sidebar-link">Moshi</a></li><li><a href="/android/strict-mode-policy-a-tool-to-catch-the-bug-in-the-compile-time.html" class="sidebar-link">Strict Mode Policy : A tool to catch the bug in the Compile Time.</a></li><li><a href="/android/internationalization-and-localization-i18n-and-l10n.html" class="sidebar-link">Internationalization and localization (I18N and L10N)</a></li><li><a href="/android/fast-way-to-setup-retrolambda-on-an-android-project.html" class="sidebar-link">Fast way to setup Retrolambda on an android project.</a></li><li><a href="/android/how-to-use-sparsearray.html" class="sidebar-link">How to use SparseArray</a></li><li><a href="/android/shared-element-transitions.html" class="sidebar-link">Shared Element Transitions</a></li><li><a href="/android/android-things.html" class="sidebar-link">Android Things</a></li><li><a href="/android/library-dagger-2-dependency-injection-in-applications.html" class="sidebar-link">Library Dagger 2: Dependency Injection in Applications</a></li><li><a href="/android/jcodec.html" class="sidebar-link">JCodec</a></li><li><a href="/android/formatting-phone-numbers-with-pattern.html" class="sidebar-link">Formatting phone numbers with pattern.</a></li><li><a href="/android/paint.html" class="sidebar-link">Paint</a></li><li><a href="/android/what-is-proguard-what-is-use-in-android.html" class="sidebar-link">What is ProGuard? What is use in Android?</a></li><li><a href="/android/create-android-custom-roms.html" class="sidebar-link">Create Android Custom ROMs</a></li><li><a href="/android/genymotion-for-android.html" class="sidebar-link">Genymotion for android</a></li><li><a href="/android/constraintset.html" class="sidebar-link">ConstraintSet</a></li><li><a href="/android/clevertap.html" class="sidebar-link">CleverTap</a></li><li><a href="/android/publish-a-library-to-maven-repositories.html" class="sidebar-link">Publish a library to Maven Repositories</a></li><li><a href="/android/adb-shell.html" class="sidebar-link">adb shell</a></li><li><a href="/android/ping-icmp.html" class="sidebar-link">Ping ICMP</a></li><li><a href="/android/aidl.html" class="sidebar-link">AIDL</a></li><li><a href="/android/android-game-development.html" class="sidebar-link">Android game development</a></li><li><a href="/android/android-programming-with-kotlin.html" class="sidebar-link">Android programming with Kotlin</a></li><li><a href="/android/android-x86-in-virtualbox.html" class="sidebar-link">Android-x86 in VirtualBox</a></li><li><a href="/android/leakcanary.html" class="sidebar-link">Leakcanary</a></li><li><a href="/android/okio.html" class="sidebar-link">Okio</a></li><li><a href="/android/bluetooth-low-energy.html" class="sidebar-link">Bluetooth Low Energy</a></li><li><a href="/android/looper.html" class="sidebar-link">Looper</a></li><li><a href="/android/annotation-processor.html" class="sidebar-link">Annotation Processor</a></li><li><a href="/android/syncadapter-with-periodically-do-sync-of-data.html" class="sidebar-link">SyncAdapter with periodically do sync of data</a></li><li><a href="/android/fastjson.html" class="sidebar-link">Fastjson</a></li><li><a href="/android/json-in-android-with-org-json.html" class="sidebar-link">JSON in Android with org.json</a></li><li><a href="/android/gson.html" class="sidebar-link">Gson</a></li><li><a href="/android/android-architecture-components.html" class="sidebar-link">Android Architecture Components</a></li><li><a href="/android/jackson.html" class="sidebar-link">Jackson</a></li><li><a href="/android/smartcard.html" class="sidebar-link">Smartcard</a></li><li><a href="/android/security.html" class="sidebar-link">Security</a></li><li><a href="/android/how-to-store-passwords-securely.html" class="sidebar-link">How to store passwords securely</a></li><li><a href="/android/secure-sharedpreferences.html" class="sidebar-link">Secure SharedPreferences</a></li><li><a href="/android/secure-sharedpreferences.html" class="sidebar-link">Secure SharedPreferences</a></li><li><a href="/android/sqlite.html" class="sidebar-link">SQLite</a></li><li><a href="/android/accessing-sqlite-databases-using-the-contentvalues-class.html" class="sidebar-link">Accessing SQLite databases using the ContentValues class</a></li><li><a href="/android/firebase.html" class="sidebar-link">Firebase</a></li><li><a href="/android/firebase-cloud-messaging.html" class="sidebar-link">Firebase Cloud Messaging</a></li><li><a href="/android/firebase-realtime-database.html" class="sidebar-link">Firebase Realtime DataBase</a></li><li><a href="/android/firebase-app-indexing.html" class="sidebar-link">Firebase App Indexing</a></li><li><a href="/android/firebase-crash-reporting.html" class="sidebar-link">Firebase Crash Reporting</a></li><li><a href="/android/twitter-apis.html" class="sidebar-link">Twitter APIs</a></li><li><a href="/android/youtube-api.html" class="sidebar-link">Youtube-API</a></li><li><a href="/android/integrate-google-sign-in.html" class="sidebar-link">Integrate Google Sign In</a></li><li><a href="/android/google-signin-integration-on-android.html" class="sidebar-link">Google signin integration on android</a></li><li><a href="/android/google-awareness-apis.html" class="sidebar-link">Google Awareness APIs</a></li><li><a href="/android/google-maps-api-v2-for-android.html" class="sidebar-link">Google Maps API v2 for Android</a></li><li><a href="/android/google-drive-api.html" class="sidebar-link">Google Drive API</a></li><li><a href="/android/displaying-google-ads.html" class="sidebar-link">Displaying Google Ads</a></li><li><a href="/android/admob.html" class="sidebar-link">AdMob</a></li><li><a href="/android/google-play-store.html" class="sidebar-link">Google Play Store</a></li><li><a href="/android/sign-your-android-app-for-release.html" class="sidebar-link">Sign your Android App for Release</a></li><li><a href="/android/tensorflow.html" class="sidebar-link">TensorFlow</a></li><li><a href="/android/android-vk-sdk.html" class="sidebar-link">Android Vk Sdk</a></li><li><a href="/android/project-sdk-versions.html" class="sidebar-link">Project SDK versions</a></li><li><a href="/android/facebook-sdk-for-android.html" class="sidebar-link">Facebook SDK for Android</a></li><li><a href="/android/thread.html" class="sidebar-link">Thread</a></li><li><a href="/android/asynctask.html" class="sidebar-link">AsyncTask</a></li><li><a href="/android/testing-ui-with-espresso.html" class="sidebar-link">Testing UI with Espresso</a></li><li><a href="/android/writing-ui-tests-android.html" class="sidebar-link">Writing UI tests - Android</a></li><li><a href="/android/unit-testing-in-android-with-junit.html" class="sidebar-link">Unit testing in Android with JUnit</a></li><li><a href="/android/inter-app-ui-testing-with-uiautomator.html" class="sidebar-link">Inter-app UI testing with UIAutomator</a></li><li><a href="/android/lint-warnings.html" class="sidebar-link">Lint Warnings</a></li><li><a href="/android/performance-optimization.html" class="sidebar-link">Performance Optimization</a></li><li><a href="/android/android-kernel-optimization.html" class="sidebar-link">Android Kernel Optimization</a></li><li><a href="/android/memory-leaks.html" class="sidebar-link">Memory Leaks</a></li><li><a href="/android/enhancing-android-performance-using-icon-fonts.html" class="sidebar-link">Enhancing Android Performance Using Icon Fonts</a></li><li><a href="/android/bitmap-cache.html" class="sidebar-link">Bitmap Cache</a></li><li><a href="/android/loading-bitmaps-effectively.html" class="sidebar-link">Loading Bitmaps Effectively</a></li><li><a href="/android/exceptions.html" class="sidebar-link">Exceptions</a></li><li><a href="/android/logging-and-using-logcat.html" class="sidebar-link">Logging and using Logcat</a></li><li><a href="/android/adb-android-debug-bridge.html" class="sidebar-link">ADB (Android Debug Bridge)</a></li><li><a href="/android/localization-with-resources-in-android.html" class="sidebar-link">Localization with resources in Android</a></li><li><a href="/android/convert-vietnamese-string-to-english-string-android.html" class="sidebar-link">Convert vietnamese string to english string Android</a></li><li><a href="/android/publish-aar-file-to-apache-archiva-with-gradle.html" class="sidebar-link">Publish .aar file to Apache Archiva with Gradle</a></li><li><a href="/android/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="camera-2-api"><a href="#camera-2-api" class="header-anchor">#</a> Camera 2 API</h1> <h2 id="preview-the-main-camera-in-a-textureview"><a href="#preview-the-main-camera-in-a-textureview" class="header-anchor">#</a> Preview the main camera in a TextureView</h2> <p>In this case, building against API 23, so permissions are handled too.</p> <p>You must add in the Manifest the following permission (wherever the API level you're using):</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token operator">&lt;</span><span class="token keyword">uses</span><span class="token operator">-</span>permission android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">&quot;android.permission.CAMERA&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>

</code></pre></div><p>We're about to create an activity (Camera2Activity.java) that fills a <code>TextureView</code> with the preview of the device's camera.</p> <p>The Activity we're going to use is a typical AppCompatActivity:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Camera2Activity</span> <span class="token keyword">extends</span> <span class="token class-name">AppCompatActivity</span> <span class="token punctuation">{</span>

</code></pre></div><p><strong>Attributes</strong> (You may need to read the entire example to understand some of it)</p> <p>The <code>MAX_PREVIEW_SIZE</code> guaranteed by Camera2 API is 1920x1080</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> MAX_PREVIEW_WIDTH <span class="token operator">=</span> <span class="token number">1920</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> MAX_PREVIEW_HEIGHT <span class="token operator">=</span> <span class="token number">1080</span><span class="token punctuation">;</span>

</code></pre></div><p><code>TextureView.SurfaceTextureListener</code> handles several lifecycle events on a
<code>TextureView</code>. In this case, we're listening to those events. When the SurfaceTexture is ready, we initialize the camera. When it size changes, we setup the preview coming from the camera accordingly</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">TextureView<span class="token punctuation">.</span>SurfaceTextureListener</span> mSurfaceTextureListener
        <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TextureView<span class="token punctuation">.</span>SurfaceTextureListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSurfaceTextureAvailable</span><span class="token punctuation">(</span><span class="token class-name">SurfaceTexture</span> texture<span class="token punctuation">,</span> <span class="token keyword">int</span> width<span class="token punctuation">,</span> <span class="token keyword">int</span> height<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">openCamera</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSurfaceTextureSizeChanged</span><span class="token punctuation">(</span><span class="token class-name">SurfaceTexture</span> texture<span class="token punctuation">,</span> <span class="token keyword">int</span> width<span class="token punctuation">,</span> <span class="token keyword">int</span> height<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">configureTransform</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onSurfaceTextureDestroyed</span><span class="token punctuation">(</span><span class="token class-name">SurfaceTexture</span> texture<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSurfaceTextureUpdated</span><span class="token punctuation">(</span><span class="token class-name">SurfaceTexture</span> texture<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><p>A <code>CameraDevice</code> represent one physical device's camera. In this attribute, we save the ID of the current <code>CameraDevice</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">String</span> mCameraId<span class="token punctuation">;</span>

</code></pre></div><p>This is the view (<code>TextureView</code>) that we'll be using to &quot;draw&quot; the preview of the Camera</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">TextureView</span> mTextureView<span class="token punctuation">;</span>

</code></pre></div><p>The <code>CameraCaptureSession</code> for camera preview</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">CameraCaptureSession</span> mCaptureSession<span class="token punctuation">;</span>

</code></pre></div><p>A reference to the opened <code>CameraDevice</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">CameraDevice</span> mCameraDevice<span class="token punctuation">;</span>

</code></pre></div><p>The <code>Size</code> of camera preview.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">Size</span> mPreviewSize<span class="token punctuation">;</span>

</code></pre></div><p><code>CameraDevice.StateCallback</code> is called when <code>CameraDevice</code> changes its state</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">CameraDevice<span class="token punctuation">.</span>StateCallback</span> mStateCallback <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CameraDevice<span class="token punctuation">.</span>StateCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onOpened</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">CameraDevice</span> cameraDevice<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// This method is called when the camera is opened.  We start camera preview here.</span>
        mCameraOpenCloseLock<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mCameraDevice <span class="token operator">=</span> cameraDevice<span class="token punctuation">;</span>
        <span class="token function">createCameraPreviewSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onDisconnected</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">CameraDevice</span> cameraDevice<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mCameraOpenCloseLock<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cameraDevice<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mCameraDevice <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onError</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">CameraDevice</span> cameraDevice<span class="token punctuation">,</span> <span class="token keyword">int</span> error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mCameraOpenCloseLock<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cameraDevice<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mCameraDevice <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><p>An additional thread for running tasks that shouldn't block the UI</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">HandlerThread</span> mBackgroundThread<span class="token punctuation">;</span>

</code></pre></div><p>A <code>Handler</code> for running tasks in the background</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">Handler</span> mBackgroundHandler<span class="token punctuation">;</span>

</code></pre></div><p>An <code>ImageReader</code> that handles still image capture</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">ImageReader</span> mImageReader<span class="token punctuation">;</span>

</code></pre></div><p><code>CaptureRequest.Builder</code> for the camera preview</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">CaptureRequest<span class="token punctuation">.</span>Builder</span> mPreviewRequestBuilder<span class="token punctuation">;</span>

</code></pre></div><p><code>CaptureRequest</code> generated by <code>mPreviewRequestBuilder</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">CaptureRequest</span> mPreviewRequest<span class="token punctuation">;</span>

</code></pre></div><p>A <code>Semaphore</code> to prevent the app from exiting before closing the camera.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">Semaphore</span> mCameraOpenCloseLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Semaphore</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>Constant ID of the permission request</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> REQUEST_CAMERA_PERMISSION <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

</code></pre></div><p><strong>Android Lifecycle methods</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_camera2<span class="token punctuation">)</span><span class="token punctuation">;</span>

    mTextureView <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">TextureView</span><span class="token punctuation">)</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>texture<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">startBackgroundThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// When the screen is turned off and turned back on, the SurfaceTexture is already</span>
    <span class="token comment">// available, and &quot;onSurfaceTextureAvailable&quot; will not be called. In that case, we can open</span>
    <span class="token comment">// a camera and start preview from here (otherwise, we wait until the surface is ready in</span>
    <span class="token comment">// the SurfaceTextureListener).</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mTextureView<span class="token punctuation">.</span><span class="token function">isAvailable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">openCamera</span><span class="token punctuation">(</span>mTextureView<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mTextureView<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        mTextureView<span class="token punctuation">.</span><span class="token function">setSurfaceTextureListener</span><span class="token punctuation">(</span>mSurfaceTextureListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onPause</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">closeCamera</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">stopBackgroundThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onPause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p><strong>Camera2 related methods</strong></p> <p>Those are methods that uses the Camera2 APIs</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">openCamera</span><span class="token punctuation">(</span><span class="token keyword">int</span> width<span class="token punctuation">,</span> <span class="token keyword">int</span> height<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ContextCompat</span><span class="token punctuation">.</span><span class="token function">checkSelfPermission</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token class-name">Manifest</span><span class="token punctuation">.</span>permission<span class="token punctuation">.</span>CAMERA<span class="token punctuation">)</span>
            <span class="token operator">!=</span> <span class="token class-name">PackageManager</span><span class="token punctuation">.</span>PERMISSION_GRANTED<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">requestCameraPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">setUpCameraOutputs</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">configureTransform</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">CameraManager</span> manager <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">CameraManager</span><span class="token punctuation">)</span> <span class="token function">getSystemService</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span>CAMERA_SERVICE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mCameraOpenCloseLock<span class="token punctuation">.</span><span class="token function">tryAcquire</span><span class="token punctuation">(</span><span class="token number">2500</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Time out waiting to lock camera opening.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        manager<span class="token punctuation">.</span><span class="token function">openCamera</span><span class="token punctuation">(</span>mCameraId<span class="token punctuation">,</span> mStateCallback<span class="token punctuation">,</span> mBackgroundHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">CameraAccessException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Interrupted while trying to lock camera opening.&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>Closes the current camera</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">closeCamera</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        mCameraOpenCloseLock<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> mCaptureSession<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mCaptureSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mCaptureSession <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> mCameraDevice<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mCameraDevice<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mCameraDevice <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> mImageReader<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mImageReader<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mImageReader <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Interrupted while trying to lock camera closing.&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        mCameraOpenCloseLock<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>Sets up member variables related to camera</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">setUpCameraOutputs</span><span class="token punctuation">(</span><span class="token keyword">int</span> width<span class="token punctuation">,</span> <span class="token keyword">int</span> height<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">CameraManager</span> manager <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">CameraManager</span><span class="token punctuation">)</span> <span class="token function">getSystemService</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span>CAMERA_SERVICE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> cameraId <span class="token operator">:</span> manager<span class="token punctuation">.</span><span class="token function">getCameraIdList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">CameraCharacteristics</span> characteristics
                    <span class="token operator">=</span> manager<span class="token punctuation">.</span><span class="token function">getCameraCharacteristics</span><span class="token punctuation">(</span>cameraId<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// We don't use a front facing camera in this sample.</span>
            <span class="token class-name">Integer</span> facing <span class="token operator">=</span> characteristics<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">CameraCharacteristics</span><span class="token punctuation">.</span>LENS_FACING<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>facing <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> facing <span class="token operator">==</span> <span class="token class-name">CameraCharacteristics</span><span class="token punctuation">.</span>LENS_FACING_FRONT<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token class-name">StreamConfigurationMap</span> map <span class="token operator">=</span> characteristics<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>
                    <span class="token class-name">CameraCharacteristics</span><span class="token punctuation">.</span>SCALER_STREAM_CONFIGURATION_MAP<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>map <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// For still image captures, we use the largest available size.</span>
            <span class="token class-name">Size</span> largest <span class="token operator">=</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>
                    <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">getOutputSizes</span><span class="token punctuation">(</span><span class="token class-name">ImageFormat</span><span class="token punctuation">.</span>JPEG<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token keyword">new</span> <span class="token class-name">CompareSizesByArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mImageReader <span class="token operator">=</span> <span class="token class-name">ImageReader</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span>largest<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> largest<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token class-name">ImageFormat</span><span class="token punctuation">.</span>JPEG<span class="token punctuation">,</span> <span class="token comment">/*maxImages*/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mImageReader<span class="token punctuation">.</span><span class="token function">setOnImageAvailableListener</span><span class="token punctuation">(</span>
                    <span class="token keyword">null</span><span class="token punctuation">,</span> mBackgroundHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">Point</span> displaySize <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">getWindowManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDefaultDisplay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span>displaySize<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> rotatedPreviewWidth <span class="token operator">=</span> width<span class="token punctuation">;</span>
            <span class="token keyword">int</span> rotatedPreviewHeight <span class="token operator">=</span> height<span class="token punctuation">;</span>
            <span class="token keyword">int</span> maxPreviewWidth <span class="token operator">=</span> displaySize<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
            <span class="token keyword">int</span> maxPreviewHeight <span class="token operator">=</span> displaySize<span class="token punctuation">.</span>y<span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>maxPreviewWidth <span class="token operator">&gt;</span> MAX_PREVIEW_WIDTH<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                maxPreviewWidth <span class="token operator">=</span> MAX_PREVIEW_WIDTH<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>maxPreviewHeight <span class="token operator">&gt;</span> MAX_PREVIEW_HEIGHT<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                maxPreviewHeight <span class="token operator">=</span> MAX_PREVIEW_HEIGHT<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// Danger! Attempting to use too large a preview size could  exceed the camera</span>
            <span class="token comment">// bus' bandwidth limitation, resulting in gorgeous previews but the storage of</span>
            <span class="token comment">// garbage capture data.</span>
            mPreviewSize <span class="token operator">=</span> <span class="token function">chooseOptimalSize</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">getOutputSizes</span><span class="token punctuation">(</span><span class="token class-name">SurfaceTexture</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    rotatedPreviewWidth<span class="token punctuation">,</span> rotatedPreviewHeight<span class="token punctuation">,</span> maxPreviewWidth<span class="token punctuation">,</span>
                    maxPreviewHeight<span class="token punctuation">,</span> largest<span class="token punctuation">)</span><span class="token punctuation">;</span>

            mCameraId <span class="token operator">=</span> cameraId<span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">CameraAccessException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NullPointerException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Currently an NPE is thrown when the Camera2API is used but not supported on the</span>
        <span class="token comment">// device this code runs.</span>
        <span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token class-name">Camera2Activity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">&quot;Camera2 API not supported on this device&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Toast</span><span class="token punctuation">.</span>LENGTH_LONG<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>Creates a new <code>CameraCaptureSession</code> for camera preview</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">createCameraPreviewSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">SurfaceTexture</span> texture <span class="token operator">=</span> mTextureView<span class="token punctuation">.</span><span class="token function">getSurfaceTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">assert</span> texture <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

        <span class="token comment">// We configure the size of default buffer to be the size of camera preview we want.</span>
        texture<span class="token punctuation">.</span><span class="token function">setDefaultBufferSize</span><span class="token punctuation">(</span>mPreviewSize<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mPreviewSize<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// This is the output Surface we need to start preview.</span>
        <span class="token class-name">Surface</span> surface <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Surface</span><span class="token punctuation">(</span>texture<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// We set up a CaptureRequest.Builder with the output Surface.</span>
        mPreviewRequestBuilder
                <span class="token operator">=</span> mCameraDevice<span class="token punctuation">.</span><span class="token function">createCaptureRequest</span><span class="token punctuation">(</span><span class="token class-name">CameraDevice</span><span class="token punctuation">.</span>TEMPLATE_PREVIEW<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mPreviewRequestBuilder<span class="token punctuation">.</span><span class="token function">addTarget</span><span class="token punctuation">(</span>surface<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Here, we create a CameraCaptureSession for camera preview.</span>
        mCameraDevice<span class="token punctuation">.</span><span class="token function">createCaptureSession</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>surface<span class="token punctuation">,</span> mImageReader<span class="token punctuation">.</span><span class="token function">getSurface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">CameraCaptureSession<span class="token punctuation">.</span>StateCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onConfigured</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">CameraCaptureSession</span> cameraCaptureSession<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">// The camera is already closed</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> mCameraDevice<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token keyword">return</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>

                        <span class="token comment">// When the session is ready, we start displaying the preview.</span>
                        mCaptureSession <span class="token operator">=</span> cameraCaptureSession<span class="token punctuation">;</span>
                        <span class="token keyword">try</span> <span class="token punctuation">{</span>
                            <span class="token comment">// Auto focus should be continuous for camera preview.</span>
                            mPreviewRequestBuilder<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">CaptureRequest</span><span class="token punctuation">.</span>CONTROL_AF_MODE<span class="token punctuation">,</span>
                                    <span class="token class-name">CaptureRequest</span><span class="token punctuation">.</span>CONTROL_AF_MODE_CONTINUOUS_PICTURE<span class="token punctuation">)</span><span class="token punctuation">;</span>

                            <span class="token comment">// Finally, we start displaying the camera preview.</span>
                            mPreviewRequest <span class="token operator">=</span> mPreviewRequestBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            mCaptureSession<span class="token punctuation">.</span><span class="token function">setRepeatingRequest</span><span class="token punctuation">(</span>mPreviewRequest<span class="token punctuation">,</span>
                                    <span class="token keyword">null</span><span class="token punctuation">,</span> mBackgroundHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">CameraAccessException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>

                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onConfigureFailed</span><span class="token punctuation">(</span>
                            <span class="token annotation punctuation">@NonNull</span> <span class="token class-name">CameraCaptureSession</span> cameraCaptureSession<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token function">showToast</span><span class="token punctuation">(</span><span class="token string">&quot;Failed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">null</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">CameraAccessException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p><strong>Permissions related methods</strong> For Android API 23+</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">requestCameraPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ActivityCompat</span><span class="token punctuation">.</span><span class="token function">shouldShowRequestPermissionRationale</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token class-name">Manifest</span><span class="token punctuation">.</span>permission<span class="token punctuation">.</span>CAMERA<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">AlertDialog<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token class-name">Camera2Activity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span><span class="token string">&quot;R string request permission&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setPositiveButton</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">android<span class="token punctuation">.</span></span>R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>ok<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DialogInterface<span class="token punctuation">.</span>OnClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">DialogInterface</span> dialog<span class="token punctuation">,</span> <span class="token keyword">int</span> which<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">ActivityCompat</span><span class="token punctuation">.</span><span class="token function">requestPermissions</span><span class="token punctuation">(</span><span class="token class-name">Camera2Activity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span>
                                <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token class-name">Manifest</span><span class="token punctuation">.</span>permission<span class="token punctuation">.</span>CAMERA<span class="token punctuation">}</span><span class="token punctuation">,</span>
                                REQUEST_CAMERA_PERMISSION<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setNegativeButton</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">android<span class="token punctuation">.</span></span>R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>cancel<span class="token punctuation">,</span>
                        <span class="token keyword">new</span> <span class="token class-name">DialogInterface<span class="token punctuation">.</span>OnClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token annotation punctuation">@Override</span>
                            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">DialogInterface</span> dialog<span class="token punctuation">,</span> <span class="token keyword">int</span> which<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token class-name">ActivityCompat</span><span class="token punctuation">.</span><span class="token function">requestPermissions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token class-name">Manifest</span><span class="token punctuation">.</span>permission<span class="token punctuation">.</span>CAMERA<span class="token punctuation">}</span><span class="token punctuation">,</span>
                REQUEST_CAMERA_PERMISSION<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onRequestPermissionsResult</span><span class="token punctuation">(</span><span class="token keyword">int</span> requestCode<span class="token punctuation">,</span> <span class="token annotation punctuation">@NonNull</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> permissions<span class="token punctuation">,</span>
                                       <span class="token annotation punctuation">@NonNull</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> grantResults<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>requestCode <span class="token operator">==</span> REQUEST_CAMERA_PERMISSION<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>grantResults<span class="token punctuation">.</span>length <span class="token operator">!=</span> <span class="token number">1</span> <span class="token operator">||</span> grantResults<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token class-name">PackageManager</span><span class="token punctuation">.</span>PERMISSION_GRANTED<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token class-name">Camera2Activity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">&quot;ERROR: Camera permissions not granted&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Toast</span><span class="token punctuation">.</span>LENGTH_LONG<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onRequestPermissionsResult</span><span class="token punctuation">(</span>requestCode<span class="token punctuation">,</span> permissions<span class="token punctuation">,</span> grantResults<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p><strong>Background thread / handler methods</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">startBackgroundThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    mBackgroundThread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HandlerThread</span><span class="token punctuation">(</span><span class="token string">&quot;CameraBackground&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mBackgroundThread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mBackgroundHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Handler</span><span class="token punctuation">(</span>mBackgroundThread<span class="token punctuation">.</span><span class="token function">getLooper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">stopBackgroundThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    mBackgroundThread<span class="token punctuation">.</span><span class="token function">quitSafely</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        mBackgroundThread<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mBackgroundThread <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        mBackgroundHandler <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p><strong>Utility methods</strong></p> <p>Given choices of <code>Size</code>s supported by a camera, choose the smallest one that is at least at large as the respective texture view size, and that is as most as large as the respective max size, and whose aspect ratio matches with the specified value. If doesn't exist, choose the largest one that is at most as large as the respective max size, and whose aspect ratio matches with the specified value</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Size</span> <span class="token function">chooseOptimalSize</span><span class="token punctuation">(</span><span class="token class-name">Size</span><span class="token punctuation">[</span><span class="token punctuation">]</span> choices<span class="token punctuation">,</span> <span class="token keyword">int</span> textureViewWidth<span class="token punctuation">,</span>
                                      <span class="token keyword">int</span> textureViewHeight<span class="token punctuation">,</span> <span class="token keyword">int</span> maxWidth<span class="token punctuation">,</span> <span class="token keyword">int</span> maxHeight<span class="token punctuation">,</span> <span class="token class-name">Size</span> aspectRatio<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// Collect the supported resolutions that are at least as big as the preview Surface</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Size</span><span class="token punctuation">&gt;</span></span> bigEnough <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Collect the supported resolutions that are smaller than the preview Surface</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Size</span><span class="token punctuation">&gt;</span></span> notBigEnough <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> w <span class="token operator">=</span> aspectRatio<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> h <span class="token operator">=</span> aspectRatio<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Size</span> option <span class="token operator">:</span> choices<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>option<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> maxWidth <span class="token operator">&amp;&amp;</span> option<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> maxHeight <span class="token operator">&amp;&amp;</span>
                option<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> option<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> h <span class="token operator">/</span> w<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>option<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> textureViewWidth <span class="token operator">&amp;&amp;</span>
                    option<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> textureViewHeight<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                bigEnough<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                notBigEnough<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Pick the smallest of those big enough. If there is no one big enough, pick the</span>
    <span class="token comment">// largest of those not big enough.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>bigEnough<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>bigEnough<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">CompareSizesByArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>notBigEnough<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>notBigEnough<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">CompareSizesByArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token string">&quot;Camera2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Couldn't find any suitable preview size&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>This method congfigures the neccesary <code>Matrix</code> transformation to <code>mTextureView</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">configureTransform</span><span class="token punctuation">(</span><span class="token keyword">int</span> viewWidth<span class="token punctuation">,</span> <span class="token keyword">int</span> viewHeight<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> mTextureView <span class="token operator">||</span> <span class="token keyword">null</span> <span class="token operator">==</span> mPreviewSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">int</span> rotation <span class="token operator">=</span> <span class="token function">getWindowManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDefaultDisplay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRotation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Matrix</span> matrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">RectF</span> viewRect <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RectF</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> viewWidth<span class="token punctuation">,</span> viewHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">RectF</span> bufferRect <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RectF</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> mPreviewSize<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mPreviewSize<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> centerX <span class="token operator">=</span> viewRect<span class="token punctuation">.</span><span class="token function">centerX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> centerY <span class="token operator">=</span> viewRect<span class="token punctuation">.</span><span class="token function">centerY</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Surface</span><span class="token punctuation">.</span>ROTATION_90 <span class="token operator">==</span> rotation <span class="token operator">||</span> <span class="token class-name">Surface</span><span class="token punctuation">.</span>ROTATION_270 <span class="token operator">==</span> rotation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        bufferRect<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span>centerX <span class="token operator">-</span> bufferRect<span class="token punctuation">.</span><span class="token function">centerX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> centerY <span class="token operator">-</span> bufferRect<span class="token punctuation">.</span><span class="token function">centerY</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        matrix<span class="token punctuation">.</span><span class="token function">setRectToRect</span><span class="token punctuation">(</span>viewRect<span class="token punctuation">,</span> bufferRect<span class="token punctuation">,</span> <span class="token class-name">Matrix<span class="token punctuation">.</span>ScaleToFit</span><span class="token punctuation">.</span>FILL<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">float</span> scale <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>
                <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> viewHeight <span class="token operator">/</span> mPreviewSize<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> viewWidth <span class="token operator">/</span> mPreviewSize<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        matrix<span class="token punctuation">.</span><span class="token function">postScale</span><span class="token punctuation">(</span>scale<span class="token punctuation">,</span> scale<span class="token punctuation">,</span> centerX<span class="token punctuation">,</span> centerY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        matrix<span class="token punctuation">.</span><span class="token function">postRotate</span><span class="token punctuation">(</span><span class="token number">90</span> <span class="token operator">*</span> <span class="token punctuation">(</span>rotation <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> centerX<span class="token punctuation">,</span> centerY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Surface</span><span class="token punctuation">.</span>ROTATION_180 <span class="token operator">==</span> rotation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        matrix<span class="token punctuation">.</span><span class="token function">postRotate</span><span class="token punctuation">(</span><span class="token number">180</span><span class="token punctuation">,</span> centerX<span class="token punctuation">,</span> centerY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    mTextureView<span class="token punctuation">.</span><span class="token function">setTransform</span><span class="token punctuation">(</span>matrix<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>This method compares two <code>Size</code>s based on their areas.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">CompareSizesByArea</span> <span class="token keyword">implements</span> <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Size</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token class-name">Size</span> lhs<span class="token punctuation">,</span> <span class="token class-name">Size</span> rhs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// We cast here to ensure the multiplications won't overflow</span>
        <span class="token keyword">return</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">signum</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span> lhs<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> lhs<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span>
                <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span> rhs<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> rhs<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>Not much to see here</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * Shows a {@link Toast} on the UI thread.
 *
 * @param text The message to show
 */</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">showToast</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">runOnUiThread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token class-name">Camera2Activity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span> text<span class="token punctuation">,</span> <span class="token class-name">Toast</span><span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="parameters"><a href="#parameters" class="header-anchor">#</a> Parameters</h4> <table><thead><tr><th>Parameter</th> <th>Details</th></tr></thead> <tbody><tr><td><code>CameraCaptureSession</code></td> <td>A configured capture session for a <code>CameraDevice</code>, used for capturing images from the camera or reprocessing images captured from the camera in the same session previously</td></tr> <tr><td><code>CameraDevice</code></td> <td>A representation of a single camera connected to an Android device</td></tr> <tr><td><code>CameraCharacteristics</code></td> <td>The properties describing a CameraDevice. These properties are fixed for a given CameraDevice, and can be queried through the CameraManager interface with <code>getCameraCharacteristics(String)</code></td></tr> <tr><td><code>CameraManager</code></td> <td>A system service manager for detecting, characterizing, and connecting to <code>CameraDevices</code>. You can get an instance of this class by calling <code>Context.getSystemService()</code></td></tr> <tr><td><code>CaptureRequest</code></td> <td>An immutable package of settings and outputs needed to capture a single image from the camera device. Contains the configuration for the capture hardware (sensor, lens, flash), the processing pipeline, the control algorithms, and the output buffers. Also contains the list of target Surfaces to send image data to for this capture. Can be created by using a <code>CaptureRequest.Builder</code> instance, obtained by calling <code>createCaptureRequest(int)</code></td></tr> <tr><td><code>CaptureResult</code></td> <td>The subset of the results of a single image capture from the image sensor. Contains a subset of the final configuration for the capture hardware (sensor, lens, flash), the processing pipeline, the control algorithms, and the output buffers. It is produced by a <code>CameraDevice</code> after processing a <code>CaptureRequest</code></td></tr></tbody></table> <h4 id="remarks"><a href="#remarks" class="header-anchor">#</a> Remarks</h4> <ul><li>Camera2 APIs are available in API 21+ (Lollipop and beyond)</li> <li>Even if an Android device has a 21+ ROM officially, there is no guarantee that it implements Camera2 APIs, it's totally up to the manufacturer to implement it or not (Example: LG G2 has official Lollipop support, but no Camera2 APIs)</li> <li>With Camera2, Camera (&quot;Camera1&quot;) is deprecated</li> <li>With great power comes great responsability: It's easier to mess it up when using this APIs.</li> <li>Remember, if you only want to take a photo in your app, and simply get it, you <strong>don't</strong> need to implement Camera2, you can open the device's camera app via an Intent, and receive it back</li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/android/camera-2-api.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/android/camera-and-gallery.html" class="prev">
        Camera and Gallery
      </a></span> <span class="next"><a href="/android/fingerprint-api-in-android.html">
        Fingerprint API in android
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/124.d86a7eff.js" defer></script>
  </body>
</html>
