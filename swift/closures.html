<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Swift - Closures</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Closure basics, Syntax variations, Passing closures into functions, Captures, strong/weak references, and retain cycles, Using closures for asynchronous coding, Closures and Type Alias">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="Swift - Closures">
    <meta property="og:description" content="Closure basics, Syntax variations, Passing closures into functions, Captures, strong/weak references, and retain cycles, Using closures for asynchronous coding, Closures and Type Alias">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/swift/closures.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="Swift - Closures">
    <meta name="twitter:description" content="Closure basics, Syntax variations, Passing closures into functions, Captures, strong/weak references, and retain cycles, Using closures for asynchronous coding, Closures and Type Alias">
    <meta name="twitter:url" content="/swift/closures.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/3318.a28b9bb5.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Swift</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/swift/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/swift/getting-started-with-swift-language.html" class="sidebar-link">Getting started with Swift Language</a></li><li><a href="/swift/variables-properties.html" class="sidebar-link">Variables &amp; Properties</a></li><li><a href="/swift/numbers.html" class="sidebar-link">Numbers</a></li><li><a href="/swift/strings-and-characters.html" class="sidebar-link">Strings and Characters</a></li><li><a href="/swift/booleans.html" class="sidebar-link">Booleans</a></li><li><a href="/swift/arrays.html" class="sidebar-link">Arrays</a></li><li><a href="/swift/tuples.html" class="sidebar-link">Tuples</a></li><li><a href="/swift/enums.html" class="sidebar-link">Enums</a></li><li><a href="/swift/structs.html" class="sidebar-link">Structs</a></li><li><a href="/swift/sets.html" class="sidebar-link">Sets</a></li><li><a href="/swift/dictionaries.html" class="sidebar-link">Dictionaries</a></li><li><a href="/swift/switch.html" class="sidebar-link">Switch</a></li><li><a href="/swift/optionals.html" class="sidebar-link">Optionals</a></li><li><a href="/swift/conditionals.html" class="sidebar-link">Conditionals</a></li><li><a href="/swift/error-handling.html" class="sidebar-link">Error Handling</a></li><li><a href="/swift/loops.html" class="sidebar-link">Loops</a></li><li><a href="/swift/protocols.html" class="sidebar-link">Protocols</a></li><li><a href="/swift/functions.html" class="sidebar-link">Functions</a></li><li><a href="/swift/extensions.html" class="sidebar-link">Extensions</a></li><li><a href="/swift/classes.html" class="sidebar-link">Classes</a></li><li><a href="/swift/type-casting.html" class="sidebar-link">Type Casting</a></li><li><a href="/swift/generics.html" class="sidebar-link">Generics</a></li><li><a href="/swift/optionset.html" class="sidebar-link">OptionSet</a></li><li><a href="/swift/reading-writing-json.html" class="sidebar-link">Reading &amp; Writing JSON</a></li><li><a href="/swift/advanced-operators.html" class="sidebar-link">Advanced Operators</a></li><li><a href="/swift/method-swizzling.html" class="sidebar-link">Method Swizzling</a></li><li><a href="/swift/reflection.html" class="sidebar-link">Reflection</a></li><li><a href="/swift/access-control.html" class="sidebar-link">Access Control</a></li><li><a href="/swift/closures.html" aria-current="page" class="active sidebar-link">Closures</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/swift/closures.html#closure-basics" class="sidebar-link">Closure basics</a></li><li class="sidebar-sub-header"><a href="/swift/closures.html#syntax-variations" class="sidebar-link">Syntax variations</a></li><li class="sidebar-sub-header"><a href="/swift/closures.html#passing-closures-into-functions" class="sidebar-link">Passing closures into functions</a></li><li class="sidebar-sub-header"><a href="/swift/closures.html#captures-strong-weak-references-and-retain-cycles" class="sidebar-link">Captures, strong/weak references, and retain cycles</a></li><li class="sidebar-sub-header"><a href="/swift/closures.html#using-closures-for-asynchronous-coding" class="sidebar-link">Using closures for asynchronous coding</a></li><li class="sidebar-sub-header"><a href="/swift/closures.html#closures-and-type-alias" class="sidebar-link">Closures and Type Alias</a></li></ul></li><li><a href="/swift/initializers.html" class="sidebar-link">Initializers</a></li><li><a href="/swift/associated-objects.html" class="sidebar-link">Associated Objects</a></li><li><a href="/swift/concurrency.html" class="sidebar-link">Concurrency</a></li><li><a href="/swift/getting-started-with-protocol-oriented-programming.html" class="sidebar-link">Getting Started with Protocol Oriented Programming</a></li><li><a href="/swift/functional-programming-in-swift.html" class="sidebar-link">Functional Programming in Swift</a></li><li><a href="/swift/function-as-first-class-citizens-in-swift.html" class="sidebar-link">Function as first class citizens in Swift</a></li><li><a href="/swift/blocks.html" class="sidebar-link">Blocks</a></li><li><a href="/swift/the-defer-statement.html" class="sidebar-link">The Defer Statement</a></li><li><a href="/swift/style-conventions.html" class="sidebar-link">Style Conventions</a></li><li><a href="/swift/nsregularexpression-in-swift.html" class="sidebar-link">NSRegularExpression in Swift</a></li><li><a href="/swift/rxswift.html" class="sidebar-link">RxSwift</a></li><li><a href="/swift/swift-package-manager.html" class="sidebar-link">Swift Package Manager</a></li><li><a href="/swift/working-with-c-and-objective-c.html" class="sidebar-link">Working with C and Objective-C</a></li><li><a href="/swift/documentation-markup.html" class="sidebar-link">Documentation markup</a></li><li><a href="/swift/typealias.html" class="sidebar-link">Typealias</a></li><li><a href="/swift/dependency-injection.html" class="sidebar-link">Dependency Injection</a></li><li><a href="/swift/caching-on-disk-space.html" class="sidebar-link">Caching on disk space</a></li><li><a href="/swift/algorithms-with-swift.html" class="sidebar-link">Algorithms with Swift</a></li><li><a href="/swift/swift-advance-functions.html" class="sidebar-link">Swift Advance functions</a></li><li><a href="/swift/completion-handler.html" class="sidebar-link">Completion Handler</a></li><li><a href="/swift/swift-http-server-by-kitura.html" class="sidebar-link">Swift HTTP server by Kitura</a></li><li><a href="/swift/generate-uiimage-of-initials-from-string.html" class="sidebar-link">Generate UIImage of Initials from String</a></li><li><a href="/swift/design-patterns-creational.html" class="sidebar-link">Design Patterns - Creational</a></li><li><a href="/swift/design-patterns-structural.html" class="sidebar-link">Design Patterns - Structural</a></li><li><a href="/swift/unsafe-buffer-pointers.html" class="sidebar-link">(Unsafe) Buffer Pointers</a></li><li><a href="/swift/cryptographic-hashing.html" class="sidebar-link">Cryptographic Hashing</a></li><li><a href="/swift/aes-encryption.html" class="sidebar-link">AES encryption</a></li><li><a href="/swift/pbkdf2-key-derivation.html" class="sidebar-link">PBKDF2 Key Derivation</a></li><li><a href="/swift/logging-in-swift.html" class="sidebar-link">Logging in Swift</a></li><li><a href="/swift/memory-management.html" class="sidebar-link">Memory Management</a></li><li><a href="/swift/performance.html" class="sidebar-link">Performance</a></li><li><a href="/swift/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="closures"><a href="#closures" class="header-anchor">#</a> Closures</h1> <h2 id="closure-basics"><a href="#closure-basics" class="header-anchor">#</a> Closure basics</h2> <p><strong><a href="https://developer.apple.com/library/ios/documentation/Swift/Conceptual/Swift_Programming_Language/Closures.html" target="_blank" rel="noopener noreferrer">Closures<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong> (also known as <strong>blocks</strong> or <strong>lambdas</strong>) are pieces of code which can be stored and passed around within your program.</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">let</span> sayHi <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Hello&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token comment">// The type of sayHi is &quot;() -&gt; ()&quot;, aka &quot;() -&gt; Void&quot;</span>

<span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// prints &quot;Hello&quot;</span>

</code></pre></div><p>Like other functions, closures can accept arguments and return results or throw <a href="http://stackoverflow.com/documentation/swift/283/errors" target="_blank" rel="noopener noreferrer">errors<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>:</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">let</span> addInts <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Int</span> <span class="token keyword">in</span>
    <span class="token keyword">return</span> x <span class="token operator">+</span> y
<span class="token punctuation">}</span>
<span class="token comment">// The type of addInts is &quot;(Int, Int) -&gt; Int&quot;</span>

<span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">addInts</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment">// result is 3</span>

<span class="token keyword">let</span> divideInts <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token operator">-&gt;</span> <span class="token class-name">Int</span> <span class="token keyword">in</span>
    <span class="token keyword">if</span> y <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token class-name">MyErrors</span><span class="token punctuation">.</span><span class="token class-name">DivisionByZero</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> x <span class="token operator">/</span> y
<span class="token punctuation">}</span>
<span class="token comment">// The type of divideInts is &quot;(Int, Int) throws -&gt; Int&quot;</span>

</code></pre></div><p>Closures can <strong>capture</strong> values from their scope:</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token comment">// This function returns another function which returns an integer</span>
<span class="token keyword">func</span> <span class="token function-definition function">makeProducer</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> closure <span class="token operator">=</span> <span class="token punctuation">{</span> x <span class="token punctuation">}</span>  <span class="token comment">// x is captured by the closure</span>
    <span class="token keyword">return</span> closure
<span class="token punctuation">}</span>

<span class="token comment">// These two function calls use the exact same code,</span>
<span class="token comment">// but each closure has captured different values.</span>
<span class="token keyword">let</span> three <span class="token operator">=</span> <span class="token function">makeProducer</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> four <span class="token operator">=</span> <span class="token function">makeProducer</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token function">three</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// returns 3</span>
<span class="token function">four</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// returns 4</span>

</code></pre></div><p>Closures can be passed directly into functions:</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">let</span> squares <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">...</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token short-argument">$0</span> <span class="token operator">*</span> <span class="token short-argument">$0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// returns [1, 4, 9, 16, 25, 36, 49, 64, 81, 100]</span>
<span class="token keyword">let</span> squares <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">...</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span>map <span class="token punctuation">{</span> <span class="token short-argument">$0</span> <span class="token operator">*</span> <span class="token short-argument">$0</span> <span class="token punctuation">}</span>

<span class="token class-name">NSURLSession</span><span class="token punctuation">.</span><span class="token function">sharedSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">dataTaskWithURL</span><span class="token punctuation">(</span>myURL<span class="token punctuation">,</span>
    completionHandler<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token punctuation">(</span>data<span class="token punctuation">:</span> <span class="token class-name">NSData</span><span class="token operator">?</span><span class="token punctuation">,</span> response<span class="token punctuation">:</span> <span class="token class-name">NSURLResponse</span><span class="token operator">?</span><span class="token punctuation">,</span> error<span class="token punctuation">:</span> <span class="token class-name">NSError</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token keyword">in</span>
        <span class="token keyword">if</span> <span class="token keyword">let</span> data <span class="token operator">=</span> data <span class="token punctuation">{</span>
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Request succeeded, data: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">data</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Request failed: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">error</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre></div><h2 id="syntax-variations"><a href="#syntax-variations" class="header-anchor">#</a> Syntax variations</h2> <p>The basic closure syntax is</p> <blockquote></blockquote> <p><code>{</code> <code>[</code><strong>capture list</strong><code>]</code> <code>(</code><strong>parameters</strong><code>)</code> <strong>throws-ness</strong> <code>-&gt;</code> <strong>return type</strong> <code>in</code> <strong>body</strong> <code>}</code>.</p> <p>Many of these parts can be omitted, so there are several equivalent ways to write simple closures:</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">let</span> addOne <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Int</span> <span class="token keyword">in</span> <span class="token keyword">return</span> x <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span>
<span class="token keyword">let</span> addOne <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Int</span> <span class="token keyword">in</span> x <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span>
<span class="token keyword">let</span> addOne <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Int</span> <span class="token keyword">in</span> x <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span>
<span class="token keyword">let</span> addOne <span class="token operator">=</span> <span class="token punctuation">{</span> x <span class="token operator">-&gt;</span> <span class="token class-name">Int</span> <span class="token keyword">in</span> x <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span>
<span class="token keyword">let</span> addOne <span class="token operator">=</span> <span class="token punctuation">{</span> x <span class="token keyword">in</span> x <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span>
<span class="token keyword">let</span> addOne <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token short-argument">$0</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span>

<span class="token keyword">let</span> addOneOrThrow <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token operator">-&gt;</span> <span class="token class-name">Int</span> <span class="token keyword">in</span> <span class="token keyword">return</span> x <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span>
<span class="token keyword">let</span> addOneOrThrow <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token operator">-&gt;</span> <span class="token class-name">Int</span> <span class="token keyword">in</span> x <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span>
<span class="token keyword">let</span> addOneOrThrow <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token operator">-&gt;</span> <span class="token class-name">Int</span> <span class="token keyword">in</span> x <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span>
<span class="token keyword">let</span> addOneOrThrow <span class="token operator">=</span> <span class="token punctuation">{</span> x <span class="token keyword">throws</span> <span class="token operator">-&gt;</span> <span class="token class-name">Int</span> <span class="token keyword">in</span> x <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span>
<span class="token keyword">let</span> addOneOrThrow <span class="token operator">=</span> <span class="token punctuation">{</span> x <span class="token keyword">throws</span> <span class="token keyword">in</span> x <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span>

</code></pre></div><ul><li>The capture list can be omitted if it's empty.</li> <li>Parameters don't need type annotations if their types can be inferred.</li> <li>The return type doesn't need to be specified if it can be inferred.</li> <li>Parameters don't have to be named; instead they can be referred to with <code>$0</code>, <code>$1</code>, <code>$2</code>, etc.</li> <li>If the closure contains a single expression, whose value is to be returned, the <code>return</code> keyword can be omitted.</li> <li>If the closure is inferred to throw an error, is written in a context which expects a throwing closure, or doesn't throw an error, <code>throws</code> can be omitted.</li></ul> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token comment">// The closure's type is unknown, so we have to specify the type of x and y.</span>
<span class="token comment">// The output type is inferred to be Int, because the + operator for Ints returns Int.</span>
<span class="token keyword">let</span> addInts <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token keyword">in</span> x <span class="token operator">+</span> y <span class="token punctuation">}</span>

<span class="token comment">// The closure's type is specified, so we can omit the parameters' type annotations.</span>
<span class="token keyword">let</span> addInts<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token class-name">Int</span><span class="token punctuation">,</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Int</span> <span class="token operator">=</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> x <span class="token operator">+</span> y <span class="token punctuation">}</span>
<span class="token keyword">let</span> addInts<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token class-name">Int</span><span class="token punctuation">,</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Int</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token short-argument">$0</span> <span class="token operator">+</span> <span class="token short-argument">$1</span> <span class="token punctuation">}</span>

</code></pre></div><h2 id="passing-closures-into-functions"><a href="#passing-closures-into-functions" class="header-anchor">#</a> Passing closures into functions</h2> <p>Functions may accept closures (or other functions) as parameters:</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">func</span> <span class="token function-definition function">foo</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> <span class="token class-name">Double</span><span class="token punctuation">,</span> block<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function-definition function">foo</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> <span class="token class-name">Double</span><span class="token punctuation">,</span> block<span class="token punctuation">:</span> <span class="token class-name">Int</span> <span class="token operator">-&gt;</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function-definition function">foo</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> <span class="token class-name">Double</span><span class="token punctuation">,</span> block<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token class-name">Int</span><span class="token punctuation">,</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>

</code></pre></div><h3 id="trailing-closure-syntax"><a href="#trailing-closure-syntax" class="header-anchor">#</a> Trailing closure syntax</h3> <p>If a function's last parameter is a closure, the closure braces <code>{</code>/<code>}</code> may be written <strong>after</strong> the function invocation:</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">3.5</span><span class="token punctuation">,</span> block<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Hello&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">3.5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Hello&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span>

<span class="token function">dispatch_async</span><span class="token punctuation">(</span><span class="token function">dispatch_get_main_queue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Hello from the main queue&quot;</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">dispatch_async</span><span class="token punctuation">(</span><span class="token function">dispatch_get_main_queue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Hello from the main queue&quot;</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><p>If a function's only argument is a closure, you may also omit the pair of parentheses <code>()</code> when calling it with the trailing closure syntax:</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">func</span> <span class="token function-definition function">bar</span><span class="token punctuation">(</span>block<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>

</code></pre></div><hr> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Hello&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span>

bar <span class="token punctuation">{</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Hello&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span>

</code></pre></div><h3 id="noescape-parameters"><a href="#noescape-parameters" class="header-anchor">#</a> <code>@noescape</code> parameters</h3> <p>Closure parameters marked <code>@noescape</code> are guaranteed to execute before the function call returns, so using <code>self.</code> is not required inside the closure body:</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">func</span> <span class="token function-definition function">executeNow</span><span class="token punctuation">(</span><span class="token operator">**</span><span class="token attribute atrule">@noescape</span><span class="token operator">**</span> block<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Since `block` is @noescape, it's illegal to store it to an external variable.</span>
    <span class="token comment">// We can only call it right here.</span>
    <span class="token function">block</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function-definition function">executeLater</span><span class="token punctuation">(</span>block<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch_async</span><span class="token punctuation">(</span><span class="token function">dispatch_get_main_queue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Some time in the future...</span>
        <span class="token function">block</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">func</span> <span class="token function-definition function">showExamples</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// error: reference to property 'x' in closure requires explicit 'self.' to make capture semantics explicit</span>
        executeLater <span class="token punctuation">{</span> x <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">}</span>

        executeLater <span class="token punctuation">{</span> <span class="token keyword">self</span><span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">2</span> <span class="token punctuation">}</span>  <span class="token comment">// ok, the closure explicitly captures self</span>

        <span class="token comment">// Here &quot;self.&quot; is not required, because executeNow() takes a @noescape block.</span>
        executeNow <span class="token punctuation">{</span> x <span class="token operator">=</span> <span class="token number">3</span> <span class="token punctuation">}</span>

        <span class="token comment">// Again, self. is not required, because map() uses @noescape.</span>
        <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>map <span class="token punctuation">{</span> <span class="token short-argument">$0</span> <span class="token operator">+</span> x <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="swift-3-note"><a href="#swift-3-note" class="header-anchor">#</a> Swift 3 note:</h3> <p>Note that in Swift 3, you no longer mark blocks as @noescape. Blocks are now <strong>not</strong> escaping by default.
In Swift 3, instead of marking a closure as non-escaping, you mark a function parameter that is an escaping closure as escaping using the &quot;@escaping&quot; keyword.</p> <h3 id="throws-and-rethrows"><a href="#throws-and-rethrows" class="header-anchor">#</a> <code>throws</code> and <code>rethrows</code></h3> <p>Closures, like other functions, may throw <a href="http://stackoverflow.com/documentation/swift/283/errors" target="_blank" rel="noopener noreferrer">errors<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>:</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">func</span> <span class="token function-definition function">executeNowOrIgnoreError</span><span class="token punctuation">(</span>block<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">**</span><span class="token keyword">throws</span><span class="token operator">**</span> <span class="token operator">-&gt;</span> <span class="token class-name">Void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">do</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token function">block</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;error: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">error</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The function may, of course, pass the error along to its caller:</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">func</span> <span class="token function-definition function">executeNowOrThrow</span><span class="token punctuation">(</span>block<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">**</span><span class="token keyword">throws</span><span class="token operator">**</span> <span class="token operator">-&gt;</span> <span class="token class-name">Void</span><span class="token punctuation">)</span> <span class="token operator">**</span><span class="token keyword">throws</span><span class="token operator">**</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token function">block</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>However, if the block passed in <strong>doesn't</strong> throw, the caller is still stuck with a throwing function:</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token comment">// It's annoying that this requires &quot;try&quot;, because &quot;print()&quot; can't throw!</span>
<span class="token keyword">try</span> executeNowOrThrow <span class="token punctuation">{</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Just printing, no errors here!&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span>

</code></pre></div><p>The solution is <strong><code>rethrows</code></strong>, which designates that the function can only throw <strong>if its closure parameter throws</strong>:</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">func</span> <span class="token function-definition function">executeNowOrRethrow</span><span class="token punctuation">(</span>block<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">**</span><span class="token keyword">throws</span><span class="token operator">**</span> <span class="token operator">-&gt;</span> <span class="token class-name">Void</span><span class="token punctuation">)</span> <span class="token operator">***</span><span class="token keyword">rethrows</span><span class="token operator">***</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token function">block</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// &quot;try&quot; is not required here, because the block can't throw an error.</span>
executeNowOrRethrow <span class="token punctuation">{</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;No errors are thrown from this closure&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span>

<span class="token comment">// This block **can** throw an error, so &quot;try&quot; is required.</span>
<span class="token keyword">try</span> executeNowOrRethrow <span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token class-name">MyError</span><span class="token punctuation">.</span><span class="token class-name">Example</span> <span class="token punctuation">}</span>
</code></pre></div><p>Many standard library functions use <code>rethrows</code>, including <code>map()</code>, <code>filter()</code>, and <code>indexOf()</code>.</p> <h2 id="captures-strong-weak-references-and-retain-cycles"><a href="#captures-strong-weak-references-and-retain-cycles" class="header-anchor">#</a> Captures, strong/weak references, and retain cycles</h2> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
    <span class="token keyword">func</span> <span class="token function-definition function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Hello&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token keyword">deinit</span> <span class="token punctuation">{</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Goodbye&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>When a closure captures a reference type (a class instance), it holds a strong reference by default:</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">let</span> closure<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Void</span>
<span class="token keyword">do</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// Captures a strong reference to `obj`: the object will be kept alive</span>
    <span class="token comment">// as long as the closure itself is alive.</span>
    closure <span class="token operator">=</span> <span class="token punctuation">{</span> obj<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token function">closure</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// The object is still alive; prints &quot;Hello&quot;</span>
<span class="token punctuation">}</span> <span class="token comment">// obj goes out of scope</span>
<span class="token function">closure</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// The object is still alive; prints &quot;Hello&quot;</span>

</code></pre></div><p>The closure's <strong>capture list</strong> can be used to specify a weak or unowned reference:</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">let</span> closure<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Void</span>
<span class="token keyword">do</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// Captures a weak reference to `obj`: the closure will not keep the object alive;</span>
    <span class="token comment">// the object becomes optional inside the closure.</span>
    closure <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token operator">**</span><span class="token keyword">weak</span><span class="token operator">**</span> obj<span class="token punctuation">]</span> <span class="token keyword">in</span> obj<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token function">closure</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// The object is still alive; prints &quot;Hello&quot;</span>
<span class="token punctuation">}</span> <span class="token comment">// obj goes out of scope and is deallocated; prints &quot;Goodbye&quot;</span>
<span class="token function">closure</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// `obj` is nil from inside the closure; this does not print anything.</span>
</code></pre></div><div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">let</span> closure<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Void</span>
<span class="token keyword">do</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// Captures an unowned reference to `obj`: the closure will not keep the object alive;</span>
    <span class="token comment">// the object is always **assumed** to be accessible while the closure is alive.</span>
    closure <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token operator">**</span><span class="token keyword">unowned</span><span class="token operator">**</span> obj<span class="token punctuation">]</span> <span class="token keyword">in</span> obj<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token function">closure</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// The object is still alive; prints &quot;Hello&quot;</span>
<span class="token punctuation">}</span> <span class="token comment">// obj goes out of scope and is deallocated; prints &quot;Goodbye&quot;</span>
<span class="token function">closure</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// **crash!** obj is being accessed after it's deallocated.</span>
</code></pre></div><p>For more information, see the <a href="http://stackoverflow.com/documentation/swift/745/memory-management#t=201607211838216466797" target="_blank" rel="noopener noreferrer">Memory Management<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> topic, and the <a href="https://developer.apple.com/library/ios/documentation/Swift/Conceptual/Swift_Programming_Language/AutomaticReferenceCounting.html" target="_blank" rel="noopener noreferrer">Automatic Reference Counting<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> section of The Swift Programming Language.</p> <h3 id="retain-cycles"><a href="#retain-cycles" class="header-anchor">#</a> Retain cycles</h3> <p>If an object holds onto a closure, which also holds a strong reference to the object, this is a <a href="http://stackoverflow.com/documentation/swift/745/memory-management/2533/reference-cycles-and-weak-references#t=201607211838216466797" target="_blank" rel="noopener noreferrer"><strong>retain cycle</strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Unless the cycle is broken, the memory storing the object and closure will be leaked (never reclaimed).</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">class</span> <span class="token class-name">Game</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> score <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">let</span> controller<span class="token punctuation">:</span> <span class="token class-name">GCController</span>
    <span class="token keyword">init</span><span class="token punctuation">(</span>controller<span class="token punctuation">:</span> <span class="token class-name">GCController</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>controller <span class="token operator">=</span> controller

        <span class="token comment">// **BAD:** the block captures self strongly, but self holds the controller</span>
        <span class="token comment">// (and thus the block) strongly, which is a cycle.</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>controller<span class="token punctuation">.</span>controllerPausedHandler <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> curScore <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>score
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Pause button pressed; current score: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">curScore</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// **SOLUTION:** use `weak self` to break the cycle.</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>controller<span class="token punctuation">.</span>controllerPausedHandler <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">**</span><span class="token punctuation">[</span><span class="token keyword">weak</span> <span class="token keyword">self</span><span class="token punctuation">]</span> <span class="token keyword">in</span><span class="token operator">**</span>
            <span class="token operator">**</span><span class="token keyword">guard</span> <span class="token keyword">let</span> strongSelf <span class="token operator">=</span> <span class="token keyword">self</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span><span class="token operator">**</span>
            <span class="token keyword">let</span> curScore <span class="token operator">=</span> strongSelf<span class="token punctuation">.</span>score
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Pause button pressed; current score: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">curScore</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="using-closures-for-asynchronous-coding"><a href="#using-closures-for-asynchronous-coding" class="header-anchor">#</a> Using closures for asynchronous coding</h2> <p>Closures are often used for asynchronous tasks, for example when fetching data from a website.</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">func</span> <span class="token function-definition function">getData</span><span class="token punctuation">(</span>urlString<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> callback<span class="token punctuation">:</span> <span class="token punctuation">(</span>result<span class="token punctuation">:</span> <span class="token class-name">NSData</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// Turn the URL string into an NSURLRequest.</span>
    <span class="token keyword">guard</span> <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token function">NSURL</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> urlString<span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
    <span class="token keyword">let</span> request <span class="token operator">=</span> <span class="token class-name">NSURLRequest</span><span class="token punctuation">(</span><span class="token constant">URL</span><span class="token punctuation">:</span> url<span class="token punctuation">)</span>
    
    <span class="token comment">// Asynchronously fetch data from the given URL.</span>
    <span class="token keyword">let</span> task <span class="token operator">=</span> <span class="token class-name">NSURLSession</span><span class="token punctuation">.</span><span class="token function">sharedSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">dataTaskWithRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span> <span class="token class-name">NSData</span><span class="token operator">?</span><span class="token punctuation">,</span> response<span class="token punctuation">:</span> <span class="token class-name">NSURLResponse</span><span class="token operator">?</span><span class="token punctuation">,</span> error<span class="token punctuation">:</span> <span class="token class-name">NSError</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token keyword">in</span>

        <span class="token comment">// We now have the NSData response from the website.</span>
        <span class="token comment">// We can get it &quot;out&quot; of the function by using the callback </span>
        <span class="token comment">// that was passed to this function as a parameter.</span>

        <span class="token function">callback</span><span class="token punctuation">(</span>result<span class="token punctuation">:</span> data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
        
    task<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><p>This function is asynchronous, so will not block the thread it is being called on (it won't freeze the interface if called on the main thread of your GUI application).</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;1. Going to call getData&quot;</span></span><span class="token punctuation">)</span>

<span class="token function">getData</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;http://www.example.com&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">(</span>result<span class="token punctuation">:</span> <span class="token class-name">NSData</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Void</span> <span class="token keyword">in</span>

    <span class="token comment">// Called when the data from http://www.example.com has been fetched.</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;2. Fetched data&quot;</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;3. Called getData&quot;</span></span><span class="token punctuation">)</span>

</code></pre></div><p>Because the task is asynchronous, the output will usually look like this:</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token string-literal"><span class="token string">&quot;1. Going to call getData&quot;</span></span>
<span class="token string-literal"><span class="token string">&quot;3. Called getData&quot;</span></span>
<span class="token string-literal"><span class="token string">&quot;2. Fetched data&quot;</span></span>

</code></pre></div><p>Because the code inside of the closure, <code>print(&quot;2. Fetched data&quot;)</code>, will not be called until the data from the URL is fetched.</p> <h2 id="closures-and-type-alias"><a href="#closures-and-type-alias" class="header-anchor">#</a> Closures and Type Alias</h2> <p>A closure can be defined with a <code>typealias</code>. This provides a convenient type placeholder if the same closure signature is used in multiple places. For example, common network request callbacks or user interface event handlers make great candidates for being &quot;named&quot; with a type alias.</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">public</span> <span class="token keyword">typealias</span> <span class="token operator">**</span><span class="token class-name">ClosureType</span><span class="token operator">**</span> <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Int</span>
</code></pre></div><p>You can then define a function using the typealias:</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">public</span> <span class="token keyword">func</span> <span class="token function-definition function">closureFunction</span><span class="token punctuation">(</span>closure<span class="token punctuation">:</span> <span class="token operator">**</span><span class="token class-name">ClosureType</span><span class="token operator">**</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> z <span class="token operator">=</span> <span class="token function">closure</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
    
<span class="token function">closureFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Int</span> <span class="token keyword">in</span> <span class="token keyword">return</span> x <span class="token operator">+</span> y <span class="token punctuation">}</span>
</code></pre></div><h4 id="syntax"><a href="#syntax" class="header-anchor">#</a> Syntax</h4> <ul><li>var closureVar: (<parameters>) -&gt; (<returnType>) // As a variable or property type</returnType></parameters></li> <li>typealias ClosureType = (<parameters>) -&gt; (<returnType>)</returnType></parameters></li> <li>{ [<captureList>] (<parameters>) <throws-ness> -&gt; <returnType> in <statements> } // Complete closure syntax</statements></returnType></throws-ness></parameters></captureList></li></ul> <h4 id="remarks"><a href="#remarks" class="header-anchor">#</a> Remarks</h4> <p>For more information on Swift closures, see <a href="https://developer.apple.com/library/prerelease/content/documentation/Swift/Conceptual/Swift_Programming_Language/Closures.html" target="_blank" rel="noopener noreferrer">Apple's documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/swift/closures.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/swift/access-control.html" class="prev">
        Access Control
      </a></span> <span class="next"><a href="/swift/initializers.html">
        Initializers
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/3318.a28b9bb5.js" defer></script>
  </body>
</html>
