<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Swift - AES encryption</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="AES encryption in CBC mode with a random IV (Swift 3.0), AES encryption in CBC mode with a random IV (Swift 2.3), AES encryption in ECB mode with PKCS7 padding">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="Swift - AES encryption">
    <meta property="og:description" content="AES encryption in CBC mode with a random IV (Swift 3.0), AES encryption in CBC mode with a random IV (Swift 2.3), AES encryption in ECB mode with PKCS7 padding">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/swift/aes-encryption.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="Swift - AES encryption">
    <meta name="twitter:description" content="AES encryption in CBC mode with a random IV (Swift 3.0), AES encryption in CBC mode with a random IV (Swift 2.3), AES encryption in ECB mode with PKCS7 padding">
    <meta name="twitter:url" content="/swift/aes-encryption.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/3310.31b3846d.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Swift</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/swift/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/swift/getting-started-with-swift-language.html" class="sidebar-link">Getting started with Swift Language</a></li><li><a href="/swift/variables-properties.html" class="sidebar-link">Variables &amp; Properties</a></li><li><a href="/swift/numbers.html" class="sidebar-link">Numbers</a></li><li><a href="/swift/strings-and-characters.html" class="sidebar-link">Strings and Characters</a></li><li><a href="/swift/booleans.html" class="sidebar-link">Booleans</a></li><li><a href="/swift/arrays.html" class="sidebar-link">Arrays</a></li><li><a href="/swift/tuples.html" class="sidebar-link">Tuples</a></li><li><a href="/swift/enums.html" class="sidebar-link">Enums</a></li><li><a href="/swift/structs.html" class="sidebar-link">Structs</a></li><li><a href="/swift/sets.html" class="sidebar-link">Sets</a></li><li><a href="/swift/dictionaries.html" class="sidebar-link">Dictionaries</a></li><li><a href="/swift/switch.html" class="sidebar-link">Switch</a></li><li><a href="/swift/optionals.html" class="sidebar-link">Optionals</a></li><li><a href="/swift/conditionals.html" class="sidebar-link">Conditionals</a></li><li><a href="/swift/error-handling.html" class="sidebar-link">Error Handling</a></li><li><a href="/swift/loops.html" class="sidebar-link">Loops</a></li><li><a href="/swift/protocols.html" class="sidebar-link">Protocols</a></li><li><a href="/swift/functions.html" class="sidebar-link">Functions</a></li><li><a href="/swift/extensions.html" class="sidebar-link">Extensions</a></li><li><a href="/swift/classes.html" class="sidebar-link">Classes</a></li><li><a href="/swift/type-casting.html" class="sidebar-link">Type Casting</a></li><li><a href="/swift/generics.html" class="sidebar-link">Generics</a></li><li><a href="/swift/optionset.html" class="sidebar-link">OptionSet</a></li><li><a href="/swift/reading-writing-json.html" class="sidebar-link">Reading &amp; Writing JSON</a></li><li><a href="/swift/advanced-operators.html" class="sidebar-link">Advanced Operators</a></li><li><a href="/swift/method-swizzling.html" class="sidebar-link">Method Swizzling</a></li><li><a href="/swift/reflection.html" class="sidebar-link">Reflection</a></li><li><a href="/swift/access-control.html" class="sidebar-link">Access Control</a></li><li><a href="/swift/closures.html" class="sidebar-link">Closures</a></li><li><a href="/swift/initializers.html" class="sidebar-link">Initializers</a></li><li><a href="/swift/associated-objects.html" class="sidebar-link">Associated Objects</a></li><li><a href="/swift/concurrency.html" class="sidebar-link">Concurrency</a></li><li><a href="/swift/getting-started-with-protocol-oriented-programming.html" class="sidebar-link">Getting Started with Protocol Oriented Programming</a></li><li><a href="/swift/functional-programming-in-swift.html" class="sidebar-link">Functional Programming in Swift</a></li><li><a href="/swift/function-as-first-class-citizens-in-swift.html" class="sidebar-link">Function as first class citizens in Swift</a></li><li><a href="/swift/blocks.html" class="sidebar-link">Blocks</a></li><li><a href="/swift/the-defer-statement.html" class="sidebar-link">The Defer Statement</a></li><li><a href="/swift/style-conventions.html" class="sidebar-link">Style Conventions</a></li><li><a href="/swift/nsregularexpression-in-swift.html" class="sidebar-link">NSRegularExpression in Swift</a></li><li><a href="/swift/rxswift.html" class="sidebar-link">RxSwift</a></li><li><a href="/swift/swift-package-manager.html" class="sidebar-link">Swift Package Manager</a></li><li><a href="/swift/working-with-c-and-objective-c.html" class="sidebar-link">Working with C and Objective-C</a></li><li><a href="/swift/documentation-markup.html" class="sidebar-link">Documentation markup</a></li><li><a href="/swift/typealias.html" class="sidebar-link">Typealias</a></li><li><a href="/swift/dependency-injection.html" class="sidebar-link">Dependency Injection</a></li><li><a href="/swift/caching-on-disk-space.html" class="sidebar-link">Caching on disk space</a></li><li><a href="/swift/algorithms-with-swift.html" class="sidebar-link">Algorithms with Swift</a></li><li><a href="/swift/swift-advance-functions.html" class="sidebar-link">Swift Advance functions</a></li><li><a href="/swift/completion-handler.html" class="sidebar-link">Completion Handler</a></li><li><a href="/swift/swift-http-server-by-kitura.html" class="sidebar-link">Swift HTTP server by Kitura</a></li><li><a href="/swift/generate-uiimage-of-initials-from-string.html" class="sidebar-link">Generate UIImage of Initials from String</a></li><li><a href="/swift/design-patterns-creational.html" class="sidebar-link">Design Patterns - Creational</a></li><li><a href="/swift/design-patterns-structural.html" class="sidebar-link">Design Patterns - Structural</a></li><li><a href="/swift/unsafe-buffer-pointers.html" class="sidebar-link">(Unsafe) Buffer Pointers</a></li><li><a href="/swift/cryptographic-hashing.html" class="sidebar-link">Cryptographic Hashing</a></li><li><a href="/swift/aes-encryption.html" aria-current="page" class="active sidebar-link">AES encryption</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/swift/aes-encryption.html#aes-encryption-in-cbc-mode-with-a-random-iv-swift-3-0" class="sidebar-link">AES encryption in CBC mode with a random IV (Swift 3.0)</a></li><li class="sidebar-sub-header"><a href="/swift/aes-encryption.html#aes-encryption-in-cbc-mode-with-a-random-iv-swift-2-3" class="sidebar-link">AES encryption in CBC mode with a random IV (Swift 2.3)</a></li><li class="sidebar-sub-header"><a href="/swift/aes-encryption.html#aes-encryption-in-ecb-mode-with-pkcs7-padding" class="sidebar-link">AES encryption in ECB mode with PKCS7 padding</a></li></ul></li><li><a href="/swift/pbkdf2-key-derivation.html" class="sidebar-link">PBKDF2 Key Derivation</a></li><li><a href="/swift/logging-in-swift.html" class="sidebar-link">Logging in Swift</a></li><li><a href="/swift/memory-management.html" class="sidebar-link">Memory Management</a></li><li><a href="/swift/performance.html" class="sidebar-link">Performance</a></li><li><a href="/swift/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="aes-encryption"><a href="#aes-encryption" class="header-anchor">#</a> AES encryption</h1> <h2 id="aes-encryption-in-cbc-mode-with-a-random-iv-swift-3-0"><a href="#aes-encryption-in-cbc-mode-with-a-random-iv-swift-3-0" class="header-anchor">#</a> AES encryption in CBC mode with a random IV (Swift 3.0)</h2> <p>The iv is prefixed to the encrypted data</p> <p><code>aesCBC128Encrypt</code> will create a random IV and prefixed to the encrypted code.<br> <code>aesCBC128Decrypt</code> will use the prefixed IV during decryption.</p> <p>Inputs are the data and key are Data objects. If an encoded form such as Base64 if required convert to and/or from in the calling method.</p> <p>The key should be exactly 128-bits (16-bytes), 192-bits (24-bytes) or 256-bits (32-bytes) in length. If another key size is used an error will be thrown.</p> <p><a href="https://en.wikipedia.org/wiki/Padding_(cryptography)#PKCS7" target="_blank" rel="noopener noreferrer">PKCS#7 padding<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> is set by default.</p> <p>This example requires Common Crypto<br>
It is necessary to have a bridging header to the project:<br> <code>#import &lt;CommonCrypto/CommonCrypto.h&gt;</code><br>
Add the <code>Security.framework</code> to the project.</p> <p>This is example, not production code.</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">enum</span> <span class="token class-name">AESError</span><span class="token punctuation">:</span> <span class="token class-name">Error</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token class-name">KeyError</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Int</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">case</span> <span class="token class-name">IVError</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Int</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">case</span> <span class="token class-name">CryptorError</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Int</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// The iv is prefixed to the encrypted data</span>
<span class="token keyword">func</span> <span class="token function-definition function">aesCBCEncrypt</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span><span class="token class-name">Data</span><span class="token punctuation">,</span> keyData<span class="token punctuation">:</span><span class="token class-name">Data</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token operator">-&gt;</span> <span class="token class-name">Data</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> keyLength <span class="token operator">=</span> keyData<span class="token punctuation">.</span>count
    <span class="token keyword">let</span> validKeyLengths <span class="token operator">=</span> <span class="token punctuation">[</span>kCCKeySizeAES128<span class="token punctuation">,</span> kCCKeySizeAES192<span class="token punctuation">,</span> kCCKeySizeAES256<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>validKeyLengths<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>keyLength<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token class-name">AESError</span><span class="token punctuation">.</span><span class="token class-name">KeyError</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Invalid key length&quot;</span></span><span class="token punctuation">,</span> keyLength<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> ivSize <span class="token operator">=</span> kCCBlockSizeAES128<span class="token punctuation">;</span>
    <span class="token keyword">let</span> cryptLength <span class="token operator">=</span> <span class="token function">size_t</span><span class="token punctuation">(</span>ivSize <span class="token operator">+</span> data<span class="token punctuation">.</span>count <span class="token operator">+</span> kCCBlockSizeAES128<span class="token punctuation">)</span>
    <span class="token keyword">var</span> cryptData <span class="token operator">=</span> <span class="token class-name">Data</span><span class="token punctuation">(</span>count<span class="token punctuation">:</span>cryptLength<span class="token punctuation">)</span>

    <span class="token keyword">let</span> status <span class="token operator">=</span> cryptData<span class="token punctuation">.</span>withUnsafeMutableBytes <span class="token punctuation">{</span>ivBytes <span class="token keyword">in</span>
        <span class="token class-name">SecRandomCopyBytes</span><span class="token punctuation">(</span><span class="token constant">kSecRandomDefault</span><span class="token punctuation">,</span> kCCBlockSizeAES128<span class="token punctuation">,</span> ivBytes<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token class-name">AESError</span><span class="token punctuation">.</span><span class="token class-name">IVError</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;IV generation failed&quot;</span></span><span class="token punctuation">,</span> <span class="token class-name">Int</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> numBytesEncrypted <span class="token punctuation">:</span>size_t <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">let</span> options   <span class="token operator">=</span> <span class="token class-name">CCOptions</span><span class="token punctuation">(</span>kCCOptionPKCS7Padding<span class="token punctuation">)</span>

    <span class="token keyword">let</span> cryptStatus <span class="token operator">=</span> cryptData<span class="token punctuation">.</span>withUnsafeMutableBytes <span class="token punctuation">{</span>cryptBytes <span class="token keyword">in</span>
        data<span class="token punctuation">.</span>withUnsafeBytes <span class="token punctuation">{</span>dataBytes <span class="token keyword">in</span>
            keyData<span class="token punctuation">.</span>withUnsafeBytes <span class="token punctuation">{</span>keyBytes <span class="token keyword">in</span>
                <span class="token class-name">CCCrypt</span><span class="token punctuation">(</span><span class="token class-name">CCOperation</span><span class="token punctuation">(</span><span class="token constant">kCCEncrypt</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token class-name">CCAlgorithm</span><span class="token punctuation">(</span><span class="token constant">kCCAlgorithmAES</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        options<span class="token punctuation">,</span>
                        keyBytes<span class="token punctuation">,</span> keyLength<span class="token punctuation">,</span>
                        cryptBytes<span class="token punctuation">,</span>
                        dataBytes<span class="token punctuation">,</span> data<span class="token punctuation">.</span>count<span class="token punctuation">,</span>
                        cryptBytes<span class="token operator">+</span>kCCBlockSizeAES128<span class="token punctuation">,</span> cryptLength<span class="token punctuation">,</span>
                        <span class="token operator">&amp;</span>numBytesEncrypted<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token class-name">UInt32</span><span class="token punctuation">(</span>cryptStatus<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">UInt32</span><span class="token punctuation">(</span><span class="token constant">kCCSuccess</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cryptData<span class="token punctuation">.</span>count <span class="token operator">=</span> numBytesEncrypted <span class="token operator">+</span> ivSize
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token class-name">AESError</span><span class="token punctuation">.</span><span class="token class-name">CryptorError</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Encryption failed&quot;</span></span><span class="token punctuation">,</span> <span class="token class-name">Int</span><span class="token punctuation">(</span>cryptStatus<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> cryptData<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// The iv is prefixed to the encrypted data</span>
<span class="token keyword">func</span> <span class="token function-definition function">aesCBCDecrypt</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span><span class="token class-name">Data</span><span class="token punctuation">,</span> keyData<span class="token punctuation">:</span><span class="token class-name">Data</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token operator">-&gt;</span> <span class="token class-name">Data</span><span class="token operator">?</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> keyLength <span class="token operator">=</span> keyData<span class="token punctuation">.</span>count
    <span class="token keyword">let</span> validKeyLengths <span class="token operator">=</span> <span class="token punctuation">[</span>kCCKeySizeAES128<span class="token punctuation">,</span> kCCKeySizeAES192<span class="token punctuation">,</span> kCCKeySizeAES256<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>validKeyLengths<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>keyLength<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token class-name">AESError</span><span class="token punctuation">.</span><span class="token class-name">KeyError</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Invalid key length&quot;</span></span><span class="token punctuation">,</span> keyLength<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> ivSize <span class="token operator">=</span> kCCBlockSizeAES128<span class="token punctuation">;</span>
    <span class="token keyword">let</span> clearLength <span class="token operator">=</span> <span class="token function">size_t</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>count <span class="token operator">-</span> ivSize<span class="token punctuation">)</span>
    <span class="token keyword">var</span> clearData <span class="token operator">=</span> <span class="token class-name">Data</span><span class="token punctuation">(</span>count<span class="token punctuation">:</span>clearLength<span class="token punctuation">)</span>

    <span class="token keyword">var</span> numBytesDecrypted <span class="token punctuation">:</span>size_t <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">let</span> options   <span class="token operator">=</span> <span class="token class-name">CCOptions</span><span class="token punctuation">(</span>kCCOptionPKCS7Padding<span class="token punctuation">)</span>

    <span class="token keyword">let</span> cryptStatus <span class="token operator">=</span> clearData<span class="token punctuation">.</span>withUnsafeMutableBytes <span class="token punctuation">{</span>cryptBytes <span class="token keyword">in</span>
        data<span class="token punctuation">.</span>withUnsafeBytes <span class="token punctuation">{</span>dataBytes <span class="token keyword">in</span>
            keyData<span class="token punctuation">.</span>withUnsafeBytes <span class="token punctuation">{</span>keyBytes <span class="token keyword">in</span>
                <span class="token class-name">CCCrypt</span><span class="token punctuation">(</span><span class="token class-name">CCOperation</span><span class="token punctuation">(</span><span class="token constant">kCCDecrypt</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token class-name">CCAlgorithm</span><span class="token punctuation">(</span>kCCAlgorithmAES128<span class="token punctuation">)</span><span class="token punctuation">,</span>
                        options<span class="token punctuation">,</span>
                        keyBytes<span class="token punctuation">,</span> keyLength<span class="token punctuation">,</span>
                        dataBytes<span class="token punctuation">,</span>
                        dataBytes<span class="token operator">+</span>kCCBlockSizeAES128<span class="token punctuation">,</span> clearLength<span class="token punctuation">,</span>
                        cryptBytes<span class="token punctuation">,</span> clearLength<span class="token punctuation">,</span>
                        <span class="token operator">&amp;</span>numBytesDecrypted<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token class-name">UInt32</span><span class="token punctuation">(</span>cryptStatus<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">UInt32</span><span class="token punctuation">(</span><span class="token constant">kCCSuccess</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        clearData<span class="token punctuation">.</span>count <span class="token operator">=</span> numBytesDecrypted
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token class-name">AESError</span><span class="token punctuation">.</span><span class="token class-name">CryptorError</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Decryption failed&quot;</span></span><span class="token punctuation">,</span> <span class="token class-name">Int</span><span class="token punctuation">(</span>cryptStatus<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">return</span> clearData<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>Example usage:</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">let</span> clearData <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;clearData0123456&quot;</span></span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>using<span class="token punctuation">:</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token class-name">Encoding</span><span class="token punctuation">.</span>utf8<span class="token punctuation">)</span><span class="token operator">!</span>
<span class="token keyword">let</span> keyData   <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;keyData890123456&quot;</span></span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>using<span class="token punctuation">:</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token class-name">Encoding</span><span class="token punctuation">.</span>utf8<span class="token punctuation">)</span><span class="token operator">!</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;clearData:   </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">clearData <span class="token keyword">as</span> <span class="token class-name">NSData</span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;keyData:     </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">keyData <span class="token keyword">as</span> <span class="token class-name">NSData</span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>

<span class="token keyword">var</span> cryptData <span class="token punctuation">:</span><span class="token class-name">Data</span><span class="token operator">?</span>
<span class="token keyword">do</span> <span class="token punctuation">{</span>
    cryptData <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token function">aesCBCEncrypt</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span>clearData<span class="token punctuation">,</span> keyData<span class="token punctuation">:</span>keyData<span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;cryptData:   </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">cryptData<span class="token operator">!</span> <span class="token keyword">as</span> <span class="token class-name">NSData</span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token keyword">let</span> status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Error aesCBCEncrypt: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">status</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> decryptData <span class="token punctuation">:</span><span class="token class-name">Data</span><span class="token operator">?</span>
<span class="token keyword">do</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> decryptData <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token function">aesCBCDecrypt</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span>cryptData<span class="token operator">!</span><span class="token punctuation">,</span> keyData<span class="token punctuation">:</span>keyData<span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;decryptData: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">decryptData<span class="token operator">!</span> <span class="token keyword">as</span> <span class="token class-name">NSData</span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token keyword">let</span> status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Error aesCBCDecrypt: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">status</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><p>Example Output:</p> <div class="language-swift extra-class"><pre class="language-swift"><code>clearData<span class="token punctuation">:</span>   <span class="token operator">&lt;</span>636c6561 <span class="token number">72446174</span> <span class="token number">61303132</span> <span class="token number">33343536</span><span class="token operator">&gt;</span>
keyData<span class="token punctuation">:</span>     <span class="token operator">&lt;</span>6b657944 <span class="token number">61746138</span> <span class="token number">39303132</span> <span class="token number">33343536</span><span class="token operator">&gt;</span>
cryptData<span class="token punctuation">:</span>   <span class="token operator">&lt;</span>92c57393 f454d959 5a4d158f 6e1cd3e7 77986ee9 b2970f49 2bafcf1a 8ee9d51a bde49c31 d7780256 71837a61 60fa4be0<span class="token operator">&gt;</span>
decryptData<span class="token punctuation">:</span> <span class="token operator">&lt;</span>636c6561 <span class="token number">72446174</span> <span class="token number">61303132</span> <span class="token number">33343536</span><span class="token operator">&gt;</span>

</code></pre></div><p>Notes:<br>
One typical problem with CBC mode example code is that it leaves the creation and sharing of the random IV to the user. This example includes generation of the IV, prefixed the encrypted data and uses the prefixed IV during decryption. This frees the casual user from the details that are necessary for <a href="https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation#Cipher_Block_Chaining_.28CBC.29" target="_blank" rel="noopener noreferrer">CBC mode<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>For security the encrypted data also should have authentication, this example code does not provide that in order to be small and allow better interoperability for other platforms.</p> <p>Also missing is key derivation of the key from a password, it is suggested that <a href="https://en.wikipedia.org/wiki/PBKDF2" target="_blank" rel="noopener noreferrer">PBKDF2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> be used is text passwords are used as keying material.</p> <p>For robust production ready multi-platform encryption code see <a href="https://github.com/RNCryptor" target="_blank" rel="noopener noreferrer">RNCryptor<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <blockquote></blockquote> <p>Updated to use throw/catch and multiple key sizes based on the provided key.</p> <h2 id="aes-encryption-in-cbc-mode-with-a-random-iv-swift-2-3"><a href="#aes-encryption-in-cbc-mode-with-a-random-iv-swift-2-3" class="header-anchor">#</a> AES encryption in CBC mode with a random IV (Swift 2.3)</h2> <p>The iv is prefixed to the encrypted data</p> <p>aesCBC128Encrypt will create a random IV and prefixed to the encrypted code.
aesCBC128Decrypt will use the prefixed IV during decryption.</p> <p>Inputs are the data and key are Data objects. If an encoded form such as Base64 if required convert to and/or from in the calling method.</p> <p>The key should be exactly 128-bits (16-bytes). For other key sizes see the Swift 3.0 example.</p> <p>PKCS#7 padding is set by default.</p> <p>This example requires Common Crypto
It is necessary to have a bridging header to the project:
#import &lt;CommonCrypto/CommonCrypto.h&gt;
Add the Security.framework to the project.</p> <p>See Swift 3 example for notes.</p> <p>This is example, not production code.</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">func</span> <span class="token function-definition function">aesCBC128Encrypt</span><span class="token punctuation">(</span>data data<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token class-name">UInt8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> keyData<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token class-name">UInt8</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token class-name">UInt8</span><span class="token punctuation">]</span><span class="token operator">?</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> keyLength   <span class="token operator">=</span> <span class="token function">size_t</span><span class="token punctuation">(</span>kCCKeySizeAES128<span class="token punctuation">)</span>
    <span class="token keyword">let</span> ivLength    <span class="token operator">=</span> <span class="token function">size_t</span><span class="token punctuation">(</span>kCCBlockSizeAES128<span class="token punctuation">)</span>
    <span class="token keyword">let</span> cryptDataLength <span class="token operator">=</span> <span class="token function">size_t</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>count <span class="token operator">+</span> kCCBlockSizeAES128<span class="token punctuation">)</span>
    <span class="token keyword">var</span> cryptData <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">UInt8</span><span class="token punctuation">]</span><span class="token punctuation">(</span>count<span class="token punctuation">:</span>ivLength <span class="token operator">+</span> cryptDataLength<span class="token punctuation">,</span> repeatedValue<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">)</span>

    <span class="token keyword">let</span> status <span class="token operator">=</span> <span class="token class-name">SecRandomCopyBytes</span><span class="token punctuation">(</span><span class="token constant">kSecRandomDefault</span><span class="token punctuation">,</span> <span class="token class-name">Int</span><span class="token punctuation">(</span>ivLength<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">UnsafeMutablePointer</span><span class="token operator">&lt;</span><span class="token class-name">UInt8</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>cryptData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;IV Error, errno: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">status</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token nil constant">nil</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> numBytesEncrypted <span class="token punctuation">:</span>size_t <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">let</span> cryptStatus <span class="token operator">=</span> <span class="token class-name">CCCrypt</span><span class="token punctuation">(</span><span class="token class-name">CCOperation</span><span class="token punctuation">(</span><span class="token constant">kCCEncrypt</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                              <span class="token class-name">CCAlgorithm</span><span class="token punctuation">(</span>kCCAlgorithmAES128<span class="token punctuation">)</span><span class="token punctuation">,</span>
                              <span class="token class-name">CCOptions</span><span class="token punctuation">(</span>kCCOptionPKCS7Padding<span class="token punctuation">)</span><span class="token punctuation">,</span>
                              keyData<span class="token punctuation">,</span> keyLength<span class="token punctuation">,</span>
                              cryptData<span class="token punctuation">,</span>
                              data<span class="token punctuation">,</span> data<span class="token punctuation">.</span>count<span class="token punctuation">,</span>
                              <span class="token operator">&amp;</span>cryptData <span class="token operator">+</span> ivLength<span class="token punctuation">,</span> cryptDataLength<span class="token punctuation">,</span>
                              <span class="token operator">&amp;</span>numBytesEncrypted<span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token class-name">UInt32</span><span class="token punctuation">(</span>cryptStatus<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">UInt32</span><span class="token punctuation">(</span><span class="token constant">kCCSuccess</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cryptData<span class="token punctuation">.</span><span class="token function">removeRange</span><span class="token punctuation">(</span>numBytesEncrypted<span class="token operator">+</span>ivLength<span class="token operator">..&lt;</span>cryptData<span class="token punctuation">.</span>count<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Error: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">cryptStatus</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token nil constant">nil</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> cryptData<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function-definition function">aesCBC128Decrypt</span><span class="token punctuation">(</span>data data<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token class-name">UInt8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> keyData<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token class-name">UInt8</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token class-name">UInt8</span><span class="token punctuation">]</span><span class="token operator">?</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> clearLength <span class="token operator">=</span> <span class="token function">size_t</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>count<span class="token punctuation">)</span>
    <span class="token keyword">var</span> clearData   <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">UInt8</span><span class="token punctuation">]</span><span class="token punctuation">(</span>count<span class="token punctuation">:</span>clearLength<span class="token punctuation">,</span> repeatedValue<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">)</span>

    <span class="token keyword">let</span> keyLength   <span class="token operator">=</span> <span class="token function">size_t</span><span class="token punctuation">(</span>kCCKeySizeAES128<span class="token punctuation">)</span>
    <span class="token keyword">let</span> ivLength    <span class="token operator">=</span> <span class="token function">size_t</span><span class="token punctuation">(</span>kCCBlockSizeAES128<span class="token punctuation">)</span>

    <span class="token keyword">var</span> numBytesDecrypted <span class="token punctuation">:</span>size_t <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">let</span> cryptStatus <span class="token operator">=</span> <span class="token class-name">CCCrypt</span><span class="token punctuation">(</span><span class="token class-name">CCOperation</span><span class="token punctuation">(</span><span class="token constant">kCCDecrypt</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                              <span class="token class-name">CCAlgorithm</span><span class="token punctuation">(</span>kCCAlgorithmAES128<span class="token punctuation">)</span><span class="token punctuation">,</span>
                              <span class="token class-name">CCOptions</span><span class="token punctuation">(</span>kCCOptionPKCS7Padding<span class="token punctuation">)</span><span class="token punctuation">,</span>
                              keyData<span class="token punctuation">,</span> keyLength<span class="token punctuation">,</span>
                              data<span class="token punctuation">,</span>
                              <span class="token class-name">UnsafePointer</span><span class="token operator">&lt;</span><span class="token class-name">UInt8</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">+</span> ivLength<span class="token punctuation">,</span> data<span class="token punctuation">.</span>count <span class="token operator">-</span> ivLength<span class="token punctuation">,</span>
                              <span class="token operator">&amp;</span>clearData<span class="token punctuation">,</span> clearLength<span class="token punctuation">,</span>
                              <span class="token operator">&amp;</span>numBytesDecrypted<span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token class-name">UInt32</span><span class="token punctuation">(</span>cryptStatus<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">UInt32</span><span class="token punctuation">(</span><span class="token constant">kCCSuccess</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        clearData<span class="token punctuation">.</span><span class="token function">removeRange</span><span class="token punctuation">(</span>numBytesDecrypted<span class="token operator">..&lt;</span>clearLength<span class="token punctuation">)</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Error: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">cryptStatus</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token nil constant">nil</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> clearData<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>Example usage:</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">let</span> clearData <span class="token operator">=</span> <span class="token function">toData</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;clearData0123456&quot;</span></span><span class="token punctuation">)</span>
<span class="token keyword">let</span> keyData   <span class="token operator">=</span> <span class="token function">toData</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;keyData890123456&quot;</span></span><span class="token punctuation">)</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;clearData:   </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation"><span class="token function">toHex</span><span class="token punctuation">(</span>clearData<span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;keyData:     </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation"><span class="token function">toHex</span><span class="token punctuation">(</span>keyData<span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token keyword">let</span> cryptData <span class="token operator">=</span> <span class="token function">aesCBC128Encrypt</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span>clearData<span class="token punctuation">,</span> keyData<span class="token punctuation">:</span>keyData<span class="token punctuation">)</span><span class="token operator">!</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;cryptData:   </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation"><span class="token function">toHex</span><span class="token punctuation">(</span>cryptData<span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token keyword">let</span> decryptData <span class="token operator">=</span> <span class="token function">aesCBC128Decrypt</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span>cryptData<span class="token punctuation">,</span> keyData<span class="token punctuation">:</span>keyData<span class="token punctuation">)</span><span class="token operator">!</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;decryptData: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation"><span class="token function">toHex</span><span class="token punctuation">(</span>decryptData<span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>

</code></pre></div><p>Example Output:</p> <div class="language-swift extra-class"><pre class="language-swift"><code>clearData<span class="token punctuation">:</span>   <span class="token operator">&lt;</span>636c6561 <span class="token number">72446174</span> <span class="token number">61303132</span> <span class="token number">33343536</span><span class="token operator">&gt;</span>
keyData<span class="token punctuation">:</span>     <span class="token operator">&lt;</span>6b657944 <span class="token number">61746138</span> <span class="token number">39303132</span> <span class="token number">33343536</span><span class="token operator">&gt;</span>
cryptData<span class="token punctuation">:</span>   <span class="token operator">&lt;</span>9fce4323 830e3734 93dd93bf e464f72a a653a3a5 2c40d5ea e90c1017 958750a7 ff094c53 6a81b458 b1fbd6d4 1f583298<span class="token operator">&gt;</span>
decryptData<span class="token punctuation">:</span> <span class="token operator">&lt;</span>636c6561 <span class="token number">72446174</span> <span class="token number">61303132</span> <span class="token number">33343536</span><span class="token operator">&gt;</span>

</code></pre></div><h2 id="aes-encryption-in-ecb-mode-with-pkcs7-padding"><a href="#aes-encryption-in-ecb-mode-with-pkcs7-padding" class="header-anchor">#</a> AES encryption in ECB mode with PKCS7 padding</h2> <p>From Apple documentation for IV,</p> <blockquote></blockquote> <p>This parameter is ignored if ECB mode is used or
if a stream cipher algorithm is selected.</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">func</span> <span class="token function-definition function">AESEncryption</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">String</span><span class="token operator">?</span> <span class="token punctuation">{</span>
        
        <span class="token keyword">let</span> keyData<span class="token punctuation">:</span> <span class="token class-name">NSData</span><span class="token operator">!</span> <span class="token operator">=</span> <span class="token punctuation">(</span>key <span class="token keyword">as</span> <span class="token class-name">NSString</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>using<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token class-name">Encoding</span><span class="token punctuation">.</span>utf8<span class="token punctuation">.</span>rawValue<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token class-name">NSData</span><span class="token operator">!</span>
        
        <span class="token keyword">let</span> data<span class="token punctuation">:</span> <span class="token class-name">NSData</span><span class="token operator">!</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">self</span> <span class="token keyword">as</span> <span class="token class-name">NSString</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>using<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token class-name">Encoding</span><span class="token punctuation">.</span>utf8<span class="token punctuation">.</span>rawValue<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token class-name">NSData</span><span class="token operator">!</span>
        
        <span class="token keyword">let</span> cryptData    <span class="token operator">=</span> <span class="token class-name">NSMutableData</span><span class="token punctuation">(</span>length<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">+</span> kCCBlockSizeAES128<span class="token punctuation">)</span><span class="token operator">!</span>
        
        <span class="token keyword">let</span> keyLength              <span class="token operator">=</span> <span class="token function">size_t</span><span class="token punctuation">(</span>kCCKeySizeAES128<span class="token punctuation">)</span>
        <span class="token keyword">let</span> operation<span class="token punctuation">:</span> <span class="token class-name">CCOperation</span> <span class="token operator">=</span> <span class="token class-name">UInt32</span><span class="token punctuation">(</span><span class="token constant">kCCEncrypt</span><span class="token punctuation">)</span>
        <span class="token keyword">let</span> algoritm<span class="token punctuation">:</span>  <span class="token class-name">CCAlgorithm</span> <span class="token operator">=</span> <span class="token class-name">UInt32</span><span class="token punctuation">(</span>kCCAlgorithmAES128<span class="token punctuation">)</span>
        <span class="token keyword">let</span> options<span class="token punctuation">:</span>   <span class="token class-name">CCOptions</span>   <span class="token operator">=</span> <span class="token class-name">UInt32</span><span class="token punctuation">(</span><span class="token constant">kCCOptionECBMode</span> <span class="token operator">+</span> kCCOptionPKCS7Padding<span class="token punctuation">)</span>
        
        <span class="token keyword">var</span> numBytesEncrypted <span class="token punctuation">:</span>size_t <span class="token operator">=</span> <span class="token number">0</span>
        
        
        <span class="token keyword">let</span> cryptStatus <span class="token operator">=</span> <span class="token class-name">CCCrypt</span><span class="token punctuation">(</span>operation<span class="token punctuation">,</span>
                                  algoritm<span class="token punctuation">,</span>
                                  options<span class="token punctuation">,</span>
                                  keyData<span class="token punctuation">.</span>bytes<span class="token punctuation">,</span> keyLength<span class="token punctuation">,</span>
                                  <span class="token nil constant">nil</span><span class="token punctuation">,</span>
                                  data<span class="token punctuation">.</span>bytes<span class="token punctuation">,</span> data<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
                                  cryptData<span class="token punctuation">.</span>mutableBytes<span class="token punctuation">,</span> cryptData<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
                                  <span class="token operator">&amp;</span>numBytesEncrypted<span class="token punctuation">)</span>
        
        <span class="token keyword">if</span> <span class="token class-name">UInt32</span><span class="token punctuation">(</span>cryptStatus<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">UInt32</span><span class="token punctuation">(</span><span class="token constant">kCCSuccess</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cryptData<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token class-name">Int</span><span class="token punctuation">(</span>numBytesEncrypted<span class="token punctuation">)</span>
            
            <span class="token keyword">var</span> bytes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">UInt8</span><span class="token punctuation">]</span><span class="token punctuation">(</span>repeating<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> count<span class="token punctuation">:</span> cryptData<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
            cryptData<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>bytes<span class="token punctuation">,</span> length<span class="token punctuation">:</span> cryptData<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
            
            <span class="token keyword">var</span> hexString <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;&quot;</span></span>
            <span class="token keyword">for</span> byte <span class="token keyword">in</span> bytes <span class="token punctuation">{</span>
                hexString <span class="token operator">+=</span> <span class="token class-name">String</span><span class="token punctuation">(</span>format<span class="token punctuation">:</span><span class="token string-literal"><span class="token string">&quot;%02x&quot;</span></span><span class="token punctuation">,</span> <span class="token class-name">UInt8</span><span class="token punctuation">(</span>byte<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            
            <span class="token keyword">return</span> hexString
        <span class="token punctuation">}</span>
        
        <span class="token keyword">return</span> <span class="token nil constant">nil</span>
    <span class="token punctuation">}</span>

</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/swift/aes-encryption.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/swift/cryptographic-hashing.html" class="prev">
        Cryptographic Hashing
      </a></span> <span class="next"><a href="/swift/pbkdf2-key-derivation.html">
        PBKDF2 Key Derivation
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/3310.31b3846d.js" defer></script>
  </body>
</html>
