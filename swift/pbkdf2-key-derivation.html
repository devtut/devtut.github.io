<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Swift - PBKDF2 Key Derivation</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Password Based Key Derivation 2 (Swift 3), Password Based Key Derivation 2 (Swift 2.3), Password Based Key Derivation Calibration (Swift 2.3), Password Based Key Derivation Calibration (Swift 3)">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="Swift - PBKDF2 Key Derivation">
    <meta property="og:description" content="Password Based Key Derivation 2 (Swift 3), Password Based Key Derivation 2 (Swift 2.3), Password Based Key Derivation Calibration (Swift 2.3), Password Based Key Derivation Calibration (Swift 3)">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/swift/pbkdf2-key-derivation.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="Swift - PBKDF2 Key Derivation">
    <meta name="twitter:description" content="Password Based Key Derivation 2 (Swift 3), Password Based Key Derivation 2 (Swift 2.3), Password Based Key Derivation Calibration (Swift 2.3), Password Based Key Derivation Calibration (Swift 3)">
    <meta name="twitter:url" content="/swift/pbkdf2-key-derivation.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/3348.4372a8ee.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Swift</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/swift/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/swift/getting-started-with-swift-language.html" class="sidebar-link">Getting started with Swift Language</a></li><li><a href="/swift/variables-properties.html" class="sidebar-link">Variables &amp; Properties</a></li><li><a href="/swift/numbers.html" class="sidebar-link">Numbers</a></li><li><a href="/swift/strings-and-characters.html" class="sidebar-link">Strings and Characters</a></li><li><a href="/swift/booleans.html" class="sidebar-link">Booleans</a></li><li><a href="/swift/arrays.html" class="sidebar-link">Arrays</a></li><li><a href="/swift/tuples.html" class="sidebar-link">Tuples</a></li><li><a href="/swift/enums.html" class="sidebar-link">Enums</a></li><li><a href="/swift/structs.html" class="sidebar-link">Structs</a></li><li><a href="/swift/sets.html" class="sidebar-link">Sets</a></li><li><a href="/swift/dictionaries.html" class="sidebar-link">Dictionaries</a></li><li><a href="/swift/switch.html" class="sidebar-link">Switch</a></li><li><a href="/swift/optionals.html" class="sidebar-link">Optionals</a></li><li><a href="/swift/conditionals.html" class="sidebar-link">Conditionals</a></li><li><a href="/swift/error-handling.html" class="sidebar-link">Error Handling</a></li><li><a href="/swift/loops.html" class="sidebar-link">Loops</a></li><li><a href="/swift/protocols.html" class="sidebar-link">Protocols</a></li><li><a href="/swift/functions.html" class="sidebar-link">Functions</a></li><li><a href="/swift/extensions.html" class="sidebar-link">Extensions</a></li><li><a href="/swift/classes.html" class="sidebar-link">Classes</a></li><li><a href="/swift/type-casting.html" class="sidebar-link">Type Casting</a></li><li><a href="/swift/generics.html" class="sidebar-link">Generics</a></li><li><a href="/swift/optionset.html" class="sidebar-link">OptionSet</a></li><li><a href="/swift/reading-writing-json.html" class="sidebar-link">Reading &amp; Writing JSON</a></li><li><a href="/swift/advanced-operators.html" class="sidebar-link">Advanced Operators</a></li><li><a href="/swift/method-swizzling.html" class="sidebar-link">Method Swizzling</a></li><li><a href="/swift/reflection.html" class="sidebar-link">Reflection</a></li><li><a href="/swift/access-control.html" class="sidebar-link">Access Control</a></li><li><a href="/swift/closures.html" class="sidebar-link">Closures</a></li><li><a href="/swift/initializers.html" class="sidebar-link">Initializers</a></li><li><a href="/swift/associated-objects.html" class="sidebar-link">Associated Objects</a></li><li><a href="/swift/concurrency.html" class="sidebar-link">Concurrency</a></li><li><a href="/swift/getting-started-with-protocol-oriented-programming.html" class="sidebar-link">Getting Started with Protocol Oriented Programming</a></li><li><a href="/swift/functional-programming-in-swift.html" class="sidebar-link">Functional Programming in Swift</a></li><li><a href="/swift/function-as-first-class-citizens-in-swift.html" class="sidebar-link">Function as first class citizens in Swift</a></li><li><a href="/swift/blocks.html" class="sidebar-link">Blocks</a></li><li><a href="/swift/the-defer-statement.html" class="sidebar-link">The Defer Statement</a></li><li><a href="/swift/style-conventions.html" class="sidebar-link">Style Conventions</a></li><li><a href="/swift/nsregularexpression-in-swift.html" class="sidebar-link">NSRegularExpression in Swift</a></li><li><a href="/swift/rxswift.html" class="sidebar-link">RxSwift</a></li><li><a href="/swift/swift-package-manager.html" class="sidebar-link">Swift Package Manager</a></li><li><a href="/swift/working-with-c-and-objective-c.html" class="sidebar-link">Working with C and Objective-C</a></li><li><a href="/swift/documentation-markup.html" class="sidebar-link">Documentation markup</a></li><li><a href="/swift/typealias.html" class="sidebar-link">Typealias</a></li><li><a href="/swift/dependency-injection.html" class="sidebar-link">Dependency Injection</a></li><li><a href="/swift/caching-on-disk-space.html" class="sidebar-link">Caching on disk space</a></li><li><a href="/swift/algorithms-with-swift.html" class="sidebar-link">Algorithms with Swift</a></li><li><a href="/swift/swift-advance-functions.html" class="sidebar-link">Swift Advance functions</a></li><li><a href="/swift/completion-handler.html" class="sidebar-link">Completion Handler</a></li><li><a href="/swift/swift-http-server-by-kitura.html" class="sidebar-link">Swift HTTP server by Kitura</a></li><li><a href="/swift/generate-uiimage-of-initials-from-string.html" class="sidebar-link">Generate UIImage of Initials from String</a></li><li><a href="/swift/design-patterns-creational.html" class="sidebar-link">Design Patterns - Creational</a></li><li><a href="/swift/design-patterns-structural.html" class="sidebar-link">Design Patterns - Structural</a></li><li><a href="/swift/unsafe-buffer-pointers.html" class="sidebar-link">(Unsafe) Buffer Pointers</a></li><li><a href="/swift/cryptographic-hashing.html" class="sidebar-link">Cryptographic Hashing</a></li><li><a href="/swift/aes-encryption.html" class="sidebar-link">AES encryption</a></li><li><a href="/swift/pbkdf2-key-derivation.html" aria-current="page" class="active sidebar-link">PBKDF2 Key Derivation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/swift/pbkdf2-key-derivation.html#password-based-key-derivation-2-swift-3" class="sidebar-link">Password Based Key Derivation 2 (Swift 3)</a></li><li class="sidebar-sub-header"><a href="/swift/pbkdf2-key-derivation.html#password-based-key-derivation-2-swift-2-3" class="sidebar-link">Password Based Key Derivation 2 (Swift 2.3)</a></li><li class="sidebar-sub-header"><a href="/swift/pbkdf2-key-derivation.html#password-based-key-derivation-calibration-swift-2-3" class="sidebar-link">Password Based Key Derivation Calibration (Swift 2.3)</a></li><li class="sidebar-sub-header"><a href="/swift/pbkdf2-key-derivation.html#password-based-key-derivation-calibration-swift-3" class="sidebar-link">Password Based Key Derivation Calibration (Swift 3)</a></li></ul></li><li><a href="/swift/logging-in-swift.html" class="sidebar-link">Logging in Swift</a></li><li><a href="/swift/memory-management.html" class="sidebar-link">Memory Management</a></li><li><a href="/swift/performance.html" class="sidebar-link">Performance</a></li><li><a href="/swift/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="pbkdf2-key-derivation"><a href="#pbkdf2-key-derivation" class="header-anchor">#</a> PBKDF2 Key Derivation</h1> <h2 id="password-based-key-derivation-2-swift-3"><a href="#password-based-key-derivation-2-swift-3" class="header-anchor">#</a> Password Based Key Derivation 2 (Swift 3)</h2> <p>Password Based Key Derivation can be used both for deriving an encryption key from password text and saving a password for authentication purposes.</p> <p>There are several hash algorithms that can be used including SHA1, SHA256, SHA512 which are provided by this example code.</p> <p>The rounds parameter is used to make the calculation slow so that an attacker will have to spend substantial time on each attempt. Typical delay values fall in the 100ms to 500ms, shorter values can be used if there is unacceptable performance.</p> <p>This example requires Common Crypto<br>
It is necessary to have a bridging header to the project:<br> <code>#import &lt;CommonCrypto/CommonCrypto.h&gt;</code><br>
Add the <code>Security.framework</code> to the project.</p> <p>Parameters:</p> <div class="language-swift extra-class"><pre class="language-swift"><code>password     password <span class="token class-name">String</span>  
salt         salt <span class="token class-name">Data</span>  
keyByteCount number of key bytes to generate
rounds       <span class="token class-name">Iteration</span> rounds

returns      <span class="token class-name">Derived</span> key


<span class="token keyword">func</span> <span class="token function-definition function">pbkdf2SHA1</span><span class="token punctuation">(</span>password<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> salt<span class="token punctuation">:</span> <span class="token class-name">Data</span><span class="token punctuation">,</span> keyByteCount<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">,</span> rounds<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Data</span><span class="token operator">?</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">pbkdf2</span><span class="token punctuation">(</span>hash<span class="token punctuation">:</span><span class="token class-name">CCPBKDFAlgorithm</span><span class="token punctuation">(</span>kCCPRFHmacAlgSHA1<span class="token punctuation">)</span><span class="token punctuation">,</span> password<span class="token punctuation">:</span>password<span class="token punctuation">,</span> salt<span class="token punctuation">:</span>salt<span class="token punctuation">,</span> keyByteCount<span class="token punctuation">:</span>keyByteCount<span class="token punctuation">,</span> rounds<span class="token punctuation">:</span>rounds<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function-definition function">pbkdf2SHA256</span><span class="token punctuation">(</span>password<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> salt<span class="token punctuation">:</span> <span class="token class-name">Data</span><span class="token punctuation">,</span> keyByteCount<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">,</span> rounds<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Data</span><span class="token operator">?</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">pbkdf2</span><span class="token punctuation">(</span>hash<span class="token punctuation">:</span><span class="token class-name">CCPBKDFAlgorithm</span><span class="token punctuation">(</span>kCCPRFHmacAlgSHA256<span class="token punctuation">)</span><span class="token punctuation">,</span> password<span class="token punctuation">:</span>password<span class="token punctuation">,</span> salt<span class="token punctuation">:</span>salt<span class="token punctuation">,</span> keyByteCount<span class="token punctuation">:</span>keyByteCount<span class="token punctuation">,</span> rounds<span class="token punctuation">:</span>rounds<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function-definition function">pbkdf2SHA512</span><span class="token punctuation">(</span>password<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> salt<span class="token punctuation">:</span> <span class="token class-name">Data</span><span class="token punctuation">,</span> keyByteCount<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">,</span> rounds<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Data</span><span class="token operator">?</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">pbkdf2</span><span class="token punctuation">(</span>hash<span class="token punctuation">:</span><span class="token class-name">CCPBKDFAlgorithm</span><span class="token punctuation">(</span>kCCPRFHmacAlgSHA512<span class="token punctuation">)</span><span class="token punctuation">,</span> password<span class="token punctuation">:</span>password<span class="token punctuation">,</span> salt<span class="token punctuation">:</span>salt<span class="token punctuation">,</span> keyByteCount<span class="token punctuation">:</span>keyByteCount<span class="token punctuation">,</span> rounds<span class="token punctuation">:</span>rounds<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function-definition function">pbkdf2</span><span class="token punctuation">(</span>hash <span class="token punctuation">:</span><span class="token class-name">CCPBKDFAlgorithm</span><span class="token punctuation">,</span> password<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> salt<span class="token punctuation">:</span> <span class="token class-name">Data</span><span class="token punctuation">,</span> keyByteCount<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">,</span> rounds<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Data</span><span class="token operator">?</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> passwordData <span class="token operator">=</span> password<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>using<span class="token punctuation">:</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token class-name">Encoding</span><span class="token punctuation">.</span>utf8<span class="token punctuation">)</span><span class="token operator">!</span>
    <span class="token keyword">var</span> derivedKeyData <span class="token operator">=</span> <span class="token class-name">Data</span><span class="token punctuation">(</span>repeating<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span> count<span class="token punctuation">:</span>keyByteCount<span class="token punctuation">)</span>

    <span class="token keyword">let</span> derivationStatus <span class="token operator">=</span> derivedKeyData<span class="token punctuation">.</span>withUnsafeMutableBytes <span class="token punctuation">{</span>derivedKeyBytes <span class="token keyword">in</span>
        salt<span class="token punctuation">.</span>withUnsafeBytes <span class="token punctuation">{</span> saltBytes <span class="token keyword">in</span>

            <span class="token class-name">CCKeyDerivationPBKDF</span><span class="token punctuation">(</span>
                <span class="token class-name">CCPBKDFAlgorithm</span><span class="token punctuation">(</span>kCCPBKDF2<span class="token punctuation">)</span><span class="token punctuation">,</span>
                password<span class="token punctuation">,</span> passwordData<span class="token punctuation">.</span>count<span class="token punctuation">,</span>
                saltBytes<span class="token punctuation">,</span> salt<span class="token punctuation">.</span>count<span class="token punctuation">,</span>
                hash<span class="token punctuation">,</span>
                <span class="token class-name">UInt32</span><span class="token punctuation">(</span>rounds<span class="token punctuation">)</span><span class="token punctuation">,</span>
                derivedKeyBytes<span class="token punctuation">,</span> derivedKeyData<span class="token punctuation">.</span>count<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>derivationStatus <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Error: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">derivationStatus</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token nil constant">nil</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> derivedKeyData
<span class="token punctuation">}</span>

</code></pre></div><p>Example usage:</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">let</span> password     <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;password&quot;</span></span>
<span class="token comment">//let salt       = &quot;saltData&quot;.data(using: String.Encoding.utf8)!</span>
<span class="token keyword">let</span> salt         <span class="token operator">=</span> <span class="token class-name">Data</span><span class="token punctuation">(</span>bytes<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0x73</span><span class="token punctuation">,</span> <span class="token number">0x61</span><span class="token punctuation">,</span> <span class="token number">0x6c</span><span class="token punctuation">,</span> <span class="token number">0x74</span><span class="token punctuation">,</span> <span class="token number">0x44</span><span class="token punctuation">,</span> <span class="token number">0x61</span><span class="token punctuation">,</span> <span class="token number">0x74</span><span class="token punctuation">,</span> <span class="token number">0x61</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> keyByteCount <span class="token operator">=</span> <span class="token number">16</span>
<span class="token keyword">let</span> rounds       <span class="token operator">=</span> <span class="token number">100000</span>

<span class="token keyword">let</span> derivedKey <span class="token operator">=</span> <span class="token function">pbkdf2SHA1</span><span class="token punctuation">(</span>password<span class="token punctuation">:</span>password<span class="token punctuation">,</span> salt<span class="token punctuation">:</span>salt<span class="token punctuation">,</span> keyByteCount<span class="token punctuation">:</span>keyByteCount<span class="token punctuation">,</span> rounds<span class="token punctuation">:</span>rounds<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;derivedKey (SHA1): </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">derivedKey<span class="token operator">!</span> <span class="token keyword">as</span> <span class="token class-name">NSData</span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>

</code></pre></div><p>Example Output:</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token function">derivedKey</span> <span class="token punctuation">(</span>SHA1<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>6b9d4fa3 0385d128 f6d196ee 3f1d6dbf<span class="token operator">&gt;</span>

</code></pre></div><h2 id="password-based-key-derivation-2-swift-2-3"><a href="#password-based-key-derivation-2-swift-2-3" class="header-anchor">#</a> Password Based Key Derivation 2 (Swift 2.3)</h2> <p>See Swift 3 example for usage information and notes</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">func</span> <span class="token function-definition function">pbkdf2SHA1</span><span class="token punctuation">(</span>password<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> salt<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">UInt8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> keyCount<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">,</span> rounds<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token class-name">UInt8</span><span class="token punctuation">]</span><span class="token operator">?</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">pbkdf2</span><span class="token punctuation">(</span><span class="token class-name">CCPBKDFAlgorithm</span><span class="token punctuation">(</span>kCCPRFHmacAlgSHA1<span class="token punctuation">)</span><span class="token punctuation">,</span> password<span class="token punctuation">:</span>password<span class="token punctuation">,</span> salt<span class="token punctuation">:</span>salt<span class="token punctuation">,</span> keyCount<span class="token punctuation">:</span>keyCount<span class="token punctuation">,</span> rounds<span class="token punctuation">:</span><span class="token class-name">UInt32</span><span class="token punctuation">(</span>rounds<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function-definition function">pbkdf2SHA256</span><span class="token punctuation">(</span>password<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> salt<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">UInt8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> keyCount<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">,</span> rounds<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token class-name">UInt8</span><span class="token punctuation">]</span><span class="token operator">?</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">pbkdf2</span><span class="token punctuation">(</span><span class="token class-name">CCPBKDFAlgorithm</span><span class="token punctuation">(</span>kCCPRFHmacAlgSHA256<span class="token punctuation">)</span><span class="token punctuation">,</span> password<span class="token punctuation">:</span>password<span class="token punctuation">,</span> salt<span class="token punctuation">:</span>salt<span class="token punctuation">,</span> keyCount<span class="token punctuation">:</span>keyCount<span class="token punctuation">,</span> rounds<span class="token punctuation">:</span><span class="token class-name">UInt32</span><span class="token punctuation">(</span>rounds<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function-definition function">pbkdf2SHA512</span><span class="token punctuation">(</span>password<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> salt<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">UInt8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> keyCount<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">,</span> rounds<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token class-name">UInt8</span><span class="token punctuation">]</span><span class="token operator">?</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">pbkdf2</span><span class="token punctuation">(</span><span class="token class-name">CCPBKDFAlgorithm</span><span class="token punctuation">(</span>kCCPRFHmacAlgSHA512<span class="token punctuation">)</span><span class="token punctuation">,</span> password<span class="token punctuation">:</span>password<span class="token punctuation">,</span> salt<span class="token punctuation">:</span>salt<span class="token punctuation">,</span> keyCount<span class="token punctuation">:</span>keyCount<span class="token punctuation">,</span> rounds<span class="token punctuation">:</span><span class="token class-name">UInt32</span><span class="token punctuation">(</span>rounds<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function-definition function">pbkdf2</span><span class="token punctuation">(</span>hash <span class="token punctuation">:</span><span class="token class-name">CCPBKDFAlgorithm</span><span class="token punctuation">,</span> password<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> salt<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">UInt8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> keyCount<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">,</span> rounds<span class="token punctuation">:</span> <span class="token class-name">UInt32</span><span class="token operator">!</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token class-name">UInt8</span><span class="token punctuation">]</span><span class="token operator">!</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> derivedKey   <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">UInt8</span><span class="token punctuation">]</span><span class="token punctuation">(</span>count<span class="token punctuation">:</span>keyCount<span class="token punctuation">,</span> repeatedValue<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> passwordData <span class="token operator">=</span> password<span class="token punctuation">.</span><span class="token function">dataUsingEncoding</span><span class="token punctuation">(</span><span class="token class-name">NSUTF8StringEncoding</span><span class="token punctuation">)</span><span class="token operator">!</span>

    <span class="token keyword">let</span> derivationStatus <span class="token operator">=</span> <span class="token class-name">CCKeyDerivationPBKDF</span><span class="token punctuation">(</span>
        <span class="token class-name">CCPBKDFAlgorithm</span><span class="token punctuation">(</span>kCCPBKDF2<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token class-name">UnsafePointer</span><span class="token operator">&lt;</span><span class="token class-name">Int8</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>passwordData<span class="token punctuation">.</span>bytes<span class="token punctuation">)</span><span class="token punctuation">,</span> passwordData<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
        <span class="token class-name">UnsafePointer</span><span class="token operator">&lt;</span><span class="token class-name">UInt8</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>salt<span class="token punctuation">)</span><span class="token punctuation">,</span> salt<span class="token punctuation">.</span>count<span class="token punctuation">,</span>
        <span class="token class-name">CCPseudoRandomAlgorithm</span><span class="token punctuation">(</span>hash<span class="token punctuation">)</span><span class="token punctuation">,</span>
        rounds<span class="token punctuation">,</span>
        <span class="token class-name">UnsafeMutablePointer</span><span class="token operator">&lt;</span><span class="token class-name">UInt8</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>derivedKey<span class="token punctuation">)</span><span class="token punctuation">,</span>
        derivedKey<span class="token punctuation">.</span>count<span class="token punctuation">)</span>


    <span class="token keyword">if</span> <span class="token punctuation">(</span>derivationStatus <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Error: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">derivationStatus</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token nil constant">nil</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> derivedKey
<span class="token punctuation">}</span>

</code></pre></div><p>Example usage:</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">let</span> password <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;password&quot;</span></span>
<span class="token comment">// let salt  = [UInt8](&quot;saltData&quot;.utf8)</span>
<span class="token keyword">let</span> salt     <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">UInt8</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0x73</span><span class="token punctuation">,</span> <span class="token number">0x61</span><span class="token punctuation">,</span> <span class="token number">0x6c</span><span class="token punctuation">,</span> <span class="token number">0x74</span><span class="token punctuation">,</span> <span class="token number">0x44</span><span class="token punctuation">,</span> <span class="token number">0x61</span><span class="token punctuation">,</span> <span class="token number">0x74</span><span class="token punctuation">,</span> <span class="token number">0x61</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> rounds   <span class="token operator">=</span> <span class="token number">100_000</span>
<span class="token keyword">let</span> keyCount <span class="token operator">=</span> <span class="token number">16</span>

<span class="token keyword">let</span> derivedKey <span class="token operator">=</span> <span class="token function">pbkdf2SHA1</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span> salt<span class="token punctuation">:</span>salt<span class="token punctuation">,</span> keyCount<span class="token punctuation">:</span>keyCount<span class="token punctuation">,</span> rounds<span class="token punctuation">:</span>rounds<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;derivedKey (SHA1):   </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation"><span class="token class-name">NSData</span><span class="token punctuation">(</span>bytes<span class="token punctuation">:</span>derivedKey<span class="token operator">!</span><span class="token punctuation">,</span> length<span class="token punctuation">:</span>derivedKey<span class="token operator">!</span><span class="token punctuation">.</span>count<span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>

</code></pre></div><p>Example Output:</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token function">derivedKey</span> <span class="token punctuation">(</span>SHA1<span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token operator">&lt;</span>6b9d4fa3 0385d128 f6d196ee 3f1d6dbf<span class="token operator">&gt;</span>

</code></pre></div><h2 id="password-based-key-derivation-calibration-swift-2-3"><a href="#password-based-key-derivation-calibration-swift-2-3" class="header-anchor">#</a> Password Based Key Derivation Calibration (Swift 2.3)</h2> <p>See Swift 3 example for usage information and notes</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">func</span> <span class="token function-definition function">pbkdf2SHA1Calibrate</span><span class="token punctuation">(</span>password<span class="token punctuation">:</span><span class="token class-name">String</span><span class="token punctuation">,</span> salt<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token class-name">UInt8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> msec<span class="token punctuation">:</span><span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">UInt32</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> actualRoundCount<span class="token punctuation">:</span> <span class="token class-name">UInt32</span> <span class="token operator">=</span> <span class="token class-name">CCCalibratePBKDF</span><span class="token punctuation">(</span>
        <span class="token class-name">CCPBKDFAlgorithm</span><span class="token punctuation">(</span>kCCPBKDF2<span class="token punctuation">)</span><span class="token punctuation">,</span>
        password<span class="token punctuation">.</span>utf8<span class="token punctuation">.</span>count<span class="token punctuation">,</span>
        salt<span class="token punctuation">.</span>count<span class="token punctuation">,</span>
        <span class="token class-name">CCPseudoRandomAlgorithm</span><span class="token punctuation">(</span>kCCPRFHmacAlgSHA1<span class="token punctuation">)</span><span class="token punctuation">,</span>
        kCCKeySizeAES256<span class="token punctuation">,</span>
        <span class="token class-name">UInt32</span><span class="token punctuation">(</span>msec<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> actualRoundCount
<span class="token punctuation">}</span>

</code></pre></div><p>Example usage:</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">let</span> saltData       <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">UInt8</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0x73</span><span class="token punctuation">,</span> <span class="token number">0x61</span><span class="token punctuation">,</span> <span class="token number">0x6c</span><span class="token punctuation">,</span> <span class="token number">0x74</span><span class="token punctuation">,</span> <span class="token number">0x44</span><span class="token punctuation">,</span> <span class="token number">0x61</span><span class="token punctuation">,</span> <span class="token number">0x74</span><span class="token punctuation">,</span> <span class="token number">0x61</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> passwordString <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;password&quot;</span></span>
<span class="token keyword">let</span> delayMsec      <span class="token operator">=</span> <span class="token number">100</span>

<span class="token keyword">let</span> rounds <span class="token operator">=</span> <span class="token function">pbkdf2SHA1Calibrate</span><span class="token punctuation">(</span>passwordString<span class="token punctuation">,</span> salt<span class="token punctuation">:</span>saltData<span class="token punctuation">,</span> msec<span class="token punctuation">:</span>delayMsec<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;For </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">delayMsec</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string"> msec delay, rounds: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">rounds</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>

</code></pre></div><p>Example Output:</p> <blockquote></blockquote> <p>For 100 msec delay, rounds: 94339</p> <h2 id="password-based-key-derivation-calibration-swift-3"><a href="#password-based-key-derivation-calibration-swift-3" class="header-anchor">#</a> Password Based Key Derivation Calibration (Swift 3)</h2> <p>Determine the number of PRF rounds to use for a specific delay on the current platform.</p> <p>Several parameters are defaulted to representative values that should not materially affect the round count.</p> <div class="language-swift extra-class"><pre class="language-swift"><code>password <span class="token class-name">Sample</span> password<span class="token punctuation">.</span>  
salt     <span class="token class-name">Sample</span> salt<span class="token punctuation">.</span>  
msec     <span class="token class-name">Targeted</span> duration we want to achieve <span class="token keyword">for</span> a key derivation<span class="token punctuation">.</span>

returns  <span class="token class-name">The</span> number of iterations to use <span class="token keyword">for</span> the desired processing time<span class="token punctuation">.</span>


<span class="token keyword">func</span> <span class="token function-definition function">pbkdf2SHA1Calibrate</span><span class="token punctuation">(</span>password<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> salt<span class="token punctuation">:</span> <span class="token class-name">Data</span><span class="token punctuation">,</span> msec<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">UInt32</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> actualRoundCount<span class="token punctuation">:</span> <span class="token class-name">UInt32</span> <span class="token operator">=</span> <span class="token class-name">CCCalibratePBKDF</span><span class="token punctuation">(</span>
        <span class="token class-name">CCPBKDFAlgorithm</span><span class="token punctuation">(</span>kCCPBKDF2<span class="token punctuation">)</span><span class="token punctuation">,</span>
        password<span class="token punctuation">.</span>utf8<span class="token punctuation">.</span>count<span class="token punctuation">,</span>
        salt<span class="token punctuation">.</span>count<span class="token punctuation">,</span>
        <span class="token class-name">CCPseudoRandomAlgorithm</span><span class="token punctuation">(</span>kCCPRFHmacAlgSHA1<span class="token punctuation">)</span><span class="token punctuation">,</span>
        kCCKeySizeAES256<span class="token punctuation">,</span>
        <span class="token class-name">UInt32</span><span class="token punctuation">(</span>msec<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> actualRoundCount
<span class="token punctuation">}</span>

</code></pre></div><p>Example usage:</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">let</span> saltData       <span class="token operator">=</span> <span class="token class-name">Data</span><span class="token punctuation">(</span>bytes<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0x73</span><span class="token punctuation">,</span> <span class="token number">0x61</span><span class="token punctuation">,</span> <span class="token number">0x6c</span><span class="token punctuation">,</span> <span class="token number">0x74</span><span class="token punctuation">,</span> <span class="token number">0x44</span><span class="token punctuation">,</span> <span class="token number">0x61</span><span class="token punctuation">,</span> <span class="token number">0x74</span><span class="token punctuation">,</span> <span class="token number">0x61</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> passwordString <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;password&quot;</span></span>
<span class="token keyword">let</span> delayMsec      <span class="token operator">=</span> <span class="token number">100</span>

<span class="token keyword">let</span> rounds <span class="token operator">=</span> <span class="token function">pbkdf2SHA1Calibrate</span><span class="token punctuation">(</span>password<span class="token punctuation">:</span>passwordString<span class="token punctuation">,</span> salt<span class="token punctuation">:</span>saltData<span class="token punctuation">,</span> msec<span class="token punctuation">:</span>delayMsec<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;For </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">delayMsec</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string"> msec delay, rounds: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">rounds</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>

</code></pre></div><p>Example Output:</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token class-name">For</span> <span class="token number">100</span> msec delay<span class="token punctuation">,</span> rounds<span class="token punctuation">:</span> <span class="token number">93457</span>

</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/swift/pbkdf2-key-derivation.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/swift/aes-encryption.html" class="prev">
        AES encryption
      </a></span> <span class="next"><a href="/swift/logging-in-swift.html">
        Logging in Swift
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/3348.4372a8ee.js" defer></script>
  </body>
</html>
