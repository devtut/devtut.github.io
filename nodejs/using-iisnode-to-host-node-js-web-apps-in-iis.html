<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Node.js - Using IISNode to host Node.js Web Apps in IIS</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Using an IIS Virtual Directory or Nested Application via <appSettings>, Getting Started, Basic Hello World Example using Express, Using Socket.io with IISNode">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="Node.js - Using IISNode to host Node.js Web Apps in IIS">
    <meta property="og:description" content="Using an IIS Virtual Directory or Nested Application via <appSettings>, Getting Started, Basic Hello World Example using Express, Using Socket.io with IISNode">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/nodejs/using-iisnode-to-host-node-js-web-apps-in-iis.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="Node.js - Using IISNode to host Node.js Web Apps in IIS">
    <meta name="twitter:description" content="Using an IIS Virtual Directory or Nested Application via <appSettings>, Getting Started, Basic Hello World Example using Express, Using Socket.io with IISNode">
    <meta name="twitter:url" content="/nodejs/using-iisnode-to-host-node-js-web-apps-in-iis.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/2268.56a23291.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Node.js</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/nodejs/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/nodejs/installing-node-js.html" class="sidebar-link">Installing Node.js</a></li><li><a href="/nodejs/getting-started-with-node-js.html" class="sidebar-link">Getting started with Node.js</a></li><li><a href="/nodejs/npm.html" class="sidebar-link">npm</a></li><li><a href="/nodejs/web-apps-with-express.html" class="sidebar-link">Web Apps With Express</a></li><li><a href="/nodejs/filesystem-i-o.html" class="sidebar-link">Filesystem I/O</a></li><li><a href="/nodejs/exporting-and-consuming-modules.html" class="sidebar-link">Exporting and Consuming Modules</a></li><li><a href="/nodejs/exporting-and-importing-module-in-node-js.html" class="sidebar-link">Exporting and Importing Module in node.js</a></li><li><a href="/nodejs/how-modules-are-loaded.html" class="sidebar-link">How modules are loaded</a></li><li><a href="/nodejs/cluster-module.html" class="sidebar-link">Cluster Module</a></li><li><a href="/nodejs/readline.html" class="sidebar-link">Readline</a></li><li><a href="/nodejs/package-json.html" class="sidebar-link">package.json</a></li><li><a href="/nodejs/event-emitters.html" class="sidebar-link">Event Emitters</a></li><li><a href="/nodejs/autoreload-on-changes.html" class="sidebar-link">Autoreload on changes</a></li><li><a href="/nodejs/environment.html" class="sidebar-link">Environment</a></li><li><a href="/nodejs/callback-to-promise.html" class="sidebar-link">Callback to Promise</a></li><li><a href="/nodejs/executing-files-or-commands-with-child-processes.html" class="sidebar-link">Executing files or commands with Child Processes</a></li><li><a href="/nodejs/exception-handling.html" class="sidebar-link">Exception handling</a></li><li><a href="/nodejs/keep-a-node-application-constantly-running.html" class="sidebar-link">Keep a node application constantly running</a></li><li><a href="/nodejs/uninstalling-node-js.html" class="sidebar-link">Uninstalling Node.js</a></li><li><a href="/nodejs/nvm-node-version-manager.html" class="sidebar-link">nvm - Node Version Manager</a></li><li><a href="/nodejs/http.html" class="sidebar-link">http</a></li><li><a href="/nodejs/using-streams.html" class="sidebar-link">Using Streams</a></li><li><a href="/nodejs/deploying-node-js-applications-in-production.html" class="sidebar-link">Deploying Node.js applications in production</a></li><li><a href="/nodejs/securing-node-js-applications.html" class="sidebar-link">Securing Node.js applications</a></li><li><a href="/nodejs/mongoose-library.html" class="sidebar-link">Mongoose Library</a></li><li><a href="/nodejs/async-js.html" class="sidebar-link">async.js</a></li><li><a href="/nodejs/file-upload.html" class="sidebar-link">File upload</a></li><li><a href="/nodejs/socket-io-communication.html" class="sidebar-link">Socket.io communication</a></li><li><a href="/nodejs/mongodb-integration.html" class="sidebar-link">Mongodb integration</a></li><li><a href="/nodejs/handling-post-request-in-node-js.html" class="sidebar-link">Handling POST request in Node.js</a></li><li><a href="/nodejs/simple-rest-based-crud-api.html" class="sidebar-link">Simple REST based CRUD API</a></li><li><a href="/nodejs/template-frameworks.html" class="sidebar-link">Template frameworks</a></li><li><a href="/nodejs/node-js-architecture-inner-workings.html" class="sidebar-link">Node.js Architecture &amp; Inner Workings</a></li><li><a href="/nodejs/debugging-node-js-application.html" class="sidebar-link">Debugging Node.js application</a></li><li><a href="/nodejs/node-server-without-framework.html" class="sidebar-link">Node server without framework</a></li><li><a href="/nodejs/node-js-with-es6.html" class="sidebar-link">Node.JS with ES6</a></li><li><a href="/nodejs/interacting-with-console.html" class="sidebar-link">Interacting with Console</a></li><li><a href="/nodejs/cassandra-integration.html" class="sidebar-link">Cassandra Integration</a></li><li><a href="/nodejs/creating-api-s-with-node-js.html" class="sidebar-link">Creating API's with Node.js</a></li><li><a href="/nodejs/graceful-shutdown.html" class="sidebar-link">Graceful Shutdown</a></li><li><a href="/nodejs/using-iisnode-to-host-node-js-web-apps-in-iis.html" aria-current="page" class="active sidebar-link">Using IISNode to host Node.js Web Apps in IIS</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/nodejs/using-iisnode-to-host-node-js-web-apps-in-iis.html#using-an-iis-virtual-directory-or-nested-application-via" class="sidebar-link">Using an IIS Virtual Directory or Nested Application via</a></li><li class="sidebar-sub-header"><a href="/nodejs/using-iisnode-to-host-node-js-web-apps-in-iis.html#getting-started" class="sidebar-link">Getting Started</a></li><li class="sidebar-sub-header"><a href="/nodejs/using-iisnode-to-host-node-js-web-apps-in-iis.html#basic-hello-world-example-using-express" class="sidebar-link">Basic Hello World Example using Express</a></li><li class="sidebar-sub-header"><a href="/nodejs/using-iisnode-to-host-node-js-web-apps-in-iis.html#using-socket-io-with-iisnode" class="sidebar-link">Using Socket.io with IISNode</a></li></ul></li><li><a href="/nodejs/cli.html" class="sidebar-link">CLI</a></li><li><a href="/nodejs/nodejs-frameworks.html" class="sidebar-link">NodeJS Frameworks</a></li><li><a href="/nodejs/grunt.html" class="sidebar-link">grunt</a></li><li><a href="/nodejs/using-websocket-s-with-node-js.html" class="sidebar-link">Using WebSocket's with Node.JS</a></li><li><a href="/nodejs/metalsmith.html" class="sidebar-link">metalsmith</a></li><li><a href="/nodejs/parsing-command-line-arguments.html" class="sidebar-link">Parsing command line arguments</a></li><li><a href="/nodejs/client-server-communication.html" class="sidebar-link">Client-server communication</a></li><li><a href="/nodejs/node-js-design-fundamental.html" class="sidebar-link">Node.js Design Fundamental</a></li><li><a href="/nodejs/connect-to-mongodb.html" class="sidebar-link">Connect to Mongodb</a></li><li><a href="/nodejs/performance-challenges.html" class="sidebar-link">Performance challenges</a></li><li><a href="/nodejs/send-web-notification.html" class="sidebar-link">Send Web Notification</a></li><li><a href="/nodejs/remote-debugging-in-node-js.html" class="sidebar-link">Remote Debugging in Node.JS</a></li><li><a href="/nodejs/database-mongodb-with-mongoose.html" class="sidebar-link">Database (MongoDB with Mongoose)</a></li><li><a href="/nodejs/good-coding-style.html" class="sidebar-link">Good coding style</a></li><li><a href="/nodejs/restful-api-design-best-practices.html" class="sidebar-link">Restful API Design: Best Practices</a></li><li><a href="/nodejs/deliver-html-or-any-other-sort-of-file.html" class="sidebar-link">Deliver HTML or any other sort of file</a></li><li><a href="/nodejs/tcp-sockets.html" class="sidebar-link">TCP Sockets</a></li><li><a href="/nodejs/hack.html" class="sidebar-link">Hack</a></li><li><a href="/nodejs/bluebird-promises.html" class="sidebar-link">Bluebird Promises</a></li><li><a href="/nodejs/async-await.html" class="sidebar-link">Async/Await</a></li><li><a href="/nodejs/koa-framework-v2.html" class="sidebar-link">Koa Framework v2</a></li><li><a href="/nodejs/unit-testing-frameworks.html" class="sidebar-link">Unit testing frameworks</a></li><li><a href="/nodejs/ecmascript-2015-es6-with-node-js.html" class="sidebar-link">ECMAScript 2015 (ES6) with Node.js</a></li><li><a href="/nodejs/routing-ajax-requests-with-express-js.html" class="sidebar-link">Routing ajax requests with Express.JS</a></li><li><a href="/nodejs/sending-a-file-stream-to-client.html" class="sidebar-link">Sending a file stream to client</a></li><li><a href="/nodejs/nodejs-with-redis.html" class="sidebar-link">NodeJS with Redis</a></li><li><a href="/nodejs/using-browserfiy-to-resolve-required-error-with-browsers.html" class="sidebar-link">Using Browserfiy to resolve 'required' error with browsers</a></li><li><a href="/nodejs/node-js-and-mongodb.html" class="sidebar-link">Node.JS and MongoDB.</a></li><li><a href="/nodejs/passport-integration.html" class="sidebar-link">Passport integration</a></li><li><a href="/nodejs/dependency-injection.html" class="sidebar-link">Dependency Injection</a></li><li><a href="/nodejs/nodejs-beginner-guide.html" class="sidebar-link">NodeJS Beginner Guide</a></li><li><a href="/nodejs/use-cases-of-node-js.html" class="sidebar-link">Use Cases of Node.js</a></li><li><a href="/nodejs/sequelize-js.html" class="sidebar-link">Sequelize.js</a></li><li><a href="/nodejs/postgresql-integration.html" class="sidebar-link">PostgreSQL integration</a></li><li><a href="/nodejs/mysql-integration.html" class="sidebar-link">MySQL integration</a></li><li><a href="/nodejs/mysql-connection-pool.html" class="sidebar-link">Mysql Connection Pool</a></li><li><a href="/nodejs/mssql-intergration.html" class="sidebar-link">MSSQL Intergration</a></li><li><a href="/nodejs/node-js-with-oracle.html" class="sidebar-link">Node.js with Oracle</a></li><li><a href="/nodejs/synchronous-vs-asynchronous-programming-in-nodejs.html" class="sidebar-link">Synchronous vs Asynchronous programming in nodejs</a></li><li><a href="/nodejs/node-js-error-management.html" class="sidebar-link">Node.js Error Management</a></li><li><a href="/nodejs/node-js-v6-new-features-and-improvement.html" class="sidebar-link">Node.js v6 New Features and Improvement</a></li><li><a href="/nodejs/eventloop.html" class="sidebar-link">Eventloop</a></li><li><a href="/nodejs/nodejs-history.html" class="sidebar-link">Nodejs History</a></li><li><a href="/nodejs/passport-js.html" class="sidebar-link">passport.js</a></li><li><a href="/nodejs/asynchronous-programming.html" class="sidebar-link">Asynchronous programming</a></li><li><a href="/nodejs/node-js-code-for-stdin-and-stdout-without-using-any-library.html" class="sidebar-link">Node.js code for STDIN and STDOUT without using  any library</a></li><li><a href="/nodejs/mongodb-integration-for-node-js-express-js.html" class="sidebar-link">MongoDB Integration for Node.js/Express.js</a></li><li><a href="/nodejs/lodash.html" class="sidebar-link">Lodash</a></li><li><a href="/nodejs/csv-parser-in-node-js.html" class="sidebar-link">csv parser in node js</a></li><li><a href="/nodejs/loopback-rest-based-connector.html" class="sidebar-link">Loopback - REST Based connector</a></li><li><a href="/nodejs/running-node-js-as-a-service.html" class="sidebar-link">Running node.js as a service</a></li><li><a href="/nodejs/node-js-with-cors.html" class="sidebar-link">Node.js with CORS</a></li><li><a href="/nodejs/getting-started-with-nodes-profiling.html" class="sidebar-link">Getting started with Nodes profiling</a></li><li><a href="/nodejs/node-js-performance.html" class="sidebar-link">Node.js Performance</a></li><li><a href="/nodejs/yarn-package-manager.html" class="sidebar-link">Yarn Package Manager</a></li><li><a href="/nodejs/oauth-2-0.html" class="sidebar-link">OAuth 2.0</a></li><li><a href="/nodejs/node-js-localization.html" class="sidebar-link">Node JS Localization</a></li><li><a href="/nodejs/deploying-node-js-application-without-downtime.html" class="sidebar-link">Deploying Node.js application without downtime.</a></li><li><a href="/nodejs/node-js-express-js-with-angular-js-sample-code.html" class="sidebar-link">Node.js (express.js) with angular.js Sample code</a></li><li><a href="/nodejs/nodejs-routing.html" class="sidebar-link">NodeJs Routing</a></li><li><a href="/nodejs/creating-a-node-js-library-that-supports-both-promises-and-error-first-callbacks.html" class="sidebar-link">Creating a Node.js Library that Supports Both Promises and Error-First Callbacks</a></li><li><a href="/nodejs/project-structure.html" class="sidebar-link">Project Structure</a></li><li><a href="/nodejs/avoid-callback-hell.html" class="sidebar-link">Avoid callback hell</a></li><li><a href="/nodejs/arduino-communication-with-nodejs.html" class="sidebar-link">Arduino communication with nodeJs</a></li><li><a href="/nodejs/n-api.html" class="sidebar-link">N-API</a></li><li><a href="/nodejs/multithreading.html" class="sidebar-link">Multithreading</a></li><li><a href="/nodejs/windows-authentication-under-node-js.html" class="sidebar-link">Windows authentication under node.js</a></li><li><a href="/nodejs/require.html" class="sidebar-link">Require()</a></li><li><a href="/nodejs/route-controller-service-structure-for-expressjs.html" class="sidebar-link">Route-Controller-Service structure for ExpressJS</a></li><li><a href="/nodejs/push-notifications.html" class="sidebar-link">Push notifications</a></li><li><a href="/nodejs/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="using-iisnode-to-host-node-js-web-apps-in-iis"><a href="#using-iisnode-to-host-node-js-web-apps-in-iis" class="header-anchor">#</a> Using IISNode to host Node.js Web Apps in IIS</h1> <h2 id="using-an-iis-virtual-directory-or-nested-application-via"><a href="#using-an-iis-virtual-directory-or-nested-application-via" class="header-anchor">#</a> Using an IIS Virtual Directory or Nested Application via <appSettings></appSettings></h2> <p>Using a Virtual Directory or Nested Application in IIS is a common scenario and most likely one that you'll want to take advantage of when using IISNode.</p> <p>IISNode doesn't provide direct support for Virtual Directories or Nested Applications via configuration so to achieve this we'll need to take advantage of a feature of IISNode that isn't part of the configuration and is much lesser known. All children of the <code>&lt;appSettings&gt;</code> element with the <code>Web.config</code> are added to the <code>process.env</code> object as properties using the appSetting key.</p> <p>Lets create a Virtual Directory in our <code>&lt;appSettings&gt;</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>appSettings<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>add key<span class="token operator">=</span><span class="token string">&quot;virtualDirPath&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;/foo&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>appSettings<span class="token operator">&gt;</span>

</code></pre></div><p>Within our Node.js App we can access the <code>virtualDirPath</code> setting</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>virtualDirPath<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// prints /foo</span>

</code></pre></div><p>Now that we can use the <code>&lt;appSettings&gt;</code> element for configuration, lets take advantage of that and use it in our server code.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Access the virtualDirPath appSettings and give it a default value of '/'</span>
<span class="token comment">// in the event that it doesn't exist or isn't set</span>
<span class="token keyword">var</span> virtualDirPath <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>virtualDirPath <span class="token operator">||</span> <span class="token string">'/'</span><span class="token punctuation">;</span>

<span class="token comment">// We also want to make sure that our virtualDirPath </span>
<span class="token comment">// always starts with a forward slash</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>virtualDirPath<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  virtualDirPath <span class="token operator">=</span> <span class="token string">'/'</span> <span class="token operator">+</span> virtualDirPath<span class="token punctuation">;</span>

<span class="token comment">// Setup a route at the index of our app    </span>
server<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>virtualDirPath<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>We can use the virtualDirPath with our static resources as well</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Public Directory</span>
server<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>virtualDirPath<span class="token punctuation">,</span> <span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Bower</span>
server<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/bower_components'</span><span class="token punctuation">,</span> express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>virtualDirPath<span class="token punctuation">,</span> <span class="token string">'bower_components'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>Lets put all of that together</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> port <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">3000</span><span class="token punctuation">;</span>

<span class="token comment">// Access the virtualDirPath appSettings and give it a default value of '/'</span>
<span class="token comment">// in the event that it doesn't exist or isn't set</span>
<span class="token keyword">var</span> virtualDirPath <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>virtualDirPath <span class="token operator">||</span> <span class="token string">'/'</span><span class="token punctuation">;</span>

<span class="token comment">// We also want to make sure that our virtualDirPath </span>
<span class="token comment">// always starts with a forward slash</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>virtualDirPath<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  virtualDirPath <span class="token operator">=</span> <span class="token string">'/'</span> <span class="token operator">+</span> virtualDirPath<span class="token punctuation">;</span>

<span class="token comment">// Public Directory</span>
server<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>virtualDirPath<span class="token punctuation">,</span> <span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Bower</span>
server<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/bower_components'</span><span class="token punctuation">,</span> express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>virtualDirPath<span class="token punctuation">,</span> <span class="token string">'bower_components'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Setup a route at the index of our app    </span>
server<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>virtualDirPath<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Listening on </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="getting-started"><a href="#getting-started" class="header-anchor">#</a> Getting Started</h2> <p><a href="https://github.com/tjanczuk/iisnode" target="_blank" rel="noopener noreferrer">IISNode<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> allows Node.js Web Apps to be hosted on IIS 7/8 just like a .NET application would. Of course, you can self host your <code>node.exe</code> process on Windows but why do that when you can just run your app in IIS.</p> <p>IISNode will handle scaling over multiple cores, process manageement of <code>node.exe</code>, and auto-recycle your IIS Application whenever your app is updated, just to name a few of its <a href="https://tomasz.janczuk.org/2011/08/hosting-nodejs-applications-in-iis-on.html" target="_blank" rel="noopener noreferrer">benefits<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h3 id="requirements"><a href="#requirements" class="header-anchor">#</a> Requirements</h3> <p>IISNode does have a few requirements before you can host your Node.js app in IIS.</p> <ol><li>Node.js must be installed on the IIS host, 32-bit or 64-bit, either are supported.</li> <li>IISNode installed <a href="https://github.com/azure/iisnode/releases/download/v0.2.21/iisnode-full-v0.2.21-x86.msi" target="_blank" rel="noopener noreferrer">x86<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> or <a href="https://github.com/azure/iisnode/releases/download/v0.2.21/iisnode-full-v0.2.21-x64.msi" target="_blank" rel="noopener noreferrer">x64<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, this should match the bitness of your IIS Host.
</li><li>The <a href="http://www.iis.net/downloads/microsoft/url-rewrite" target="_blank" rel="noopener noreferrer">Microsoft URL-Rewrite Module for IIS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> installed on your IIS host.
<ul></ul></li> <li>This is key, otherwise requests to your Node.js app won't function as expected.
</li> <li>A <code>Web.config</code> in the root folder of your Node.js app.</li> <li>IISNode configuration via an <code>iisnode.yml</code> file or an <code>&lt;iisnode&gt;</code> element within your <code>Web.config</code>.</li></ol> <h2 id="basic-hello-world-example-using-express"><a href="#basic-hello-world-example-using-express" class="header-anchor">#</a> Basic Hello World Example using Express</h2> <p>To get this example working, you'll need to create an IIS 7/8 app on your IIS host and add the directory containing the Node.js Web App as the Physical Directory. Ensure that your Application/Application Pool Identity can access the Node.js install. This example uses the Node.js 64-bit installation.</p> <h3 id="project-strucure"><a href="#project-strucure" class="header-anchor">#</a> Project Strucure</h3> <p>This is the basic project structure of a IISNode/Node.js Web app. It looks almost identical to any non-IISNode Web App except for the addition of the <code>Web.config</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">-</span> <span class="token operator">/</span>app_root
  <span class="token operator">-</span> <span class="token keyword">package</span><span class="token punctuation">.</span>json
  <span class="token operator">-</span> server<span class="token punctuation">.</span>js
  <span class="token operator">-</span> Web<span class="token punctuation">.</span>config

</code></pre></div><h3 id="server-js-express-application"><a href="#server-js-express-application" class="header-anchor">#</a> server.js - Express Application</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// We need to get the port that IISNode passes into us </span>
<span class="token comment">// using the PORT environment variable, if it isn't set use a default value</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">3000</span><span class="token punctuation">;</span>

<span class="token comment">// Setup a route at the index of our app    </span>
server<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Listening on </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h3 id="configuration-web-config"><a href="#configuration-web-config" class="header-anchor">#</a> Configuration &amp; Web.config</h3> <p>The <code>Web.config</code> is just like any other IIS <code>Web.config</code> except the following two things must be present, URL <code>&lt;rewrite&gt;&lt;rules&gt;</code> and an IISNode <code>&lt;handler&gt;</code>. Both of these elements are children of the <code>&lt;system.webServer&gt;</code> element.</p> <h3 id="configuration"><a href="#configuration" class="header-anchor">#</a> Configuration</h3> <p>You can configure IISNode by using a <a href="https://raw.githubusercontent.com/tjanczuk/iisnode/master/src/samples/configuration/iisnode.yml" target="_blank" rel="noopener noreferrer"><code>iisnode.yml</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> file or by adding the <a href="https://github.com/tjanczuk/iisnode/blob/master/src/samples/configuration/web.config#L11" target="_blank" rel="noopener noreferrer"><code>&lt;iisnode&gt;</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> element as a child of <code>&lt;system.webServer&gt;</code> in your <code>Web.config</code>. Both of these configuration can be used in conjunction with one another however, in this case, <code>Web.config</code> will need to specify the <code>iisnode.yml</code> file <strong>AND</strong> <a href="https://github.com/tjanczuk/iisnode/blob/master/src/samples/configuration/web.config#L105-L111" target="_blank" rel="noopener noreferrer">any configuration conflicts will be take from the <code>iisnode.yml</code> file instead<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. This configuration overriding cannot happen the other way around.</p> <h3 id="iisnode-handler"><a href="#iisnode-handler" class="header-anchor">#</a> IISNode Handler</h3> <p>In order for IIS to know that <code>server.js</code> contains our Node.js Web App we need to explicitly tell it that. We can do this by adding the IISNode <code>&lt;handler&gt;</code> to the <code>&lt;handlers&gt;</code> element.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>handlers<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>add name<span class="token operator">=</span><span class="token string">&quot;iisnode&quot;</span> path<span class="token operator">=</span><span class="token string">&quot;server.js&quot;</span> verb<span class="token operator">=</span><span class="token string">&quot;*&quot;</span> modules<span class="token operator">=</span><span class="token string">&quot;iisnode&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>handlers<span class="token operator">&gt;</span>

</code></pre></div><h3 id="url-rewrite-rules"><a href="#url-rewrite-rules" class="header-anchor">#</a> URL-Rewrite Rules</h3> <p>The final part of the configuration is ensuring that traffic intended for our Node.js app coming into our IIS instance is being directed to IISNode. Without URL rewrite rules, we would need to visit our app by going to <code>http://&lt;host&gt;/server.js</code> and even worse, when trying to request a resource supplied by <code>server.js</code> you'll get a <code>404</code>. This is why URL rewriting is necessary for IISNode web apps.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>rewrite<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>rules<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> First we consider whether the incoming <span class="token constant">URL</span> matches a physical file <span class="token keyword">in</span> the <span class="token operator">/</span><span class="token keyword">public</span> folder <span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>rule name<span class="token operator">=</span><span class="token string">&quot;StaticContent&quot;</span> patternSyntax<span class="token operator">=</span><span class="token string">&quot;Wildcard&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>action type<span class="token operator">=</span><span class="token string">&quot;Rewrite&quot;</span> url<span class="token operator">=</span><span class="token string">&quot;public/{R:0}&quot;</span> logRewrittenUrl<span class="token operator">=</span><span class="token string">&quot;true&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>conditions<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>add input<span class="token operator">=</span><span class="token string">&quot;{REQUEST_FILENAME}&quot;</span> matchType<span class="token operator">=</span><span class="token string">&quot;IsFile&quot;</span> negate<span class="token operator">=</span><span class="token string">&quot;true&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>conditions<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>match url<span class="token operator">=</span><span class="token string">&quot;*.*&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>rule<span class="token operator">&gt;</span>

        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> All other URLs are mapped to the Node<span class="token punctuation">.</span>js application entry point <span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>rule name<span class="token operator">=</span><span class="token string">&quot;DynamicContent&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>conditions<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>add input<span class="token operator">=</span><span class="token string">&quot;{REQUEST_FILENAME}&quot;</span> matchType<span class="token operator">=</span><span class="token string">&quot;IsFile&quot;</span> negate<span class="token operator">=</span><span class="token string">&quot;True&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>conditions<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>action type<span class="token operator">=</span><span class="token string">&quot;Rewrite&quot;</span> url<span class="token operator">=</span><span class="token string">&quot;server.js&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>rule<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>rules<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>rewrite<span class="token operator">&gt;</span>

</code></pre></div><p><a href="https://gist.github.com/pbaio/f63918181d8d7f8ee1d2" target="_blank" rel="noopener noreferrer">This is a working <code>Web.config</code> file for this example<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, setup for a 64-bit Node.js install.</p> <p>That's it, now visit your IIS Site and see your Node.js application working.</p> <h2 id="using-socket-io-with-iisnode"><a href="#using-socket-io-with-iisnode" class="header-anchor">#</a> Using Socket.io with IISNode</h2> <p>To get Socket.io working with IISNode, the only changes necessary when not using a Virtual Directory/Nested Application are within the <code>Web.config</code>.</p> <p>Since Socket.io sends requests starting with <code>/socket.io</code>, IISNode needs to communicate to IIS that these should also be handled IISNode and aren't just static file requests or other traffic. This requires a different <code>&lt;handler&gt;</code> than standard IISNode apps.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>handlers<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>add name<span class="token operator">=</span><span class="token string">&quot;iisnode-socketio&quot;</span> path<span class="token operator">=</span><span class="token string">&quot;server.js&quot;</span> verb<span class="token operator">=</span><span class="token string">&quot;*&quot;</span> modules<span class="token operator">=</span><span class="token string">&quot;iisnode&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>handlers<span class="token operator">&gt;</span>

</code></pre></div><p>In addition to the changes to the <code>&lt;handlers&gt;</code> we also need to add an additional URL rewrite rule. The rewrite rule sends all <code>/socket.io</code> traffic to our server file where the Socket.io server is running.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>rule name<span class="token operator">=</span><span class="token string">&quot;SocketIO&quot;</span> patternSyntax<span class="token operator">=</span><span class="token string">&quot;ECMAScript&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>match url<span class="token operator">=</span><span class="token string">&quot;socket.io.+&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>action type<span class="token operator">=</span><span class="token string">&quot;Rewrite&quot;</span> url<span class="token operator">=</span><span class="token string">&quot;server.js&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>rule<span class="token operator">&gt;</span>

</code></pre></div><p>If you are using IIS 8, you'll need to disable your webSockets setting in your <code>Web.config</code> in addition to adding the above handler and rewrite rules. This is unnecessary in IIS 7 since there is no webSocket support.</p> <p><code>&lt;webSocket enabled=&quot;false&quot; /&gt;</code></p> <h4 id="remarks"><a href="#remarks" class="header-anchor">#</a> Remarks</h4> <h3 id="virtual-directory-nested-application-with-views-pitfall"><a href="#virtual-directory-nested-application-with-views-pitfall" class="header-anchor">#</a> Virtual Directory / Nested Application with Views Pitfall</h3> <p>If you're going to be using Express to render views using a View Engine, you'll need to pass the <code>virtualDirPath</code> value in to your views</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">res.render('index', { virtualDirPath: virtualDirPath });</span><span class="token template-punctuation string">`</span></span>

</code></pre></div><p>The reason for doing this is to make your hyperlinks to other views host by your app and static resource paths to know where the site is being hosted without needing to modify all views after deployment. This is one of the more annoying and tedious pitfalls of using Virtual Directories with IISNode.</p> <h3 id="versions"><a href="#versions" class="header-anchor">#</a> Versions</h3> <p>All of the examples above work with</p> <ul><li>Express v4.x</li> <li>IIS 7.x/8.x</li> <li>Socket.io v1.3.x or greater</li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/nodejs/using-iisnode-to-host-node-js-web-apps-in-iis.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/nodejs/graceful-shutdown.html" class="prev">
        Graceful Shutdown
      </a></span> <span class="next"><a href="/nodejs/cli.html">
        CLI
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/2268.56a23291.js" defer></script>
  </body>
</html>
