<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Node.js - Deploying Node.js applications in production</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Setting NODE_ENV=production, Manage app with process manager, Deployment using process manager, Deployment using PM2, Using different Properties/Configuration for different environments like dev, qa, staging etc., Taking advantage of clusters">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="Node.js - Deploying Node.js applications in production">
    <meta property="og:description" content="Setting NODE_ENV=production, Manage app with process manager, Deployment using process manager, Deployment using PM2, Using different Properties/Configuration for different environments like dev, qa, staging etc., Taking advantage of clusters">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/nodejs/deploying-node-js-applications-in-production.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="Node.js - Deploying Node.js applications in production">
    <meta name="twitter:description" content="Setting NODE_ENV=production, Manage app with process manager, Deployment using process manager, Deployment using PM2, Using different Properties/Configuration for different environments like dev, qa, staging etc., Taking advantage of clusters">
    <meta name="twitter:url" content="/nodejs/deploying-node-js-applications-in-production.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/2184.c6799eb4.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Node.js</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/nodejs/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/nodejs/installing-node-js.html" class="sidebar-link">Installing Node.js</a></li><li><a href="/nodejs/getting-started-with-node-js.html" class="sidebar-link">Getting started with Node.js</a></li><li><a href="/nodejs/npm.html" class="sidebar-link">npm</a></li><li><a href="/nodejs/web-apps-with-express.html" class="sidebar-link">Web Apps With Express</a></li><li><a href="/nodejs/filesystem-i-o.html" class="sidebar-link">Filesystem I/O</a></li><li><a href="/nodejs/exporting-and-consuming-modules.html" class="sidebar-link">Exporting and Consuming Modules</a></li><li><a href="/nodejs/exporting-and-importing-module-in-node-js.html" class="sidebar-link">Exporting and Importing Module in node.js</a></li><li><a href="/nodejs/how-modules-are-loaded.html" class="sidebar-link">How modules are loaded</a></li><li><a href="/nodejs/cluster-module.html" class="sidebar-link">Cluster Module</a></li><li><a href="/nodejs/readline.html" class="sidebar-link">Readline</a></li><li><a href="/nodejs/package-json.html" class="sidebar-link">package.json</a></li><li><a href="/nodejs/event-emitters.html" class="sidebar-link">Event Emitters</a></li><li><a href="/nodejs/autoreload-on-changes.html" class="sidebar-link">Autoreload on changes</a></li><li><a href="/nodejs/environment.html" class="sidebar-link">Environment</a></li><li><a href="/nodejs/callback-to-promise.html" class="sidebar-link">Callback to Promise</a></li><li><a href="/nodejs/executing-files-or-commands-with-child-processes.html" class="sidebar-link">Executing files or commands with Child Processes</a></li><li><a href="/nodejs/exception-handling.html" class="sidebar-link">Exception handling</a></li><li><a href="/nodejs/keep-a-node-application-constantly-running.html" class="sidebar-link">Keep a node application constantly running</a></li><li><a href="/nodejs/uninstalling-node-js.html" class="sidebar-link">Uninstalling Node.js</a></li><li><a href="/nodejs/nvm-node-version-manager.html" class="sidebar-link">nvm - Node Version Manager</a></li><li><a href="/nodejs/http.html" class="sidebar-link">http</a></li><li><a href="/nodejs/using-streams.html" class="sidebar-link">Using Streams</a></li><li><a href="/nodejs/deploying-node-js-applications-in-production.html" aria-current="page" class="active sidebar-link">Deploying Node.js applications in production</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/nodejs/deploying-node-js-applications-in-production.html#setting-node-env-production" class="sidebar-link">Setting NODE_ENV=&quot;production&quot;</a></li><li class="sidebar-sub-header"><a href="/nodejs/deploying-node-js-applications-in-production.html#manage-app-with-process-manager" class="sidebar-link">Manage app with process manager</a></li><li class="sidebar-sub-header"><a href="/nodejs/deploying-node-js-applications-in-production.html#deployment-using-process-manager" class="sidebar-link">Deployment using process manager</a></li><li class="sidebar-sub-header"><a href="/nodejs/deploying-node-js-applications-in-production.html#deployment-using-pm2" class="sidebar-link">Deployment using PM2</a></li><li class="sidebar-sub-header"><a href="/nodejs/deploying-node-js-applications-in-production.html#using-different-properties-configuration-for-different-environments-like-dev-qa-staging-etc" class="sidebar-link">Using different Properties/Configuration for different environments like dev, qa, staging etc.</a></li><li class="sidebar-sub-header"><a href="/nodejs/deploying-node-js-applications-in-production.html#taking-advantage-of-clusters" class="sidebar-link">Taking advantage of clusters</a></li></ul></li><li><a href="/nodejs/securing-node-js-applications.html" class="sidebar-link">Securing Node.js applications</a></li><li><a href="/nodejs/mongoose-library.html" class="sidebar-link">Mongoose Library</a></li><li><a href="/nodejs/async-js.html" class="sidebar-link">async.js</a></li><li><a href="/nodejs/file-upload.html" class="sidebar-link">File upload</a></li><li><a href="/nodejs/socket-io-communication.html" class="sidebar-link">Socket.io communication</a></li><li><a href="/nodejs/mongodb-integration.html" class="sidebar-link">Mongodb integration</a></li><li><a href="/nodejs/handling-post-request-in-node-js.html" class="sidebar-link">Handling POST request in Node.js</a></li><li><a href="/nodejs/simple-rest-based-crud-api.html" class="sidebar-link">Simple REST based CRUD API</a></li><li><a href="/nodejs/template-frameworks.html" class="sidebar-link">Template frameworks</a></li><li><a href="/nodejs/node-js-architecture-inner-workings.html" class="sidebar-link">Node.js Architecture &amp; Inner Workings</a></li><li><a href="/nodejs/debugging-node-js-application.html" class="sidebar-link">Debugging Node.js application</a></li><li><a href="/nodejs/node-server-without-framework.html" class="sidebar-link">Node server without framework</a></li><li><a href="/nodejs/node-js-with-es6.html" class="sidebar-link">Node.JS with ES6</a></li><li><a href="/nodejs/interacting-with-console.html" class="sidebar-link">Interacting with Console</a></li><li><a href="/nodejs/cassandra-integration.html" class="sidebar-link">Cassandra Integration</a></li><li><a href="/nodejs/creating-api-s-with-node-js.html" class="sidebar-link">Creating API's with Node.js</a></li><li><a href="/nodejs/graceful-shutdown.html" class="sidebar-link">Graceful Shutdown</a></li><li><a href="/nodejs/using-iisnode-to-host-node-js-web-apps-in-iis.html" class="sidebar-link">Using IISNode to host Node.js Web Apps in IIS</a></li><li><a href="/nodejs/cli.html" class="sidebar-link">CLI</a></li><li><a href="/nodejs/nodejs-frameworks.html" class="sidebar-link">NodeJS Frameworks</a></li><li><a href="/nodejs/grunt.html" class="sidebar-link">grunt</a></li><li><a href="/nodejs/using-websocket-s-with-node-js.html" class="sidebar-link">Using WebSocket's with Node.JS</a></li><li><a href="/nodejs/metalsmith.html" class="sidebar-link">metalsmith</a></li><li><a href="/nodejs/parsing-command-line-arguments.html" class="sidebar-link">Parsing command line arguments</a></li><li><a href="/nodejs/client-server-communication.html" class="sidebar-link">Client-server communication</a></li><li><a href="/nodejs/node-js-design-fundamental.html" class="sidebar-link">Node.js Design Fundamental</a></li><li><a href="/nodejs/connect-to-mongodb.html" class="sidebar-link">Connect to Mongodb</a></li><li><a href="/nodejs/performance-challenges.html" class="sidebar-link">Performance challenges</a></li><li><a href="/nodejs/send-web-notification.html" class="sidebar-link">Send Web Notification</a></li><li><a href="/nodejs/remote-debugging-in-node-js.html" class="sidebar-link">Remote Debugging in Node.JS</a></li><li><a href="/nodejs/database-mongodb-with-mongoose.html" class="sidebar-link">Database (MongoDB with Mongoose)</a></li><li><a href="/nodejs/good-coding-style.html" class="sidebar-link">Good coding style</a></li><li><a href="/nodejs/restful-api-design-best-practices.html" class="sidebar-link">Restful API Design: Best Practices</a></li><li><a href="/nodejs/deliver-html-or-any-other-sort-of-file.html" class="sidebar-link">Deliver HTML or any other sort of file</a></li><li><a href="/nodejs/tcp-sockets.html" class="sidebar-link">TCP Sockets</a></li><li><a href="/nodejs/hack.html" class="sidebar-link">Hack</a></li><li><a href="/nodejs/bluebird-promises.html" class="sidebar-link">Bluebird Promises</a></li><li><a href="/nodejs/async-await.html" class="sidebar-link">Async/Await</a></li><li><a href="/nodejs/koa-framework-v2.html" class="sidebar-link">Koa Framework v2</a></li><li><a href="/nodejs/unit-testing-frameworks.html" class="sidebar-link">Unit testing frameworks</a></li><li><a href="/nodejs/ecmascript-2015-es6-with-node-js.html" class="sidebar-link">ECMAScript 2015 (ES6) with Node.js</a></li><li><a href="/nodejs/routing-ajax-requests-with-express-js.html" class="sidebar-link">Routing ajax requests with Express.JS</a></li><li><a href="/nodejs/sending-a-file-stream-to-client.html" class="sidebar-link">Sending a file stream to client</a></li><li><a href="/nodejs/nodejs-with-redis.html" class="sidebar-link">NodeJS with Redis</a></li><li><a href="/nodejs/using-browserfiy-to-resolve-required-error-with-browsers.html" class="sidebar-link">Using Browserfiy to resolve 'required' error with browsers</a></li><li><a href="/nodejs/node-js-and-mongodb.html" class="sidebar-link">Node.JS and MongoDB.</a></li><li><a href="/nodejs/passport-integration.html" class="sidebar-link">Passport integration</a></li><li><a href="/nodejs/dependency-injection.html" class="sidebar-link">Dependency Injection</a></li><li><a href="/nodejs/nodejs-beginner-guide.html" class="sidebar-link">NodeJS Beginner Guide</a></li><li><a href="/nodejs/use-cases-of-node-js.html" class="sidebar-link">Use Cases of Node.js</a></li><li><a href="/nodejs/sequelize-js.html" class="sidebar-link">Sequelize.js</a></li><li><a href="/nodejs/postgresql-integration.html" class="sidebar-link">PostgreSQL integration</a></li><li><a href="/nodejs/mysql-integration.html" class="sidebar-link">MySQL integration</a></li><li><a href="/nodejs/mysql-connection-pool.html" class="sidebar-link">Mysql Connection Pool</a></li><li><a href="/nodejs/mssql-intergration.html" class="sidebar-link">MSSQL Intergration</a></li><li><a href="/nodejs/node-js-with-oracle.html" class="sidebar-link">Node.js with Oracle</a></li><li><a href="/nodejs/synchronous-vs-asynchronous-programming-in-nodejs.html" class="sidebar-link">Synchronous vs Asynchronous programming in nodejs</a></li><li><a href="/nodejs/node-js-error-management.html" class="sidebar-link">Node.js Error Management</a></li><li><a href="/nodejs/node-js-v6-new-features-and-improvement.html" class="sidebar-link">Node.js v6 New Features and Improvement</a></li><li><a href="/nodejs/eventloop.html" class="sidebar-link">Eventloop</a></li><li><a href="/nodejs/nodejs-history.html" class="sidebar-link">Nodejs History</a></li><li><a href="/nodejs/passport-js.html" class="sidebar-link">passport.js</a></li><li><a href="/nodejs/asynchronous-programming.html" class="sidebar-link">Asynchronous programming</a></li><li><a href="/nodejs/node-js-code-for-stdin-and-stdout-without-using-any-library.html" class="sidebar-link">Node.js code for STDIN and STDOUT without using  any library</a></li><li><a href="/nodejs/mongodb-integration-for-node-js-express-js.html" class="sidebar-link">MongoDB Integration for Node.js/Express.js</a></li><li><a href="/nodejs/lodash.html" class="sidebar-link">Lodash</a></li><li><a href="/nodejs/csv-parser-in-node-js.html" class="sidebar-link">csv parser in node js</a></li><li><a href="/nodejs/loopback-rest-based-connector.html" class="sidebar-link">Loopback - REST Based connector</a></li><li><a href="/nodejs/running-node-js-as-a-service.html" class="sidebar-link">Running node.js as a service</a></li><li><a href="/nodejs/node-js-with-cors.html" class="sidebar-link">Node.js with CORS</a></li><li><a href="/nodejs/getting-started-with-nodes-profiling.html" class="sidebar-link">Getting started with Nodes profiling</a></li><li><a href="/nodejs/node-js-performance.html" class="sidebar-link">Node.js Performance</a></li><li><a href="/nodejs/yarn-package-manager.html" class="sidebar-link">Yarn Package Manager</a></li><li><a href="/nodejs/oauth-2-0.html" class="sidebar-link">OAuth 2.0</a></li><li><a href="/nodejs/node-js-localization.html" class="sidebar-link">Node JS Localization</a></li><li><a href="/nodejs/deploying-node-js-application-without-downtime.html" class="sidebar-link">Deploying Node.js application without downtime.</a></li><li><a href="/nodejs/node-js-express-js-with-angular-js-sample-code.html" class="sidebar-link">Node.js (express.js) with angular.js Sample code</a></li><li><a href="/nodejs/nodejs-routing.html" class="sidebar-link">NodeJs Routing</a></li><li><a href="/nodejs/creating-a-node-js-library-that-supports-both-promises-and-error-first-callbacks.html" class="sidebar-link">Creating a Node.js Library that Supports Both Promises and Error-First Callbacks</a></li><li><a href="/nodejs/project-structure.html" class="sidebar-link">Project Structure</a></li><li><a href="/nodejs/avoid-callback-hell.html" class="sidebar-link">Avoid callback hell</a></li><li><a href="/nodejs/arduino-communication-with-nodejs.html" class="sidebar-link">Arduino communication with nodeJs</a></li><li><a href="/nodejs/n-api.html" class="sidebar-link">N-API</a></li><li><a href="/nodejs/multithreading.html" class="sidebar-link">Multithreading</a></li><li><a href="/nodejs/windows-authentication-under-node-js.html" class="sidebar-link">Windows authentication under node.js</a></li><li><a href="/nodejs/require.html" class="sidebar-link">Require()</a></li><li><a href="/nodejs/route-controller-service-structure-for-expressjs.html" class="sidebar-link">Route-Controller-Service structure for ExpressJS</a></li><li><a href="/nodejs/push-notifications.html" class="sidebar-link">Push notifications</a></li><li><a href="/nodejs/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="deploying-node-js-applications-in-production"><a href="#deploying-node-js-applications-in-production" class="header-anchor">#</a> Deploying Node.js applications in production</h1> <h2 id="setting-node-env-production"><a href="#setting-node-env-production" class="header-anchor">#</a> Setting NODE_ENV=&quot;production&quot;</h2> <p>Production deployments will vary in many ways, but a standard convention when deploying in production is to define an environment variable called <code>NODE_ENV</code> and set its value to <strong>&quot;production&quot;</strong>.</p> <h3 id="runtime-flags"><a href="#runtime-flags" class="header-anchor">#</a> Runtime flags</h3> <p>Any code running in your application (including external modules) can check the value of <code>NODE_ENV</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// We are running in production mode</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
   <span class="token comment">// We are running in development mode</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="dependencies"><a href="#dependencies" class="header-anchor">#</a> Dependencies</h3> <p>When the <code>NODE_ENV</code> environment variable is set to <strong>'production'</strong> all <code>devDependencies</code> in your <strong>package.json</strong> file will be completely ignored when running <code>npm install</code>. You can also enforce this with a <code>--production</code> flag:</p> <div class="language-js extra-class"><pre class="language-js"><code>npm install <span class="token operator">--</span>production

</code></pre></div><p>For setting <code>NODE_ENV</code> you can use any  of these methods</p> <p><strong>method 1: set NODE_ENV for all node apps</strong></p> <p>Windows :</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">set</span> <span class="token constant">NODE_ENV</span><span class="token operator">=</span>production

</code></pre></div><p>Linux or other unix based system :</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token constant">NODE_ENV</span><span class="token operator">=</span>production

</code></pre></div><p>This sets <code>NODE_ENV</code> for current bash session thus any apps started after this statement will have <code>NODE_ENV</code> set to <code>production</code>.</p> <p><strong>method 2: set NODE_ENV for current app</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token constant">NODE_ENV</span><span class="token operator">=</span>production node app<span class="token punctuation">.</span>js

</code></pre></div><p>This will set <code>NODE_ENV</code> for the current app only. This helps when we want to test our apps on different environments.</p> <p><strong>method 3: create <code>.env</code> file and use it</strong></p> <p>This uses the idea explained <a href="http://stackoverflow.com/a/28821696/620039" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Refer this post for more detailed explanation.</p> <p>Basically you create <code>.env</code> file and run some bash script to set them on environment.</p> <p>To avoid writing a bash script, the <a href="https://www.npmjs.com/package/env-cmd" target="_blank" rel="noopener noreferrer">env-cmd<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> package can be used to load the environment variables defined in the <code>.env</code> file.</p> <div class="language-js extra-class"><pre class="language-js"><code>env<span class="token operator">-</span>cmd <span class="token punctuation">.</span>env node app<span class="token punctuation">.</span>js

</code></pre></div><p><strong>method 4: Use <code>cross-env</code> package</strong></p> <p>This <a href="https://www.npmjs.com/package/cross-env" target="_blank" rel="noopener noreferrer">package<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> allows environment variables to be set in one way for every platform.</p> <p>After installing it with npm, you can just add it to your deployment script in <code>package.json</code> as follows:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;build:deploy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=production webpack&quot;</span>

</code></pre></div><h2 id="manage-app-with-process-manager"><a href="#manage-app-with-process-manager" class="header-anchor">#</a> Manage app with process manager</h2> <p>It's a good practice to run NodeJS apps controlled by process managers.
Process manager helps to keep application alive forever, restart on failure, reload without downtime and simplifies administrating. Most powerful of them (like <a href="http://pm2.keymetrics.io/" target="_blank" rel="noopener noreferrer">PM2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>) have a built-in load balancer. PM2 also enables you to manage application logging, monitoring, and clustering.</p> <h3 id="pm2-process-manager"><a href="#pm2-process-manager" class="header-anchor">#</a> PM2 process manager</h3> <p>Installing PM2:</p> <p><code>npm install pm2 -g</code></p> <p>Process can be started in cluster mode involving integrated load balancer to spread load between processes:</p> <p><code>pm2 start app.js -i 0 --name &quot;api&quot;</code> (<strong>-i</strong> is to specify number of processes to spawn. If it is 0, then process number will be based on CPU cores count)</p> <p>While having multiple users in production, its must to have a single point for PM2. Therefore pm2 command must be prefixed with a location (for PM2 config) else it will spawn a new pm2 process for every user with config in respective home directory. And it will be inconsistent.</p> <p>Usage:
<code>PM2_HOME=/etc/.pm2 pm2 start app.js</code></p> <h2 id="deployment-using-process-manager"><a href="#deployment-using-process-manager" class="header-anchor">#</a> Deployment using process manager</h2> <p>Process manager is generally used in production to deploy a nodejs app. The main functions of a process manager are restarting the server if it crashes, checking resource consumption, improving runtime performance, monitoring etc.</p> <p>Some of the popular process managers made by the node community are forever, pm2, etc.</p> <h3 id="forvever"><a href="#forvever" class="header-anchor">#</a> <strong>Forvever</strong></h3> <p><a href="https://github.com/foreverjs/forever" target="_blank" rel="noopener noreferrer"><code>forever</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> is a command-line interface tool for ensuring that a given script runs continuously. <code>forever</code>’s simple interface makes it ideal for running smaller deployments of <code>Node.js</code> apps and scripts.</p> <p><code>forever</code> monitors your process and restarts it if it crashes.</p> <p>Install <code>forever</code> globally.</p> <div class="language-js extra-class"><pre class="language-js"><code>$ npm install <span class="token operator">-</span>g forever

</code></pre></div><p>Run application :</p> <div class="language-js extra-class"><pre class="language-js"><code>$ forever start server<span class="token punctuation">.</span>js

</code></pre></div><p>This starts the server and gives an id for the process(starts from 0).</p> <p>Restart application :</p> <div class="language-js extra-class"><pre class="language-js"><code>$ forever restart <span class="token number">0</span>

</code></pre></div><p>Here <code>0</code> is the id of the server.</p> <p>Stop application :</p> <div class="language-js extra-class"><pre class="language-js"><code>$ forever stop <span class="token number">0</span>

</code></pre></div><p>Similar to restart, <code>0</code> is the id the server. You can also give process id or script name in place of the id  given by the forever.</p> <p>For more commands : <a href="https://www.npmjs.com/package/forever" target="_blank" rel="noopener noreferrer">https://www.npmjs.com/package/forever<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="deployment-using-pm2"><a href="#deployment-using-pm2" class="header-anchor">#</a> Deployment using PM2</h2> <p><code>PM2</code> is a production process manager for <code>Node.js</code> applications, that allows you to keep applications alive forever and reload them without downtime. PM2 also enables you to manage application logging, monitoring, and clustering.</p> <p>Install <code>pm2</code> globally.</p> <div class="language-js extra-class"><pre class="language-js"><code>npm install <span class="token operator">-</span>g pm2

</code></pre></div><p>Then, run the <code>node.js</code> app using <code>PM2.</code></p> <div class="language-js extra-class"><pre class="language-js"><code>pm2 start server<span class="token punctuation">.</span>js <span class="token operator">--</span>name <span class="token string">&quot;my-app&quot;</span>

</code></pre></div><p><a href="http://i.stack.imgur.com/9L2zo.png" target="_blank" rel="noopener noreferrer"><img src="http://i.stack.imgur.com/9L2zo.png" alt="enter image description here"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>Following commands are useful while working with <code>PM2</code>.</strong></p> <p>List all running processes:</p> <div class="language-js extra-class"><pre class="language-js"><code>pm2 list

</code></pre></div><p>Stop an app:</p> <div class="language-js extra-class"><pre class="language-js"><code>pm2 stop my<span class="token operator">-</span>app

</code></pre></div><p>Restart an app:</p> <div class="language-js extra-class"><pre class="language-js"><code>pm2 restart my<span class="token operator">-</span>app

</code></pre></div><p>To view detailed information about an app:</p> <div class="language-js extra-class"><pre class="language-js"><code>pm2 show my<span class="token operator">-</span>app

</code></pre></div><p>To remove an app from PM2’s registry:</p> <div class="language-js extra-class"><pre class="language-js"><code>pm2 <span class="token keyword">delete</span> my<span class="token operator">-</span>app

</code></pre></div><h2 id="using-different-properties-configuration-for-different-environments-like-dev-qa-staging-etc"><a href="#using-different-properties-configuration-for-different-environments-like-dev-qa-staging-etc" class="header-anchor">#</a> Using different Properties/Configuration for different environments like dev, qa, staging etc.</h2> <p>Large scale applications often need different properties when running on different environments. we can achieve this by passing arguments to NodeJs application and using same argument in node process to load specific environment property file.</p> <p>Suppose we have two property files for different environment.</p> <li>
dev.json
<div class="language-js extra-class"><pre class="language-js"><code>  <span class="token punctuation">{</span>
      <span class="token string">&quot;PORT&quot;</span><span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
      <span class="token string">&quot;DB&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;host&quot;</span><span class="token operator">:</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;user&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bob&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;password&quot;</span><span class="token operator">:</span> <span class="token string">&quot;12345&quot;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

</code></pre></div></li> <li>
qa.json
<div class="language-js extra-class"><pre class="language-js"><code>  <span class="token punctuation">{</span>
      <span class="token string">&quot;PORT&quot;</span><span class="token operator">:</span> <span class="token number">3001</span><span class="token punctuation">,</span>
      <span class="token string">&quot;DB&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;host&quot;</span><span class="token operator">:</span> <span class="token string">&quot;where_db_is_hosted&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;user&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bob&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;password&quot;</span><span class="token operator">:</span> <span class="token string">&quot;54321&quot;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

</code></pre></div></li> <p>Following code in application will export respective property file which we want to use.</p> <div class="language-js extra-class"><pre class="language-js"><code>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> arg <span class="token operator">=</span> val<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;=&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>arg<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>arg<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'env'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> env <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./'</span> <span class="token operator">+</span> arg<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'.json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            exports<span class="token punctuation">.</span>prop <span class="token operator">=</span> env<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>We give arguments to the application like following</p> <div class="language-js extra-class"><pre class="language-js"><code>node app<span class="token punctuation">.</span>js env<span class="token operator">=</span>dev

</code></pre></div><p>if we are using process manager like <strong>forever</strong> than it as simple as</p> <div class="language-js extra-class"><pre class="language-js"><code>forever start app<span class="token punctuation">.</span>js env<span class="token operator">=</span>dev

</code></pre></div><h2 id="taking-advantage-of-clusters"><a href="#taking-advantage-of-clusters" class="header-anchor">#</a> Taking advantage of clusters</h2> <p>A single instance of Node.js runs in a single thread. To take advantage of multi-core systems the user will sometimes want to launch a cluster of Node.js processes to handle the load.</p> <div class="language- extra-class"><pre class="language-text"><code>
var cluster = require('cluster');
    
    var numCPUs = require('os').cpus().length;
    
        if (cluster.isMaster) {
          // In real life, you'd probably use more than just 2 workers,
          // and perhaps not put the master and worker in the same file.
          //
          // You can also of course get a bit fancier about logging, and
          // implement whatever custom logic you need to prevent DoS
          // attacks and other bad behavior.
          //
          // See the options in the cluster documentation.
          //
          // The important thing is that the master does very little,
          // increasing our resilience to unexpected errors.
            console.log('your server is working on ' + numCPUs + ' cores');
            
             for (var i = 0; i &lt; numCPUs; i++) {
                    cluster.fork();
                  }
             
          cluster.on('disconnect', function(worker) {
            console.error('disconnect!');
            //clearTimeout(timeout);
            cluster.fork();
          });
    
          
        } else {
            require('./app.js');
        
        }

</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/nodejs/deploying-node-js-applications-in-production.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/nodejs/using-streams.html" class="prev">
        Using Streams
      </a></span> <span class="next"><a href="/nodejs/securing-node-js-applications.html">
        Securing Node.js applications
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/2184.c6799eb4.js" defer></script>
  </body>
</html>
