<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Node.js - Eventloop</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="How the concept of event loop evolved.">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="Node.js - Eventloop">
    <meta property="og:description" content="How the concept of event loop evolved.">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/nodejs/eventloop.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="Node.js - Eventloop">
    <meta name="twitter:description" content="How the concept of event loop evolved.">
    <meta name="twitter:url" content="/nodejs/eventloop.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/2188.ea0b18f6.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Node.js</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/nodejs/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/nodejs/installing-node-js.html" class="sidebar-link">Installing Node.js</a></li><li><a href="/nodejs/getting-started-with-node-js.html" class="sidebar-link">Getting started with Node.js</a></li><li><a href="/nodejs/npm.html" class="sidebar-link">npm</a></li><li><a href="/nodejs/web-apps-with-express.html" class="sidebar-link">Web Apps With Express</a></li><li><a href="/nodejs/filesystem-i-o.html" class="sidebar-link">Filesystem I/O</a></li><li><a href="/nodejs/exporting-and-consuming-modules.html" class="sidebar-link">Exporting and Consuming Modules</a></li><li><a href="/nodejs/exporting-and-importing-module-in-node-js.html" class="sidebar-link">Exporting and Importing Module in node.js</a></li><li><a href="/nodejs/how-modules-are-loaded.html" class="sidebar-link">How modules are loaded</a></li><li><a href="/nodejs/cluster-module.html" class="sidebar-link">Cluster Module</a></li><li><a href="/nodejs/readline.html" class="sidebar-link">Readline</a></li><li><a href="/nodejs/package-json.html" class="sidebar-link">package.json</a></li><li><a href="/nodejs/event-emitters.html" class="sidebar-link">Event Emitters</a></li><li><a href="/nodejs/autoreload-on-changes.html" class="sidebar-link">Autoreload on changes</a></li><li><a href="/nodejs/environment.html" class="sidebar-link">Environment</a></li><li><a href="/nodejs/callback-to-promise.html" class="sidebar-link">Callback to Promise</a></li><li><a href="/nodejs/executing-files-or-commands-with-child-processes.html" class="sidebar-link">Executing files or commands with Child Processes</a></li><li><a href="/nodejs/exception-handling.html" class="sidebar-link">Exception handling</a></li><li><a href="/nodejs/keep-a-node-application-constantly-running.html" class="sidebar-link">Keep a node application constantly running</a></li><li><a href="/nodejs/uninstalling-node-js.html" class="sidebar-link">Uninstalling Node.js</a></li><li><a href="/nodejs/nvm-node-version-manager.html" class="sidebar-link">nvm - Node Version Manager</a></li><li><a href="/nodejs/http.html" class="sidebar-link">http</a></li><li><a href="/nodejs/using-streams.html" class="sidebar-link">Using Streams</a></li><li><a href="/nodejs/deploying-node-js-applications-in-production.html" class="sidebar-link">Deploying Node.js applications in production</a></li><li><a href="/nodejs/securing-node-js-applications.html" class="sidebar-link">Securing Node.js applications</a></li><li><a href="/nodejs/mongoose-library.html" class="sidebar-link">Mongoose Library</a></li><li><a href="/nodejs/async-js.html" class="sidebar-link">async.js</a></li><li><a href="/nodejs/file-upload.html" class="sidebar-link">File upload</a></li><li><a href="/nodejs/socket-io-communication.html" class="sidebar-link">Socket.io communication</a></li><li><a href="/nodejs/mongodb-integration.html" class="sidebar-link">Mongodb integration</a></li><li><a href="/nodejs/handling-post-request-in-node-js.html" class="sidebar-link">Handling POST request in Node.js</a></li><li><a href="/nodejs/simple-rest-based-crud-api.html" class="sidebar-link">Simple REST based CRUD API</a></li><li><a href="/nodejs/template-frameworks.html" class="sidebar-link">Template frameworks</a></li><li><a href="/nodejs/node-js-architecture-inner-workings.html" class="sidebar-link">Node.js Architecture &amp; Inner Workings</a></li><li><a href="/nodejs/debugging-node-js-application.html" class="sidebar-link">Debugging Node.js application</a></li><li><a href="/nodejs/node-server-without-framework.html" class="sidebar-link">Node server without framework</a></li><li><a href="/nodejs/node-js-with-es6.html" class="sidebar-link">Node.JS with ES6</a></li><li><a href="/nodejs/interacting-with-console.html" class="sidebar-link">Interacting with Console</a></li><li><a href="/nodejs/cassandra-integration.html" class="sidebar-link">Cassandra Integration</a></li><li><a href="/nodejs/creating-api-s-with-node-js.html" class="sidebar-link">Creating API's with Node.js</a></li><li><a href="/nodejs/graceful-shutdown.html" class="sidebar-link">Graceful Shutdown</a></li><li><a href="/nodejs/using-iisnode-to-host-node-js-web-apps-in-iis.html" class="sidebar-link">Using IISNode to host Node.js Web Apps in IIS</a></li><li><a href="/nodejs/cli.html" class="sidebar-link">CLI</a></li><li><a href="/nodejs/nodejs-frameworks.html" class="sidebar-link">NodeJS Frameworks</a></li><li><a href="/nodejs/grunt.html" class="sidebar-link">grunt</a></li><li><a href="/nodejs/using-websocket-s-with-node-js.html" class="sidebar-link">Using WebSocket's with Node.JS</a></li><li><a href="/nodejs/metalsmith.html" class="sidebar-link">metalsmith</a></li><li><a href="/nodejs/parsing-command-line-arguments.html" class="sidebar-link">Parsing command line arguments</a></li><li><a href="/nodejs/client-server-communication.html" class="sidebar-link">Client-server communication</a></li><li><a href="/nodejs/node-js-design-fundamental.html" class="sidebar-link">Node.js Design Fundamental</a></li><li><a href="/nodejs/connect-to-mongodb.html" class="sidebar-link">Connect to Mongodb</a></li><li><a href="/nodejs/performance-challenges.html" class="sidebar-link">Performance challenges</a></li><li><a href="/nodejs/send-web-notification.html" class="sidebar-link">Send Web Notification</a></li><li><a href="/nodejs/remote-debugging-in-node-js.html" class="sidebar-link">Remote Debugging in Node.JS</a></li><li><a href="/nodejs/database-mongodb-with-mongoose.html" class="sidebar-link">Database (MongoDB with Mongoose)</a></li><li><a href="/nodejs/good-coding-style.html" class="sidebar-link">Good coding style</a></li><li><a href="/nodejs/restful-api-design-best-practices.html" class="sidebar-link">Restful API Design: Best Practices</a></li><li><a href="/nodejs/deliver-html-or-any-other-sort-of-file.html" class="sidebar-link">Deliver HTML or any other sort of file</a></li><li><a href="/nodejs/tcp-sockets.html" class="sidebar-link">TCP Sockets</a></li><li><a href="/nodejs/hack.html" class="sidebar-link">Hack</a></li><li><a href="/nodejs/bluebird-promises.html" class="sidebar-link">Bluebird Promises</a></li><li><a href="/nodejs/async-await.html" class="sidebar-link">Async/Await</a></li><li><a href="/nodejs/koa-framework-v2.html" class="sidebar-link">Koa Framework v2</a></li><li><a href="/nodejs/unit-testing-frameworks.html" class="sidebar-link">Unit testing frameworks</a></li><li><a href="/nodejs/ecmascript-2015-es6-with-node-js.html" class="sidebar-link">ECMAScript 2015 (ES6) with Node.js</a></li><li><a href="/nodejs/routing-ajax-requests-with-express-js.html" class="sidebar-link">Routing ajax requests with Express.JS</a></li><li><a href="/nodejs/sending-a-file-stream-to-client.html" class="sidebar-link">Sending a file stream to client</a></li><li><a href="/nodejs/nodejs-with-redis.html" class="sidebar-link">NodeJS with Redis</a></li><li><a href="/nodejs/using-browserfiy-to-resolve-required-error-with-browsers.html" class="sidebar-link">Using Browserfiy to resolve 'required' error with browsers</a></li><li><a href="/nodejs/node-js-and-mongodb.html" class="sidebar-link">Node.JS and MongoDB.</a></li><li><a href="/nodejs/passport-integration.html" class="sidebar-link">Passport integration</a></li><li><a href="/nodejs/dependency-injection.html" class="sidebar-link">Dependency Injection</a></li><li><a href="/nodejs/nodejs-beginner-guide.html" class="sidebar-link">NodeJS Beginner Guide</a></li><li><a href="/nodejs/use-cases-of-node-js.html" class="sidebar-link">Use Cases of Node.js</a></li><li><a href="/nodejs/sequelize-js.html" class="sidebar-link">Sequelize.js</a></li><li><a href="/nodejs/postgresql-integration.html" class="sidebar-link">PostgreSQL integration</a></li><li><a href="/nodejs/mysql-integration.html" class="sidebar-link">MySQL integration</a></li><li><a href="/nodejs/mysql-connection-pool.html" class="sidebar-link">Mysql Connection Pool</a></li><li><a href="/nodejs/mssql-intergration.html" class="sidebar-link">MSSQL Intergration</a></li><li><a href="/nodejs/node-js-with-oracle.html" class="sidebar-link">Node.js with Oracle</a></li><li><a href="/nodejs/synchronous-vs-asynchronous-programming-in-nodejs.html" class="sidebar-link">Synchronous vs Asynchronous programming in nodejs</a></li><li><a href="/nodejs/node-js-error-management.html" class="sidebar-link">Node.js Error Management</a></li><li><a href="/nodejs/node-js-v6-new-features-and-improvement.html" class="sidebar-link">Node.js v6 New Features and Improvement</a></li><li><a href="/nodejs/eventloop.html" aria-current="page" class="active sidebar-link">Eventloop</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/nodejs/eventloop.html#how-the-concept-of-event-loop-evolved" class="sidebar-link">How the concept of event loop evolved.</a></li></ul></li><li><a href="/nodejs/nodejs-history.html" class="sidebar-link">Nodejs History</a></li><li><a href="/nodejs/passport-js.html" class="sidebar-link">passport.js</a></li><li><a href="/nodejs/asynchronous-programming.html" class="sidebar-link">Asynchronous programming</a></li><li><a href="/nodejs/node-js-code-for-stdin-and-stdout-without-using-any-library.html" class="sidebar-link">Node.js code for STDIN and STDOUT without using  any library</a></li><li><a href="/nodejs/mongodb-integration-for-node-js-express-js.html" class="sidebar-link">MongoDB Integration for Node.js/Express.js</a></li><li><a href="/nodejs/lodash.html" class="sidebar-link">Lodash</a></li><li><a href="/nodejs/csv-parser-in-node-js.html" class="sidebar-link">csv parser in node js</a></li><li><a href="/nodejs/loopback-rest-based-connector.html" class="sidebar-link">Loopback - REST Based connector</a></li><li><a href="/nodejs/running-node-js-as-a-service.html" class="sidebar-link">Running node.js as a service</a></li><li><a href="/nodejs/node-js-with-cors.html" class="sidebar-link">Node.js with CORS</a></li><li><a href="/nodejs/getting-started-with-nodes-profiling.html" class="sidebar-link">Getting started with Nodes profiling</a></li><li><a href="/nodejs/node-js-performance.html" class="sidebar-link">Node.js Performance</a></li><li><a href="/nodejs/yarn-package-manager.html" class="sidebar-link">Yarn Package Manager</a></li><li><a href="/nodejs/oauth-2-0.html" class="sidebar-link">OAuth 2.0</a></li><li><a href="/nodejs/node-js-localization.html" class="sidebar-link">Node JS Localization</a></li><li><a href="/nodejs/deploying-node-js-application-without-downtime.html" class="sidebar-link">Deploying Node.js application without downtime.</a></li><li><a href="/nodejs/node-js-express-js-with-angular-js-sample-code.html" class="sidebar-link">Node.js (express.js) with angular.js Sample code</a></li><li><a href="/nodejs/nodejs-routing.html" class="sidebar-link">NodeJs Routing</a></li><li><a href="/nodejs/creating-a-node-js-library-that-supports-both-promises-and-error-first-callbacks.html" class="sidebar-link">Creating a Node.js Library that Supports Both Promises and Error-First Callbacks</a></li><li><a href="/nodejs/project-structure.html" class="sidebar-link">Project Structure</a></li><li><a href="/nodejs/avoid-callback-hell.html" class="sidebar-link">Avoid callback hell</a></li><li><a href="/nodejs/arduino-communication-with-nodejs.html" class="sidebar-link">Arduino communication with nodeJs</a></li><li><a href="/nodejs/n-api.html" class="sidebar-link">N-API</a></li><li><a href="/nodejs/multithreading.html" class="sidebar-link">Multithreading</a></li><li><a href="/nodejs/windows-authentication-under-node-js.html" class="sidebar-link">Windows authentication under node.js</a></li><li><a href="/nodejs/require.html" class="sidebar-link">Require()</a></li><li><a href="/nodejs/route-controller-service-structure-for-expressjs.html" class="sidebar-link">Route-Controller-Service structure for ExpressJS</a></li><li><a href="/nodejs/push-notifications.html" class="sidebar-link">Push notifications</a></li><li><a href="/nodejs/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="eventloop"><a href="#eventloop" class="header-anchor">#</a> Eventloop</h1> <p>In this post we are going to discuss how the concept of Eventloop emerged and how it can be used for high performance servers and event driven applications like GUIs.</p> <h2 id="how-the-concept-of-event-loop-evolved"><a href="#how-the-concept-of-event-loop-evolved" class="header-anchor">#</a> How the concept of event loop evolved.</h2> <h3 id="eventloop-in-pseudo-code"><a href="#eventloop-in-pseudo-code" class="header-anchor">#</a> Eventloop in pseudo code</h3> <p>An event loop is a loop that waits for events and then reacts to those events</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">while</span> <span class="token boolean">true</span><span class="token operator">:</span>
    wait <span class="token keyword">for</span> something to happen
    react to whatever happened

</code></pre></div><h3 id="example-of-a-single-threaded-http-server-with-no-event-loop"><a href="#example-of-a-single-threaded-http-server-with-no-event-loop" class="header-anchor">#</a> Example of a single-threaded HTTP server with no event loop</h3> <div class="language- extra-class"><pre class="language-text"><code>
   while true:
    socket = wait for the next TCP connection
    read the HTTP request headers from (socket)
    file_contents = fetch the requested file from disk
    write the HTTP response headers to (socket)
    write the (file_contents) to (socket)
    close(socket)

</code></pre></div><p>Here's a simple form of a HTTP server which is a single threaded but no event loop. The problem here is that it waits until each request is finished before starting to process the next one. If it takes a while to read the HTTP request headers or to fetch the file from disk, we should be able to start processing the next request while we wait for that to finish.</p> <p>The most common solution is to make the program multi-threaded.</p> <h3 id="example-of-a-multi-threaded-http-server-with-no-event-loop"><a href="#example-of-a-multi-threaded-http-server-with-no-event-loop" class="header-anchor">#</a> Example of a multi-threaded HTTP server with no event loop</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">handle_connection</span><span class="token punctuation">(</span><span class="token parameter">socket</span><span class="token punctuation">)</span><span class="token operator">:</span>
    read the <span class="token constant">HTTP</span> request headers <span class="token function">from</span> <span class="token punctuation">(</span>socket<span class="token punctuation">)</span>
    file_contents <span class="token operator">=</span> fetch the requested file from disk
    write the <span class="token constant">HTTP</span> response headers <span class="token function">to</span> <span class="token punctuation">(</span>socket<span class="token punctuation">)</span>
    write <span class="token function">the</span> <span class="token punctuation">(</span>file_contents<span class="token punctuation">)</span> <span class="token function">to</span> <span class="token punctuation">(</span>socket<span class="token punctuation">)</span>
    <span class="token function">close</span><span class="token punctuation">(</span>socket<span class="token punctuation">)</span>
<span class="token keyword">while</span> <span class="token boolean">true</span><span class="token operator">:</span>
    socket <span class="token operator">=</span> wait <span class="token keyword">for</span> the next <span class="token constant">TCP</span> connection
    spawn a <span class="token keyword">new</span> <span class="token class-name">thread</span> doing <span class="token function">handle_connection</span><span class="token punctuation">(</span>socket<span class="token punctuation">)</span>

</code></pre></div><p>Now we have made our little HTTP server multi threaded. This way, we can immediately move on to the next request because the current request is running in a background thread. Many servers, including Apache, use this approach.</p> <p>But it's not perfect. One limitation is that you can only spawn so many threads. For workloads where you have a huge number of connections, but each connection only requires attention every once in a while, the multi-threaded model won't perform very well. The solution for those cases is to use an event loop:</p> <h3 id="example-of-a-http-server-with-event-loop"><a href="#example-of-a-http-server-with-event-loop" class="header-anchor">#</a> Example of a HTTP server with event loop</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">while</span> <span class="token boolean">true</span><span class="token operator">:</span>
    event <span class="token operator">=</span> wait <span class="token keyword">for</span> the next event to happen
    <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token constant">NEW_TCP_CONNECTION</span><span class="token punctuation">)</span><span class="token operator">:</span>
        conn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Connection</span>
        conn<span class="token punctuation">.</span>socket <span class="token operator">=</span> event<span class="token punctuation">.</span>socket
        start reading <span class="token constant">HTTP</span> request headers <span class="token function">from</span> <span class="token punctuation">(</span>conn<span class="token punctuation">.</span>socket<span class="token punctuation">)</span> <span class="token keyword">with</span> userdata <span class="token operator">=</span> <span class="token punctuation">(</span>conn<span class="token punctuation">)</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token constant">FINISHED_READING_FROM_SOCKET</span><span class="token punctuation">)</span><span class="token operator">:</span>
        conn <span class="token operator">=</span> event<span class="token punctuation">.</span>userdata
        start fetching the requested file from disk <span class="token keyword">with</span> userdata <span class="token operator">=</span> <span class="token punctuation">(</span>conn<span class="token punctuation">)</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token constant">FINISHED_READING_FROM_DISK</span><span class="token punctuation">)</span><span class="token operator">:</span>
        conn <span class="token operator">=</span> event<span class="token punctuation">.</span>userdata
        conn<span class="token punctuation">.</span>file_contents <span class="token operator">=</span> the data we fetched from disk
        conn<span class="token punctuation">.</span>current_state <span class="token operator">=</span> <span class="token string">&quot;writing headers&quot;</span>
        start writing the <span class="token constant">HTTP</span> response headers <span class="token function">to</span> <span class="token punctuation">(</span>conn<span class="token punctuation">.</span>socket<span class="token punctuation">)</span> <span class="token keyword">with</span> userdata <span class="token operator">=</span> <span class="token punctuation">(</span>conn<span class="token punctuation">)</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token constant">FINISHED_WRITING_TO_SOCKET</span><span class="token punctuation">)</span><span class="token operator">:</span>
        conn <span class="token operator">=</span> event<span class="token punctuation">.</span>userdata
        <span class="token keyword">if</span> <span class="token punctuation">(</span>conn<span class="token punctuation">.</span>current_state <span class="token operator">==</span> <span class="token string">&quot;writing headers&quot;</span><span class="token punctuation">)</span><span class="token operator">:</span>
            conn<span class="token punctuation">.</span>current_state <span class="token operator">=</span> <span class="token string">&quot;writing file contents&quot;</span>
            start <span class="token function">writing</span> <span class="token punctuation">(</span>conn<span class="token punctuation">.</span>file_contents<span class="token punctuation">)</span> <span class="token function">to</span> <span class="token punctuation">(</span>conn<span class="token punctuation">.</span>socket<span class="token punctuation">)</span> <span class="token keyword">with</span> userdata <span class="token operator">=</span> <span class="token punctuation">(</span>conn<span class="token punctuation">)</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>conn<span class="token punctuation">.</span>current_state <span class="token operator">==</span> <span class="token string">&quot;writing file contents&quot;</span><span class="token punctuation">)</span><span class="token operator">:</span>
            <span class="token function">close</span><span class="token punctuation">(</span>conn<span class="token punctuation">.</span>socket<span class="token punctuation">)</span>

</code></pre></div><p>Hopefully this pseudocode is intelligible. Here's what's going on: We wait for things to happen. Whenever a new connection is created or an existing connection needs our attention, we go deal with it, then go back to waiting. That way, we perform well when there are many connections and each one only rarely requires attention.</p> <p>In a real application (not pseudocode) running on Linux, the &quot;wait for the next event to happen&quot; part would be implemented by calling the poll() or epoll() system call. The &quot;start reading/writing something to a socket&quot; parts would be implemented by calling the recv() or send() system calls in non-blocking mode.</p> <p><strong>Reference:</strong></p> <p>[1]. &quot;How does an event loop work?&quot; [Online]. Available : <a href="https://www.quora.com/How-does-an-event-loop-work" target="_blank" rel="noopener noreferrer">https://www.quora.com/How-does-an-event-loop-work<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/nodejs/eventloop.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/nodejs/node-js-v6-new-features-and-improvement.html" class="prev">
        Node.js v6 New Features and Improvement
      </a></span> <span class="next"><a href="/nodejs/nodejs-history.html">
        Nodejs History
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/2188.ea0b18f6.js" defer></script>
  </body>
</html>
