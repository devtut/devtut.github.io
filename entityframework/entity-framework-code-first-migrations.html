<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Entity Framework - Entity-framework Code First Migrations</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Enable Migrations, Add your first migration, Seeding Data during migrations, Doing Update-Database within your code, Using Sql() during migrations, Initial Entity Framework Code First Migration Step by Step">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="Entity Framework - Entity-framework Code First Migrations">
    <meta property="og:description" content="Enable Migrations, Add your first migration, Seeding Data during migrations, Doing Update-Database within your code, Using Sql() during migrations, Initial Entity Framework Code First Migration Step by Step">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/entityframework/entity-framework-code-first-migrations.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="Entity Framework - Entity-framework Code First Migrations">
    <meta name="twitter:description" content="Enable Migrations, Add your first migration, Seeding Data during migrations, Doing Update-Database within your code, Using Sql() during migrations, Initial Entity Framework Code First Migration Step by Step">
    <meta name="twitter:url" content="/entityframework/entity-framework-code-first-migrations.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/1052.75a1c0df.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Entity Framework</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/entityframework/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/entityframework/getting-started-with-entity-framework.html" class="sidebar-link">Getting started with Entity Framework</a></li><li><a href="/entityframework/code-first-conventions.html" class="sidebar-link">Code First Conventions</a></li><li><a href="/entityframework/code-first-dataannotations.html" class="sidebar-link">Code First DataAnnotations</a></li><li><a href="/entityframework/entity-framework-code-first.html" class="sidebar-link">Entity Framework Code First</a></li><li><a href="/entityframework/entity-framework-code-first-migrations.html" aria-current="page" class="active sidebar-link">Entity-framework Code First Migrations</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/entityframework/entity-framework-code-first-migrations.html#enable-migrations" class="sidebar-link">Enable Migrations</a></li><li class="sidebar-sub-header"><a href="/entityframework/entity-framework-code-first-migrations.html#add-your-first-migration" class="sidebar-link">Add your first migration</a></li><li class="sidebar-sub-header"><a href="/entityframework/entity-framework-code-first-migrations.html#seeding-data-during-migrations" class="sidebar-link">Seeding Data during migrations</a></li><li class="sidebar-sub-header"><a href="/entityframework/entity-framework-code-first-migrations.html#doing-update-database-within-your-code" class="sidebar-link">Doing &quot;Update-Database&quot; within your code</a></li><li class="sidebar-sub-header"><a href="/entityframework/entity-framework-code-first-migrations.html#using-sql-during-migrations" class="sidebar-link">Using Sql() during migrations</a></li><li class="sidebar-sub-header"><a href="/entityframework/entity-framework-code-first-migrations.html#initial-entity-framework-code-first-migration-step-by-step" class="sidebar-link">Initial Entity Framework Code First Migration Step by Step</a></li></ul></li><li><a href="/entityframework/inheritance-with-entityframework-code-first.html" class="sidebar-link">Inheritance with EntityFramework (Code First)</a></li><li><a href="/entityframework/code-first-fluent-api.html" class="sidebar-link">Code First - Fluent API</a></li><li><a href="/entityframework/mapping-relationship-with-entity-framework-code-first-one-to-one-and-variations.html" class="sidebar-link">Mapping relationship with Entity Framework Code First: One-to-one and variations</a></li><li><a href="/entityframework/mapping-relationship-with-entity-framework-code-first-one-to-many-and-many-to-many.html" class="sidebar-link">Mapping relationship with Entity Framework Code First: One-to-many and Many-to-many</a></li><li><a href="/entityframework/database-first-model-generation.html" class="sidebar-link">Database first model generation</a></li><li><a href="/entityframework/complex-types.html" class="sidebar-link">Complex Types</a></li><li><a href="/entityframework/database-initialisers.html" class="sidebar-link">Database Initialisers</a></li><li><a href="/entityframework/tracking-vs-no-tracking.html" class="sidebar-link">Tracking vs. No-Tracking</a></li><li><a href="/entityframework/transactions.html" class="sidebar-link">Transactions</a></li><li><a href="/entityframework/managing-entity-state.html" class="sidebar-link">Managing entity state</a></li><li><a href="/entityframework/loading-related-entities.html" class="sidebar-link">Loading related entities</a></li><li><a href="/entityframework/model-restraints.html" class="sidebar-link">Model Restraints</a></li><li><a href="/entityframework/entity-framework-with-postgresql.html" class="sidebar-link">Entity-Framework  with Postgresql</a></li><li><a href="/entityframework/entity-framework-with-sqlite.html" class="sidebar-link">Entity Framework with SQLite</a></li><li><a href="/entityframework/t4-templates-in-entity-framework.html" class="sidebar-link">.t4 templates in entity-framework</a></li><li><a href="/entityframework/advanced-mapping-scenarios-entity-splitting-table-splitting.html" class="sidebar-link">Advanced mapping scenarios: entity splitting, table splitting</a></li><li><a href="/entityframework/best-practices-for-entity-framework-simple-professional.html" class="sidebar-link">Best Practices For Entity Framework (Simple &amp; Professional)</a></li><li><a href="/entityframework/optimization-techniques-in-ef.html" class="sidebar-link">Optimization Techniques in EF</a></li><li><a href="/entityframework/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="entity-framework-code-first-migrations"><a href="#entity-framework-code-first-migrations" class="header-anchor">#</a> Entity-framework Code First Migrations</h1> <h2 id="enable-migrations"><a href="#enable-migrations" class="header-anchor">#</a> Enable Migrations</h2> <p>To enable Code First Migrations in entity framework, use the command</p> <div class="language-cs extra-class"><pre class="language-cs"><code>Enable<span class="token operator">-</span>Migrations

</code></pre></div><p>on the <strong>Package Manager Console</strong>.</p> <p>You need to have a valid <code>DbContext</code> implementation containing your database objects managed by EF. In this example the database context will contain to objects <code>BlogPost</code> and <code>Author</code>:</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">internal</span> <span class="token keyword">class</span> <span class="token class-name">DatabaseContext</span><span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">DbContext</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DbSet<span class="token punctuation">&lt;</span>Author<span class="token punctuation">&gt;</span></span> Authors <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">DbSet<span class="token punctuation">&lt;</span>BlogPost<span class="token punctuation">&gt;</span></span> BlogPosts <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>After executing the command, the following output should appear:</p> <div class="language-cs extra-class"><pre class="language-cs"><code>PM<span class="token operator">&gt;</span> Enable<span class="token operator">-</span>Migrations
Checking <span class="token keyword">if</span> the context targets an existing database<span class="token range operator">..</span><span class="token punctuation">.</span>
Code First Migrations enabled <span class="token keyword">for</span> project <span class="token operator">&lt;</span>YourProjectName<span class="token operator">&gt;</span><span class="token punctuation">.</span>
PM<span class="token operator">&gt;</span>

</code></pre></div><p>In addition, a new folder <code>Migrations</code> should appear with a single file <code>Configuration.cs</code> inside:
<a href="https://i.stack.imgur.com/BIpPw.png" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/BIpPw.png" alt="DB Project layout"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>The next step would be to create your first database migration script which will create the initial database (see next example).</p> <h2 id="add-your-first-migration"><a href="#add-your-first-migration" class="header-anchor">#</a> Add your first migration</h2> <p>After you've enabled migrations (please refer to <a href="http://stackoverflow.com/documentation/entity-framework/7157/entity-framework-code-first-migrations/23961/enable-migrations" target="_blank" rel="noopener noreferrer">this example<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>) you are now able to create your first migration containing an initial creation of all database tables, indexes and connections.</p> <p>A migration can be created by using the command</p> <div class="language-cs extra-class"><pre class="language-cs"><code>Add<span class="token operator">-</span>Migration <span class="token operator">&lt;</span>migration<span class="token operator">-</span>name<span class="token operator">&gt;</span>

</code></pre></div><p>This command will create a new class containing two methods <code>Up</code> and <code>Down</code> that are used to apply and remove the migration.</p> <p>Now apply the command based on the example above to create a migration called <strong>Initial</strong>:</p> <div class="language-cs extra-class"><pre class="language-cs"><code>PM<span class="token operator">&gt;</span> Add<span class="token operator">-</span>Migration Initial
Scaffolding migration 'Initial'<span class="token punctuation">.</span>
The Designer Code <span class="token keyword">for</span> <span class="token keyword">this</span> migration file includes a snapshot of your current Code
First model<span class="token punctuation">.</span> This snapshot <span class="token keyword">is</span> <span class="token class-name">used</span> to calculate the changes to <span class="token class-name">your</span> model <span class="token keyword">when</span> you
scaffold the next migration<span class="token punctuation">.</span> If you make additional changes to your model that you 
want <span class="token class-name">to</span> include <span class="token keyword">in</span> <span class="token keyword">this</span> migration<span class="token punctuation">,</span> then you can re<span class="token operator">-</span>scaffold it <span class="token keyword">by</span> running 
'Add<span class="token operator">-</span>Migration Initial' again<span class="token punctuation">.</span>

</code></pre></div><p>A new file <strong>timestamp</strong>_Initial.cs is created (only the important stuff is shown here):</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Up</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
   <span class="token function">CreateTable</span><span class="token punctuation">(</span>
       <span class="token string">&quot;dbo.Authors&quot;</span><span class="token punctuation">,</span>
        c <span class="token operator">=&gt;</span> <span class="token keyword">new</span>
           <span class="token punctuation">{</span>
               AuthorId <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">Int</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">nullable</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">identity</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
               Name <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">maxLength</span><span class="token punctuation">:</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
           <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">PrimaryKey</span><span class="token punctuation">(</span>t <span class="token operator">=&gt;</span> t<span class="token punctuation">.</span>AuthorId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
    <span class="token function">CreateTable</span><span class="token punctuation">(</span>
       <span class="token string">&quot;dbo.BlogPosts&quot;</span><span class="token punctuation">,</span>
       c <span class="token operator">=&gt;</span> <span class="token keyword">new</span>
           <span class="token punctuation">{</span>
                Id <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">Int</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">nullable</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">identity</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                Title <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">nullable</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">maxLength</span><span class="token punctuation">:</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                Message <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                Author_AuthorId <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">Int</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">PrimaryKey</span><span class="token punctuation">(</span>t <span class="token operator">=&gt;</span> t<span class="token punctuation">.</span>Id<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">ForeignKey</span><span class="token punctuation">(</span><span class="token string">&quot;dbo.Authors&quot;</span><span class="token punctuation">,</span> t <span class="token operator">=&gt;</span> t<span class="token punctuation">.</span>Author_AuthorId<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>t <span class="token operator">=&gt;</span> t<span class="token punctuation">.</span>Author_AuthorId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
    
<span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Down</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">DropForeignKey</span><span class="token punctuation">(</span><span class="token string">&quot;dbo.BlogPosts&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Author_AuthorId&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;dbo.Authors&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">DropIndex</span><span class="token punctuation">(</span><span class="token string">&quot;dbo.BlogPosts&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token string">&quot;Author_AuthorId&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">DropTable</span><span class="token punctuation">(</span><span class="token string">&quot;dbo.BlogPosts&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">DropTable</span><span class="token punctuation">(</span><span class="token string">&quot;dbo.Authors&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>As you can see, in method <code>Up()</code> two tables <code>Authors</code> and <code>BlogPosts</code> are created and the fields are created accordingly. In addition, the relation between the two tables is created by adding the field <code>Author_AuthorId</code>. On the other side the method <code>Down()</code> tries to reverse the migration activities.</p> <p>If you feel confident with your migration, you can apply the migration to the database by using the command:</p> <div class="language-cs extra-class"><pre class="language-cs"><code>Update<span class="token operator">-</span>Database

</code></pre></div><p>All pending migrations (in this case the <strong>Initial</strong>-migration) are applied to the database and afterwards the seed method is applied (the appropriate example)</p> <div class="language-cs extra-class"><pre class="language-cs"><code>PM<span class="token operator">&gt;</span> update<span class="token operator">-</span>database
Specify the '<span class="token operator">-</span>Verbose' flag to view the SQL statements being applied to the target     
database<span class="token punctuation">.</span>
Applying <span class="token keyword">explicit</span> migrations<span class="token punctuation">:</span> <span class="token punctuation">[</span>201609302203541_Initial<span class="token punctuation">]</span><span class="token punctuation">.</span>
Applying <span class="token keyword">explicit</span> migration<span class="token punctuation">:</span> 201609302203541_Initial<span class="token punctuation">.</span>
Running Seed method<span class="token punctuation">.</span>

</code></pre></div><p>You can see the results of the activities in the SQL explorer:
<a href="http://stackoverflow.com/documentation/entity-framework/7157/entity-framework-code-first-migrations/23961/enable-migrations" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/QhXSh.png" alt="database overview"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>For the commands <code>Add-Migration</code> and <code>Update-Database</code> several options are available which can be used to tweak the activities. To see all options, please use</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">get</span><span class="token operator">-</span>help Add<span class="token operator">-</span>Migration

</code></pre></div><p>and</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">get</span><span class="token operator">-</span>help Update<span class="token operator">-</span>Database

</code></pre></div><h2 id="seeding-data-during-migrations"><a href="#seeding-data-during-migrations" class="header-anchor">#</a> Seeding Data during migrations</h2> <p>After enabling and creating migrations there might be a need to initially fill or migrate data in your database. There are several possibilities but for simple migrations you can use the method 'Seed()' in the file Configuration created after calling <code>enable-migrations</code>.</p> <p>The <code>Seed()</code> function retrieves a database context as it's only parameter and you are able to perform EF operations inside this function:</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Seed</span><span class="token punctuation">(</span><span class="token class-name">Model<span class="token punctuation">.</span>DatabaseContext</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>You can perform all types of activities inside <code>Seed()</code>. In case of any failure the complete transaction (even the applied patches) are being rolled back.</p> <p>An example function that creates data only if a table is empty might look like this:</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Seed</span><span class="token punctuation">(</span><span class="token class-name">Model<span class="token punctuation">.</span>DatabaseContext</span> context<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>context<span class="token punctuation">.</span>Customers<span class="token punctuation">.</span><span class="token function">Any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Customer</span> c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Customer</span><span class="token punctuation">{</span> Id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> Name <span class="token operator">=</span> <span class="token string">&quot;Demo&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span>Customers<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">SaveData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>A nice feature provided by the EF developers is the extension method <code>AddOrUpdate()</code>. This method allows to update data based on the primary key or to insert data if it does not exist already (the example is taken from the generated source code of Configuration.cs):</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Seed</span><span class="token punctuation">(</span><span class="token class-name">Model<span class="token punctuation">.</span>DatabaseContext</span> context<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    context<span class="token punctuation">.</span>People<span class="token punctuation">.</span><span class="token function">AddOrUpdate</span><span class="token punctuation">(</span>
      p <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span>FullName<span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Person</span> <span class="token punctuation">{</span> FullName <span class="token operator">=</span> <span class="token string">&quot;Andrew Peters&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Person</span> <span class="token punctuation">{</span> FullName <span class="token operator">=</span> <span class="token string">&quot;Brice Lambson&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Person</span> <span class="token punctuation">{</span> FullName <span class="token operator">=</span> <span class="token string">&quot;Rowan Miller&quot;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><blockquote></blockquote> <p>Please be aware that <code>Seed()</code> is called after the <strong>last</strong> patch has been applied. If you need to migration or seed data during patches, other approaches need to be used.</p> <h2 id="doing-update-database-within-your-code"><a href="#doing-update-database-within-your-code" class="header-anchor">#</a> Doing &quot;Update-Database&quot; within your code</h2> <p>Applications running in non-development environments often require database updates.  After using the <code>Add-Migration</code> command to create your database patches there's the need to run the updates on other environments, and then the test environment as well.</p> <p>Challenges commonly faced are:</p> <ul><li>no Visual Studio installed on production environments, and</li> <li>no connections allowed to connection/customer environments in real life.</li></ul> <p>A workaround is the following code sequence which checks for updates to be performed, and executes them in order. Please ensure proper transactions &amp; exception handling to ensure no data gets lost in case of errors.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">UpdateDatabase</span><span class="token punctuation">(</span><span class="token class-name">MyDbConfiguration</span> configuration<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token class-name">DbMigrator</span> dbMigrator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DbMigrator</span><span class="token punctuation">(</span> configuration<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span> dbMigrator<span class="token punctuation">.</span><span class="token function">GetPendingMigrations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Any</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
   <span class="token punctuation">{</span>
      <span class="token comment">// there are pending migrations run the migration job</span>
      dbMigrator<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>where <code>MyDbConfiguration</code> is your migration setup somewhere in your sources:</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyDbConfiguration</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">DbMigrationsConfiguration<span class="token punctuation">&lt;</span>ApplicationDbContext<span class="token punctuation">&gt;</span></span></span>

</code></pre></div><h2 id="using-sql-during-migrations"><a href="#using-sql-during-migrations" class="header-anchor">#</a> Using Sql() during migrations</h2> <p>For example: You are going to migrate an existing column from non-required to required. In this case you might need to fill some default values in your migration for rows where the altered fields are actually <code>NULL</code>. In case the default value is simple (e.g. &quot;0&quot;) you might use a <code>default</code> or <code>defaultSql</code> property in your column definition. In case it's not so easy, you may use the <code>Sql()</code> function in <code>Up()</code> or <code>Down()</code> member functions of your migrations.</p> <p>Here's an example. Assuming a class <strong>Author</strong> which contains an email-address as part of the data set. Now we decide to have the email-address as a required field. To migrate existing columns the business has the <strong>smart</strong> idea of creating dummy email-addresses like <code>fullname@example.com</code>, where full name is the authors full name without spaces. Adding the <code>[Required]</code> attribute to the field <code>Email</code> would create the following migration:</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">public</span> <span class="token keyword">partial</span> <span class="token keyword">class</span> <span class="token class-name">AuthorsEmailRequired</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">DbMigration</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Up</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">AlterColumn</span><span class="token punctuation">(</span><span class="token string">&quot;dbo.Authors&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Email&quot;</span><span class="token punctuation">,</span> c <span class="token operator">=&gt;</span> c<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">nullable</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">maxLength</span><span class="token punctuation">:</span> <span class="token number">512</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Down</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">AlterColumn</span><span class="token punctuation">(</span><span class="token string">&quot;dbo.Authors&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Email&quot;</span><span class="token punctuation">,</span> c <span class="token operator">=&gt;</span> c<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">maxLength</span><span class="token punctuation">:</span> <span class="token number">512</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>This would fail in case some NULL fields are inside the database:</p> <blockquote></blockquote> <p>Cannot insert the value NULL into column 'Email', table 'App.Model.DatabaseContext.dbo.Authors'; column does not allow nulls. UPDATE fails.</p> <p>Adding the following like <strong>before</strong> the <code>AlterColumn</code> command will help:</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token function">Sql</span><span class="token punctuation">(</span><span class="token string">@&quot;Update dbo.Authors
    set Email = REPLACE(name, ' ', '') + N'@example.com'
    where Email is null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>The <code>update-database</code> call succeeds and the table looks like this (example data shown):</p> <p><a href="http://i.stack.imgur.com/WZC9s.png" target="_blank" rel="noopener noreferrer"><img src="http://i.stack.imgur.com/WZC9s.png" alt="Example Author Data"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="other-usage"><a href="#other-usage" class="header-anchor">#</a> Other Usage</h3> <p>You may use the <code>Sql()</code> function for all types of DML and DDL actibities in your database. It is executed as part of the migration transaction; If the SQL fails, the complete migration fails and a rollback is done.</p> <h2 id="initial-entity-framework-code-first-migration-step-by-step"><a href="#initial-entity-framework-code-first-migration-step-by-step" class="header-anchor">#</a> Initial Entity Framework Code First Migration Step by Step</h2> <ol><li>Create a console application.</li> <li>Install EntityFramework nuget package by running <code>Install-Package EntityFramework</code> in &quot;Package Manager Console&quot;</li> <li>Add your connection string in app.config file , It's important to include  <code>providerName=&quot;System.Data.SqlClient&quot;</code> in your connection.</li> <li>Create a public class as you wish , some thing like &quot;<code>Blog</code>&quot;</li> <li>Create Your ContextClass which inherit from DbContext , some thing like &quot;<code>BlogContext</code>&quot;</li> <li>Define a property in your context of DbSet type , some thing like this :</li></ol> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Blog</span> 
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BlogContext</span><span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">DbContext</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">BlogContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span><span class="token string">&quot;name=Your_Connection_Name&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name">DbSet<span class="token punctuation">&lt;</span>Blog<span class="token punctuation">&gt;</span></span> Blogs<span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><ol><li>It's important to pass the connection name in constructor ( here Your_Connection_Name)</li> <li>In Package Manager Console run <code>Enable-Migration</code> command , This will create a migration folder in your project</li> <li>Run <code>Add-Migration Your_Arbitrary_Migraiton_Name</code> command , this will create a migration class in migrations folder with two method Up() and Down()</li> <li>Run <code>Update-Database</code> command in order to create a database with a blog table</li></ol></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/entityframework/entity-framework-code-first-migrations.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/entityframework/entity-framework-code-first.html" class="prev">
        Entity Framework Code First
      </a></span> <span class="next"><a href="/entityframework/inheritance-with-entityframework-code-first.html">
        Inheritance with EntityFramework (Code First)
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/1052.75a1c0df.js" defer></script>
  </body>
</html>
