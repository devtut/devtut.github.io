(window.webpackJsonp=window.webpackJsonp||[]).push([[1095],{1503:function(t,e,s){"use strict";s.r(e);var a=s(31),n=Object(a.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"user-defined-functions-udfs"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#user-defined-functions-udfs"}},[t._v("#")]),t._v(" User Defined Functions (UDFs)")]),t._v(" "),s("h2",{attrs:{id:"allow-full-column-references-without-penalty"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#allow-full-column-references-without-penalty"}},[t._v("#")]),t._v(" Allow full column references without penalty")]),t._v(" "),s("p",[t._v("It's easier to implement some UDFs on the worksheet if full column references can be passed in as parameters. However, due to the explicit nature of coding, any loop involving these ranges may be processing hundreds of thousands of cells that are completely empty. This reduces your VBA project (and workbook) to a frozen mess while unnecessary non-values are processed.")]),t._v(" "),s("p",[t._v("Looping through a worksheet's cells is one of the slowest methods of accomplishing a task but sometimes it is unavoidable. Cutting the work performed down to what is actually required makes perfect sense.")]),t._v(" "),s("p",[t._v("The solution is to truncate the full column or full row references to the "),s("a",{attrs:{href:"https://msdn.microsoft.com/en-us/library/office/ff840732.aspx",target:"_blank",rel:"noopener noreferrer"}},[t._v("Worksheet.UsedRange property"),s("OutboundLink")],1),t._v(" with the "),s("a",{attrs:{href:"https://msdn.microsoft.com/en-us/library/office/aa195772.aspx",target:"_blank",rel:"noopener noreferrer"}},[t._v("Intersect method"),s("OutboundLink")],1),t._v(". The following sample will loosely replicate a worksheet's native SUMIF function so the "),s("strong",[t._v("criteria_range")]),t._v(" will also be resized to suit the "),s("strong",[t._v("sum_range")]),t._v(" since each value in the "),s("strong",[t._v("sum_range")]),t._v(" must be accompanied by a value in the "),s("strong",[t._v("criteria_range")]),t._v(".")]),t._v(" "),s("p",[t._v("The "),s("a",{attrs:{href:"https://msdn.microsoft.com/en-us/library/office/ff193687.aspx",target:"_blank",rel:"noopener noreferrer"}},[t._v("Application.Caller"),s("OutboundLink")],1),t._v(" for a UDF used on a worksheet is the cell in which it resides. The cell's "),s("a",{attrs:{href:"https://msdn.microsoft.com/en-us/library/office/aa224980.aspx",target:"_blank",rel:"noopener noreferrer"}},[t._v(".Parent"),s("OutboundLink")],1),t._v(" property is the worksheet. This will be used to define the .UsedRange.")]),t._v(" "),s("p",[t._v("In a Module code sheet:")]),t._v(" "),s("div",{staticClass:"language-vb extra-class"},[s("pre",{pre:!0,attrs:{class:"language-vb"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Option")]),t._v(" Explicit\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Function")]),t._v(" udfMySumIf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rngA "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("As")]),t._v(" Range"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" rngB "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("As")]),t._v(" Range"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("_")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Optional")]),t._v(" crit "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("As")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Variant")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"yes"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Dim")]),t._v(" c "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("As")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Long")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ttl "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("As")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Double")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("With")]),t._v(" Application"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Caller"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Parent\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Set")]),t._v(" rngA "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Intersect"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rngA"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("UsedRange"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Set")]),t._v(" rngB "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rngB"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Resize"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rngA"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Rows"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Count"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" rngA"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Columns"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Count"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("End")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("With")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("For")]),t._v(" c "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("To")]),t._v(" rngA"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Cells"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Count\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("If")]),t._v(" IsNumeric"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rngA"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Cells"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Value2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Then")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("If")]),t._v(" LCase"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rngB"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Value2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" LCase"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("crit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Then")]),t._v("\n                ttl "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ttl "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" rngA"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Cells"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Value2\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("End")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("If")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("End")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("If")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Next")]),t._v(" c\n    \n    udfMySumIf "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ttl\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("End")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Function")]),t._v("\n\n")])])]),s("blockquote"),t._v(" "),s("p",[s("sup",[t._v("Syntax:")]),s("br"),t._v(" "),s("code",[t._v("=udfMySumIf(*sum_range*, *criteria_range*, [*criteria*])")])]),t._v(" "),s("p",[s("a",{attrs:{href:"http://i.stack.imgur.com/sgMr4.png",target:"_blank",rel:"noopener noreferrer"}},[s("img",{attrs:{src:"http://i.stack.imgur.com/sgMr4.png",alt:"udf_sumifs"}}),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("While this is a fairly simplistic example, it adequately demonstrates passing in two full column references (1,048,576 rows each) but only processing 15 rows of data and criteria.")]),t._v(" "),s("p",[s("sub",[t._v("Linked official MSDN documentation of individual methods and properties courtesy of Microsoftâ„¢.")])]),t._v(" "),s("h2",{attrs:{id:"udf-hello-world"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#udf-hello-world"}},[t._v("#")]),t._v(" UDF - Hello World")]),t._v(" "),s("ol",[s("li",[t._v("Open Excel")]),t._v(" "),s("li",[t._v("Open the Visual Basic Editor ( see  "),s("a",{attrs:{href:"http://stackoverflow.com/documentation/excel-vba/777/introduction-to-excel-vba/2801/opening-the-visual-basic-editor#t=201607252035449856939",target:"_blank",rel:"noopener noreferrer"}},[t._v("Opening the Visual Basic Editor"),s("OutboundLink")],1),t._v(" )")]),t._v(" "),s("li",[t._v("Add a new module by clicking Insert --\x3e Module :")])]),t._v(" "),s("p",[s("a",{attrs:{href:"http://i.stack.imgur.com/0KhKM.png",target:"_blank",rel:"noopener noreferrer"}},[s("img",{attrs:{src:"http://i.stack.imgur.com/0KhKM.png",alt:"enter image description here"}}),s("OutboundLink")],1)]),t._v(" "),s("ol",[s("li",[t._v("Copy and Paste the following code in the new module :")])]),t._v(" "),s("div",{staticClass:"language-vb extra-class"},[s("pre",{pre:!0,attrs:{class:"language-vb"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Function")]),t._v(" Hello"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("As")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("String")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("'Note: the output of the function is simply the function's name")]),t._v("\nHello "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello, World !"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("End")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Function")]),t._v("\n\n")])])]),s("p",[t._v("To obtain :")]),t._v(" "),s("p",[s("a",{attrs:{href:"http://i.stack.imgur.com/1r1E7.png",target:"_blank",rel:"noopener noreferrer"}},[s("img",{attrs:{src:"http://i.stack.imgur.com/1r1E7.png",alt:"enter image description here"}}),s("OutboundLink")],1)]),t._v(" "),s("ol",[s("li",[t._v('Go back to your workbook and type "=Hello()" into a cell to see the "Hello World".')])]),t._v(" "),s("p",[s("a",{attrs:{href:"http://i.stack.imgur.com/PFQsX.png",target:"_blank",rel:"noopener noreferrer"}},[s("img",{attrs:{src:"http://i.stack.imgur.com/PFQsX.png",alt:"enter image description here"}}),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"count-unique-values-in-range"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#count-unique-values-in-range"}},[t._v("#")]),t._v(" Count Unique values in Range")]),t._v(" "),s("div",{staticClass:"language-vb extra-class"},[s("pre",{pre:!0,attrs:{class:"language-vb"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Function")]),t._v(" countUnique"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("r "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("As")]),t._v(" range"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("As")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Long")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("'Application.Volatile False ' optional")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Set")]),t._v(" r "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Intersect"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("r"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" r"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Worksheet"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("UsedRange"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("' optional if you pass entire rows or columns to the function")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Dim")]),t._v(" c "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("As")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("New")]),t._v(" Collection"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" v\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("On")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Error")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Resume")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Next")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('\' to ignore the Run-time error 457: "This key is already associated with an element of this collection".')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("For")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Each")]),t._v(" v "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("In")]),t._v(" r"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Value  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("' remove .Value for ranges with more than one Areas")]),t._v("\n        c"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Add "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" v "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Next")]),t._v("\n    c"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Remove "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("' optional to exclude blank values from the count")]),t._v("\n    countUnique "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" c"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Count\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("End")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Function")]),t._v("\n\n")])])]),s("p",[s("a",{attrs:{href:"http://stackoverflow.com/documentation/vba/5838/collections",target:"_blank",rel:"noopener noreferrer"}},[t._v("Collections"),s("OutboundLink")],1)]),t._v(" "),s("h4",{attrs:{id:"syntax"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#syntax"}},[t._v("#")]),t._v(" Syntax")]),t._v(" "),s("li",[s("p",[t._v("**Function functionName(argumentVariable As dataType, argumentVariable2 As dataType, Optional argumentVariable3 As dataType) As functionReturnDataType**"),s("br"),t._v("\nBasic declaration of a function. Every function needs a name, but it does not have to take any arguments. It may take 0 arguments, or it may take a given number of arguments. You may also declare an argument as optional (meaning it does not matter if you supply it when calling the function). It is best practice to supply the variable type for each argument, and likewise, to return what data type the function itself is going to return.")])]),t._v(" "),s("li",[s("p",[t._v("**functionName = theVariableOrValueBeingReturned**"),s("br"),t._v("\nIf you're coming from other programming languages, you may be used to the `Return` keyword. This is not used in VBA - instead, we use the function name. You can set it to the contents of a variable or to some directly supplied value. Note that if you did set a data type for the function's return, the variable or data you are supplying this time must be of that data type.")])]),t._v(" "),s("li",[s("p",[t._v("**End Function**"),s("br"),t._v("\nMandatory. Signifies the end of the `Function` codeblock and must thusly be at the end. The VBE usually supplies this automatically when you create a new function.")])]),t._v(" "),s("h4",{attrs:{id:"remarks"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#remarks"}},[t._v("#")]),t._v(" Remarks")]),t._v(" "),s("p",[t._v("A User Defined Function (aka UDF) refers to a task specific function that has been created by the user. It can be called as a worksheet function (ex: "),s("code",[t._v("=SUM(...)")]),t._v(") or used to return a value to a running process in a Sub procedure. A UDF returns a value, typically from information passed into it as one or more parameters.")]),t._v(" "),s("p",[t._v("It can be created by :")]),t._v(" "),s("ol",[s("li",[t._v("using VBA .")]),t._v(" "),s("li",[t._v("using Excel C API - By creating an XLL that exports compiled functions to Excel.")]),t._v(" "),s("li",[t._v("using the COM interface.")])])])}),[],!1,null,null,null);e.default=n.exports}}]);