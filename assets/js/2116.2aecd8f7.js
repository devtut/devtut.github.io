(window.webpackJsonp=window.webpackJsonp||[]).push([[2116],{2524:function(e,t,s){"use strict";s.r(t);var a=s(31),n=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"handling-time-zones"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#handling-time-zones"}},[e._v("#")]),e._v(" Handling Time Zones")]),e._v(" "),s("h2",{attrs:{id:"retrieve-the-current-date-and-time-in-a-particular-time-zone"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#retrieve-the-current-date-and-time-in-a-particular-time-zone"}},[e._v("#")]),e._v(" Retrieve the current date and time in a particular time zone.")]),e._v(" "),s("p",[e._v("This fetches the value of "),s("code",[e._v("NOW()")]),e._v(" in local time, in India Standard Time, and then again in UTC.")]),e._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("SELECT")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("NOW")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("SET")]),e._v(" time_zone"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'Asia/Kolkata'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" \n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("SELECT")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("NOW")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("SET")]),e._v(" time_zone"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'UTC'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" \n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("SELECT")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("NOW")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n")])])]),s("h2",{attrs:{id:"convert-a-stored-date-or-datetime-value-to-another-time-zone"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#convert-a-stored-date-or-datetime-value-to-another-time-zone"}},[e._v("#")]),e._v(" Convert a stored "),s("code",[e._v("DATE")]),e._v(" or "),s("code",[e._v("DATETIME")]),e._v(" value to another time zone.")]),e._v(" "),s("p",[e._v("If you have a stored "),s("code",[e._v("DATE")]),e._v(" or "),s("code",[e._v("DATETIME")]),e._v(" (in a column somewhere) it was stored with respect to some time zone, but in MySQL the time zone is "),s("strong",[e._v("not")]),e._v(" stored with the value.  So, if you want to convert it to another time zone, you can, but you must know the original time zone. Using "),s("code",[e._v("CONVERT_TZ()")]),e._v(" does the conversion.  This example shows rows sold in California in local time.")]),e._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("SELECT")]),e._v(" CONVERT_TZ"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("date_sold"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'UTC'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'America/Los_Angeles'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" date_sold_local\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("FROM")]),e._v(" sales\n "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("WHERE")]),e._v(" state_sold "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'CA'")]),e._v("\n\n")])])]),s("h2",{attrs:{id:"retrieve-stored-timestamp-values-in-a-particular-time-zone"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#retrieve-stored-timestamp-values-in-a-particular-time-zone"}},[e._v("#")]),e._v(" Retrieve stored "),s("code",[e._v("TIMESTAMP")]),e._v(" values in a particular time zone")]),e._v(" "),s("p",[e._v("This is really easy. All "),s("code",[e._v("TIMESTAMP")]),e._v(" values are stored in universal time, and always converted to the present "),s("code",[e._v("time_zone")]),e._v(" setting whenever they are rendered.")]),e._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("SET")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("SESSION")]),e._v(" time_zone"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'America/Los_Angeles'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" \n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("SELECT")]),e._v(" timestamp_sold\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("FROM")]),e._v(" sales\n "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("WHERE")]),e._v(" state_sold "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'CA'")]),e._v("\n\n")])])]),s("p",[e._v("Why is this? "),s("code",[e._v("TIMESTAMP")]),e._v(" values are based on the venerable "),s("a",{attrs:{href:"https://en.wikipedia.org/wiki/Unix_time",target:"_blank",rel:"noopener noreferrer"}},[e._v("UNIX "),s("code",[e._v("time_t")]),e._v(" data type"),s("OutboundLink")],1),e._v(". Those UNIX timestamps are stored as a number of seconds since "),s("code",[e._v("1970-01-01 00:00:00")]),e._v(" UTC.")]),e._v(" "),s("p",[s("strong",[e._v("Notice")]),e._v(" "),s("code",[e._v("TIMESTAMP")]),e._v(" values are stored in universal time. "),s("code",[e._v("DATE")]),e._v(" and "),s("code",[e._v("DATETIME")]),e._v(" values are stored in whatever local time was in effect when they were stored.")]),e._v(" "),s("h2",{attrs:{id:"what-is-my-server-s-local-time-zone-setting"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#what-is-my-server-s-local-time-zone-setting"}},[e._v("#")]),e._v(" What is my server's local time zone setting?")]),e._v(" "),s("p",[e._v("Each server has a default global time_zone setting, configured by the owner of the server machine. You can find out the current time zone setting this way:")]),e._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("SELECT")]),e._v(" @"),s("span",{pre:!0,attrs:{class:"token variable"}},[e._v("@time_zone")]),e._v("\n\n")])])]),s("p",[e._v("Unfortunately, that usually yields the value "),s("code",[e._v("SYSTEM")]),e._v(", meaning the MySQL time is governed by the server OS's time zone setting.")]),e._v(" "),s("p",[e._v("This sequence of queries (yes, "),s("a",{attrs:{href:"https://en.wikipedia.org/wiki/Kludge#Computer_science",target:"_blank",rel:"noopener noreferrer"}},[e._v("it's a hack"),s("OutboundLink")],1),e._v(") gives you back the offset in minutes between the server's time zone setting and UTC.")]),e._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("CREATE")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("TEMPORARY")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("TABLE")]),e._v(" times "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("dt "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("DATETIME")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" ts "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("TIMESTAMP")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("SET")]),e._v(" time_zone "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'UTC'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("INSERT")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("INTO")]),e._v(" times "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("VALUES")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("NOW")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("NOW")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("SET")]),e._v(" time_zone "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'SYSTEM'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("SELECT")]),e._v(" dt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" ts"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" TIMESTAMPDIFF"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("MINUTE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" dt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" ts"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("offset")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("FROM")]),e._v(" times"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("DROP")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("TEMPORARY")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("TABLE")]),e._v(" times"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n")])])]),s("p",[e._v("How does this work? The two columns in the temporary table with different data types is the clue.  "),s("code",[e._v("DATETIME")]),e._v(" data types are always stored in local time in tables, and "),s("code",[e._v("TIMESTAMP")]),e._v("s in UTC.  So the "),s("code",[e._v("INSERT")]),e._v(" statement, performed when the time_zone is set to UTC, stores two identical date / time values.")]),e._v(" "),s("p",[e._v("Then, the SELECT statement, is done when the time_zone is set to server local time. "),s("code",[e._v("TIMESTAMP")]),e._v("s are always translated from their stored UTC form to local time in SELECT statements.  "),s("code",[e._v("DATETIME")]),e._v("s are not. So the "),s("a",{attrs:{href:"https://dev.mysql.com/doc/refman/5.7/en/date-and-time-functions.html#function_timestampdiff",target:"_blank",rel:"noopener noreferrer"}},[s("code",[e._v("TIMESTAMPDIFF(MINUTE...)")]),e._v(" operation"),s("OutboundLink")],1),e._v(" computes the difference between local and universal time.")]),e._v(" "),s("h2",{attrs:{id:"what-time-zone-values-are-available-in-my-server"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#what-time-zone-values-are-available-in-my-server"}},[e._v("#")]),e._v(" What time_zone values are available in my server?")]),e._v(" "),s("p",[e._v("To get a list of possible time_zone values in your MySQL server instance, use this command.")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("\nSELECT mysql.time_zone_name.name\n\n")])])]),s("p",[e._v("Ordinarily, this shows the "),s("a",{attrs:{href:"https://www.iana.org/time-zones",target:"_blank",rel:"noopener noreferrer"}},[e._v("ZoneInfo list of time zones"),s("OutboundLink")],1),e._v(" maintained by Paul Eggert at the "),s("a",{attrs:{href:"https://www.iana.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Internet Assigned Numbers Authority"),s("OutboundLink")],1),e._v(". Worldwide there are appproximately 600 time zones.")]),e._v(" "),s("p",[e._v("Unix-like operating systems (Linux distributions, BSD distributions, and modern Mac OS distributions, for example) receive routine updates. Installing these updates on an operating system lets the MySQL instances running there track the changes in time zone and daylight / standard time changeovers.")]),e._v(" "),s("p",[e._v("If you get a much shorter list of time zone names, your server is either incompletely configured or running on Windows.  "),s("a",{attrs:{href:"https://dev.mysql.com/doc/refman/5.7/en/time-zone-support.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Here are instructions"),s("OutboundLink")],1),e._v(" for your server administrator to install and maintain the ZoneInfo list.")]),e._v(" "),s("h4",{attrs:{id:"remarks"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#remarks"}},[e._v("#")]),e._v(" Remarks")]),e._v(" "),s("p",[e._v("When you need to handle time information for a worldwide user base in MySQL, use the TIMESTAMP data type in your tables.")]),e._v(" "),s("p",[e._v("For each user, store a user-preference timezone column. VARCHAR(64) is a good data type for that column. When a user registers to use your system, ask for the time zone value. Mine is Atlantic Time, "),s("code",[e._v("America/Edmonton")]),e._v(". Yours might or might not be "),s("code",[e._v("Asia/Kolkata")]),e._v(" or "),s("code",[e._v("Australia/NSW")]),e._v(". For a user interface for this user-preference setting, the WordPress.org software has a good example.")]),e._v(" "),s("p",[e._v("Finally, whenever you establish a connection from your host program (Java, php, whatever) to your DBMS on behalf of a user, issue the SQL command")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("\nSET SESSION time_zone='(whatever tz string the user gave you)'\n\n")])])]),s("p",[e._v("before you handle any user data involving times. Then all the "),s("code",[e._v("TIMESTAMP")]),e._v(" times you have install will render in the user's local time.")]),e._v(" "),s("p",[e._v("This will cause all times going in to your tables to be converted to UTC, and all times coming out to be translated to local. It works properly for NOW() and CURDATE(). Again, you must use TIMESTAMP and not DATETIME or DATE data types for this.")]),e._v(" "),s("p",[e._v("Make sure your server OS and default MySQL time zones are set to UTC. If you don't do this before you start loading information into your database, it will be almost impossible to fix. If you use a vendor to run MySQL, insist they get this right.")])])}),[],!1,null,null,null);t.default=n.exports}}]);