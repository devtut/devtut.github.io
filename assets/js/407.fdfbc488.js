(window.webpackJsonp=window.webpackJsonp||[]).push([[407],{815:function(e,t,r){"use strict";r.r(t);var o=r(31),n=Object(o.a)({},(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",{attrs:{id:"service-worker"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#service-worker"}},[e._v("#")]),e._v(" Service Worker")]),e._v(" "),r("p",[e._v("We will see how to set up a service working on angular, to allow our web app to have offline capabilities.")]),e._v(" "),r("p",[e._v("A Service worker is a special script which runs in the background in the browser and manages network requests to a given origin. It's originally installed by an app and stays resident on the user's machine/device. It's activated by the browser when a page from its origin is loaded and has the option to respond to HTTP requests during the page loading")]),e._v(" "),r("h2",{attrs:{id:"add-service-worker-to-our-app"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#add-service-worker-to-our-app"}},[e._v("#")]),e._v(" Add Service Worker to our app")]),e._v(" "),r("p",[e._v("First in case you are consulting mobile.angular.io the flag --mobile doesn't work anymore.")]),e._v(" "),r("p",[e._v("So to start , we can create a normal project with angular cli.")]),e._v(" "),r("div",{staticClass:"language-js extra-class"},[r("pre",{pre:!0,attrs:{class:"language-js"}},[r("code",[e._v("ng "),r("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("new")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("serviceWorking")]),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("example\ncd serviceWorking"),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("example\n\n")])])]),r("p",[e._v("Now the important thing, to said to angular cli that we want to use service worker we need to do:")]),e._v(" "),r("p",[e._v("ng set apps.0.serviceWorker=true")]),e._v(" "),r("p",[e._v("If for  some reason you donâ€™t have @angular/service-worker installed, you will see a message:")]),e._v(" "),r("blockquote"),e._v(" "),r("p",[e._v("Your project is configured with serviceWorker = true, but\n@angular/service-worker is not installed. Run `npm install --save-dev @angular/service-worker` and try again, or run `ng set apps.0.serviceWorker=false` in your .angular-cli.json.")]),e._v(" "),r("p",[e._v('Check the .angular-cli.json and you now should see this:\n"serviceWorker": true')]),e._v(" "),r("p",[e._v("When this flag is true, production builds will be set up with a service worker.")]),e._v(" "),r("p",[e._v("A ngsw-manifest.json file will be generated (or augmented in case we have create a ngsw-manifest.json in the root of the project, usually this is done to specify the routing ,in a future this will probably be done automatic) in the dist/ root, and the service worker script will be copied there. A short script will be added to index.html to register the service worker.")]),e._v(" "),r("p",[e._v("Now if we build the app in production mode\nng build --prod")]),e._v(" "),r("p",[e._v("And check dist/ folder.")]),e._v(" "),r("p",[e._v("You will see three new files there :")]),e._v(" "),r("ul",[r("li",[e._v("worker-basic.min.js")]),e._v(" "),r("li",[e._v("sw-register.HASH.bundle.js")]),e._v(" "),r("li",[e._v("ngsw-manifest.json")])]),e._v(" "),r("p",[e._v("Also, index.html now includes this sw-register script, which registers a Angular Service Worker (ASW) for us.")]),e._v(" "),r("p",[e._v("Refresh the page in your browser (served by the Web Server for Chrome)")]),e._v(" "),r("p",[e._v("Open Developer Tools. Go to the Application -> Service Workers")]),e._v(" "),r("p",[r("a",{attrs:{href:"https://i.stack.imgur.com/kVKmq.png",target:"_blank",rel:"noopener noreferrer"}},[r("img",{attrs:{src:"https://i.stack.imgur.com/kVKmq.png",alt:"enter image description here"}}),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("Good now the Service Worker is up and running!")]),e._v(" "),r("p",[e._v("Now our application, should load faster and we should be able to use the app offline.")]),e._v(" "),r("p",[e._v("Now if you enable the offline mode in the chrome console , you should see that our app in "),r("a",{attrs:{href:"http://localhost:4200/index.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://localhost:4200/index.html"),r("OutboundLink")],1),e._v(" is working without connection to internet.")]),e._v(" "),r("p",[e._v("But in "),r("a",{attrs:{href:"http://localhost:4200/",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://localhost:4200/"),r("OutboundLink")],1),e._v(" we have a problem and it doesn't load, this is due to\nthe static content cache only serves files listed in the manifest.")]),e._v(" "),r("p",[e._v("For example, if the manifest declares a URL of /index.html, requests to /index.html will be answered by the cache, but a request to / or /some/route will go to the network.")]),e._v(" "),r("p",[e._v("That's where the route redirection plugin comes in. It reads a routing config from the manifest and redirects configured routes to a specified index route.")]),e._v(" "),r("p",[e._v("Currently, this section of configuration must be hand-written (19-7-2017). Eventually, it will be generated from the route configuration present in the application source.")]),e._v(" "),r("p",[e._v("So if now we create or ngsw-manifest.json in the root of the project")]),e._v(" "),r("div",{staticClass:"language-js extra-class"},[r("pre",{pre:!0,attrs:{class:"language-js"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),r("span",{pre:!0,attrs:{class:"token string"}},[e._v('"routing"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),r("span",{pre:!0,attrs:{class:"token string"}},[e._v('"routes"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n      "),r("span",{pre:!0,attrs:{class:"token string"}},[e._v('"/"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n        "),r("span",{pre:!0,attrs:{class:"token string"}},[e._v('"prefix"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("false")]),e._v("\n      "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),r("span",{pre:!0,attrs:{class:"token string"}},[e._v('"index"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[e._v('"/index.html"')]),e._v("\n  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\n")])])]),r("p",[e._v("And we build again our app, now when we go to "),r("a",{attrs:{href:"http://localhost:4200/",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://localhost:4200/"),r("OutboundLink")],1),e._v(", we should be redirected to "),r("a",{attrs:{href:"http://localhost:4200/index.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://localhost:4200/index.html"),r("OutboundLink")],1),e._v(".")]),e._v(" "),r("p",[e._v("For further information about routing read the "),r("a",{attrs:{href:"https://github.com/angular/mobile-toolkit/tree/master/service-worker/worker",target:"_blank",rel:"noopener noreferrer"}},[e._v("official documentation here"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("Here you can find more documentation about service workers:")]),e._v(" "),r("p",[r("a",{attrs:{href:"https://developers.google.com/web/fundamentals/getting-started/primers/service-workers",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://developers.google.com/web/fundamentals/getting-started/primers/service-workers"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"https://docs.google.com/document/d/19S5ozevWighny788nI99worpcIMDnwWVmaJDGf_RoDY/edit#",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://docs.google.com/document/d/19S5ozevWighny788nI99worpcIMDnwWVmaJDGf_RoDY/edit#"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("And here you can see an alternative way to implement the service working using SW precache library :")]),e._v(" "),r("p",[r("a",{attrs:{href:"https://coryrylan.com/blog/fast-offline-angular-apps-with-service-workers",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://coryrylan.com/blog/fast-offline-angular-apps-with-service-workers"),r("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=n.exports}}]);