(window.webpackJsonp=window.webpackJsonp||[]).push([[1339],{1747:function(t,a,s){"use strict";s.r(a);var e=s(31),r=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"cloudkit"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cloudkit"}},[t._v("#")]),t._v(" CloudKit")]),t._v(" "),s("h2",{attrs:{id:"registering-app-for-use-with-cloudkit"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#registering-app-for-use-with-cloudkit"}},[t._v("#")]),t._v(" Registering app for use with CloudKit")]),t._v(" "),s("p",[t._v("What you need is to get an entitlements file so the app can access your iCloud and write records using CloudKit.")]),t._v(" "),s("p",[t._v("Follow the steps to grant access to iCloud from your app:")]),t._v(" "),s("p",[t._v("1- Select the project in the Project Navigator, and then open the General tab.")]),t._v(" "),s("p",[t._v("2- In the Identity section, set your developer Apple ID to the Team dropdown menu. (If it is not available, add it in Xcode menu -> Preferences -> Accounts.")]),t._v(" "),s("p",[t._v('3- Go to Capabilities tab in the project properties and turn iCloud on. Then, select "Key-Value Storage" and "CloudKit".')]),t._v(" "),s("p",[s("a",{attrs:{href:"http://i.stack.imgur.com/vQl0o.png",target:"_blank",rel:"noopener noreferrer"}},[s("img",{attrs:{src:"http://i.stack.imgur.com/vQl0o.png",alt:"enter image description here"}}),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("4- Make sure these items are checked:")]),t._v(" "),s("p",[s("a",{attrs:{href:"http://i.stack.imgur.com/j1kzA.png",target:"_blank",rel:"noopener noreferrer"}},[s("img",{attrs:{src:"http://i.stack.imgur.com/j1kzA.png",alt:"enter image description here"}}),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("If all of the items are checked, then your app is ready to use CloudKit.")]),t._v(" "),s("h2",{attrs:{id:"using-cloudkit-dashboard"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#using-cloudkit-dashboard"}},[t._v("#")]),t._v(" Using CloudKit Dashboard")]),t._v(" "),s("p",[t._v("All the records create using CloudKit-related code can be previewed, edited and even removed in CloudKit Dashboard. To access CloudKit Dashboard, go "),s("a",{attrs:{href:"https://icloud.developer.apple.com/dashboard/",target:"_blank",rel:"noopener noreferrer"}},[t._v("here"),s("OutboundLink")],1),t._v(".")]),t._v(" "),s("p",[t._v("There are several parts in the dashboard:")]),t._v(" "),s("ul",[s("li",[t._v("Record Types (which will be discussed later)")]),t._v(" "),s("li",[t._v("Security Roles (which is where you can set databases as public or private)")]),t._v(" "),s("li",[t._v("Subscription Types (which your app could register for "),s("a",{attrs:{href:"http://stackoverflow.com/documentation/ios/3492/push-notifications#t=201608021042526985864",target:"_blank",rel:"noopener noreferrer"}},[t._v("Apple Push Notifications (APNs)"),s("OutboundLink")],1),t._v(" to notify you when a record is changed)")])]),t._v(" "),s("h3",{attrs:{id:"record-types"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#record-types"}},[t._v("#")]),t._v(" Record Types")]),t._v(" "),s("p",[t._v("Here, you get a list of all the existing record types in the app. When you first open CloudKit Dashboard for an app,  thereâ€™s a record type called Users there, which you can use it or just delete it and use your own.")]),t._v(" "),s("p",[t._v("In this page, you could make your data typed manually. Of course, in most cases this is pointless, because iOS SDK can handle it way better than the dashboard, but the functionality is also there if you prefer. The most use of this page is for previewing types.")]),t._v(" "),s("h2",{attrs:{id:"saving-data-to-cloudkit"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#saving-data-to-cloudkit"}},[t._v("#")]),t._v(" Saving data to CloudKit")]),t._v(" "),s("p",[t._v("To save date to CloudKit, we must make:")]),t._v(" "),s("ul",[s("li",[t._v("A "),s("code",[t._v("CKRecordID")]),t._v(" (the key of your unique record)")]),t._v(" "),s("li",[t._v("A "),s("code",[t._v("CKRecord")]),t._v(" (which includes data)")])]),t._v(" "),s("h3",{attrs:{id:"making-a-record-key"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#making-a-record-key"}},[t._v("#")]),t._v(" Making a record key")]),t._v(" "),s("p",[t._v("To ensure that every new record identifier is unique, we use the current "),s("strong",[t._v("timestamp")]),t._v(", which  is unique. We get the timestamp using "),s("code",[t._v("NSDate")]),t._v("'s method "),s("code",[t._v("timeIntervalSinceReferenceDate()")]),t._v(". It is in form of ###.### (# are numbers), which we will use the integer part. To do this, we split the string:")]),t._v(" "),s("h3",{attrs:{id:"swift"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#swift"}},[t._v("#")]),t._v(" Swift")]),t._v(" "),s("div",{staticClass:"language-swift extra-class"},[s("pre",{pre:!0,attrs:{class:"language-swift"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" timestamp "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("format"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-literal"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%f"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NSDate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("timeIntervalSinceReferenceDate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" timestampParts "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" timestamp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("componentsSeparatedByString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string-literal"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"."')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" recordID "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CKRecordID")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("recordName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" timestampParts"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])])]),s("h3",{attrs:{id:"making-the-record"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#making-the-record"}},[t._v("#")]),t._v(" Making the record")]),t._v(" "),s("p",[t._v("To make the record, we should specify the record type (explained in Using CloudKit Dashboard) as Users, the ID as the thing we made just now and the data. Here, we will add a sample text, a picture and the current date to the record:")]),t._v(" "),s("h3",{attrs:{id:"swift-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#swift-2"}},[t._v("#")]),t._v(" Swift")]),t._v(" "),s("div",{staticClass:"language-swift extra-class"},[s("pre",{pre:!0,attrs:{class:"language-swift"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" record "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CKRecord")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("recordType"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-literal"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Users"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" recordID"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" recordID"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nrecord"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setObject")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string-literal"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Some Text"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" forKey"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-literal"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"text"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nrecord"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setObject")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CKAsset")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fileURL"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" someValidImageURL"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" forKey"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-literal"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"image"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nrecord"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setObject")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NSDate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" forKey"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-literal"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"date"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])])]),s("h3",{attrs:{id:"objective-c"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#objective-c"}},[t._v("#")]),t._v(" Objective-C")]),t._v(" "),s("div",{staticClass:"language-swift extra-class"},[s("pre",{pre:!0,attrs:{class:"language-swift"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CKRecord")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("record "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CKRecord")]),t._v(" alloc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" initWithRecordType"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-literal"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Users"')])]),t._v(" recordID"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" recordID"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("record setObject"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-literal"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Some Text"')])]),t._v(" forKey"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-literal"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"text"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("record setObject"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CKAsset")]),t._v(" assetWithFileURL"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" someValidImageURL"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" forKey"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-literal"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"image"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("record setObject"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NSDate")]),t._v(" alloc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("init")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" forKey"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-literal"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"date"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])])]),s("blockquote"),t._v(" "),s("h3",[t._v("Note")]),t._v("\nHere, we didn't add the `UIImage` directly to the record, because as mentioned in Remarks, image format isn't directly supported in CloudKit, so we have converted `UIImage` into `CKAsset`.\n"),s("h3",{attrs:{id:"accessing-the-container"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#accessing-the-container"}},[t._v("#")]),t._v(" Accessing the container")]),t._v(" "),s("h3",{attrs:{id:"swift-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#swift-3"}},[t._v("#")]),t._v(" Swift")]),t._v(" "),s("div",{staticClass:"language-swift extra-class"},[s("pre",{pre:!0,attrs:{class:"language-swift"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" container "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CKContainer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("defaultContainer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" database "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" container"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("privateCloudDatabase "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// or container.publicCloudDatabase")]),t._v("\n\n")])])]),s("h3",{attrs:{id:"saving-the-records-to-cloudkit-database"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#saving-the-records-to-cloudkit-database"}},[t._v("#")]),t._v(" Saving the records to CloudKit database")]),t._v(" "),s("h3",{attrs:{id:"swift-4"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#swift-4"}},[t._v("#")]),t._v(" Swift")]),t._v(" "),s("div",{staticClass:"language-swift extra-class"},[s("pre",{pre:!0,attrs:{class:"language-swift"}},[s("code",[t._v("database"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("saveRecord")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("record"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" completionHandler"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token omit keyword"}},[t._v("_")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("error "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("??")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-literal"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])])]),s("h4",{attrs:{id:"remarks"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#remarks"}},[t._v("#")]),t._v(" Remarks")]),t._v(" "),s("h3",{attrs:{id:"supported-types"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#supported-types"}},[t._v("#")]),t._v(" Supported Types")]),t._v(" "),s("ul",[s("li",[t._v("NSData")]),t._v(" "),s("li",[t._v("NSDate (Date)")]),t._v(" "),s("li",[t._v("NSNumber (Int / Double)")]),t._v(" "),s("li",[t._v("NSString (String)")]),t._v(" "),s("li",[t._v("NSArray (Array)")]),t._v(" "),s("li",[t._v("CLLocation")]),t._v(" "),s("li",[t._v("CKReference")]),t._v(" "),s("li",[t._v("CKAsset")])]),t._v(" "),s("p",[s("a",{attrs:{href:"http://developer.apple.com/cloudkit",target:"_blank",rel:"noopener noreferrer"}},[t._v("More Details"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://icloud.developer.apple.com/dashboard/",target:"_blank",rel:"noopener noreferrer"}},[t._v("CloudKit Dashboard"),s("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=r.exports}}]);