(window.webpackJsonp=window.webpackJsonp||[]).push([[3192],{3600:function(t,s,e){"use strict";e.r(s);var a=e(31),n=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"user-authentication-in-rails"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#user-authentication-in-rails"}},[t._v("#")]),t._v(" User Authentication in Rails")]),t._v(" "),e("p",[t._v("Devise is a very powerful gem, it allows you to sign up, sign in and sign out options just after installing. Moreover user can add authentications and restrictions to its applications. Devise also come with its own views, if user wants to use. A user can also customize sign up and sign in forms according to its need and requirement.\nIt should be noted that Devise recommends that you implement your own login if you're new to rails.")]),t._v(" "),e("h2",{attrs:{id:"authentication-using-devise"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#authentication-using-devise"}},[t._v("#")]),t._v(" Authentication using Devise")]),t._v(" "),e("p",[t._v("Add gem to the Gemfile:")]),t._v(" "),e("p",[e("code",[t._v("gem 'devise'")])]),t._v(" "),e("p",[t._v("Then run the "),e("code",[t._v("bundle install")]),t._v(" command.")]),t._v(" "),e("p",[t._v("Use command "),e("code",[t._v("$ rails generate devise:install")]),t._v(" to generate required configuration file.")]),t._v(" "),e("p",[t._v("Set up the default URL options for the Devise mailer in each environment\nIn development environment add this line:")]),t._v(" "),e("div",{staticClass:"language-ruby extra-class"},[e("pre",{pre:!0,attrs:{class:"language-ruby"}},[e("code",[t._v("config"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("action_mailer"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("default_url_options "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" host"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'localhost'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" port"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),e("p",[t._v("to your "),e("code",[t._v("config/environments/development.rb")])]),t._v(" "),e("p",[t._v("similarly in production this edit "),e("code",[t._v("config/environments/production.rb")]),t._v(" file and add")]),t._v(" "),e("div",{staticClass:"language-ruby extra-class"},[e("pre",{pre:!0,attrs:{class:"language-ruby"}},[e("code",[t._v("config"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("action_mailer"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("default_url_options "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" host"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'your-site-url'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),e("p",[t._v("Then create a model using:"),e("code",[t._v("$ rails generate devise USER")]),t._v("\nWhere "),e("code",[t._v("USER")]),t._v(" is the class name for which you want to implement authentication.")]),t._v(" "),e("p",[t._v("Finally, run: "),e("code",[t._v("rake db:migrate")]),t._v(" and you are all set.")]),t._v(" "),e("h3",{attrs:{id:"custom-views"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#custom-views"}},[t._v("#")]),t._v(" Custom views")]),t._v(" "),e("p",[t._v("If you need to configure your views, you can use the "),e("code",[t._v("rails generate devise:views")]),t._v(" generator that will copy all views to your application. Then you can edit them as desired.")]),t._v(" "),e("p",[t._v("If you have more than one Devise model in your application (for example User and Admin), you will notice that Devise uses the same views for all models. Devise offers an easy way to customize views. Set "),e("code",[t._v("config.scoped_views = true")]),t._v(" inside the "),e("code",[t._v("config/initializers/devise.rb")]),t._v(" file.")]),t._v(" "),e("p",[t._v("You can also use the generator to create scoped views: "),e("code",[t._v("rails generate devise:views users")])]),t._v(" "),e("p",[t._v("If you would like to generate only a few sets of views, such as the ones for the registerable and confirmable module use the -v flag: "),e("code",[t._v("rails generate devise:views -v registrations confirmations")])]),t._v(" "),e("h2",{attrs:{id:"devise-controller-filters-helpers"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#devise-controller-filters-helpers"}},[t._v("#")]),t._v(" Devise Controller Filters & Helpers")]),t._v(" "),e("p",[t._v("To set up a controller with user authentication using devise, add this before_action: (assuming your devise model is 'User'):")]),t._v(" "),e("p",[e("code",[t._v("before_action :authenticate_user!")])]),t._v(" "),e("p",[t._v("To verify if a user is signed in, use the following helper:")]),t._v(" "),e("p",[e("code",[t._v("user_signed_in?")])]),t._v(" "),e("p",[t._v("For the current signed-in user, use this helper:")]),t._v(" "),e("p",[e("code",[t._v("current_user")])]),t._v(" "),e("p",[t._v("You can access the session for this scope:")]),t._v(" "),e("p",[e("code",[t._v("user_session")])]),t._v(" "),e("ul",[e("li",[t._v("Note that if your Devise model is called "),e("code",[t._v("Member")]),t._v(" instead of "),e("code",[t._v("User")]),t._v(", replace "),e("code",[t._v("user")]),t._v(" above with "),e("code",[t._v("member")])])]),t._v(" "),e("h2",{attrs:{id:"omniauth"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#omniauth"}},[t._v("#")]),t._v(" Omniauth")]),t._v(" "),e("p",[t._v("First choose your auth strategy and add it to your "),e("code",[t._v("Gemfile")]),t._v(". You can find a list of strategies here: "),e("a",{attrs:{href:"https://github.com/intridea/omniauth/wiki/List-of-Strategies",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/intridea/omniauth/wiki/List-of-Strategies"),e("OutboundLink")],1)]),t._v(" "),e("div",{staticClass:"language-ruby extra-class"},[e("pre",{pre:!0,attrs:{class:"language-ruby"}},[e("code",[t._v("gem "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'omniauth-github'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":github")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'intridea/omniauth-github'")]),t._v("\ngem "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'omniauth-openid'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":github")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'intridea/omniauth-openid'")]),t._v("\n\n")])])]),e("p",[t._v("You can add this to your rails middleware like so:")]),t._v(" "),e("div",{staticClass:"language-ruby extra-class"},[e("pre",{pre:!0,attrs:{class:"language-ruby"}},[e("code",[e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Rails")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("application"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("middleware"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("use "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("OmniAuth")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Builder")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("require")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'openid/store/filesystem'")]),t._v(" \n  provider "),e("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":github")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ENV")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'GITHUB_KEY'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ENV")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'GITHUB_SECRET'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  provider "),e("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":openid")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":store")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("OpenID")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Store")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Filesystem")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/tmp'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n")])])]),e("p",[t._v("By default, OmniAuth will add "),e("code",[t._v("/auth/:provider")]),t._v(" to your routes and you can start by using these paths.")]),t._v(" "),e("p",[t._v("By default, if there is a failure, omniauth will redirect to "),e("code",[t._v("/auth/failure")])]),t._v(" "),e("h2",{attrs:{id:"has-secure-password"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#has-secure-password"}},[t._v("#")]),t._v(" has_secure_password")]),t._v(" "),e("h3",{attrs:{id:"create-user-model"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#create-user-model"}},[t._v("#")]),t._v(" Create User Model")]),t._v(" "),e("p",[e("code",[t._v("rails generate model User email:string password_digest:string")])]),t._v(" "),e("h3",{attrs:{id:"add-has-secure-password-module-to-user-model"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#add-has-secure-password-module-to-user-model"}},[t._v("#")]),t._v(" Add has_secure_password module to User model")]),t._v(" "),e("div",{staticClass:"language-ruby extra-class"},[e("pre",{pre:!0,attrs:{class:"language-ruby"}},[e("code",[t._v("user "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("User")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" email"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'bob@bob.com'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" password"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Password1'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" password_confirmation"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Password1'")]),t._v("\n\n")])])]),e("p",[t._v("Verify password with authenticate method")]),t._v(" "),e("div",{staticClass:"language-ruby extra-class"},[e("pre",{pre:!0,attrs:{class:"language-ruby"}},[e("code",[t._v("user"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("authenticate"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'somepassword'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  \n\n")])])]),e("h2",{attrs:{id:"has-secure-token"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#has-secure-token"}},[t._v("#")]),t._v(" has_secure_token")]),t._v(" "),e("p",[t._v("Create User Model")]),t._v(" "),e("div",{staticClass:"language-ruby extra-class"},[e("pre",{pre:!0,attrs:{class:"language-ruby"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Schema: User(token:string, auth_token:string)")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ActiveRecord")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Base")]),t._v("\n  has_secure_token\n  has_secure_token "),e("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":auth_token")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n")])])]),e("p",[t._v("Now when you create a new user a token and auth_token are automatically generated")]),t._v(" "),e("div",{staticClass:"language-ruby extra-class"},[e("pre",{pre:!0,attrs:{class:"language-ruby"}},[e("code",[t._v("user "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("User")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v("\nuser"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("save\nuser"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("token "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# => "pX27zsMN2ViQKta1bGfLmVJE"')]),t._v("\nuser"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("auth_token "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# => "77TMHrHJFvFDwodq8w7Ev2m7"')]),t._v("\n\n")])])]),e("p",[t._v("You can update the tokens using "),e("code",[t._v("regenerate_token")]),t._v(" and "),e("code",[t._v("regenerate_auth_token")])]),t._v(" "),e("div",{staticClass:"language-ruby extra-class"},[e("pre",{pre:!0,attrs:{class:"language-ruby"}},[e("code",[t._v("user"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("regenerate_token "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# => true")]),t._v("\nuser"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("regenerate_auth_token "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# => true")]),t._v("\n\n")])])]),e("h4",{attrs:{id:"remarks"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#remarks"}},[t._v("#")]),t._v(" Remarks")]),t._v(" "),e("p",[t._v("At the time of generating devise configs using "),e("code",[t._v("rails generate devise:install")]),t._v(", devise will list out bunch of instructions on the terminal to follow.")]),t._v(" "),e("p",[t._v("If you already have a "),e("code",[t._v("USER")]),t._v(" model, running this command "),e("code",[t._v("rails generate devise USER")]),t._v(" will append necessary columns to your existing "),e("code",[t._v("USER")]),t._v(" model.")]),t._v(" "),e("p",[t._v("Use this helper method "),e("code",[t._v("before_action :authenticate_user!")]),t._v(" at the top of your controller to check whether "),e("code",[t._v("user")]),t._v(" is logged-in or not. if not then they will be redirected to sign-in page.")])])}),[],!1,null,null,null);s.default=n.exports}}]);