(window.webpackJsonp=window.webpackJsonp||[]).push([[250],{658:function(t,e,a){"use strict";a.r(e);var s=a(31),n=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"multidex-and-the-dex-method-limit"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#multidex-and-the-dex-method-limit"}},[t._v("#")]),t._v(" Multidex and the Dex Method Limit")]),t._v(" "),a("p",[t._v("DEX means Android app's (APK) executable bytecode files in the form of Dalvik Executable (DEX) files, which contain the compiled code used to run your app.")]),t._v(" "),a("p",[t._v("The Dalvik Executable specification limits the total number of methods that can be referenced within a single DEX file to 65,536 (64K)â€”including Android framework methods, library methods, and methods in your own code.")]),t._v(" "),a("p",[t._v("To overcome this limit requires configure your app build process to generate more than one DEX file, known as a Multidex.")]),t._v(" "),a("h2",{attrs:{id:"enabling-multidex"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#enabling-multidex"}},[t._v("#")]),t._v(" Enabling Multidex")]),t._v(" "),a("p",[t._v("In order to enable a multidex configuration you need:")]),t._v(" "),a("ul",[a("li",[t._v("to change your Gradle build configuration")]),t._v(" "),a("li",[t._v("to use a "),a("code",[t._v("MultiDexApplication")]),t._v(" or enable the MultiDex in your "),a("code",[t._v("Application")]),t._v(" class")])]),t._v(" "),a("h3",{attrs:{id:"gradle-configuration"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gradle-configuration"}},[t._v("#")]),t._v(" Gradle configuration")]),t._v(" "),a("p",[t._v("In "),a("code",[t._v("app/build.gradle")]),t._v(" add these parts:")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("android "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    compileSdkVersion "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),t._v("\n    buildToolsVersion "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"24.0.1"')]),t._v("\n\n    defaultConfig "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n        minSdkVersion "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v("\n        targetSdkVersion "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Enabling multidex support.")]),t._v("\n        multiDexEnabled "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\ndependencies "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  compile "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'com.android.support:multidex:1.0.1'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),a("h3",{attrs:{id:"enable-multidex-in-your-application"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#enable-multidex-in-your-application"}},[t._v("#")]),t._v(" Enable MultiDex in your Application")]),t._v(" "),a("p",[t._v("Then proceed with one of three options:")]),t._v(" "),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"http://stackoverflow.com/documentation/android/1887/multidex-and-the-dex-method-limit/6003/multidex-by-extending-application#t=20160807053003773542",target:"_blank",rel:"noopener noreferrer"}},[t._v("Multidex by extending Application"),a("OutboundLink")],1)])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"http://stackoverflow.com/documentation/android/1887/multidex-and-the-dex-method-limit/18691/multidex-by-extending-multidexapplication#t=20160807053003773542",target:"_blank",rel:"noopener noreferrer"}},[t._v("Multidex by extending MultiDexApplication"),a("OutboundLink")],1)])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"http://stackoverflow.com/documentation/android/1887/multidex-and-the-dex-method-limit/6002/multidex-by-using-multidexapplication-directly#t=20160807053003773542",target:"_blank",rel:"noopener noreferrer"}},[t._v("Multidex by using MultiDexApplication directly"),a("OutboundLink")],1)])])]),t._v(" "),a("p",[t._v("When these configuration settings are added to an app, the Android build tools construct a primary dex (classes.dex) and supporting (classes2.dex, classes3.dex) as needed."),a("br"),t._v("\nThe build system will then package them into an APK file for distribution.")]),t._v(" "),a("h2",{attrs:{id:"multidex-by-extending-application"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#multidex-by-extending-application"}},[t._v("#")]),t._v(" Multidex by extending Application")]),t._v(" "),a("p",[t._v("Use this option if your project requires an "),a("code",[t._v("Application")]),t._v(" subclass.")]),t._v(" "),a("p",[t._v("Specify this "),a("code",[t._v("Application")]),t._v(" subclass using the "),a("code",[t._v("android:name")]),t._v(" property in the manifest file inside the "),a("code",[t._v("application")]),t._v(" tag.")]),t._v(" "),a("p",[t._v("In the "),a("code",[t._v("Application")]),t._v(" subclass, add the "),a("code",[t._v("attachBaseContext()")]),t._v(" method override, and in that method call "),a("code",[t._v("MultiDex.install()")]),t._v(":")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("example")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("android"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Application")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("android"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("content"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Context")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * Extended application that support multidex \n */")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyApplication")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Application")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("protected")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("attachBaseContext")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Context")]),t._v(" base"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("attachBaseContext")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("base"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MultiDex")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),a("p",[t._v("Ensure that the "),a("code",[t._v("Application")]),t._v(" subclass is specified in the "),a("code",[t._v("application")]),t._v(" tag of your AndroidManifest.xml:")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("application\n    android"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"com.example.MyApplication"')]),t._v("\n    android"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("icon"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@drawable/ic_launcher"')]),t._v("\n    android"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("label"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@string/app_name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("application"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n")])])]),a("h2",{attrs:{id:"multidex-by-extending-multidexapplication"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#multidex-by-extending-multidexapplication"}},[t._v("#")]),t._v(" Multidex by extending MultiDexApplication")]),t._v(" "),a("p",[t._v("This is very similar to using an "),a("code",[t._v("Application")]),t._v(" subclass and overriding the "),a("code",[t._v("attachBaseContext()")]),t._v(" method.")]),t._v(" "),a("p",[t._v("However, using this method, you don't need to override "),a("code",[t._v("attachBaseContext()")]),t._v(" as this is already done in the "),a("code",[t._v("MultiDexApplication")]),t._v(" superclass.")]),t._v(" "),a("p",[t._v("Extend "),a("code",[t._v("MultiDexApplication")]),t._v(" instead of "),a("code",[t._v("Application")]),t._v(":")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("example")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("android"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("support"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("multidex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MultiDexApplication")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("android"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("content"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Context")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * Extended MultiDexApplication \n */")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyApplication")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MultiDexApplication")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// No need to override attachBaseContext()")]),t._v("\n\n     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//..........")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),a("p",[t._v("Add this class to your AndroidManifest.xml exactly as if you were extending Application:")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("application\n    android"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"com.example.MyApplication"')]),t._v("\n    android"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("icon"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@drawable/ic_launcher"')]),t._v("\n    android"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("label"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@string/app_name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("application"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n")])])]),a("h2",{attrs:{id:"multidex-by-using-multidexapplication-directly"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#multidex-by-using-multidexapplication-directly"}},[t._v("#")]),t._v(" Multidex by using MultiDexApplication directly")]),t._v(" "),a("p",[t._v("Use this option if you don't need an "),a("code",[t._v("Application")]),t._v(" subclass.")]),t._v(" "),a("p",[t._v("This is the simplest option, but this way you can't provide your own "),a("code",[t._v("Application")]),t._v(" subclass.  If an "),a("code",[t._v("Application")]),t._v(" subclass is needed, you will have to switch to one of the other options to do so.")]),t._v(" "),a("p",[t._v("For this option, simply specify the fully-qualified class name "),a("code",[t._v("android.support.multidex.MultiDexApplication")]),t._v(" for the "),a("code",[t._v("android:name")]),t._v(" property of the "),a("code",[t._v("application")]),t._v(" tag in the AndroidManifest.xml:")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v("xml version"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.0"')]),t._v(" encoding"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"utf-8"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("manifest xmlns"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("android"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://schemas.android.com/apk/res/android"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"com.example.android.multidex.myapplication"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("application\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n        android"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"android.support.multidex.MultiDexApplication"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("application"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("manifest"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n")])])]),a("h2",{attrs:{id:"counting-method-references-on-every-build-dexcount-gradle-plugin"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#counting-method-references-on-every-build-dexcount-gradle-plugin"}},[t._v("#")]),t._v(" Counting Method References On Every Build (Dexcount Gradle Plugin)")]),t._v(" "),a("p",[t._v("The "),a("a",{attrs:{href:"https://github.com/KeepSafe/dexcount-gradle-plugin",target:"_blank",rel:"noopener noreferrer"}},[t._v("dexcount plugin"),a("OutboundLink")],1),t._v(" counts methods and class resource count after a successful build.")]),t._v(" "),a("p",[t._v("Add the plugin in the "),a("code",[t._v("app/build.gradle")]),t._v(":")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("apply plugin"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'com.android.application'")]),t._v("\n\nbuildscript "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    repositories "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mavenCentral")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// or jcenter()")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    dependencies "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        classpath "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'com.getkeepsafe.dexcount:dexcount-gradle-plugin:0.5.5'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),a("p",[t._v("Apply the plugin in the "),a("code",[t._v("app/build.gradle")]),t._v(" file:")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("apply plugin"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'com.getkeepsafe.dexcount'")]),t._v("\n\n")])])]),a("p",[t._v("Look for the output data generated by the plugin in:")]),t._v(" "),a("p",[a("strong",[t._v("../app/build/outputs/dexcount")])]),t._v(" "),a("p",[t._v("Especially useful is the .html chart in:")]),t._v(" "),a("p",[a("strong",[t._v("../app/build/outputs/dexcount/debugChart/index.html")])]),t._v(" "),a("h4",{attrs:{id:"remarks"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#remarks"}},[t._v("#")]),t._v(" Remarks")]),t._v(" "),a("h3",{attrs:{id:"what-is-dex"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#what-is-dex"}},[t._v("#")]),t._v(" What is dex?")]),t._v(" "),a("p",[t._v("Dex is the name of the file format and encoding to which Android Java code is compiled.  Early versions of Android would load and execute "),a("code",[t._v("dex")]),t._v(" binaries directly in a virtual machine named Dalvik.  More recent versions of Android use the Android Runtime (ART), which treats "),a("code",[t._v("dex")]),t._v(" files as an intermediate representation and performs further compilations on it prior to running the application.")]),t._v(" "),a("p",[t._v("Dex is a very old file format, in terms of the lifespan of smartphones, and was designed for devices whose main memory was measured in tens of megabytes.  The design limitations of those days have remained with us to this day.")]),t._v(" "),a("h3",{attrs:{id:"the-problem"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#the-problem"}},[t._v("#")]),t._v(" The problem:")]),t._v(" "),a("p",[t._v("The "),a("code",[t._v("dex")]),t._v(" file format encodes a limit to the number of methods that can be referenced in a single binary.  Because the portion of the file format that stores the number of references is two bytes long, the maximum number of method references is "),a("code",[t._v("0xFFFF")]),t._v(", or 65535.  If an application contains more than that number of method references, it will fail to compile.")]),t._v(" "),a("h3",{attrs:{id:"what-to-do-about-it"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#what-to-do-about-it"}},[t._v("#")]),t._v(" What to do about it:")]),t._v(" "),a("p",[t._v("Google has provided a way around this problem, called Multidex. It has compile-time and run-time components.  As its name implies, at compile-time it will divide code between one or more "),a("code",[t._v("dex")]),t._v(" files.  At runtime, it will teach the default "),a("code",[t._v("ClassLoader")]),t._v(" how to look up classes from these files.")]),t._v(" "),a("p",[t._v("This approach works well on newer devices, but has some substantial drawbacks.  It can increase application startup time dramatically, and on older devices can cause "),a("code",[t._v("Application Not Responding")]),t._v(" failures.")]),t._v(" "),a("p",[t._v("Multidex, while effective, should be avoided if possible.")]),t._v(" "),a("h3",{attrs:{id:"how-to-avoid-the-limit"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#how-to-avoid-the-limit"}},[t._v("#")]),t._v(" How to avoid the limit:")]),t._v(" "),a("p",[t._v("Before configuring your app to enable use of 64K or more method references, you should take steps to reduce the total number of references called by your app code, including methods defined by your app code or included libraries. The following strategies can help you avoid hitting the dex reference limit:")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("Review your app's direct and transitive dependencies")]),t._v(" - Ensure any large library dependency you include in your app is used in a manner that outweighs the amount of code being added to the application. A common anti-pattern is to include a very large library because a few utility methods were useful. Reducing your app code dependencies can often help you avoid the dex reference limit.")]),t._v(" "),a("li",[a("strong",[t._v("Remove unused code with ProGuard")]),t._v(" - Configure the "),a("a",{attrs:{href:"http://stackoverflow.com/documentation/android-gradle/5257/shrink-code-and-resources#t=20160916064154250555",target:"_blank",rel:"noopener noreferrer"}},[t._v("ProGuard settings"),a("OutboundLink")],1),t._v(" for your app to run ProGuard and ensure you have shrinking enabled for release builds. Enabling shrinking ensures you are not shipping unused code with your APKs.")])]),t._v(" "),a("p",[t._v("The first point requires diligence and discipline on the part of the developer.  When incorporating third-party libraries, one must consider the size of the library.  For example, two popular JSON libraries are Jackson and Gson.  Functionally they are quite similar, but Gson tends to see greater use in Android.  One reason is that Jackson weighs in around 9,000 methods, whereas Gson contributes 1,900.")]),t._v(" "),a("p",[t._v("There are several tools available to help developers keep track of the size of their application:")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/keepsafe/dexcount-gradle-plugin",target:"_blank",rel:"noopener noreferrer"}},[t._v("dexcount-gradle-plugin"),a("OutboundLink")],1),t._v(" reports the number of method references in your APK or AAR on each build")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/mihaip/dex-method-counts",target:"_blank",rel:"noopener noreferrer"}},[t._v("dex-method-counts"),a("OutboundLink")],1),t._v(" is a commandline tool that counts the number of method references in an APK")]),t._v(" "),a("li",[a("a",{attrs:{href:"http://www.methodscount.com",target:"_blank",rel:"noopener noreferrer"}},[t._v("www.methodscount.com"),a("OutboundLink")],1),t._v(" is a web service which will count the method references in any APK that you upload.")])])])}),[],!1,null,null,null);e.default=n.exports}}]);