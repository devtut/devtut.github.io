(window.webpackJsonp=window.webpackJsonp||[]).push([[2149],{2557:function(s,t,a){"use strict";a.r(t);var e=a(31),r=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"ssl-connection-setup"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ssl-connection-setup"}},[s._v("#")]),s._v(" SSL Connection Setup")]),s._v(" "),a("h2",{attrs:{id:"setup-for-debian-based-systems"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#setup-for-debian-based-systems"}},[s._v("#")]),s._v(" Setup for Debian-based systems")]),s._v(" "),a("p",[s._v("(This assumes MySQL has been installed and that "),a("code",[s._v("sudo")]),s._v(" is being used.)")]),s._v(" "),a("h3",{attrs:{id:"generating-a-ca-and-ssl-keys"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#generating-a-ca-and-ssl-keys"}},[s._v("#")]),s._v(" Generating a CA and SSL keys")]),s._v(" "),a("p",[s._v("Make sure OpenSSL and libraries are installed:")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("apt"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("get "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("y install openssl\napt"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("get "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("y install libssl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dev\n\n")])])]),a("p",[s._v("Next make and enter a directory for the SSL files:")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mkdir "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("home"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ubuntu"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysqlcerts\ncd "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("home"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ubuntu"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysqlcerts\n\n")])])]),a("p",[s._v("To generate keys, create a certificate authority (CA) to sign the keys (self-signed):")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("openssl genrsa "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ca"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem\nopenssl req "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("new "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("x509 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nodes "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("days "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3600")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),s._v(" ca"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("out")]),s._v(" ca"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem\n\n")])])]),a("p",[s._v("The values entered at each prompt won't affect the configuration. Next create a key for the server, and sign using the CA from before:")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("openssl req "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("newkey rsa:"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("days "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3600")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nodes "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("keyout server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("out")]),s._v(" server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem\nopenssl rsa "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("out")]),s._v(" server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem\n\nopenssl x509 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("req "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("days "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3600")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("CA ca"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("CAkey ca"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("set_serial "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("out")]),s._v(" server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cert"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem\n\n")])])]),a("p",[s._v("Then create a key for a client:")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("openssl req "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("newkey rsa:"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("days "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3600")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nodes "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("keyout client"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("out")]),s._v(" client"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem\nopenssl rsa "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" client"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("out")]),s._v(" client"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem\nopenssl x509 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("req "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" client"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("days "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3600")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("CA ca"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("CAkey ca"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("set_serial "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("out")]),s._v(" client"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cert"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem\n\n")])])]),a("p",[s._v("To make sure everything was set up correctly, verify the keys:")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("openssl verify "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("CAfile ca"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cert"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem client"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cert"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem\n\n")])])]),a("h3",{attrs:{id:"adding-the-keys-to-mysql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#adding-the-keys-to-mysql"}},[s._v("#")]),s._v(" Adding the keys to MySQL")]),s._v(" "),a("p",[s._v("Open the "),a("a",{attrs:{href:"http://stackoverflow.com/documentation/mysql/3134/configuration-and-tuning/25294/minimal-innodb-configuration#t=201611070613476171669",target:"_blank",rel:"noopener noreferrer"}},[s._v("MySQL configuration file"),a("OutboundLink")],1),s._v(". For example:")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("vim "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysqld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cnf\n\n")])])]),a("p",[s._v("Under the "),a("code",[s._v("[mysqld]")]),s._v(" section, add the following options:")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("ssl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ca "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("home"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ubuntu"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysqlcerts"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ca"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem\nssl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cert "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("home"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ubuntu"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysqlcerts"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cert"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem\nssl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("home"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ubuntu"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysqlcerts"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem\n\n")])])]),a("p",[s._v("Restart MySQL. For example:")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("service mysql restart\n\n")])])]),a("h3",{attrs:{id:"test-the-ssl-connection"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#test-the-ssl-connection"}},[s._v("#")]),s._v(" Test the SSL connection")]),s._v(" "),a("p",[s._v("Connect in the same way, passing in the extra options "),a("code",[s._v("ssl-ca")]),s._v(", "),a("code",[s._v("ssl-cert")]),s._v(", and "),a("code",[s._v("ssl-key")]),s._v(", using the generated client key. For example, assuming "),a("code",[s._v("cd /home/ubuntu/mysqlcerts")]),s._v(":")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--ssl-ca=ca.pem --ssl-cert=client-cert.pem --ssl-key=client-key.pem -h 127.0.0.1 -u superman -p")]),s._v("\n\n")])])]),a("p",[s._v("After logging in, verify the connection is indeed secure:")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("superman"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@127.0.0.1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("None"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" VARIABLES "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("LIKE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%ssl%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("---------------+-----------------------------------------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Value")]),s._v("                                   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("---------------+-----------------------------------------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" have_openssl  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" YES                                     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" have_ssl      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" YES                                     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ssl_ca        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("home"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ubuntu"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysqlcerts"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ca"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem          "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ssl_capath    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                                         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ssl_cert      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("home"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ubuntu"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysqlcerts"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cert"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ssl_cipher    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                                         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ssl_crl       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                                         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ssl_crlpath   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                                         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ssl_key       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("home"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ubuntu"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysqlcerts"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("---------------+-----------------------------------------+")]),s._v("\n\n")])])]),a("p",[s._v("You could also check:")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("superman"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@127.0.0.1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("None"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("STATUS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\nSSL:                    Cipher "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("is")]),s._v(" DHE"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("RSA"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("AES256"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("SHA\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n\n")])])]),a("h3",{attrs:{id:"enforcing-ssl"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#enforcing-ssl"}},[s._v("#")]),s._v(" Enforcing SSL")]),s._v(" "),a("p",[s._v("This is via "),a("code",[s._v("GRANT")]),s._v(", using "),a("code",[s._v("REQUIRE SSL")]),s._v(":")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALL")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIVILEGES")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'superman'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'127.0.0.1'")]),s._v(" IDENTIFIED "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'pass'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("REQUIRE")]),s._v(" SSL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nFLUSH "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIVILEGES")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n")])])]),a("p",[s._v("Now, "),a("code",[s._v("superman")]),s._v(" "),a("strong",[s._v("must")]),s._v(" connect via SSL.")]),s._v(" "),a("p",[s._v("If you don't want to manage client keys, use the client key from earlier and automatically use that for all clients. Open "),a("a",{attrs:{href:"http://stackoverflow.com/documentation/mysql/3134/configuration-and-tuning/25294/minimal-innodb-configuration#t=201611070613476171669",target:"_blank",rel:"noopener noreferrer"}},[s._v("MySQL configuration file"),a("OutboundLink")],1),s._v(", for example:")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("vim "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysqld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cnf\n\n")])])]),a("p",[s._v("Under the "),a("code",[s._v("[client]")]),s._v(" section, add the following options:")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("ssl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ca "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("home"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ubuntu"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysqlcerts"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ca"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem\nssl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cert "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("home"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ubuntu"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysqlcerts"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("client"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cert"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem\nssl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("home"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ubuntu"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysqlcerts"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("client"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem\n\n")])])]),a("p",[s._v("Now "),a("code",[s._v("superman")]),s._v(" only has to type the following to login via SSL:")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("h "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("u superman "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p\n\n")])])]),a("p",[s._v("Connecting from another program, for example in Python, typically only requires an additional parameter to the connect function. A Python example:")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" MySQLdb\nssl "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" {"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cert'")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/home/ubuntu/mysqlcerts/client-cert.pem'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'key'")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/home/ubuntu/mysqlcerts/client-key.pem'")]),s._v("}\nconn "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" MySQLdb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("connect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("host"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'127.0.0.1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'superman'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" passwd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'imsoawesome'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ssl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ssl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n")])])]),a("h3",{attrs:{id:"references-and-further-reading"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#references-and-further-reading"}},[s._v("#")]),s._v(" References and further reading:")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://www.percona.com/blog/2013/06/22/setting-up-mysql-ssl-and-secure-connections/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.percona.com/blog/2013/06/22/setting-up-mysql-ssl-and-secure-connections/"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://lowendbox.com/blog/getting-started-with-mysql-over-ssl/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://lowendbox.com/blog/getting-started-with-mysql-over-ssl/"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"http://xmodulo.com/enable-ssl-mysql-server-client.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://xmodulo.com/enable-ssl-mysql-server-client.html"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://ubuntuforums.org/showthread.php?t=1121458",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://ubuntuforums.org/showthread.php?t=1121458"),a("OutboundLink")],1)])]),s._v(" "),a("h2",{attrs:{id:"setup-for-centos7-rhel7"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#setup-for-centos7-rhel7"}},[s._v("#")]),s._v(" Setup for CentOS7 / RHEL7")]),s._v(" "),a("p",[s._v("This example assumes two servers:")]),s._v(" "),a("ol",[a("li",[s._v("dbserver  (where our database lives)")]),s._v(" "),a("li",[s._v("appclient    (where our applications live)")])]),s._v(" "),a("p",[a("strong",[s._v("FWIW, both servers are SELinux enforcing.")])]),s._v(" "),a("h3",{attrs:{id:"first-log-on-to-dbserver"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#first-log-on-to-dbserver"}},[s._v("#")]),s._v(" First, log on to dbserver")]),s._v(" "),a("p",[s._v("Create a temporary directory for creating the certificates.")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mkdir "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("certs"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" cd "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("certs"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n\n")])])]),a("p",[s._v("Create the server certificates")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("openssl genrsa "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ca"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem\nopenssl req "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("sha1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("new "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("x509 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nodes "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("days "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3650")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),s._v(" ca"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ca"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cert"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem\nopenssl req "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("sha1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("newkey rsa:"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("days "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("730")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nodes "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("keyout server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem\nopenssl rsa "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("out")]),s._v(" server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem\nopenssl x509 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("sha1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("req "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("days "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("730")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("CA ca"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cert"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("CAkey ca"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("set_serial "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cert"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem\n\n")])])]),a("p",[s._v("Move server certificates to /etc/pki/tls/certs/mysql/")]),s._v(" "),a("p",[s._v("Directory path assumes CentOS or RHEL (adjust as needed for other distros):")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mkdir "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pki"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tls"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("certs"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n\n")])])]),a("p",[s._v("Be sure to set permissions on the folder and files.  mysql needs full ownership and access.")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("chown "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("R mysql:mysql "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pki"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tls"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("certs"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql\n\n")])])]),a("p",[s._v("Now configure MySQL/MariaDB")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vi /etc/my.cnf")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# i")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nbind"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("address"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\nssl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ca"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pki"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tls"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("certs"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ca"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cert"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem\nssl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cert"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pki"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tls"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("certs"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cert"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem\nssl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pki"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tls"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("certs"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# :wq ")]),s._v("\n\n")])])]),a("p",[s._v("Then")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("systemctl restart mariadb\n\n")])])]),a("p",[s._v("Don't forget to open your firewall to allow connections from appclient (using IP 1.2.3.4)")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("firewall"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cmd "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('--zone=drop --permanent --add-rich-rule \'rule family="ipv4" source address="1.2.3.4" service name="mysql" accept\'')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# I force everything to the drop zone.  Season the above command to taste.")]),s._v("\n\n")])])]),a("p",[s._v("Now restart firewalld")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("service firewalld restart\n\n")])])]),a("p",[s._v("Next, log in to dbserver's mysql server:")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("uroot "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p \n\n")])])]),a("p",[s._v("Issue the following to create a user for the client.  note REQUIRE SSL in GRANT statement.")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALL")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIVILEGES")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" ‘iamsecure’@’appclient’ IDENTIFIED "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" ‘dingdingding’ "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("REQUIRE")]),s._v(" SSL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nFLUSH "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIVILEGES")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# quit mysql")]),s._v("\n\n")])])]),a("p",[s._v("You should still be in /root/certs/mysql from the first step. If not, cd back to it for one of the commands below.")]),s._v(" "),a("p",[s._v("Create the client certificates")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("openssl req "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("sha1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("newkey rsa:"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("days "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("730")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nodes "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("keyout client"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" client"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem\nopenssl rsa "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" client"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("out")]),s._v(" client"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem\nopenssl x509 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("sha1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("req "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" client"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("days "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("730")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("CA ca"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cert"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("CAkey ca"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("set_serial "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" client"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cert"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem\n\n")])])]),a("p",[a("strong",[s._v("Note")]),s._v(": I used the same common name for both server and client certificates. YMMV.")]),s._v(" "),a("p",[a("strong",[s._v("Be sure you're still /root/certs/mysql/ for this next command")])]),s._v(" "),a("p",[s._v("Combine server and client CA certificate into a single file:")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("cat server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cert"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem client"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cert"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ca"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem\n\n")])])]),a("p",[s._v("Make sure you see two certificates:")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("cat ca"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem \n\n")])])]),a("h3",{attrs:{id:"end-of-server-side-work-for-now"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#end-of-server-side-work-for-now"}},[s._v("#")]),s._v(" END OF SERVER SIDE WORK FOR NOW.")]),s._v(" "),a("p",[s._v("Open another terminal and")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("ssh appclient\n\n")])])]),a("p",[s._v("As before, create a permanent home for the client certificates")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mkdir "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pki"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tls"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("certs"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n\n")])])]),a("p",[s._v("Now, place the client certificates (created on dbserver) on appclient.\nYou can either scp them over, or just copy and paste the files one by one.")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("scp dbserver\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# copy files from dbserver to appclient")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# exit scp")]),s._v("\n\n")])])]),a("p",[s._v("Again, be sure to set permissions on the folder and files.  mysql needs full ownership and access.")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("chown "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("R mysql:mysql "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pki"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tls"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("certs"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql\n\n")])])]),a("p",[s._v("You should have three files, each owned by user mysql:")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pki"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tls"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("certs"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ca"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pki"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tls"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("certs"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("client"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cert"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pki"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tls"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("certs"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("client"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem\n\n")])])]),a("p",[s._v("Now edit appclient's MariaDB/MySQL config in the "),a("code",[s._v("[client]")]),s._v(" section.")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("vi "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cnf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# i")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nssl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ca"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pki"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tls"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("certs"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ca"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem\nssl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cert"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pki"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tls"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("certs"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("client"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cert"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem\nssl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pki"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tls"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("certs"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("client"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# :wq ")]),s._v("\n\n")])])]),a("p",[s._v("Restart appclient's mariadb service:")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("systemctl restart mariadb\n\n")])])]),a("h3",{attrs:{id:"still-on-the-client-here"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#still-on-the-client-here"}},[s._v("#")]),s._v(" still on the client here")]),s._v(" "),a("p",[s._v("This should return: ssl TRUE")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--ssl --help")]),s._v("\n\n")])])]),a("p",[s._v("Now, log in to appclient's mysql instance")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("uroot "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p\n\n")])])]),a("p",[s._v("Should see YES to both variables below")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" variables "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("LIKE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%ssl'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    have_openssl    YES\n    have_ssl              YES\n\n")])])]),a("p",[s._v("Initially I saw")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("\nhave_openssl NO\n\n")])])]),a("p",[s._v("A quick look into mariadb.log revealed:")]),s._v(" "),a("blockquote"),s._v(" "),a("p",[s._v("SSL error: Unable to get certificate from\n'/etc/pki/tls/certs/mysql/client-cert.pem'")]),s._v(" "),a("p",[s._v("The problem was that root owned client-cert.pem and the containing folder.\nThe solution was to set ownership of /etc/pki/tls/certs/mysql/ to mysql.")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("chown "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("R mysql:mysql "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pki"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tls"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("certs"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql\n\n")])])]),a("p",[s._v("Restart mariadb if needed from the step immediately above")]),s._v(" "),a("h3",{attrs:{id:"now-we-are-ready-to-test-the-secure-connection"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#now-we-are-ready-to-test-the-secure-connection"}},[s._v("#")]),s._v(" NOW WE ARE READY TO TEST THE SECURE CONNECTION")]),s._v(" "),a("h3",{attrs:{id:"we-re-still-on-appclient-here"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#we-re-still-on-appclient-here"}},[s._v("#")]),s._v(" We're still on appclient here")]),s._v(" "),a("p",[s._v("Attempt to connect to dbserver's mysql instance using the account created above.")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("h dbserver "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("u iamsecure "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# enter password dingdingding (hopefully you changed that to something else)")]),s._v("\n\n")])])]),a("p",[s._v("With a little luck you should be logged in without error.")]),s._v(" "),a("p",[s._v("To confirm you are connected with SSL enabled, issue the following command from the MariaDB/MySQL prompt:")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("\\s \n\n")])])]),a("p",[a("strong",[s._v("That's a backslash s, aka status")])]),s._v(" "),a("p",[s._v("That will show the status of your connection, which should look something like this:")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("Connection id:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Current")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("database")]),s._v(":    \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Current")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(":        iamsecure"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@appclient")]),s._v("\nSSL:            Cipher "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("is")]),s._v(" DHE"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("RSA"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("AES256"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("GCM"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("SHA384\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Current")]),s._v(" pager:        stdout\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Using")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("outfile")]),s._v(":        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Using")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("delimiter")]),s._v(":    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nServer:            MariaDB\nServer version:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.")]),s._v("X"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("X"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("MariaDB MariaDB Server\nProtocol version:    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\nConnection:        dbserver via TCP"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("IP\nServer characterset:    latin1\nDb     characterset:    latin1\nClient characterset:    utf8\nConn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("  characterset:    utf8\nTCP port:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("\nUptime:            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v(" min "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(" sec\n\n")])])]),a("p",[s._v("If you get permission denied errors on your connection attempt, check your GRANT statement above to make sure there aren't any stray characters or ' marks.")]),s._v(" "),a("p",[s._v("If you have SSL errors, go back through this guide to make sure the steps are orderly.")]),s._v(" "),a("p",[s._v("This worked on RHEL7 and will likely work on CentOS7, too.  Cannot confirm whether these exact steps will work elsewhere.")]),s._v(" "),a("p",[s._v("Hope this saves someone else a little time and aggravation.")])])}),[],!1,null,null,null);t.default=r.exports}}]);