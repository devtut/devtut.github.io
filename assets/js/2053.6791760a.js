(window.webpackJsonp=window.webpackJsonp||[]).push([[2053],{2461:function(s,a,t){"use strict";t.r(a);var e=t(31),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"scheduled-task-or-job"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#scheduled-task-or-job"}},[s._v("#")]),s._v(" Scheduled Task or Job")]),s._v(" "),t("h2",{attrs:{id:"create-a-scheduled-job"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#create-a-scheduled-job"}},[s._v("#")]),s._v(" Create a scheduled Job")]),s._v(" "),t("p",[t("strong",[s._v("Create a Job")])]),s._v(" "),t("li",[s._v("\nTo add a job first we have to use a stored procedure named [sp_add_job](https://msdn.microsoft.com/en-us/library/ms187358.aspx)\n"),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USE")]),s._v(" msdb "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \nGO  \n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXEC")]),s._v(" dbo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sp_add_job  \n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@job_name")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" N"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Weekly Job'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- the job name")]),s._v("\n\n")])])])]),s._v(" "),t("li",[s._v("\nThen we have to add a job step using a stored procedure named [sp_add_jobStep](https://msdn.microsoft.com/en-us/library/ms178625.aspx)\n"),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXEC")]),s._v(" sp_add_jobstep  \n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@job_name")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" N"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Weekly Job'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- Job name to add a step")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@step_name")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" N"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Set database to read only'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- step name")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@subsystem")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" N"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'TSQL'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- Step type")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@command")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" N"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ALTER DATABASE SALES SET READ_ONLY'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- Command")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@retry_attempts")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--Number of attempts")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@retry_interval")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- in minutes")]),s._v("\n\n")])])])]),s._v(" "),t("li",[s._v("\nTarget the job to a server\n"),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXEC")]),s._v(" dbo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sp_add_jobserver  \n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@job_name")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" N"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Weekly Sales Data Backup'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@server_name")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 'MyPC\\"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("data")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- Default is LOCAL")]),s._v("\nGO\n\n")])])])]),s._v(" "),t("p",[t("strong",[s._v("Create a schedule using SQL")])]),s._v(" "),t("p",[s._v("To Create a schedule we have to use a system stored procedure called "),t("a",{attrs:{href:"https://msdn.microsoft.com/en-us/library/ms187320.aspx",target:"_blank",rel:"noopener noreferrer"}},[s._v("sp_add_schedule"),t("OutboundLink")],1)]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USE")]),s._v(" msdb \nGO  \n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXEC")]),s._v(" sp_add_schedule  \n    "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@schedule_name")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" N"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'NightlyJobs'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- specify the schedule name")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@freq_type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- A value indicating when a job is to be executed (4) means Daily")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@freq_interval")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- The days that a job is executed and depends on the value of `freq_type`.")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@active_start_time")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("010000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- The time on which execution of a job can begin")]),s._v("\nGO  \n\n")])])]),t("p",[s._v("There are more parameters that can be used with "),t("code",[s._v("sp_add_schedule")]),s._v(" you can read more about in the the link provided above.")]),s._v(" "),t("p",[t("strong",[s._v("Attaching schedule to a JOB")])]),s._v(" "),t("p",[s._v("To attach a schedule to an SQL agent job you have to use a stored procedure called "),t("a",{attrs:{href:"https://msdn.microsoft.com/en-us/library/ms186766.aspx",target:"_blank",rel:"noopener noreferrer"}},[s._v("sp_attach_schedule"),t("OutboundLink")],1)]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- attaches the schedule to the job BackupDatabase  ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXEC")]),s._v(" sp_attach_schedule  \n   "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@job_name")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" N"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'BackupDatabase'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- The job name to attach with")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@schedule_name")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" N"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'NightlyJobs'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- The schedule name")]),s._v("\nGO  \n\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);