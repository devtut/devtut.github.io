(window.webpackJsonp=window.webpackJsonp||[]).push([[161],{569:function(t,a,n){"use strict";n.r(a);var s=n(31),e=Object(s.a)({},(function(){var t=this,a=t.$createElement,n=t._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"doze-mode"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#doze-mode"}},[t._v("#")]),t._v(" Doze Mode")]),t._v(" "),n("h2",{attrs:{id:"whitelisting-an-android-application-programmatically"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#whitelisting-an-android-application-programmatically"}},[t._v("#")]),t._v(" Whitelisting an Android application programmatically")]),t._v(" "),n("p",[t._v("Whitelisting won't disable the doze mode for your app, but you can do that by using network and hold-wake locks.")]),t._v(" "),n("p",[t._v("Whitelisting an Android application programmatically can be done as follows:")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" isIgnoringBatteryOptimizations "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" pm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isIgnoringBatteryOptimizations")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getPackageName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("isIgnoringBatteryOptimizations"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Intent")]),t._v(" intent "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Intent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    intent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setAction")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Settings")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ACTION_REQUEST_IGNORE_BATTERY_OPTIMIZATIONS"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    intent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setData")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Uri")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("parse")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"package:"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getPackageName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("startActivityForResult")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("intent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" MY_IGNORE_OPTIMIZATION_REQUEST"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),n("p",[t._v("The result of starting the activity above can be verfied by the following code:")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("protected")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("onActivityResult")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" requestCode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" resultCode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Intent")]),t._v(" data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("requestCode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" MY_IGNORE_OPTIMIZATION_REQUEST"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PowerManager")]),t._v(" pm "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PowerManager")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getSystemService")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Context")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("POWER_SERVICE"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" isIgnoringBatteryOptimizations "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" pm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isIgnoringBatteryOptimizations")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getPackageName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("isIgnoringBatteryOptimizations"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Ignoring battery optimization")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n           "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Not ignoring battery optimization")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),n("h2",{attrs:{id:"exclude-app-from-using-doze-mode"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#exclude-app-from-using-doze-mode"}},[t._v("#")]),t._v(" Exclude app from using doze mode")]),t._v(" "),n("ol",[n("li",[t._v("Open phone's settings")]),t._v(" "),n("li",[t._v("open battery")]),t._v(" "),n("li",[t._v('open menu and select "battery optimization"')]),t._v(" "),n("li",[t._v('from the dropdown menu select "all apps"')]),t._v(" "),n("li",[t._v("select the app you want to whitelist")]),t._v(" "),n("li",[t._v('select "don\'t optimize"')])]),t._v(" "),n("p",[t._v("Now this app will show under not optimized apps.")]),t._v(" "),n("p",[t._v("An app can check whether it's whitelisted by calling "),n("code",[t._v("isIgnoringBatteryOptimizations()")])]),t._v(" "),n("h4",{attrs:{id:"remarks"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#remarks"}},[t._v("#")]),t._v(" Remarks")]),t._v(" "),n("p",[t._v("Doze Mode is a set of changes and rules that put your phone to sleep when idle.")]),t._v(" "),n("p",[t._v("On Android 6.0 Marshmallow:\nDoze mode gets activated after a while the screen is off, the device is stationary and it's running on battery.\n"),n("a",{attrs:{href:"https://i.stack.imgur.com/ye77o.png",target:"_blank",rel:"noopener noreferrer"}},[n("img",{attrs:{src:"https://i.stack.imgur.com/ye77o.png",alt:"Doze Mode on Marshmallow"}}),n("OutboundLink")],1),t._v("\nAs you can see in the diagram above, when Doze Mode gets activated, the device doesn't get any wakelocks, network access, jobs/syncs, Alarms, GPS/Wi-fi scans.")]),t._v(" "),n("p",[t._v("On Android 7.0 Nougat:\nImagine if your phone is on your pocket (the screen is off, it's running on battery, but it's not stationary) you might want to get the Doze Mode features as well, right?\nSo that's why Google announced the Extended Doze Mode: It runs when the screen is off, but not stationary.\n"),n("a",{attrs:{href:"https://i.stack.imgur.com/AjCkv.png",target:"_blank",rel:"noopener noreferrer"}},[n("img",{attrs:{src:"https://i.stack.imgur.com/AjCkv.png",alt:"Doze Mode on Nougat"}}),n("OutboundLink")],1),t._v("\nAs you can see in this diagram, only Network Access and jobs/syncs are disabled.\nNote that the Extended Doze doesn't replace the first Doze Mode. They work together, depending on the phone state (stationary or not).\nHere are the distinctions:\n"),n("a",{attrs:{href:"https://i.stack.imgur.com/PuM06.png",target:"_blank",rel:"noopener noreferrer"}},[n("img",{attrs:{src:"https://i.stack.imgur.com/PuM06.png",alt:"Doze Mode distinctions"}}),n("OutboundLink")],1),t._v("\nDevelopers should be aware that:")]),t._v(" "),n("ul",[n("li",[t._v("Doze might keep temporary wakelock and network access for High-priority GCM (Google Cloud Messaging) messages (for cases wwhere the user needs an immediate notification);")]),t._v(" "),n("li",[t._v("Foreground services (such as a music playback) will continue to work.")])]),t._v(" "),n("p",[t._v("You can find more information here: "),n("a",{attrs:{href:"https://developer.android.com/training/monitoring-device-state/doze-standby.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://developer.android.com/training/monitoring-device-state/doze-standby.html"),n("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=e.exports}}]);