(window.webpackJsonp=window.webpackJsonp||[]).push([[2609],{3017:function(s,a,t){"use strict";t.r(a);var e=t(31),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"powershell-background-jobs"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#powershell-background-jobs"}},[s._v("#")]),s._v(" PowerShell Background Jobs")]),s._v(" "),t("p",[s._v("Jobs were introduced in PowerShell 2.0 and helped to solve a problem inherent in the command-line tools. In a nutshell, if you start a long running task, your prompt is unavailable until the task finishes. As an example of a long running task, think of this simple PowerShell command:")]),s._v(" "),t("p",[t("strong",[s._v("Get-ChildItem -Path c:\\ -Recurse")])]),s._v(" "),t("p",[s._v("It will take a while to fetch full directory list of your C: drive.\nIf you run it as Job then the console will get the control back and you can capture the result later on.")]),s._v(" "),t("h2",{attrs:{id:"basic-job-creation"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#basic-job-creation"}},[s._v("#")]),s._v(" Basic job creation")]),s._v(" "),t("p",[s._v("Start a Script Block as background job:")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$job")]),s._v(" = "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Start-Job")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ScriptBlock "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Get-Process")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])])]),t("p",[s._v("Start a script as background job:")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$job")]),s._v(" = "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Start-Job")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("FilePath "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"C:\\YourFolder\\Script.ps1"')]),s._v("\n\n")])])]),t("p",[s._v("Start a job using "),t("code",[s._v("Invoke-Command")]),s._v(" on a remote machine:")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$job")]),s._v(" = "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Invoke-Command")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ComputerName "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ComputerName"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ScriptBlock "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Get-Service")]),s._v(" winrm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("JobName "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"WinRM"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ThrottleLimit 16 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("AsJob\n\n")])])]),t("p",[s._v("Start job as a different user (Prompts for password):")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Start-Job")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ScriptBlock "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Get-Process")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Credential "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Domain\\Username"')]),s._v("\n\n")])])]),t("p",[s._v("Or")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Start-Job")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ScriptBlock "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Get-Process")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Credential "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Get-Credential")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n")])])]),t("p",[s._v("Start job as a different user (No prompt):")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$username")]),s._v(" = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Domain\\Username"')]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$password")]),s._v(" = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"password"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$secPassword")]),s._v(" = "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ConvertTo-SecureString")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("String "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$password")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("AsPlainText "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Force\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$credentials")]),s._v(" = "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("New-Object")]),s._v(" System"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Management"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Automation"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("PSCredential "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ArgumentList @"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$username")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$secPassword")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Start-Job")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ScriptBlock "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Get-Process")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Credential "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$credentials")]),s._v("\n\n")])])]),t("h2",{attrs:{id:"basic-job-management"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#basic-job-management"}},[s._v("#")]),s._v(" Basic job management")]),s._v(" "),t("p",[s._v("Get a list of all jobs in the current session:")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Get-Job")]),s._v("\n\n")])])]),t("p",[s._v("Waiting on a job to finish before getting the result:")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$job")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Wait-job")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Receive-Job")]),s._v(" \n\n")])])]),t("p",[s._v("Timeout a job if it runs too long (10 seconds in this example)")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$job")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Wait-job")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Timeout 10\n\n")])])]),t("p",[s._v("Stopping a job (completes all tasks that are pending in that job queue before ending):")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$job")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Stop-Job")]),s._v(" \n\n")])])]),t("p",[s._v("Remove job from current session's background jobs list:")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$job")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Remove-Job")]),s._v("\n\n")])])]),t("p",[t("strong",[s._v("Note")]),s._v(": The following will only work on "),t("code",[s._v("Workflow")]),s._v(" Jobs.")]),s._v(" "),t("p",[s._v("Suspend a "),t("code",[s._v("Workflow")]),s._v(" Job (Pause):")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$job")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Suspend-Job")]),s._v(" \n\n")])])]),t("p",[s._v("Resume a "),t("code",[s._v("Workflow")]),s._v(" Job:")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$job")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Resume-Job")]),s._v(" \n\n")])])]),t("h4",{attrs:{id:"remarks"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#remarks"}},[s._v("#")]),s._v(" Remarks")]),s._v(" "),t("p",[s._v("PowerShell Jobs run in a new process.  This has pros and cons which are related.")]),s._v(" "),t("p",[s._v("Pros:")]),s._v(" "),t("ol",[t("li",[s._v("The job runs in a clean process, including environment.")]),s._v(" "),t("li",[s._v("The job can run asynchronously to your main PowerShell process")])]),s._v(" "),t("p",[s._v("Cons:")]),s._v(" "),t("ol",[t("li",[s._v("Process environment changes will not be present in the job.\n")]),t("li",[s._v("Parameters pass to and returned results are serialized.\n"),t("ul")]),s._v(" "),t("li",[s._v("This means if you change a parameter object while the job is running it will not be reflected in the job.")]),s._v(" "),t("li",[s._v("This also means if an object cannot be serialized you cannot pass or return it (although PowerShell may Copy any parameters and pass/return a PSObject.)\n")])])])}),[],!1,null,null,null);a.default=n.exports}}]);