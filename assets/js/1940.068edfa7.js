(window.webpackJsonp=window.webpackJsonp||[]).push([[1940],{2284:function(t,e,a){"use strict";a.r(e);var s=a(19),n=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"using-serial-ports"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#using-serial-ports"}},[t._v("#")]),t._v(" Using serial ports")]),t._v(" "),a("p",[t._v('Serial ports are a common interface for communicating with external sensors or embedded systems such as Arduinos. Modern serial communications are often implemented over USB connections using USB-serial adapters.\nMATLAB provides built-in functions for serial communications, including RS-232 and RS-485 protocols. These functions can be used for hardware serial ports or "virtual" USB-serial connections. The examples here illustrate serial communications in MATLAB.')]),t._v(" "),a("h2",{attrs:{id:"creating-a-serial-port-on-mac-linux-windows"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#creating-a-serial-port-on-mac-linux-windows"}},[t._v("#")]),t._v(" Creating a serial port on Mac/Linux/Windows")]),t._v(" "),a("div",{staticClass:"language-matlab extra-class"},[a("pre",{pre:!0,attrs:{class:"language-matlab"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% Define serial port with a baud rate of 115200")]),t._v("\nrate "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("115200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" ispc\n    s "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("serial")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'COM1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'BaudRate'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("rate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("elseif")]),t._v(" ismac\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% Note that on OSX the serial device is uniquely enumerated. You will")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% have to look at /dev/tty.* to discover the exact signature of your")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% serial device")]),t._v("\n    s "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("serial")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/dev/tty.usbserial-A104VFT7'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'BaudRate'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("rate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("elseif")]),t._v(" isunix\n    s "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("serial")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/dev/ttyusb0'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'BaudRate'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("rate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% Set the input buffer size to 1,000,000 bytes (default: 512 bytes).")]),t._v("\ns"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("InputBufferSize "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("    \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% Open serial port    ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fopen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])])]),a("h2",{attrs:{id:"chosing-your-communication-mode"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#chosing-your-communication-mode"}},[t._v("#")]),t._v(" Chosing your communication mode")]),t._v(" "),a("p",[t._v("Matlab supports "),a("strong",[t._v("synchronous")]),t._v(" and "),a("strong",[t._v("asynchronous")]),t._v(" communication with a serial port. It is important to chose the right communication mode. The choice will depend on:")]),t._v(" "),a("ul",[a("li",[t._v("how the instrument you are communicating with behave.")]),t._v(" "),a("li",[t._v("what other functions your main program (or GUI) will have to do aside from managing the serial port.")])]),t._v(" "),a("p",[t._v("I'll define 3 different cases to illustrate, from the simplest to the most demanding. For the 3 examples, the instrument I am connecting to is a circuit board with an inclinometer, which can work in the 3 modes I will be describing below.")]),t._v(" "),a("h3",{attrs:{id:"mode-1-synchronous-master-slave"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mode-1-synchronous-master-slave"}},[t._v("#")]),t._v(" Mode 1: Synchronous (Master/Slave)")]),t._v(" "),a("p",[t._v("This mode is the simplest one. It correspond to the case where the PC is the "),a("strong",[t._v("Master")]),t._v(" and the instrument is the "),a("strong",[t._v("slave")]),t._v(". The instrument does not send anything to the serial port on it's own, it only "),a("strong",[t._v("replies")]),t._v(" an answer after being asked a question/command by the Master (the PC, your program). For example:")]),t._v(" "),a("ul",[a("li",[t._v('The PC sends a command: "Give me a measurement now"')]),t._v(" "),a("li",[t._v('The instrument receive the command, take the measurement then send back the measurement value to the serial line: "The inclinometer value is XXX".')])]),t._v(" "),a("p",[t._v("OR")]),t._v(" "),a("ul",[a("li",[t._v('The PC sends a command: "Change from mode X to mode Y"')]),t._v(" "),a("li",[t._v('The instrument receive the command, execute it, then send a confirmation message back to the serial line: "'),a("strong",[t._v("Command executed")]),t._v('" (or "'),a("strong",[t._v("Command NOT executed")]),t._v('"). This is commonly called an ACK/NACK reply (for "Acknowledge(d)" / "NOT Acknowledged").')])]),t._v(" "),a("p",[a("strong",[t._v("Summary:")]),t._v(" in this mode, the instrument (the "),a("strong",[t._v("Slave")]),t._v(") only send data to the serial line "),a("strong",[t._v("immediately after")]),t._v(" having been asked by the PC (the "),a("strong",[t._v("Master")]),t._v(")")]),t._v(" "),a("p",[a("a",{attrs:{href:"http://i.stack.imgur.com/t1XyZ.gif",target:"_blank",rel:"noopener noreferrer"}},[a("img",{attrs:{src:"http://i.stack.imgur.com/t1XyZ.gif",alt:"Synchronous illustration"}}),a("OutboundLink")],1)]),t._v(" "),a("h3",{attrs:{id:"mode-2-asynchronous"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mode-2-asynchronous"}},[t._v("#")]),t._v(" Mode 2: Asynchronous")]),t._v(" "),a("p",[t._v("Now suppose I started my instrument, but it is more than just a dumb sensor. It constantly monitor it's own inclination and as long as it is vertical (within a tolerance, let's say +/-15 degrees), it stays silent. If the device is tilted by more than 15 degrees and get close to horizontal, it sends an alarm message to the serial line, immediately followed by a reading of the inclination. As long as the inclination is above the threshold, it continues to send an inclination reading every 5s.")]),t._v(" "),a("p",[t._v('If your main program (or GUI) is constantly "waiting" for message arriving on the serial line, it can do that well ... but it cannot do anything else in the meantime. If the main program is a GUI, it is highly frustrating to have a GUI seemingly "frozen" because it won\'t accept any input from the user. Essentially, it became the '),a("strong",[t._v("Slave")]),t._v(" and the instrument is the "),a("strong",[t._v("Master")]),t._v(". Unless you have a fancy way of controlling your GUI from the instrument, this is something to avoid. Fortunately, the "),a("strong",[t._v("asynchronous")]),t._v(" communication mode will let you:")]),t._v(" "),a("ul",[a("li",[t._v("define a separate function which tells your program what to do when a message is received")]),t._v(" "),a("li",[t._v("keep this function in a corner, it will only be called and executed "),a("strong",[t._v("when a message arrives")]),t._v(" on the serial line. The rest of the time the GUI can execute any other code it has to run.")])]),t._v(" "),a("p",[a("strong",[t._v("Summary:")]),t._v(" In this mode, the instrument may send message to the serial line at anytime (but not necessarily "),a("strong",[t._v("all")]),t._v(" the time). The PC does not "),a("strong",[t._v("wait")]),t._v(" permanently for a message to process. It is allowed to run any other code. Only when a message arrives, it activates a function which will then read and process this message.")]),t._v(" "),a("p",[a("a",{attrs:{href:"http://i.stack.imgur.com/WzhGZ.gif",target:"_blank",rel:"noopener noreferrer"}},[a("img",{attrs:{src:"http://i.stack.imgur.com/WzhGZ.gif",alt:"enter image description here"}}),a("OutboundLink")],1)]),t._v(" "),a("h3",{attrs:{id:"mode-3-streaming-real-time"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mode-3-streaming-real-time"}},[t._v("#")]),t._v(" Mode 3: Streaming ("),a("strong",[t._v("Real time")]),t._v(")")]),t._v(" "),a("p",[t._v("Now let's unleash the full power of my instrument. I put it in a mode where it will constantly send measurements to the serial line. My program want to receive these packets and display that on a curve or a digital display. If it only send a value every 5s as above, no problem, keep the above mode. But my instrument at full whack sends a data point to the serial line at 1000Hz, i.e. it sends a new value every single millisecond.\nIf I stay in the "),a("strong",[t._v("asynchronous mode")]),t._v(" described above, there is a high risk (actually a guaranteed certainty) that the special function we defined to process every new packet will take more than 1ms to execute (if you want to plot or display the value, graphic functions are quite slow, not even considering filtering or FFT'ing the signal). It means the function will start to execute, but before it finishes, a new packet will arrive and trigger the function again. The second function is placed in a queue for execution, and will only starts when the first one is done ... but by this time a few new packets arrived and each placed a function to execute in the queue. You can quickly foresee the result: By the time I am plotting the 5th points, I have already hundreds waiting to be plotted too ... the gui slows down, eventually freezes, the stack grows, the buffers fill up, until something gives. Eventually you are left with a completely frozen program or simply a crashed one.")]),t._v(" "),a("p",[t._v("To overcome this, we will disconnect even further the synchronisation link between the PC and the instrument. We will let the instrument send data at it's own pace, without immediately triggering a function at each packet arrival. The serial port buffer will just accumulate the packets received. The PC will only collect data in the buffer at a pace it can manage (a regular interval, set up on the PC side), do something with it (while the buffer is getting refilled by the instrument), then collect a new batch of data from the buffer ... and so on.")]),t._v(" "),a("p",[a("strong",[t._v("Summary:")]),t._v(" In this mode, the instrument sends data continuously, which are collected by the serial port buffer. At regular interval, the PC collect data from the buffer and do something with it. There is no hard synchronisation link between the PC and the instrument. Both execute their tasks on their own timing.")]),t._v(" "),a("p",[a("a",{attrs:{href:"http://i.stack.imgur.com/4kHsk.gif",target:"_blank",rel:"noopener noreferrer"}},[a("img",{attrs:{src:"http://i.stack.imgur.com/4kHsk.gif",alt:"enter image description here"}}),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"reading-from-the-serial-port"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#reading-from-the-serial-port"}},[t._v("#")]),t._v(" Reading from the serial port")]),t._v(" "),a("p",[t._v("Assuming you created the serial port object "),a("code",[t._v("s")]),t._v(" as in "),a("a",{attrs:{href:"http://stackoverflow.com/documentation/matlab/1176/using-serial-ports-in-matlab/3802/creating-a-useful-serial-port-on-mac-linux-windows",target:"_blank",rel:"noopener noreferrer"}},[t._v("this"),a("OutboundLink")],1),t._v(" example, then")]),t._v(" "),a("div",{staticClass:"language-matlab extra-class"},[a("pre",{pre:!0,attrs:{class:"language-matlab"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% Read one byte")]),t._v("\ndata "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% Read all the bytes, version 1")]),t._v("\ndata "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% Read all the bytes, version 2")]),t._v("\ndata "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("BytesAvailable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% Close the serial port")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fclose")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])])]),a("h2",{attrs:{id:"closing-a-serial-port-even-if-lost-deleted-or-overwritten"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#closing-a-serial-port-even-if-lost-deleted-or-overwritten"}},[t._v("#")]),t._v(" Closing a serial port even if lost, deleted or overwritten")]),t._v(" "),a("p",[t._v("Assuming you created the serial port object "),a("code",[t._v("s")]),t._v(" as in "),a("a",{attrs:{href:"http://stackoverflow.com/documentation/matlab/1176/using-serial-ports-in-matlab/3802/creating-a-useful-serial-port-on-mac-linux-windows",target:"_blank",rel:"noopener noreferrer"}},[t._v("this"),a("OutboundLink")],1),t._v(" example, then to close it")]),t._v(" "),a("div",{staticClass:"language-matlab extra-class"},[a("pre",{pre:!0,attrs:{class:"language-matlab"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fclose")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])])]),a("p",[t._v("However, sometimes you can accidentally lose the port (e.g. clear, overwrite, change scope, etc...), and "),a("code",[t._v("fclose(s)")]),t._v(" will no longer work. The solution is easy")]),t._v(" "),a("div",{staticClass:"language-matlab extra-class"},[a("pre",{pre:!0,attrs:{class:"language-matlab"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fclose")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("instrfindall"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])])]),a("p",[t._v("More info at "),a("a",{attrs:{href:"http://www.mathworks.com/help/matlab/ref/instrfindall.html",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("instrfindall()")]),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("h2",{attrs:{id:"writing-to-the-serial-port"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#writing-to-the-serial-port"}},[t._v("#")]),t._v(" Writing to the serial port")]),t._v(" "),a("p",[t._v("Assuming you created the serial port object "),a("code",[t._v("s")]),t._v(" as in "),a("a",{attrs:{href:"http://stackoverflow.com/documentation/matlab/1176/using-serial-ports-in-matlab/3802/creating-a-useful-serial-port-on-mac-linux-windows",target:"_blank",rel:"noopener noreferrer"}},[t._v("this"),a("OutboundLink")],1),t._v(" example, then")]),t._v(" "),a("div",{staticClass:"language-matlab extra-class"},[a("pre",{pre:!0,attrs:{class:"language-matlab"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% Write one byte")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fwrite")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("255")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% Write one 16-bit signed integer")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fwrite")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("32767")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'int16'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% Write an array of unsigned 8-bit integers")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fwrite")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("48")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("49")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'uchar'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% Close the serial port")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fclose")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])])]),a("h2",{attrs:{id:"automatically-processing-data-received-from-a-serial-port"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#automatically-processing-data-received-from-a-serial-port"}},[t._v("#")]),t._v(" Automatically processing data received from a serial port")]),t._v(" "),a("p",[t._v("Some devices connected through a serial port send data to your program at a constant rate (streaming data) or send data at unpredictable intervals. You can configure the serial port to execute a function automatically to handle data whenever it arrives. This is called the "),a("a",{attrs:{href:"http://www.mathworks.com/help/matlab/matlab_external/events-and-callbacks.html#f75633",target:"_blank",rel:"noopener noreferrer"}},[t._v('"callback function"'),a("OutboundLink")],1),t._v(" for the serial port object.")]),t._v(" "),a("p",[t._v("There are two properties of the serial port that must be set to use this feature: the name of the function you want for the callback ("),a("code",[t._v("BytesAvailableFcn")]),t._v("), and the condition which should trigger executing the callback function ("),a("code",[t._v("BytesAvailableFcnMode")]),t._v(").")]),t._v(" "),a("p",[t._v("There are two ways to trigger a callback function:")]),t._v(" "),a("ol",[a("li",[t._v("When a certain number of bytes have been received at the serial port (typically used for binary data)")]),t._v(" "),a("li",[t._v("When a certain character is received at the serial port (typically used for text or ASCII data)")])]),t._v(" "),a("p",[t._v("Callback functions have two required input arguments, called "),a("code",[t._v("obj")]),t._v(" and "),a("code",[t._v("event")]),t._v(". "),a("code",[t._v("obj")]),t._v(" is the serial port. For example, if you want to print the data received from the serial port, define a function for printing the data called "),a("code",[t._v("newdata")]),t._v(":")]),t._v(" "),a("div",{staticClass:"language-matlab extra-class"},[a("pre",{pre:!0,attrs:{class:"language-matlab"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("newdata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% get the data from the serial port")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% Note: for ASCII data, use fscanf(obj) to return characters instead of binary values")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fprintf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Received %d bytes\\n'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("disp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n")])])]),a("p",[t._v("For example, to execute the "),a("code",[t._v("newdata")]),t._v(" function whenever 64 bytes of data are received, configure the serial port like this:")]),t._v(" "),a("div",{staticClass:"language-matlab extra-class"},[a("pre",{pre:!0,attrs:{class:"language-matlab"}},[a("code",[t._v("s "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("serial")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("port_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ns"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("BytesAvailableFcnMode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'byte'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ns"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("BytesAvailableFcnCount "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ns"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("BytesAvailableFcn "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("@")]),t._v("newdata"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])])]),a("p",[t._v('With text or ASCII data, the data is typically divided into lines with a "terminator character", just like text on a page. To execute the '),a("code",[t._v("newdata")]),t._v(" function whenever the carriage return character is received, configure the serial port like this:")]),t._v(" "),a("div",{staticClass:"language-matlab extra-class"},[a("pre",{pre:!0,attrs:{class:"language-matlab"}},[a("code",[t._v("s "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("serial")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("port_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ns"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("BytesAvailableFcnMode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'terminator'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ns"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Terminator "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'CR'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% the carriage return, ASCII code 13")]),t._v("\ns"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("BytesAvailableFcn "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("@")]),t._v("newdata"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])])]),a("h4",{attrs:{id:"parameters"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#parameters"}},[t._v("#")]),t._v(" Parameters")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Serial port parameter")]),t._v(" "),a("th",[t._v("what it does")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("BaudRate")])]),t._v(" "),a("td",[t._v("Sets the baudrate. The most common today is 57600, but 4800, 9600, and  115200 are frequently seen as well")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("InputBufferSize")])]),t._v(" "),a("td",[t._v("The number of bytes kept in memory. Matlab has a FIFO, which means that new bytes will be discarded. The default is 512 bytes, but it can easily be set to 20MB without issue. There are only a few edge cases where the user would want this to be small")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("BytesAvailable")])]),t._v(" "),a("td",[t._v("The number of bytes waiting to be read")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("ValuesSent")])]),t._v(" "),a("td",[t._v("The number of bytes sent since the port was opened")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("ValuesReceived")])]),t._v(" "),a("td",[t._v("The number of bytes read since the port was opened")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("BytesAvailableFcn")])]),t._v(" "),a("td",[t._v("Specify the callback function to execute when a specified number of bytes is available in the input buffer, or a terminator is read")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("BytesAvailableFcnCount")])]),t._v(" "),a("td",[t._v("Specify the number of bytes that must be available in the input buffer to generate a "),a("code",[t._v("bytes-available")]),t._v(" event")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("BytesAvailableFcnMode")])]),t._v(" "),a("td",[t._v("Specify if the "),a("code",[t._v("bytes-available")]),t._v(" event is generated after a specified number of bytes is available in the input buffer, or after a terminator is read")])])])])])}),[],!1,null,null,null);e.default=n.exports}}]);