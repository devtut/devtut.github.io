(window.webpackJsonp=window.webpackJsonp||[]).push([[3124],{3532:function(t,e,a){"use strict";a.r(e);var s=a(31),n=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"actionmailer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#actionmailer"}},[t._v("#")]),t._v(" ActionMailer")]),t._v(" "),a("p",[t._v("Action Mailer allows you to send emails from your application using mailer classes and views. Mailers work very similarly to controllers. They inherit from ActionMailer::Base and live in app/mailers, and they have associated views that appear in app/views.")]),t._v(" "),a("h2",{attrs:{id:"basic-mailer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#basic-mailer"}},[t._v("#")]),t._v(" Basic Mailer")]),t._v(" "),a("p",[t._v("This example uses four different files:")]),t._v(" "),a("ul",[a("li",[t._v("The User model")]),t._v(" "),a("li",[t._v("The User mailer")]),t._v(" "),a("li",[t._v("The html template for the email")]),t._v(" "),a("li",[t._v("The plain-text template for the email")])]),t._v(" "),a("p",[t._v("In this case, the user model calls the "),a("code",[t._v("approved")]),t._v(" method in the mailer and passes the "),a("code",[t._v("post")]),t._v(" that has been approved (the "),a("code",[t._v("approved")]),t._v(" method in the model may be called by a callback, from a controller method, etc). Then, the mailer generates the email from either the html or plain-text template using the information from the passed-in "),a("code",[t._v("post")]),t._v(" (e.g. the title). By default, the mailer uses the template with the same name as the method in the mailer (which is why both the mailer method and the templates have the name 'approved').")]),t._v(" "),a("h3",{attrs:{id:"user-mailer-rb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#user-mailer-rb"}},[t._v("#")]),t._v(" user_mailer.rb")]),t._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UserMailer")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ActionMailer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Base")]),t._v("\n  default from"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"donotreply@example.com"')]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("approved")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("post"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("@title")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" post"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("title\n      "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("@user")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" post"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user\n      mail"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("to"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("@user")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("email"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" subject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Your Post was Approved!"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n")])])]),a("h3",{attrs:{id:"user-rb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#user-rb"}},[t._v("#")]),t._v(" user.rb")]),t._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("approved")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("post"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("UserMailer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("approved"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("post"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n")])])]),a("h3",{attrs:{id:"approved-html-erb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#approved-html-erb"}},[t._v("#")]),t._v(" approved.html.erb")]),t._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("DOCTYPE")]),t._v(" html "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("PUBLIC")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-//W3C//DTD HTML 4.01 Transitional//EN"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://www.w3.org/TR/html4/loose.dtd"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("html"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("head"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("meta http"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("equiv"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Content-Type"')]),t._v(" content"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"text/html; charset=utf-8"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("title"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Post")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Approved")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("title"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("head"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("h2"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Congrats")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("%= @user.name %>! Your post (#<%=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("@title")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("%>) has been approved!</h2>")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("p"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("We")]),t._v(" look forward to your future posts"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("p"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("html"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n")])])]),a("h3",{attrs:{id:"approved-text-erb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#approved-text-erb"}},[t._v("#")]),t._v(" approved.text.erb")]),t._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Congrats")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("%= @user.name %>! Your post (#<%=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("@title")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" has been approved"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("We")]),t._v(" look forward to your future posts"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("\n\n")])])]),a("h2",{attrs:{id:"generating-a-new-mailer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#generating-a-new-mailer"}},[t._v("#")]),t._v(" Generating a new mailer")]),t._v(" "),a("p",[t._v("To generate a new mailer, enter the following command")]),t._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[t._v("rails generate mailer "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("PostMailer")]),t._v(" \n\n")])])]),a("p",[t._v("This will generate a blank template file in "),a("code",[t._v("app/mailers/post_mailer.rb")]),t._v(" named "),a("strong",[t._v("PostMailer")])]),t._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PostMailer")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ApplicationMailer")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n")])])]),a("p",[t._v("Two layout files will also be generated for the email view, one for the html format and one for the text format.")]),t._v(" "),a("p",[t._v("If you prefer not to use the generator, you can create your own mailers. Make sure they inherit from "),a("code",[t._v("ActionMailer::Base")])]),t._v(" "),a("h2",{attrs:{id:"adding-attachments"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#adding-attachments"}},[t._v("#")]),t._v(" Adding Attachments")]),t._v(" "),a("p",[a("code",[t._v("ActionMailer")]),t._v(" also allows attaching files.")]),t._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[t._v("attachments"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'filename.jpg'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("File")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("read"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/path/to/filename.jpg'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])])]),a("p",[t._v("By default, attachments will be encoded with "),a("code",[t._v("Base64")]),t._v(". To change this, you can add a hash to the attachments method.")]),t._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[t._v("attachments"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'filename.jpg'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  mime_type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'application/gzip'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  encoding"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'SpecialEncoding'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  content"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" encoded_content\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),a("p",[t._v("You can also add inline attachments")]),t._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[t._v("attachments"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("inline"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'image.jpg'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("File")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("read"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/path/to/image.jpg'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])])]),a("h2",{attrs:{id:"actionmailer-callbacks"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#actionmailer-callbacks"}},[t._v("#")]),t._v(" ActionMailer Callbacks")]),t._v(" "),a("p",[t._v("ActionMailer supports three callbacks")]),t._v(" "),a("ul",[a("li",[t._v("before_action")]),t._v(" "),a("li",[t._v("after_action")]),t._v(" "),a("li",[t._v("around_action")])]),t._v(" "),a("p",[t._v("Provide these in your Mailer class")]),t._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UserMailer")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ApplicationMailer")]),t._v("\n  after_action "),a("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":set_delivery_options")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":prevent_delivery_to_guests")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":set_business_headers")]),t._v("\n\n")])])]),a("p",[t._v("Then create these methods under the "),a("code",[t._v("private")]),t._v(" keyword")]),t._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("set_delivery_options")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("prevent_delivery_to_guests")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("set_business_headers")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n")])])]),a("h2",{attrs:{id:"actionmailer-interceptor"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#actionmailer-interceptor"}},[t._v("#")]),t._v(" ActionMailer Interceptor")]),t._v(" "),a("p",[t._v("Action Mailer provides hooks into the interceptor methods. These allow you to register classes that are called during the mail delivery life cycle.")]),t._v(" "),a("p",[t._v("An interceptor class must implement the :delivering_email(message) method which will be called before the email is sent, allowing you to make modifications to the email before it hits the delivery agents. Your class should make any needed modifications directly to the passed in Mail::Message instance.")]),t._v(" "),a("p",[t._v("It can be useful for developers to send email to themselves not real users.")]),t._v(" "),a("p",[t._v("Example of registering an actionmailer interceptor:")]),t._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# config/initializers/override_mail_recipient.rb")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Rails")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("development"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("or")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Rails")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("OverrideMailRecipient")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token method-definition"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("delivering_email")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mail"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      mail"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("subject "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'This is dummy subject'")]),t._v("\n      mail"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bcc "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test_bcc@noemail.com'")]),t._v("\n      mail"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("to "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test@noemail.com'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ActionMailer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Base")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("register_interceptor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("OverrideMailRecipient")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n")])])]),a("h2",{attrs:{id:"generate-a-scheduled-newsletter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#generate-a-scheduled-newsletter"}},[t._v("#")]),t._v(" Generate a Scheduled Newsletter")]),t._v(" "),a("p",[t._v("Create the "),a("strong",[t._v("Newsletter")]),t._v(" model:")]),t._v(" "),a("p",[t._v("Create the "),a("strong",[t._v("Newsletter")]),t._v(" controller:")]),t._v(" "),a("p",[t._v("After that, change the "),a("strong",[t._v("create.html.erb")]),t._v(" view to the nex name. We will convert this file to and "),a("strong",[t._v("partial view")]),t._v(" which will be stored inside the "),a("strong",[t._v("Footer")]),t._v(". The name will be "),a("strong",[t._v("_form.html.erb")]),t._v(".")]),t._v(" "),a("th",{attrs:{align:"left"}},[t._v("Change name file from:")]),a("th",{attrs:{align:"left"}},[t._v("To:")]),t._v("\n|---|---|---|---|---|---|---|---|---|---\n"),a("td",{attrs:{align:"left"}},[t._v("app/views/**newsletters/create.html.erb**")]),a("td",{attrs:{align:"left"}},[t._v("app/views/**newsletters/_form.html.erb**")]),t._v(" "),a("p",[t._v("After that set the routes:")]),t._v(" "),a("p",[t._v("Later on, we need to set the form we will use to save each mail:")]),t._v(" "),a("p",[t._v("And after that, insert on the footer:")]),t._v(" "),a("p",[t._v("Now, install the -"),a("strong",[t._v("letter_opener")]),t._v("- to can preview email in the default browser instead of sending it. This means you do not need to set up email delivery in your development environment, and you no longer need to worry about accidentally sending a test email to someone else's address.")]),t._v(" "),a("p",[t._v("First add the gem to your development environment and run the bundle command to install it.")]),t._v(" "),a("p",[t._v("Then set the delivery method in the Development Environment:")]),t._v(" "),a("p",[t._v("Now, create an "),a("strong",[t._v("Mailer Structure")]),t._v(" to manage the whole mailers which we will work. In terminal")]),t._v(" "),a("p",[t._v("And inside the "),a("strong",[t._v("UserMailer")]),t._v(", we have to create a method called "),a("strong",[t._v("Newsletter Mailer")]),t._v(" which will be created to contain inside on the lastest blog post and will be fired with a rake action. We will assume that you had a blog structure created before.")]),t._v(" "),a("p",[t._v("After that, create the "),a("strong",[t._v("Mailer Template")]),t._v(":")]),t._v(" "),a("p",[t._v("Since we want to send the email as a separate process, let’s create a Rake task to fire off the email. Add a new file called email_tasks.rake to lib/tasks directory of your Rails application:")]),t._v(" "),a("p",[t._v("The send_digest_email: :environment means to load the Rails environment before running the task, so you can access the application classes (like UserMailer) within the task.")]),t._v(" "),a("p",[t._v("Now, running the command rake -T will list the newly created Rake task. Test everything works by running the task and checking whether the email is sent or not.")]),t._v(" "),a("p",[t._v("To test if the mailer method works, run the rake command:")]),t._v(" "),a("p",[t._v("At this point, we have a working rake task which can be scheduled using "),a("strong",[t._v("crontab")]),t._v(". So we will install the "),a("strong",[t._v("Whenever Gem")]),t._v(" which is used to provide a clear syntax for writing and deploying cron jobs.")]),t._v(" "),a("p",[t._v("After that, run the next command to create an initial config/schedule.rb file for you (as long as the config folder is already present in your project).")]),t._v(" "),a("p",[t._v("Now, inside the schedule file, we have to create our "),a("strong",[t._v("CRON JOB")]),t._v(" and call the mailer method inside determining the CRON JOB to operate some tasks without assistance and in a selected range of time. You can use different types of syntax as is explained on this "),a("a",{attrs:{href:"https://github.com/javan/whenever",target:"_blank",rel:"noopener noreferrer"}},[t._v("link"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("img",{attrs:{src:"https://s3-us-west-2.amazonaws.com/webres-studio.com/wiki_tuto_images/Cron+Job+Syntax",alt:"Cron Job Basic Syntax"}}),t._v(" "),a("img",{attrs:{src:"https://s3-us-west-2.amazonaws.com/webres-studio.com/wiki_tuto_images/Cron+Jobs+translated+with+Whenever+Gem",alt:"Cron Jobs with Whenever"}}),t._v(" "),a("p",[t._v("Now to test the "),a("strong",[t._v("Cron Job")]),t._v(" was succesfully created we can use the next command to read since terminal, our scheduled job in CRON SYNTAX:")]),t._v(" "),a("p",[t._v("Now, to run the test in Development Environment, is wise to set the next line on the "),a("strong",[t._v("application.rb")]),t._v(" principal file to let the application knows where are the models it will use.")]),t._v(" "),a("p",[t._v("Now to let "),a("strong",[t._v("Capistrano V3")]),t._v(" save the new "),a("strong",[t._v("Cron Job")]),t._v(" inside the server and the trigger which will fired up the execution of this task, we have to add the next requirement:")]),t._v(" "),a("p",[t._v("And insert into the "),a("strong",[t._v("deploy")]),t._v(" file the identifier which "),a("strong",[t._v("CRON JOB")]),t._v(" will use about the "),a("strong",[t._v("environment")]),t._v(" and the name of the "),a("strong",[t._v("application")]),t._v(".")]),t._v(" "),a("p",[t._v("And ready, after save changes on each file, run the capistrano deploy command:")]),t._v(" "),a("p",[t._v("And now your JOB was created and calendarize to run the Mailer Method which is what i want and in the range of time we set on this files.")]),t._v(" "),a("h4",{attrs:{id:"remarks"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#remarks"}},[t._v("#")]),t._v(" Remarks")]),t._v(" "),a("p",[t._v("It is advisable to process the sending of email asynchronously so as not to tie up your web server. This can be done through various services such as "),a("code",[t._v("delayed_job")]),t._v(".")])])}),[],!1,null,null,null);e.default=n.exports}}]);