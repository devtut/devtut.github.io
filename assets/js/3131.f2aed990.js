(window.webpackJsonp=window.webpackJsonp||[]).push([[3131],{3539:function(a,s,t){"use strict";t.r(s);var e=t(31),n=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"activerecord-migrations"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#activerecord-migrations"}},[a._v("#")]),a._v(" ActiveRecord Migrations")]),a._v(" "),t("h2",{attrs:{id:"adding-multiple-columns-to-a-table"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#adding-multiple-columns-to-a-table"}},[a._v("#")]),a._v(" Adding multiple columns to a table")]),a._v(" "),t("p",[a._v("To add multiple columns to a table, separate "),t("code",[a._v("field:type")]),a._v(" pairs with spaces when using "),t("code",[a._v("rails generate migration")]),a._v(" command.")]),a._v(" "),t("p",[a._v("The general syntax is:")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[a._v("rails generate migration "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("NAME")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("field"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":index")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" field"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":index")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("options"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n\n")])])]),t("p",[a._v("For example, the following will add "),t("code",[a._v("name")]),a._v(", "),t("code",[a._v("salary")]),a._v(" and "),t("code",[a._v("email")]),a._v(" fields to the "),t("code",[a._v("users")]),a._v(" table:")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[a._v("rails generate migration "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("AddDetailsToUsers")]),a._v(" name"),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":string")]),a._v(" salary"),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":decimal")]),a._v(" email"),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":string")]),a._v("\n\n")])])]),t("p",[a._v("Which generates the following migration:")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("AddDetailsToUsers")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("ActiveRecord")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("Migration")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5.0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("def")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token method-definition"}},[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("change")])]),a._v("\n    add_column "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":users")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":string")]),a._v("\n    add_column "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":users")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":salary")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":decimal")]),a._v("\n    add_column "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":users")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":email")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":string")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n\n")])])]),t("h2",{attrs:{id:"add-a-reference-column-to-a-table"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#add-a-reference-column-to-a-table"}},[a._v("#")]),a._v(" Add a reference column to a table")]),a._v(" "),t("p",[a._v("To add a reference to a "),t("code",[a._v("team")]),a._v(" to the "),t("code",[a._v("users")]),a._v(" table, run this command:")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[a._v("$ rails generate migration "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("AddTeamRefToUsers")]),a._v(" team"),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":references")]),a._v("\n\n")])])]),t("p",[a._v("This generates the following migration:")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("AddTeamRefToUsers")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("ActiveRecord")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("Migration")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5.0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("def")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token method-definition"}},[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("change")])]),a._v("\n    add_reference "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":users")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":team")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" foreign_key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n\n")])])]),t("p",[a._v("That migration will create a "),t("code",[a._v("team_id")]),a._v(" column in the "),t("code",[a._v("users")]),a._v(" table.")]),a._v(" "),t("p",[a._v("If you want to add an appropriate "),t("code",[a._v("index")]),a._v(" and "),t("code",[a._v("foreign_key")]),a._v(" on the added column, change the command to "),t("code",[a._v("rails generate migration AddTeamRefToUsers team:references:index")]),a._v(". This will generate the following migration:")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("AddTeamRefToUsers")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("ActiveRecord")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("Migration")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("def")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token method-definition"}},[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("change")])]),a._v("\n    add_reference "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":users")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":team")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" index"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),a._v("\n    add_foreign_key "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":users")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":teams")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n\n")])])]),t("p",[a._v("If you want to name your reference column other than what Rails auto generates, add the following to your migration: (E.g.: You might want to call the "),t("code",[a._v("User")]),a._v(" who created the "),t("code",[a._v("Post")]),a._v(" as "),t("code",[a._v("Author")]),a._v(" in the "),t("code",[a._v("Post")]),a._v(" table)")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("AddAuthorRefToPosts")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("ActiveRecord")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("Migration")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("def")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token method-definition"}},[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("change")])]),a._v("\n    add_reference "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":posts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":author")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" references"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":users")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" index"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n\n")])])]),t("h2",{attrs:{id:"rollback-migrations"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rollback-migrations"}},[a._v("#")]),a._v(" Rollback migrations")]),a._v(" "),t("p",[a._v("To "),t("code",[a._v("rollback")]),a._v(" the latest migration, either by reverting the "),t("code",[a._v("change")]),a._v(" method or by running the "),t("code",[a._v("down")]),a._v(" method. Run command:")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[a._v("rake db"),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":rollback")]),a._v("\n\n")])])]),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[a._v("rails db"),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":rollback")]),a._v("\n\n")])])]),t("h3",{attrs:{id:"rollback-the-last-3-migrations"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rollback-the-last-3-migrations"}},[a._v("#")]),a._v(" Rollback the last 3 migrations")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[a._v("rake db"),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":rollback")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("STEP")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v("\n\n")])])]),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[a._v("rails db"),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":rollback")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("STEP")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v("\n\n")])])]),t("p",[t("code",[a._v("STEP")]),a._v(" provide the number of migrations to revert.")]),a._v(" "),t("h3",{attrs:{id:"rollback-all-migrations"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rollback-all-migrations"}},[a._v("#")]),a._v(" Rollback all migrations")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[a._v("rake db"),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":rollback")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("VERSION")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\n\n")])])]),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[a._v("rails db"),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":rollback")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("VERSION")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\n\n")])])]),t("h2",{attrs:{id:"add-a-new-column-with-an-index"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#add-a-new-column-with-an-index"}},[a._v("#")]),a._v(" Add a new column with an index")]),a._v(" "),t("p",[a._v("To add a new "),t("strong",[a._v("indexed")]),a._v(" column "),t("code",[a._v("email")]),a._v(" to the "),t("code",[a._v("users")]),a._v(" table, run the command:")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[a._v("rails generate migration "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("AddEmailToUsers")]),a._v(" email"),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":string")]),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":index")]),a._v("\n\n")])])]),t("p",[a._v("This will generate the following migration:")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("AddEmailToUsers")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("ActiveRecord")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("Migration")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5.0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("def")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token method-definition"}},[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("change")])]),a._v("\n    add_column "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":users")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":email")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":string")]),a._v("\n    add_index "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":users")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":email")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n\n")])])]),t("h2",{attrs:{id:"run-specific-migration"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#run-specific-migration"}},[a._v("#")]),a._v(" Run specific migration")]),a._v(" "),t("p",[a._v("To run a specific migration up or down, use "),t("code",[a._v("db:migrate:up")]),a._v(" or "),t("code",[a._v("db:migrate:down")]),a._v(".")]),a._v(" "),t("p",[a._v("Up a specific migration:")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[a._v("rake db"),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":migrate")]),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":up")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("VERSION")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("20090408054555")]),a._v("\n\n")])])]),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[a._v("rails db"),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":migrate")]),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":up")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("VERSION")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("20090408054555")]),a._v(" \n\n")])])]),t("p",[a._v("Down a specific migration:")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[a._v("rake db"),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":migrate")]),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":down")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("VERSION")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("20090408054555")]),a._v("\n\n")])])]),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[a._v("rails db"),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":migrate")]),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":down")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("VERSION")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("20090408054555")]),a._v("\n\n")])])]),t("p",[a._v("The version number in the above commands is the numeric prefix in the migration’s filename. For example, to migrate to the migration "),t("code",[a._v("20160515085959_add_name_to_users.rb")]),a._v(", you would use "),t("code",[a._v("20160515085959")]),a._v(" as the version number.")]),a._v(" "),t("h2",{attrs:{id:"redo-migrations"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redo-migrations"}},[a._v("#")]),a._v(" Redo migrations")]),a._v(" "),t("p",[a._v("You can rollback and then migrate again using the "),t("code",[a._v("redo")]),a._v(" command. This is basically a shortcut that combines "),t("code",[a._v("rollback")]),a._v(" and "),t("code",[a._v("migrate")]),a._v(" tasks.")]),a._v(" "),t("p",[a._v("Run command:")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[a._v("rake db"),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":migrate")]),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":redo")]),a._v("\n\n")])])]),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[a._v("rails db"),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":migrate")]),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":redo")]),a._v("\n\n")])])]),t("p",[a._v("You can use the "),t("code",[a._v("STEP")]),a._v(" parameter to go back more than one version.")]),a._v(" "),t("p",[a._v("For example, to go back 3 migrations:")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[a._v("rake db"),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":migrate")]),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":redo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("STEP")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v("\n\n")])])]),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[a._v("rails db"),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":migrate")]),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":redo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("STEP")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v("\n\n")])])]),t("h2",{attrs:{id:"add-a-new-column-to-a-table"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#add-a-new-column-to-a-table"}},[a._v("#")]),a._v(" Add a new column to a table")]),a._v(" "),t("p",[a._v("To add a new column "),t("code",[a._v("name")]),a._v(" to the "),t("code",[a._v("users")]),a._v(" table, run the command:")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[a._v("rails generate migration "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("AddNameToUsers")]),a._v(" name\n\n")])])]),t("p",[a._v("This generates the following migration:")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("AddNameToUsers")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("ActiveRecord")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("Migration")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5.0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("def")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token method-definition"}},[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("change")])]),a._v("\n    add_column "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":users")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":string")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n\n")])])]),t("p",[a._v("When the migration name is of the form "),t("code",[a._v("AddXXXToTABLE_NAME")]),a._v(" followed by list of columns with data types, the generated migration will contain the appropriate "),t("code",[a._v("add_column")]),a._v(" statements.")]),a._v(" "),t("h2",{attrs:{id:"remove-an-existing-column-from-a-table"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#remove-an-existing-column-from-a-table"}},[a._v("#")]),a._v(" Remove an existing column from a table")]),a._v(" "),t("p",[a._v("To remove existing column "),t("code",[a._v("name")]),a._v(" from "),t("code",[a._v("users")]),a._v(" table, run the command:")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[a._v("rails generate migration "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("RemoveNameFromUsers")]),a._v(" name"),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":string")]),a._v("\n\n")])])]),t("p",[a._v("This will generate the following migration:")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("RemoveNameFromUsers")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("ActiveRecord")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("Migration")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5.0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("def")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token method-definition"}},[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("change")])]),a._v("\n    remove_column "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":users")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":string")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n\n")])])]),t("p",[a._v("When the migration name is of the form "),t("code",[a._v("RemoveXXXFromYYY")]),a._v(" followed by list of columns with data types then the generated migration will contain the appropriate "),t("code",[a._v("remove_column")]),a._v(" statements.")]),a._v(" "),t("p",[a._v("While it’s not required to specify the data type (e.g. "),t("code",[a._v(":string")]),a._v(") as a parameter to "),t("code",[a._v("remove_column")]),a._v(", it is highly recommended. If the data type is "),t("strong",[a._v("not")]),a._v(" specified, then the migration will not be reversible.")]),a._v(" "),t("h2",{attrs:{id:"running-migrations-in-different-environments"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#running-migrations-in-different-environments"}},[a._v("#")]),a._v(" Running migrations in different environments")]),a._v(" "),t("p",[a._v("To run migrations in the "),t("code",[a._v("test")]),a._v(" environment, run this shell command:")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[a._v("rake db"),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":migrate")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("RAILS_ENV")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("test\n\n")])])]),t("p",[a._v("Starting in Rails 5.0, you can use "),t("code",[a._v("rails")]),a._v(" instead of "),t("code",[a._v("rake")]),a._v(":")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[a._v("rails db"),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":migrate")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("RAILS_ENV")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("test\n\n")])])]),t("h2",{attrs:{id:"create-a-new-table"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#create-a-new-table"}},[a._v("#")]),a._v(" Create a new table")]),a._v(" "),t("p",[a._v("To create a new "),t("code",[a._v("users")]),a._v(" table with the columns "),t("code",[a._v("name")]),a._v(" and "),t("code",[a._v("salary")]),a._v(", run the command:")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[a._v("rails generate migration "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("CreateUsers")]),a._v(" name"),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":string")]),a._v(" salary"),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":decimal")]),a._v("\n\n")])])]),t("p",[a._v("This will generate the following migration:")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("CreateUsers")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("ActiveRecord")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("Migration")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5.0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("def")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token method-definition"}},[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("change")])]),a._v("\n    create_table "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":users")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("do")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("t"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n      t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("string "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":name")]),a._v("\n      t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("decimal "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":salary")]),a._v("  \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n\n")])])]),t("p",[a._v("When the migration name is of the form "),t("code",[a._v("CreateXXX")]),a._v(" followed by list of columns with data types, then a migration will be generated that creates the table "),t("code",[a._v("XXX")]),a._v(" with the listed columns.")]),a._v(" "),t("h2",{attrs:{id:"running-migrations"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#running-migrations"}},[a._v("#")]),a._v(" Running migrations")]),a._v(" "),t("p",[a._v("Run command:")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[a._v("rake db"),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":migrate")]),a._v("\n\n")])])]),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[a._v("rails db"),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":migrate")]),a._v("\n\n")])])]),t("p",[a._v("Specifying target version will run the required migrations (up, down, change) until it has reached the specified version. Here, "),t("code",[a._v("version number")]),a._v(" is the numerical prefix on the migration's filename.")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[a._v("rake db"),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":migrate")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("VERSION")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("20080906120000")]),a._v("\n\n")])])]),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[a._v("rails db"),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":migrate")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("VERSION")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("20080906120000")]),a._v("\n\n")])])]),t("h2",{attrs:{id:"change-an-existing-column-s-type"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#change-an-existing-column-s-type"}},[a._v("#")]),a._v(" Change an existing column’s type")]),a._v(" "),t("p",[a._v("To modify an existing column in Rails with a migration, run the following command:")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[a._v("rails g migration change_column_in_table\n\n")])])]),t("p",[a._v("This will create a new migration file in "),t("code",[a._v("db/migration")]),a._v(" directory (if it doesn’t exist already), which will contain the file prefixed with timestamp and migration file name which contains the below content:")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("def")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token method-definition"}},[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("change")])]),a._v("\n  change_column"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":table_name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":column_name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":new_type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n\n")])])]),t("p",[t("a",{attrs:{href:"http://guides.rubyonrails.org/active_record_migrations.html#changing-columns",target:"_blank",rel:"noopener noreferrer"}},[a._v("Rails Guide – Changing Columns"),t("OutboundLink")],1)]),a._v(" "),t("h3",{attrs:{id:"a-longer-but-safer-method"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#a-longer-but-safer-method"}},[a._v("#")]),a._v(" A longer but safer method")]),a._v(" "),t("p",[a._v("The above code prevents the user from ever rolling back the migration. You can avoid this problem by splitting the "),t("code",[a._v("change")]),a._v(" method into separate "),t("code",[a._v("up")]),a._v(" and "),t("code",[a._v("down")]),a._v(" methods:")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("def")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token method-definition"}},[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("up")])]),a._v("\n  change_column "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":my_table")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":my_column")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":new_type")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("def")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token method-definition"}},[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("down")])]),a._v("\n  change_column "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":my_table")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":my_column")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":old_type")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n\n")])])]),t("h2",{attrs:{id:"add-column-with-default-value"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#add-column-with-default-value"}},[a._v("#")]),a._v(" Add column with default value")]),a._v(" "),t("p",[a._v("The following example adds a column "),t("code",[a._v("admin")]),a._v(" to the "),t("code",[a._v("users")]),a._v(" table, and gives that column the default value "),t("code",[a._v("false")]),a._v(".")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("AddDetailsToUsers")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("ActiveRecord")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("Migration")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5.0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("def")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token method-definition"}},[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("change")])]),a._v("\n    add_column "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":users")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":admin")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":boolean")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" default"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n\n")])])]),t("p",[a._v("Migrations with defaults might take a long time in large tables with for example PostgreSQL. This is because each row will have to be updated with the default value for the newly added column. To circumvent this (and reduce downtime during deployments), you can split your migration into three steps:")]),a._v(" "),t("ol",[t("li",[a._v("Add a "),t("code",[a._v("add_column")]),a._v("-migration similar to the one above, but set no default")]),a._v(" "),t("li",[a._v("Deploy and update the column in a rake task or on the console while your app is running. Make sure your application already writes data to that colum for new/updated rows.")]),a._v(" "),t("li",[a._v("Add another "),t("code",[a._v("change_column")]),a._v(" migration, which then changes the default of that column to the desired default value")])]),a._v(" "),t("h2",{attrs:{id:"create-a-join-table"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#create-a-join-table"}},[a._v("#")]),a._v(" Create a join table")]),a._v(" "),t("p",[a._v("To create a join table between "),t("code",[a._v("students")]),a._v(" and "),t("code",[a._v("courses")]),a._v(", run the command:")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[a._v("$ rails g migration "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("CreateJoinTableStudentCourse")]),a._v(" student course\n\n")])])]),t("p",[a._v("This will generate the following migration:")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("CreateJoinTableStudentCourse")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("ActiveRecord")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("Migration")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5.0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("def")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token method-definition"}},[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("change")])]),a._v("\n    create_join_table "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":students")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":courses")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("do")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("t"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# t.index [:student_id, :course_id]")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# t.index [:course_id, :student_id]")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n\n")])])]),t("h2",{attrs:{id:"create-a-hstore-column"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#create-a-hstore-column"}},[a._v("#")]),a._v(" Create a hstore column")]),a._v(" "),t("p",[t("code",[a._v("Hstore")]),a._v(" columns can be useful to store settings. They are available in PostgreSQL databases after you enabled the extension.")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("CreatePages")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("ActiveRecord")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("Migration")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5.0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("def")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token method-definition"}},[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("change")])]),a._v("\n    create_table "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":pages")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("do")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("t"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n      enable_extension "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'hstore'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("unless")]),a._v(" extension_enabled"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("?")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'hstore'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n      t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("hstore "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":settings")]),a._v("\n      t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("timestamps\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n\n")])])]),t("h2",{attrs:{id:"add-a-self-reference"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#add-a-self-reference"}},[a._v("#")]),a._v(" Add a self reference")]),a._v(" "),t("p",[a._v("A self reference can be useful to build a hierarchical tree. This can be achieved with "),t("code",[a._v("add_reference")]),a._v(" in a migration.")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("AddParentPages")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("ActiveRecord")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("Migration")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5.0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("def")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token method-definition"}},[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("change")])]),a._v("\n    add_reference "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":pages")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":pages")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n\n")])])]),t("p",[a._v("The foreign key column will be "),t("code",[a._v("pages_id")]),a._v(". If you want to decide about the foreign key column name, you have to create the column first and add the reference after.")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("AddParentPages")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("ActiveRecord")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("Migration")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5.0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("def")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token method-definition"}},[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("change")])]),a._v("\n    add_column "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":pages")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":parent_id")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":integer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" null"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" index"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),a._v("\n    add_foreign_key "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":pages")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":pages")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" column"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":parent_id")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n\n")])])]),t("h2",{attrs:{id:"create-an-array-column"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#create-an-array-column"}},[a._v("#")]),a._v(" Create an array column")]),a._v(" "),t("p",[a._v("An "),t("code",[a._v("array")]),a._v(" column is supported by PostgreSQL. Rails will automatically convert a PostgreSQL array to a Ruby array, and vice-versa.")]),a._v(" "),t("p",[a._v("Create a table with an "),t("code",[a._v("array")]),a._v(" column:")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[a._v("create_table "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":products")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("do")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("t"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n  t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("string "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":name")]),a._v("\n  t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("text "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":colors")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" array"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" default"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n\n")])])]),t("p",[a._v("Add an "),t("code",[a._v("array")]),a._v(" column to an existing table:")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[a._v("add_column "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":products")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":colors")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" array"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" default"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n\n")])])]),t("p",[a._v("Add an index for an "),t("code",[a._v("array")]),a._v(" column:")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[a._v("add_index "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":products")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":colors")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" using"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'gin'")]),a._v("\n\n")])])]),t("h2",{attrs:{id:"changing-tables"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#changing-tables"}},[a._v("#")]),a._v(" Changing Tables")]),a._v(" "),t("p",[a._v("If you have created a table with some wrong schema, then the easiest way to change the columns and their properties is "),t("code",[a._v("change_table")]),a._v(". Review the following example:")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[a._v("change_table "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":orders")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("do")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("t"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n  t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("remove "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":ordered_at")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# removes column ordered_at")]),a._v("\n  t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("string "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":skew_number")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# adds a new column ")]),a._v("\n  t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("index  "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":skew_number")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#creates an index")]),a._v("\n  t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("rename "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":location")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":state")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#renames location column to state")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n\n")])])]),t("p",[a._v("The above migration changes a table "),t("code",[a._v("orders")]),a._v(". Here is a line-by-line description of the changes:")]),a._v(" "),t("ol",[t("li",[t("code",[a._v("t.remove :ordered_at")]),a._v(" removes the column "),t("code",[a._v("ordered_at")]),a._v(" from the table "),t("code",[a._v("orders")]),a._v(".")]),a._v(" "),t("li",[t("code",[a._v("t.string :skew_number")]),a._v(" adds a new string-type column named "),t("code",[a._v("skew_number")]),a._v(" in the "),t("code",[a._v("orders")]),a._v(" table.")]),a._v(" "),t("li",[t("code",[a._v("t.index :skew_number")]),a._v(" adds an index on the "),t("code",[a._v("skew_number")]),a._v(" column in the "),t("code",[a._v("orders")]),a._v(" table.")]),a._v(" "),t("li",[t("code",[a._v("t.rename :location, :state")]),a._v(" renames the "),t("code",[a._v("location")]),a._v(" column in the "),t("code",[a._v("orders")]),a._v(" table to "),t("code",[a._v("state")]),a._v(".")])]),a._v(" "),t("h2",{attrs:{id:"add-an-unique-column-to-a-table"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#add-an-unique-column-to-a-table"}},[a._v("#")]),a._v(" Add an unique column to a table")]),a._v(" "),t("p",[a._v("To add a new "),t("strong",[a._v("unique")]),a._v(" column "),t("code",[a._v("email")]),a._v(" to "),t("code",[a._v("users")]),a._v(", run the following command:")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[a._v("rails generate migration "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("AddEmailToUsers")]),a._v(" email"),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":string")]),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":uniq")]),a._v("\n\n")])])]),t("p",[a._v("This will create the following migration:")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("AddEmailToUsers")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("ActiveRecord")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("Migration")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5.0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("def")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token method-definition"}},[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("change")])]),a._v("\n    add_column "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":users")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":email")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":string")]),a._v("\n    add_index "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":users")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":email")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" unique"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n\n")])])]),t("h2",{attrs:{id:"checking-migration-status"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#checking-migration-status"}},[a._v("#")]),a._v(" Checking migration status")]),a._v(" "),t("p",[a._v("We can check the status of migrations by running")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[a._v("rake db"),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":migrate")]),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":status")]),a._v("\n\n")])])]),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[a._v("rails db"),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":migrate")]),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":status")]),a._v("\n\n")])])]),t("p",[a._v("The output will look like this:")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("Status")]),a._v("   "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("Migration")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("ID")]),a._v("    "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("Migration")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("Name")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("\nup     "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("20140711185212")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("Create")]),a._v(" documentation pages\nup     "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("20140724111844")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("Create")]),a._v(" nifty attachments table\nup     "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("20140724114255")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("Create")]),a._v(" documentation screenshots\nup     "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("20160213170731")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("Create")]),a._v(" owners\nup     "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("20160218214551")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("Create")]),a._v(" users\nup     "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("20160221162159")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("NO")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("FILE")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v("\nup     "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("20160222231219")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("NO")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("FILE")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v("\n\n")])])]),t("p",[a._v("Under the status field, "),t("code",[a._v("up")]),a._v(" means the migration has been run and "),t("code",[a._v("down")]),a._v(" means that we need to run the migration.")]),a._v(" "),t("h2",{attrs:{id:"forbid-null-values"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#forbid-null-values"}},[a._v("#")]),a._v(" Forbid null values")]),a._v(" "),t("p",[a._v("To forbid "),t("code",[a._v("null")]),a._v(" values in your table columns, add the "),t("code",[a._v(":null")]),a._v(" parameter to your migration, like this:")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("AddPriceToProducts")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("ActiveRecord")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("Migration")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("def")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token method-definition"}},[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("change")])]),a._v("\n    add_column "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":products")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":float")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" null"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n\n")])])]),t("h2",{attrs:{id:"adding-a-not-null-constraint-to-existing-data"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#adding-a-not-null-constraint-to-existing-data"}},[a._v("#")]),a._v(" Adding a NOT NULL constraint to existing data")]),a._v(" "),t("p",[a._v("Say you want to add a foreign key "),t("code",[a._v("company_id")]),a._v(" to the "),t("code",[a._v("users")]),a._v(" table, and you want to have a "),t("code",[a._v("NOT NULL")]),a._v(" constraint on it. If you already have data in "),t("code",[a._v("users")]),a._v(", you will have to do this in multiple steps.")]),a._v(" "),t("div",{staticClass:"language-ruby extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ruby"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("AddCompanyIdToUsers")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("ActiveRecord")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("Migration")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("def")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token method-definition"}},[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("up")])]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# add the column with NULL allowed")]),a._v("\n    add_column "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":users")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":company_id")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":integer")]),a._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# make sure every row has a value")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("User")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("find_each "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("do")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("user"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# find the appropriate company record for the user")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# according to your business logic")]),a._v("\n      company "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("Company")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("first\n      user"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("update"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("company_id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" company"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# add NOT NULL constraint")]),a._v("\n    change_column_null "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":users")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":company_id")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Migrations that manipulate data must use up/down instead of change")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("def")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token method-definition"}},[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("down")])]),a._v("\n    remove_column "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":users")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token symbol"}},[a._v(":company_id")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n\n")])])]),t("h4",{attrs:{id:"parameters"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#parameters"}},[a._v("#")]),a._v(" Parameters")]),a._v(" "),t("table",[t("thead",[t("tr",[t("th",[a._v("Column type")]),a._v(" "),t("th",[a._v("Description")])])]),a._v(" "),t("tbody",[t("tr",[t("td",[t("code",[a._v(":primary_key")])]),a._v(" "),t("td",[a._v("Primary key")])]),a._v(" "),t("tr",[t("td",[t("code",[a._v(":string")])]),a._v(" "),t("td",[a._v("Shorter string datatype. Allows "),t("code",[a._v("limit")]),a._v(" option for maximum number of characters.")])]),a._v(" "),t("tr",[t("td",[t("code",[a._v(":text")])]),a._v(" "),t("td",[a._v("Longer amount of text. Allows "),t("code",[a._v("limit")]),a._v(" option for maximum number of bytes.")])]),a._v(" "),t("tr",[t("td",[t("code",[a._v(":integer")])]),a._v(" "),t("td",[a._v("Integer. Allows "),t("code",[a._v("limit")]),a._v(" option for maximum number of bytes.")])]),a._v(" "),t("tr",[t("td",[t("code",[a._v(":bigint")])]),a._v(" "),t("td",[a._v("Larger integer")])]),a._v(" "),t("tr",[t("td",[t("code",[a._v(":float")])]),a._v(" "),t("td",[a._v("Float")])]),a._v(" "),t("tr",[t("td",[t("code",[a._v(":decimal")])]),a._v(" "),t("td",[a._v("Decimal number with variable precision. Allows "),t("code",[a._v("precision")]),a._v(" and "),t("code",[a._v("scale")]),a._v(" options.")])]),a._v(" "),t("tr",[t("td",[t("code",[a._v(":numeric")])]),a._v(" "),t("td",[a._v("Allows "),t("code",[a._v("precision")]),a._v(" and "),t("code",[a._v("scale")]),a._v(" options.")])]),a._v(" "),t("tr",[t("td",[t("code",[a._v(":datetime")])]),a._v(" "),t("td",[a._v("DateTime object for dates/times.")])]),a._v(" "),t("tr",[t("td",[t("code",[a._v(":time")])]),a._v(" "),t("td",[a._v("Time object for times.")])]),a._v(" "),t("tr",[t("td",[t("code",[a._v(":date")])]),a._v(" "),t("td",[a._v("Date object for dates.")])]),a._v(" "),t("tr",[t("td",[t("code",[a._v(":binary")])]),a._v(" "),t("td",[a._v("Binary data. Allows "),t("code",[a._v("limit")]),a._v(" option for maximum number of bytes.")])]),a._v(" "),t("tr",[t("td",[t("code",[a._v(":boolean")])]),a._v(" "),t("td",[a._v("Boolean")])])])]),a._v(" "),t("h4",{attrs:{id:"remarks"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#remarks"}},[a._v("#")]),a._v(" Remarks")]),a._v(" "),t("li",[a._v("\nMost migration files live in `db/migrate/` directory. They’re identified by a UTC timestamp at the beginning of their file name: `YYYYMMDDHHMMSS_create_products.rb`.\n")]),a._v(" "),t("li",[a._v("\nThe `rails generate` command can be shortened to `rails g`.\n")]),a._v(" "),t("li",[a._v("\nIf a `:type` is not passed to a field, it defaults to a string.\n")])])}),[],!1,null,null,null);s.default=n.exports}}]);