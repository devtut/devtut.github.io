(window.webpackJsonp=window.webpackJsonp||[]).push([[2541],{2948:function(t,a,e){"use strict";e.r(a);var s=e(31),r=Object(s.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"backup-script-for-a-production-db"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#backup-script-for-a-production-db"}},[t._v("#")]),t._v(" Backup script for a production DB")]),t._v(" "),e("h2",{attrs:{id:"saveproddb-sh"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#saveproddb-sh"}},[t._v("#")]),t._v(" saveProdDb.sh")]),t._v(" "),e("p",[t._v("In general, we tend to back up the DB with the pgAdmin client. The following is a sh script used to save the database (under linux) in two formats:")]),t._v(" "),e("li",[t._v("\n**SQL file**: for a possible resume of data on any version of PostgreSQL.\n")]),t._v(" "),e("li",[t._v("\n**Dump file**: for a higher version than the current version.\n")]),t._v(" "),e("div",{staticClass:"language-sql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#!/bin/sh")]),t._v("\ncd "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("save_db\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#rm -R /save_db/*")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DATE")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("$"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("date")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("d"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("m"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("Y"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("Hh"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("M"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\necho "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("e "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Sauvegarde de la base du ${DATE}"')]),t._v("\nmkdir prodDir${"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DATE")]),t._v("}\ncd prodDir${"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DATE")]),t._v("}\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#dump file")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("opt"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("postgres"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("9.0")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("bin"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("pg_dump "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("i "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("h localhost "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("5432")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("U postgres "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("F c "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("b "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("w "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("v "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("f "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dbprod${DATE}.backup"')]),t._v(" dbprod\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#SQL file")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("opt"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("postgres"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("9.0")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("bin"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("pg_dump "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("i "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("h localhost "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("5432")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("U postgres "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v('--format plain --verbose  -f "dbprod${DATE}.sql" dbprod')]),t._v("\n\n")])])]),e("h4",{attrs:{id:"syntax"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#syntax"}},[t._v("#")]),t._v(" Syntax")]),t._v(" "),e("ul",[e("li",[t._v("The script allows you to create a backup directory for each execution with the following syntax : Name of database backup directory + date and time of execution")]),t._v(" "),e("li",[t._v("Example : prodDir22-11-2016-19h55")]),t._v(" "),e("li",[t._v("After it's created, it creates two backup files with the following syntax : "),e("strong",[t._v("Name of database "),e("strong",[t._v("+")]),t._v(" date and time of execution")])]),t._v(" "),e("li",[t._v("Example :")]),t._v(" "),e("li",[t._v("dbprod22-11-2016-19h55.backup    "),e("strong",[t._v("(dump file)")])]),t._v(" "),e("li",[t._v("dbprod22-11-2016-19h55.sql       "),e("strong",[t._v("(sql file)")])]),t._v(" "),e("li",[t._v("At the end of one execution at "),e("strong",[t._v("22-11-2016 @ 19h55")]),t._v(", we get :")]),t._v(" "),e("li",[t._v("/save_bd/prodDir22-11-2016-19h55/dbprod22-11-2016-19h55.backup")]),t._v(" "),e("li",[t._v("/save_bd/prodDir22-11-2016-19h55/dbprod22-11-2016-19h55.sql")])]),t._v(" "),e("h4",{attrs:{id:"parameters"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#parameters"}},[t._v("#")]),t._v(" Parameters")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("parameter")]),t._v(" "),e("th",[t._v("details")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("save_db")]),t._v(" "),e("td",[t._v("The main backup directory")])]),t._v(" "),e("tr",[e("td",[t._v("dbProd")]),t._v(" "),e("td",[t._v("The secondary backup directory")])]),t._v(" "),e("tr",[e("td",[t._v("DATE")]),t._v(" "),e("td",[t._v("The date of the backup in the specified format")])]),t._v(" "),e("tr",[e("td",[t._v("dbprod")]),t._v(" "),e("td",[t._v("The name of the database to be saved")])]),t._v(" "),e("tr",[e("td",[t._v("/opt/postgres/9.0/bin/pg_dump")]),t._v(" "),e("td",[t._v("The path to the pg_dump binary")])]),t._v(" "),e("tr",[e("td",[t._v("-h")]),t._v(" "),e("td",[t._v("Specifies the host name of the machine on which the server is running, Example : localhost")])]),t._v(" "),e("tr",[e("td",[t._v("-p")]),t._v(" "),e("td",[t._v("Specifies the TCP port or local Unix domain socket file extension on which the server is listening for connections, Example 5432")])]),t._v(" "),e("tr",[e("td",[t._v("-U")]),t._v(" "),e("td",[t._v("User name to connect as.")])])])]),t._v(" "),e("h4",{attrs:{id:"remarks"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#remarks"}},[t._v("#")]),t._v(" Remarks")]),t._v(" "),e("li",[t._v("If there is a backup tool such as [HDPS](https://www.hds.com/en-us/products-solutions/data-protection/data-protection-suite.html), or [Symantec Backup](https://www.symantec.com/fr/fr/page.jsp?id=introducing-backup-exec-15), ...\nIt is necessary to empty the backup directory **before each launch**.")]),t._v(" "),e("p",[t._v("To avoid cluttering the backup tool because the backup of old files is supposed to be done.")]),t._v(" "),e("blockquote"),t._v(" "),e("p",[t._v("To enable this feature please uncomment line NÂ° 3.")]),t._v(" "),e("div",{staticClass:"language-sql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[t._v("rm "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("R "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" save_db "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n\n")])])]),e("ol",[e("li",[t._v("In the case where the budget does not allow to have a tool of backup, one can always use the tasks planner ("),e("a",{attrs:{href:"https://fr.wikipedia.org/wiki/Cron",target:"_blank",rel:"noopener noreferrer"}},[t._v("cron command"),e("OutboundLink")],1),t._v(").")])]),t._v(" "),e("blockquote"),t._v(" "),e("p",[t._v("The following command is used to edit the cron table for the current user.")]),t._v(" "),e("div",{staticClass:"language-sql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[t._v("crontab "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("e\n\n")])])]),e("blockquote"),t._v(" "),e("p",[t._v("Schedule the launch of the script with the calendar at 11pm.")]),t._v(" "),e("div",{staticClass:"language-sql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("saveProdDb"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sh\n\n")])])])])}),[],!1,null,null,null);a.default=r.exports}}]);