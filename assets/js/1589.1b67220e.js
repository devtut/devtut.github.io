(window.webpackJsonp=window.webpackJsonp||[]).push([[1589],{1937:function(a,e,t){"use strict";t.r(e);var s=t(19),n=Object(s.a)({},(function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"java-memory-management"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#java-memory-management"}},[a._v("#")]),a._v(" Java Memory Management")]),a._v(" "),t("h2",{attrs:{id:"setting-the-heap-permgen-and-stack-sizes"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#setting-the-heap-permgen-and-stack-sizes"}},[a._v("#")]),a._v(" Setting the Heap, PermGen and Stack sizes")]),a._v(" "),t("p",[a._v("When a Java virtual machine starts, it needs to know how big to make the Heap, and the default size for thread stacks.  These can be specified using command-line options on the "),t("code",[a._v("java")]),a._v(" command.  For versions of Java prior to Java 8, you can also specify the size of the PermGen region of the Heap.")]),a._v(" "),t("p",[a._v("Note that PermGen was removed in Java 8, and if you attempt to set the PermGen size the option will be ignored (with a warning message).")]),a._v(" "),t("p",[a._v("If you don't specify Heap and Stack sizes explicitly, the JVM will use defaults that are calculated in a version and platform specific way.  This may result in your application using too little or too much memory.  This is typically OK for thread stacks, but it can be problematic for a program that uses a lot of memory.")]),a._v(" "),t("p",[t("strong",[a._v("Setting the Heap, PermGen and default Stack sizes:")])]),a._v(" "),t("p",[a._v("The following JVM options set the heap size:")]),a._v(" "),t("ul",[t("li",[t("code",[a._v("-Xms<size>")]),a._v(" - sets the initial heap size")]),a._v(" "),t("li",[t("code",[a._v("-Xmx<size>")]),a._v(" - sets the maximum heap size")]),a._v(" "),t("li",[t("code",[a._v("-XX:PermSize<size>")]),a._v(" - sets the initial PermGen size")]),a._v(" "),t("li",[t("code",[a._v("-XX:MaxPermSize<size>")]),a._v(" - sets the maximum PermGen size")]),a._v(" "),t("li",[t("code",[a._v("-Xss<size>")]),a._v(" - sets the default thread stack size")])]),a._v(" "),t("p",[a._v("The "),t("code",[a._v("<size>")]),a._v(" parameter can be a number of bytes, or can have a suffix of "),t("code",[a._v("k")]),a._v(", "),t("code",[a._v("m")]),a._v(" or "),t("code",[a._v("g")]),a._v(".  The latter specify the size in kilobytes, megabytes and gigabytes respectively.")]),a._v(" "),t("p",[a._v("Examples:")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[a._v("$ java "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Xms512m")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Xmx1024m")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("JavaApp")]),a._v("\n$ java "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("XX"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PermSize")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("64")]),a._v("m "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("XX"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("MaxPermSize")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("128")]),a._v("m "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("JavaApp")]),a._v("\n$ java "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Xss512k")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("JavaApp")]),a._v("\n\n")])])]),t("p",[t("strong",[a._v("Finding the default  sizes:")])]),a._v(" "),t("p",[a._v("The "),t("code",[a._v("-XX:+printFlagsFinal")]),a._v(" option can be used to print the values of all  flags before starting the  JVM.  This can be used to print the defaults for the heap and stack size settings as follows:")]),a._v(" "),t("li",[a._v("\nFor Linux, Unix, Solaris and Mac OSX\n$ java -XX:+PrintFlagsFinal -version | grep -iE 'HeapSize|PermSize|ThreadStackSize'\n")]),a._v(" "),t("li",[a._v("\nFor Windows:\n"),t("blockquote",[a._v('\njava -XX:+PrintFlagsFinal -version | findstr /i "HeapSize PermSize ThreadStackSize"\n')])]),a._v(" "),t("p",[a._v("The output of the above commands will resemble the following:")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[a._v("uintx "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("InitialHeapSize")]),a._v("                          "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("20655360")]),a._v("        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("product"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\nuintx "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("MaxHeapSize")]),a._v("                              "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("331350016")]),a._v("       "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("product"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\nuintx "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PermSize")]),a._v("                                  "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("21757952")]),a._v("        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("pd product"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\nuintx "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("MaxPermSize")]),a._v("                               "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("85983232")]),a._v("        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("pd product"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n intx "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ThreadStackSize")]),a._v("                           "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1024")]),a._v("            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("pd product"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n")])])]),t("p",[a._v("The sizes are given in bytes.")]),a._v(" "),t("h2",{attrs:{id:"garbage-collection"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#garbage-collection"}},[a._v("#")]),a._v(" Garbage collection")]),a._v(" "),t("h3",{attrs:{id:"the-c-approach-new-and-delete"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#the-c-approach-new-and-delete"}},[a._v("#")]),a._v(" The C++ approach - new and delete")]),a._v(" "),t("p",[a._v("In a language like C++, the application program is responsible for managing the memory used by dynamically allocated memory.  When an object is created in the C++ heap using the "),t("code",[a._v("new")]),a._v(" operator, there needs to be a corresponding use of the "),t("code",[a._v("delete")]),a._v(" operator to dispose of the object:")]),a._v(" "),t("li",[a._v('\nIf program forgets to `delete` an object and just "forgets" about it, the associated memory is lost to the application.  The term for this situation is a **memory leak**, and it too much memory leaks an application is liable to use more and more memory, and eventually crash.\n')]),a._v(" "),t("li",[a._v("\nOn the other hand, if an application attempts to `delete` the same object twice, or use an object after it has been deleted, then the application is liable to crash due to problems with memory corruption\n")]),a._v(" "),t("p",[a._v("In a complicated C++ program, implementing memory management using "),t("code",[a._v("new")]),a._v(" and "),t("code",[a._v("delete")]),a._v(" can be time consuming.  Indeed, memory management is a common source of bugs.")]),a._v(" "),t("h3",{attrs:{id:"the-java-approach-garbage-collection"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#the-java-approach-garbage-collection"}},[a._v("#")]),a._v(" The Java approach - garbage collection")]),a._v(" "),t("p",[a._v("Java takes a different approach.  Instead of an explicit "),t("code",[a._v("delete")]),a._v(" operator, Java provides an automatic mechanism known as garbage collection to reclaim the memory used by objects that are no longer needed.  The Java runtime system takes responsibility for finding the objects to be disposed of.  This task is performed by a component called a "),t("strong",[a._v("garbage collector")]),a._v(", or GC for short.")]),a._v(" "),t("p",[a._v("At any time during the execution of a Java program, we can divide the set of all existing objects into two distinct subsets"),t("sup",[a._v("1")]),a._v(":")]),a._v(" "),t("li",[a._v("\nReachable objects are defined by the JLS as follows:\n"),t("blockquote",[a._v("\nA reachable object is any object that can be accessed in any potential continuing computation from any live thread.\n")]),a._v("\nIn practice, this means that there is a chain of references starting from an in-scope local variable or a `static` variable by which some code might be able to reach the object.\n")]),a._v(" "),t("li",[a._v("\nUnreachable objects are objects that **cannot possibly** be reached as above.\n")]),a._v(" "),t("p",[a._v("Any objects that are unreachable are "),t("strong",[a._v("eligible")]),a._v(" for garbage collection.  This does not mean that they "),t("strong",[a._v("will")]),a._v(" be garbage collected.  In fact:")]),a._v(" "),t("ul",[t("li",[a._v("An unreachable object "),t("strong",[a._v("does not")]),a._v(" get collected immediately on becoming unreachable"),t("sup",[a._v("1")]),a._v(".")]),a._v(" "),t("li",[a._v("An unreachable object "),t("strong",[a._v("may not ever")]),a._v(" be garbage collected.")])]),a._v(" "),t("p",[a._v("The Java language Specification gives a lot of latitude to a JVM implementation to decide when to collect unreachable objects.  It also (in practice) gives permission for a JVM implementation to be conservative in how it detects unreachable objects.")]),a._v(" "),t("p",[a._v("The one thing that the JLS guarantees is that no "),t("strong",[a._v("reachable")]),a._v(" objects will ever be garbage collected.")]),a._v(" "),t("h3",{attrs:{id:"what-happens-when-an-object-becomes-unreachable"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#what-happens-when-an-object-becomes-unreachable"}},[a._v("#")]),a._v(" What happens when an object becomes unreachable")]),a._v(" "),t("p",[a._v("First of all, nothing specifically happens when an object "),t("strong",[a._v("becomes")]),a._v(" unreachable.  Things only happen when the garbage collector runs "),t("strong",[a._v("and")]),a._v(" it detects that the object is unreachable.  Furthermore, it is common for a GC run to not detect all unreachable objects.")]),a._v(" "),t("p",[a._v("When the GC detects an unreachable object, the following events can occur.")]),a._v(" "),t("li",[a._v("\nIf there are any `Reference` objects that refer to the object, those references will be cleared before the object is deleted.\n")]),a._v(" "),t("li",[a._v("\nIf the object is **finalizable**, then it will be finalized.  This happens before the object is deleted.\n")]),a._v(" "),t("li",[a._v("\nThe object can be deleted, and the memory it occupies can be reclaimed.\n")]),a._v(" "),t("p",[a._v("Note that there is a clear sequence in which the above events "),t("strong",[a._v("can")]),a._v(" occur, but nothing requires the garbage collector to perform the final deletion of any specific object in any specific time-frame.")]),a._v(" "),t("h3",{attrs:{id:"examples-of-reachable-and-unreachable-objects"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#examples-of-reachable-and-unreachable-objects"}},[a._v("#")]),a._v(" Examples of reachable and unreachable objects")]),a._v(" "),t("p",[a._v("Consider the following example classes:")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v('// A node in simple "open" linked-list.')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Node")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" counter "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" nodeNumber "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("++")]),a._v("counter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Node")]),a._v(" next"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ListTest")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("test")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// M1")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("prinln")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Done"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// M2")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("test")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Node")]),a._v(" n1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Node")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("      "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// T1")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Node")]),a._v(" n2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Node")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("      "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// T2")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Node")]),a._v(" n3 "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Node")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("      "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// T3")]),a._v("\n        n1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("next "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" n2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("              "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// T4")]),a._v("\n        n2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("                 "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// T5")]),a._v("\n        n3 "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("                 "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// T6")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n")])])]),t("p",[a._v("Let us examine what happens when "),t("code",[a._v("test()")]),a._v(" is called.  Statements T1, T2 and T3 create "),t("code",[a._v("Node")]),a._v(" objects, and the objects are all reachable via the "),t("code",[a._v("n1")]),a._v(", "),t("code",[a._v("n2")]),a._v(" and "),t("code",[a._v("n3")]),a._v(" variables respectively.  Statement T4 assigns the reference to the 2nd "),t("code",[a._v("Node")]),a._v(" object to the "),t("code",[a._v("next")]),a._v(" field of the first one.  When that is done, the 2nd "),t("code",[a._v("Node")]),a._v(" is reachable via two paths:")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("\nn2 -> Node2\n n1 -> Node1, Node1.next -> Node2\n\n")])])]),t("p",[a._v("In statement T5, we assign "),t("code",[a._v("null")]),a._v(" to "),t("code",[a._v("n2")]),a._v(".  This breaks the first of the reachability chains for "),t("code",[a._v("Node2")]),a._v(", but the second one remains unbroken, so "),t("code",[a._v("Node2")]),a._v(" is still reachable.")]),a._v(" "),t("p",[a._v("In statement T6, we assign "),t("code",[a._v("null")]),a._v(" to "),t("code",[a._v("n3")]),a._v(".  This breaks the only reachability chain for "),t("code",[a._v("Node3")]),a._v(", which makes "),t("code",[a._v("Node3")]),a._v(" unreachable.  However, "),t("code",[a._v("Node1")]),a._v(" and "),t("code",[a._v("Node2")]),a._v(" are both still reachable via the "),t("code",[a._v("n1")]),a._v(" variable.")]),a._v(" "),t("p",[a._v("Finally, when the "),t("code",[a._v("test()")]),a._v(" method returns, its local variables "),t("code",[a._v("n1")]),a._v(", "),t("code",[a._v("n2")]),a._v(" and "),t("code",[a._v("n3")]),a._v(" go out of scope, and therefore cannot be accessed by anything.  This breaks the remaining reachability chains for "),t("code",[a._v("Node1")]),a._v(" and "),t("code",[a._v("Node2")]),a._v(", and all of the "),t("code",[a._v("Node")]),a._v(" objects are nor unreachable and "),t("strong",[a._v("eligible")]),a._v(" for garbage collection.")]),a._v(" "),t("p",[t("sup",[a._v("1 - This is a simplification that ignores finalization, and "),t("code",[a._v("Reference")]),a._v(" classes.")]),a._v(" "),t("sup",[a._v("2 - Hypothetically, a Java implementation could do this, but the performance cost of doing this makes it impractical.")])]),a._v(" "),t("h2",{attrs:{id:"memory-leaks-in-java"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#memory-leaks-in-java"}},[a._v("#")]),a._v(" Memory leaks in Java")]),a._v(" "),t("p",[a._v("In the "),t("a",{attrs:{href:"http://stackoverflow.com/documentation/java/2804/java-memory-management/9473/garbage-collection#t=201610151259592490802",target:"_blank",rel:"noopener noreferrer"}},[a._v("Garbage collection"),t("OutboundLink")],1),a._v(" example, we implied that Java solves the problem of memory leaks.  This is not actually true.  A Java program can leak memory, though the causes of the leaks are rather different.")]),a._v(" "),t("h3",{attrs:{id:"reachable-objects-can-leak"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#reachable-objects-can-leak"}},[a._v("#")]),a._v(" Reachable objects can leak")]),a._v(" "),t("p",[a._v("Consider the following naive stack implementation.")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("NaiveStack")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" stack "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("100")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" top "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("push")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Object")]),a._v(" obj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("top "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">=")]),a._v(" stack"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("length"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("throw")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("StackException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"stack overflow"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n        stack"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("top"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" obj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Object")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("pop")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("top "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("throw")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("StackException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"stack underflow"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" stack"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("top"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("boolean")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("isEmpty")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" top "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n")])])]),t("p",[a._v("When you "),t("code",[a._v("push")]),a._v(" an object and then immediately "),t("code",[a._v("pop")]),a._v(" it, there will still be a reference to the object in the "),t("code",[a._v("stack")]),a._v(" array.")]),a._v(" "),t("p",[a._v("The logic of the stack implementation means that that reference cannot be returned to a client of the API.  If an object has been popped then we can prove that it cannot "),t("strong",[a._v('"be accessed in any potential continuing computation from any live thread"')]),a._v(".  The problem is that a current generation JVM cannot prove this.  Current generation JVMs do not consider the logic of the program in determining whether references are reachable.  (For a start, it is not practical.)")]),a._v(" "),t("p",[a._v("But setting aside the issue of what "),t("strong",[a._v("reachability")]),a._v(" really means, we clearly have a situation here where the "),t("code",[a._v("NaiveStack")]),a._v(' implementation is "hanging onto" objects that ought to be reclaimed.  That is a memory leak.')]),a._v(" "),t("p",[a._v("In this case, the solution is straightforward:")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('\n   public Object pop() {\n        if (top <= 0) {\n            throw new StackException("stack underflow");\n        }\n        Object popped = stack[--top];\n        stack[top] = null;              // Overwrite popped reference with null.\n        return popped;\n    }\n\n')])])]),t("h3",{attrs:{id:"caches-can-be-memory-leaks"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#caches-can-be-memory-leaks"}},[a._v("#")]),a._v(" Caches can be memory leaks")]),a._v(" "),t("p",[a._v("A common strategy for improving service performance is to cache results.  The idea is that you keep a record of common requests and their results in an in-memory data structure known as a cache.  Then, each time a request is made, you lookup the request in the cache.  If the lookup succeeds, you return the corresponding saved results.")]),a._v(" "),t("p",[a._v("This strategy can be very effective if implemented properly.  However, if implemented incorrectly, a cache can be a memory leak.  Consider the following example:")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("RequestHandler")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Map")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Task")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Result")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" cache "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("HashMap")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Result")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("doRequest")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Task")]),a._v(" task"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Result")]),a._v(" result "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" cache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("task"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("result "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            result "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("doRequestProcessing")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("task"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            cache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("put")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("task"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" result"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" result"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n")])])]),t("p",[a._v("The problem with this code is that while any call to "),t("code",[a._v("doRequest")]),a._v(" could add a new entry to the cache, there is nothing to remove them.  If the service is continually getting different tasks, then the cache will eventually consume all available memory.  This is a form of memory leak.")]),a._v(" "),t("p",[a._v("One approach to solving this is to use a cache with a maximum size, and throw out old entries when the cache exceeds the maximum.  (Throwing out the least recently used entry is a good strategy.)  Another approach is to build the cache using "),t("code",[a._v("WeakHashMap")]),a._v(" so that the JVM can evict cache entries if the heap starts getting too full.")]),a._v(" "),t("h2",{attrs:{id:"finalization"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#finalization"}},[a._v("#")]),a._v(" Finalization")]),a._v(" "),t("p",[a._v("A Java object may declare a "),t("code",[a._v("finalize")]),a._v(" method. This method is called just before Java releases the memory for the object. It will typically look like this:")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("MyClass")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//Methods for the class")]),a._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Override")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("protected")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("finalize")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("throws")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Throwable")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Cleanup code")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n")])])]),t("p",[a._v("However, there some important caveats on the behavior of Java finalization.")]),a._v(" "),t("ul",[t("li",[a._v("Java makes no guarantees about when a "),t("code",[a._v("finalize()")]),a._v(" method will called.")]),a._v(" "),t("li",[a._v("Java does not even guarantee that a "),t("code",[a._v("finalize()")]),a._v(" method will be called some time during the running application's lifetime.")]),a._v(" "),t("li",[a._v("The only thing that is guaranteed is that the method will be called before the object is deleted ... if the object is deleted.")])]),a._v(" "),t("p",[a._v("The caveats above mean that it is a bad idea to rely on the "),t("code",[a._v("finalize")]),a._v(" method to perform cleanup (or other) actions that must be performed in a timely fashion.  Over reliance on finalization can lead to storage leaks, memory leaks and other problems.")]),a._v(" "),t("p",[a._v("In short, there are very few situation where finalization is actually a good solution.")]),a._v(" "),t("h3",{attrs:{id:"finalizers-only-run-once"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#finalizers-only-run-once"}},[a._v("#")]),a._v(" Finalizers only run once")]),a._v(" "),t("p",[a._v("Normally, an object is deleted after it has been finalized.  However, this doesn't happen all of the time.  Consider the following example"),t("sup",[a._v("1")]),a._v(":")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("CaptainJack")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("CaptainJack")]),a._v(" notDeadYet "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("protected")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("finalize")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Resurrection!")]),a._v("\n        notDeadYet "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n")])])]),t("p",[a._v("When an instance of "),t("code",[a._v("CaptainJack")]),a._v(" becomes unreachable and the garbage collector attempts to reclaim it, the "),t("code",[a._v("finalize()")]),a._v(" method will assign a reference to the instance to the "),t("code",[a._v("notDeadYet")]),a._v(" variable.  That will make the instance reachable once more, and the garbage collector won't delete it.")]),a._v(" "),t("p",[a._v("Question:  Is Captain Jack immortal?")]),a._v(" "),t("p",[a._v("Answer: No.")]),a._v(" "),t("p",[a._v("The catch is the JVM will only run a finalizer on an object once in its lifetime.  If you assign "),t("code",[a._v("null")]),a._v(" to "),t("code",[a._v("notDeadYet")]),a._v(" causing a resurected instance to be unreachable once more, the garbage collector won't call "),t("code",[a._v("finalize()")]),a._v(" on the object.")]),a._v(" "),t("p",[t("sup",[a._v("1 - See "),t("a",{attrs:{href:"https://en.wikipedia.org/wiki/Jack_Harkness",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://en.wikipedia.org/wiki/Jack_Harkness"),t("OutboundLink")],1),a._v(".")])]),a._v(" "),t("h2",{attrs:{id:"manually-triggering-gc"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#manually-triggering-gc"}},[a._v("#")]),a._v(" Manually triggering GC")]),a._v(" "),t("p",[a._v("You can manually trigger the Garbage Collector by calling")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("gc")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n")])])]),t("p",[a._v('However, Java does not guarantee that the Garbage Collector has run when the call returns. This method simply "suggests" to the JVM (Java Virtual Machine) that you want it to run the garbage collector, but does not force it to do so.')]),a._v(" "),t("p",[a._v("It is generally considered a bad practice to attempt to manually trigger garbage collection. The JVM can be run with the "),t("code",[a._v("-XX:+DisableExplicitGC")]),a._v(" option to disable calls to "),t("code",[a._v("System.gc()")]),a._v(". Triggering garbage collection by calling "),t("code",[a._v("System.gc()")]),a._v(" can disrupt normal garbage management / object promotion activities of the specific garbage collector implementation in use by the JVM.")]),a._v(" "),t("h4",{attrs:{id:"remarks"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#remarks"}},[a._v("#")]),a._v(" Remarks")]),a._v(" "),t("p",[a._v("In Java, objects are allocated in the heap, and heap memory is reclaimed by automatic garbage collection.  An application program cannot explicitly delete a Java object.")]),a._v(" "),t("p",[a._v("The basic principles of Java garbage collection are described in the "),t("a",{attrs:{href:"http://stackoverflow.com/documentation/java/2804/java-memory-management/9473/garbage-collection#t=201610151259592490802",target:"_blank",rel:"noopener noreferrer"}},[a._v("Garbage collection"),t("OutboundLink")],1),a._v(" example.  Other examples describe finalization, how to trigger the garbage collector by hand, and the problem of storage leaks.")])])}),[],!1,null,null,null);e.default=n.exports}}]);