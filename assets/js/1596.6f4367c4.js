(window.webpackJsonp=window.webpackJsonp||[]).push([[1596],{1945:function(t,e,a){"use strict";a.r(e);var s=a(19),n=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"java-pitfalls-nulls-and-nullpointerexception"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#java-pitfalls-nulls-and-nullpointerexception"}},[t._v("#")]),t._v(" Java Pitfalls - Nulls and NullPointerException")]),t._v(" "),a("h2",{attrs:{id:"pitfall-making-good-unexpected-nulls"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pitfall-making-good-unexpected-nulls"}},[t._v("#")]),t._v(' Pitfall - "Making good" unexpected nulls')]),t._v(" "),a("p",[t._v("On StackOverflow, we often see code like this in Answers:")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("joinStrings")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        a "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("b "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        b "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('": "')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),a("p",[t._v('Often, this is accompanied with an assertion that is "best practice" to test for '),a("code",[t._v("null")]),t._v(" like this to avoid "),a("code",[t._v("NullPointerException")]),t._v(".")]),t._v(" "),a("p",[t._v("Is it best practice?  In short: No.")]),t._v(" "),a("p",[t._v("There are some underlying assumptions that need to be questioned before we can say if it is a good idea to do this in our "),a("code",[t._v("joinStrings")]),t._v(":")]),t._v(" "),a("h3",{attrs:{id:"what-does-it-mean-for-a-or-b-to-be-null"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#what-does-it-mean-for-a-or-b-to-be-null"}},[t._v("#")]),t._v(' What does it mean for "a" or "b" to be null?')]),t._v(" "),a("p",[t._v("A "),a("code",[t._v("String")]),t._v(" value can be zero or more characters, so we already have a way of representing an empty string.  Does "),a("code",[t._v("null")]),t._v(" mean something different to "),a("code",[t._v('""')]),t._v("?  If no, then it is problematic to have two ways to represent an empty string.")]),t._v(" "),a("h3",{attrs:{id:"did-the-null-come-from-an-uninitialized-variable"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#did-the-null-come-from-an-uninitialized-variable"}},[t._v("#")]),t._v(" Did the null come from an uninitialized variable?")]),t._v(" "),a("p",[t._v("A "),a("code",[t._v("null")]),t._v(" can come from an uninitialized field, or an uninitialized array element.  The value could be uninitialized by design, or by accident.  If it was by accident then this is a bug.")]),t._v(" "),a("h3",{attrs:{id:"does-the-null-represent-a-don-t-know-or-missing-value"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#does-the-null-represent-a-don-t-know-or-missing-value"}},[t._v("#")]),t._v(' Does the null represent a "don\'t know" or "missing value"?')]),t._v(" "),a("p",[t._v("Sometimes a "),a("code",[t._v("null")]),t._v(' can have a genuine meaning; e.g. that the real value of a variable is unknown or unavailable or "optional".  In Java 8, the '),a("code",[t._v("Optional")]),t._v(" class provides a better way of expressing that.")]),t._v(" "),a("h3",{attrs:{id:"if-this-is-a-bug-or-a-design-error-should-we-make-good"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#if-this-is-a-bug-or-a-design-error-should-we-make-good"}},[t._v("#")]),t._v(' If this is a bug (or a design error) should we "make good"?')]),t._v(" "),a("p",[t._v('One interpretation of the code is that we are "making good" an unexpected '),a("code",[t._v("null")]),t._v(" by using an empty string in its place.  Is the correct strategy?  Would it be better to let the "),a("code",[t._v("NullPointerException")]),t._v(" happen, and then catch the exception further up the stack and log it as a bug?")]),t._v(" "),a("p",[t._v('The problem with "making good" is that it is liable to either hide the problem, or make it harder to diagnose.')]),t._v(" "),a("h3",{attrs:{id:"is-this-efficient-good-for-code-quality"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#is-this-efficient-good-for-code-quality"}},[t._v("#")]),t._v(" Is this efficient / good for code quality?")]),t._v(" "),a("p",[t._v('If the "make good" approach is used consistently, your code is going to contain a lot of "defensive" null tests.  This is going to make it longer and harder to read.  Furthermore, all of this testing and "making good" is liable to impact on the performance of your application.')]),t._v(" "),a("h3",{attrs:{id:"in-summary"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#in-summary"}},[t._v("#")]),t._v(" In summary")]),t._v(" "),a("p",[t._v("If "),a("code",[t._v("null")]),t._v(" is a meaningful value, then testing for the "),a("code",[t._v("null")]),t._v(" case is the correct approach.  The corollary is that if a "),a("code",[t._v("null")]),t._v(" value is meaningful, then this should be clearly documented in the javadocs of any methods that accept the "),a("code",[t._v("null")]),t._v(" value or return it.")]),t._v(" "),a("p",[t._v("Otherwise, it is a better idea to treat an unexpected "),a("code",[t._v("null")]),t._v(" as a programming error, and let the "),a("code",[t._v("NullPointerException")]),t._v(" happen so that the developer gets to know there is a problem in the code.")]),t._v(" "),a("h2",{attrs:{id:"pitfall-using-null-to-represent-an-empty-array-or-collection"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pitfall-using-null-to-represent-an-empty-array-or-collection"}},[t._v("#")]),t._v(" Pitfall - Using null to represent an empty array or collection")]),t._v(" "),a("p",[t._v("Some programmers think that it is a good idea to save space by using a "),a("code",[t._v("null")]),t._v(" to represent an empty array or collection.  While it is true that you can save a small amount of space, the flipside is that it makes your code more complicated, and more fragile.  Compare these two versions of a method for summing an array:")]),t._v(" "),a("p",[t._v("The first version is how you would normally code the method:")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * Sum the values in an array of integers.\n * @arg values the array to be summed\n * @return the sum\n **/")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" values"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" sum "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" value "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" values"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        sum "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" sum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),a("p",[t._v("The second version is how you need to code the method if you are in the habit of using "),a("code",[t._v("null")]),t._v(" to represent an empty array.")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * Sum the values in an array of integers.\n * @arg values the array to be summed, or null.\n * @return the sum, or zero if the array is null.\n **/")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" values"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" sum "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("values "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" value "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" values"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            sum "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" sum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),a("p",[t._v("As you can see, the code is a bit more complicated.  This is directly attributable to the decision to use "),a("code",[t._v("null")]),t._v(" in this way.")]),t._v(" "),a("p",[t._v("Now consider if this array that might be a "),a("code",[t._v("null")]),t._v(" is used in lots of places.  At each place where you use it, you need to consider whether you need to test for "),a("code",[t._v("null")]),t._v(".  If you miss a "),a("code",[t._v("null")]),t._v(" test that needs to be there, you risk a "),a("code",[t._v("NullPointerException")]),t._v(".  Hence, the strategy of using "),a("code",[t._v("null")]),t._v(" in this way leads to your application being more fragile; i.e. more vulnerable to the consequences of programmer errors.")]),t._v(" "),a("p",[t._v("The lesson here is to use empty arrays and empty lists when that is what you mean.")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" values "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// always empty")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Integer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" list "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ArrayList")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("          "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// initially empty")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Integer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" list "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Collections")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("emptyList")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// always empty")]),t._v("\n\n")])])]),a("p",[t._v("The space overhead is small, and there are other ways to minimize it if this this is a worthwhile thing to do.")]),t._v(" "),a("h2",{attrs:{id:"pitfall-returning-null-instead-of-throwing-an-exception"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pitfall-returning-null-instead-of-throwing-an-exception"}},[t._v("#")]),t._v(" Pitfall - Returning null instead of throwing an exception")]),t._v(" "),a("p",[t._v("Some Java programmers have a general aversion to throwing or propagating exceptions.  This leads to code like the following:")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Reader")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getReader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" pathname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BufferedReader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FileReader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pathname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IOException")]),t._v(" ex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Open failed: "')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" ex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),a("p",[t._v("}")]),t._v(" "),a("p",[t._v("So what is the problem with that?")]),t._v(" "),a("p",[t._v("The problem is that the "),a("code",[t._v("getReader")]),t._v(" is returning a "),a("code",[t._v("null")]),t._v(" as a special value to indicate that the "),a("code",[t._v("Reader")]),t._v(" could not be opened.  Now the returned value needs to be tested to see if it is "),a("code",[t._v("null")]),t._v(" before it is used.  If the test is left out, the result will be a "),a("code",[t._v("NullPointerException")]),t._v(".")]),t._v(" "),a("p",[t._v("There are actually three problems here:")]),t._v(" "),a("ol",[a("li",[t._v("The "),a("code",[t._v("IOException")]),t._v(" was caught too soon.")]),t._v(" "),a("li",[t._v("The structure of this code means that there is a risk of leaking a resource.")]),t._v(" "),a("li",[t._v("A "),a("code",[t._v("null")]),t._v(' was used then returned because no "real" '),a("code",[t._v("Reader")]),t._v(" was available to return.")])]),t._v(" "),a("p",[t._v("In fact, assuming that the exception did need to be caught early like this, there were a couple of alternatives to returning "),a("code",[t._v("null")]),t._v(":")]),t._v(" "),a("ol",[a("li",[t._v("It would be possible to implement a "),a("code",[t._v("NullReader")]),t._v(' class; e.g. one where API\'s operations behaves as if the reader was already at the "end of file" position.')]),t._v(" "),a("li",[t._v("With Java 8, it would be possible to declare "),a("code",[t._v("getReader")]),t._v(" as returning an "),a("code",[t._v("Optional<Reader>")]),t._v(".")])]),t._v(" "),a("h2",{attrs:{id:"pitfall-not-checking-if-an-i-o-stream-isn-t-even-initialized-when-closing-it"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pitfall-not-checking-if-an-i-o-stream-isn-t-even-initialized-when-closing-it"}},[t._v("#")]),t._v(" Pitfall - Not checking if an I/O stream isn't even initialized when closing it")]),t._v(" "),a("p",[t._v("To prevent memory leaks, one should not forget to close an input stream or an output stream whose job is done. This is usually done with a "),a("code",[t._v("try")]),t._v("-"),a("code",[t._v("catch")]),t._v("-"),a("code",[t._v("finally")]),t._v(" statement without the "),a("code",[t._v("catch")]),t._v(" part:")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeNullBytesToAFile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" filename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IOException")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FileOutputStream")]),t._v(" out "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        out "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FileOutputStream")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("filename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" count "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" count"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("write")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("finally")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("close")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),a("p",[t._v("While the above code might look innocent, it has a flaw that can make debugging impossible. If the line where "),a("code",[t._v("out")]),t._v(" is initialized ("),a("code",[t._v("out = new FileOutputStream(filename)")]),t._v(") throws an exception, then "),a("code",[t._v("out")]),t._v(" will be "),a("code",[t._v("null")]),t._v(" when "),a("code",[t._v("out.close()")]),t._v(" is executed, resulting in a nasty "),a("code",[t._v("NullPointerException")]),t._v("!")]),t._v(" "),a("p",[t._v("To prevent this, simply make sure the stream isn't "),a("code",[t._v("null")]),t._v(" before trying to close it.")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeNullBytesToAFile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" filename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IOException")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FileOutputStream")]),t._v(" out "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        out "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FileOutputStream")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("filename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" count "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" count"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("write")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("finally")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("out "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("close")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),a("p",[t._v("An even better approach is to "),a("code",[t._v("try")]),t._v("-with-resources, since it'll automatically close the stream with a probability of 0 to throw an NPE without the need of a "),a("code",[t._v("finally")]),t._v(" block.")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeNullBytesToAFile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" filename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IOException")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FileOutputStream")]),t._v(" out "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FileOutputStream")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("filename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" count "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" count"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("write")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),a("h2",{attrs:{id:"pitfall-unnecessary-use-of-primitive-wrappers-can-lead-to-nullpointerexceptions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pitfall-unnecessary-use-of-primitive-wrappers-can-lead-to-nullpointerexceptions"}},[t._v("#")]),t._v(" Pitfall - Unnecessary use of Primitive Wrappers can lead to NullPointerExceptions")]),t._v(" "),a("p",[t._v("Sometimes, programmers who are new Java will use primitive types and wrappers interchangeably.  This can lead to problems.  Consider this example:")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyRecord")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Integer")]),t._v(" c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyRecord")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("record")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyRecord")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("record")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("a "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("               "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// OK")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("record")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("b "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("record")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("b "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// OK")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("record")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("c "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("               "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// OK")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("record")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("d "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("record")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("d "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// throws a NullPointerException")]),t._v("\n\n")])])]),a("p",[t._v("Our "),a("code",[t._v("MyRecord")]),t._v(" class"),a("sup",[t._v("1")]),t._v(" relies on default initialization to initialize the values on its fields.  Thus, when we "),a("code",[t._v("new")]),t._v(" a record, the "),a("code",[t._v("a")]),t._v(" and "),a("code",[t._v("b")]),t._v(" fields will be set to zero, and the "),a("code",[t._v("c")]),t._v(" and "),a("code",[t._v("d")]),t._v(" fields will be set to "),a("code",[t._v("null")]),t._v(".")]),t._v(" "),a("p",[t._v("When we try to use the default initialized fields, we see that the "),a("code",[t._v("int")]),t._v(" fields works all of the time, but the "),a("code",[t._v("Integer")]),t._v(" fields work in some cases and not others.  Specifically, in the case that fails (with "),a("code",[t._v("d")]),t._v("), what happens is that the expression on the right-hand side attempts to unbox a "),a("code",[t._v("null")]),t._v(" reference, and that is what causes the "),a("code",[t._v("NullPointerException")]),t._v(" to be thrown.")]),t._v(" "),a("p",[t._v("There are a couple of ways to look at this:")]),t._v(" "),a("li",[t._v("\nIf the fields `c` and `d` need to be primitive wrappers, then either we should not be relying on default initialization, or we should be testing for `null`.  For former is the correct approach **unless** there is a definite meaning for the fields in the `null` state.\n")]),t._v(" "),a("li",[t._v("\nIf the fields don't need to be primitive wrappers, then it is a mistake to make them primitive wrappers.  In addition to this problem, the primitive wrappers have extra overheads relative to primitive types.\n")]),t._v(" "),a("p",[t._v("The lesson here is to not use primitive wrapper types unless you really need to.")]),t._v(" "),a("p",[a("sup",[t._v("1 - This class is not an example of good coding practice.  For instance, a well-designed class would not have public fields.  However, that is not the point of this example.")])]),t._v(" "),a("h2",{attrs:{id:"pitfall-using-yoda-notation-to-avoid-nullpointerexception"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pitfall-using-yoda-notation-to-avoid-nullpointerexception"}},[t._v("#")]),t._v(' Pitfall - Using "Yoda notation" to avoid NullPointerException')]),t._v(" "),a("p",[t._v("A lot of example code posted on StackOverflow includes snippets like this:")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"A"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("equals")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("someString"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// do something")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),a("p",[t._v('This does "prevent" or "avoid" a possible '),a("code",[t._v("NullPointerException")]),t._v(" in the case that "),a("code",[t._v("someString")]),t._v(" is "),a("code",[t._v("null")]),t._v(".  Furthermore, it is arguable that")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('\n   "A".equals(someString)\n\n')])])]),a("p",[t._v("is better than:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('\n   someString != null && someString.equals("A")\n\n')])])]),a("p",[t._v("(It is more concise, and in some circumstances it might be more efficient.  However, as we argue below, conciseness could be a negative.)")]),t._v(" "),a("p",[t._v("However, the real pitfall is using the Yoda test "),a("strong",[t._v("to avoid "),a("code",[t._v("NullPointerExceptions")])]),t._v(" as a matter of habit.")]),t._v(" "),a("p",[t._v("When you write "),a("code",[t._v('"A".equals(someString)')]),t._v(' you are actually "making good" the case where '),a("code",[t._v("someString")]),t._v(" happens to be "),a("code",[t._v("null")]),t._v(".  But as another example ("),a("a",{attrs:{href:"http://stackoverflow.com/documentation/java/5680/java-pitfalls-nulls-and-nullpointerexception/20151/pitfall-making-good-unexpected-nulls",target:"_blank",rel:"noopener noreferrer"}},[t._v('Pitfall - "Making good" unexpected nulls'),a("OutboundLink")],1),t._v(' ) explains, "making good" '),a("code",[t._v("null")]),t._v(" values can be harmful for a variety of reasons.")]),t._v(" "),a("p",[t._v('This means that Yoda conditions are not "best practice"'),a("sup",[t._v("1")]),t._v(".  Unless the "),a("code",[t._v("null")]),t._v(" is expected, it is better to let the "),a("code",[t._v("NullPointerException")]),t._v(" happen so that you can get a unit test failure (or a bug report).  That allows you to find and fix the bug that caused the unexpected / unwanted "),a("code",[t._v("null")]),t._v(" to appear.")]),t._v(" "),a("p",[t._v("Yoda conditions should only be used in cases where the "),a("code",[t._v("null")]),t._v(" is "),a("strong",[t._v("expected")]),t._v(" because the object you are testing has come from an API that is "),a("strong",[t._v("documented")]),t._v(" as returning a "),a("code",[t._v("null")]),t._v(".  And arguably, it could be better to use one of the less pretty ways expressing the test because that helps to highlight the "),a("code",[t._v("null")]),t._v(" test to someone who is reviewing your code.")]),t._v(" "),a("p",[a("sup",[t._v("1 - According to "),a("a",{attrs:{href:"https://en.wikipedia.org/wiki/Best_coding_practices",target:"_blank",rel:"noopener noreferrer"}},[t._v("Wikipedia"),a("OutboundLink")],1),t._v(": "),a("strong",[t._v('"Best coding practices are a set of informal rules that the software development community has learned over time which can help improve the quality of software."')]),t._v(".  Using Yoda notation does not achieve this.  In a lot of situations, it makes the code worse.")])]),t._v(" "),a("h4",{attrs:{id:"remarks"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#remarks"}},[t._v("#")]),t._v(" Remarks")]),t._v(" "),a("p",[t._v("The value "),a("code",[t._v("null")]),t._v(" is the default value for an uninitialized value of a field whose type is a reference type.")]),t._v(" "),a("p",[a("code",[t._v("NullPointerException")]),t._v(" (or NPE) is the exception that is thrown when you attempt to perform an inappropriate operation on the "),a("code",[t._v("null")]),t._v(" object reference.  Such operations include:")]),t._v(" "),a("ul",[a("li",[t._v("calling an instance method on a "),a("code",[t._v("null")]),t._v(" target object,")]),t._v(" "),a("li",[t._v("accessing a field of a "),a("code",[t._v("null")]),t._v(" target object,")]),t._v(" "),a("li",[t._v("attempting to index a "),a("code",[t._v("null")]),t._v(" array object or access its length,")]),t._v(" "),a("li",[t._v("using a "),a("code",[t._v("null")]),t._v(" object reference as the mutex in a "),a("code",[t._v("synchronized")]),t._v(" block,")]),t._v(" "),a("li",[t._v("casting a "),a("code",[t._v("null")]),t._v(" object reference,")]),t._v(" "),a("li",[t._v("unboxing a "),a("code",[t._v("null")]),t._v(" object reference, and")]),t._v(" "),a("li",[t._v("throwing a "),a("code",[t._v("null")]),t._v(" object reference.")])]),t._v(" "),a("p",[t._v("The most common root causes for NPEs:")]),t._v(" "),a("ul",[a("li",[t._v("forgetting to initialize a field with a reference type,")]),t._v(" "),a("li",[t._v("forgetting to initialize elements of an array of a reference type, or")]),t._v(" "),a("li",[t._v("not testing the results of certain API methods that are "),a("strong",[t._v("specified")]),t._v(" as returning "),a("code",[t._v("null")]),t._v(" in certain circumstances.")])]),t._v(" "),a("p",[t._v("Examples of commonly used methods that return "),a("code",[t._v("null")]),t._v(" include:")]),t._v(" "),a("ul",[a("li",[t._v("The "),a("code",[t._v("get(key)")]),t._v(" method in the "),a("code",[t._v("Map")]),t._v(" API will return a "),a("code",[t._v("null")]),t._v(" if you call it with a key that doesn't have a mapping.")]),t._v(" "),a("li",[t._v("The "),a("code",[t._v("getResource(path)")]),t._v(" and "),a("code",[t._v("getResourceAsStream(path)")]),t._v(" methods in the "),a("code",[t._v("ClassLoader")]),t._v(" and "),a("code",[t._v("Class")]),t._v(" APIs will return "),a("code",[t._v("null")]),t._v(" if the resource cannot be found.")]),t._v(" "),a("li",[t._v("The "),a("code",[t._v("get()")]),t._v(" method in the "),a("code",[t._v("Reference")]),t._v(" API will return "),a("code",[t._v("null")]),t._v(" if the garbage collector has cleared the reference.")]),t._v(" "),a("li",[t._v("Various "),a("code",[t._v("getXxxx")]),t._v(" methods in the Java EE servlet APIs will return "),a("code",[t._v("null")]),t._v(" if you attempt fetch a non-existent request parameter, session or session attribute and so on.")])]),t._v(" "),a("p",[t._v("There are strategies for avoiding unwanted NPEs, such as explicitly testing for "),a("code",[t._v("null")]),t._v(' or using "Yoda Notation", but these strategies often have the undesirable result of '),a("strong",[t._v("hiding")]),t._v(" problems in your code that really ought to be fixed.")])])}),[],!1,null,null,null);e.default=n.exports}}]);