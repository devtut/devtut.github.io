(window.webpackJsonp=window.webpackJsonp||[]).push([[2616],{3025:function(t,s,e){"use strict";e.r(s);var a=e(31),n=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"powershell-remoting"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#powershell-remoting"}},[t._v("#")]),t._v(" Powershell Remoting")]),t._v(" "),e("h2",{attrs:{id:"enabling-powershell-remoting"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#enabling-powershell-remoting"}},[t._v("#")]),t._v(" Enabling PowerShell Remoting")]),t._v(" "),e("p",[t._v("PowerShell remoting must first be enabled on the server to which you wish to remotely connect.")]),t._v(" "),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Enable-PSRemoting")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Force\n\n")])])]),e("p",[t._v("This command does the following:")]),t._v(" "),e("ul",[e("li",[t._v("Runs the Set-WSManQuickConfig cmdlet, which performs the following tasks:")]),t._v(" "),e("li",[t._v("Starts the WinRM service.")]),t._v(" "),e("li",[t._v("Sets the startup type on the WinRM service to Automatic.")]),t._v(" "),e("li",[t._v("Creates a listener to accept requests on any IP address, if one does not already exist.")]),t._v(" "),e("li",[t._v("Enables a firewall exception for WS-Management communications.")]),t._v(" "),e("li",[t._v("Registers the Microsoft.PowerShell and Microsoft.PowerShell.Workflow session configurations, if it they are not already registered.")]),t._v(" "),e("li",[t._v("Registers the Microsoft.PowerShell32 session configuration on 64-bit computers, if it is not already registered.")]),t._v(" "),e("li",[t._v("Enables all session configurations.")]),t._v(" "),e("li",[t._v("Changes the security descriptor of all session configurations to allow remote access.")]),t._v(" "),e("li",[t._v("Restarts the WinRM service to make the preceding changes effective.")])]),t._v(" "),e("h3",{attrs:{id:"only-for-non-domain-environments"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#only-for-non-domain-environments"}},[t._v("#")]),t._v(" Only for non-domain environments")]),t._v(" "),e("p",[t._v("For servers in an AD Domain the PS remoting authentication is done through Kerberos ('Default'), or NTLM ('Negotiate'). If you want to allow remoting to a non-domain server you have two options.")]),t._v(" "),e("p",[t._v("Either set up WSMan communication over HTTPS (which requires certificate generation) or enable basic authentication which sends your credentials across the wire base64-encoded (that's basically the same as plain-text so be careful with this).")]),t._v(" "),e("p",[t._v("In either case you'll have to add the remote systems to your WSMan trusted hosts list.")]),t._v(" "),e("h3",{attrs:{id:"enabling-basic-authentication"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#enabling-basic-authentication"}},[t._v("#")]),t._v(" Enabling Basic Authentication")]),t._v(" "),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Set-Item")]),t._v(" WSMan:\\localhost\\Service\\AllowUnencrypted "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("$true")]),t._v("  \n\n")])])]),e("p",[t._v("Then on the computer you wish to connect "),e("strong",[t._v("from")]),t._v(", you must tell it to trust the computer you're connecting "),e("strong",[t._v("to")]),t._v(".")]),t._v(" "),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Set-Item")]),t._v(" WSMan:\\localhost\\Client\\TrustedHosts "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'192.168.1.1,192.168.1.2'")]),t._v("\n\n")])])]),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Set-Item")]),t._v(" WSMan:\\localhost\\Client\\TrustedHosts "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("contoso"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com\n\n")])])]),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Set-Item")]),t._v(" WSMan:\\localhost\\Client\\TrustedHosts "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n\n")])])]),e("p",[e("strong",[t._v("Important")]),t._v(": You must tell your client to trust the computer addressed in the way you want to connect (e.g. if you connect via IP, it must trust the IP not the hostname)")]),t._v(" "),e("h2",{attrs:{id:"connecting-to-a-remote-server-via-powershell"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#connecting-to-a-remote-server-via-powershell"}},[t._v("#")]),t._v(" Connecting to a Remote Server via PowerShell")]),t._v(" "),e("p",[t._v("Using credentials from your local computer:")]),t._v(" "),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Enter-PSSession")]),t._v(" 192"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("168"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("1\n\n")])])]),e("p",[t._v("Prompting for credentials on the remote computer")]),t._v(" "),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Enter-PSSession")]),t._v(" 192"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("168"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("1 "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Credential $"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Get-Credential")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])])]),e("h2",{attrs:{id:"run-commands-on-a-remote-computer"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#run-commands-on-a-remote-computer"}},[t._v("#")]),t._v(" Run commands on a Remote Computer")]),t._v(" "),e("p",[t._v("Once Powershell remoting is enabled (Enable-PSRemoting) You can run commands on the remote computer like this:")]),t._v(" "),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Invoke-Command")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ComputerName "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"RemoteComputerName"')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ScriptBlock "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Write")]),t._v(" host "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Remote Computer Name: '),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ENV")]),t._v(':ComputerName"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),e("p",[t._v("The above method creates a temporary session and closes it right after the command or scriptblock ends.")]),t._v(" "),e("p",[t._v("To leave the session open and run other command in it later, you need to create a remote session first:")]),t._v(" "),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$Session")]),t._v(" = "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("New-PSSession")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ComputerName "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"RemoteComputerName"')]),t._v("\n\n")])])]),e("p",[t._v("Then you can use this session each time you invoke commands on the remote computer:")]),t._v(" "),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Invoke-Command")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Session "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$Session")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ScriptBlock "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Write")]),t._v(" host "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Remote Computer Name: '),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ENV")]),t._v(':ComputerName"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Invoke-Command")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Session "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$Session")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ScriptBlock "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Get-Date")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),e("p",[t._v("If you need to use different Credentials, you can add them with the "),e("code",[t._v("-Credential")]),t._v(" Parameter:")]),t._v(" "),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$Cred")]),t._v(" = "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Get-Credential")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Invoke-Command")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Session "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$Session")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Credential "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$Cred")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ScriptBlock "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),e("h3",{attrs:{id:"remoting-serialization-warning"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#remoting-serialization-warning"}},[t._v("#")]),t._v(" Remoting serialization warning")]),t._v(" "),e("blockquote"),t._v(" "),e("p",[t._v("Note:\n")]),e("p",[t._v("It is important to know that remoting serializes PowerShell\nobjects on the remote system and deserializes them on your end of the\nremoting session, i.e. they are converted to XML during transport and\nlose all of their methods.")]),e("p"),t._v(" "),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$output")]),t._v(" = "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Invoke-Command")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Session "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$Session")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ScriptBlock "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Get-WmiObject")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Class")]),t._v(" win32_printer\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$output")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Get-Member")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("MemberType Method\n\n  TypeName: Deserialized"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("System"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Management"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ManagementObject"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#root\\cimv2\\Win32_Printer")]),t._v("\n\nName     MemberType Definition\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("-"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("     "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("-"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("-"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("-"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("-"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("-"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("-"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("\nGetType  Method     "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("type")]),t._v(" GetType"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nToString Method     string ToString"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" string ToString"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("string format"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" System"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("IFormatProvi"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n")])])]),e("p",[t._v("Whereas you have the methods on the regular PS object:")]),t._v(" "),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Get-WmiObject")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Class")]),t._v(" win32_printer "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Get-Member")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("MemberType Method\n\n TypeName: System"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Management"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ManagementObject"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#root\\cimv2\\Win32_Printer")]),t._v("\n\nName                  MemberType Definition                                                                                                                          \n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("-"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("                  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("-"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("-"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("-"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("-"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("-"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("-"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("                                                                                                                          \nCancelAllJobs         Method     System"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Management"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ManagementBaseObject CancelAllJobs"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("                                                                              \nGetSecurityDescriptor Method     System"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Management"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ManagementBaseObject GetSecurityDescriptor"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("                                                                      \nPause                 Method     System"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Management"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ManagementBaseObject Pause"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("                                                                                      \nPrintTestPage         Method     System"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Management"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ManagementBaseObject PrintTestPage"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("                                                                              \nRenamePrinter         Method     System"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Management"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ManagementBaseObject RenamePrinter"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("System"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("String NewPrinterName"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("                                                  \nReset                 Method     System"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Management"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ManagementBaseObject Reset"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("                                                                                      \nResume                Method     System"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Management"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ManagementBaseObject Resume"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("                                                                                     \nSetDefaultPrinter     Method     System"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Management"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ManagementBaseObject SetDefaultPrinter"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("                                                                          \nSetPowerState         Method     System"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Management"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ManagementBaseObject SetPowerState"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("System"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("UInt16 PowerState"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" System"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("String Time"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("                                  \nSetSecurityDescriptor Method     System"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Management"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ManagementBaseObject SetSecurityDescriptor"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("System"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Management"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ManagementObject"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#Win32_SecurityDescriptor Descriptor)")]),t._v("\n\n")])])]),e("h3",{attrs:{id:"argument-usage"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#argument-usage"}},[t._v("#")]),t._v(" Argument Usage")]),t._v(" "),e("p",[t._v("To use arguments as parameters for the remote scripting block, one might either use the "),e("code",[t._v("ArgumentList")]),t._v(" parameter of "),e("code",[t._v("Invoke-Command")]),t._v(", or use the "),e("code",[t._v("$Using:")]),t._v(" syntax.")]),t._v(" "),e("p",[t._v("Using "),e("code",[t._v("ArgumentList")]),t._v(" with unnamed parameters (i.e. in the order they are passed to the scriptblock):")]),t._v(" "),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$servicesToShow")]),t._v(" = "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"service1"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$fileName")]),t._v(" = "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"C:\\temp\\servicestatus.csv"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Invoke-Command")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Session "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$session")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ArgumentList "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$servicesToShow")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$fileName")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ScriptBlock "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Write-Host")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Calling script block remotely with '),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("$"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$Args")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Count"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")])]),t._v('"')]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Get-Service")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Name "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$args")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("0"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Remove-Item")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Path "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$args")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ErrorAction SilentlyContinue "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Force\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),e("p",[t._v("Using "),e("code",[t._v("ArgumentList")]),t._v(" with named parameters:")]),t._v(" "),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$servicesToShow")]),t._v(" = "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"service1"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$fileName")]),t._v(" = "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"C:\\temp\\servicestatus.csv"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Invoke-Command")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Session "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$session")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ArgumentList "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$servicesToShow")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$fileName")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ScriptBlock "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Param")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$serviceToShowInRemoteSession")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$fileToDelete")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Write-Host")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Calling script block remotely with '),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("$"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$Args")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Count"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")])]),t._v('"')]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Get-Service")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Name "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$serviceToShowInRemoteSession")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Remove-Item")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Path "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$fileToDelete")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ErrorAction SilentlyContinue "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Force\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),e("p",[t._v("Using "),e("code",[t._v("$Using:")]),t._v(" syntax:")]),t._v(" "),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$servicesToShow")]),t._v(" = "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"service1"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$fileName")]),t._v(" = "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"C:\\temp\\servicestatus.csv"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Invoke-Command")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Session "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$session")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ScriptBlock "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Get-Service")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$Using")]),t._v(":servicesToShow\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Remove-Item")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Path "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$fileName")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ErrorAction SilentlyContinue "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Force\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),e("h2",{attrs:{id:"a-best-practise-for-automatically-cleaning-up-pssessions"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#a-best-practise-for-automatically-cleaning-up-pssessions"}},[t._v("#")]),t._v(" A best practise for automatically cleaning-up PSSessions")]),t._v(" "),e("p",[t._v("When a remote session is created via the "),e("code",[t._v("New-PSsession")]),t._v(" cmdlet, the PSSession persists until the current PowerShell session ends.\nMeaning that, by default, the "),e("code",[t._v("PSSession")]),t._v(" and all associated resources will continue to be used until the current PowerShell session ends.")]),t._v(" "),e("p",[t._v("Multiple active "),e("code",[t._v("PSSessions")]),t._v(" can become a strain on resources, particularly for long running or interlinked scripts that create hundreds of "),e("code",[t._v("PSSessions")]),t._v(" in a single PowerShell session.")]),t._v(" "),e("p",[t._v("It is best practise to explicitly remove each "),e("code",[t._v("PSSession")]),t._v(" after it is finished being used. [1]")]),t._v(" "),e("p",[t._v("The following code template utilises "),e("code",[t._v("try-catch-finally")]),t._v(" in order to achieve the above, combining error handling with a secure way to ensure all created "),e("code",[t._v("PSSessions")]),t._v(" are removed when they are finished being used:")]),t._v(" "),e("div",{staticClass:"language-powershell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$session")]),t._v(" = "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("New-PSsession")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Computername "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"RemoteMachineName"')]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Invoke-Command")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Session "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$session")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ScriptBlock "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("write-host")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"This is running on '),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ENV")]),t._v(':ComputerName"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Write-Output")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ERROR: '),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$_")]),t._v('"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("finally")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$session")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Remove-PSSession")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$session")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),e("p",[t._v("References:\n[1] "),e("a",{attrs:{href:"https://msdn.microsoft.com/en-us/powershell/reference/5.1/microsoft.powershell.core/new-pssession",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://msdn.microsoft.com/en-us/powershell/reference/5.1/microsoft.powershell.core/new-pssession"),e("OutboundLink")],1)]),t._v(" "),e("h4",{attrs:{id:"remarks"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#remarks"}},[t._v("#")]),t._v(" Remarks")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://technet.microsoft.com/en-us/library/hh847900.aspx",target:"_blank",rel:"noopener noreferrer"}},[t._v("about_Remote"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://technet.microsoft.com/en-us/library/hh847845.aspx",target:"_blank",rel:"noopener noreferrer"}},[t._v("about_RemoteFAQ"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://technet.microsoft.com/en-us/library/hh847850.aspx",target:"_blank",rel:"noopener noreferrer"}},[t._v("about_RemoteTroubleshooting"),e("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=n.exports}}]);