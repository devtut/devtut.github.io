(window.webpackJsonp=window.webpackJsonp||[]).push([[1593],{1938:function(t,e,a){"use strict";a.r(e);var n=a(19),s=Object(n.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"java-performance-tuning"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#java-performance-tuning"}},[t._v("#")]),t._v(" Java Performance Tuning")]),t._v(" "),a("h2",{attrs:{id:"reducing-amount-of-strings"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#reducing-amount-of-strings"}},[t._v("#")]),t._v(" Reducing amount of Strings")]),t._v(" "),a("p",[t._v('In Java, it\'s too "easy" to create many String instances which are not needed. That and other reasons might cause your program to have lots of Strings that the GC is busy cleaning up.')]),t._v(" "),a("p",[t._v("Some ways you might be creating String instances:")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("myString "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"foo"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])])]),a("p",[t._v("Or worse, in a loop or recursion:")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("N")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    myString "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"foo"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),a("p",[t._v("The problem is that each "),a("code",[t._v("+")]),t._v(" creates a new String (usually, since new compilers optimize some cases). A possible optimization can be made using "),a("code",[t._v("StringBuilder")]),t._v(" or "),a("code",[t._v("StringBuffer")]),t._v(":")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StringBuffer")]),t._v(" sb "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StringBuffer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("myString"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("N")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    sb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("append")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"foo"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("append")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nmyString "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" sb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])])]),a("p",[t._v("If you build long Strings often (SQLs for example), use a String building API.")]),t._v(" "),a("p",[t._v("Other things to consider:")]),t._v(" "),a("ul",[a("li",[t._v("Reduce usage of "),a("code",[t._v("replace")]),t._v(", "),a("code",[t._v("substring")]),t._v(" etc.")]),t._v(" "),a("li",[t._v("Avoid "),a("code",[t._v("String.toArray()")]),t._v(", especially in frequently accessed code.")]),t._v(" "),a("li",[t._v("Log prints which are destined to be filtered (due to log level for example) should not be generated (log level should be checked in advance).")]),t._v(" "),a("li",[t._v("Use libraries like "),a("a",{attrs:{href:"https://commons.apache.org/proper/commons-lang/",target:"_blank",rel:"noopener noreferrer"}},[t._v("this"),a("OutboundLink")],1),t._v(" if necessary.")]),t._v(" "),a("li",[t._v("StringBuilder is better if the variable is used in a non-shared manner (across threads).")])]),t._v(" "),a("h2",{attrs:{id:"an-evidence-based-approach-to-java-performance-tuning"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#an-evidence-based-approach-to-java-performance-tuning"}},[t._v("#")]),t._v(" An evidence-based approach to Java performance tuning")]),t._v(" "),a("p",[t._v("Donald Knuth is often quoted as saying this:")]),t._v(" "),a("blockquote"),t._v(" "),a("p",[t._v('"Programmers waste enormous amounts of time thinking about, or worrying about, the speed of noncritical parts of their programs, and these attempts at efficiency actually have a strong negative impact when debugging and maintenance are considered. '),a("strong",[t._v("We should forget about small efficiencies, say about 97% of the time")]),t._v(': premature optimization is the root of all evil. Yet we should not pass up our opportunities in that critical 3%."')]),t._v(" "),a("p",[a("a",{attrs:{href:"https://en.wikiquote.org/wiki/Donald_Knuth#Computer_Programming_as_an_Art_.281974.29",target:"_blank",rel:"noopener noreferrer"}},[t._v("source"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("Bearing that sage advice in mind, here is the recommended procedure for optimizing programs:")]),t._v(" "),a("li",[t._v("\nFirst of all, design and code your program or library with a focus on simplicity and correctness.  To start with, don't spend much effort on performance.\n")]),t._v(" "),a("li",[t._v("\nGet it to a working state, and (ideally) develop unit tests for the key parts of the codebase.\n")]),t._v(" "),a("li",[t._v("\nDevelop an application level performance benchmark.  The benchmark should cover the performance critical aspects of your application, and should perform a range of tasks that are typical of how the application will be used in production.\n")]),t._v(" "),a("li",[t._v("\nMeasure the performance.\n")]),t._v(" "),a("li",[t._v('\nCompare the measured performance against your criteria for how fast the application needs to be.  (Avoid unrealistic, unattainable or unquantifiable criteria such as "as fast as possible".)\n')]),t._v(" "),a("li",[t._v("\nIf you have met the criteria, STOP.  You job is done.  (Any further effort is probably a waste of time.)\n")]),t._v(" "),a("li",[t._v("\nProfile the application while it is running your performance benchmark.\n")]),t._v(" "),a("li",[t._v('\nExamine the profiling results and pick the biggest (unoptimized) "performance hotspots"; i.e. sections of the code where the application seems to be spending the most time.\n')]),t._v(" "),a("li",[t._v("\nAnalyse the hotspot code section to try to understand why it is a bottleneck, and think of a way to make it faster.\n")]),t._v(" "),a("li",[t._v("\nImplement that as a proposed code change, test and debug.\n")]),t._v(" "),a("li",[t._v("\nRerun the benchmark to see if the code change has improved the performance:\n"),a("ul",[t._v("\n1. If Yes, then return to step 4.\n1. If No, then abandon the change and return to step 9.  If you are making no progress, pick a different hotspot for your attention.\n")])]),t._v(" "),a("p",[t._v("Eventually you will get to a point where the application is either fast enough, or you have considered all of the significant hotspots.  At this point you need to stop this approach.  If a section of code is consuming (say) 1% of the overall time, then even a 50% improvement is only going to make the application 0.5% faster overall.")]),t._v(" "),a("p",[t._v("Clearly, there is a point beyond which hotspot optimization is a waste of effort.  If you get to that point, you need to take a more radical approach.  For example:")]),t._v(" "),a("ul",[a("li",[t._v("Look at the algorithmic complexity of your core algorithms.")]),t._v(" "),a("li",[t._v("If the application is spending a lot of time garbage collection, look for ways to reduce the rate of object creation.")]),t._v(" "),a("li",[t._v("If key parts of the application are CPU intensive and single-threaded, look for opportunities for parallelism.")]),t._v(" "),a("li",[t._v("If the application is already multi-threaded, look for concurrency bottlenecks.")])]),t._v(" "),a("p",[t._v("But wherever possible, rely on tools and measurement rather than instinct to direct your optimization effort.")]),t._v(" "),a("h2",{attrs:{id:"general-approach"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#general-approach"}},[t._v("#")]),t._v(" General approach")]),t._v(" "),a("p",[t._v("The internet is packed with tips for performance improvement of Java programs. Perhaps the number one tip is awareness. That means:")]),t._v(" "),a("ul",[a("li",[t._v("Identify possible performance problems and bottlenecks.")]),t._v(" "),a("li",[t._v("Use analyzing and testing tools.")]),t._v(" "),a("li",[t._v("Know good practices and bad practices.")])]),t._v(" "),a("p",[t._v("The first point should be done during the design stage if speaking about a new system or module. If speaking about legacy code, analyzing and testing tools come into the picture. The most basic tool for analyzing your JVM performance is JVisualVM, which is included in the JDK.")]),t._v(" "),a("p",[t._v("The third point is mostly about experience and extensive research, and of course raw tips that will show up on this page and others, like "),a("a",{attrs:{href:"http://javaperformancetuning.com/tips/rawtips.shtml",target:"_blank",rel:"noopener noreferrer"}},[t._v("this"),a("OutboundLink")],1),t._v(".")])])}),[],!1,null,null,null);e.default=s.exports}}]);