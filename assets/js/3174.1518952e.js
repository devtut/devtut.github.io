(window.webpackJsonp=window.webpackJsonp||[]).push([[3174],{3583:function(t,s,a){"use strict";a.r(s);var e=a(31),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"rails-engine-modular-rails"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rails-engine-modular-rails"}},[t._v("#")]),t._v(" Rails Engine -  Modular Rails")]),t._v(" "),a("p",[a("strong",[t._v("Quick overview of Rails engines")])]),t._v(" "),a("p",[t._v("Engines are small Rails applications that can be used to add functionalities to the application hosting them. The class defining a Ruby on Rails application is "),a("code",[t._v("Rails::Application")]),t._v(" which actually inherits a lot of its behavior from "),a("code",[t._v("Rails::Engine")]),t._v(", the class defining an engine. We can say that a regular Rails application is simply an engine with more features.")]),t._v(" "),a("h2",{attrs:{id:"create-a-modular-app"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#create-a-modular-app"}},[t._v("#")]),t._v(" Create a modular app")]),t._v(" "),a("p",[t._v("First, let’s generate a new Ruby on Rails application:")]),t._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[t._v("rails "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ModularTodo")]),t._v("\n\n")])])]),a("p",[t._v("The next step is to generate an engine!")]),t._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[t._v("cd "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ModularTodo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" rails plugin "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" todo "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("mountable\n\n")])])]),a("p",[t._v("We will also create an ‘engines’ folder to store the engines (even if we just have one!).")]),t._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[t._v("mkdir engines "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" mv todo "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("engines\n\n")])])]),a("p",[t._v("Engines, just like gems, come with a gemspec file. Let’s put some real values to avoid warnings.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('\n#ModularTodo/engines/todo/todo.gemspec\n$:.push File.expand_path("../lib", __FILE__)\n\n#Maintain your gem\'s version:\nrequire "todo/version"\n\n#Describe your gem and declare its dependencies:\nGem::Specification.new do |s|\n  s.name        = "todo"\n  s.version     = Todo::VERSION\n  s.authors     = ["Thibault Denizet"]\n  s.email       = ["bo@samurails.com"]\n  s.homepage    = "//samurails.com"\n  s.summary     = "Todo Module"\n  s.description = "Todo Module for Modular Rails article"\n  s.license     = "MIT"\n\n  #Moar stuff\n  #...\nend\n\n')])])]),a("p",[a("br"),t._v("Now we need to add the Todo engine to the parent application Gemfile."),a("br")]),t._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#ModularTodo/Gemfile")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#Other gems")]),t._v("\ngem "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'todo'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'engines/todo'")]),t._v("\n\n")])])]),a("p",[t._v("Let’s run "),a("code",[t._v("bundle install")]),t._v(". You should see the following in the list of gems:")]),t._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Using")]),t._v(" todo "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),t._v(" from source at engines"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("todo\n\n")])])]),a("p",[t._v("Great, our Todo engine is loaded correctly! Before we start coding, we have one last thing to do: mount the Todo engine. We can do that in the routes.rb file in the parent app.")]),t._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Rails")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("application"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("routes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("draw "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v("\n  mount "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Todo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Engine")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" as"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'todo'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n")])])]),a("p",[t._v("We are mounting it at "),a("code",[t._v("/")]),t._v(" but we could also make it accessible at "),a("code",[t._v("/todo")]),t._v(". Since we have only one module, "),a("code",[t._v("/")]),t._v(" is fine.")]),t._v(" "),a("p",[t._v("Now you can fire up your server and check it in your browser. You should see the default Rails view because we didn’t define any controllers/views yet. Let’s do that now!")]),t._v(" "),a("h3",{attrs:{id:"building-the-todo-list"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#building-the-todo-list"}},[t._v("#")]),t._v(" Building the Todo list")]),t._v(" "),a("p",[t._v("We are going to scaffold a model named "),a("code",[t._v("Task")]),t._v(" inside the Todo module but to correctly migrate the database from the parent application, we need to add a small initializer to the "),a("code",[t._v("engine.rb")]),t._v(" file.")]),t._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#ModularTodo/engines/todo/lib/todo/engine.rb")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("module")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Todo")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Engine")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Rails")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Engine")]),t._v("\n    isolate_namespace "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Todo")]),t._v("\n\n    initializer "),a("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":append_migrations")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("unless")]),t._v(" app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("to_s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("match"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("to_s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("paths"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"db/migrate"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("expanded"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("each")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("p"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n          app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("paths"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"db/migrate"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" p\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n")])])]),a("p",[t._v("That’s it, now when we run migrations from the parent application, the migrations in the Todo engine will be loaded too.")]),t._v(" "),a("p",[a("br"),t._v("Let’s create the "),a("code",[t._v("Task")]),t._v(" model. The "),a("code",[t._v("scaffold")]),t._v(" command needs to be run from the engine folder.")]),t._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[t._v("cd engines"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("todo "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" rails g scaffold "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Task")]),t._v(" title"),a("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":string")]),t._v(" content"),a("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":text")]),t._v("\n\n")])])]),a("p",[t._v("Run the migrations from the parent folder:")]),t._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[t._v("rake db"),a("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":migrate")]),t._v("\n\n")])])]),a("p",[t._v("Now, we just need to define the root route inside the Todo engine:")]),t._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#ModularTodo/engines/todo/config/routes.rb")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Todo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Engine")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("routes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("draw "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v("\n  resources "),a("span",{pre:!0,attrs:{class:"token symbol"}},[t._v(":tasks")]),t._v("\n  root "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'tasks#index'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n")])])]),a("p",[t._v("You can play with it, create tasks, delete them… Oh wait, the delete is not working! Why?! Well, it seems JQuery is not loaded, so let’s add it to the "),a("code",[t._v("application.js")]),t._v(" file inside the engine!")]),t._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ModularTodo")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("engines"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("todo"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("assets"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("javascripts"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("todo"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("application"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("require")]),t._v(" jquery\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("require")]),t._v(" jquery_ujs\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" require_tree "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n")])])]),a("p",[t._v("Yay, now we can destroy tasks!")]),t._v(" "),a("h4",{attrs:{id:"syntax"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#syntax"}},[t._v("#")]),t._v(" Syntax")]),t._v(" "),a("ul",[a("li",[t._v("rails plugin new my_module --mountable")])])])}),[],!1,null,null,null);s.default=n.exports}}]);