(window.webpackJsonp=window.webpackJsonp||[]).push([[2058],{2466:function(s,t,a){"use strict";a.r(t);var e=a(31),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"service-broker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#service-broker"}},[s._v("#")]),s._v(" Service broker")]),s._v(" "),a("h2",{attrs:{id:"_1-basics"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-basics"}},[s._v("#")]),s._v(" 1. Basics")]),s._v(" "),a("p",[s._v("Service broker is technology based on asyncronous communication between two(or more) entities.\nService broker consists of:\nmessage types,\ncontracts,\nqueues,\nservices,\nroutes,\nand at least instance endpoints")]),s._v(" "),a("p",[s._v("More: "),a("a",{attrs:{href:"https://msdn.microsoft.com/en-us/library/bb522893.aspx",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://msdn.microsoft.com/en-us/library/bb522893.aspx"),a("OutboundLink")],1)]),s._v(" "),a("h2",{attrs:{id:"_2-enable-service-broker-on-database"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-enable-service-broker-on-database"}},[s._v("#")]),s._v(" 2. Enable service broker on database")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALTER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DATABASE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("MyDatabase"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" ENABLE_BROKER "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WITH")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ROLLBACK")]),s._v(" IMMEDIATE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n")])])]),a("h2",{attrs:{id:"_3-create-basic-service-broker-construction-on-database-single-database-communication"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-create-basic-service-broker-construction-on-database-single-database-communication"}},[s._v("#")]),s._v(" 3. Create basic service broker construction on database (single database communication)")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("MyDatabase"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  \n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" MESSAGE "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TYPE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//initiator] VALIDATION = WELL_FORMED_XML;")]),s._v("\n    GO\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" CONTRACT "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//call/contract]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//initiator] SENT BY INITIATOR ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nGO\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" QUEUE  InitiatorQueue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nGO\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" QUEUE  TargetQueue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nGO\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" SERVICE InitiatorService\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" QUEUE InitiatorQueue\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//call/contract]    ")]),s._v("\n      \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" SERVICE TargetService\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" QUEUE TargetQueue \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//call/contract]    ")]),s._v("\n      \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" SEND "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" SERVICE::"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("InitiatorService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PUBLIC")]),s._v("\nGO\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" SEND "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" SERVICE::"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("TargetService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PUBLIC")]),s._v("\nGO\n\n")])])]),a("p",[s._v("We dont need route for one database communication.")]),s._v(" "),a("h2",{attrs:{id:"_4-how-to-send-basic-communication-through-service-broker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-how-to-send-basic-communication-through-service-broker"}},[s._v("#")]),s._v(" 4. How to send basic communication through service broker")]),s._v(" "),a("p",[s._v("For this demonstration we will use service broker construction created in another part of this documentation. Mentioned part is named "),a("strong",[s._v("3. Create basic service broker construction on database (single database communication)")]),s._v(".")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("MyDatabase"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DECLARE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@ch")]),s._v(" uniqueidentifier "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" NEWID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DECLARE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@msg")]),s._v(" XML \n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BEGIN")]),s._v(" DIALOG CONVERSATION "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@ch")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" SERVICE "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("InitiatorService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" SERVICE "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'TargetService'")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" CONTRACT "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//call/contract]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WITH")]),s._v(" ENCRYPTION "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OFF")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- more possible options")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@msg")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'HelloThere'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"elementNum1"')]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FOR")]),s._v(" XML PATH"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ROOT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ExampleRoot'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ELEMENTS XSINIL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TYPE")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("         \n      \nSEND "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" CONVERSATION "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@ch")]),s._v(" MESSAGE "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TYPE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//initiator] (@msg);")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v(" CONVERSATION "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@ch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n")])])]),a("p",[s._v("After this conversation will be your msg in TargetQueue")]),s._v(" "),a("h2",{attrs:{id:"_5-how-to-receive-conversation-from-targetqueue-automatically"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-how-to-receive-conversation-from-targetqueue-automatically"}},[s._v("#")]),s._v(" 5. How to receive conversation from TargetQueue automatically")]),s._v(" "),a("p",[s._v("For this demonstration we will use service broker construction created in another part of this documentation. Mentioned part is called "),a("strong",[s._v("3. Create basic service broker construction on database (single database communication)")]),s._v(".")]),s._v(" "),a("p",[s._v("First we need to create a procedure that is able to read and process data from the Queue")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("MyDatabase"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nGO\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" ANSI_NULLS "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v("\nGO\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" QUOTED_IDENTIFIER "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v("\nGO\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PROCEDURE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("dbo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("p_RecieveMessageFromTargetQueue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \n    \n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BEGIN")]),s._v("\n    \n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("declare")]),s._v(" \n    "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@message_body")]),s._v(" xml"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n    "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@message_type_name")]),s._v(" nvarchar"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("256")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n    "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@conversation_handle")]),s._v(" uniqueidentifier"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@messagetypename")]),s._v(" nvarchar"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("256")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    \n              \n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHILE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BEGIN")]),s._v("\n    \n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BEGIN")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TRANSACTION")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WAITFOR")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n        RECEIVE "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TOP")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@message_body")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" CAST"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("message_body "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" xml"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n        "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@message_type_name")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" message_type_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@conversation_handle")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" conversation_handle"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@messagetypename")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" message_type_name\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" DwhInsertSmsQueue\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" TIMEOUT "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n         "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("IF")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@ROWCOUNT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BEGIN")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ROLLBACK")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TRANSACTION")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BREAK")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v("\n\n         "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("IF")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@messagetypename")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'//initiator'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n             "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BEGIN")]),s._v("\n                \n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("IF")]),s._v(" OBJECT_ID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'MyDatabase..MyExampleTableHelloThere'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IS")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" \n                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DROP")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" dbo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("MyExampleTableHelloThere\n                \n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@message_body.value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'(/ExampleRoot/\"elementNum1\")[1]'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'VARCHAR(50)'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" MyExampleMessage\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" dbo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("MyExampleTableHelloThere\n             \n             "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v("\n    \n           \n \n         "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("IF")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@messagetypename")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://schemas.microsoft.com/SQL/ServiceBroker/EndDialog'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BEGIN")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v(" CONVERSATION "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@conversation_handle")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v("\n   \n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMIT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TRANSACTION")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v("\n   \n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v("\n\n")])])]),a("p",[s._v("Second step: Allow your TargetQueue to automatically run your procedure:")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("MyDatabase"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALTER")]),s._v(" QUEUE "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("dbo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("TargetQueue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WITH")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("STATUS")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" RETENTION "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OFF")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \nACTIVATION\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("STATUS")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--activation status")]),s._v("\n    PROCEDURE_NAME "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" dbo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("p_RecieveMessageFromTargetQueue "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--procedure name")]),s._v("\n    MAX_QUEUE_READERS "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--number of readers")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXECUTE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" SELF  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);