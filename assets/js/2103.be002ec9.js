(window.webpackJsonp=window.webpackJsonp||[]).push([[2103],{2510:function(t,a,s){"use strict";s.r(a);var e=s(31),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"date-and-time-operations"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#date-and-time-operations"}},[t._v("#")]),t._v(" Date and Time Operations")]),t._v(" "),s("h2",{attrs:{id:"date-arithmetic"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#date-arithmetic"}},[t._v("#")]),t._v(" Date arithmetic")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("NOW")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INTERVAL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DAY")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- This time tomorrow")]),t._v("\n\nCURDATE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INTERVAL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DAY")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- Midnight 4 mornings ago")]),t._v("\n\n")])])]),s("p",[t._v("Show the mysql questions stored that were\nasked 3 to 10 hours ago (180 to 600 minutes ago):")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" qId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("askDate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("minuteDiff  \n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" qId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("askDate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    TIMESTAMPDIFF"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("MINUTE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("askDate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" minuteDiff \n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" questions_mysql \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" xDerived \n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" minuteDiff "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("BETWEEN")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("180")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("AND")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("600")]),t._v(" \n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ORDER")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BY")]),t._v(" qId "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DESC")]),t._v(" \n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("LIMIT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("----------+---------------------+------------+")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" qId      "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" askDate             "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" minuteDiff "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("----------+---------------------+------------+")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("38546828")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2016")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("07")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v(":"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("06")]),t._v(":"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("182")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("38546733")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2016")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("07")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v(":"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("53")]),t._v(":"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("26")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("195")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("38546707")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2016")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("07")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v(":"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("48")]),t._v(":"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("46")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("38546687")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2016")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("07")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v(":"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("45")]),t._v(":"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("26")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("203")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("      "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("                     "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("            "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("----------+---------------------+------------+")]),t._v("\n\n")])])]),s("p",[t._v("MySQL manual pages for "),s("a",{attrs:{href:"https://dev.mysql.com/doc/refman/5.7/en/date-and-time-functions.html#function_timestampdiff",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("TIMESTAMPDIFF()")]),s("OutboundLink")],1),t._v(".")]),t._v(" "),s("p",[s("strong",[t._v("Beware")]),t._v(" Do not try to use expressions like "),s("code",[t._v("CURDATE() + 1")]),t._v(" for date arithmetic in MySQL. They don't return what you expect, especially if you're accustomed to the Oracle database product. Use "),s("code",[t._v("CURDATE() + INTERVAL 1 DAY")]),t._v(" instead.")]),t._v(" "),s("h2",{attrs:{id:"sysdate-now-curdate"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sysdate-now-curdate"}},[t._v("#")]),t._v(" SYSDATE(), NOW(), CURDATE()")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("\n SELECT SYSDATE();\n\n")])])]),s("p",[t._v("This function returns the current date and time as a value in "),s("code",[t._v("'YYYY-MM-DD HH:MM:SS'")]),t._v(" or "),s("code",[t._v("YYYYMMDDHHMMSS")]),t._v(" format, depending on whether the function is used in a string or numeric context. It returns the date and time in the current time zone.")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("\n SELECT NOW();\n\n")])])]),s("p",[t._v("This function is a synonym for "),s("code",[t._v("SYSDATE()")]),t._v(".")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("\n SELECT CURDATE();\n\n")])])]),s("p",[t._v("This function returns the current date, without any time,  as a value in "),s("code",[t._v("'YYYY-MM-DD'")]),t._v(" or "),s("code",[t._v("YYYYMMDD")]),t._v(" format, depending on whether the function is used in a string or numeric context. It returns the date in the current time zone.")]),t._v(" "),s("h2",{attrs:{id:"now"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#now"}},[t._v("#")]),t._v(" Now()")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Select")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Now")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])])]),s("p",[t._v("Shows the current server date and time.")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Update")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("footable"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" mydatefield "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Now")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])])]),s("p",[t._v("This will update the field "),s("code",[t._v("mydatefield")]),t._v(" with current server date and time in server's configured timezone, e.g.")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2016-07-21 12:00:00'")]),t._v("\n\n")])])]),s("h2",{attrs:{id:"testing-against-a-date-range"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#testing-against-a-date-range"}},[t._v("#")]),t._v(" Testing against a date range")]),t._v(" "),s("p",[t._v("Although it is very tempting to use "),s("code",[t._v("BETWEEN")]),t._v(" ... "),s("code",[t._v("AND")]),t._v(" ... for a date range, it is problematical.  Instead, this pattern avoids most problems:")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" x "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2016-02-25'")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("AND")]),t._v(" x  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2016-02-25'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INTERVAL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DAY")]),t._v("\n\n")])])]),s("p",[t._v("Advantages:")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("BETWEEN")]),t._v(" is 'inclusive' thereby including the final date or second.")]),t._v(" "),s("li",[s("code",[t._v("23:59:59")]),t._v(" is clumsy and wrong if you have microsecond resolution on a "),s("code",[t._v("DATETIME")]),t._v(".")]),t._v(" "),s("li",[t._v("This pattern avoid dealing with leap years and other data calculations.")]),t._v(" "),s("li",[t._v("It works whether "),s("code",[t._v("x")]),t._v(" is "),s("code",[t._v("DATE")]),t._v(", "),s("code",[t._v("DATETIME")]),t._v(" or "),s("code",[t._v("TIMESTAMP")]),t._v(".")])]),t._v(" "),s("h2",{attrs:{id:"extract-date-from-given-date-or-datetime-expression"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#extract-date-from-given-date-or-datetime-expression"}},[t._v("#")]),t._v(" Extract Date from Given Date or DateTime Expression")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DATE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2003-12-31 01:02:03'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])])]),s("p",[t._v("The output will be:")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2003")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("31")]),t._v("\n\n")])])]),s("h2",{attrs:{id:"using-an-index-for-a-date-and-time-lookup"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#using-an-index-for-a-date-and-time-lookup"}},[t._v("#")]),t._v(" Using an index for a date and time lookup")]),t._v(" "),s("p",[t._v("Many real-world database tables have many rows with "),s("code",[t._v("DATETIME")]),t._v(" OR "),s("code",[t._v("TIMESTAMP")]),t._v(" column values spanning a lot of time, including years or even decades. Often it's necessary to use a "),s("code",[t._v("WHERE")]),t._v(" clause to retrieve some subset of that timespan. For example, we might want to retrieve rows for the date 1-September-2016 from a table.")]),t._v(" "),s("p",[t._v("An inefficient way to do that is this:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("\nWHERE DATE(x) = '2016-09-01'   /* slow! */\n\n")])])]),s("p",[t._v("It's inefficient because it applies a function -- "),s("code",[t._v("DATE()")]),t._v(" -- to the values of a column. That means MySQL must examine each value of "),s("code",[t._v("x")]),t._v(", and an index cannot be used.")]),t._v(" "),s("p",[t._v("A better way to do the operation is this")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("\nWHERE x >= '2016-09-01'\n   AND x <  '2016-09-01' + INTERVAL 1 DAY\n\n")])])]),s("p",[t._v("This selects a range of values of "),s("code",[t._v("x")]),t._v(" lying anywhere on the day in question, up until but "),s("strong",[t._v("not including")]),t._v(" (hence "),s("code",[t._v("<")]),t._v(") midnight on the next day.")]),t._v(" "),s("p",[t._v("If the table has an index on the "),s("code",[t._v("x")]),t._v(" column, then the database server can perform a range scan on the index. That means it can quickly find the first relevant value of x, and then scan the index sequentially until it finds the last relevant value. An index range scan is much more efficient than the full table scan required by "),s("code",[t._v("DATE(x) = '2016-09-01")]),t._v(".")]),t._v(" "),s("p",[t._v("Don't be tempted to use this, even though it looks more efficient.")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("\n WHERE x BETWEEN '2016-09-01' AND '2016-09-01' + INTERVAL 1 DAY  /*  wrong! */\n\n")])])]),s("p",[t._v("It has the same efficiency as the range scan, but it will select rows with values of "),s("code",[t._v("x")]),t._v(" falling exactly at midnight on 2-Sept-2016, which is not what you want.")])])}),[],!1,null,null,null);a.default=n.exports}}]);