(window.webpackJsonp=window.webpackJsonp||[]).push([[1886],{2295:function(t,n,a){"use strict";a.r(n);var e=a(31),s=Object(e.a)({},(function(){var t=this,n=t.$createElement,a=t._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"change-root-chroot"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#change-root-chroot"}},[t._v("#")]),t._v(" Change root (chroot)")]),t._v(" "),a("p",[t._v("Change root (chroot) is an operation that changes the apparent root directory for the current running process and their children. A program that is run in such a modified environment cannot access files and commands outside that environmental directory tree.")]),t._v(" "),a("h2",{attrs:{id:"manually-changing-root-in-a-directory"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#manually-changing-root-in-a-directory"}},[t._v("#")]),t._v(" Manually changing root in a directory")]),t._v(" "),a("li",[t._v("\nEnsure you met all requirements, as per Requirements\n")]),t._v(" "),a("li",[t._v("\nMount the temporary API filesystems:\n"),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /location/of/new/root\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mount")]),t._v(" -t proc proc proc/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mount")]),t._v(" --rbind /sys sys/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mount")]),t._v(" --rbind /dev dev/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mount")]),t._v(" --rbind /run run/ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("optionally"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])])])]),t._v(" "),a("li",[t._v("\nIf you need to use an internet connection in the chroot environment, copy over the DNS details:\n"),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" /etc/resolv.conf etc/resolv.conf\n\n")])])])]),t._v(" "),a("li",[t._v("\nChange root into /location/of/new/root, specifying the shell (`/bin/bash` in this example):\n"),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("chroot")]),t._v(" /location/of/new/root /bin/bash\n\n")])])])]),t._v(" "),a("li",[t._v("\nAfter chrooting it may be necessary to load the local bash configuration:\n"),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" /etc/profile\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" ~/.bashrc\n\n")])])])]),t._v(" "),a("li",[t._v("\nOptionally, create a unique prompt to be able to differentiate your chroot environment:\n"),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("PS1")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"(chroot) '),a("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$PS1")]),t._v('"')]),t._v("\n\n")])])])]),t._v(" "),a("li",[t._v("\nWhen finished with the chroot, you can exit it via:\n"),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exit")]),t._v("\n\n")])])])]),t._v(" "),a("li",[t._v("\nUnmount the temporary file systems:\n"),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("umount")]),t._v(" --recursive /location/of/new/root\n\n")])])])]),t._v(" "),a("h2",{attrs:{id:"requirements"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#requirements"}},[t._v("#")]),t._v(" Requirements")]),t._v(" "),a("ul",[a("li",[t._v("root privileges")]),t._v(" "),a("li",[t._v("another working Linux environment,such as Live CD boot or an existing distribution")]),t._v(" "),a("li",[t._v("matching environment architectures of "),a("code",[t._v("chroot")]),t._v(" source and destination (check current environment architecture with "),a("code",[t._v("uname -m")]),t._v(")")]),t._v(" "),a("li",[t._v("kernel modules which you may need in "),a("code",[t._v("chroot")]),t._v(" environment must be loaded (for example, with "),a("code",[t._v("modprobe")]),t._v(")")])]),t._v(" "),a("h2",{attrs:{id:"reasons-to-use-chroot"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#reasons-to-use-chroot"}},[t._v("#")]),t._v(" Reasons to use chroot")]),t._v(" "),a("p",[t._v("Changing root is commonly done for performing system maintenance on systems where booting and/or logging in is no longer possible.")]),t._v(" "),a("p",[t._v("Common examples are:")]),t._v(" "),a("ul",[a("li",[t._v("reinstalling the bootloader")]),t._v(" "),a("li",[t._v("rebuilding the initramfs image")]),t._v(" "),a("li",[t._v("upgrading or downgrading packages")]),t._v(" "),a("li",[t._v("resetting a forgotten password")]),t._v(" "),a("li",[t._v("building software in a clean root environment")])]),t._v(" "),a("h4",{attrs:{id:"syntax"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#syntax"}},[t._v("#")]),t._v(" Syntax")]),t._v(" "),a("ul",[a("li",[t._v("chroot [destination path] [shell or command]")])])])}),[],!1,null,null,null);n.default=s.exports}}]);