<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MongoDB - MongoDB - Configure a ReplicaSet to support TLS/SSL</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="How to configure a ReplicaSet to support TLS/SSL?, How to connect your Client (Mongo Shell) to a ReplicaSet?">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="MongoDB - MongoDB - Configure a ReplicaSet to support TLS/SSL">
    <meta property="og:description" content="How to configure a ReplicaSet to support TLS/SSL?, How to connect your Client (Mongo Shell) to a ReplicaSet?">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/mongodb/mongodb-configure-a-replicaset-to-support-tls-ssl.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="MongoDB - MongoDB - Configure a ReplicaSet to support TLS/SSL">
    <meta name="twitter:description" content="How to configure a ReplicaSet to support TLS/SSL?, How to connect your Client (Mongo Shell) to a ReplicaSet?">
    <meta name="twitter:url" content="/mongodb/mongodb-configure-a-replicaset-to-support-tls-ssl.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/1963.b11680e0.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>MongoDB</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mongodb/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/mongodb/getting-started-with-mongodb.html" class="sidebar-link">Getting started with MongoDB</a></li><li><a href="/mongodb/crud-operation.html" class="sidebar-link">CRUD Operation</a></li><li><a href="/mongodb/getting-database-information.html" class="sidebar-link">Getting database information</a></li><li><a href="/mongodb/querying-for-data-getting-started.html" class="sidebar-link">Querying for Data ( Getting Started )</a></li><li><a href="/mongodb/update-operators.html" class="sidebar-link">Update Operators</a></li><li><a href="/mongodb/upserts-and-inserts.html" class="sidebar-link">Upserts and Inserts</a></li><li><a href="/mongodb/collections.html" class="sidebar-link">Collections</a></li><li><a href="/mongodb/mongodb-aggregation.html" class="sidebar-link">MongoDB Aggregation</a></li><li><a href="/mongodb/aggregation.html" class="sidebar-link">Aggregation</a></li><li><a href="/mongodb/indexes.html" class="sidebar-link">Indexes</a></li><li><a href="/mongodb/bulk-operations.html" class="sidebar-link">Bulk Operations</a></li><li><a href="/mongodb/2dsphere-index.html" class="sidebar-link">2dsphere Index</a></li><li><a href="/mongodb/pluggable-storage-engines.html" class="sidebar-link">Pluggable Storage Engines</a></li><li><a href="/mongodb/java-driver.html" class="sidebar-link">Java Driver</a></li><li><a href="/mongodb/python-driver.html" class="sidebar-link">Python Driver</a></li><li><a href="/mongodb/mongo-as-shards.html" class="sidebar-link">Mongo as Shards</a></li><li><a href="/mongodb/replication.html" class="sidebar-link">Replication</a></li><li><a href="/mongodb/mongo-as-a-replica-set.html" class="sidebar-link">Mongo as a Replica Set</a></li><li><a href="/mongodb/mongodb-configure-a-replicaset-to-support-tls-ssl.html" aria-current="page" class="active sidebar-link">MongoDB - Configure a ReplicaSet to support TLS/SSL</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mongodb/mongodb-configure-a-replicaset-to-support-tls-ssl.html#how-to-configure-a-replicaset-to-support-tls-ssl" class="sidebar-link">How to configure a ReplicaSet to support TLS/SSL?</a></li><li class="sidebar-sub-header"><a href="/mongodb/mongodb-configure-a-replicaset-to-support-tls-ssl.html#how-to-connect-your-client-mongo-shell-to-a-replicaset" class="sidebar-link">How to connect your Client (Mongo Shell) to a ReplicaSet?</a></li></ul></li><li><a href="/mongodb/authentication-mechanisms-in-mongodb.html" class="sidebar-link">Authentication Mechanisms in MongoDB</a></li><li><a href="/mongodb/mongodb-authorization-model.html" class="sidebar-link">MongoDB Authorization Model</a></li><li><a href="/mongodb/configuration.html" class="sidebar-link">Configuration</a></li><li><a href="/mongodb/backing-up-and-restoring-data.html" class="sidebar-link">Backing up and Restoring Data</a></li><li><a href="/mongodb/upgrading-mongodb-version.html" class="sidebar-link">Upgrading MongoDB version</a></li><li><a href="/mongodb/backing-up-and-restoring-data.html" class="sidebar-link">Backing up and Restoring Data</a></li><li><a href="/mongodb/mongo-as-a-replica-set.html" class="sidebar-link">Mongo as a Replica Set</a></li><li><a href="/mongodb/managing-mongodb.html" class="sidebar-link">Managing MongoDB</a></li><li><a href="/mongodb/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mongodb-configure-a-replicaset-to-support-tls-ssl"><a href="#mongodb-configure-a-replicaset-to-support-tls-ssl" class="header-anchor">#</a> MongoDB - Configure a ReplicaSet to support TLS/SSL</h1> <p><strong>How to configure a ReplicaSet to support TLS/SSL?</strong></p> <p>We will deploy a 3 Nodes ReplicaSet in your local environment and we will use a self-signed certificate. Do not use a self-signed certificate in PRODUCTION.</p> <p><strong>How to connect your Client to this ReplicaSet?</strong></p> <p>We will connect a Mongo Shell.</p> <p><strong>A description of TLS/SSL, PKI (Public Key Infrastructure) certificates, and Certificate Authority is beyond the scope of this documentation.</strong></p> <h2 id="how-to-configure-a-replicaset-to-support-tls-ssl"><a href="#how-to-configure-a-replicaset-to-support-tls-ssl" class="header-anchor">#</a> How to configure a ReplicaSet to support TLS/SSL?</h2> <h3 id="create-the-root-certificate"><a href="#create-the-root-certificate" class="header-anchor">#</a> Create the Root Certificate</h3> <p>The Root Certificate (aka CA File) will be used to sign and identify your certificate. To generate it, run the command below.</p> <div class="language-js extra-class"><pre class="language-js"><code>openssl req <span class="token operator">-</span>nodes <span class="token operator">-</span>out ca<span class="token punctuation">.</span>pem <span class="token operator">-</span><span class="token keyword">new</span> <span class="token operator">-</span>x509 <span class="token operator">-</span>keyout ca<span class="token punctuation">.</span>key

</code></pre></div><p>Keep the root certificate and its key carefully, both will be used to sign your certificates. The root certificate might be used by your client as well.</p> <h3 id="generate-the-certificate-requests-and-the-private-keys"><a href="#generate-the-certificate-requests-and-the-private-keys" class="header-anchor">#</a> Generate the Certificate Requests and the Private Keys</h3> <p>When generating the Certificate Signing Request (aka CSR), <strong>input the exact hostname (or IP) of your node in the Common Name (aka CN) field. The others fields must have exactly the same value.</strong> You might need to modify your <strong>/etc/hosts</strong> file.</p> <p>The commands below will generate the CSR files and the RSA Private Keys (4096 bits).</p> <div class="language-js extra-class"><pre class="language-js"><code>openssl req <span class="token operator">-</span>nodes <span class="token operator">-</span>newkey rsa<span class="token operator">:</span><span class="token number">4096</span> <span class="token operator">-</span>sha256 <span class="token operator">-</span>keyout mongodb_node_1<span class="token punctuation">.</span>key <span class="token operator">-</span>out mongodb_node_1<span class="token punctuation">.</span>csr
openssl req <span class="token operator">-</span>nodes <span class="token operator">-</span>newkey rsa<span class="token operator">:</span><span class="token number">4096</span> <span class="token operator">-</span>sha256 <span class="token operator">-</span>keyout mongodb_node_2<span class="token punctuation">.</span>key <span class="token operator">-</span>out mongodb_node_2<span class="token punctuation">.</span>csr
openssl req <span class="token operator">-</span>nodes <span class="token operator">-</span>newkey rsa<span class="token operator">:</span><span class="token number">4096</span> <span class="token operator">-</span>sha256 <span class="token operator">-</span>keyout mongodb_node_3<span class="token punctuation">.</span>key <span class="token operator">-</span>out mongodb_node_3<span class="token punctuation">.</span>csr

</code></pre></div><p><strong>You must generate one CSR for each node of your ReplicaSet. Remember that the Common Name is not the same from one node to another. Don't base multiple CSRs on the same Private Key.</strong></p> <p>You must now have 3 CSRs and 3 Private Keys.</p> <div class="language-js extra-class"><pre class="language-js"><code>mongodb_node_1<span class="token punctuation">.</span>key <span class="token operator">-</span> mongodb_node_2<span class="token punctuation">.</span>key <span class="token operator">-</span> mongodb_node_3<span class="token punctuation">.</span>key
mongodb_node_1<span class="token punctuation">.</span>csr <span class="token operator">-</span> mongodb_node_2<span class="token punctuation">.</span>csr <span class="token operator">-</span> mongodb_node_3<span class="token punctuation">.</span>csr

</code></pre></div><h3 id="sign-your-certificate-requests"><a href="#sign-your-certificate-requests" class="header-anchor">#</a> Sign your Certificate Requests</h3> <p>Use the CA File (ca.pem) and its Private Key (ca.key) generated previously to sign each Certificate Request by running the commands below.</p> <div class="language-js extra-class"><pre class="language-js"><code>openssl x509 <span class="token operator">-</span>req <span class="token operator">-</span><span class="token keyword">in</span> mongodb_node_1<span class="token punctuation">.</span>csr <span class="token operator">-</span><span class="token constant">CA</span> ca<span class="token punctuation">.</span>pem <span class="token operator">-</span>CAkey ca<span class="token punctuation">.</span>key <span class="token operator">-</span>set_serial <span class="token number">00</span> <span class="token operator">-</span>out mongodb_node_1<span class="token punctuation">.</span>crt
openssl x509 <span class="token operator">-</span>req <span class="token operator">-</span><span class="token keyword">in</span> mongodb_node_2<span class="token punctuation">.</span>csr <span class="token operator">-</span><span class="token constant">CA</span> ca<span class="token punctuation">.</span>pem <span class="token operator">-</span>CAkey ca<span class="token punctuation">.</span>key <span class="token operator">-</span>set_serial <span class="token number">00</span> <span class="token operator">-</span>out mongodb_node_2<span class="token punctuation">.</span>crt
openssl x509 <span class="token operator">-</span>req <span class="token operator">-</span><span class="token keyword">in</span> mongodb_node_3<span class="token punctuation">.</span>csr <span class="token operator">-</span><span class="token constant">CA</span> ca<span class="token punctuation">.</span>pem <span class="token operator">-</span>CAkey ca<span class="token punctuation">.</span>key <span class="token operator">-</span>set_serial <span class="token number">00</span> <span class="token operator">-</span>out mongodb_node_3<span class="token punctuation">.</span>crt

</code></pre></div><p><strong>You must sign each CSR.</strong></p> <p>Your must now have 3 CSRs, 3 Private Keys and 3 self-signed Certificates. Only the Private Keys and the Certificates will be used by MongoDB.</p> <div class="language-js extra-class"><pre class="language-js"><code>mongodb_node_1<span class="token punctuation">.</span>key <span class="token operator">-</span> mongodb_node_2<span class="token punctuation">.</span>key <span class="token operator">-</span> mongodb_node_3<span class="token punctuation">.</span>key
mongodb_node_1<span class="token punctuation">.</span>csr <span class="token operator">-</span> mongodb_node_2<span class="token punctuation">.</span>csr <span class="token operator">-</span> mongodb_node_3<span class="token punctuation">.</span>csr
mongodb_node_1<span class="token punctuation">.</span>crt <span class="token operator">-</span> mongodb_node_2<span class="token punctuation">.</span>crt <span class="token operator">-</span> mongodb_node_3<span class="token punctuation">.</span>crt

</code></pre></div><p><strong>Each certificate corresponds to one node. Remember carefully which CN / hostname your gave to each CSR.</strong></p> <h3 id="concat-each-node-certificate-with-its-key"><a href="#concat-each-node-certificate-with-its-key" class="header-anchor">#</a> Concat each Node Certificate with its key</h3> <p>Run the commands below to concat each Node Certificate with its key in one file (MongoDB requirement).</p> <div class="language-js extra-class"><pre class="language-js"><code>cat mongodb_node_1<span class="token punctuation">.</span>key mongodb_node_1<span class="token punctuation">.</span>crt <span class="token operator">&gt;</span> mongodb_node_1<span class="token punctuation">.</span>pem
cat mongodb_node_2<span class="token punctuation">.</span>key mongodb_node_2<span class="token punctuation">.</span>crt <span class="token operator">&gt;</span> mongodb_node_2<span class="token punctuation">.</span>pem
cat mongodb_node_3<span class="token punctuation">.</span>key mongodb_node_3<span class="token punctuation">.</span>crt <span class="token operator">&gt;</span> mongodb_node_3<span class="token punctuation">.</span>pem

</code></pre></div><p>Your must now have 3 PEM files.</p> <div class="language-js extra-class"><pre class="language-js"><code>mongodb_node_1<span class="token punctuation">.</span>pem <span class="token operator">-</span> mongodb_node_2<span class="token punctuation">.</span>pem <span class="token operator">-</span> mongodb_node_3<span class="token punctuation">.</span>pem

</code></pre></div><h3 id="deploy-your-replicaset"><a href="#deploy-your-replicaset" class="header-anchor">#</a> Deploy your ReplicaSet</h3> <p>We will assume that your pem files are located in your current folder as well as data/data1, data/data2 and data/data3.</p> <p>Run the commands below to deploy your 3 Nodes ReplicaSet listening on port 27017, 27018 and 27019.</p> <div class="language-js extra-class"><pre class="language-js"><code>mongod <span class="token operator">--</span>dbpath data<span class="token operator">/</span>data_1 <span class="token operator">--</span>replSet rs0 <span class="token operator">--</span>port <span class="token number">27017</span> <span class="token operator">--</span>sslMode requireSSL <span class="token operator">--</span>sslPEMKeyFile mongodb_node_1<span class="token punctuation">.</span>pem
mongod <span class="token operator">--</span>dbpath data<span class="token operator">/</span>data_2 <span class="token operator">--</span>replSet rs0 <span class="token operator">--</span>port <span class="token number">27018</span> <span class="token operator">--</span>sslMode requireSSL <span class="token operator">--</span>sslPEMKeyFile mongodb_node_2<span class="token punctuation">.</span>pem
mongod <span class="token operator">--</span>dbpath data<span class="token operator">/</span>data_3 <span class="token operator">--</span>replSet rs0 <span class="token operator">--</span>port <span class="token number">27019</span> <span class="token operator">--</span>sslMode requireSSL <span class="token operator">--</span>sslPEMKeyFile mongodb_node_3<span class="token punctuation">.</span>pem

</code></pre></div><p>You now have a 3 Nodes ReplicaSet deployed on your local environment and all their transactions are encrypted. You cannot connect to this ReplicaSet without using TLS.</p> <h3 id="deploy-your-replicaset-for-mutual-ssl-mutual-trust"><a href="#deploy-your-replicaset-for-mutual-ssl-mutual-trust" class="header-anchor">#</a> Deploy your ReplicaSet for Mutual SSL / Mutual Trust</h3> <p>To force your client to provide a Client Certificate (Mutual SSL), you must add the CA File when running your instances.</p> <div class="language-js extra-class"><pre class="language-js"><code>mongod <span class="token operator">--</span>dbpath data<span class="token operator">/</span>data_1 <span class="token operator">--</span>replSet rs0 <span class="token operator">--</span>port <span class="token number">27017</span> <span class="token operator">--</span>sslMode requireSSL <span class="token operator">--</span>sslPEMKeyFile mongodb_node_1<span class="token punctuation">.</span>pem <span class="token operator">--</span>sslCAFile ca<span class="token punctuation">.</span>pem
mongod <span class="token operator">--</span>dbpath data<span class="token operator">/</span>data_2 <span class="token operator">--</span>replSet rs0 <span class="token operator">--</span>port <span class="token number">27018</span> <span class="token operator">--</span>sslMode requireSSL <span class="token operator">--</span>sslPEMKeyFile mongodb_node_2<span class="token punctuation">.</span>pem <span class="token operator">--</span>sslCAFile ca<span class="token punctuation">.</span>pem
mongod <span class="token operator">--</span>dbpath data<span class="token operator">/</span>data_3 <span class="token operator">--</span>replSet rs0 <span class="token operator">--</span>port <span class="token number">27019</span> <span class="token operator">--</span>sslMode requireSSL <span class="token operator">--</span>sslPEMKeyFile mongodb_node_3<span class="token punctuation">.</span>pem <span class="token operator">--</span>sslCAFile ca<span class="token punctuation">.</span>pem

</code></pre></div><p>You now have a 3 Nodes ReplicaSet deployed on your local environment and all their transactions are encrypted. You cannot connect to this ReplicaSet without using TLS or without providing a Client Certificate trusted by your CA.</p> <h2 id="how-to-connect-your-client-mongo-shell-to-a-replicaset"><a href="#how-to-connect-your-client-mongo-shell-to-a-replicaset" class="header-anchor">#</a> How to connect your Client (Mongo Shell) to a ReplicaSet?</h2> <h3 id="no-mutual-ssl"><a href="#no-mutual-ssl" class="header-anchor">#</a> No Mutual SSL</h3> <p>In this example, we might use the CA File (ca.pem) that you generated during the &quot;<strong>How to configure a ReplicaSet to support TLS/SSL?</strong>&quot; section. We will assume that the CA file is located in your current folder.</p> <p>We will assume that your 3 nodes are running on mongo1:27017, mongo2:27018 and mongo3:27019. (You might need to modify your <strong>/etc/hosts</strong> file.)</p> <p>From MongoDB 3.2.6, if your CA File is registered in your Operating System Trust Store, you can connect to your ReplicaSet without providing the CA File.</p> <div class="language-js extra-class"><pre class="language-js"><code>mongo <span class="token operator">--</span>ssl <span class="token operator">--</span>host rs0<span class="token operator">/</span>mongo1<span class="token operator">:</span><span class="token number">27017</span><span class="token punctuation">,</span>mongo2<span class="token operator">:</span><span class="token number">27018</span><span class="token punctuation">,</span>mongo3<span class="token operator">:</span><span class="token number">27019</span>

</code></pre></div><p>Otherwise you must provide the CA File.</p> <div class="language-js extra-class"><pre class="language-js"><code>mongo <span class="token operator">--</span>ssl <span class="token operator">--</span>sslCAFile ca<span class="token punctuation">.</span>pem <span class="token operator">--</span>host rs0<span class="token operator">/</span>mongo1<span class="token operator">:</span><span class="token number">27017</span><span class="token punctuation">,</span>mongo2<span class="token operator">:</span><span class="token number">27018</span><span class="token punctuation">,</span>mongo3<span class="token operator">:</span><span class="token number">27019</span>

</code></pre></div><p>You are now connected to your ReplicaSet and all the transactions between your Mongo Shell and your ReplicaSet are encrypted.</p> <h3 id="with-mutual-ssl"><a href="#with-mutual-ssl" class="header-anchor">#</a> With Mutual SSL</h3> <p>If your ReplicaSet asks for a Client Certificate, you must provide one signed by the CA used by the ReplicaSet Deployment.
The steps to generate the Client Certificate are almost the same as the ones to generate the Server Certificate.</p> <p>Indeed, you just need to modify the Common Name Field during the CSR creation.
Instead of providing 1 Node Hostname in the Common Name Field, <strong>you need to provide all the ReplicaSet Hostnames separated by a comma</strong>.</p> <div class="language-js extra-class"><pre class="language-js"><code>openssl req <span class="token operator">-</span>nodes <span class="token operator">-</span>newkey rsa<span class="token operator">:</span><span class="token number">4096</span> <span class="token operator">-</span>sha256 <span class="token operator">-</span>keyout mongodb_client<span class="token punctuation">.</span>key <span class="token operator">-</span>out mongodb_client<span class="token punctuation">.</span>csr
<span class="token operator">...</span>
Common <span class="token function">Name</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>g<span class="token punctuation">.</span> server <span class="token constant">FQDN</span> or <span class="token constant">YOUR</span> name<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">:</span> mongo1<span class="token punctuation">,</span>mongo2<span class="token punctuation">,</span>mongo3

</code></pre></div><p>You might face the Common Name size limitation if the Common Name field is too long (more than 64 bytes long). To bypass this limitation, you must use the SubjectAltName when generating the CSR.</p> <div class="language-js extra-class"><pre class="language-js"><code>openssl req <span class="token operator">-</span>nodes <span class="token operator">-</span>newkey rsa<span class="token operator">:</span><span class="token number">4096</span> <span class="token operator">-</span>sha256 <span class="token operator">-</span>keyout mongodb_client<span class="token punctuation">.</span>key <span class="token operator">-</span>out mongodb_client<span class="token punctuation">.</span>csr <span class="token operator">-</span>config <span class="token operator">&lt;</span><span class="token punctuation">(</span>
cat <span class="token operator">&lt;&lt;</span><span class="token operator">-</span><span class="token constant">EOF</span>
<span class="token punctuation">[</span>req<span class="token punctuation">]</span>
default_bits <span class="token operator">=</span> <span class="token number">4096</span>
prompt <span class="token operator">=</span> no
default_md <span class="token operator">=</span> sha256
req_extensions <span class="token operator">=</span> req_ext
distinguished_name <span class="token operator">=</span> dn
 
<span class="token punctuation">[</span> dn <span class="token punctuation">]</span>
<span class="token constant">CN</span> <span class="token operator">=</span> <span class="token punctuation">.</span>
 
<span class="token punctuation">[</span> req_ext <span class="token punctuation">]</span>
subjectAltName <span class="token operator">=</span> @alt_names
 
<span class="token punctuation">[</span> alt_names <span class="token punctuation">]</span>
<span class="token constant">DNS</span><span class="token number">.1</span> <span class="token operator">=</span> mongo1
<span class="token constant">DNS</span><span class="token number">.2</span> <span class="token operator">=</span> mongo2
<span class="token constant">DNS</span><span class="token number">.3</span> <span class="token operator">=</span> mongo3
<span class="token constant">EOF</span>
<span class="token punctuation">)</span>

</code></pre></div><p>Then you sign the CSR using the CA certificate and key.</p> <div class="language-js extra-class"><pre class="language-js"><code>openssl x509 <span class="token operator">-</span>req <span class="token operator">-</span><span class="token keyword">in</span> mongodb_client<span class="token punctuation">.</span>csr  <span class="token operator">-</span><span class="token constant">CA</span> ca<span class="token punctuation">.</span>pem <span class="token operator">-</span>CAkey ca<span class="token punctuation">.</span>key <span class="token operator">-</span>set_serial <span class="token number">00</span> <span class="token operator">-</span>out mongodb_client<span class="token punctuation">.</span>crt

</code></pre></div><p>Finally, you concat the key and the signed certificate.</p> <div class="language-js extra-class"><pre class="language-js"><code>cat mongodb_client<span class="token punctuation">.</span>key mongodb_client<span class="token punctuation">.</span>crt <span class="token operator">&gt;</span> mongodb_client<span class="token punctuation">.</span>pem

</code></pre></div><p>To connect to your ReplicaSet, you can now provide the newly generated Client Certificate.</p> <div class="language-js extra-class"><pre class="language-js"><code>mongo <span class="token operator">--</span>ssl <span class="token operator">--</span>sslCAFile ca<span class="token punctuation">.</span>pem <span class="token operator">--</span>host rs0<span class="token operator">/</span>mongo1<span class="token operator">:</span><span class="token number">27017</span><span class="token punctuation">,</span>mongo2<span class="token operator">:</span><span class="token number">27018</span><span class="token punctuation">,</span>mongo3<span class="token operator">:</span><span class="token number">27019</span> <span class="token operator">--</span>sslPEMKeyFile mongodb_client<span class="token punctuation">.</span>pem

</code></pre></div><p>You are now connected to your ReplicaSet and all the transactions between your Mongo Shell and your ReplicaSet are encrypted.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/mongodb/mongodb-configure-a-replicaset-to-support-tls-ssl.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/mongodb/mongo-as-a-replica-set.html" class="prev">
        Mongo as a Replica Set
      </a></span> <span class="next"><a href="/mongodb/authentication-mechanisms-in-mongodb.html">
        Authentication Mechanisms in MongoDB
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/1963.b11680e0.js" defer></script>
  </body>
</html>
