<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>C# | Expression Trees</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Create Expression Trees with a lambda expression, Creating Expression Trees by Using the API, Compiling Expression Trees, Parsing Expression Trees, Expression Tree Basic, Examining the Structure of an Expression using Visitor, Understanding the expressions API">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="C# | Expression Trees">
    <meta property="og:description" content="Create Expression Trees with a lambda expression, Creating Expression Trees by Using the API, Compiling Expression Trees, Parsing Expression Trees, Expression Tree Basic, Examining the Structure of an Expression using Visitor, Understanding the expressions API">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/csharp/expression-trees.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="C# | Expression Trees">
    <meta name="twitter:description" content="Create Expression Trees with a lambda expression, Creating Expression Trees by Using the API, Compiling Expression Trees, Parsing Expression Trees, Expression Tree Basic, Examining the Structure of an Expression using Visitor, Understanding the expressions API">
    <meta name="twitter:url" content="/csharp/expression-trees.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    <link rel="preload" href="/assets/css/0.styles.8b877eb8.css" as="style"><link rel="preload" href="/assets/js/app.ced448ab.js" as="script"><link rel="preload" href="/assets/js/3.f1d73125.js" as="script"><link rel="preload" href="/assets/js/810.3afde26c.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.8b877eb8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>C#</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/csharp/" class="sidebar-link">Disclaimer</a></li><li><a href="/csharp/getting-started-with-c-language.html" class="sidebar-link">Getting started with C# Language</a></li><li><a href="/csharp/literals.html" class="sidebar-link">Literals</a></li><li><a href="/csharp/operators.html" class="sidebar-link">Operators</a></li><li><a href="/csharp/conditional-statements.html" class="sidebar-link">Conditional Statements</a></li><li><a href="/csharp/equality-operator.html" class="sidebar-link">Equality Operator</a></li><li><a href="/csharp/equals-and-gethashcode.html" class="sidebar-link">Equals and GetHashCode</a></li><li><a href="/csharp/null-coalescing-operator.html" class="sidebar-link">Null-Coalescing Operator</a></li><li><a href="/csharp/null-conditional-operators.html" class="sidebar-link">Null-conditional Operators</a></li><li><a href="/csharp/nameof-operator.html" class="sidebar-link">nameof Operator</a></li><li><a href="/csharp/verbatim-strings.html" class="sidebar-link">Verbatim Strings</a></li><li><a href="/csharp/common-string-operations.html" class="sidebar-link">Common String Operations</a></li><li><a href="/csharp/string-format.html" class="sidebar-link">String.Format</a></li><li><a href="/csharp/string-concatenate.html" class="sidebar-link">String Concatenate</a></li><li><a href="/csharp/string-manipulation.html" class="sidebar-link">String Manipulation</a></li><li><a href="/csharp/string-interpolation.html" class="sidebar-link">String Interpolation</a></li><li><a href="/csharp/string-escape-sequences.html" class="sidebar-link">String Escape Sequences</a></li><li><a href="/csharp/stringbuilder.html" class="sidebar-link">StringBuilder</a></li><li><a href="/csharp/regex-parsing.html" class="sidebar-link">Regex Parsing</a></li><li><a href="/csharp/datetime-methods.html" class="sidebar-link">DateTime Methods</a></li><li><a href="/csharp/arrays.html" class="sidebar-link">Arrays</a></li><li><a href="/csharp/o-n-algorithm-for-circular-rotation-of-an-array.html" class="sidebar-link">O(n) Algorithm for circular rotation of an array</a></li><li><a href="/csharp/enum.html" class="sidebar-link">Enum</a></li><li><a href="/csharp/tuples.html" class="sidebar-link">Tuples</a></li><li><a href="/csharp/guid.html" class="sidebar-link">Guid</a></li><li><a href="/csharp/biginteger.html" class="sidebar-link">BigInteger</a></li><li><a href="/csharp/collection-initializers.html" class="sidebar-link">Collection Initializers</a></li><li><a href="/csharp/an-overview-of-c-collections.html" class="sidebar-link">An overview of c# collections</a></li><li><a href="/csharp/looping.html" class="sidebar-link">Looping</a></li><li><a href="/csharp/iterators.html" class="sidebar-link">Iterators</a></li><li><a href="/csharp/ienumerable.html" class="sidebar-link">IEnumerable</a></li><li><a href="/csharp/value-type-vs-reference-type.html" class="sidebar-link">Value type vs Reference type</a></li><li><a href="/csharp/built-in-types.html" class="sidebar-link">Built-in Types</a></li><li><a href="/csharp/aliases-of-built-in-types.html" class="sidebar-link">Aliases of built-in types</a></li><li><a href="/csharp/anonymous-types.html" class="sidebar-link">Anonymous types</a></li><li><a href="/csharp/dynamic-type.html" class="sidebar-link">Dynamic type</a></li><li><a href="/csharp/type-conversion.html" class="sidebar-link">Type Conversion</a></li><li><a href="/csharp/casting.html" class="sidebar-link">Casting</a></li><li><a href="/csharp/nullable-types.html" class="sidebar-link">Nullable types</a></li><li><a href="/csharp/constructors-and-finalizers.html" class="sidebar-link">Constructors and Finalizers</a></li><li><a href="/csharp/access-modifiers.html" class="sidebar-link">Access Modifiers</a></li><li><a href="/csharp/interfaces.html" class="sidebar-link">Interfaces</a></li><li><a href="/csharp/static-classes.html" class="sidebar-link">Static Classes</a></li><li><a href="/csharp/singleton-implementation.html" class="sidebar-link">Singleton Implementation</a></li><li><a href="/csharp/dependency-injection.html" class="sidebar-link">Dependency Injection</a></li><li><a href="/csharp/partial-class-and-methods.html" class="sidebar-link">Partial class and methods</a></li><li><a href="/csharp/object-initializers.html" class="sidebar-link">Object initializers</a></li><li><a href="/csharp/methods.html" class="sidebar-link">Methods</a></li><li><a href="/csharp/extension-methods.html" class="sidebar-link">Extension Methods</a></li><li><a href="/csharp/named-arguments.html" class="sidebar-link">Named Arguments</a></li><li><a href="/csharp/named-and-optional-arguments.html" class="sidebar-link">Named and Optional Arguments</a></li><li><a href="/csharp/data-annotation.html" class="sidebar-link">Data Annotation</a></li><li><a href="/csharp/keywords.html" class="sidebar-link">Keywords</a></li><li><a href="/csharp/object-oriented-programming-in-c.html" class="sidebar-link">Object Oriented Programming In C#</a></li><li><a href="/csharp/recursion.html" class="sidebar-link">Recursion</a></li><li><a href="/csharp/naming-conventions.html" class="sidebar-link">Naming Conventions</a></li><li><a href="/csharp/xml-documentation-comments.html" class="sidebar-link">XML Documentation Comments</a></li><li><a href="/csharp/comments-and-regions.html" class="sidebar-link">Comments and regions</a></li><li><a href="/csharp/inheritance.html" class="sidebar-link">Inheritance</a></li><li><a href="/csharp/generics.html" class="sidebar-link">Generics</a></li><li><a href="/csharp/using-statement.html" class="sidebar-link">Using Statement</a></li><li><a href="/csharp/using-directive.html" class="sidebar-link">Using Directive</a></li><li><a href="/csharp/idisposable-interface.html" class="sidebar-link">IDisposable interface</a></li><li><a href="/csharp/reflection.html" class="sidebar-link">Reflection</a></li><li><a href="/csharp/iqueryable-interface.html" class="sidebar-link">IQueryable interface</a></li><li><a href="/csharp/linq-to-objects.html" class="sidebar-link">Linq to Objects</a></li><li><a href="/csharp/linq-queries.html" class="sidebar-link">LINQ Queries</a></li><li><a href="/csharp/linq-to-xml.html" class="sidebar-link">LINQ to XML</a></li><li><a href="/csharp/parallel-linq-plinq.html" class="sidebar-link">Parallel LINQ (PLINQ)</a></li><li><a href="/csharp/xmldocument-and-the-system-xml-namespace.html" class="sidebar-link">XmlDocument and the System.Xml namespace</a></li><li><a href="/csharp/xdocument-and-the-system-xml-linq-namespace.html" class="sidebar-link">XDocument and the System.Xml.Linq namespace</a></li><li><a href="/csharp/c-7-0-features.html" class="sidebar-link">C# 7.0 Features</a></li><li><a href="/csharp/c-6-0-features.html" class="sidebar-link">C# 6.0 Features</a></li><li><a href="/csharp/c-5-0-features.html" class="sidebar-link">C# 5.0 Features</a></li><li><a href="/csharp/c-4-0-features.html" class="sidebar-link">C# 4.0 Features</a></li><li><a href="/csharp/c-3-0-features.html" class="sidebar-link">C# 3.0 Features</a></li><li><a href="/csharp/exception-handling.html" class="sidebar-link">Exception Handling</a></li><li><a href="/csharp/nullreferenceexception.html" class="sidebar-link">NullReferenceException</a></li><li><a href="/csharp/handling-formatexception-when-converting-string-to-other-types.html" class="sidebar-link">Handling FormatException when converting string to other types</a></li><li><a href="/csharp/read-understand-stacktraces.html" class="sidebar-link">Read &amp; Understand Stacktraces</a></li><li><a href="/csharp/diagnostics.html" class="sidebar-link">Diagnostics</a></li><li><a href="/csharp/overflow.html" class="sidebar-link">Overflow</a></li><li><a href="/csharp/getting-started-json-with-c.html" class="sidebar-link">Getting Started: Json with C#</a></li><li><a href="/csharp/using-json-net.html" class="sidebar-link">Using json.net</a></li><li><a href="/csharp/lambda-expressions.html" class="sidebar-link">Lambda Expressions</a></li><li><a href="/csharp/generic-lambda-query-builder.html" class="sidebar-link">Generic Lambda Query Builder</a></li><li><a href="/csharp/properties.html" class="sidebar-link">Properties</a></li><li><a href="/csharp/initializing-properties.html" class="sidebar-link">Initializing Properties</a></li><li><a href="/csharp/inotifypropertychanged-interface.html" class="sidebar-link">INotifyPropertyChanged interface</a></li><li><a href="/csharp/events.html" class="sidebar-link">Events</a></li><li><a href="/csharp/expression-trees.html" class="active sidebar-link">Expression Trees</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/csharp/expression-trees.html#create-expression-trees-with-a-lambda-expression" class="sidebar-link">Create Expression Trees with a lambda expression</a></li><li class="sidebar-sub-header"><a href="/csharp/expression-trees.html#creating-expression-trees-by-using-the-api" class="sidebar-link">Creating Expression Trees by Using the API</a></li><li class="sidebar-sub-header"><a href="/csharp/expression-trees.html#compiling-expression-trees" class="sidebar-link">Compiling Expression Trees</a></li><li class="sidebar-sub-header"><a href="/csharp/expression-trees.html#parsing-expression-trees" class="sidebar-link">Parsing Expression Trees</a></li><li class="sidebar-sub-header"><a href="/csharp/expression-trees.html#expression-tree-basic" class="sidebar-link">Expression Tree Basic</a></li><li class="sidebar-sub-header"><a href="/csharp/expression-trees.html#examining-the-structure-of-an-expression-using-visitor" class="sidebar-link">Examining the Structure of an Expression using Visitor</a></li><li class="sidebar-sub-header"><a href="/csharp/expression-trees.html#understanding-the-expressions-api" class="sidebar-link">Understanding the expressions API</a></li></ul></li><li><a href="/csharp/overload-resolution.html" class="sidebar-link">Overload Resolution</a></li><li><a href="/csharp/bindinglist-t.html" class="sidebar-link">BindingList</a></li><li><a href="/csharp/preprocessor-directives.html" class="sidebar-link">Preprocessor directives</a></li><li><a href="/csharp/structs.html" class="sidebar-link">Structs</a></li><li><a href="/csharp/attributes.html" class="sidebar-link">Attributes</a></li><li><a href="/csharp/delegates.html" class="sidebar-link">Delegates</a></li><li><a href="/csharp/file-and-stream-i-o.html" class="sidebar-link">File and Stream I/O</a></li><li><a href="/csharp/networking.html" class="sidebar-link">Networking</a></li><li><a href="/csharp/performing-http-requests.html" class="sidebar-link">Performing HTTP requests</a></li><li><a href="/csharp/reading-and-writing-zip-files.html" class="sidebar-link">Reading and writing .zip files</a></li><li><a href="/csharp/filesystemwatcher.html" class="sidebar-link">FileSystemWatcher</a></li><li><a href="/csharp/access-network-shared-folder-with-username-and-password.html" class="sidebar-link">Access network shared folder with username and password</a></li><li><a href="/csharp/asynchronous-socket.html" class="sidebar-link">Asynchronous Socket</a></li><li><a href="/csharp/action-filters.html" class="sidebar-link">Action Filters</a></li><li><a href="/csharp/polymorphism.html" class="sidebar-link">Polymorphism</a></li><li><a href="/csharp/immutability.html" class="sidebar-link">Immutability</a></li><li><a href="/csharp/indexer.html" class="sidebar-link">Indexer</a></li><li><a href="/csharp/checked-and-unchecked.html" class="sidebar-link">Checked and Unchecked</a></li><li><a href="/csharp/stream.html" class="sidebar-link">Stream</a></li><li><a href="/csharp/timers.html" class="sidebar-link">Timers</a></li><li><a href="/csharp/stopwatches.html" class="sidebar-link">Stopwatches</a></li><li><a href="/csharp/threading.html" class="sidebar-link">Threading</a></li><li><a href="/csharp/async-await-backgroundworker-task-and-thread-examples.html" class="sidebar-link">Async/await, Backgroundworker, Task and Thread Examples</a></li><li><a href="/csharp/async-await.html" class="sidebar-link">Async-Await</a></li><li><a href="/csharp/synchronization-context-in-async-await.html" class="sidebar-link">Synchronization Context in Async-Await</a></li><li><a href="/csharp/backgroundworker.html" class="sidebar-link">BackgroundWorker</a></li><li><a href="/csharp/task-parallel-library.html" class="sidebar-link">Task Parallel Library</a></li><li><a href="/csharp/making-a-variable-thread-safe.html" class="sidebar-link">Making a variable thread safe</a></li><li><a href="/csharp/lock-statement.html" class="sidebar-link">Lock Statement</a></li><li><a href="/csharp/yield-keyword.html" class="sidebar-link">Yield Keyword</a></li><li><a href="/csharp/task-parallel-library-tpl-dataflow-constructs.html" class="sidebar-link">Task Parallel Library (TPL) Dataflow Constructs</a></li><li><a href="/csharp/functional-programming.html" class="sidebar-link">Functional Programming</a></li><li><a href="/csharp/func-delegates.html" class="sidebar-link">Func delegates</a></li><li><a href="/csharp/function-with-multiple-return-values.html" class="sidebar-link">Function with multiple return values</a></li><li><a href="/csharp/binary-serialization.html" class="sidebar-link">Binary Serialization</a></li><li><a href="/csharp/icloneable.html" class="sidebar-link">ICloneable</a></li><li><a href="/csharp/icomparable.html" class="sidebar-link">IComparable</a></li><li><a href="/csharp/accessing-databases.html" class="sidebar-link">Accessing Databases</a></li><li><a href="/csharp/using-sqlite-in-c.html" class="sidebar-link">Using SQLite in C#</a></li><li><a href="/csharp/caching.html" class="sidebar-link">Caching</a></li><li><a href="/csharp/code-contracts.html" class="sidebar-link">Code Contracts</a></li><li><a href="/csharp/code-contracts-and-assertions.html" class="sidebar-link">Code Contracts and Assertions</a></li><li><a href="/csharp/structural-design-patterns.html" class="sidebar-link">Structural Design Patterns</a></li><li><a href="/csharp/creational-design-patterns.html" class="sidebar-link">Creational Design Patterns</a></li><li><a href="/csharp/implementing-decorator-design-pattern.html" class="sidebar-link">Implementing Decorator Design Pattern</a></li><li><a href="/csharp/implementing-flyweight-design-pattern.html" class="sidebar-link">Implementing Flyweight Design Pattern</a></li><li><a href="/csharp/system-management-automation.html" class="sidebar-link">System.Management.Automation</a></li><li><a href="/csharp/system-directoryservices-protocols-ldapconnection.html" class="sidebar-link">System.DirectoryServices.Protocols.LdapConnection</a></li><li><a href="/csharp/c-authentication-handler.html" class="sidebar-link">C# Authentication handler</a></li><li><a href="/csharp/pointers.html" class="sidebar-link">Pointers</a></li><li><a href="/csharp/pointers-unsafe-code.html" class="sidebar-link">Pointers &amp; Unsafe Code</a></li><li><a href="/csharp/how-to-use-c-structs-to-create-a-union-type-similar-to-c-unions.html" class="sidebar-link">How to use C# Structs to create a Union type  (Similar to C Unions)</a></li><li><a href="/csharp/reactive-extensions-rx.html" class="sidebar-link">Reactive Extensions (Rx)</a></li><li><a href="/csharp/assemblyinfo-cs-examples.html" class="sidebar-link">AssemblyInfo.cs Examples</a></li><li><a href="/csharp/creating-a-console-application-using-a-plain-text-editor-and-the-c-compiler-csc-exe.html" class="sidebar-link">Creating a Console Application using a Plain-Text Editor and the C# Compiler (csc.exe)</a></li><li><a href="/csharp/clscompliantattribute.html" class="sidebar-link">CLSCompliantAttribute</a></li><li><a href="/csharp/observablecollection-t.html" class="sidebar-link">ObservableCollection</a></li><li><a href="/csharp/hash-functions.html" class="sidebar-link">Hash Functions</a></li><li><a href="/csharp/generating-random-numbers-in-c.html" class="sidebar-link">Generating Random Numbers in C#</a></li><li><a href="/csharp/cryptography-system-security-cryptography.html" class="sidebar-link">Cryptography (System.Security.Cryptography)</a></li><li><a href="/csharp/asp-net-identity.html" class="sidebar-link">ASP.NET Identity</a></li><li><a href="/csharp/unsafe-code-in-net.html" class="sidebar-link">Unsafe Code in .NET</a></li><li><a href="/csharp/c-script.html" class="sidebar-link">C# Script</a></li><li><a href="/csharp/runtime-compile.html" class="sidebar-link">Runtime Compile</a></li><li><a href="/csharp/interoperability.html" class="sidebar-link">Interoperability</a></li><li><a href="/csharp/net-compiler-platform-roslyn.html" class="sidebar-link">.NET Compiler Platform (Roslyn)</a></li><li><a href="/csharp/ilgenerator.html" class="sidebar-link">ILGenerator</a></li><li><a href="/csharp/t4-code-generation.html" class="sidebar-link">T4 Code Generation</a></li><li><a href="/csharp/creating-own-messagebox-in-windows-form-application.html" class="sidebar-link">Creating Own MessageBox in Windows Form Application</a></li><li><a href="/csharp/including-font-resources.html" class="sidebar-link">Including Font Resources</a></li><li><a href="/csharp/import-google-contacts.html" class="sidebar-link">Import Google Contacts</a></li><li><a href="/csharp/garbage-collector-in-net.html" class="sidebar-link">Garbage Collector in .Net</a></li><li><a href="/csharp/microsoft-exchange-webservices.html" class="sidebar-link">Microsoft.Exchange.WebServices</a></li><li><a href="/csharp/windows-communication-foundation.html" class="sidebar-link">Windows Communication Foundation</a></li><li><a href="/csharp/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="expression-trees"><a href="#expression-trees" class="header-anchor">#</a> Expression Trees</h1> <h2 id="create-expression-trees-with-a-lambda-expression"><a href="#create-expression-trees-with-a-lambda-expression" class="header-anchor">#</a> Create Expression Trees with a lambda expression</h2> <p>Following is most basic expression tree that is created by lambda.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token class-name">Expression<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> lambda <span class="token operator">=</span> num <span class="token operator">=&gt;</span> num <span class="token operator">==</span> <span class="token number">42</span><span class="token punctuation">;</span>

</code></pre></div><p>To create expression trees 'by hand', one should use <code>Expression</code> class.</p> <p>Expression above would be equivalent to:</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token class-name">ParameterExpression</span> parameter <span class="token operator">=</span> Expression<span class="token punctuation">.</span><span class="token function">Parameter</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name"><span class="token keyword">int</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;num&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// num argument</span>
<span class="token class-name">ConstantExpression</span> constant <span class="token operator">=</span> Expression<span class="token punctuation">.</span><span class="token function">Constant</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name"><span class="token keyword">int</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 42 constant</span>
<span class="token class-name">BinaryExpression</span> equality <span class="token operator">=</span> Expression<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span>parameter<span class="token punctuation">,</span> constant<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// equality of two expressions (num == 42)</span>
<span class="token class-name">Expression<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> lambda <span class="token operator">=</span> Expression<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Lambda</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>equality<span class="token punctuation">,</span> parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="creating-expression-trees-by-using-the-api"><a href="#creating-expression-trees-by-using-the-api" class="header-anchor">#</a> Creating Expression Trees by Using the API</h2> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Linq<span class="token punctuation">.</span>Expressions</span><span class="token punctuation">;</span>

<span class="token comment">// Manually build the expression tree for </span>
<span class="token comment">// the lambda expression num =&gt; num &lt; 5.</span>
<span class="token class-name">ParameterExpression</span> numParam <span class="token operator">=</span> Expression<span class="token punctuation">.</span><span class="token function">Parameter</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name"><span class="token keyword">int</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;num&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">ConstantExpression</span> five <span class="token operator">=</span> Expression<span class="token punctuation">.</span><span class="token function">Constant</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name"><span class="token keyword">int</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">BinaryExpression</span> numLessThanFive <span class="token operator">=</span> Expression<span class="token punctuation">.</span><span class="token function">LessThan</span><span class="token punctuation">(</span>numParam<span class="token punctuation">,</span> five<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Expression<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> lambda1 <span class="token operator">=</span>
    Expression<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Lambda</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>
        numLessThanFive<span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ParameterExpression<span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span> numParam <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="compiling-expression-trees"><a href="#compiling-expression-trees" class="header-anchor">#</a> Compiling Expression Trees</h2> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token comment">// Define an expression tree, taking an integer, returning a bool.</span>
<span class="token class-name">Expression<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> expr <span class="token operator">=</span> num <span class="token operator">=&gt;</span> num <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span>

<span class="token comment">// Call the Compile method on the expression tree to return a delegate that can be called.</span>
<span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> expr<span class="token punctuation">.</span><span class="token function">Compile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Invoke the delegate and write the result to the console.</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Prints true</span>

<span class="token comment">// Prints True.</span>

<span class="token comment">// You can also combine the compile step with the call/invoke step as below:</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>expr<span class="token punctuation">.</span><span class="token function">Compile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="parsing-expression-trees"><a href="#parsing-expression-trees" class="header-anchor">#</a> Parsing Expression Trees</h2> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Linq<span class="token punctuation">.</span>Expressions</span><span class="token punctuation">;</span>

<span class="token comment">// Create an expression tree.</span>
<span class="token class-name">Expression<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> exprTree <span class="token operator">=</span> num <span class="token operator">=&gt;</span> num <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span>

<span class="token comment">// Decompose the expression tree.</span>
<span class="token class-name">ParameterExpression</span> param <span class="token operator">=</span> <span class="token punctuation">(</span>ParameterExpression<span class="token punctuation">)</span>exprTree<span class="token punctuation">.</span>Parameters<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token class-name">BinaryExpression</span> operation <span class="token operator">=</span> <span class="token punctuation">(</span>BinaryExpression<span class="token punctuation">)</span>exprTree<span class="token punctuation">.</span>Body<span class="token punctuation">;</span>
<span class="token class-name">ParameterExpression</span> left <span class="token operator">=</span> <span class="token punctuation">(</span>ParameterExpression<span class="token punctuation">)</span>operation<span class="token punctuation">.</span>Left<span class="token punctuation">;</span>
<span class="token class-name">ConstantExpression</span> right <span class="token operator">=</span> <span class="token punctuation">(</span>ConstantExpression<span class="token punctuation">)</span>operation<span class="token punctuation">.</span>Right<span class="token punctuation">;</span>

Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Decomposed expression: {0} =&gt; {1} {2} {3}&quot;</span><span class="token punctuation">,</span>
                  param<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> left<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> operation<span class="token punctuation">.</span>NodeType<span class="token punctuation">,</span> right<span class="token punctuation">.</span>Value<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Decomposed expression: num =&gt; num LessThan 5      </span>

</code></pre></div><h2 id="expression-tree-basic"><a href="#expression-tree-basic" class="header-anchor">#</a> Expression Tree Basic</h2> <p>Expression trees represent code in a tree-like data structure, where each node is an expression</p> <p>Expression Trees enables dynamic modification of executable code, the execution of LINQ queries in various databases, and the creation of dynamic queries. You can compile and run code represented by expression trees.</p> <p>These are also used in the dynamic language run-time (DLR) to provide interoperability between dynamic languages and the .NET Framework and to enable compiler writers to emit expression trees instead of Microsoft intermediate language (MSIL).</p> <p>Expression Trees can be created Via</p> <ol><li>Anonymous lambda expression,</li> <li>Manually by using the System.Linq.Expressions namespace.</li></ol> <p><strong>Expression Trees from Lambda Expressions</strong></p> <p>When a lambda expression is assigned to Expression type variable , the compiler emits code to build an expression tree that represents the lambda expression.</p> <p>The following code examples shows how to have the C# compiler create an expression tree that represents the lambda expression num =&gt; num &lt; 5.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token class-name">Expression<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> lambda <span class="token operator">=</span> num <span class="token operator">=&gt;</span> num <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span>

</code></pre></div><p><strong>Expression Trees by Using the API</strong></p> <p>Expression Trees also created using the <strong>Expression</strong> Class. This class contains static factory methods that create expression tree nodes of specific types.</p> <p>Below are few type of Tree nodes.</p> <ol><li>ParameterExpression</li> <li>MethodCallExpression</li></ol> <p>The following code example shows how to create an expression tree that represents the lambda expression num =&gt; num &lt; 5 by using the API.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token class-name">ParameterExpression</span> numParam <span class="token operator">=</span> Expression<span class="token punctuation">.</span><span class="token function">Parameter</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name"><span class="token keyword">int</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;num&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">ConstantExpression</span> five <span class="token operator">=</span> Expression<span class="token punctuation">.</span><span class="token function">Constant</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name"><span class="token keyword">int</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">BinaryExpression</span> numLessThanFive <span class="token operator">=</span> Expression<span class="token punctuation">.</span><span class="token function">LessThan</span><span class="token punctuation">(</span>numParam<span class="token punctuation">,</span> five<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Expression<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> lambda1 <span class="token operator">=</span> Expression<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Lambda</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>numLessThanFive<span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">ParameterExpression<span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span> numParam <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="examining-the-structure-of-an-expression-using-visitor"><a href="#examining-the-structure-of-an-expression-using-visitor" class="header-anchor">#</a> Examining the Structure of an Expression using Visitor</h2> <p>Define a new visitor class by overriding some of the methods of <a href="https://msdn.microsoft.com/en-us/library/system.linq.expressions.expressionvisitor(v=vs.110).aspx" target="_blank" rel="noopener noreferrer">ExpressionVisitor<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>:</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">class</span> <span class="token class-name">PrintingVisitor</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ExpressionVisitor</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name">Expression</span> <span class="token function">VisitConstant</span><span class="token punctuation">(</span><span class="token class-name">ConstantExpression</span> node<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Constant: {0}&quot;</span><span class="token punctuation">,</span> node<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">VisitConstant</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name">Expression</span> <span class="token function">VisitParameter</span><span class="token punctuation">(</span><span class="token class-name">ParameterExpression</span> node<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Parameter: {0}&quot;</span><span class="token punctuation">,</span> node<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">VisitParameter</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name">Expression</span> <span class="token function">VisitBinary</span><span class="token punctuation">(</span><span class="token class-name">BinaryExpression</span> node<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Binary with operator {0}&quot;</span><span class="token punctuation">,</span> node<span class="token punctuation">.</span>NodeType<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">VisitBinary</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>Call <code>Visit</code> to use this visitor on an existing expression:</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token class-name">Expression<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span><span class="token keyword">bool</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> isBig <span class="token operator">=</span> a <span class="token operator">=&gt;</span> a <span class="token operator">&gt;</span> <span class="token number">1000000</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> visitor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">PrintingVisitor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
visitor<span class="token punctuation">.</span><span class="token function">Visit</span><span class="token punctuation">(</span>isBig<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="understanding-the-expressions-api"><a href="#understanding-the-expressions-api" class="header-anchor">#</a> Understanding the expressions API</h2> <p>We're going to use the expression tree API to create a <code>CalculateSalesTax</code> tree.  In plain English, here's a summary of the steps it takes to create the tree.</p> <ol><li>Check if the product is taxable</li> <li>If it is, multiply the line total by the applicable tax rate and return that amount</li> <li>Otherwise return 0</li></ol> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token comment">//For reference, we're using the API to build this lambda expression</span>
    orderLine <span class="token operator">=&gt;</span> orderLine<span class="token punctuation">.</span>IsTaxable <span class="token punctuation">?</span> orderLine<span class="token punctuation">.</span>Total <span class="token operator">*</span> orderLine<span class="token punctuation">.</span>Order<span class="token punctuation">.</span>TaxRate <span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token comment">//The orderLine parameter we pass in to the method.  We specify it's type (OrderLine) and the name of the parameter.</span>
    <span class="token class-name">ParameterExpression</span> orderLine <span class="token operator">=</span> Expression<span class="token punctuation">.</span><span class="token function">Parameter</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">OrderLine</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;orderLine&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//Check if the parameter is taxable;  First we need to access the is taxable property, then check if it's true</span>
    <span class="token class-name">PropertyInfo</span> isTaxableAccessor <span class="token operator">=</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">OrderLine</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetProperty</span><span class="token punctuation">(</span><span class="token string">&quot;IsTaxable&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">MemberExpression</span> getIsTaxable <span class="token operator">=</span> Expression<span class="token punctuation">.</span><span class="token function">MakeMemberAccess</span><span class="token punctuation">(</span>orderLine<span class="token punctuation">,</span> isTaxableAccessor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">UnaryExpression</span> isLineTaxable <span class="token operator">=</span> Expression<span class="token punctuation">.</span><span class="token function">IsTrue</span><span class="token punctuation">(</span>getIsTaxable<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//Before creating the if, we need to create the braches</span>
    <span class="token comment">//If the line is taxable, we'll return the total times the tax rate; get the total and tax rate, then multiply</span>
    <span class="token comment">//Get the total</span>
    <span class="token class-name">PropertyInfo</span> totalAccessor <span class="token operator">=</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">OrderLine</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetProperty</span><span class="token punctuation">(</span><span class="token string">&quot;Total&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">MemberExpression</span> getTotal <span class="token operator">=</span> Expression<span class="token punctuation">.</span><span class="token function">MakeMemberAccess</span><span class="token punctuation">(</span>orderLine<span class="token punctuation">,</span> totalAccessor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">//Get the order</span>
    <span class="token class-name">PropertyInfo</span> orderAccessor <span class="token operator">=</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">OrderLine</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetProperty</span><span class="token punctuation">(</span><span class="token string">&quot;Order&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">MemberExpression</span> getOrder <span class="token operator">=</span> Expression<span class="token punctuation">.</span><span class="token function">MakeMemberAccess</span><span class="token punctuation">(</span>orderLine<span class="token punctuation">,</span> orderAccessor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">//Get the tax rate - notice that we pass the getOrder expression directly to the member access</span>
    <span class="token class-name">PropertyInfo</span> taxRateAccessor <span class="token operator">=</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">Order</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetProperty</span><span class="token punctuation">(</span><span class="token string">&quot;TaxRate&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">MemberExpression</span> getTaxRate <span class="token operator">=</span> Expression<span class="token punctuation">.</span><span class="token function">MakeMemberAccess</span><span class="token punctuation">(</span>getOrder<span class="token punctuation">,</span> taxRateAccessor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">//Multiply the two - notice we pass the two operand expressions directly to multiply</span>
    <span class="token class-name">BinaryExpression</span> multiplyTotalByRate <span class="token operator">=</span> Expression<span class="token punctuation">.</span><span class="token function">Multiply</span><span class="token punctuation">(</span>getTotal<span class="token punctuation">,</span> getTaxRate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token comment">//If the line is not taxable, we'll return a constant value - 0.0 (decimal)</span>
    <span class="token class-name">ConstantExpression</span> zero <span class="token operator">=</span> Expression<span class="token punctuation">.</span><span class="token function">Constant</span><span class="token punctuation">(</span><span class="token number">0M</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//Create the actual if check and branches</span>
    <span class="token class-name">ConditionalExpression</span> ifTaxableTernary <span class="token operator">=</span> Expression<span class="token punctuation">.</span><span class="token function">Condition</span><span class="token punctuation">(</span>isLineTaxable<span class="token punctuation">,</span> multiplyTotalByRate<span class="token punctuation">,</span> zero<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token comment">//Wrap the whole thing up in a &quot;method&quot; - a LambdaExpression</span>
    <span class="token class-name">Expression<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span>OrderLine<span class="token punctuation">,</span> <span class="token keyword">decimal</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> method <span class="token operator">=</span> Expression<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Lambda</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span>OrderLine<span class="token punctuation">,</span> <span class="token keyword">decimal</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>ifTaxableTernary<span class="token punctuation">,</span> orderLine<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h4 id="syntax"><a href="#syntax" class="header-anchor">#</a> Syntax</h4> <ul><li>Expression<TDelegate> name = lambdaExpression;</TDelegate></li></ul> <h4 id="parameters"><a href="#parameters" class="header-anchor">#</a> Parameters</h4> <table><thead><tr><th>Parameter</th> <th>Details</th></tr></thead> <tbody><tr><td>TDelegate</td> <td>The delegate type to be used for the expression</td></tr> <tr><td>lambdaExpression</td> <td>The lambda expression (ex. <code>num =&gt; num &lt; 5</code>)</td></tr></tbody></table> <h4 id="remarks"><a href="#remarks" class="header-anchor">#</a> Remarks</h4> <h3 id="intro-to-expression-trees"><a href="#intro-to-expression-trees" class="header-anchor">#</a> Intro to Expression Trees</h3> <h3 id="where-we-came-from"><a href="#where-we-came-from" class="header-anchor">#</a> Where we came from</h3> <p>Expression trees are all about consuming &quot;source code&quot; at runtime.  Consider a method which calculates the sales tax due on a sales order <code>decimal CalculateTotalTaxDue(SalesOrder order)</code>.  Using that method in a .NET program is easy  you just call it <code>decimal taxDue = CalculateTotalTaxDue(order);</code>.  What if you want to apply it to all the results from a remote query (SQL, XML, a remote server, etc)?  Those remote query sources cannot call the method!  Traditionally, you would have to invert the flow in all these cases.  Make the entire query, store it in memory, then loop through the results and calculate tax for each result.</p> <p><a name="remarks-how-to-avoid-flow-inversion's-memory-and-latency-problems-2" class="remarks-subsection-anchor"></a></p><h3>How to avoid flow inversion's memory and latency problems</h3><p></p> <p>Expression trees are data structures in a format of a tree, where each node holds an expression. They are used to translate the compiled instructions (like methods used to filter data) in expressions which could be used outside of the program environment such as inside a database query.</p> <p>The problem here is that a remote query <strong>cannot access our method</strong>.  We could avoid this problem if instead, we sent the <strong>instructions</strong> for the method to the remote query.  In our <code>CalculateTotalTaxDue</code> example, that means we send this information:</p> <ol><li>Create a variable to store the total tax</li> <li>Loop through all the lines on the order</li> <li>For each line, check if the product is taxable</li> <li>If it is, multiply the line total by the applicable tax rate and add that amount to the total</li> <li>Otherwise do nothing</li></ol> <p>With those instructions, the remote query can perform the work as it's creating the data.</p> <p>There are two challenges to implementing this. How do you transform a compiled .NET method into a list of instructions, and how do you format the instructions in a way that they can be consumed by the remote system?</p> <p>Without expression trees, you could only solve the first problem with MSIL.  (MSIL is the assembler-like code created by the .NET compiler.)  Parsing MSIL is <strong>possible</strong>, but it's not easy.  Even when you do parse it properly, it can be hard to determine what the original programmer's intent was with a particular routine.</p> <p><a name="remarks-expression-trees-save-the-day-3" class="remarks-subsection-anchor"></a></p><h3>Expression trees save the day</h3>
Expression trees address these exact issues.  They represent program instructions a tree data structure where each node represents <strong>one instruction</strong> and has references to all the information you need to execute that instruction.  For example, a <code>MethodCallExpression</code> has reference to 1) the <code>MethodInfo</code> it is going to call, 2) a list of <code>Expression</code>s it will pass to that method, 3) for instance methods, the <code>Expression</code> you'll call the method on.  You can &quot;walk the tree&quot; and apply the instructions on your remote query.<p></p> <p><a name="remarks-creating-expression-trees-4" class="remarks-subsection-anchor"></a></p><h3>Creating expression trees</h3>
The easiest way to create an expression tree is with a lambda expression.  These expressions look almost the same as normal C# methods.  It's important to realize this is <strong>compiler magic</strong>.  When you first create a lambda expression, the compiler checks what you assign it to.  If it's a <code>Delegate</code> type (including <code>Action</code> or <code>Func</code>), the compiler converts the lambda expression into a delegate.  If it's a <code>LambdaExpression</code> (or an <code>Expression&lt;Action&lt;T&gt;&gt;</code> or <code>Expression&lt;Func&lt;T&gt;&gt;</code> which are strongly typed <code>LambdaExpression</code>'s), the compiler transforms it into a <code>LambdaExpression</code>.  This is where the magic kicks in.  Behind the scenes, the compiler <strong>uses the expression tree API</strong> to transform your lambda expression into a <code>LambdaExpression</code>.<p></p> <p>Lambda expressions cannot create every type of expression tree.  In those cases, you can use the Expressions API manually to create the tree you need to.  In the <a href="//stackoverflow.com/documentation/c%23/75/expression-trees/19200/understanding-the-expressions-api">Understanding the expressions API</a> example, we create the <code>CalculateTotalSalesTax</code> expression using the API.</p> <p>NOTE: The names get a bit confusing here.  A <strong>lambda expression</strong> (two words, lower case) refers to the block of code with a <code>=&gt;</code> indicator.  It represents an anonymous method in C# and is converted into either a <code>Delegate</code> or <code>Expression</code>.  A <strong><code>LambdaExpression</code></strong> (one word, PascalCase) refers to the node type within the Expression API which represents a method you can execute.</p> <h3 id="expression-trees-and-linq"><a href="#expression-trees-and-linq" class="header-anchor">#</a> Expression Trees and LINQ</h3> <p>One of the most common uses of expression trees is with LINQ and database queries.  LINQ pairs an expression tree with a query provider to apply your instructions to the target remote query.  For example, the LINQ to Entity Framework query provider transforms an expression tree into SQL which is executed against the database directly.</p> <p>Putting all the pieces together, you can see the real power behind LINQ.</p> <ol><li>Write a query using a lambda expression: <code>products.Where(x =&gt; x.Cost &gt; 5)</code></li> <li>The compiler transforms that expression into an expression tree with the instructions &quot;check if the Cost property of the parameter is greater than five&quot;.</li> <li>The query provider parses the expression tree and produces a valid SQL query <code>SELECT * FROM products WHERE Cost &gt; 5</code></li> <li>The ORM projects all the results into POCOs and you get a list of objects back</li></ol> <h3 id="notes"><a href="#notes" class="header-anchor">#</a> Notes</h3> <ul><li>Expression trees are immutable. If you want to change an expression tree you need to create a new one, copy the existing one into the new one (to traverse an expression tree you can use the <code>ExpressionVisitor</code>) and make the wanted changes.</li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/csharp/expression-trees.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      
      <a href="/csharp/events.html" class="prev">
        Events
      </a></span> <span class="next"><a href="/csharp/overload-resolution.html">
        Overload Resolution
      </a>
      
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.ced448ab.js" defer></script><script src="/assets/js/3.f1d73125.js" defer></script><script src="/assets/js/810.3afde26c.js" defer></script>
  </body>
</html>
