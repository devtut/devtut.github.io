<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>C# | Task Parallel Library (TPL) Dataflow Constructs</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="ActionBlock<T>, BroadcastBlock<T>, BufferBlock<T>, JoinBlock<T1, T2,…>, WriteOnceBlock<T>, BatchedJoinBlock<T1, T2,…>, TransformBlock<TInput, TOutput>, TransformManyBlock<TInput, TOutput>, BatchBlock<T>">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="C# | Task Parallel Library (TPL) Dataflow Constructs">
    <meta property="og:description" content="ActionBlock<T>, BroadcastBlock<T>, BufferBlock<T>, JoinBlock<T1, T2,…>, WriteOnceBlock<T>, BatchedJoinBlock<T1, T2,…>, TransformBlock<TInput, TOutput>, TransformManyBlock<TInput, TOutput>, BatchBlock<T>">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/csharp/task-parallel-library-tpl-dataflow-constructs.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="C# | Task Parallel Library (TPL) Dataflow Constructs">
    <meta name="twitter:description" content="ActionBlock<T>, BroadcastBlock<T>, BufferBlock<T>, JoinBlock<T1, T2,…>, WriteOnceBlock<T>, BatchedJoinBlock<T1, T2,…>, TransformBlock<TInput, TOutput>, TransformManyBlock<TInput, TOutput>, BatchBlock<T>">
    <meta name="twitter:url" content="/csharp/task-parallel-library-tpl-dataflow-constructs.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/906.ad17d575.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>C#</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/csharp/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/csharp/getting-started-with-c-language.html" class="sidebar-link">Getting started with C# Language</a></li><li><a href="/csharp/literals.html" class="sidebar-link">Literals</a></li><li><a href="/csharp/operators.html" class="sidebar-link">Operators</a></li><li><a href="/csharp/conditional-statements.html" class="sidebar-link">Conditional Statements</a></li><li><a href="/csharp/equality-operator.html" class="sidebar-link">Equality Operator</a></li><li><a href="/csharp/equals-and-gethashcode.html" class="sidebar-link">Equals and GetHashCode</a></li><li><a href="/csharp/null-coalescing-operator.html" class="sidebar-link">Null-Coalescing Operator</a></li><li><a href="/csharp/null-conditional-operators.html" class="sidebar-link">Null-conditional Operators</a></li><li><a href="/csharp/nameof-operator.html" class="sidebar-link">nameof Operator</a></li><li><a href="/csharp/verbatim-strings.html" class="sidebar-link">Verbatim Strings</a></li><li><a href="/csharp/common-string-operations.html" class="sidebar-link">Common String Operations</a></li><li><a href="/csharp/string-format.html" class="sidebar-link">String.Format</a></li><li><a href="/csharp/string-concatenate.html" class="sidebar-link">String Concatenate</a></li><li><a href="/csharp/string-manipulation.html" class="sidebar-link">String Manipulation</a></li><li><a href="/csharp/string-interpolation.html" class="sidebar-link">String Interpolation</a></li><li><a href="/csharp/string-escape-sequences.html" class="sidebar-link">String Escape Sequences</a></li><li><a href="/csharp/stringbuilder.html" class="sidebar-link">StringBuilder</a></li><li><a href="/csharp/regex-parsing.html" class="sidebar-link">Regex Parsing</a></li><li><a href="/csharp/datetime-methods.html" class="sidebar-link">DateTime Methods</a></li><li><a href="/csharp/arrays.html" class="sidebar-link">Arrays</a></li><li><a href="/csharp/o-n-algorithm-for-circular-rotation-of-an-array.html" class="sidebar-link">O(n) Algorithm for circular rotation of an array</a></li><li><a href="/csharp/enum.html" class="sidebar-link">Enum</a></li><li><a href="/csharp/tuples.html" class="sidebar-link">Tuples</a></li><li><a href="/csharp/guid.html" class="sidebar-link">Guid</a></li><li><a href="/csharp/biginteger.html" class="sidebar-link">BigInteger</a></li><li><a href="/csharp/collection-initializers.html" class="sidebar-link">Collection Initializers</a></li><li><a href="/csharp/an-overview-of-c-collections.html" class="sidebar-link">An overview of c# collections</a></li><li><a href="/csharp/looping.html" class="sidebar-link">Looping</a></li><li><a href="/csharp/iterators.html" class="sidebar-link">Iterators</a></li><li><a href="/csharp/ienumerable.html" class="sidebar-link">IEnumerable</a></li><li><a href="/csharp/value-type-vs-reference-type.html" class="sidebar-link">Value type vs Reference type</a></li><li><a href="/csharp/built-in-types.html" class="sidebar-link">Built-in Types</a></li><li><a href="/csharp/aliases-of-built-in-types.html" class="sidebar-link">Aliases of built-in types</a></li><li><a href="/csharp/anonymous-types.html" class="sidebar-link">Anonymous types</a></li><li><a href="/csharp/dynamic-type.html" class="sidebar-link">Dynamic type</a></li><li><a href="/csharp/type-conversion.html" class="sidebar-link">Type Conversion</a></li><li><a href="/csharp/casting.html" class="sidebar-link">Casting</a></li><li><a href="/csharp/nullable-types.html" class="sidebar-link">Nullable types</a></li><li><a href="/csharp/constructors-and-finalizers.html" class="sidebar-link">Constructors and Finalizers</a></li><li><a href="/csharp/access-modifiers.html" class="sidebar-link">Access Modifiers</a></li><li><a href="/csharp/interfaces.html" class="sidebar-link">Interfaces</a></li><li><a href="/csharp/static-classes.html" class="sidebar-link">Static Classes</a></li><li><a href="/csharp/singleton-implementation.html" class="sidebar-link">Singleton Implementation</a></li><li><a href="/csharp/dependency-injection.html" class="sidebar-link">Dependency Injection</a></li><li><a href="/csharp/partial-class-and-methods.html" class="sidebar-link">Partial class and methods</a></li><li><a href="/csharp/object-initializers.html" class="sidebar-link">Object initializers</a></li><li><a href="/csharp/methods.html" class="sidebar-link">Methods</a></li><li><a href="/csharp/extension-methods.html" class="sidebar-link">Extension Methods</a></li><li><a href="/csharp/named-arguments.html" class="sidebar-link">Named Arguments</a></li><li><a href="/csharp/named-and-optional-arguments.html" class="sidebar-link">Named and Optional Arguments</a></li><li><a href="/csharp/data-annotation.html" class="sidebar-link">Data Annotation</a></li><li><a href="/csharp/keywords.html" class="sidebar-link">Keywords</a></li><li><a href="/csharp/object-oriented-programming-in-c.html" class="sidebar-link">Object Oriented Programming In C#</a></li><li><a href="/csharp/recursion.html" class="sidebar-link">Recursion</a></li><li><a href="/csharp/naming-conventions.html" class="sidebar-link">Naming Conventions</a></li><li><a href="/csharp/xml-documentation-comments.html" class="sidebar-link">XML Documentation Comments</a></li><li><a href="/csharp/comments-and-regions.html" class="sidebar-link">Comments and regions</a></li><li><a href="/csharp/inheritance.html" class="sidebar-link">Inheritance</a></li><li><a href="/csharp/generics.html" class="sidebar-link">Generics</a></li><li><a href="/csharp/using-statement.html" class="sidebar-link">Using Statement</a></li><li><a href="/csharp/using-directive.html" class="sidebar-link">Using Directive</a></li><li><a href="/csharp/idisposable-interface.html" class="sidebar-link">IDisposable interface</a></li><li><a href="/csharp/reflection.html" class="sidebar-link">Reflection</a></li><li><a href="/csharp/iqueryable-interface.html" class="sidebar-link">IQueryable interface</a></li><li><a href="/csharp/linq-to-objects.html" class="sidebar-link">Linq to Objects</a></li><li><a href="/csharp/linq-queries.html" class="sidebar-link">LINQ Queries</a></li><li><a href="/csharp/linq-to-xml.html" class="sidebar-link">LINQ to XML</a></li><li><a href="/csharp/parallel-linq-plinq.html" class="sidebar-link">Parallel LINQ (PLINQ)</a></li><li><a href="/csharp/xmldocument-and-the-system-xml-namespace.html" class="sidebar-link">XmlDocument and the System.Xml namespace</a></li><li><a href="/csharp/xdocument-and-the-system-xml-linq-namespace.html" class="sidebar-link">XDocument and the System.Xml.Linq namespace</a></li><li><a href="/csharp/c-7-0-features.html" class="sidebar-link">C# 7.0 Features</a></li><li><a href="/csharp/c-6-0-features.html" class="sidebar-link">C# 6.0 Features</a></li><li><a href="/csharp/c-5-0-features.html" class="sidebar-link">C# 5.0 Features</a></li><li><a href="/csharp/c-4-0-features.html" class="sidebar-link">C# 4.0 Features</a></li><li><a href="/csharp/c-3-0-features.html" class="sidebar-link">C# 3.0 Features</a></li><li><a href="/csharp/exception-handling.html" class="sidebar-link">Exception Handling</a></li><li><a href="/csharp/nullreferenceexception.html" class="sidebar-link">NullReferenceException</a></li><li><a href="/csharp/handling-formatexception-when-converting-string-to-other-types.html" class="sidebar-link">Handling FormatException when converting string to other types</a></li><li><a href="/csharp/read-understand-stacktraces.html" class="sidebar-link">Read &amp; Understand Stacktraces</a></li><li><a href="/csharp/diagnostics.html" class="sidebar-link">Diagnostics</a></li><li><a href="/csharp/overflow.html" class="sidebar-link">Overflow</a></li><li><a href="/csharp/getting-started-json-with-c.html" class="sidebar-link">Getting Started: Json with C#</a></li><li><a href="/csharp/using-json-net.html" class="sidebar-link">Using json.net</a></li><li><a href="/csharp/lambda-expressions.html" class="sidebar-link">Lambda Expressions</a></li><li><a href="/csharp/generic-lambda-query-builder.html" class="sidebar-link">Generic Lambda Query Builder</a></li><li><a href="/csharp/properties.html" class="sidebar-link">Properties</a></li><li><a href="/csharp/initializing-properties.html" class="sidebar-link">Initializing Properties</a></li><li><a href="/csharp/inotifypropertychanged-interface.html" class="sidebar-link">INotifyPropertyChanged interface</a></li><li><a href="/csharp/events.html" class="sidebar-link">Events</a></li><li><a href="/csharp/expression-trees.html" class="sidebar-link">Expression Trees</a></li><li><a href="/csharp/overload-resolution.html" class="sidebar-link">Overload Resolution</a></li><li><a href="/csharp/bindinglist-t.html" class="sidebar-link">BindingList</a></li><li><a href="/csharp/preprocessor-directives.html" class="sidebar-link">Preprocessor directives</a></li><li><a href="/csharp/structs.html" class="sidebar-link">Structs</a></li><li><a href="/csharp/attributes.html" class="sidebar-link">Attributes</a></li><li><a href="/csharp/delegates.html" class="sidebar-link">Delegates</a></li><li><a href="/csharp/file-and-stream-i-o.html" class="sidebar-link">File and Stream I/O</a></li><li><a href="/csharp/networking.html" class="sidebar-link">Networking</a></li><li><a href="/csharp/performing-http-requests.html" class="sidebar-link">Performing HTTP requests</a></li><li><a href="/csharp/reading-and-writing-zip-files.html" class="sidebar-link">Reading and writing .zip files</a></li><li><a href="/csharp/filesystemwatcher.html" class="sidebar-link">FileSystemWatcher</a></li><li><a href="/csharp/access-network-shared-folder-with-username-and-password.html" class="sidebar-link">Access network shared folder with username and password</a></li><li><a href="/csharp/asynchronous-socket.html" class="sidebar-link">Asynchronous Socket</a></li><li><a href="/csharp/action-filters.html" class="sidebar-link">Action Filters</a></li><li><a href="/csharp/polymorphism.html" class="sidebar-link">Polymorphism</a></li><li><a href="/csharp/immutability.html" class="sidebar-link">Immutability</a></li><li><a href="/csharp/indexer.html" class="sidebar-link">Indexer</a></li><li><a href="/csharp/checked-and-unchecked.html" class="sidebar-link">Checked and Unchecked</a></li><li><a href="/csharp/stream.html" class="sidebar-link">Stream</a></li><li><a href="/csharp/timers.html" class="sidebar-link">Timers</a></li><li><a href="/csharp/stopwatches.html" class="sidebar-link">Stopwatches</a></li><li><a href="/csharp/threading.html" class="sidebar-link">Threading</a></li><li><a href="/csharp/async-await-backgroundworker-task-and-thread-examples.html" class="sidebar-link">Async/await, Backgroundworker, Task and Thread Examples</a></li><li><a href="/csharp/async-await.html" class="sidebar-link">Async-Await</a></li><li><a href="/csharp/synchronization-context-in-async-await.html" class="sidebar-link">Synchronization Context in Async-Await</a></li><li><a href="/csharp/backgroundworker.html" class="sidebar-link">BackgroundWorker</a></li><li><a href="/csharp/task-parallel-library.html" class="sidebar-link">Task Parallel Library</a></li><li><a href="/csharp/making-a-variable-thread-safe.html" class="sidebar-link">Making a variable thread safe</a></li><li><a href="/csharp/lock-statement.html" class="sidebar-link">Lock Statement</a></li><li><a href="/csharp/yield-keyword.html" class="sidebar-link">Yield Keyword</a></li><li><a href="/csharp/task-parallel-library-tpl-dataflow-constructs.html" aria-current="page" class="active sidebar-link">Task Parallel Library (TPL) Dataflow Constructs</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/csharp/task-parallel-library-tpl-dataflow-constructs.html#actionblock" class="sidebar-link">ActionBlock</a></li><li class="sidebar-sub-header"><a href="/csharp/task-parallel-library-tpl-dataflow-constructs.html#broadcastblock" class="sidebar-link">BroadcastBlock</a></li><li class="sidebar-sub-header"><a href="/csharp/task-parallel-library-tpl-dataflow-constructs.html#bufferblock" class="sidebar-link">BufferBlock</a></li><li class="sidebar-sub-header"><a href="/csharp/task-parallel-library-tpl-dataflow-constructs.html#joinblock-t1-t2" class="sidebar-link">JoinBlock</a></li><li class="sidebar-sub-header"><a href="/csharp/task-parallel-library-tpl-dataflow-constructs.html#writeonceblock" class="sidebar-link">WriteOnceBlock</a></li><li class="sidebar-sub-header"><a href="/csharp/task-parallel-library-tpl-dataflow-constructs.html#batchedjoinblock-t1-t2" class="sidebar-link">BatchedJoinBlock</a></li><li class="sidebar-sub-header"><a href="/csharp/task-parallel-library-tpl-dataflow-constructs.html#transformblock-tinput-toutput" class="sidebar-link">TransformBlock</a></li><li class="sidebar-sub-header"><a href="/csharp/task-parallel-library-tpl-dataflow-constructs.html#transformmanyblock-tinput-toutput" class="sidebar-link">TransformManyBlock</a></li><li class="sidebar-sub-header"><a href="/csharp/task-parallel-library-tpl-dataflow-constructs.html#batchblock" class="sidebar-link">BatchBlock</a></li></ul></li><li><a href="/csharp/functional-programming.html" class="sidebar-link">Functional Programming</a></li><li><a href="/csharp/func-delegates.html" class="sidebar-link">Func delegates</a></li><li><a href="/csharp/function-with-multiple-return-values.html" class="sidebar-link">Function with multiple return values</a></li><li><a href="/csharp/binary-serialization.html" class="sidebar-link">Binary Serialization</a></li><li><a href="/csharp/icloneable.html" class="sidebar-link">ICloneable</a></li><li><a href="/csharp/icomparable.html" class="sidebar-link">IComparable</a></li><li><a href="/csharp/accessing-databases.html" class="sidebar-link">Accessing Databases</a></li><li><a href="/csharp/using-sqlite-in-c.html" class="sidebar-link">Using SQLite in C#</a></li><li><a href="/csharp/caching.html" class="sidebar-link">Caching</a></li><li><a href="/csharp/code-contracts.html" class="sidebar-link">Code Contracts</a></li><li><a href="/csharp/code-contracts-and-assertions.html" class="sidebar-link">Code Contracts and Assertions</a></li><li><a href="/csharp/structural-design-patterns.html" class="sidebar-link">Structural Design Patterns</a></li><li><a href="/csharp/creational-design-patterns.html" class="sidebar-link">Creational Design Patterns</a></li><li><a href="/csharp/implementing-decorator-design-pattern.html" class="sidebar-link">Implementing Decorator Design Pattern</a></li><li><a href="/csharp/implementing-flyweight-design-pattern.html" class="sidebar-link">Implementing Flyweight Design Pattern</a></li><li><a href="/csharp/system-management-automation.html" class="sidebar-link">System.Management.Automation</a></li><li><a href="/csharp/system-directoryservices-protocols-ldapconnection.html" class="sidebar-link">System.DirectoryServices.Protocols.LdapConnection</a></li><li><a href="/csharp/c-authentication-handler.html" class="sidebar-link">C# Authentication handler</a></li><li><a href="/csharp/pointers.html" class="sidebar-link">Pointers</a></li><li><a href="/csharp/pointers-unsafe-code.html" class="sidebar-link">Pointers &amp; Unsafe Code</a></li><li><a href="/csharp/how-to-use-c-structs-to-create-a-union-type-similar-to-c-unions.html" class="sidebar-link">How to use C# Structs to create a Union type  (Similar to C Unions)</a></li><li><a href="/csharp/reactive-extensions-rx.html" class="sidebar-link">Reactive Extensions (Rx)</a></li><li><a href="/csharp/assemblyinfo-cs-examples.html" class="sidebar-link">AssemblyInfo.cs Examples</a></li><li><a href="/csharp/creating-a-console-application-using-a-plain-text-editor-and-the-c-compiler-csc-exe.html" class="sidebar-link">Creating a Console Application using a Plain-Text Editor and the C# Compiler (csc.exe)</a></li><li><a href="/csharp/clscompliantattribute.html" class="sidebar-link">CLSCompliantAttribute</a></li><li><a href="/csharp/observablecollection-t.html" class="sidebar-link">ObservableCollection</a></li><li><a href="/csharp/hash-functions.html" class="sidebar-link">Hash Functions</a></li><li><a href="/csharp/generating-random-numbers-in-c.html" class="sidebar-link">Generating Random Numbers in C#</a></li><li><a href="/csharp/cryptography-system-security-cryptography.html" class="sidebar-link">Cryptography (System.Security.Cryptography)</a></li><li><a href="/csharp/asp-net-identity.html" class="sidebar-link">ASP.NET Identity</a></li><li><a href="/csharp/unsafe-code-in-net.html" class="sidebar-link">Unsafe Code in .NET</a></li><li><a href="/csharp/c-script.html" class="sidebar-link">C# Script</a></li><li><a href="/csharp/runtime-compile.html" class="sidebar-link">Runtime Compile</a></li><li><a href="/csharp/interoperability.html" class="sidebar-link">Interoperability</a></li><li><a href="/csharp/net-compiler-platform-roslyn.html" class="sidebar-link">.NET Compiler Platform (Roslyn)</a></li><li><a href="/csharp/ilgenerator.html" class="sidebar-link">ILGenerator</a></li><li><a href="/csharp/t4-code-generation.html" class="sidebar-link">T4 Code Generation</a></li><li><a href="/csharp/creating-own-messagebox-in-windows-form-application.html" class="sidebar-link">Creating Own MessageBox in Windows Form Application</a></li><li><a href="/csharp/including-font-resources.html" class="sidebar-link">Including Font Resources</a></li><li><a href="/csharp/import-google-contacts.html" class="sidebar-link">Import Google Contacts</a></li><li><a href="/csharp/garbage-collector-in-net.html" class="sidebar-link">Garbage Collector in .Net</a></li><li><a href="/csharp/microsoft-exchange-webservices.html" class="sidebar-link">Microsoft.Exchange.WebServices</a></li><li><a href="/csharp/windows-communication-foundation.html" class="sidebar-link">Windows Communication Foundation</a></li><li><a href="/csharp/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="task-parallel-library-tpl-dataflow-constructs"><a href="#task-parallel-library-tpl-dataflow-constructs" class="header-anchor">#</a> Task Parallel Library (TPL) Dataflow Constructs</h1> <h2 id="actionblock"><a href="#actionblock" class="header-anchor">#</a> ActionBlock<T></T></h2> <p>(foreach)</p> <p>This class can be thought of logically as a buffer for data to be processed combined with tasks for processing that data, with the “dataflow block” managing both. In its most basic usage, we can instantiate an ActionBlock and “post” data to it; the delegate provided at the ActionBlock’s construction will be executed asynchronously for every piece of data posted.</p> <p><a href="http://i.stack.imgur.com/exRaP.png" target="_blank" rel="noopener noreferrer"><img src="http://i.stack.imgur.com/exRaP.png" alt="enter image description here"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>Synchronous Computation</strong></p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">var</span></span> ab <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ActionBlock<span class="token punctuation">&lt;</span>TInput<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>i <span class="token operator">=&gt;</span> 
<span class="token punctuation">{</span>
    <span class="token function">Compute</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
…
ab<span class="token punctuation">.</span><span class="token function">Post</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ab<span class="token punctuation">.</span><span class="token function">Post</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ab<span class="token punctuation">.</span><span class="token function">Post</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p><strong>Throttling Asynchronous Downloads to at most 5 concurrently</strong></p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">var</span></span> downloader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ActionBlock<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">async</span> url <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">byte</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span> imageData <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">DownloadAsync</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">Process</span><span class="token punctuation">(</span>imageData<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataflowBlockOptions</span> <span class="token punctuation">{</span> MaxDegreeOfParallelism <span class="token operator">=</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

downloader<span class="token punctuation">.</span><span class="token function">Post</span><span class="token punctuation">(</span><span class="token string">&quot;http://website.com/path/to/images&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
downloader<span class="token punctuation">.</span><span class="token function">Post</span><span class="token punctuation">(</span><span class="token string">&quot;http://another-website.com/path/to/images&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p><a href="https://www.microsoft.com/en-us/download/details.aspx?id=14782" target="_blank" rel="noopener noreferrer">Introduction to TPL Dataflow by Stephen Toub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="broadcastblock"><a href="#broadcastblock" class="header-anchor">#</a> BroadcastBlock<T></T></h2> <p>(Copy an item and send the copies to every block that it’s linked to)</p> <p>Unlike BufferBlock, BroadcastBlock’s mission in life is to enable all targets linked from the block to get a copy of every element published, continually overwriting the “current” value with those propagated to it.</p> <p>Additionally, unlike BufferBlock, BroadcastBlock doesn’t hold on to data unnecessarily.  After a particular datum has been offered to all targets, that element will be overwritten by whatever piece of data is next in line (as with all dataflow blocks, messages are handled in FIFO order).  That element will be offered to all targets, and so on.</p> <p><a href="http://i.stack.imgur.com/ZStaY.png" target="_blank" rel="noopener noreferrer"><img src="http://i.stack.imgur.com/ZStaY.png" alt="enter image description here"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>Asynchronous Producer/Consumer with a Throttled Producer</strong></p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">var</span></span> ui <span class="token operator">=</span> TaskScheduler<span class="token punctuation">.</span><span class="token function">FromCurrentSynchronizationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> bb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">BroadcastBlock<span class="token punctuation">&lt;</span>ImageData<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>i <span class="token operator">=&gt;</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> saveToDiskBlock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ActionBlock<span class="token punctuation">&lt;</span>ImageData<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>item <span class="token operator">=&gt;</span>
    item<span class="token punctuation">.</span>Image<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>Path<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> showInUiBlock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ActionBlock<span class="token punctuation">&lt;</span>ImageData<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>item <span class="token operator">=&gt;</span>
    imagePanel<span class="token punctuation">.</span><span class="token function">AddImage</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>Image<span class="token punctuation">)</span><span class="token punctuation">,</span> 
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataflowBlockOptions</span> <span class="token punctuation">{</span> TaskScheduler <span class="token operator">=</span> TaskScheduler<span class="token punctuation">.</span><span class="token function">FromCurrentSynchronizationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

bb<span class="token punctuation">.</span><span class="token function">LinkTo</span><span class="token punctuation">(</span>saveToDiskBlock<span class="token punctuation">)</span><span class="token punctuation">;</span>
bb<span class="token punctuation">.</span><span class="token function">LinkTo</span><span class="token punctuation">(</span>showInUiBlock<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p><strong>Exposing Status from an Agent</strong></p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAgent</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">ISourceBlock<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> Status <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token function">MyAgent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Status <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">BroadcastBlock<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> 

    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Status<span class="token punctuation">.</span><span class="token function">Post</span><span class="token punctuation">(</span><span class="token string">&quot;Starting&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Status<span class="token punctuation">.</span><span class="token function">Post</span><span class="token punctuation">(</span><span class="token string">&quot;Doing cool stuff&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        …
        Status<span class="token punctuation">.</span><span class="token function">Post</span><span class="token punctuation">(</span><span class="token string">&quot;Done&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p><a href="https://www.microsoft.com/en-us/download/details.aspx?id=14782" target="_blank" rel="noopener noreferrer">Introduction to TPL Dataflow by Stephen Toub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="bufferblock"><a href="#bufferblock" class="header-anchor">#</a> BufferBlock<T></T></h2> <p>(FIFO Queue: The data that comes in is the data that goes out)</p> <p>In short, BufferBlock provides an unbounded or bounded buffer for storing instances of T.<br>
You can “post” instances of T to the block, which cause the data being posted to be stored in a first-in-first-out (FIFO) order by the block.<br>
You can “receive” from the block, which allows you to synchronously or asynchronously obtain instances of T previously stored or available in the future (again, FIFO).</p> <p><a href="http://i.stack.imgur.com/S5vXJ.png" target="_blank" rel="noopener noreferrer"><img src="http://i.stack.imgur.com/S5vXJ.png" alt="enter image description here"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>Asynchronous Producer/Consumer with a Throttled Producer</strong></p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token comment">// Hand-off through a bounded BufferBlock&lt;T&gt;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">BufferBlock<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span> _Buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">BufferBlock<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataflowBlockOptions</span> <span class="token punctuation">{</span> BoundedCapacity <span class="token operator">=</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Producer</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Producer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">await</span> _Buffer<span class="token punctuation">.</span><span class="token function">SendAsync</span><span class="token punctuation">(</span><span class="token function">Produce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Consumer</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Consumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">Process</span><span class="token punctuation">(</span><span class="token keyword">await</span> _Buffer<span class="token punctuation">.</span><span class="token function">ReceiveAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>

<span class="token comment">// Start the Producer and Consumer</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">WhenAll</span><span class="token punctuation">(</span><span class="token function">Producer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Consumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p><a href="https://www.microsoft.com/en-us/download/details.aspx?id=14782" target="_blank" rel="noopener noreferrer">Introduction to TPL Dataflow by Stephen Toub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="joinblock-t1-t2"><a href="#joinblock-t1-t2" class="header-anchor">#</a> JoinBlock&lt;T1, T2,…&gt;</h2> <p>(Collects 2-3 inputs and combines them into a Tuple)</p> <p>Like BatchBlock, JoinBlock&lt;T1, T2, …&gt; is able to group data from multiple data sources.  In fact, that’s JoinBlock&lt;T1, T2, …&gt;’s primary purpose.</p> <p>For example, a JoinBlock&lt;string, double, int&gt; is an ISourceBlock&lt;Tuple&lt;string, double, int&gt;&gt;.</p> <p>As with BatchBlock, JoinBlock&lt;T1, T2,…&gt; is capable of operating in both greedy and non-greedy mode.</p> <ul><li>In the default greedy mode, all data offered to targets are accepted, even if the other target doesn’t have the necessary data with which to form a tuple.</li> <li>In non-greedy mode, the block’s targets will postpone data until all targets have been offered the necessary data to create a tuple, at which point the block will engage in a two-phase commit protocol to atomically retrieve all necessary items from the sources.  This postponement makes it possible for another entity to consume the data in the meantime so as to allow the overall system to make forward progress.</li></ul> <p><a href="http://i.stack.imgur.com/mmXJ8.png" target="_blank" rel="noopener noreferrer"><img src="http://i.stack.imgur.com/mmXJ8.png" alt="enter image description here"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>Processing Requests with a Limited Number of Pooled Objects</strong></p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">var</span></span> throttle <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JoinBlock<span class="token punctuation">&lt;</span>ExpensiveObject<span class="token punctuation">,</span> Request<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    requestProcessor<span class="token punctuation">.</span>Target1<span class="token punctuation">.</span><span class="token function">Post</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">ExpensiveObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>

<span class="token class-name"><span class="token keyword">var</span></span> processor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Transform<span class="token punctuation">&lt;</span>Tuple<span class="token punctuation">&lt;</span>ExpensiveObject<span class="token punctuation">,</span> Request<span class="token punctuation">&gt;</span><span class="token punctuation">,</span> ExpensiveObject<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>pair <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> resource <span class="token operator">=</span> pair<span class="token punctuation">.</span>Item1<span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> request <span class="token operator">=</span> pair<span class="token punctuation">.</span>Item2<span class="token punctuation">;</span>
    
    request<span class="token punctuation">.</span><span class="token function">ProcessWith</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> resource<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

throttle<span class="token punctuation">.</span><span class="token function">LinkTo</span><span class="token punctuation">(</span>processor<span class="token punctuation">)</span><span class="token punctuation">;</span>
processor<span class="token punctuation">.</span><span class="token function">LinkTo</span><span class="token punctuation">(</span>throttle<span class="token punctuation">.</span>Target1<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p><a href="https://www.microsoft.com/en-us/download/details.aspx?id=14782" target="_blank" rel="noopener noreferrer">Introduction to TPL Dataflow by Stephen Toub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="writeonceblock"><a href="#writeonceblock" class="header-anchor">#</a> WriteOnceBlock<T></T></h2> <p>(Readonly variable: Memorizes its first data item and passes out copies of it as its output. Ignores all other data items)</p> <p>If BufferBlock is the most fundamental block in TPL Dataflow, WriteOnceBlock is the simplest.<br>
It stores at most one value, and once that value has been set, it will never be replaced or overwritten.</p> <p>You can think of WriteOnceBlock in as being similar to a readonly member variable in C#, except instead of only being settable in a constructor and then being immutable, it’s only settable once and is then immutable.</p> <p><a href="http://i.stack.imgur.com/7M5Mp.png" target="_blank" rel="noopener noreferrer"><img src="http://i.stack.imgur.com/7M5Mp.png" alt="enter image description here"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>Splitting a Task’s Potential Outputs</strong></p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SplitIntoBlocks</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name">Task<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> task<span class="token punctuation">,</span>
    <span class="token keyword">out</span> <span class="token class-name">IPropagatorBlock<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> result<span class="token punctuation">,</span> 
    <span class="token keyword">out</span> <span class="token class-name">IPropagatorBlock<span class="token punctuation">&lt;</span>Exception<span class="token punctuation">&gt;</span></span> exception<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WriteOnceBlock<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>i <span class="token operator">=&gt;</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    exception <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WriteOnceBlock<span class="token punctuation">&lt;</span>Exception<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>i <span class="token operator">=&gt;</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">try</span> 
    <span class="token punctuation">{</span> 
        result<span class="token punctuation">.</span><span class="token function">Post</span><span class="token punctuation">(</span><span class="token keyword">await</span> task<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> 
    <span class="token punctuation">{</span> 
        exception<span class="token punctuation">.</span><span class="token function">Post</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p><a href="https://www.microsoft.com/en-us/download/details.aspx?id=14782" target="_blank" rel="noopener noreferrer">Introduction to TPL Dataflow by Stephen Toub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="batchedjoinblock-t1-t2"><a href="#batchedjoinblock-t1-t2" class="header-anchor">#</a> BatchedJoinBlock&lt;T1, T2,…&gt;</h2> <p>(Collects a certain number of total items from 2-3 inputs and groups them into a Tuple of collections of data items)</p> <p>BatchedJoinBlock&lt;T1, T2,…&gt; is in a sense a combination of BatchBlock and JoinBlock&lt;T1, T2,…&gt;.<br>
Whereas JoinBlock&lt;T1, T2,…&gt; is used to aggregate one input from each target into a tuple, and BatchBlock is used to aggregate N inputs into a collection, BatchedJoinBlock&lt;T1, T2,…&gt; is used to gather N inputs from across all of the targets into tuples of collections.</p> <p><a href="http://i.stack.imgur.com/FSgue.png" target="_blank" rel="noopener noreferrer"><img src="http://i.stack.imgur.com/FSgue.png" alt="enter image description here"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>Scatter/Gather</strong></p> <p>Consider a scatter/gather problem where N operations are launched, some of which may succeed and produce string outputs, and others of which may fail and produce Exceptions.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">var</span></span> batchedJoin <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">BatchedJoinBlock<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> Exception<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Task<span class="token punctuation">.</span>Factory<span class="token punctuation">.</span><span class="token function">StartNew</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> batchedJoin<span class="token punctuation">.</span>Target1<span class="token punctuation">.</span><span class="token function">Post</span><span class="token punctuation">(</span><span class="token function">DoWork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span> batchJoin<span class="token punctuation">.</span>Target2<span class="token punctuation">.</span><span class="token function">Post</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name"><span class="token keyword">var</span></span> results <span class="token operator">=</span> <span class="token keyword">await</span> batchedJoin<span class="token punctuation">.</span><span class="token function">ReceiveAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> s <span class="token keyword">in</span> results<span class="token punctuation">.</span>Item1<span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e <span class="token keyword">in</span> results<span class="token punctuation">.</span>Item2<span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p><a href="https://www.microsoft.com/en-us/download/details.aspx?id=14782" target="_blank" rel="noopener noreferrer">Introduction to TPL Dataflow by Stephen Toub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="transformblock-tinput-toutput"><a href="#transformblock-tinput-toutput" class="header-anchor">#</a> TransformBlock&lt;TInput, TOutput&gt;</h2> <p>(Select, one-to-one)</p> <p>As with ActionBlock, TransformBlock&lt;TInput, TOutput&gt; enables the execution of a delegate to perform some action for each input datum; <strong>unlike with ActionBlock, this processing has an output.</strong>  This delegate can be a Func&lt;TInput, TOutput&gt;, in which case processing of that element is considered completed when the delegate returns, or it can be a Func&lt;TInput,Task&gt;, in which case processing of that element is considered completed not when the delegate returns but when the returned Task completes.
For those familiar with LINQ, it’s somewhat similar to Select() in that it takes an input, transforms that input in some manner, and then produces an output.</p> <p>By default, TransformBlock&lt;TInput, TOutput&gt; processes its data sequentially with a MaxDegreeOfParallelism equal to 1.
In addition to receiving buffered input and processing it, this block will take all of its processed output and buffer that as well (data that has not been processed, and data that has been processed).</p> <p>It has 2 tasks: One to process the data, and one to push data to the next block.</p> <p><a href="http://i.stack.imgur.com/jQcFo.png" target="_blank" rel="noopener noreferrer"><img src="http://i.stack.imgur.com/jQcFo.png" alt="enter image description here"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>A Concurrent Pipeline</strong></p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">var</span></span> compressor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TransformBlock<span class="token punctuation">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>input <span class="token operator">=&gt;</span> <span class="token function">Compress</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> encryptor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TransformBlock<span class="token punctuation">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>input <span class="token operator">=&gt;</span> <span class="token function">Encrypt</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

compressor<span class="token punctuation">.</span><span class="token function">LinkTo</span><span class="token punctuation">(</span>Encryptor<span class="token punctuation">)</span><span class="token punctuation">;</span> 

</code></pre></div><p><a href="https://www.microsoft.com/en-us/download/details.aspx?id=14782" target="_blank" rel="noopener noreferrer">Introduction to TPL Dataflow by Stephen Toub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="transformmanyblock-tinput-toutput"><a href="#transformmanyblock-tinput-toutput" class="header-anchor">#</a> TransformManyBlock&lt;TInput, TOutput&gt;</h2> <p>(SelectMany, 1-m: The results of this mapping are “flattened”, just like LINQ’s SelectMany)</p> <p>TransformManyBlock&lt;TInput, TOutput&gt; is very similar to TransformBlock&lt;TInput, TOutput&gt;.<br>
The key difference is that whereas a TransformBlock&lt;TInput, TOutput&gt; produces one and only one output for each input, TransformManyBlock&lt;TInput, TOutput&gt; produces any number (zero or more) outputs for each input.  As with ActionBlock and TransformBlock&lt;TInput, TOutput&gt;, this processing may be specified using delegates, both for synchronous and asynchronous processing.</p> <p>A Func&lt;TInput, IEnumerable&gt; is used for synchronous, and a Func&lt;TInput, Task<IEnumerable>&gt; is used for asynchronous. As with both ActionBlock and TransformBlock&lt;TInput, TOutput&gt;, TransformManyBlock&lt;TInput, TOutput&gt; defaults to sequential processing, but may be configured otherwise.</IEnumerable></p> <p>The mapping delegate retuns a collection of items, which are inserted individually into the output buffer.</p> <p><a href="http://i.stack.imgur.com/h7mip.png" target="_blank" rel="noopener noreferrer"><img src="http://i.stack.imgur.com/h7mip.png" alt="enter image description here"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>Asynchronous Web Crawler</strong></p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">var</span></span> downloader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TransformManyBlock<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">async</span> url <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>“Downloading “ <span class="token operator">+</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> 
    <span class="token punctuation">{</span> 
        <span class="token keyword">return</span> <span class="token function">ParseLinks</span><span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">DownloadContents</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span> 
    <span class="token keyword">catch</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    
    <span class="token keyword">return</span> Enumerable<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Empty</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
downloader<span class="token punctuation">.</span><span class="token function">LinkTo</span><span class="token punctuation">(</span>downloader<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p><strong>Expanding an Enumerable Into Its Constituent Elements</strong></p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">var</span></span> expanded <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TransformManyBlock<span class="token punctuation">&lt;</span>T<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> T<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>array <span class="token operator">=&gt;</span> array<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p><strong>Filtering by going from 1 to 0 or 1 elements</strong></p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">public</span> <span class="token return-type class-name">IPropagatorBlock<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token generic-method"><span class="token function">CreateFilteredBuffer</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">Predicate<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> filter<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TransformManyBlock<span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> T<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>item <span class="token operator">=&gt;</span>
        <span class="token function">filter</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token punctuation">?</span> <span class="token keyword">new</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> item <span class="token punctuation">}</span> <span class="token punctuation">:</span> Enumerable<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Empty</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p><a href="https://www.microsoft.com/en-us/download/details.aspx?id=14782" target="_blank" rel="noopener noreferrer">Introduction to TPL Dataflow by Stephen Toub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="batchblock"><a href="#batchblock" class="header-anchor">#</a> BatchBlock<T></T></h2> <p>(Groups a certain number of sequential data items into collections of data items)</p> <p>BatchBlock combines N single items into one batch item, represented as an array of elements. An instance is created with a specific batch size, and the block then creates a batch as soon as it’s received that number of elements, asynchronously outputting the batch to the output buffer.</p> <p>BatchBlock is capable of executing in both greedy and non-greedy modes.</p> <ul><li>In the default greedy mode, all messages offered to the block from any number of sources are accepted and buffered to be converted into batches.
</li><li><ul></ul></li> <li>In non-greedy mode, all messages are postponed from sources until enough sources have offered messages to the block to create a batch.  Thus, a BatchBlock can be used to receive 1 element from each of N sources, N elements from 1 source, and a myriad of options in between.</li></ul> <p><a href="http://i.stack.imgur.com/tLRyw.png" target="_blank" rel="noopener noreferrer"><img src="http://i.stack.imgur.com/tLRyw.png" alt="enter image description here"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>Batching Requests into groups of 100 to Submit to a Database</strong></p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">var</span></span> batchRequests <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">BatchBlock<span class="token punctuation">&lt;</span>Request<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token named-parameter punctuation">batchSize</span><span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> sendToDb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ActionBlock<span class="token punctuation">&lt;</span>Request<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>reqs <span class="token operator">=&gt;</span> <span class="token function">SubmitToDatabase</span><span class="token punctuation">(</span>reqs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

batchRequests<span class="token punctuation">.</span><span class="token function">LinkTo</span><span class="token punctuation">(</span>sendToDb<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p><strong>Creating a batch once a second</strong></p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">var</span></span> batch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">BatchBlock<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token named-parameter punctuation">batchSize</span><span class="token punctuation">:</span>Int32<span class="token punctuation">.</span>MaxValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token constructor-invocation class-name">Timer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> batch<span class="token punctuation">.</span><span class="token function">TriggerBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Change</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p><a href="https://www.microsoft.com/en-us/download/details.aspx?id=14782" target="_blank" rel="noopener noreferrer">Introduction to TPL Dataflow by Stephen Toub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/csharp/task-parallel-library-tpl-dataflow-constructs.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/csharp/yield-keyword.html" class="prev">
        Yield Keyword
      </a></span> <span class="next"><a href="/csharp/functional-programming.html">
        Functional Programming
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/906.ad17d575.js" defer></script>
  </body>
</html>
