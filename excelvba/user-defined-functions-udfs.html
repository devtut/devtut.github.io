<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Excel VBA - User Defined Functions (UDFs)</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Allow full column references without penalty, UDF - Hello World, Count Unique values in Range">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="Excel VBA - User Defined Functions (UDFs)">
    <meta property="og:description" content="Allow full column references without penalty, UDF - Hello World, Count Unique values in Range">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/excelvba/user-defined-functions-udfs.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="Excel VBA - User Defined Functions (UDFs)">
    <meta name="twitter:description" content="Allow full column references without penalty, UDF - Hello World, Count Unique values in Range">
    <meta name="twitter:url" content="/excelvba/user-defined-functions-udfs.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/1095.6bd4da56.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Excel VBA</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/excelvba/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/excelvba/getting-started-with-excel-vba.html" class="sidebar-link">Getting started with excel-vba</a></li><li><a href="/excelvba/arrays.html" class="sidebar-link">Arrays</a></li><li><a href="/excelvba/conditional-statements.html" class="sidebar-link">Conditional statements</a></li><li><a href="/excelvba/ranges-and-cells.html" class="sidebar-link">Ranges and Cells</a></li><li><a href="/excelvba/named-ranges.html" class="sidebar-link">Named Ranges</a></li><li><a href="/excelvba/merged-cells-ranges.html" class="sidebar-link">Merged Cells / Ranges</a></li><li><a href="/excelvba/locating-duplicate-values-in-a-range.html" class="sidebar-link">Locating duplicate values in a range</a></li><li><a href="/excelvba/user-defined-functions-udfs.html" aria-current="page" class="active sidebar-link">User Defined Functions (UDFs)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/excelvba/user-defined-functions-udfs.html#allow-full-column-references-without-penalty" class="sidebar-link">Allow full column references without penalty</a></li><li class="sidebar-sub-header"><a href="/excelvba/user-defined-functions-udfs.html#udf-hello-world" class="sidebar-link">UDF - Hello World</a></li><li class="sidebar-sub-header"><a href="/excelvba/user-defined-functions-udfs.html#count-unique-values-in-range" class="sidebar-link">Count Unique values in Range</a></li></ul></li><li><a href="/excelvba/conditional-formatting-using-vba.html" class="sidebar-link">Conditional formatting using VBA</a></li><li><a href="/excelvba/workbooks.html" class="sidebar-link">Workbooks</a></li><li><a href="/excelvba/working-with-excel-tables-in-vba.html" class="sidebar-link">Working with Excel Tables in VBA</a></li><li><a href="/excelvba/loop-through-all-sheets-in-active-workbook.html" class="sidebar-link">Loop through all Sheets in Active Workbook</a></li><li><a href="/excelvba/use-worksheet-object-and-not-sheet-object.html" class="sidebar-link">Use Worksheet object and not Sheet object</a></li><li><a href="/excelvba/methods-for-finding-the-last-used-row-or-column-in-a-worksheet.html" class="sidebar-link">Methods for Finding the Last Used Row or Column in a Worksheet</a></li><li><a href="/excelvba/creating-a-drop-down-menu-in-the-active-worksheet-with-a-combo-box.html" class="sidebar-link">Creating a drop-down menu in the Active Worksheet with a Combo Box</a></li><li><a href="/excelvba/file-system-object.html" class="sidebar-link">File System Object</a></li><li><a href="/excelvba/pivot-tables.html" class="sidebar-link">Pivot Tables</a></li><li><a href="/excelvba/binding.html" class="sidebar-link">Binding</a></li><li><a href="/excelvba/autofilter-uses-and-best-practices.html" class="sidebar-link">autofilter ; Uses and best practices</a></li><li><a href="/excelvba/application-object.html" class="sidebar-link">Application object</a></li><li><a href="/excelvba/charts-and-charting.html" class="sidebar-link">Charts and Charting</a></li><li><a href="/excelvba/customdocumentproperties-in-practice.html" class="sidebar-link">CustomDocumentProperties in practice</a></li><li><a href="/excelvba/powerpoint-integration-through-vba.html" class="sidebar-link">PowerPoint Integration Through VBA</a></li><li><a href="/excelvba/how-to-record-a-macro.html" class="sidebar-link">How to record a Macro</a></li><li><a href="/excelvba/sql-in-excel-vba-best-practices.html" class="sidebar-link">SQL in Excel VBA - Best Practices</a></li><li><a href="/excelvba/excel-vba-optimization.html" class="sidebar-link">Excel-VBA Optimization</a></li><li><a href="/excelvba/vba-security.html" class="sidebar-link">VBA Security</a></li><li><a href="/excelvba/debugging-and-troubleshooting.html" class="sidebar-link">Debugging and Troubleshooting</a></li><li><a href="/excelvba/vba-best-practices.html" class="sidebar-link">VBA Best Practices</a></li><li><a href="/excelvba/excel-vba-tips-and-tricks.html" class="sidebar-link">Excel VBA Tips and Tricks</a></li><li><a href="/excelvba/common-mistakes.html" class="sidebar-link">Common Mistakes</a></li><li><a href="/excelvba/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="user-defined-functions-udfs"><a href="#user-defined-functions-udfs" class="header-anchor">#</a> User Defined Functions (UDFs)</h1> <h2 id="allow-full-column-references-without-penalty"><a href="#allow-full-column-references-without-penalty" class="header-anchor">#</a> Allow full column references without penalty</h2> <p>It's easier to implement some UDFs on the worksheet if full column references can be passed in as parameters. However, due to the explicit nature of coding, any loop involving these ranges may be processing hundreds of thousands of cells that are completely empty. This reduces your VBA project (and workbook) to a frozen mess while unnecessary non-values are processed.</p> <p>Looping through a worksheet's cells is one of the slowest methods of accomplishing a task but sometimes it is unavoidable. Cutting the work performed down to what is actually required makes perfect sense.</p> <p>The solution is to truncate the full column or full row references to the <a href="https://msdn.microsoft.com/en-us/library/office/ff840732.aspx" target="_blank" rel="noopener noreferrer">Worksheet.UsedRange property<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> with the <a href="https://msdn.microsoft.com/en-us/library/office/aa195772.aspx" target="_blank" rel="noopener noreferrer">Intersect method<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. The following sample will loosely replicate a worksheet's native SUMIF function so the <strong>criteria_range</strong> will also be resized to suit the <strong>sum_range</strong> since each value in the <strong>sum_range</strong> must be accompanied by a value in the <strong>criteria_range</strong>.</p> <p>The <a href="https://msdn.microsoft.com/en-us/library/office/ff193687.aspx" target="_blank" rel="noopener noreferrer">Application.Caller<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for a UDF used on a worksheet is the cell in which it resides. The cell's <a href="https://msdn.microsoft.com/en-us/library/office/aa224980.aspx" target="_blank" rel="noopener noreferrer">.Parent<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> property is the worksheet. This will be used to define the .UsedRange.</p> <p>In a Module code sheet:</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Option</span> Explicit

<span class="token keyword">Function</span> udfMySumIf<span class="token punctuation">(</span>rngA <span class="token keyword">As</span> Range<span class="token punctuation">,</span> rngB <span class="token keyword">As</span> Range<span class="token punctuation">,</span> <span class="token operator">_</span>
                    <span class="token keyword">Optional</span> crit <span class="token keyword">As</span> <span class="token keyword">Variant</span> <span class="token operator">=</span> <span class="token string">&quot;yes&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">Dim</span> c <span class="token keyword">As</span> <span class="token keyword">Long</span><span class="token punctuation">,</span> ttl <span class="token keyword">As</span> <span class="token keyword">Double</span>
    
    <span class="token keyword">With</span> Application<span class="token punctuation">.</span>Caller<span class="token punctuation">.</span>Parent
        <span class="token keyword">Set</span> rngA <span class="token operator">=</span> Intersect<span class="token punctuation">(</span>rngA<span class="token punctuation">,</span> <span class="token punctuation">.</span>UsedRange<span class="token punctuation">)</span>
        <span class="token keyword">Set</span> rngB <span class="token operator">=</span> rngB<span class="token punctuation">.</span>Resize<span class="token punctuation">(</span>rngA<span class="token punctuation">.</span>Rows<span class="token punctuation">.</span>Count<span class="token punctuation">,</span> rngA<span class="token punctuation">.</span>Columns<span class="token punctuation">.</span>Count<span class="token punctuation">)</span>
    <span class="token keyword">End</span> <span class="token keyword">With</span>
    
    <span class="token keyword">For</span> c <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">To</span> rngA<span class="token punctuation">.</span>Cells<span class="token punctuation">.</span>Count
        <span class="token keyword">If</span> IsNumeric<span class="token punctuation">(</span>rngA<span class="token punctuation">.</span>Cells<span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">.</span>Value2<span class="token punctuation">)</span> <span class="token keyword">Then</span>
            <span class="token keyword">If</span> LCase<span class="token punctuation">(</span>rngB<span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">.</span>Value2<span class="token punctuation">)</span> <span class="token operator">=</span> LCase<span class="token punctuation">(</span>crit<span class="token punctuation">)</span> <span class="token keyword">Then</span>
                ttl <span class="token operator">=</span> ttl <span class="token operator">+</span> rngA<span class="token punctuation">.</span>Cells<span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">.</span>Value2
            <span class="token keyword">End</span> <span class="token keyword">If</span>
        <span class="token keyword">End</span> <span class="token keyword">If</span>
    <span class="token keyword">Next</span> c
    
    udfMySumIf <span class="token operator">=</span> ttl

<span class="token keyword">End</span> <span class="token keyword">Function</span>

</code></pre></div><blockquote></blockquote> <p><sup>Syntax:</sup><br> <code>=udfMySumIf(*sum_range*, *criteria_range*, [*criteria*])</code></p> <p><a href="http://i.stack.imgur.com/sgMr4.png" target="_blank" rel="noopener noreferrer"><img src="http://i.stack.imgur.com/sgMr4.png" alt="udf_sumifs"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>While this is a fairly simplistic example, it adequately demonstrates passing in two full column references (1,048,576 rows each) but only processing 15 rows of data and criteria.</p> <p><sub>Linked official MSDN documentation of individual methods and properties courtesy of Microsoft™.</sub></p> <h2 id="udf-hello-world"><a href="#udf-hello-world" class="header-anchor">#</a> UDF - Hello World</h2> <ol><li>Open Excel</li> <li>Open the Visual Basic Editor ( see  <a href="http://stackoverflow.com/documentation/excel-vba/777/introduction-to-excel-vba/2801/opening-the-visual-basic-editor#t=201607252035449856939" target="_blank" rel="noopener noreferrer">Opening the Visual Basic Editor<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> )</li> <li>Add a new module by clicking Insert --&gt; Module :</li></ol> <p><a href="http://i.stack.imgur.com/0KhKM.png" target="_blank" rel="noopener noreferrer"><img src="http://i.stack.imgur.com/0KhKM.png" alt="enter image description here"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ol><li>Copy and Paste the following code in the new module :</li></ol> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Public</span> <span class="token keyword">Function</span> Hello<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">String</span>
<span class="token comment">'Note: the output of the function is simply the function's name</span>
Hello <span class="token operator">=</span> <span class="token string">&quot;Hello, World !&quot;</span>
<span class="token keyword">End</span> <span class="token keyword">Function</span>

</code></pre></div><p>To obtain :</p> <p><a href="http://i.stack.imgur.com/1r1E7.png" target="_blank" rel="noopener noreferrer"><img src="http://i.stack.imgur.com/1r1E7.png" alt="enter image description here"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ol><li>Go back to your workbook and type &quot;=Hello()&quot; into a cell to see the &quot;Hello World&quot;.</li></ol> <p><a href="http://i.stack.imgur.com/PFQsX.png" target="_blank" rel="noopener noreferrer"><img src="http://i.stack.imgur.com/PFQsX.png" alt="enter image description here"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="count-unique-values-in-range"><a href="#count-unique-values-in-range" class="header-anchor">#</a> Count Unique values in Range</h2> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Function</span> countUnique<span class="token punctuation">(</span>r <span class="token keyword">As</span> range<span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Long</span>
    <span class="token comment">'Application.Volatile False ' optional</span>
    <span class="token keyword">Set</span> r <span class="token operator">=</span> Intersect<span class="token punctuation">(</span>r<span class="token punctuation">,</span> r<span class="token punctuation">.</span>Worksheet<span class="token punctuation">.</span>UsedRange<span class="token punctuation">)</span> <span class="token comment">' optional if you pass entire rows or columns to the function</span>
    <span class="token keyword">Dim</span> c <span class="token keyword">As</span> <span class="token keyword">New</span> Collection<span class="token punctuation">,</span> v
    <span class="token keyword">On</span> <span class="token keyword">Error</span> <span class="token keyword">Resume</span> <span class="token keyword">Next</span>   <span class="token comment">' to ignore the Run-time error 457: &quot;This key is already associated with an element of this collection&quot;.</span>
    <span class="token keyword">For</span> <span class="token keyword">Each</span> v <span class="token keyword">In</span> r<span class="token punctuation">.</span>Value  <span class="token comment">' remove .Value for ranges with more than one Areas</span>
        c<span class="token punctuation">.</span>Add <span class="token number">0</span><span class="token punctuation">,</span> v <span class="token operator">&amp;</span> <span class="token string">&quot;&quot;</span>
    <span class="token keyword">Next</span>
    c<span class="token punctuation">.</span>Remove <span class="token string">&quot;&quot;</span> <span class="token comment">' optional to exclude blank values from the count</span>
    countUnique <span class="token operator">=</span> c<span class="token punctuation">.</span>Count
<span class="token keyword">End</span> <span class="token keyword">Function</span>

</code></pre></div><p><a href="http://stackoverflow.com/documentation/vba/5838/collections" target="_blank" rel="noopener noreferrer">Collections<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="syntax"><a href="#syntax" class="header-anchor">#</a> Syntax</h4> <li><p>**Function functionName(argumentVariable As dataType, argumentVariable2 As dataType, Optional argumentVariable3 As dataType) As functionReturnDataType**<br>
Basic declaration of a function. Every function needs a name, but it does not have to take any arguments. It may take 0 arguments, or it may take a given number of arguments. You may also declare an argument as optional (meaning it does not matter if you supply it when calling the function). It is best practice to supply the variable type for each argument, and likewise, to return what data type the function itself is going to return.</p></li> <li><p>**functionName = theVariableOrValueBeingReturned**<br>
If you're coming from other programming languages, you may be used to the `Return` keyword. This is not used in VBA - instead, we use the function name. You can set it to the contents of a variable or to some directly supplied value. Note that if you did set a data type for the function's return, the variable or data you are supplying this time must be of that data type.</p></li> <li><p>**End Function**<br>
Mandatory. Signifies the end of the `Function` codeblock and must thusly be at the end. The VBE usually supplies this automatically when you create a new function.</p></li> <h4 id="remarks"><a href="#remarks" class="header-anchor">#</a> Remarks</h4> <p>A User Defined Function (aka UDF) refers to a task specific function that has been created by the user. It can be called as a worksheet function (ex: <code>=SUM(...)</code>) or used to return a value to a running process in a Sub procedure. A UDF returns a value, typically from information passed into it as one or more parameters.</p> <p>It can be created by :</p> <ol><li>using VBA .</li> <li>using Excel C API - By creating an XLL that exports compiled functions to Excel.</li> <li>using the COM interface.</li></ol></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/excelvba/user-defined-functions-udfs.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/excelvba/locating-duplicate-values-in-a-range.html" class="prev">
        Locating duplicate values in a range
      </a></span> <span class="next"><a href="/excelvba/conditional-formatting-using-vba.html">
        Conditional formatting using VBA
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/1095.6bd4da56.js" defer></script>
  </body>
</html>
