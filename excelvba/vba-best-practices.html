<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Excel VBA - VBA Best Practices</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="ALWAYS Use Option Explicit, Work with Arrays, Not With Ranges, Switch off properties during macro execution, Use VB constants when available, Avoid using SELECT or ACTIVATE, Always define and set references to all Workbooks and Sheets, Use descriptive variable naming, Document Your Work, Error Handling, Never Assume The Worksheet, Avoid using ActiveCell or ActiveSheet in Excel, WorksheetFunction object executes faster than a UDF equivalent, Avoid re-purposing the names of Properties or Methods as your variables">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="Excel VBA - VBA Best Practices">
    <meta property="og:description" content="ALWAYS Use Option Explicit, Work with Arrays, Not With Ranges, Switch off properties during macro execution, Use VB constants when available, Avoid using SELECT or ACTIVATE, Always define and set references to all Workbooks and Sheets, Use descriptive variable naming, Document Your Work, Error Handling, Never Assume The Worksheet, Avoid using ActiveCell or ActiveSheet in Excel, WorksheetFunction object executes faster than a UDF equivalent, Avoid re-purposing the names of Properties or Methods as your variables">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/excelvba/vba-best-practices.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="Excel VBA - VBA Best Practices">
    <meta name="twitter:description" content="ALWAYS Use Option Explicit, Work with Arrays, Not With Ranges, Switch off properties during macro execution, Use VB constants when available, Avoid using SELECT or ACTIVATE, Always define and set references to all Workbooks and Sheets, Use descriptive variable naming, Document Your Work, Error Handling, Never Assume The Worksheet, Avoid using ActiveCell or ActiveSheet in Excel, WorksheetFunction object executes faster than a UDF equivalent, Avoid re-purposing the names of Properties or Methods as your variables">
    <meta name="twitter:url" content="/excelvba/vba-best-practices.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/1096.009c6cef.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Excel VBA</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/excelvba/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/excelvba/getting-started-with-excel-vba.html" class="sidebar-link">Getting started with excel-vba</a></li><li><a href="/excelvba/arrays.html" class="sidebar-link">Arrays</a></li><li><a href="/excelvba/conditional-statements.html" class="sidebar-link">Conditional statements</a></li><li><a href="/excelvba/ranges-and-cells.html" class="sidebar-link">Ranges and Cells</a></li><li><a href="/excelvba/named-ranges.html" class="sidebar-link">Named Ranges</a></li><li><a href="/excelvba/merged-cells-ranges.html" class="sidebar-link">Merged Cells / Ranges</a></li><li><a href="/excelvba/locating-duplicate-values-in-a-range.html" class="sidebar-link">Locating duplicate values in a range</a></li><li><a href="/excelvba/user-defined-functions-udfs.html" class="sidebar-link">User Defined Functions (UDFs)</a></li><li><a href="/excelvba/conditional-formatting-using-vba.html" class="sidebar-link">Conditional formatting using VBA</a></li><li><a href="/excelvba/workbooks.html" class="sidebar-link">Workbooks</a></li><li><a href="/excelvba/working-with-excel-tables-in-vba.html" class="sidebar-link">Working with Excel Tables in VBA</a></li><li><a href="/excelvba/loop-through-all-sheets-in-active-workbook.html" class="sidebar-link">Loop through all Sheets in Active Workbook</a></li><li><a href="/excelvba/use-worksheet-object-and-not-sheet-object.html" class="sidebar-link">Use Worksheet object and not Sheet object</a></li><li><a href="/excelvba/methods-for-finding-the-last-used-row-or-column-in-a-worksheet.html" class="sidebar-link">Methods for Finding the Last Used Row or Column in a Worksheet</a></li><li><a href="/excelvba/creating-a-drop-down-menu-in-the-active-worksheet-with-a-combo-box.html" class="sidebar-link">Creating a drop-down menu in the Active Worksheet with a Combo Box</a></li><li><a href="/excelvba/file-system-object.html" class="sidebar-link">File System Object</a></li><li><a href="/excelvba/pivot-tables.html" class="sidebar-link">Pivot Tables</a></li><li><a href="/excelvba/binding.html" class="sidebar-link">Binding</a></li><li><a href="/excelvba/autofilter-uses-and-best-practices.html" class="sidebar-link">autofilter ; Uses and best practices</a></li><li><a href="/excelvba/application-object.html" class="sidebar-link">Application object</a></li><li><a href="/excelvba/charts-and-charting.html" class="sidebar-link">Charts and Charting</a></li><li><a href="/excelvba/customdocumentproperties-in-practice.html" class="sidebar-link">CustomDocumentProperties in practice</a></li><li><a href="/excelvba/powerpoint-integration-through-vba.html" class="sidebar-link">PowerPoint Integration Through VBA</a></li><li><a href="/excelvba/how-to-record-a-macro.html" class="sidebar-link">How to record a Macro</a></li><li><a href="/excelvba/sql-in-excel-vba-best-practices.html" class="sidebar-link">SQL in Excel VBA - Best Practices</a></li><li><a href="/excelvba/excel-vba-optimization.html" class="sidebar-link">Excel-VBA Optimization</a></li><li><a href="/excelvba/vba-security.html" class="sidebar-link">VBA Security</a></li><li><a href="/excelvba/debugging-and-troubleshooting.html" class="sidebar-link">Debugging and Troubleshooting</a></li><li><a href="/excelvba/vba-best-practices.html" aria-current="page" class="active sidebar-link">VBA Best Practices</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/excelvba/vba-best-practices.html#always-use-option-explicit" class="sidebar-link">ALWAYS Use &quot;Option Explicit&quot;</a></li><li class="sidebar-sub-header"><a href="/excelvba/vba-best-practices.html#work-with-arrays-not-with-ranges" class="sidebar-link">Work with Arrays, Not With Ranges</a></li><li class="sidebar-sub-header"><a href="/excelvba/vba-best-practices.html#switch-off-properties-during-macro-execution" class="sidebar-link">Switch off properties during macro execution</a></li><li class="sidebar-sub-header"><a href="/excelvba/vba-best-practices.html#use-vb-constants-when-available" class="sidebar-link">Use VB constants when available</a></li><li class="sidebar-sub-header"><a href="/excelvba/vba-best-practices.html#avoid-using-select-or-activate" class="sidebar-link">Avoid using SELECT or ACTIVATE</a></li><li class="sidebar-sub-header"><a href="/excelvba/vba-best-practices.html#always-define-and-set-references-to-all-workbooks-and-sheets" class="sidebar-link">Always define and set references to all Workbooks and Sheets</a></li><li class="sidebar-sub-header"><a href="/excelvba/vba-best-practices.html#use-descriptive-variable-naming" class="sidebar-link">Use descriptive variable naming</a></li><li class="sidebar-sub-header"><a href="/excelvba/vba-best-practices.html#document-your-work" class="sidebar-link">Document Your Work</a></li><li class="sidebar-sub-header"><a href="/excelvba/vba-best-practices.html#error-handling" class="sidebar-link">Error Handling</a></li><li class="sidebar-sub-header"><a href="/excelvba/vba-best-practices.html#never-assume-the-worksheet" class="sidebar-link">Never Assume The Worksheet</a></li><li class="sidebar-sub-header"><a href="/excelvba/vba-best-practices.html#avoid-using-activecell-or-activesheet-in-excel" class="sidebar-link">Avoid using ActiveCell or ActiveSheet in Excel</a></li><li class="sidebar-sub-header"><a href="/excelvba/vba-best-practices.html#worksheetfunction-object-executes-faster-than-a-udf-equivalent" class="sidebar-link">WorksheetFunction object executes faster than a UDF equivalent</a></li><li class="sidebar-sub-header"><a href="/excelvba/vba-best-practices.html#avoid-re-purposing-the-names-of-properties-or-methods-as-your-variables" class="sidebar-link">Avoid re-purposing the names of Properties or Methods as your variables</a></li></ul></li><li><a href="/excelvba/excel-vba-tips-and-tricks.html" class="sidebar-link">Excel VBA Tips and Tricks</a></li><li><a href="/excelvba/common-mistakes.html" class="sidebar-link">Common Mistakes</a></li><li><a href="/excelvba/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vba-best-practices"><a href="#vba-best-practices" class="header-anchor">#</a> VBA Best Practices</h1> <h2 id="always-use-option-explicit"><a href="#always-use-option-explicit" class="header-anchor">#</a> ALWAYS Use &quot;Option Explicit&quot;</h2> <p>In the VBA Editor window, from the Tools menu select &quot;Options&quot;:</p> <p><a href="https://i.stack.imgur.com/DBq0L.png" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/DBq0L.png" alt="enter image description here"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Then in the &quot;Editor&quot; tab, make sure that &quot;Require Variable Declaration&quot; is checked:</p> <p><a href="https://i.stack.imgur.com/B3Gam.png" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/B3Gam.png" alt="enter image description here"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Selecting this option will automatically put <code>Option Explicit</code> at the top of every VBA module.</p> <blockquote></blockquote> <p><strong>Small note:</strong> This is true for the modules, class modules, etc. that haven't been opened so far. So if you already had a look at e.g. the code of <code>Sheet1</code> before activating the option &quot;Require Variable Declaration&quot;, <code>Option Explicit</code> will not be added!</p> <p><code>Option Explicit</code> requires that every variable has to be defined before use, e.g. with a <code>Dim</code> statement.  Without <code>Option Explicit</code> enabled, any unrecognized word will be assumed by the VBA compiler to be a new variable of the <code>Variant</code> type, causing extremely difficult-to-spot bugs related to typographical errors.  With <code>Option Explicit</code> enabled, any unrecognized words will cause a compile error to be thrown, indicating the offending line.</p> <p><strong>Example :</strong></p> <p>If you run the following code :</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Sub</span> Test<span class="token punctuation">(</span><span class="token punctuation">)</span>
  my_variable <span class="token operator">=</span> <span class="token number">12</span>
  MsgBox <span class="token string">&quot;My Variable is : &quot;</span> <span class="token operator">&amp;</span> myvariable
<span class="token keyword">End</span> <span class="token keyword">Sub</span>

</code></pre></div><p>You will get the following message :</p> <p><a href="https://i.stack.imgur.com/DDpmM.png" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/DDpmM.png" alt="enter image description here"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>You have made an error by writing <code>myvariable</code> instead of <code>my_variable</code>, then the message box displays an empty variable.
If you use <code>Option Explicit</code> , this error is not possible because you will get a compile error message indicating the problem.</p> <p><a href="https://i.stack.imgur.com/0K5UY.png" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/0K5UY.png" alt="enter image description here"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Now if you add the correct declaration :</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Sub</span> Test<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">Dim</span> my_variable <span class="token keyword">As</span> <span class="token keyword">Integer</span>
  my_variable <span class="token operator">=</span> <span class="token number">12</span>
  MsgBox <span class="token string">&quot;My Variable is : &quot;</span> <span class="token operator">&amp;</span> myvariable
<span class="token keyword">End</span> <span class="token keyword">Sub</span>

</code></pre></div><p>You will obtain an error message indicating precisely the error with <code>myvariable</code> :</p> <p><a href="https://i.stack.imgur.com/Z55Ln.png" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/Z55Ln.png" alt="enter image description here"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote></blockquote> <p>**Note on Option Explicit and Arrays** (<a href="https://msdn.microsoft.com/en-us/vba/language-reference-vba/articles/declaring-arrays#declaring-a-dynamic-array" rel="nofollow noreferrer">Declaring a Dynamic
Array</a>):</p> <p>You can use the ReDim statement to declare an array implicitly within
a procedure.</p> <ul><li>
Be careful not to misspell the name of the array when you use the ReDim statement
</li> <li>
Even if the Option Explicit statement is included in the module, a new array will be created
`Dim arr() as Long`
`ReDim ar() 'creates new array &quot;ar&quot; - &quot;ReDim ar()&quot; acts like &quot;Dim ar()&quot;`
</li></ul> <h2 id="work-with-arrays-not-with-ranges"><a href="#work-with-arrays-not-with-ranges" class="header-anchor">#</a> Work with Arrays, Not With Ranges</h2> <p><a href="https://blogs.office.com/2009/03/12/excel-vba-performance-coding-best-practices/" target="_blank" rel="noopener noreferrer">Office Blog - Excel VBA Performance Coding Best Practices<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Often, best performance is achieved by avoiding the use of <code>Range</code> as much as possible. In this example we read in an entire <code>Range</code> object into an array, square each number in the array, and then return the array back to the <code>Range</code>. This accesses <code>Range</code> only twice, whereas a loop would access it 20 times for the read/writes.</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Option</span> Explicit
<span class="token keyword">Sub</span> WorkWithArrayExample<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
<span class="token keyword">Dim</span> DataRange <span class="token keyword">As</span> <span class="token keyword">Variant</span>
<span class="token keyword">Dim</span> Irow <span class="token keyword">As</span> <span class="token keyword">Long</span>
<span class="token keyword">Dim</span> Icol <span class="token keyword">As</span> <span class="token keyword">Integer</span>
DataRange <span class="token operator">=</span> ActiveSheet<span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;A1:A10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value <span class="token comment">' read all the values at once from the Excel grid, put into an array</span>

<span class="token keyword">For</span> Irow <span class="token operator">=</span> LBound<span class="token punctuation">(</span>DataRange<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">To</span> UBound<span class="token punctuation">(</span>DataRange<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">' Get the number of rows.</span>
  <span class="token keyword">For</span> Icol <span class="token operator">=</span> LBound<span class="token punctuation">(</span>DataRange<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">To</span> UBound<span class="token punctuation">(</span>DataRange<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">' Get the number of columns.</span>
    DataRange<span class="token punctuation">(</span>Irow<span class="token punctuation">,</span> Icol<span class="token punctuation">)</span> <span class="token operator">=</span> DataRange<span class="token punctuation">(</span>Irow<span class="token punctuation">,</span> Icol<span class="token punctuation">)</span> <span class="token operator">*</span> DataRange<span class="token punctuation">(</span>Irow<span class="token punctuation">,</span> Icol<span class="token punctuation">)</span> <span class="token comment">' cell.value^2</span>
  <span class="token keyword">Next</span> Icol
<span class="token keyword">Next</span> Irow
ActiveSheet<span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;A1:A10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value <span class="token operator">=</span> DataRange <span class="token comment">' writes all the results back to the range at once</span>
    
<span class="token keyword">End</span> <span class="token keyword">Sub</span>

</code></pre></div><p>More tips and info with timed examples can be found in <a href="https://fastexcel.wordpress.com/2011/05/25/writing-efficient-vba-udfs-part-1/" target="_blank" rel="noopener noreferrer">Charles Williams's Writing efficient VBA UDFs (Part 1)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and <a href="https://fastexcel.wordpress.com/page/2/?s=writing+efficient" target="_blank" rel="noopener noreferrer">other articles in the series<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="switch-off-properties-during-macro-execution"><a href="#switch-off-properties-during-macro-execution" class="header-anchor">#</a> Switch off properties during macro execution</h2> <p>It is best practice in any programming language to <strong>avoid premature optimization.</strong> However, if testing reveals that your code is running too slowly, you may gain some speed by switching off some of the application’s properties while it runs. Add this code to a standard module:</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Public</span> <span class="token keyword">Sub</span> SpeedUp<span class="token punctuation">(</span> <span class="token operator">_</span>
    SpeedUpOn <span class="token keyword">As</span> <span class="token keyword">Boolean</span><span class="token punctuation">,</span> <span class="token operator">_</span>
    <span class="token keyword">Optional</span> xlCalc <span class="token keyword">as</span> XlCalculation <span class="token operator">=</span> xlCalculationAutomatic <span class="token operator">_</span>
<span class="token punctuation">)</span>
    <span class="token keyword">With</span> Application
        <span class="token keyword">If</span> SpeedUpOn <span class="token keyword">Then</span>
            <span class="token punctuation">.</span>ScreenUpdating <span class="token operator">=</span> <span class="token boolean">False</span>
            <span class="token punctuation">.</span>Calculation <span class="token operator">=</span> xlCalculationManual
            <span class="token punctuation">.</span>EnableEvents <span class="token operator">=</span> <span class="token boolean">False</span>
            <span class="token punctuation">.</span>DisplayStatusBar <span class="token operator">=</span> <span class="token boolean">False</span> <span class="token comment">'in case you are not showing any messages</span>
            ActiveSheet<span class="token punctuation">.</span>DisplayPageBreaks <span class="token operator">=</span> <span class="token boolean">False</span> <span class="token comment">'note this is a sheet-level setting</span>
        <span class="token keyword">Else</span>
            <span class="token punctuation">.</span>ScreenUpdating <span class="token operator">=</span> <span class="token boolean">True</span>
            <span class="token punctuation">.</span>Calculation <span class="token operator">=</span> xlCalc
            <span class="token punctuation">.</span>EnableEvents <span class="token operator">=</span> <span class="token boolean">True</span>
            <span class="token punctuation">.</span>DisplayStatusBar <span class="token operator">=</span> <span class="token boolean">True</span>
            ActiveSheet<span class="token punctuation">.</span>DisplayPageBreaks <span class="token operator">=</span> <span class="token boolean">True</span>
        <span class="token keyword">End</span> <span class="token keyword">If</span>
    <span class="token keyword">End</span> <span class="token keyword">With</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>

</code></pre></div><p><strong>More info on <a href="https://blogs.office.com/2009/03/12/excel-vba-performance-coding-best-practices/" target="_blank" rel="noopener noreferrer">Office Blog - Excel VBA Performance Coding Best Practices<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong></p> <p>And just call it at beginning and end of macros:</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Public</span> <span class="token keyword">Sub</span> SomeMacro
    <span class="token comment">'store the initial &quot;calculation&quot; state</span>
    <span class="token keyword">Dim</span> xlCalc <span class="token keyword">As</span> XlCalculation
    xlCalc <span class="token operator">=</span> Application<span class="token punctuation">.</span>Calculation

    SpeedUp <span class="token boolean">True</span>

    <span class="token comment">'code here ...</span>

    <span class="token comment">'by giving the second argument the initial &quot;calculation&quot; state is restored</span>
    <span class="token comment">'otherwise it is set to 'xlCalculationAutomatic'</span>
    SpeedUp <span class="token boolean">False</span><span class="token punctuation">,</span> xlCalc
<span class="token keyword">End</span> <span class="token keyword">Sub</span>

</code></pre></div><p>While these can largely be considered &quot;enhancements&quot; for regular <code>Public Sub</code> procedures, disabling event handling with <code>Application.EnableEvents = False</code> should be considered mandatory for <code>Worksheet_Change</code> and <code>Workbook_SheetChange</code> private event macros that change values on one or more worksheets. Failure to disable event triggers will cause the event macro to recursively run on top of itself when a value changes and can lead to a &quot;frozen&quot; workbook. Remember to turn events back on before leaving the event macro, possibly through a &quot;safe exit&quot; error handler.</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Option</span> Explicit

<span class="token keyword">Private</span> <span class="token keyword">Sub</span> Worksheet_Change<span class="token punctuation">(</span><span class="token keyword">ByVal</span> Target <span class="token keyword">As</span> Range<span class="token punctuation">)</span>
    <span class="token keyword">If</span> <span class="token keyword">Not</span> Intersect<span class="token punctuation">(</span>Target<span class="token punctuation">,</span> Range<span class="token punctuation">(</span><span class="token string">&quot;A:A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">Is</span> <span class="token boolean">Nothing</span> <span class="token keyword">Then</span>
        <span class="token keyword">On</span> <span class="token keyword">Error</span> <span class="token keyword">GoTo</span> bm_Safe_Exit
        Application<span class="token punctuation">.</span>EnableEvents <span class="token operator">=</span> <span class="token boolean">False</span>
        
        <span class="token comment">'code that may change a value on the worksheet goes here</span>
        
    <span class="token keyword">End</span> <span class="token keyword">If</span>
bm_Safe_Exit<span class="token punctuation">:</span>
    Application<span class="token punctuation">.</span>EnableEvents <span class="token operator">=</span> <span class="token boolean">True</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>

</code></pre></div><p><strong>One caveat:</strong> While disabling these settings will improve run time, they may make debugging your application much more difficult. If your code is <strong>not</strong> functioning correctly, comment out the <code>SpeedUp True</code> call until you figure out the problem.</p> <p>This is particularly important if you are writing to cells in a worksheet and then reading back in calculated results from worksheet functions since the <code>xlCalculationManual</code> prevents the workbook from calculating. To get around this without disabling <code>SpeedUp</code>, you may want to include <code>Application.Calculate</code> to run a calculation at specific points.</p> <p><strong>NOTE:</strong> Since these are properties of the <code>Application</code> itself, you need to ensure that they are enabled again before your macro exits.  This makes it particularly important to use error handlers and to avoid multiple exit points (i.e. <code>End</code> or <code>Unload Me</code>).</p> <p>With error handling:</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Public</span> <span class="token keyword">Sub</span> SomeMacro<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">'store the initial &quot;calculation&quot; state</span>
    <span class="token keyword">Dim</span> xlCalc <span class="token keyword">As</span> XlCalculation
    xlCalc <span class="token operator">=</span> Application<span class="token punctuation">.</span>Calculation

    <span class="token keyword">On</span> <span class="token keyword">Error</span> <span class="token keyword">GoTo</span> Handler
    SpeedUp <span class="token boolean">True</span>
    
    <span class="token comment">'code here ...</span>
    i <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">0</span>
CleanExit<span class="token punctuation">:</span>
    SpeedUp <span class="token boolean">False</span><span class="token punctuation">,</span> xlCalc
    <span class="token keyword">Exit</span> <span class="token keyword">Sub</span>
Handler<span class="token punctuation">:</span>
    <span class="token comment">'handle error</span>
    <span class="token keyword">Resume</span> CleanExit
<span class="token keyword">End</span> <span class="token keyword">Sub</span>

</code></pre></div><h2 id="use-vb-constants-when-available"><a href="#use-vb-constants-when-available" class="header-anchor">#</a> Use VB constants when available</h2> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">If</span> MsgBox<span class="token punctuation">(</span><span class="token string">&quot;Click OK&quot;</span><span class="token punctuation">)</span> <span class="token operator">=</span> vbOK <span class="token keyword">Then</span>

</code></pre></div><p>can be used in place of</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">If</span> MsgBox<span class="token punctuation">(</span><span class="token string">&quot;Click OK&quot;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">Then</span>

</code></pre></div><p>in order to improve readability.</p> <p>Use <strong>Object Browser</strong> to find available VB constants.  <strong>View → Object Browser</strong> or <kbd>F2</kbd> from VB Editor.</p> <p><a href="https://i.stack.imgur.com/VXZD4.png" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/VXZD4.png" alt="enter image description here"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Enter class to search</p> <p><a href="https://i.stack.imgur.com/tBix3.png" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/tBix3.png" alt="enter image description here"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>View members available</p> <p><a href="https://i.stack.imgur.com/QSQJw.png" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/QSQJw.png" alt="enter image description here"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="avoid-using-select-or-activate"><a href="#avoid-using-select-or-activate" class="header-anchor">#</a> Avoid using SELECT or ACTIVATE</h2> <p>It is <strong>very</strong> rare that you'll ever want to use <code>Select</code> or <code>Activate</code> in your code, but some Excel methods do require a worksheet or workbook to be activated before they'll work as expected.</p> <p>If you're just starting to learn VBA, you'll often be suggested to record your actions using the macro recorder, then go look at the code. For example, I recorded actions taken to enter a value in cell D3 on Sheet2, and the macro code looks like this:</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Option</span> Explicit
<span class="token keyword">Sub</span> Macro1<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">'</span>
<span class="token comment">' Macro1 Macro</span>
<span class="token comment">'</span>

<span class="token comment">'</span>
    Sheets<span class="token punctuation">(</span><span class="token string">&quot;Sheet2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">Select</span>
    Range<span class="token punctuation">(</span><span class="token string">&quot;D3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">Select</span>
    ActiveCell<span class="token punctuation">.</span>FormulaR1C1 <span class="token operator">=</span> <span class="token string">&quot;3.1415&quot;</span>   <span class="token comment">'(see **note below)</span>
    Range<span class="token punctuation">(</span><span class="token string">&quot;D4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">Select</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>

</code></pre></div><p>Remember though, the macro recorder creates a line of code for EACH of your (user) actions. This includes clicking on the worksheet tab to select Sheet2 (<code>Sheets(&quot;Sheet2&quot;).Select</code>), clicking on cell D3 before entering the value (<code>Range(&quot;D3&quot;).Select</code>), and using the Enter key (which is effectively &quot;selecting&quot; the cell below the currently selected cell: <code>Range(&quot;D4&quot;).Select</code>).</p> <p>There are multiple issues with using <code>.Select</code> here:</p> <ul><li><strong>The worksheet is not always specified.</strong> This happens if you don't switch worksheets while recording, and means that the code will yield different results for different active worksheets.</li> <li><strong><code>.Select()</code> is slow.</strong> Even if <code>Application.ScreenUpdating</code> is set to <code>False</code>, this is an unneccessary operation to be processed.</li> <li><strong><code>.Select()</code> is unruly.</strong> If <code>Application.ScreenUpdating</code> is left to <code>True</code>, Excel will actually select the cells, the worksheet, the form... whatever it is you're working with. This is stressful to the eyes and really unpleasant to watch.</li> <li><strong><code>.Select()</code> will trigger listeners.</strong> This is a bit advanced already, but unless worked around, functions like <code>Worksheet_SelectionChange()</code> will be triggered.</li></ul> <p>When you're coding in VBA, all of the &quot;typing&quot; actions (i.e. <code>Select</code> statements) are no longer necessary. Your code may be reduced to a single statement to put the value in the cell:</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token comment">'--- GOOD</span>
ActiveWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token string">&quot;Sheet2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;D3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value <span class="token operator">=</span> <span class="token number">3.1415</span>

<span class="token comment">'--- BETTER</span>
<span class="token keyword">Dim</span> myWB      <span class="token keyword">As</span> Workbook
<span class="token keyword">Dim</span> myWS      <span class="token keyword">As</span> Worksheet
<span class="token keyword">Dim</span> myCell    <span class="token keyword">As</span> Range

<span class="token keyword">Set</span> myWB <span class="token operator">=</span> ThisWorkbook             <span class="token comment">'*** see NOTE2</span>
<span class="token keyword">Set</span> myWS <span class="token operator">=</span> myWB<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token string">&quot;Sheet2&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">Set</span> myCell <span class="token operator">=</span> myWS<span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;D3&quot;</span><span class="token punctuation">)</span>

myCell<span class="token punctuation">.</span>Value <span class="token operator">=</span> <span class="token number">3.1415</span>

</code></pre></div><p>(The BETTER example above shows using intermediate variables to separate different parts of the cell reference. The GOOD example will always work just fine, but can be very cumbersome in much longer code modules and more difficult to debug if one of the references is mistyped.)</p> <p>**NOTE: the macro recorder makes many assumptions about the type of data you're entering, in this case entering a string value as a formula to create the value. Your code doesn't have to do this and can simply assign a numerical value directly to the cell as shown above.</p> <p>**NOTE2: the recommended practice is to set your local workbook variable to <code>ThisWorkbook</code> instead of <code>ActiveWorkbook</code> (unless you explicitly need it). The reason is your macro will generally need/use resources in whatever workbook the VBA code originates and will NOT look outside of that workbook -- again, unless you explicitly direct your code to work with another workbook. When you have multiple workbooks open in Excel, the <code>ActiveWorkbook</code> is the one with the focus <strong>which may be different from the workbook being viewed in your VBA Editor</strong>. So you think you're executing in a one workbook when you're really referencing another. <code>ThisWorkbook</code> refers to the workbook containing the code being executed.</p> <h2 id="always-define-and-set-references-to-all-workbooks-and-sheets"><a href="#always-define-and-set-references-to-all-workbooks-and-sheets" class="header-anchor">#</a> Always define and set references to all Workbooks and Sheets</h2> <p>When working with multiple open Workbooks, each of which may have multiple Sheets, it’s safest to define and set reference to all Workbooks and Sheets.</p> <p><strong>Don't rely</strong> on <code>ActiveWorkbook</code> or <code>ActiveSheet</code> as they might be changed by the user.</p> <p>The following code example demonstrates how to copy a range from “<strong>Raw_Data</strong>” sheet in the “<strong>Data.xlsx</strong>” workbook to “<strong>Refined_Data</strong>” sheet in the “<strong>Results.xlsx</strong>” workbook.</p> <p>The procedure also demonstrates how to copy and paste without using the <code>Select</code> method.</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Option</span> Explicit

<span class="token keyword">Sub</span> CopyRanges_BetweenShts<span class="token punctuation">(</span><span class="token punctuation">)</span>

    
    <span class="token keyword">Dim</span> wbSrc                           <span class="token keyword">As</span> Workbook
    <span class="token keyword">Dim</span> wbDest                          <span class="token keyword">As</span> Workbook
    <span class="token keyword">Dim</span> shtCopy                         <span class="token keyword">As</span> Worksheet
    <span class="token keyword">Dim</span> shtPaste                        <span class="token keyword">As</span> Worksheet
    
    <span class="token comment">' set reference to all workbooks by name, don't rely on ActiveWorkbook</span>
    <span class="token keyword">Set</span> wbSrc <span class="token operator">=</span> Workbooks<span class="token punctuation">(</span><span class="token string">&quot;Data.xlsx&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">Set</span> wbDest <span class="token operator">=</span> Workbooks<span class="token punctuation">(</span><span class="token string">&quot;Results.xlsx&quot;</span><span class="token punctuation">)</span>
    
    <span class="token comment">' set reference to all sheets by name, don't rely on ActiveSheet</span>
    <span class="token keyword">Set</span> shtCopy <span class="token operator">=</span> wbSrc<span class="token punctuation">.</span>Sheet1 <span class="token comment">'// &quot;Raw_Data&quot; sheet</span>
    <span class="token keyword">Set</span> shtPaste <span class="token operator">=</span> wbDest<span class="token punctuation">.</span>Sheet2 <span class="token comment">'// &quot;Refined_Data&quot;) sheet</span>
    
    <span class="token comment">' copy range from &quot;Data&quot; workbook to &quot;Results&quot; workbook without using Select</span>
    shtCopy<span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;A1:C10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Copy <span class="token operator">_</span>
    Destination<span class="token punctuation">:</span><span class="token operator">=</span>shtPaste<span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;A1&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">End</span> <span class="token keyword">Sub</span>

</code></pre></div><h2 id="use-descriptive-variable-naming"><a href="#use-descriptive-variable-naming" class="header-anchor">#</a> Use descriptive variable naming</h2> <p>Descriptive names and structure in your code help make comments unnecessary</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Dim</span> ductWidth  <span class="token keyword">As</span> <span class="token keyword">Double</span>
<span class="token keyword">Dim</span> ductHeight <span class="token keyword">As</span> <span class="token keyword">Double</span>
<span class="token keyword">Dim</span> ductArea   <span class="token keyword">As</span> <span class="token keyword">Double</span>

ductArea <span class="token operator">=</span> ductWidth <span class="token operator">*</span> ductHeight

</code></pre></div><p>is better than</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Dim</span> a<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h

a <span class="token operator">=</span> w <span class="token operator">*</span> h

</code></pre></div><p>This is especially helpful when you are copying data from one place to another, whether it's a cell, range, worksheet, or workbook. Help yourself by using names such as these:</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Dim</span> myWB <span class="token keyword">As</span> Workbook
<span class="token keyword">Dim</span> srcWS <span class="token keyword">As</span> Worksheet
<span class="token keyword">Dim</span> destWS <span class="token keyword">As</span> Worksheet
<span class="token keyword">Dim</span> srcData <span class="token keyword">As</span> Range
<span class="token keyword">Dim</span> destData <span class="token keyword">As</span> Range

<span class="token keyword">Set</span> myWB <span class="token operator">=</span> ActiveWorkbook
<span class="token keyword">Set</span> srcWS <span class="token operator">=</span> myWB<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token string">&quot;Sheet1&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">Set</span> destWS <span class="token operator">=</span> myWB<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token string">&quot;Sheet2&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">Set</span> srcData <span class="token operator">=</span> srcWS<span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;A1:A10&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">Set</span> destData <span class="token operator">=</span> destWS<span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;B11:B20&quot;</span><span class="token punctuation">)</span>
destData <span class="token operator">=</span> srcData

</code></pre></div><p>If you declare multiple variables in one line make sure to specify a type for <strong>every</strong> variable like:</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Dim</span> ductWidth <span class="token keyword">As</span> <span class="token keyword">Double</span><span class="token punctuation">,</span> ductHeight <span class="token keyword">As</span> <span class="token keyword">Double</span><span class="token punctuation">,</span> ductArea <span class="token keyword">As</span> <span class="token keyword">Double</span>

</code></pre></div><p>The following will only declare the last variable and the first ones will remain <code>Variant</code>:</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Dim</span> ductWidth<span class="token punctuation">,</span> ductHeight<span class="token punctuation">,</span> ductArea <span class="token keyword">As</span> <span class="token keyword">Double</span>

</code></pre></div><h2 id="document-your-work"><a href="#document-your-work" class="header-anchor">#</a> Document Your Work</h2> <p>It's good practice to document your work for later use, especially if you are coding for a dynamic workload. Good comments should explain why the code is doing something, not what the code is doing.</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Function</span> Bonus<span class="token punctuation">(</span>EmployeeTitle <span class="token keyword">as</span> <span class="token keyword">String</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">Double</span>
    <span class="token keyword">If</span> EmployeeTitle <span class="token operator">=</span> <span class="token string">&quot;Sales&quot;</span> <span class="token keyword">Then</span>
        Bonus <span class="token operator">=</span> <span class="token number">0</span>    <span class="token comment">'Sales representatives receive commission instead of a bonus</span>
    <span class="token keyword">Else</span>
        Bonus <span class="token operator">=</span> <span class="token number">.10</span>
    <span class="token keyword">End</span> <span class="token keyword">If</span>
<span class="token keyword">End</span> <span class="token keyword">Function</span>

</code></pre></div><p>If your code is so obscure that it requires comments to explain what it is doing, consider rewriting it to be more clear instead of explaining it through comments. For example, instead of:</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Sub</span> CopySalesNumbers
    <span class="token keyword">Dim</span> IncludeWeekends <span class="token keyword">as</span> <span class="token keyword">Boolean</span>
    
    <span class="token comment">'Boolean values can be evaluated as an integer, -1 for True, 0 for False.</span>
    <span class="token comment">'This is used here to adjust the range from 5 to 7 rows if including weekends.</span>
    Range<span class="token punctuation">(</span><span class="token string">&quot;A1:A&quot;</span> <span class="token operator">&amp;</span> <span class="token number">5</span> <span class="token operator">-</span> <span class="token punctuation">(</span>IncludeWeekends <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Copy
    Range<span class="token punctuation">(</span><span class="token string">&quot;B1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>PasteSpecial
<span class="token keyword">End</span> <span class="token keyword">Sub</span>

</code></pre></div><p>Clarify the code to be easier to follow, such as:</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Sub</span> CopySalesNumbers
    <span class="token keyword">Dim</span> IncludeWeekends <span class="token keyword">as</span> <span class="token keyword">Boolean</span>
    <span class="token keyword">Dim</span> DaysinWeek <span class="token keyword">as</span> <span class="token keyword">Integer</span>
    
    <span class="token keyword">If</span> IncludeWeekends <span class="token keyword">Then</span>
        DaysinWeek <span class="token operator">=</span> <span class="token number">7</span>
    <span class="token keyword">Else</span>
        DaysinWeek <span class="token operator">=</span> <span class="token number">5</span>
    <span class="token keyword">End</span> <span class="token keyword">If</span>
    Range<span class="token punctuation">(</span><span class="token string">&quot;A1:A&quot;</span> <span class="token operator">&amp;</span> DaysinWeek<span class="token punctuation">)</span><span class="token punctuation">.</span>Copy
    Range<span class="token punctuation">(</span><span class="token string">&quot;B1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>PasteSpecial
<span class="token keyword">End</span> <span class="token keyword">Sub</span> 

</code></pre></div><h2 id="error-handling"><a href="#error-handling" class="header-anchor">#</a> Error Handling</h2> <p>Good error handling prevents end users from seeing VBA runtime errors and helps the developer easily diagnose and correct errors.</p> <p>There are three main methods of Error Handling in VBA, two of which should be avoided for distributed programs unless specifically required in the code.</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">On</span> <span class="token keyword">Error</span> <span class="token keyword">GoTo</span> <span class="token number">0</span> <span class="token comment">'Avoid using</span>

</code></pre></div><p>or</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">On</span> <span class="token keyword">Error</span> <span class="token keyword">Resume</span> <span class="token keyword">Next</span> <span class="token comment">'Avoid using</span>

</code></pre></div><p>Prefer using:</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">On</span> <span class="token keyword">Error</span> <span class="token keyword">GoTo</span> <span class="token operator">&lt;</span>line<span class="token operator">&gt;</span> <span class="token comment">'Prefer using</span>

</code></pre></div><h3 id="on-error-goto-0"><a href="#on-error-goto-0" class="header-anchor">#</a> On Error GoTo 0</h3> <p>If no error handling is set in your code, <code>On Error GoTo 0</code> is the default error handler.  In this mode, any runtime errors will launch the typical VBA error message, allowing you to either end the code or enter <code>debug</code> mode, identifying the source.  While writing code, this method is the simplest and most useful, but it should always be avoided for code that is distributed to end users, as this method is very unsightly and difficult for end users to understand.</p> <h3 id="on-error-resume-next"><a href="#on-error-resume-next" class="header-anchor">#</a> On Error Resume Next</h3> <p><code>On Error Resume Next</code> will cause VBA to ignore any errors that are thrown at runtime for all lines following the error call until the error handler has been changed.  In very specific instances, this line can be useful, but it should be avoided outside of these cases.  For example, when launching a separate program from an Excel Macro, the <code>On Error Resume Next</code> call can be useful if you are unsure whether or not the program is already open:</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token comment">'In this example, we open an instance of Powerpoint using the On Error Resume Next call</span>
<span class="token keyword">Dim</span> PPApp <span class="token keyword">As</span> PowerPoint<span class="token punctuation">.</span>Application
<span class="token keyword">Dim</span> PPPres <span class="token keyword">As</span> PowerPoint<span class="token punctuation">.</span>Presentation
<span class="token keyword">Dim</span> PPSlide <span class="token keyword">As</span> PowerPoint<span class="token punctuation">.</span>Slide

<span class="token comment">'Open PPT if not running, otherwise select active instance</span>
<span class="token keyword">On</span> <span class="token keyword">Error</span> <span class="token keyword">Resume</span> <span class="token keyword">Next</span>
<span class="token keyword">Set</span> PPApp <span class="token operator">=</span> GetObject<span class="token punctuation">(</span><span class="token punctuation">,</span> <span class="token string">&quot;PowerPoint.Application&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">On</span> <span class="token keyword">Error</span> <span class="token keyword">GoTo</span> ErrHandler
<span class="token keyword">If</span> PPApp <span class="token keyword">Is</span> <span class="token boolean">Nothing</span> <span class="token keyword">Then</span>
    <span class="token comment">'Open PowerPoint</span>
    <span class="token keyword">Set</span> PPApp <span class="token operator">=</span> CreateObject<span class="token punctuation">(</span><span class="token string">&quot;PowerPoint.Application&quot;</span><span class="token punctuation">)</span>
    PPApp<span class="token punctuation">.</span>Visible <span class="token operator">=</span> <span class="token boolean">True</span>
<span class="token keyword">End</span> <span class="token keyword">If</span>

</code></pre></div><p>Had we not used the <code>On Error Resume Next</code> call and the Powerpoint application was not already open, the <code>GetObject</code> method would throw an error.  Thus, <code>On Error Resume Next</code> was necessary to avoid creating two instances of the application.</p> <p><strong>Note:</strong> It is also a best practice to <strong>immediately</strong> reset the error handler as soon as you no longer need the <code>On Error Resume Next</code> call</p> <h3 id="on-error-goto"><a href="#on-error-goto" class="header-anchor">#</a> On Error GoTo <line></line></h3> <p>This method of error handling is recommended for all code that is distributed to other users.  This allows the programmer to control exactly how VBA handles an error by sending the code to the specified line.  The  tag can be filled with any string (including numeric strings), and will send the code to the corresponding string that is followed by a colon.  Multiple error handling blocks can be used by making different calls of <code>On Error GoTo &lt;line&gt;</code>. The subroutine below demonstrates the syntax of an <code>On Error GoTo &lt;line&gt;</code> call.</p> <p><strong>Note:</strong> It is essential that the <code>Exit Sub</code> line is placed above the first error handler and before every subsequent error handler to prevent the code from naturally progressing into the block <strong>without</strong> an error being called.  Thus, it is best practice for function and readability to place error handlers at the end of a code block.</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Sub</span> YourMethodName<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">On</span> <span class="token keyword">Error</span> <span class="token keyword">GoTo</span> errorHandler
    <span class="token comment">' Insert code here</span>
    <span class="token keyword">On</span> <span class="token keyword">Error</span> <span class="token keyword">GoTo</span> secondErrorHandler

    <span class="token keyword">Exit</span> <span class="token keyword">Sub</span> <span class="token comment">'The exit sub line is essential, as the code will otherwise</span>
             <span class="token comment">'continue running into the error handling block, likely causing an error</span>

errorHandler<span class="token punctuation">:</span>
    MsgBox <span class="token string">&quot;Error &quot;</span> <span class="token operator">&amp;</span> Err<span class="token punctuation">.</span>Number <span class="token operator">&amp;</span> <span class="token string">&quot;: &quot;</span> <span class="token operator">&amp;</span> Err<span class="token punctuation">.</span>Description <span class="token operator">&amp;</span> <span class="token string">&quot; in &quot;</span> <span class="token operator">&amp;</span> <span class="token operator">_</span>
        VBE<span class="token punctuation">.</span>ActiveCodePane<span class="token punctuation">.</span>CodeModule<span class="token punctuation">,</span> vbOKOnly<span class="token punctuation">,</span> <span class="token string">&quot;Error&quot;</span>
    <span class="token keyword">Exit</span> <span class="token keyword">Sub</span>

secondErrorHandler<span class="token punctuation">:</span>
    <span class="token keyword">If</span> Err<span class="token punctuation">.</span>Number <span class="token operator">=</span> <span class="token number">424</span> <span class="token keyword">Then</span> <span class="token comment">'Object not found error (purely for illustration)</span>
        Application<span class="token punctuation">.</span>ScreenUpdating <span class="token operator">=</span> <span class="token boolean">True</span>
        Application<span class="token punctuation">.</span>EnableEvents <span class="token operator">=</span> <span class="token boolean">True</span>
        <span class="token keyword">Exit</span> <span class="token keyword">Sub</span>
    <span class="token keyword">Else</span>
        MsgBox <span class="token string">&quot;Error &quot;</span> <span class="token operator">&amp;</span> Err<span class="token punctuation">.</span>Number <span class="token operator">&amp;</span> <span class="token string">&quot;: &quot;</span> <span class="token operator">&amp;</span> Err<span class="token punctuation">.</span>Desctription
        Application<span class="token punctuation">.</span>ScreenUpdating <span class="token operator">=</span> <span class="token boolean">True</span>
        Application<span class="token punctuation">.</span>EnableEvents <span class="token operator">=</span> <span class="token boolean">True</span>   
        <span class="token keyword">Exit</span> <span class="token keyword">Sub</span>
    <span class="token keyword">End</span> <span class="token keyword">If</span>      
    <span class="token keyword">Exit</span> <span class="token keyword">Sub</span>

<span class="token keyword">End</span> <span class="token keyword">Sub</span>

</code></pre></div><p>If you exit your method with your error handling code, ensure that you clean up:</p> <ul><li>Undo anything that is partially completed</li> <li>Close files</li> <li>Reset screen updating</li> <li>Reset calculation mode</li> <li>Reset events</li> <li>Reset mouse pointer</li> <li>Call unload method on instances of objects, that persist after the <code>End Sub</code></li> <li>Reset status bar</li></ul> <h2 id="never-assume-the-worksheet"><a href="#never-assume-the-worksheet" class="header-anchor">#</a> Never Assume The Worksheet</h2> <p>Even when all your work is directed at a single worksheet, it's still a very good practice to explicitly specify the worksheet in your code. This habit makes it much easier to expand your code later, or to lift parts (or all) of a <code>Sub</code> or <code>Function</code> to be re-used someplace else. Many developers establish a habit of (re)using the same local variable name for a worksheet in their code, making re-use of that code even more straightforward.</p> <p>As an example, the following code is ambiguous -- but works! -- as long the developer doesn't activate or change to a different worksheet:</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Option</span> Explicit
<span class="token keyword">Sub</span> ShowTheTime<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">'--- displays the current time and date in cell A1 on the worksheet</span>
    Cells<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value <span class="token operator">=</span> Now<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">' don't refer to Cells without a sheet reference!</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>

</code></pre></div><p>If <code>Sheet1</code> is active, then cell A1 on Sheet1 will be filled with the current date and time. But if the user changes worksheets for any reason, then the code will update whatever the worksheet is currently active. The destination worksheet is ambiguous.</p> <p>The best practice is to always identify which worksheet to which your code refers:</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Option</span> Explicit
<span class="token keyword">Sub</span> ShowTheTime<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">'--- displays the current time and date in cell A1 on the worksheet</span>
    <span class="token keyword">Dim</span> myWB <span class="token keyword">As</span> Workbook
    <span class="token keyword">Set</span> myWB <span class="token operator">=</span> ThisWorkbook
    <span class="token keyword">Dim</span> timestampSH <span class="token keyword">As</span> Worksheet
    <span class="token keyword">Set</span> timestampSH <span class="token operator">=</span> myWB<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token string">&quot;Sheet1&quot;</span><span class="token punctuation">)</span>
    timestampSH<span class="token punctuation">.</span>Cells<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value <span class="token operator">=</span> Now<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>

</code></pre></div><p>The code above is clear in identifying both the workbook and the worksheet. While it may seem like overkill, creating a good habit concerning target references will save you from future problems.</p> <h2 id="avoid-using-activecell-or-activesheet-in-excel"><a href="#avoid-using-activecell-or-activesheet-in-excel" class="header-anchor">#</a> Avoid using ActiveCell or ActiveSheet in Excel</h2> <p>Using <code>ActiveCell</code> or <code>ActiveSheet</code> can be source of mistakes if (for any reason) the code is executed in the wrong place.</p> <div class="language-vb extra-class"><pre class="language-vb"><code>ActiveCell<span class="token punctuation">.</span>Value <span class="token operator">=</span> <span class="token string">&quot;Hello&quot;</span> 
<span class="token comment">'will place &quot;Hello&quot; in the cell that is currently selected</span>
Cells<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value <span class="token operator">=</span> <span class="token string">&quot;Hello&quot;</span> 
<span class="token comment">'will always place &quot;Hello&quot; in A1 of the currently selected sheet</span>

ActiveSheet<span class="token punctuation">.</span>Cells<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value <span class="token operator">=</span> <span class="token string">&quot;Hello&quot;</span> 
<span class="token comment">'will place &quot;Hello&quot; in A1 of the currently selected sheet</span>
Sheets<span class="token punctuation">(</span><span class="token string">&quot;MySheetName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Cells<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value <span class="token operator">=</span> <span class="token string">&quot;Hello&quot;</span> 
<span class="token comment">'will always place &quot;Hello&quot; in A1 of the sheet named &quot;MySheetName&quot;</span>

</code></pre></div><ul><li>The use of <code>Active*</code> can create problems in long running macros if your user gets bored and clicks on another worksheet or opens another workbook.</li> <li>It can create problems if your code opens or creates another workbook.</li> <li>It can create problems if your code uses <code>Sheets(&quot;MyOtherSheet&quot;).Select</code> and you've forgotten which sheet you were on before you start reading from or writing to it.</li></ul> <h2 id="worksheetfunction-object-executes-faster-than-a-udf-equivalent"><a href="#worksheetfunction-object-executes-faster-than-a-udf-equivalent" class="header-anchor">#</a> WorksheetFunction object executes faster than a UDF equivalent</h2> <p>VBA is compiled in run-time, which has a huge negative impact on it's performance, everything built-in will be faster, try to use them.</p> <p>As an example I'm comparing SUM and COUNTIF functions, but you can use if for anything you can solve with WorkSheetFunctions.</p> <p>A first attempt for those would be to loop through the range and process it cell by cell (using a range):</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Sub</span> UseRange<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">Dim</span> rng <span class="token keyword">as</span> Range
    <span class="token keyword">Dim</span> Total <span class="token keyword">As</span> <span class="token keyword">Double</span>
    <span class="token keyword">Dim</span> CountLessThan01 <span class="token keyword">As</span> <span class="token keyword">Long</span>
    
    Total <span class="token operator">=</span> <span class="token number">0</span>
    CountLessThan01 <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">For</span> <span class="token keyword">Each</span> rng <span class="token keyword">in</span> Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;A1:A100&quot;</span><span class="token punctuation">)</span>
        Total <span class="token operator">=</span> Total <span class="token operator">+</span> rng<span class="token punctuation">.</span>Value2
        <span class="token keyword">If</span> rng<span class="token punctuation">.</span>Value <span class="token operator">&lt;</span> <span class="token number">0.1</span> <span class="token keyword">Then</span>
            CountLessThan01 <span class="token operator">=</span> CountLessThan01 <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token keyword">End</span> <span class="token keyword">If</span>
    <span class="token keyword">Next</span> rng
    Debug<span class="token punctuation">.</span>Print Total <span class="token operator">&amp;</span> <span class="token string">&quot;, &quot;</span> <span class="token operator">&amp;</span> CountLessThan01
<span class="token keyword">End</span> <span class="token keyword">Sub</span>

</code></pre></div><p>One improvement can be to store the range values in an array and process that:</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Sub</span> UseArray<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">Dim</span> DataToSummarize <span class="token keyword">As</span> <span class="token keyword">Variant</span>
    <span class="token keyword">Dim</span> i <span class="token keyword">As</span> <span class="token keyword">Long</span>
    <span class="token keyword">Dim</span> Total <span class="token keyword">As</span> <span class="token keyword">Double</span>
    <span class="token keyword">Dim</span> CountLessThan01 <span class="token keyword">As</span> <span class="token keyword">Long</span>
    
    DataToSummarize <span class="token operator">=</span> Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;A1:A100&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value2 <span class="token comment">'faster than .Value</span>
    Total <span class="token operator">=</span> <span class="token number">0</span>
    CountLessThan01 <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">For</span> i <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">To</span> <span class="token number">100</span>
        Total <span class="token operator">=</span> Total <span class="token operator">+</span> DataToSummarize<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">If</span> DataToSummarize<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.1</span> <span class="token keyword">Then</span>
            CountLessThan01 <span class="token operator">=</span> CountLessThan01 <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token keyword">End</span> <span class="token keyword">If</span>
    <span class="token keyword">Next</span> i
    Debug<span class="token punctuation">.</span>Print Total <span class="token operator">&amp;</span> <span class="token string">&quot;, &quot;</span> <span class="token operator">&amp;</span> CountLessThan01
<span class="token keyword">End</span> <span class="token keyword">Sub</span>

</code></pre></div><p>But instead of writing any loop you can use <code>Application.Worksheetfunction</code> which is very handy for executing simple formulas:</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Sub</span> UseWorksheetFunction<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">Dim</span> Total <span class="token keyword">As</span> <span class="token keyword">Double</span>
    <span class="token keyword">Dim</span> CountLessThan01 <span class="token keyword">As</span> <span class="token keyword">Long</span>
    
    <span class="token keyword">With</span> Application<span class="token punctuation">.</span>WorksheetFunction
        Total <span class="token operator">=</span> <span class="token punctuation">.</span>Sum<span class="token punctuation">(</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;A1:A100&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        CountLessThan01 <span class="token operator">=</span> <span class="token punctuation">.</span>CountIf<span class="token punctuation">(</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;A1:A100&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;&lt;0.1&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">End</span> <span class="token keyword">With</span>
    
    Debug<span class="token punctuation">.</span>Print Total <span class="token operator">&amp;</span> <span class="token string">&quot;, &quot;</span> <span class="token operator">&amp;</span> CountLessThan01
<span class="token keyword">End</span> <span class="token keyword">Sub</span>

</code></pre></div><p>Or, for more complex calculations you can even use <code>Application.Evaluate</code>:</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Sub</span> UseEvaluate<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">Dim</span> Total <span class="token keyword">As</span> <span class="token keyword">Double</span>
    <span class="token keyword">Dim</span> CountLessThan01 <span class="token keyword">As</span> <span class="token keyword">Long</span>
    
    <span class="token keyword">With</span> Application
        Total <span class="token operator">=</span> <span class="token punctuation">.</span>Evaluate<span class="token punctuation">(</span><span class="token string">&quot;SUM(&quot;</span> <span class="token operator">&amp;</span> Sheet1<span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;A1:A100&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Address<span class="token punctuation">(</span> <span class="token operator">_</span>
            external<span class="token punctuation">:</span><span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token string">&quot;)&quot;</span><span class="token punctuation">)</span>
        CountLessThan01 <span class="token operator">=</span> <span class="token punctuation">.</span>Evaluate<span class="token punctuation">(</span><span class="token string">&quot;COUNTIF('Sheet1'!A1:A100,&quot;&quot;&lt;0.1&quot;&quot;)&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">End</span> <span class="token keyword">With</span>
    
    Debug<span class="token punctuation">.</span>Print Total <span class="token operator">&amp;</span> <span class="token string">&quot;, &quot;</span> <span class="token operator">&amp;</span> CountLessThan01
<span class="token keyword">End</span> <span class="token keyword">Sub</span>

</code></pre></div><p>And finally, running above Subs 25,000 times each, here is the average (5 tests) time in milliseconds (of course it'll be different on each pc, but compared to each other they'll behave similarly):</p> <ol><li>UseWorksheetFunction: 2156 ms</li> <li>UseArray: 2219 ms (+ 3 %)</li> <li>UseEvaluate: 4693 ms (+ 118 %)</li> <li>UseRange: 6530 ms (+ 203 %)</li></ol> <h2 id="avoid-re-purposing-the-names-of-properties-or-methods-as-your-variables"><a href="#avoid-re-purposing-the-names-of-properties-or-methods-as-your-variables" class="header-anchor">#</a> Avoid re-purposing the names of Properties or Methods as your variables</h2> <p>It is generally not considered 'best practice' to re-purpose the reserved names of Properties or Methods as the name(s) of your own procedures and variables.</p> <p><strong>Bad Form</strong> - While the following is (strictly speaking) legal, working code the re-purposing of the <a href="https://msdn.microsoft.com/en-us/library/office/ff839746.aspx" target="_blank" rel="noopener noreferrer">Find<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> method as well as the <a href="https://msdn.microsoft.com/en-us/library/office/ff196952.aspx" target="_blank" rel="noopener noreferrer">Row<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <a href="https://msdn.microsoft.com/en-us/library/office/ff198200.aspx" target="_blank" rel="noopener noreferrer">Column<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and <a href="https://msdn.microsoft.com/en-us/library/office/ff837625.aspx" target="_blank" rel="noopener noreferrer">Address<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> properties can cause problems/conflicts with name ambiguity and is just plain confusing in general.</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Option</span> Explicit

<span class="token keyword">Sub</span> find<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">Dim</span> row <span class="token keyword">As</span> <span class="token keyword">Long</span><span class="token punctuation">,</span> column <span class="token keyword">As</span> <span class="token keyword">Long</span>
    <span class="token keyword">Dim</span> find <span class="token keyword">As</span> <span class="token keyword">String</span><span class="token punctuation">,</span> address <span class="token keyword">As</span> Range
    
    find <span class="token operator">=</span> <span class="token string">&quot;something&quot;</span>
    
    <span class="token keyword">With</span> ThisWorkbook<span class="token punctuation">.</span>Worksheets<span class="token punctuation">(</span><span class="token string">&quot;Sheet1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Cells
        <span class="token keyword">Set</span> address <span class="token operator">=</span> <span class="token punctuation">.</span>SpecialCells<span class="token punctuation">(</span>xlCellTypeLastCell<span class="token punctuation">)</span>
        row <span class="token operator">=</span> <span class="token punctuation">.</span>find<span class="token punctuation">(</span>what<span class="token punctuation">:</span><span class="token operator">=</span>find<span class="token punctuation">,</span> after<span class="token punctuation">:</span><span class="token operator">=</span>address<span class="token punctuation">)</span><span class="token punctuation">.</span>row        <span class="token comment">'&lt; note .row not capitalized</span>
        column <span class="token operator">=</span> <span class="token punctuation">.</span>find<span class="token punctuation">(</span>what<span class="token punctuation">:</span><span class="token operator">=</span>find<span class="token punctuation">,</span> after<span class="token punctuation">:</span><span class="token operator">=</span>address<span class="token punctuation">)</span><span class="token punctuation">.</span>column  <span class="token comment">'&lt; note .column not capitalized</span>
        
        Debug<span class="token punctuation">.</span>Print <span class="token string">&quot;The first 'something' is in &quot;</span> <span class="token operator">&amp;</span> <span class="token punctuation">.</span>Cells<span class="token punctuation">(</span>row<span class="token punctuation">,</span> column<span class="token punctuation">)</span><span class="token punctuation">.</span>address<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">End</span> <span class="token keyword">With</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>

</code></pre></div><p><strong>Good Form</strong> - With all of the reserved words renamed into close but unique approximations of the originals, any potential naming conflicts have been avoided.</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Option</span> Explicit

<span class="token keyword">Sub</span> myFind<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">Dim</span> rw <span class="token keyword">As</span> <span class="token keyword">Long</span><span class="token punctuation">,</span> col <span class="token keyword">As</span> <span class="token keyword">Long</span>
    <span class="token keyword">Dim</span> wht <span class="token keyword">As</span> <span class="token keyword">String</span><span class="token punctuation">,</span> lastCell <span class="token keyword">As</span> Range
    
    wht <span class="token operator">=</span> <span class="token string">&quot;something&quot;</span>
    
    <span class="token keyword">With</span> ThisWorkbook<span class="token punctuation">.</span>Worksheets<span class="token punctuation">(</span><span class="token string">&quot;Sheet1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Cells
        <span class="token keyword">Set</span> lastCell <span class="token operator">=</span> <span class="token punctuation">.</span>SpecialCells<span class="token punctuation">(</span>xlCellTypeLastCell<span class="token punctuation">)</span>
        rw <span class="token operator">=</span> <span class="token punctuation">.</span>Find<span class="token punctuation">(</span>What<span class="token punctuation">:</span><span class="token operator">=</span>wht<span class="token punctuation">,</span> After<span class="token punctuation">:</span><span class="token operator">=</span>lastCell<span class="token punctuation">)</span><span class="token punctuation">.</span>Row         <span class="token comment">'◄ note .Find and .Row</span>
        col <span class="token operator">=</span> <span class="token punctuation">.</span>Find<span class="token punctuation">(</span>What<span class="token punctuation">:</span><span class="token operator">=</span>wht<span class="token punctuation">,</span> After<span class="token punctuation">:</span><span class="token operator">=</span>lastCell<span class="token punctuation">)</span><span class="token punctuation">.</span>Column     <span class="token comment">'◄ .Find and .Column</span>
        
        Debug<span class="token punctuation">.</span>Print <span class="token string">&quot;The first 'something' is in &quot;</span> <span class="token operator">&amp;</span> <span class="token punctuation">.</span>Cells<span class="token punctuation">(</span>rw<span class="token punctuation">,</span> col<span class="token punctuation">)</span><span class="token punctuation">.</span>Address<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">End</span> <span class="token keyword">With</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>

</code></pre></div><p>While there may come a time when you want to intentionally rewrite a standard method or property to your own specifications, those situations are few and far between. For the most part, stay away from reusing reserved names for your own constructs.</p> <h4 id="remarks"><a href="#remarks" class="header-anchor">#</a> Remarks</h4> <p>We all know them, but these practices are far less obvious to someone starting to program in VBA.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/excelvba/vba-best-practices.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/excelvba/debugging-and-troubleshooting.html" class="prev">
        Debugging and Troubleshooting
      </a></span> <span class="next"><a href="/excelvba/excel-vba-tips-and-tricks.html">
        Excel VBA Tips and Tricks
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/1096.009c6cef.js" defer></script>
  </body>
</html>
