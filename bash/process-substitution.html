<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Bash - Process substitution</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Compare two files from the web, Feed a while loop with the output of a command, Concatenating files, With paste command, Stream a file through multiple programs at once, To avoid usage of a sub-shell">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="Bash - Process substitution">
    <meta property="og:description" content="Compare two files from the web, Feed a while loop with the output of a command, Concatenating files, With paste command, Stream a file through multiple programs at once, To avoid usage of a sub-shell">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/bash/process-substitution.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="Bash - Process substitution">
    <meta name="twitter:description" content="Compare two files from the web, Feed a while loop with the output of a command, Concatenating files, With paste command, Stream a file through multiple programs at once, To avoid usage of a sub-shell">
    <meta name="twitter:url" content="/bash/process-substitution.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/522.fe57ba01.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Bash</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/bash/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/bash/getting-started-with-bash.html" class="sidebar-link">Getting started with Bash</a></li><li><a href="/bash/script-shebang.html" class="sidebar-link">Script shebang</a></li><li><a href="/bash/navigating-directories.html" class="sidebar-link">Navigating directories</a></li><li><a href="/bash/listing-files.html" class="sidebar-link">Listing Files</a></li><li><a href="/bash/using-cat.html" class="sidebar-link">Using cat</a></li><li><a href="/bash/grep.html" class="sidebar-link">Grep</a></li><li><a href="/bash/aliasing.html" class="sidebar-link">Aliasing</a></li><li><a href="/bash/jobs-and-processes.html" class="sidebar-link">Jobs and Processes</a></li><li><a href="/bash/redirection.html" class="sidebar-link">Redirection</a></li><li><a href="/bash/control-structures.html" class="sidebar-link">Control Structures</a></li><li><a href="/bash/true-false-and-commands.html" class="sidebar-link">true, false and : commands</a></li><li><a href="/bash/arrays.html" class="sidebar-link">Arrays</a></li><li><a href="/bash/associative-arrays.html" class="sidebar-link">Associative arrays</a></li><li><a href="/bash/functions.html" class="sidebar-link">Functions</a></li><li><a href="/bash/bash-parameter-expansion.html" class="sidebar-link">Bash Parameter Expansion</a></li><li><a href="/bash/copying-cp.html" class="sidebar-link">Copying (cp)</a></li><li><a href="/bash/find.html" class="sidebar-link">Find</a></li><li><a href="/bash/using-sort.html" class="sidebar-link">Using sort</a></li><li><a href="/bash/sourcing.html" class="sidebar-link">Sourcing</a></li><li><a href="/bash/here-documents-and-here-strings.html" class="sidebar-link">Here documents and here strings</a></li><li><a href="/bash/quoting.html" class="sidebar-link">Quoting</a></li><li><a href="/bash/conditional-expressions.html" class="sidebar-link">Conditional Expressions</a></li><li><a href="/bash/scripting-with-parameters.html" class="sidebar-link">Scripting with Parameters</a></li><li><a href="/bash/bash-history-substitutions.html" class="sidebar-link">Bash history substitutions</a></li><li><a href="/bash/math.html" class="sidebar-link">Math</a></li><li><a href="/bash/bash-arithmetic.html" class="sidebar-link">Bash Arithmetic</a></li><li><a href="/bash/scoping.html" class="sidebar-link">Scoping</a></li><li><a href="/bash/process-substitution.html" aria-current="page" class="active sidebar-link">Process substitution</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bash/process-substitution.html#compare-two-files-from-the-web" class="sidebar-link">Compare two files from the web</a></li><li class="sidebar-sub-header"><a href="/bash/process-substitution.html#feed-a-while-loop-with-the-output-of-a-command" class="sidebar-link">Feed a while loop with the output of a command</a></li><li class="sidebar-sub-header"><a href="/bash/process-substitution.html#concatenating-files" class="sidebar-link">Concatenating files</a></li><li class="sidebar-sub-header"><a href="/bash/process-substitution.html#with-paste-command" class="sidebar-link">With paste command</a></li><li class="sidebar-sub-header"><a href="/bash/process-substitution.html#stream-a-file-through-multiple-programs-at-once" class="sidebar-link">Stream a file through multiple programs at once</a></li><li class="sidebar-sub-header"><a href="/bash/process-substitution.html#to-avoid-usage-of-a-sub-shell" class="sidebar-link">To avoid usage of a sub-shell</a></li></ul></li><li><a href="/bash/programmable-completion.html" class="sidebar-link">Programmable completion</a></li><li><a href="/bash/customizing-ps1.html" class="sidebar-link">Customizing PS1</a></li><li><a href="/bash/brace-expansion.html" class="sidebar-link">Brace Expansion</a></li><li><a href="/bash/getopts-smart-positional-parameter-parsing.html" class="sidebar-link">getopts : smart positional-parameter parsing</a></li><li><a href="/bash/debugging.html" class="sidebar-link">Debugging</a></li><li><a href="/bash/pattern-matching-and-regular-expressions.html" class="sidebar-link">Pattern matching and regular expressions</a></li><li><a href="/bash/change-shell.html" class="sidebar-link">Change shell</a></li><li><a href="/bash/internal-variables.html" class="sidebar-link">Internal variables</a></li><li><a href="/bash/job-control.html" class="sidebar-link">Job Control</a></li><li><a href="/bash/case-statement.html" class="sidebar-link">Case statement</a></li><li><a href="/bash/read-a-file-data-stream-variable-line-by-line-and-or-field-by-field.html" class="sidebar-link">Read a file (data stream, variable) line-by-line (and/or field-by-field)?</a></li><li><a href="/bash/file-execution-sequence.html" class="sidebar-link">File execution sequence</a></li><li><a href="/bash/splitting-files.html" class="sidebar-link">Splitting Files</a></li><li><a href="/bash/file-transfer-using-scp.html" class="sidebar-link">File Transfer using scp</a></li><li><a href="/bash/pipelines.html" class="sidebar-link">Pipelines</a></li><li><a href="/bash/managing-path-environment-variable.html" class="sidebar-link">Managing PATH environment variable</a></li><li><a href="/bash/word-splitting.html" class="sidebar-link">Word splitting</a></li><li><a href="/bash/avoiding-date-using-printf.html" class="sidebar-link">Avoiding date using printf</a></li><li><a href="/bash/using-trap-to-react-to-signals-and-system-events.html" class="sidebar-link">Using &quot;trap&quot; to react to signals and system events</a></li><li><a href="/bash/chain-of-commands-and-operations.html" class="sidebar-link">Chain of commands and operations</a></li><li><a href="/bash/type-of-shells.html" class="sidebar-link">Type of Shells</a></li><li><a href="/bash/color-script-output-cross-platform.html" class="sidebar-link">Color script output (cross-platform)</a></li><li><a href="/bash/co-processes.html" class="sidebar-link">co-processes</a></li><li><a href="/bash/typing-variables.html" class="sidebar-link">Typing variables</a></li><li><a href="/bash/jobs-at-specific-times.html" class="sidebar-link">Jobs at specific times</a></li><li><a href="/bash/handling-the-system-prompt.html" class="sidebar-link">Handling the system prompt</a></li><li><a href="/bash/the-cut-command.html" class="sidebar-link">The cut command</a></li><li><a href="/bash/bash-on-windows-10.html" class="sidebar-link">Bash on Windows 10</a></li><li><a href="/bash/cut-command.html" class="sidebar-link">Cut Command</a></li><li><a href="/bash/global-and-local-variables.html" class="sidebar-link">global and local variables</a></li><li><a href="/bash/cgi-scripts.html" class="sidebar-link">CGI Scripts</a></li><li><a href="/bash/select-keyword.html" class="sidebar-link">Select keyword</a></li><li><a href="/bash/when-to-use-eval.html" class="sidebar-link">When to use eval</a></li><li><a href="/bash/networking-with-bash.html" class="sidebar-link">Networking With Bash</a></li><li><a href="/bash/parallel.html" class="sidebar-link">Parallel</a></li><li><a href="/bash/decoding-url.html" class="sidebar-link">Decoding URL</a></li><li><a href="/bash/design-patterns.html" class="sidebar-link">Design Patterns</a></li><li><a href="/bash/namespace.html" class="sidebar-link">Namespace</a></li><li><a href="/bash/creating-directories.html" class="sidebar-link">Creating directories</a></li><li><a href="/bash/strace.html" class="sidebar-link">strace</a></li><li><a href="/bash/sleep-utility.html" class="sidebar-link">Sleep utility</a></li><li><a href="/bash/pitfalls.html" class="sidebar-link">Pitfalls</a></li><li><a href="/bash/keyboard-shortcuts.html" class="sidebar-link">Keyboard shortcuts</a></li><li><a href="/bash/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="process-substitution"><a href="#process-substitution" class="header-anchor">#</a> Process substitution</h1> <h2 id="compare-two-files-from-the-web"><a href="#compare-two-files-from-the-web" class="header-anchor">#</a> Compare two files from the web</h2> <p>The following compares two files with <code>diff</code> using process substitution instead of creating temporary files.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">diff</span> <span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token function">curl</span> http://www.example.com/page1<span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token function">curl</span> http://www.example.com/page2<span class="token punctuation">)</span>

</code></pre></div><h2 id="feed-a-while-loop-with-the-output-of-a-command"><a href="#feed-a-while-loop-with-the-output-of-a-command" class="header-anchor">#</a> Feed a while loop with the output of a command</h2> <p>This feeds a <code>while</code> loop with the output of a <code>grep</code> command:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token keyword">while</span> <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token string">&quot;:&quot;</span> <span class="token builtin class-name">read</span> -r user _
<span class="token keyword">do</span>
    <span class="token comment"># &quot;$user&quot; holds the username in /etc/passwd</span>
<span class="token keyword">done</span> <span class="token operator">&lt;</span> <span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token function">grep</span> <span class="token string">&quot;hello&quot;</span> /etc/passwd<span class="token punctuation">)</span>

</code></pre></div><h2 id="concatenating-files"><a href="#concatenating-files" class="header-anchor">#</a> Concatenating files</h2> <p>It is well known that you cannot use the same file for input and ouput in the same command. For instance,</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">cat</span> header.txt body.txt <span class="token operator">&gt;</span>body.txt

</code></pre></div><p>doesn’t do what you want. By the time <code>cat</code> reads <code>body.txt</code>, it has already been truncated by the redirection and it is empty. The final result will be that <code>body.txt</code> will hold the contents of <code>header.txt</code> <strong>only.</strong></p> <p>One might think to avoid this with process substitution, that is, that the command</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">cat</span> header.txt <span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token function">cat</span> body.txt<span class="token punctuation">)</span> <span class="token operator">&gt;</span> body.txt

</code></pre></div><p>will force the original contents of <code>body.txt</code> to be somehow saved in some buffer somewhere before the file is truncated by the redirection. It doesn’t work. The <code>cat</code> in parentheses begins reading the file only after all file descriptors have been set up, just like the outer one. There is no point in trying to use process substitution in this case.</p> <p>The only way to prepend a file to another file is to create an intermediate one:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">cat</span> header.txt body.txt <span class="token operator">&gt;</span>body.txt.new
$ <span class="token function">mv</span> body.txt.new body.txt

</code></pre></div><p>which is what <code>sed</code> or <code>perl</code> or similar programs do under the carpet when called with an <strong>edit-in-place</strong> option (usually <code>-i</code>).</p> <h2 id="with-paste-command"><a href="#with-paste-command" class="header-anchor">#</a> With paste command</h2> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Process substitution with paste command is common</span>
<span class="token comment"># To compare the contents of two directories</span>
<span class="token function">paste</span> <span class="token operator">&lt;</span><span class="token punctuation">(</span> <span class="token function">ls</span> /path/to/directory1 <span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token punctuation">(</span> <span class="token function">ls</span> /path/to/directory1 <span class="token punctuation">)</span>

</code></pre></div><h2 id="stream-a-file-through-multiple-programs-at-once"><a href="#stream-a-file-through-multiple-programs-at-once" class="header-anchor">#</a> Stream a file through multiple programs at once</h2> <p>This counts the number of lines in a big file with <code>wc -l</code> while simultaneously compressing it with <code>gzip</code>.  Both run concurrently.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">tee</span> <span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token function">wc</span> -l <span class="token operator">&gt;</span><span class="token file-descriptor important">&amp;2</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> bigfile <span class="token operator">|</span> <span class="token function">gzip</span> <span class="token operator">&gt;</span> bigfile.gz

</code></pre></div><p>Normally <code>tee</code> writes its input to one or more files (and stdout).  We can write to commands instead of files with <code>tee &gt;(command)</code>.</p> <p>Here the command <code>wc -l &gt;&amp;2</code> counts the lines read from <code>tee</code> (which in turn is reading from <code>bigfile</code>).  (The line count is sent to stderr (<code>&gt;&amp;2</code>) to avoid mixing with the input to <code>gzip</code>.)  The stdout of <code>tee</code> is simultaneously fed into <code>gzip</code>.</p> <h2 id="to-avoid-usage-of-a-sub-shell"><a href="#to-avoid-usage-of-a-sub-shell" class="header-anchor">#</a> To avoid usage of a sub-shell</h2> <p>One major aspect of process substitution is that it lets us avoid usage of a sub-shell when piping commands from the shell.</p> <p>This can be demonstrated with a simple example below. I have the following files in my current folder:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">find</span> <span class="token builtin class-name">.</span> -maxdepth <span class="token number">1</span> -type f -print
foo bar zoo foobar foozoo barzoo 

</code></pre></div><p>If I pipe to a <code>while</code>/<code>read</code> loop that increments a counter as follows:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token function">find</span> <span class="token builtin class-name">.</span> -maxdepth <span class="token number">1</span> -type f -print <span class="token operator">|</span> <span class="token keyword">while</span> <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span> <span class="token builtin class-name">read</span> -r _<span class="token punctuation">;</span> <span class="token keyword">do</span>
    <span class="token variable"><span class="token punctuation">((</span>count<span class="token operator">++</span><span class="token punctuation">))</span></span>
<span class="token keyword">done</span>

</code></pre></div><p><code>$count</code> now does <strong>not</strong> contain <code>6</code>, because it was modified in the sub-shell context. Any of the commands shown below are run in a sub-shell context and the scope of the variables used within are lost after the sub-shell terminates.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">command</span> <span class="token operator">&amp;</span>
<span class="token builtin class-name">command</span> <span class="token operator">|</span> <span class="token builtin class-name">command</span> 
<span class="token punctuation">(</span> <span class="token builtin class-name">command</span> <span class="token punctuation">)</span>

</code></pre></div><p>Process substitution will solve the problem by avoiding use the of pipe <code>|</code> operator as in</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token keyword">while</span> <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span> <span class="token builtin class-name">read</span> -r _<span class="token punctuation">;</span> <span class="token keyword">do</span>
    <span class="token variable"><span class="token punctuation">((</span>count<span class="token operator">++</span><span class="token punctuation">))</span></span>
<span class="token keyword">done</span> <span class="token operator">&lt;</span> <span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token function">find</span> <span class="token builtin class-name">.</span> -maxdepth <span class="token number">1</span> -type f -print<span class="token punctuation">)</span>

</code></pre></div><p>This will retain the <code>count</code> variable value as no sub-shells are invoked.</p> <h4 id="remarks"><a href="#remarks" class="header-anchor">#</a> Remarks</h4> <p>Process substitution is a form of redirection where the input or output of a process (some sequence of commands) appear as a temporary file.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/bash/process-substitution.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/bash/scoping.html" class="prev">
        Scoping
      </a></span> <span class="next"><a href="/bash/programmable-completion.html">
        Programmable completion
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/522.fe57ba01.js" defer></script>
  </body>
</html>
