<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HTML - Media types and the canvas</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Basic loading and playing a video on the canvas., Loading and displaying an Image, Drawing an svg image, Capture canvas and Save as webM video">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="HTML - Media types and the canvas">
    <meta property="og:description" content="Basic loading and playing a video on the canvas., Loading and displaying an Image, Drawing an svg image, Capture canvas and Save as webM video">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/html/media-types-and-the-canvas.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="HTML - Media types and the canvas">
    <meta name="twitter:description" content="Basic loading and playing a video on the canvas., Loading and displaying an Image, Drawing an svg image, Capture canvas and Save as webM video">
    <meta name="twitter:url" content="/html/media-types-and-the-canvas.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/1280.a9391ab1.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>HTML</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/html/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/html/getting-started-with-html.html" class="sidebar-link">Getting started with HTML</a></li><li><a href="/html/doctypes.html" class="sidebar-link">Doctypes</a></li><li><a href="/html/headings.html" class="sidebar-link">Headings</a></li><li><a href="/html/paragraphs.html" class="sidebar-link">Paragraphs</a></li><li><a href="/html/text-formatting.html" class="sidebar-link">Text Formatting</a></li><li><a href="/html/anchors-and-hyperlinks.html" class="sidebar-link">Anchors and Hyperlinks</a></li><li><a href="/html/lists.html" class="sidebar-link">Lists</a></li><li><a href="/html/tables.html" class="sidebar-link">Tables</a></li><li><a href="/html/comments.html" class="sidebar-link">Comments</a></li><li><a href="/html/classes-and-ids.html" class="sidebar-link">Classes and IDs</a></li><li><a href="/html/data-attributes.html" class="sidebar-link">Data Attributes</a></li><li><a href="/html/linking-resources.html" class="sidebar-link">Linking Resources</a></li><li><a href="/html/include-javascript-code-in-html.html" class="sidebar-link">Include JavaScript Code in HTML</a></li><li><a href="/html/using-html-with-css.html" class="sidebar-link">Using HTML with CSS</a></li><li><a href="/html/images.html" class="sidebar-link">Images</a></li><li><a href="/html/image-maps.html" class="sidebar-link">Image Maps</a></li><li><a href="/html/input-control-elements.html" class="sidebar-link">Input Control Elements</a></li><li><a href="/html/forms.html" class="sidebar-link">Forms</a></li><li><a href="/html/div-element.html" class="sidebar-link">Div Element</a></li><li><a href="/html/sectioning-elements.html" class="sidebar-link">Sectioning Elements</a></li><li><a href="/html/navigation-bars.html" class="sidebar-link">Navigation Bars</a></li><li><a href="/html/label-element.html" class="sidebar-link">Label Element</a></li><li><a href="/html/output-element.html" class="sidebar-link">Output Element</a></li><li><a href="/html/void-elements.html" class="sidebar-link">Void Elements</a></li><li><a href="/html/media-elements.html" class="sidebar-link">Media Elements</a></li><li><a href="/html/progress-element.html" class="sidebar-link">Progress Element</a></li><li><a href="/html/selection-menu-controls.html" class="sidebar-link">Selection Menu Controls</a></li><li><a href="/html/embed.html" class="sidebar-link">Embed</a></li><li><a href="/html/iframes.html" class="sidebar-link">IFrames</a></li><li><a href="/html/content-languages.html" class="sidebar-link">Content Languages</a></li><li><a href="/html/svg.html" class="sidebar-link">SVG</a></li><li><a href="/html/canvas.html" class="sidebar-link">Canvas</a></li><li><a href="/html/meta-information.html" class="sidebar-link">Meta Information</a></li><li><a href="/html/marking-up-computer-code.html" class="sidebar-link">Marking up computer code</a></li><li><a href="/html/marking-up-quotes.html" class="sidebar-link">Marking-up Quotes</a></li><li><a href="/html/tabindex.html" class="sidebar-link">Tabindex</a></li><li><a href="/html/global-attributes.html" class="sidebar-link">Global Attributes</a></li><li><a href="/html/html-5-cache.html" class="sidebar-link">HTML 5 Cache</a></li><li><a href="/html/html-event-attributes.html" class="sidebar-link">HTML Event Attributes</a></li><li><a href="/html/character-entities.html" class="sidebar-link">Character Entities</a></li><li><a href="/html/aria.html" class="sidebar-link">ARIA</a></li><li><a href="/html/getting-started-with-html5-canvas.html" class="sidebar-link">Getting started with html5-canvas</a></li><li><a href="/html/text.html" class="sidebar-link">Text</a></li><li><a href="/html/polygons.html" class="sidebar-link">Polygons</a></li><li><a href="/html/images.html" class="sidebar-link">Images</a></li><li><a href="/html/path-syntax-only.html" class="sidebar-link">Path (Syntax only)</a></li><li><a href="/html/paths.html" class="sidebar-link">Paths</a></li><li><a href="/html/navigating-along-a-path.html" class="sidebar-link">Navigating along a Path</a></li><li><a href="/html/dragging-path-shapes-images-on-canvas.html" class="sidebar-link">Dragging Path Shapes &amp; Images on Canvas</a></li><li><a href="/html/media-types-and-the-canvas.html" aria-current="page" class="active sidebar-link">Media types and the canvas</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/html/media-types-and-the-canvas.html#basic-loading-and-playing-a-video-on-the-canvas" class="sidebar-link">Basic loading and playing a video on the canvas.</a></li><li class="sidebar-sub-header"><a href="/html/media-types-and-the-canvas.html#loading-and-displaying-an-image" class="sidebar-link">Loading and displaying an Image</a></li><li class="sidebar-sub-header"><a href="/html/media-types-and-the-canvas.html#drawing-an-svg-image" class="sidebar-link">Drawing an svg image</a></li><li class="sidebar-sub-header"><a href="/html/media-types-and-the-canvas.html#capture-canvas-and-save-as-webm-video" class="sidebar-link">Capture canvas and Save as webM video</a></li></ul></li><li><a href="/html/animation.html" class="sidebar-link">Animation</a></li><li><a href="/html/collisions-and-intersections.html" class="sidebar-link">Collisions and Intersections</a></li><li><a href="/html/clearing-the-screen.html" class="sidebar-link">Clearing the screen</a></li><li><a href="/html/responsive-design.html" class="sidebar-link">Responsive Design</a></li><li><a href="/html/shadows.html" class="sidebar-link">Shadows</a></li><li><a href="/html/charts-diagrams.html" class="sidebar-link">Charts &amp; Diagrams</a></li><li><a href="/html/transformations.html" class="sidebar-link">Transformations</a></li><li><a href="/html/compositing.html" class="sidebar-link">Compositing</a></li><li><a href="/html/pixel-manipulation-with-getimagedata-and-putimagedata.html" class="sidebar-link">Pixel Manipulation with &quot;getImageData&quot; and &quot;putImageData&quot;</a></li><li><a href="/html/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="media-types-and-the-canvas"><a href="#media-types-and-the-canvas" class="header-anchor">#</a> Media types and the canvas</h1> <h2 id="basic-loading-and-playing-a-video-on-the-canvas"><a href="#basic-loading-and-playing-a-video-on-the-canvas" class="header-anchor">#</a> Basic loading and playing a video on the canvas.</h2> <p>The canvas can be used to display video from a variety of sources. This example shows how to load a video as a file resource, display it and add a simple click on screen play/pause toggle.</p> <p>This stackoverflow self answered question <a href="http://stackoverflow.com/a/38710126/3877726" target="_blank" rel="noopener noreferrer">How do I display a video using HTML5 canvas tag<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> shows the following example code in action.</p> <h3 id="just-an-image"><a href="#just-an-image" class="header-anchor">#</a> Just an image</h3> <p>A video is just an image as far as the canvas is concerned. You can draw it like any image. The difference being the video can play and has sound.</p> <h3 id="get-canvas-and-basic-setup"><a href="#get-canvas-and-basic-setup" class="header-anchor">#</a> Get canvas and basic setup</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// It is assumed you know how to add a canvas and correctly size it.</span>
<span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;myCanvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// get the canvas from the page</span>
<span class="token keyword">var</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;2d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> videoContainer<span class="token punctuation">;</span> <span class="token comment">// object to hold video and associated info</span>

</code></pre></div><h3 id="creating-and-loading-the-video"><a href="#creating-and-loading-the-video" class="header-anchor">#</a> Creating and loading the video</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> video <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;video&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// create a video element</span>
video<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;urlOffVideo.webm&quot;</span><span class="token punctuation">;</span> 
<span class="token comment">// the video will now begin to load.</span>
<span class="token comment">// As some additional info is needed we will place the video in a</span>
<span class="token comment">// containing object for convenience</span>
video<span class="token punctuation">.</span>autoPlay <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// ensure that the video does not auto play</span>
video<span class="token punctuation">.</span>loop <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// set the video to loop.</span>
videoContainer <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token comment">// we will add properties as needed</span>
     video <span class="token operator">:</span> video<span class="token punctuation">,</span>
     ready <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>   
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><p>Unlike images elements videos don't have to be fully loaded to be displayed on the canvas. Videos also provide a host of extra events that can be used to monitor status of the video.</p> <p>In this case we wish to know when the video is ready to play. <code>oncanplay</code> means that enough of the video has loaded to play some of it, but there may not be enough to play to the end.</p> <div class="language-js extra-class"><pre class="language-js"><code>video<span class="token punctuation">.</span>oncanplay <span class="token operator">=</span> readyToPlayVideo<span class="token punctuation">;</span> <span class="token comment">// set the event to the play function that </span>
                                  <span class="token comment">// can be found below</span>

</code></pre></div><p>Alternatively you can use <code>oncanplaythrough</code> which will fire when enough of the video has loaded so that it can be played to the end.</p> <div class="language-js extra-class"><pre class="language-js"><code>video<span class="token punctuation">.</span>oncanplaythrough <span class="token operator">=</span> readyToPlayVideo<span class="token punctuation">;</span> <span class="token comment">// set the event to the play function that</span>
                                         <span class="token comment">// can be found below</span>

</code></pre></div><p>Only use one of the canPlay events not both.</p> <h3 id="the-can-play-event-equivalent-to-image-onload"><a href="#the-can-play-event-equivalent-to-image-onload" class="header-anchor">#</a> The can play event (equivalent to image onload)</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">readyToPlayVideo</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// this is a referance to the video</span>
    <span class="token comment">// the video may not match the canvas size so find a scale to fit</span>
    videoContainer<span class="token punctuation">.</span>scale <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>
                         canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>videoWidth<span class="token punctuation">,</span> 
                         canvas<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>videoHeight<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    videoContainer<span class="token punctuation">.</span>ready <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token comment">// the video can be played so hand it off to the display function</span>
    <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>undateCanvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="displaying"><a href="#displaying" class="header-anchor">#</a> Displaying</h3> <p>The video will not play itself on the canvas. You need to draw it for every new frame. As it is difficult to know the exact frame rate and when they occur the best approch is to display the video as if running at 60fps. If the frame rate is lower then w just render the same frame twice. If the frame rate is higher then there is nothing that can be don to see the extra frames so we just ignore them.</p> <p>The video element is just a image element and can be draw like any image, you can scale, rotate, pan the video, mirror it, fade it, clip it and display only parts, draw it twice the second time with a global composite mode to add FX like lighten, screen, etc..</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">updateCanvas</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Though not always needed </span>
                                                     <span class="token comment">// you may get bad pixels from </span>
                                                     <span class="token comment">// previous videos so clear to be</span>
                                                     <span class="token comment">// safe</span>
    <span class="token comment">// only draw if loaded and ready</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>videoContainer <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> videoContainer<span class="token punctuation">.</span>ready<span class="token punctuation">)</span><span class="token punctuation">{</span> 
        <span class="token comment">// find the top left of the video on the canvas</span>
        <span class="token keyword">var</span> scale <span class="token operator">=</span> videoContainer<span class="token punctuation">.</span>scale<span class="token punctuation">;</span>
        <span class="token keyword">var</span> vidH <span class="token operator">=</span> videoContainer<span class="token punctuation">.</span>video<span class="token punctuation">.</span>videoHeight<span class="token punctuation">;</span>
        <span class="token keyword">var</span> vidW <span class="token operator">=</span> videoContainer<span class="token punctuation">.</span>video<span class="token punctuation">.</span>videoWidth<span class="token punctuation">;</span>
        <span class="token keyword">var</span> top <span class="token operator">=</span> canvas<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token punctuation">(</span>vidH <span class="token operator">/</span><span class="token number">2</span> <span class="token punctuation">)</span> <span class="token operator">*</span> scale<span class="token punctuation">;</span>
        <span class="token keyword">var</span> left <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token punctuation">(</span>vidW <span class="token operator">/</span><span class="token number">2</span> <span class="token punctuation">)</span> <span class="token operator">*</span> scale<span class="token punctuation">;</span>
        <span class="token comment">// now just draw the video the correct size</span>
        ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>videoContainer<span class="token punctuation">.</span>video<span class="token punctuation">,</span> left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> vidW <span class="token operator">*</span> scale<span class="token punctuation">,</span> vidH <span class="token operator">*</span> scale<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>videoContainer<span class="token punctuation">.</span>video<span class="token punctuation">.</span>paused<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// if not playing show the paused screen </span>
            <span class="token function">drawPayIcon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// all done for display </span>
    <span class="token comment">// request the next frame in 1/60th of a second</span>
    <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>updateCanvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="basic-play-pause-control"><a href="#basic-play-pause-control" class="header-anchor">#</a> Basic play pause control</h3> <p>Now we have the video loaded and displayed all we need is the play control. We will make it as a click toggle play on the screen. When the video is playing and the user clicks the video is paused. When paused the click resumes play. We will add a function to darken the video and draw an play icon (triangle)</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">drawPayIcon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">&quot;black&quot;</span><span class="token punctuation">;</span>  <span class="token comment">// darken display</span>
     ctx<span class="token punctuation">.</span>globalAlpha <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
     ctx<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
     ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">&quot;#DDD&quot;</span><span class="token punctuation">;</span> <span class="token comment">// colour of play icon</span>
     ctx<span class="token punctuation">.</span>globalAlpha <span class="token operator">=</span> <span class="token number">0.75</span><span class="token punctuation">;</span> <span class="token comment">// partly transparent</span>
     ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// create the path for the icon</span>
     <span class="token keyword">var</span> size <span class="token operator">=</span> <span class="token punctuation">(</span>canvas<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">;</span>  <span class="token comment">// the size of the icon</span>
     ctx<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>canvas<span class="token punctuation">.</span>width<span class="token operator">/</span><span class="token number">2</span> <span class="token operator">+</span> size<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// start at the pointy end</span>
     ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>canvas<span class="token punctuation">.</span>width<span class="token operator">/</span><span class="token number">2</span> <span class="token operator">-</span> size<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
     ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>canvas<span class="token punctuation">.</span>width<span class="token operator">/</span><span class="token number">2</span> <span class="token operator">-</span> size<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
     ctx<span class="token punctuation">.</span><span class="token function">closePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     ctx<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     ctx<span class="token punctuation">.</span>globalAlpha <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// restore alpha</span>
<span class="token punctuation">}</span>    

</code></pre></div><h3 id="now-the-play-pause-event"><a href="#now-the-play-pause-event" class="header-anchor">#</a> Now the play pause event</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">playPauseClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     <span class="token keyword">if</span><span class="token punctuation">(</span>videoContainer <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> videoContainer<span class="token punctuation">.</span>ready<span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>videoContainer<span class="token punctuation">.</span>video<span class="token punctuation">.</span>paused<span class="token punctuation">)</span><span class="token punctuation">{</span>                                 
                videoContainer<span class="token punctuation">.</span>video<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                videoContainer<span class="token punctuation">.</span>video<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// register the event</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span>playPauseClick<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h3 id="summary"><a href="#summary" class="header-anchor">#</a> Summary</h3> <p>Playing a video is very easy using the canvas, adding effect in real time is also easy. There are however some limitations on formats, how you can play and seek. MDN HTMLMediaElement is the place to get the full referance to the video object.</p> <p>Once the image has been drawn on the canvas you can use <code>ctx.getImageData</code> to access the pixels it contains. Or you can use <code>canvas.toDataURL</code> to snap a still and download it. (Only if the video is from a trusted source and does not taint the canvas).</p> <p>Note if the video has sound then playing it will also play the sound.</p> <p>Happy videoing.</p> <h2 id="loading-and-displaying-an-image"><a href="#loading-and-displaying-an-image" class="header-anchor">#</a> Loading and displaying an Image</h2> <p>To load an image and place it on the canvas</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// see note on creating an image</span>
image<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;imageURL&quot;</span><span class="token punctuation">;</span>
image<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p><strong>Creating an image</strong></p> <p>There are several ways to create an image</p> <ul><li><code>new Image()</code></li> <li><code>document.createElement(&quot;img&quot;)</code></li> <li><code>&lt;img src = 'imageUrl' id='myImage'&gt;</code>  As part of the HTML body and retrieved with <code>document.getElementById('myImage')</code></li></ul> <p>The image is a <code>HTMLImageElement</code></p> <p><strong>Image.src  property</strong></p> <p>The image <code>src</code>can be any valid image URL or encoded dataURL. See this topic's Remarks for more information on image formats and support.</p> <ul><li><code>image.src = &quot;http://my.domain.com/images/myImage.jpg&quot;</code></li> <li><code>image.src = &quot;data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=&quot;</code> *</li></ul> <p>*<sub>The dataURL is a 1 by 1 pixel gif image containing black</sub></p> <p><strong>Remarks on loading and errors</strong></p> <p>The image will begin loading when its src property is set. The loading is syncriouse but the <code>onload</code> event will not be called until the function or code has exited/returned.</p> <p>If you get an image from the page (for example <code>document.getElementById(&quot;myImage&quot;)</code>) and its <code>src</code> is set it may or may not have loaded. You can check on the status of the image with <code>HTMLImageElement.complete</code> which will be <code>true</code> if complete. This does not mean the image has loaded, it means that it has either</p> <ul><li>loaded</li> <li>there was an error</li> <li>src property has not been set and is equal to the empty String <code>&quot;&quot;</code></li></ul> <p>If the image is from an unreliable source and may not be accessible for a variety of reasons it will generate an error event. When this happens the image will be in a broken state. If you then attempt to draw it onto the canvas it will throw the following error</p> <div class="language-js extra-class"><pre class="language-js"><code>Uncaught DOMException<span class="token operator">:</span> Failed to execute <span class="token string">'drawImage'</span> on <span class="token string">'CanvasRenderingContext2D'</span><span class="token operator">:</span> The HTMLImageElement provided is <span class="token keyword">in</span> the <span class="token string">'broken'</span> state<span class="token punctuation">.</span>

</code></pre></div><p>By supplying the <code>image.onerror = myImgErrorHandler</code> event you can take appropriate action to prevent errors.</p> <h2 id="drawing-an-svg-image"><a href="#drawing-an-svg-image" class="header-anchor">#</a> Drawing an svg image</h2> <p>To draw a vector SVG image, the operation is not different from a raster image :<br>
You first need to load your SVG image into an HTMLImage element, then use the <code>drawImage()</code> method.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
image<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
image<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;someFile.SVG&quot;</span><span class="token punctuation">;</span>

</code></pre></div><p>SVG images have some advantages over raster ones, since you won't loose quality, whatever the scale you'll draw it on your canvas. But beware, it may also be a bit slower than drawing a raster image.</p> <p>However, SVG images come with more restrictions than raster images.</p> <li><p>**For security purpose, no external content can be loaded from an SVG image referenced in an HTMLImageElement(`<img>`)**<br>
No external stylesheet, no external image referenced in SVGImage (`<image></image>`) elements, no external filter or element linked by the `xlink:href` attribute (`<use xlink:href="anImage.SVG#anElement"></use>`) or the funcIRI (`url()`) attribute method etc.<br>
Also, stylesheets appended in the main document won't have any effect on the SVG document once referenced in an HTMLImage element.<br>
Finally, no script will be executed inside the SVG Image.<br>
**Workaround :** You'll need to append all external elements inside the SVG itself before referrencing to the HTMLImage element. (for images or fonts, you need to append a dataURI version of your external resources).</p></li> <li><p>**The root element (`<svg>`) must have its width and height attributes set to an absolute value.**<br>
If you were to use relative length (e.g `%`), then the browser won't be able to know to what it is relative.
Some browsers (Blink) will try to make a guess, but most will simply ignore your image and won't draw anything, without a warning.</svg></p></li> <li><p>**Some browsers will [taint the canvas](http://stackoverflow.com/documentation/html5-canvas/1892/introduction-to-html5-canvas/10512/the-tainted-canvas#t=201607270037419008111) when an SVG image has been drawn to it.**<br>
Specifically, Internet-Explorer &lt; Edge in any case, and Safari 9 when a `<foreignObject>` is present in the SVG image.</foreignObject></p></li> <h2 id="capture-canvas-and-save-as-webm-video"><a href="#capture-canvas-and-save-as-webm-video" class="header-anchor">#</a> Capture canvas and Save as webM video</h2> <p>Creating a WebM video from canvas frames and playing in canvas, or upload, or downloading.</p> <h3 id="example-capture-and-play-canvas"><a href="#example-capture-and-play-canvas" class="header-anchor">#</a> Example capture and play canvas</h3> <div class="language-js extra-class"><pre class="language-js"><code>name <span class="token operator">=</span> <span class="token string">&quot;CanvasCapture&quot;</span><span class="token punctuation">;</span> <span class="token comment">// Placed into the Mux and Write Application Name fields of the WebM header</span>
quality <span class="token operator">=</span> <span class="token number">0.7</span><span class="token punctuation">;</span> <span class="token comment">// good quality 1 Best &lt; 0.7 ok to poor</span>
fps <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span> <span class="token comment">// I have tried all sorts of frame rates and all seem to work</span>
          <span class="token comment">// Do some test to workout what your machine can handle as there</span>
          <span class="token comment">// is a lot of variation between machines.</span>
<span class="token keyword">var</span> video <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Groover<span class="token punctuation">.</span>Video</span><span class="token punctuation">(</span>fps<span class="token punctuation">,</span>quality<span class="token punctuation">,</span>name<span class="token punctuation">)</span>
<span class="token keyword">function</span> <span class="token function">capture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>video<span class="token punctuation">.</span>timecode <span class="token operator">&lt;</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 5 seconds</span>
         <span class="token function">setTimeout</span><span class="token punctuation">(</span>capture<span class="token punctuation">,</span>video<span class="token punctuation">.</span>frameDelay<span class="token punctuation">)</span><span class="token punctuation">;</span>             
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
         <span class="token keyword">var</span> videoElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;video&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         videoElement<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>video<span class="token punctuation">.</span><span class="token function">toBlob</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>videoElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
         video <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span> <span class="token comment">// DeReference as it is memory hungry.</span>
         <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// first frame sets the video size</span>
    video<span class="token punctuation">.</span><span class="token function">addFrame</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Add current canvas frame</span>
<span class="token punctuation">}</span>
<span class="token function">capture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// start capture</span>

</code></pre></div><p>Rather than put in a huge effort only to be rejected, this is a quick insert to see if acceptable. Will Give full details if accepted. Also include additional capture options for better HD capture rates (removed from this version, Can capture HD 1080 at 50fps on good machines.)</p> <p>This was inspired by <a href="https://github.com/antimatter15/whammy" target="_blank" rel="noopener noreferrer">Wammy<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> but is a complete rewrite with encode as you go methodology, greatly reducing the memory required during capture. Can capture more than 30 seconds better data, handling algorithms.</p> <blockquote></blockquote> <p><strong>Note</strong> frames are encoded into webP images. Only Chrome supports webP canvas encoding. For other browsers (Firefox and Edge) you will need to use a 3rd party webP encoder such as <a href="http://libwebpjs.appspot.com/v0.1.3/" target="_blank" rel="noopener noreferrer">Libwebp Javascript<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> Encoding WebP images via Javascript is slow. (will include addition of raw webp images support if accepted).</p> <p>The webM encoder inspired by <a href="https://github.com/antimatter15/whammy" target="_blank" rel="noopener noreferrer">Whammy: A Real Time Javascript WebM<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> Groover <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// ensure webp is supported </span>
    <span class="token keyword">function</span> <span class="token function">canEncode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
        canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> canvas<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token string">&quot;image/webp&quot;</span><span class="token punctuation">,</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;image/webp&quot;</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">canEncode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>    
    <span class="token keyword">var</span> webmData <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> clusterTimecode <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> clusterCounter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> <span class="token constant">CLUSTER_MAX_DURATION</span> <span class="token operator">=</span> <span class="token number">30000</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> frameNumber <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> width<span class="token punctuation">;</span>
    <span class="token keyword">var</span> height<span class="token punctuation">;</span>
    <span class="token keyword">var</span> frameDelay<span class="token punctuation">;</span>
    <span class="token keyword">var</span> quality<span class="token punctuation">;</span>
    <span class="token keyword">var</span> name<span class="token punctuation">;</span>
    <span class="token keyword">const</span> videoMimeType <span class="token operator">=</span> <span class="token string">&quot;video/webm&quot;</span><span class="token punctuation">;</span> <span class="token comment">// the only one.</span>
    <span class="token keyword">const</span> frameMimeType <span class="token operator">=</span> <span class="token string">'image/webp'</span><span class="token punctuation">;</span> <span class="token comment">// can be no other</span>
    <span class="token keyword">const</span> <span class="token constant">S</span> <span class="token operator">=</span> String<span class="token punctuation">.</span>fromCharCode<span class="token punctuation">;</span>
    <span class="token keyword">const</span> dataTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">object</span> <span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">toBlob</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">number</span> <span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> stream<span class="token punctuation">.</span><span class="token function">num</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">string</span> <span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> stream<span class="token punctuation">.</span><span class="token function">str</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">array</span>  <span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> data<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> 
        <span class="token function-variable function">double2Str</span> <span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Float64Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>num<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token constant">S</span><span class="token punctuation">(</span>c<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token constant">S</span><span class="token punctuation">(</span>c<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token constant">S</span><span class="token punctuation">(</span>c<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token constant">S</span><span class="token punctuation">(</span>c<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token constant">S</span><span class="token punctuation">(</span>c<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token constant">S</span><span class="token punctuation">(</span>c<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token constant">S</span><span class="token punctuation">(</span>c<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token constant">S</span><span class="token punctuation">(</span>c<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>    
   
    <span class="token keyword">const</span> stream <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">num</span> <span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// writes int</span>
            <span class="token keyword">var</span> parts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span>num <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span> parts<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>num <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span> num <span class="token operator">=</span> num <span class="token operator">&gt;&gt;</span> <span class="token number">8</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>parts<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">str</span> <span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// writes string</span>
            <span class="token keyword">var</span> i<span class="token punctuation">,</span> len<span class="token punctuation">,</span> arr<span class="token punctuation">;</span>
            len <span class="token operator">=</span> str<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
            arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
            <span class="token keyword">return</span> arr<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">compInt</span> <span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// could not find full details so bit of a guess</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>num <span class="token operator">&lt;</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">{</span>       <span class="token comment">// number is prefixed with a bit (1000 is on byte 0100 two, 0010 three and so on)</span>
                num <span class="token operator">+=</span> <span class="token number">0x80</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>num<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>num <span class="token operator">&lt;</span> <span class="token number">0x4000</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                num <span class="token operator">+=</span> <span class="token number">0x4000</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>num<span class="token operator">&gt;&gt;</span><span class="token number">8</span><span class="token punctuation">,</span> num<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>num <span class="token operator">&lt;</span> <span class="token number">0x200000</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                num <span class="token operator">+=</span> <span class="token number">0x200000</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>num<span class="token operator">&gt;&gt;</span><span class="token number">16</span><span class="token punctuation">,</span> num<span class="token operator">&gt;&gt;</span><span class="token number">8</span><span class="token punctuation">,</span> num<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>num <span class="token operator">&lt;</span> <span class="token number">0x10000000</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                num <span class="token operator">+=</span> <span class="token number">0x10000000</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>num<span class="token operator">&gt;&gt;</span><span class="token number">24</span><span class="token punctuation">,</span> num<span class="token operator">&gt;&gt;</span><span class="token number">16</span><span class="token punctuation">,</span> num<span class="token operator">&gt;&gt;</span><span class="token number">8</span><span class="token punctuation">,</span> num<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>            
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> ids <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">// header names and values</span>
        videoData          <span class="token operator">:</span> <span class="token number">0x1a45dfa3</span><span class="token punctuation">,</span> 
        Version            <span class="token operator">:</span> <span class="token number">0x4286</span><span class="token punctuation">,</span>
        ReadVersion        <span class="token operator">:</span> <span class="token number">0x42f7</span><span class="token punctuation">,</span>
        MaxIDLength        <span class="token operator">:</span> <span class="token number">0x42f2</span><span class="token punctuation">,</span>
        MaxSizeLength      <span class="token operator">:</span> <span class="token number">0x42f3</span><span class="token punctuation">,</span>
        DocType            <span class="token operator">:</span> <span class="token number">0x4282</span><span class="token punctuation">,</span>
        DocTypeVersion     <span class="token operator">:</span> <span class="token number">0x4287</span><span class="token punctuation">,</span>
        DocTypeReadVersion <span class="token operator">:</span> <span class="token number">0x4285</span><span class="token punctuation">,</span>
        Segment            <span class="token operator">:</span> <span class="token number">0x18538067</span><span class="token punctuation">,</span>
        Info               <span class="token operator">:</span> <span class="token number">0x1549a966</span><span class="token punctuation">,</span>
        TimecodeScale      <span class="token operator">:</span> <span class="token number">0x2ad7b1</span><span class="token punctuation">,</span>
        MuxingApp          <span class="token operator">:</span> <span class="token number">0x4d80</span><span class="token punctuation">,</span>
        WritingApp         <span class="token operator">:</span> <span class="token number">0x5741</span><span class="token punctuation">,</span>
        Duration           <span class="token operator">:</span> <span class="token number">0x4489</span><span class="token punctuation">,</span>
        Tracks             <span class="token operator">:</span> <span class="token number">0x1654ae6b</span><span class="token punctuation">,</span>
        TrackEntry         <span class="token operator">:</span> <span class="token number">0xae</span><span class="token punctuation">,</span>
        TrackNumber        <span class="token operator">:</span> <span class="token number">0xd7</span><span class="token punctuation">,</span>
        TrackUID           <span class="token operator">:</span> <span class="token number">0x63c5</span><span class="token punctuation">,</span>
        FlagLacing         <span class="token operator">:</span> <span class="token number">0x9c</span><span class="token punctuation">,</span>
        Language           <span class="token operator">:</span> <span class="token number">0x22b59c</span><span class="token punctuation">,</span>
        CodecID            <span class="token operator">:</span> <span class="token number">0x86</span><span class="token punctuation">,</span>
        CodecName          <span class="token operator">:</span> <span class="token number">0x258688</span><span class="token punctuation">,</span>
        TrackType          <span class="token operator">:</span> <span class="token number">0x83</span><span class="token punctuation">,</span>
        Video              <span class="token operator">:</span> <span class="token number">0xe0</span><span class="token punctuation">,</span>
        PixelWidth         <span class="token operator">:</span> <span class="token number">0xb0</span><span class="token punctuation">,</span>
        PixelHeight        <span class="token operator">:</span> <span class="token number">0xba</span><span class="token punctuation">,</span>
        Cluster            <span class="token operator">:</span> <span class="token number">0x1f43b675</span><span class="token punctuation">,</span>
        Timecode           <span class="token operator">:</span> <span class="token number">0xe7</span><span class="token punctuation">,</span>
        Frame              <span class="token operator">:</span> <span class="token number">0xa3</span><span class="token punctuation">,</span>
        Keyframe           <span class="token operator">:</span> <span class="token number">0x9d012a</span><span class="token punctuation">,</span>
        FrameBlock         <span class="token operator">:</span> <span class="token number">0x81</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> keyframeD64Header <span class="token operator">=</span> <span class="token string">'\x9d\x01\x2a'</span><span class="token punctuation">;</span> <span class="token comment">//VP8 keyframe header 0x9d012a</span>
    <span class="token keyword">const</span> videoDataPos <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// data pos of frame data header</span>
    <span class="token keyword">const</span> defaultDelay <span class="token operator">=</span> dataTypes<span class="token punctuation">.</span><span class="token function">double2Str</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token operator">/</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> header <span class="token operator">=</span> <span class="token punctuation">[</span>  <span class="token comment">// structure of webM header/chunks what ever they are called.</span>
        ids<span class="token punctuation">.</span>videoData<span class="token punctuation">,</span><span class="token punctuation">[</span>
            ids<span class="token punctuation">.</span>Version<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
            ids<span class="token punctuation">.</span>ReadVersion<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
            ids<span class="token punctuation">.</span>MaxIDLength<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span>
            ids<span class="token punctuation">.</span>MaxSizeLength<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span>
            ids<span class="token punctuation">.</span>DocType<span class="token punctuation">,</span> <span class="token string">'webm'</span><span class="token punctuation">,</span>
            ids<span class="token punctuation">.</span>DocTypeVersion<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span>
            ids<span class="token punctuation">.</span>DocTypeReadVersion<span class="token punctuation">,</span> <span class="token number">2</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        ids<span class="token punctuation">.</span>Segment<span class="token punctuation">,</span> <span class="token punctuation">[</span>
            ids<span class="token punctuation">.</span>Info<span class="token punctuation">,</span> <span class="token punctuation">[</span>
                ids<span class="token punctuation">.</span>TimecodeScale<span class="token punctuation">,</span> <span class="token number">1000000</span><span class="token punctuation">,</span>
                ids<span class="token punctuation">.</span>MuxingApp<span class="token punctuation">,</span> <span class="token string">'Groover'</span><span class="token punctuation">,</span>
                ids<span class="token punctuation">.</span>WritingApp<span class="token punctuation">,</span> <span class="token string">'Groover'</span><span class="token punctuation">,</span>
                ids<span class="token punctuation">.</span>Duration<span class="token punctuation">,</span> <span class="token number">0</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            ids<span class="token punctuation">.</span>Tracks<span class="token punctuation">,</span><span class="token punctuation">[</span>
                ids<span class="token punctuation">.</span>TrackEntry<span class="token punctuation">,</span><span class="token punctuation">[</span>
                    ids<span class="token punctuation">.</span>TrackNumber<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
                    ids<span class="token punctuation">.</span>TrackUID<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
                    ids<span class="token punctuation">.</span>FlagLacing<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>     <span class="token comment">// always o</span>
                    ids<span class="token punctuation">.</span>Language<span class="token punctuation">,</span> <span class="token string">'und'</span><span class="token punctuation">,</span>   <span class="token comment">// undefined I think this means</span>
                    ids<span class="token punctuation">.</span>CodecID<span class="token punctuation">,</span> <span class="token string">'V_VP8'</span><span class="token punctuation">,</span>  <span class="token comment">// These I think must not change</span>
                    ids<span class="token punctuation">.</span>CodecName<span class="token punctuation">,</span> <span class="token string">'VP8'</span><span class="token punctuation">,</span>  <span class="token comment">// These I think must not change</span>
                    ids<span class="token punctuation">.</span>TrackType<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
                    ids<span class="token punctuation">.</span>Video<span class="token punctuation">,</span> <span class="token punctuation">[</span>
                        ids<span class="token punctuation">.</span>PixelWidth<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
                        ids<span class="token punctuation">.</span>PixelHeight<span class="token punctuation">,</span> <span class="token number">0</span>
                    <span class="token punctuation">]</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>    
    <span class="token keyword">function</span> <span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        header<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> name<span class="token punctuation">;</span>
        header<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> name<span class="token punctuation">;</span>
        header<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span>  dataTypes<span class="token punctuation">.</span><span class="token function">double2Str</span><span class="token punctuation">(</span>frameDelay<span class="token punctuation">)</span><span class="token punctuation">;</span>
        header<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span>  width<span class="token punctuation">;</span>
        header<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span>  height<span class="token punctuation">;</span>
        <span class="token keyword">function</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token parameter">dat</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">var</span> i<span class="token punctuation">,</span>kv<span class="token punctuation">,</span>data<span class="token punctuation">;</span>
            data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> dat<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                kv <span class="token operator">=</span> <span class="token punctuation">{</span>i <span class="token operator">:</span> dat<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>dat<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    kv<span class="token punctuation">.</span>d <span class="token operator">=</span> <span class="token function">create</span><span class="token punctuation">(</span>dat<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                    kv<span class="token punctuation">.</span>d <span class="token operator">=</span> dat<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                data<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>kv<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> data<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token function">create</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">addCluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        webmData<span class="token punctuation">[</span>videoDataPos<span class="token punctuation">]</span><span class="token punctuation">.</span>d<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> i<span class="token operator">:</span> ids<span class="token punctuation">.</span>Cluster<span class="token punctuation">,</span>d<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> i<span class="token operator">:</span> ids<span class="token punctuation">.</span>Timecode<span class="token punctuation">,</span> d<span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>clusterTimecode<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Fixed bug with Round</span>
        clusterCounter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">addFrame</span><span class="token punctuation">(</span><span class="token parameter">frame</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> <span class="token constant">VP8</span><span class="token punctuation">,</span> kfS<span class="token punctuation">,</span>riff<span class="token punctuation">;</span>
        riff <span class="token operator">=</span> <span class="token function">getWebPChunks</span><span class="token punctuation">(</span><span class="token function">atob</span><span class="token punctuation">(</span>frame<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span>frameMimeType<span class="token punctuation">,</span> quality<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token constant">VP8</span> <span class="token operator">=</span> riff<span class="token punctuation">.</span><span class="token constant">RIFF</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token constant">WEBP</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        kfS <span class="token operator">=</span> <span class="token constant">VP8</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>keyframeD64Header<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">;</span>
        frame <span class="token operator">=</span> <span class="token punctuation">{</span>
            width<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token constant">VP8</span><span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>kfS <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token constant">VP8</span><span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>kfS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x3FFF</span><span class="token punctuation">,</span>
            height<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token constant">VP8</span><span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>kfS <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token constant">VP8</span><span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>kfS <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x3FFF</span><span class="token punctuation">,</span>
            data<span class="token operator">:</span> <span class="token constant">VP8</span><span class="token punctuation">,</span>
            riff<span class="token operator">:</span> riff
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>clusterCounter <span class="token operator">&gt;</span> <span class="token constant">CLUSTER_MAX_DURATION</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">addCluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            
        <span class="token punctuation">}</span>
        webmData<span class="token punctuation">[</span>videoDataPos<span class="token punctuation">]</span><span class="token punctuation">.</span>d<span class="token punctuation">[</span>webmData<span class="token punctuation">[</span>videoDataPos<span class="token punctuation">]</span><span class="token punctuation">.</span>d<span class="token punctuation">.</span>length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>d<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            i<span class="token operator">:</span> ids<span class="token punctuation">.</span>Frame<span class="token punctuation">,</span> 
            d<span class="token operator">:</span> <span class="token constant">S</span><span class="token punctuation">(</span>ids<span class="token punctuation">.</span>FrameBlock<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token constant">S</span><span class="token punctuation">(</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>clusterCounter<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span>  <span class="token constant">S</span><span class="token punctuation">(</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>clusterCounter<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token constant">S</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">+</span> frame<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        clusterCounter <span class="token operator">+=</span> frameDelay<span class="token punctuation">;</span>        
        clusterTimecode <span class="token operator">+=</span> frameDelay<span class="token punctuation">;</span>
        webmData<span class="token punctuation">[</span>videoDataPos<span class="token punctuation">]</span><span class="token punctuation">.</span>d<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>d<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>d <span class="token operator">=</span> dataTypes<span class="token punctuation">.</span><span class="token function">double2Str</span><span class="token punctuation">(</span>clusterTimecode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">startEncoding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        frameNumber <span class="token operator">=</span> clusterCounter <span class="token operator">=</span> clusterTimecode <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        webmData  <span class="token operator">=</span> <span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">addCluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>    
    <span class="token keyword">function</span> <span class="token function">toBlob</span><span class="token punctuation">(</span><span class="token parameter">vidData</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> data<span class="token punctuation">,</span>i<span class="token punctuation">,</span>vData<span class="token punctuation">,</span> len<span class="token punctuation">;</span>
        vData <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> vidData<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            data <span class="token operator">=</span> dataTypes<span class="token punctuation">[</span><span class="token keyword">typeof</span> vidData<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>d<span class="token punctuation">]</span><span class="token punctuation">(</span>vidData<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>
            len  <span class="token operator">=</span> data<span class="token punctuation">.</span>size <span class="token operator">||</span> data<span class="token punctuation">.</span>byteLength <span class="token operator">||</span> data<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
            vData<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>stream<span class="token punctuation">.</span><span class="token function">num</span><span class="token punctuation">(</span>vidData<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            vData<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>stream<span class="token punctuation">.</span><span class="token function">compInt</span><span class="token punctuation">(</span>len<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            vData<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span>vData<span class="token punctuation">,</span> <span class="token punctuation">{</span>type<span class="token operator">:</span> videoMimeType<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">getWebPChunks</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> offset<span class="token punctuation">,</span> chunks<span class="token punctuation">,</span> id<span class="token punctuation">,</span> len<span class="token punctuation">,</span> data<span class="token punctuation">;</span>
        offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        chunks <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>offset <span class="token operator">&lt;</span> str<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            id <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span>offset<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// value will have top bit on (bit 32) so not simply a bitwise operation</span>
            <span class="token comment">// Warning little endian (Will not work on big endian systems)</span>
            len <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint32Array</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
                    str<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>offset <span class="token operator">+</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    str<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>offset <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    str<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>offset <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    str<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>offset <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">)</span>
                <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>buffer<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            id <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span>offset<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            chunks<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> chunks<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">:</span> chunks<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">===</span> <span class="token string">'RIFF'</span> <span class="token operator">||</span> id <span class="token operator">===</span> <span class="token string">'LIST'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                chunks<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">getWebPChunks</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span>offset <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                offset <span class="token operator">+=</span> <span class="token number">8</span> <span class="token operator">+</span> len<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">===</span> <span class="token string">'WEBP'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                chunks<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span>offset <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                chunks<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span>offset <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> chunks<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">Encoder</span><span class="token punctuation">(</span>fps<span class="token punctuation">,</span> _quality <span class="token operator">=</span> <span class="token number">0.8</span><span class="token punctuation">,</span> _name <span class="token operator">=</span> <span class="token string">&quot;Groover&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
        <span class="token keyword">this</span><span class="token punctuation">.</span>fps <span class="token operator">=</span> fps<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>quality <span class="token operator">=</span> quality <span class="token operator">=</span> _quality<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>frameDelay <span class="token operator">=</span> frameDelay <span class="token operator">=</span> <span class="token number">1000</span> <span class="token operator">/</span> fps<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>frame <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">=</span> width <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>timecode <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name <span class="token operator">=</span> _name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Encoder</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">addFrame</span> <span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">frame</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">'canvas'</span> <span class="token keyword">in</span> frame<span class="token punctuation">)</span><span class="token punctuation">{</span>
                frame <span class="token operator">=</span> frame<span class="token punctuation">.</span>canvas<span class="token punctuation">;</span>    
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>width <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">=</span> width <span class="token operator">=</span> frame<span class="token punctuation">.</span>width<span class="token punctuation">,</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">=</span> height <span class="token operator">=</span> frame<span class="token punctuation">.</span>height
                <span class="token function">startEncoding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>width <span class="token operator">!==</span> frame<span class="token punctuation">.</span>width <span class="token operator">||</span> height <span class="token operator">!==</span> frame<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token function">RangeError</span><span class="token punctuation">(</span><span class="token string">&quot;Frame size error. Frames must be the same size.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>            
            <span class="token function">addFrame</span><span class="token punctuation">(</span>frame<span class="token punctuation">)</span><span class="token punctuation">;</span>   
            <span class="token keyword">this</span><span class="token punctuation">.</span>frame <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>timecode <span class="token operator">=</span> clusterTimecode<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>        
        <span class="token function-variable function">toBlob</span> <span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">toBlob</span><span class="token punctuation">(</span>webmData<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        Video<span class="token operator">:</span> Encoder<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre></div><h4 id="remarks"><a href="#remarks" class="header-anchor">#</a> Remarks</h4> <p>This topic is to cover the various media types and how they can be used with the canvas in 2D interface.</p> <p>Media types have generic and format specific categories</p> <p><strong>Media types</strong></p> <ul><li>Animations</li> <li>Videos</li> <li>Images</li> <li>HD images</li> <li>Vector image</li> <li>Animated images</li></ul> <p><strong>Media formats</strong></p> <ul><li>Jpg/Jpeg</li> <li>Png</li> <li>Gif</li> <li>SVG</li> <li>M-JPEG</li> <li>Webm</li> <li>Webp</li></ul> <p><strong>Images</strong></p> <p>There are a wide variety of image formats supported by browsers, though no browser support them all. If you have particular image formats you wish to use <a href="https://en.wikipedia.org/wiki/Comparison_of_web_browsers#Image_format_support" target="_blank" rel="noopener noreferrer">Wiki Browsers and supported image formats<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> provides a good overview.</p> <p>The best support is for the 3 main formats, &quot;jpeg&quot;, &quot;png&quot;, and &quot;gif&quot; with all the major browsers providing support.</p> <p><strong>JPEG</strong></p> <p>JPEG images are best suited to photos and photo like images. They do not lend them selves well to charts, diagrams, and text. JPEG images do not support transparency.</p> <p>Canvas can output JPEG images via <code>canvas.toDataURL</code> and <code>canvas.toBlob</code> and provides a quality setting. As JPEG does not support transparency any transparent pixels will be blended with black for the final output JPG. The resulting image will not be a perfect copy of the canvas.</p> <p><a href="https://en.wikipedia.org/wiki/JPEG" target="_blank" rel="noopener noreferrer">JPEG at wikipedia<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>PNG</strong></p> <p>PNG Image are the highest quality images and can also include an alpha channel for transparent pixels. The image data is compressed but does not produce artifacts like JPG images.</p> <p>Because of the lossless compression and the alpha channel support PNGs are used for games, ui component images, charts, diagrams, text. When using them to for photo and photo like images their file size can be much larger than JPEG's. .</p> <p>The PNG format also provides animation support though browser support is limited, and access to the animation for use on the canvas can only be done via Javascript APIs &amp; libraries</p> <p>THe canvas can be used to encode PNG images via <code>canvas.toDataURL</code> and <code>canvas.toBlob</code> though the output format is limited to compressed 32Bit RGBA. The PNG will provide a pixel perfect copy of the canvas.</p> <p><a href="https://en.wikipedia.org/wiki/Portable_Network_Graphics" target="_blank" rel="noopener noreferrer">PNG at wikipedia<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>GIF</strong></p> <p>GIFs are used for short animations, but can also be used to provide high quality charts, diagrams, and text like images. GIFs have very limited colour support with a maximum of 256 colours per frame. With cleaver image processing gif images can produce surprisingly good results, especially when animated. Gifs also provide transparency though this is limited to on or off</p> <p>AS with PNG, GIF animations are not directly accessible for use on the canvas and you will need a Javascript API or library to get access. GIF can not be saved via the canvas and will require and API or library to do so.</p> <p><a href="https://en.wikipedia.org/wiki/GIF" target="_blank" rel="noopener noreferrer">GIF at wikipedia<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/html/media-types-and-the-canvas.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/html/dragging-path-shapes-images-on-canvas.html" class="prev">
        Dragging Path Shapes &amp; Images on Canvas
      </a></span> <span class="next"><a href="/html/animation.html">
        Animation
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/1280.a9391ab1.js" defer></script>
  </body>
</html>
