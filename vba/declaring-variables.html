<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>VBA - Declaring Variables</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Type Hints, Variables, Constants (Const), Declaring Fixed-Length Strings, Implicit And Explicit Declaration, Access Modifiers, When to use a Static variable">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="VBA - Declaring Variables">
    <meta property="og:description" content="Type Hints, Variables, Constants (Const), Declaring Fixed-Length Strings, Implicit And Explicit Declaration, Access Modifiers, When to use a Static variable">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/vba/declaring-variables.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="VBA - Declaring Variables">
    <meta name="twitter:description" content="Type Hints, Variables, Constants (Const), Declaring Fixed-Length Strings, Implicit And Explicit Declaration, Access Modifiers, When to use a Static variable">
    <meta name="twitter:url" content="/vba/declaring-variables.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    <link rel="preload" href="/assets/css/0.styles.8b877eb8.css" as="style"><link rel="preload" href="/assets/js/app.ced448ab.js" as="script"><link rel="preload" href="/assets/js/3.f1d73125.js" as="script"><link rel="preload" href="/assets/js/3419.de2f7eb0.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.8b877eb8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>VBA</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vba/" class="sidebar-link">Disclaimer</a></li><li><a href="/vba/getting-started-with-vba.html" class="sidebar-link">Getting started with VBA</a></li><li><a href="/vba/comments.html" class="sidebar-link">Comments</a></li><li><a href="/vba/string-literals-escaping-non-printable-characters-and-line-continuations.html" class="sidebar-link">String Literals - Escaping, non-printable characters and line-continuations</a></li><li><a href="/vba/vba-option-keyword.html" class="sidebar-link">VBA Option Keyword</a></li><li><a href="/vba/declaring-variables.html" class="active sidebar-link">Declaring Variables</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vba/declaring-variables.html#type-hints" class="sidebar-link">Type Hints</a></li><li class="sidebar-sub-header"><a href="/vba/declaring-variables.html#variables" class="sidebar-link">Variables</a></li><li class="sidebar-sub-header"><a href="/vba/declaring-variables.html#constants-const" class="sidebar-link">Constants (Const)</a></li><li class="sidebar-sub-header"><a href="/vba/declaring-variables.html#declaring-fixed-length-strings" class="sidebar-link">Declaring Fixed-Length Strings</a></li><li class="sidebar-sub-header"><a href="/vba/declaring-variables.html#implicit-and-explicit-declaration" class="sidebar-link">Implicit And Explicit Declaration</a></li><li class="sidebar-sub-header"><a href="/vba/declaring-variables.html#access-modifiers" class="sidebar-link">Access Modifiers</a></li><li class="sidebar-sub-header"><a href="/vba/declaring-variables.html#when-to-use-a-static-variable" class="sidebar-link">When to use a Static variable</a></li></ul></li><li><a href="/vba/declaring-and-assigning-strings.html" class="sidebar-link">Declaring and assigning strings</a></li><li><a href="/vba/concatenating-strings.html" class="sidebar-link">Concatenating strings</a></li><li><a href="/vba/frequently-used-string-manipulation.html" class="sidebar-link">Frequently used string manipulation</a></li><li><a href="/vba/substrings.html" class="sidebar-link">Substrings</a></li><li><a href="/vba/searching-within-strings-for-the-presence-of-substrings.html" class="sidebar-link">Searching within strings for the presence of substrings</a></li><li><a href="/vba/assigning-strings-with-repeated-characters.html" class="sidebar-link">Assigning strings with repeated characters</a></li><li><a href="/vba/measuring-the-length-of-strings.html" class="sidebar-link">Measuring the length of strings</a></li><li><a href="/vba/converting-other-types-to-strings.html" class="sidebar-link">Converting other types to strings</a></li><li><a href="/vba/date-time-manipulation.html" class="sidebar-link">Date Time Manipulation</a></li><li><a href="/vba/data-types-and-limits.html" class="sidebar-link">Data Types and Limits</a></li><li><a href="/vba/naming-conventions.html" class="sidebar-link">Naming Conventions</a></li><li><a href="/vba/data-structures.html" class="sidebar-link">Data Structures</a></li><li><a href="/vba/arrays.html" class="sidebar-link">Arrays</a></li><li><a href="/vba/copying-returning-and-passing-arrays.html" class="sidebar-link">Copying, returning and passing arrays</a></li><li><a href="/vba/collections.html" class="sidebar-link">Collections</a></li><li><a href="/vba/operators.html" class="sidebar-link">Operators</a></li><li><a href="/vba/sorting.html" class="sidebar-link">Sorting</a></li><li><a href="/vba/flow-control-structures.html" class="sidebar-link">Flow control structures</a></li><li><a href="/vba/passing-arguments-byref-or-byval.html" class="sidebar-link">Passing Arguments ByRef or ByVal</a></li><li><a href="/vba/scripting-filesystemobject.html" class="sidebar-link">Scripting.FileSystemObject</a></li><li><a href="/vba/working-with-files-and-directories-without-using-filesystemobject.html" class="sidebar-link">Working With Files and Directories Without Using FileSystemObject</a></li><li><a href="/vba/reading-2gb-files-in-binary-in-vba-and-file-hashes.html" class="sidebar-link">Reading 2GB+ files in binary in VBA and File Hashes</a></li><li><a href="/vba/creating-a-procedure.html" class="sidebar-link">Creating a procedure</a></li><li><a href="/vba/procedure-calls.html" class="sidebar-link">Procedure Calls</a></li><li><a href="/vba/conditional-compilation.html" class="sidebar-link">Conditional Compilation</a></li><li><a href="/vba/object-oriented-vba.html" class="sidebar-link">Object-Oriented VBA</a></li><li><a href="/vba/creating-a-custom-class.html" class="sidebar-link">Creating a Custom Class</a></li><li><a href="/vba/interfaces.html" class="sidebar-link">Interfaces</a></li><li><a href="/vba/recursion.html" class="sidebar-link">Recursion</a></li><li><a href="/vba/events.html" class="sidebar-link">Events</a></li><li><a href="/vba/scripting-dictionary-object.html" class="sidebar-link">Scripting.Dictionary object</a></li><li><a href="/vba/working-with-ado.html" class="sidebar-link">Working with ADO</a></li><li><a href="/vba/attributes.html" class="sidebar-link">Attributes</a></li><li><a href="/vba/user-forms.html" class="sidebar-link">User Forms</a></li><li><a href="/vba/createobject-vs-getobject.html" class="sidebar-link">CreateObject vs. GetObject</a></li><li><a href="/vba/non-latin-characters.html" class="sidebar-link">Non-Latin Characters</a></li><li><a href="/vba/api-calls.html" class="sidebar-link">API Calls</a></li><li><a href="/vba/automation-or-using-other-applications-libraries.html" class="sidebar-link">Automation or Using other applications Libraries</a></li><li><a href="/vba/macro-security-and-signing-of-vba-projects-modules.html" class="sidebar-link">Macro security and signing of VBA-projects/-modules</a></li><li><a href="/vba/vba-run-time-errors.html" class="sidebar-link">VBA Run-Time Errors</a></li><li><a href="/vba/error-handling.html" class="sidebar-link">Error Handling</a></li><li><a href="/vba/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="declaring-variables"><a href="#declaring-variables" class="header-anchor">#</a> Declaring Variables</h1> <h2 id="type-hints"><a href="#type-hints" class="header-anchor">#</a> Type Hints</h2> <p>Type Hints are <strong>heavily</strong> discouraged. They exist and are documented here for historical and backward-compatibility reasons. You should use the <code>As [DataType]</code> syntax instead.</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Public</span> <span class="token keyword">Sub</span> ExampleDeclaration<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">Dim</span> someInteger<span class="token operator">%</span> <span class="token comment">'% Equivalent to &quot;As Integer&quot;</span>
        <span class="token keyword">Dim</span> someLong<span class="token operator">&amp;</span>    <span class="token comment">'&amp; Equivalent to &quot;As Long&quot;</span>
        <span class="token keyword">Dim</span> someDecimal<span class="token operator">@</span> <span class="token comment">'@ Equivalent to &quot;As Currency&quot;</span>
        <span class="token keyword">Dim</span> someSingle<span class="token operator">!</span>  <span class="token comment">'! Equivalent to &quot;As Single&quot;</span>
        <span class="token keyword">Dim</span> someDouble<span class="token operator">#</span>  <span class="token comment">'# Equivalent to &quot;As Double&quot;</span>
        <span class="token keyword">Dim</span> someString<span class="token operator">$</span>  <span class="token comment">'$ Equivalent to &quot;As String&quot;</span>

        <span class="token keyword">Dim</span> someLongLong<span class="token operator">^</span>  <span class="token comment">'^ Equivalent to &quot;As LongLong&quot; in 64-bit VBA hosts</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>

</code></pre></div><p>Type hints significantly decrease code readability and encourage a legacy <a href="https://en.wikipedia.org/wiki/Hungarian_notation" target="_blank" rel="noopener noreferrer">Hungarian Notation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> which <strong>also</strong> hinders readability:</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Dim</span> strFile<span class="token operator">$</span>
<span class="token keyword">Dim</span> iFile<span class="token operator">%</span>

</code></pre></div><p>Instead, declare variables closer to their usage and name things for what they're used, not after their type:</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Dim</span> path <span class="token keyword">As</span> <span class="token keyword">String</span>
<span class="token keyword">Dim</span> handle <span class="token keyword">As</span> <span class="token keyword">Integer</span>

</code></pre></div><p>Type hints can also be used on literals, to enforce a specific type. By default, a numeric literal smaller than 32,768 will be interpreted as an <code>Integer</code> literal, but with a type hint you can control that:</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Dim</span> foo <span class="token comment">'implicit Variant</span>
foo <span class="token operator">=</span> <span class="token number">42</span><span class="token operator">&amp;</span> <span class="token comment">' foo is now a Long</span>
foo <span class="token operator">=</span> <span class="token number">42</span><span class="token operator">#</span> <span class="token comment">' foo is now a Double</span>
Debug<span class="token punctuation">.</span>Print TypeName<span class="token punctuation">(</span><span class="token number">42</span><span class="token operator">!</span><span class="token punctuation">)</span> <span class="token comment">' prints &quot;Single&quot;</span>

</code></pre></div><p>Type hints are usually not needed on literals, because they would be assigned to a variable declared with an explicit type, or implicitly converted to the appropriate type when passed as parameters. Implicit conversions can be avoided using one of the explicit type conversion functions:</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token comment">'Calls procedure DoSomething and passes a literal 42 as a Long using a type hint</span>
DoSomething <span class="token number">42</span><span class="token operator">&amp;</span>

<span class="token comment">'Calls procedure DoSomething and passes a literal 42 explicitly converted to a Long</span>
DoSomething <span class="token keyword">CLng</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>

</code></pre></div><h3 id="string-returning-built-in-functions"><a href="#string-returning-built-in-functions" class="header-anchor">#</a> String-returning built-in functions</h3> <p>The majority of the built-in functions that handle strings come in two versions: A loosely typed version that returns a <code>Variant</code>, and a strongly typed version (ending with <code>$</code>) that returns a <code>String</code>. Unless you are assigning the return value to a <code>Variant</code>, you should prefer the version that returns a <code>String</code> - otherwise there is an implicit conversion of the return value.</p> <div class="language-vb extra-class"><pre class="language-vb"><code>Debug<span class="token punctuation">.</span>Print Left<span class="token punctuation">(</span>foo<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment">'Left returns a Variant</span>
Debug<span class="token punctuation">.</span>Print Left<span class="token operator">$</span><span class="token punctuation">(</span>foo<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">'Left$ returns a String</span>

</code></pre></div><p>These functions are:</p> <ul><li>VBA.Conversion.Error -&gt; VBA.Conversion.Error$</li> <li>VBA.Conversion.Hex -&gt; VBA.Conversion.Hex$</li> <li>VBA.Conversion.Oct -&gt; VBA.Conversion.Oct$</li> <li>VBA.Conversion.Str -&gt; VBA.Conversion.Str$</li> <li>VBA.FileSystem.CurDir -&gt; VBA.FileSystem.CurDir$</li> <li>VBA.[_HiddenModule].Input -&gt; VBA.[_HiddenModule].Input$</li> <li>VBA.[_HiddenModule].InputB -&gt; VBA.[_HiddenModule].InputB$</li> <li>VBA.Interaction.Command -&gt; VBA.Interaction.Command$</li> <li>VBA.Interaction.Environ -&gt; VBA.Interaction.Environ$</li> <li>VBA.Strings.Chr -&gt; VBA.Strings.Chr$</li> <li>VBA.Strings.ChrB -&gt; VBA.Strings.ChrB$</li> <li>VBA.Strings.ChrW -&gt; VBA.Strings.ChrW$</li> <li>VBA.Strings.Format -&gt; VBA.Strings.Format$</li> <li>VBA.Strings.LCase -&gt; VBA.Strings.LCase$</li> <li>VBA.Strings.Left -&gt; VBA.Strings.Left$</li> <li>VBA.Strings.LeftB -&gt; VBA.Strings.LeftB$</li> <li>VBA.Strings.LTtrim -&gt; VBA.Strings.LTrim$</li> <li>VBA.Strings.Mid -&gt; VBA.Strings.Mid$</li> <li>VBA.Strings.MidB -&gt; VBA.Strings.MidB$</li> <li>VBA.Strings.Right -&gt; VBA.Strings.Right$</li> <li>VBA.Strings.RightB -&gt; VBA.Strings.RightB$</li> <li>VBA.Strings.RTrim -&gt; VBA.Strings.RTrim$</li> <li>VBA.Strings.Space -&gt; VBA.Strings.Space$</li> <li>VBA.Strings.Str -&gt; VBA.Strings.Str$</li> <li>VBA.Strings.String -&gt; VBA.Strings.String$</li> <li>VBA.Strings.Trim -&gt; VBA.Strings.Trim$</li> <li>VBA.Strings.UCase -&gt; VBA.Strings.UCase$</li></ul> <p>Note that these are function <strong>aliases</strong>, not quite <strong>type hints</strong>. The <code>Left</code> function corresponds to the hidden <code>B_Var_Left</code> function, while the <code>Left$</code> version corresponds to the hidden <code>B_Str_Left</code> function.</p> <p>In very early versions of VBA the <code>$</code> sign isn't an allowed character and the function name had to be enclosed in square brackets. In Word Basic, there were many, many more functions that returned strings that ended in $.</p> <h2 id="variables"><a href="#variables" class="header-anchor">#</a> Variables</h2> <h3 id="scope"><a href="#scope" class="header-anchor">#</a> Scope</h3> <p>A variable can be declared (in increasing visibility level):</p> <ul><li>At procedure level, using the <code>Dim</code> keyword in any procedure; a <strong>local variable</strong>.</li> <li>At module level, using the <code>Private</code> keyword in any type of module; a <strong>private field</strong>.</li> <li>At instance level, using the <code>Friend</code> keyword in any type of class module; a <strong>friend field</strong>.</li> <li>At instance level, using the <code>Public</code> keyword in any type of class module; a <strong>public field</strong>.</li> <li>Globally, using the <code>Public</code> keyword in a <strong>standard module</strong>; a <strong>global variable</strong>.</li></ul> <p>Variables should always be declared with the smallest possible scope: prefer passing parameters to procedures, rather than declaring global variables.</p> <p>See <a href="http://stackoverflow.com/documentation/vba/877/declaring-variables/2959/access-modifiers" target="_blank" rel="noopener noreferrer">Access Modifiers<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for more information.</p> <h3 id="local-variables"><a href="#local-variables" class="header-anchor">#</a> Local variables</h3> <p>Use the <code>Dim</code> keyword to declare a <strong>local variable</strong>:</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Dim</span> identifierName [<span class="token keyword">As</span> Type][<span class="token punctuation">,</span> identifierName [<span class="token keyword">As</span> Type]<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>]

</code></pre></div><p>The <code>[As Type]</code> part of the declaration syntax is optional. When specified, it sets the variable's data type, which determines how much memory will be allocated to that variable. This declares a <code>String</code> variable:</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Dim</span> identifierName <span class="token keyword">As</span> <span class="token keyword">String</span>

</code></pre></div><p>When a type is not specified, the type is implicitly <code>Variant</code>:</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Dim</span> identifierName <span class="token comment">'As Variant is implicit</span>

</code></pre></div><p>The VBA syntax also supports declaring multiple variables in a single statement:</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Dim</span> someString <span class="token keyword">As</span> <span class="token keyword">String</span><span class="token punctuation">,</span> someVariant<span class="token punctuation">,</span> someValue <span class="token keyword">As</span> <span class="token keyword">Long</span>

</code></pre></div><p>Notice that the <code>[As Type]</code> has to be specified for each variable (other than 'Variant' ones). This is a relatively common trap:</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Dim</span> integer1<span class="token punctuation">,</span> integer2<span class="token punctuation">,</span> integer3 <span class="token keyword">As</span> <span class="token keyword">Integer</span> <span class="token comment">'Only integer3 is an Integer. </span>
                                            <span class="token comment">'The rest are Variant.</span>

</code></pre></div><h3 id="static-variables"><a href="#static-variables" class="header-anchor">#</a> Static variables</h3> <p>Local variables can also be <code>Static</code>. In VBA the <code>Static</code> keyword is used to make a variable &quot;remember&quot; the value it had, last time a procedure was called:</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Private</span> <span class="token keyword">Sub</span> DoSomething<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">Static</span> values <span class="token keyword">As</span> Collection
    <span class="token keyword">If</span> values <span class="token keyword">Is</span> <span class="token boolean">Nothing</span> <span class="token keyword">Then</span>
        <span class="token keyword">Set</span> values <span class="token operator">=</span> <span class="token keyword">New</span> Collection
        values<span class="token punctuation">.</span>Add <span class="token string">&quot;foo&quot;</span>
        values<span class="token punctuation">.</span>Add <span class="token string">&quot;bar&quot;</span>
    <span class="token keyword">End</span> <span class="token keyword">If</span>
    DoSomethingElse values
<span class="token keyword">End</span> <span class="token keyword">Sub</span>

</code></pre></div><p>Here the <code>values</code> collection is declared as a <code>Static</code> local; because it's an <strong>object variable</strong>, it is initialized to <code>Nothing</code>. The condition that follows the declaration verifies if the object reference was <code>Set</code> before - if it's the first time the procedure runs, the collection gets initialized. <code>DoSomethingElse</code> might be adding or removing items, and they'll still be in the collection next time <code>DoSomething</code> is called.</p> <p><strong>Alternative</strong></p> <blockquote></blockquote> <p>VBA's <code>Static</code> keyword can easily be misunderstood - <strong>especially</strong> by seasoned programmers that usually work in other languages. In many languages, <code>static</code> is used to make a class member (field, property, method, ...) belong to the <strong>type</strong> rather than to the <strong>instance</strong>. Code in <code>static</code> context cannot reference code in <strong>instance</strong> context. The VBA <code>Static</code> keyword means something wildly different.</p> <p>Often, a <code>Static</code> local could just as well be implemented as a <code>Private</code>, module-level variable (field) - however this challenges the principle by which a variable should be declared with the smallest possible scope; trust your instincts, use whichever you prefer - both will work... but using <code>Static</code> without understanding what it does could lead to interesting bugs.</p> <p><strong>Dim vs. Private</strong></p> <p>The <code>Dim</code> keyword is legal at procedure and module levels; its usage at module level is equivalent to using the <code>Private</code> keyword:</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Option</span> Explicit
<span class="token keyword">Dim</span> privateField1 <span class="token keyword">As</span> <span class="token keyword">Long</span> <span class="token comment">'same as Private privateField2 as Long</span>
<span class="token keyword">Private</span> privateField2 <span class="token keyword">As</span> <span class="token keyword">Long</span> <span class="token comment">'same as Dim privateField2 as Long</span>

</code></pre></div><p>The <code>Private</code> keyword is only legal at module level; this invites reserving <code>Dim</code> for local variables and declaring module variables with <code>Private</code>, especially with the contrasting <code>Public</code> keyword that would have to be used anyway to declare a public member. Alternatively use <code>Dim</code> <strong>everywhere</strong> - what matters is <strong>consistency</strong>:</p> <p>&quot;Private fields&quot;</p> <ul><li><strong>DO</strong> use <code>Private</code> to declare a module-level variable.</li> <li><strong>DO</strong> use <code>Dim</code> to declare a local variable.</li> <li><strong>DO NOT</strong> use <code>Dim</code> to declare a module-level variable.</li></ul> <p>&quot;Dim everywhere&quot;</p> <ul><li><strong>DO</strong> use <code>Dim</code> to declare anything private/local.</li> <li><strong>DO NOT</strong> use <code>Private</code> to declare a module-level variable.</li> <li><strong>AVOID</strong> declaring <code>Public</code> fields.*</li></ul> <p><sub>*In general, one should avoid declaring <code>Public</code> or <code>Global</code> fields anyway.</sub></p> <h3 id="fields"><a href="#fields" class="header-anchor">#</a> Fields</h3> <p>A variable declared at module level, in the <strong>declarations section</strong> at the top of the module body, is a <strong>field</strong>. A <code>Public</code> field declared in a <strong>standard module</strong> is a <strong>global variable</strong>:</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Public</span> PublicField <span class="token keyword">As</span> <span class="token keyword">Long</span>

</code></pre></div><p>A variable with a global scope can be accessed from anywhere, including other VBA projects that would reference the project it's declared in.</p> <p>To make a variable global/public, but only visible from within the project, use the <code>Friend</code> modifier:</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Friend</span> FriendField <span class="token keyword">As</span> <span class="token keyword">Long</span>

</code></pre></div><p>This is especially useful in add-ins, where the intent is that other VBA projects reference the add-in project and can consume the public API.</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Friend</span> FriendField <span class="token keyword">As</span> <span class="token keyword">Long</span> <span class="token comment">'public within the project, aka for &quot;friend&quot; code</span>
<span class="token keyword">Public</span> PublicField <span class="token keyword">As</span> <span class="token keyword">Long</span> <span class="token comment">'public within and beyond the project</span>

</code></pre></div><p>Friend fields are not available in standard modules.</p> <h3 id="instance-fields"><a href="#instance-fields" class="header-anchor">#</a> Instance Fields</h3> <p>A variable declared at module level, in the <strong>declarations section</strong> at the top of the body of a class module (including <code>ThisWorkbook</code>, <code>ThisDocument</code>, <code>Worksheet</code>, <code>UserForm</code> and <strong>class modules</strong>), is an <strong>instance field</strong>: it only exists as long as there's an <strong>instance</strong> of the class around.</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token comment">'&gt; Class1</span>
<span class="token keyword">Option</span> Explicit
<span class="token keyword">Public</span> PublicField <span class="token keyword">As</span> <span class="token keyword">Long</span>

</code></pre></div><div class="language-vb extra-class"><pre class="language-vb"><code><span class="token comment">'&gt; Module1</span>
<span class="token keyword">Option</span> Explicit
<span class="token keyword">Public</span> <span class="token keyword">Sub</span> DoSomething<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">'Class1.PublicField means nothing here</span>
    <span class="token keyword">With</span> <span class="token keyword">New</span> Class1
        <span class="token punctuation">.</span>PublicField <span class="token operator">=</span> <span class="token number">42</span>
    <span class="token keyword">End</span> <span class="token keyword">With</span>
    <span class="token comment">'Class1.PublicField means nothing here</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>

</code></pre></div><h3 id="encapsulating-fields"><a href="#encapsulating-fields" class="header-anchor">#</a> Encapsulating fields</h3> <p>Instance data is often kept <code>Private</code>, and dubbed <strong>encapsulated</strong>. A private field can be exposed using a <code>Property</code> procedure. To expose a private variable publicly without giving write access to the caller, a class module (or a standard module) implements a <code>Property Get</code> member:</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Option</span> Explicit
<span class="token keyword">Private</span> encapsulated <span class="token keyword">As</span> <span class="token keyword">Long</span>

<span class="token keyword">Public</span> <span class="token keyword">Property</span> <span class="token keyword">Get</span> SomeValue<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Long</span>
    SomeValue <span class="token operator">=</span> encapsulated
<span class="token keyword">End</span> <span class="token keyword">Property</span>

<span class="token keyword">Public</span> <span class="token keyword">Sub</span> DoSomething<span class="token punctuation">(</span><span class="token punctuation">)</span>
    encapsulated <span class="token operator">=</span> <span class="token number">42</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>

</code></pre></div><p>The class itself can modify the encapsulated value, but the calling code can only access the <code>Public</code> members (and <code>Friend</code> members, if the caller is in the same project).</p> <p>To allow the caller to modify:</p> <ul><li>An encapsulated <strong>value</strong>, a module exposes a <code>Property Let</code> member.</li> <li>An encapsulated <strong>object reference</strong>, a module exposes a <code>Property Set</code> member.</li></ul> <h2 id="constants-const"><a href="#constants-const" class="header-anchor">#</a> Constants (Const)</h2> <p>If you have a value that never changes in your application, you can define a named constant and use it in place of a literal value.</p> <p>You can use Const only at module or procedure level. This means the declaration context for a variable must be a class, structure, module, procedure, or block, and cannot be a source file, namespace, or interface.</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Public</span> <span class="token keyword">Const</span> GLOBAL_CONSTANT <span class="token keyword">As</span> <span class="token keyword">String</span> <span class="token operator">=</span> <span class="token string">&quot;Project Version #1.000.000.001&quot;</span>
<span class="token keyword">Private</span> <span class="token keyword">Const</span> MODULE_CONSTANT <span class="token keyword">As</span> <span class="token keyword">String</span> <span class="token operator">=</span> <span class="token string">&quot;Something relevant to this Module&quot;</span>

<span class="token keyword">Public</span> <span class="token keyword">Sub</span> ExampleDeclaration<span class="token punctuation">(</span><span class="token punctuation">)</span>    

    <span class="token keyword">Const</span> SOME_CONSTANT <span class="token keyword">As</span> <span class="token keyword">String</span> <span class="token operator">=</span> <span class="token string">&quot;Hello World&quot;</span>
    
    <span class="token keyword">Const</span> PI <span class="token keyword">As</span> <span class="token keyword">Double</span> <span class="token operator">=</span> <span class="token number">3.141592653</span>

<span class="token keyword">End</span> <span class="token keyword">Sub</span>

</code></pre></div><p>Whilst it can be considered good practice to specify Constant types, it isn't strictly required. Not specifying the type will still result in the correct type:</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Public</span> <span class="token keyword">Const</span> GLOBAL_CONSTANT <span class="token operator">=</span> <span class="token string">&quot;Project Version #1.000.000.001&quot;</span> <span class="token comment">'Still a string</span>
<span class="token keyword">Public</span> <span class="token keyword">Sub</span> ExampleDeclaration<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">Const</span> SOME_CONSTANT <span class="token operator">=</span> <span class="token string">&quot;Hello World&quot;</span>           <span class="token comment">'Still a string</span>
    <span class="token keyword">Const</span> DERIVED_CONSTANT <span class="token operator">=</span> SOME_CONSTANT        <span class="token comment">'DERIVED_CONSTANT is also a string</span>
    <span class="token keyword">Const</span> VAR_CONSTANT <span class="token keyword">As</span> <span class="token keyword">Variant</span> <span class="token operator">=</span> SOME_CONSTANT <span class="token comment">'VAR_CONSTANT is Variant/String</span>
    
    <span class="token keyword">Const</span> PI <span class="token operator">=</span> <span class="token number">3.141592653</span>        <span class="token comment">'Still a double</span>
    <span class="token keyword">Const</span> DERIVED_PI <span class="token operator">=</span> PI         <span class="token comment">'DERIVED_PI is also a double</span>
    <span class="token keyword">Const</span> VAR_PI <span class="token keyword">As</span> <span class="token keyword">Variant</span> <span class="token operator">=</span> PI  <span class="token comment">'VAR_PI is Variant/Double</span>
    
<span class="token keyword">End</span> <span class="token keyword">Sub</span>

</code></pre></div><p>Note that this is specific to Constants and in contrast to variables where not specifying the type results in a Variant type.</p> <p>While it is possible to explicitly declare a constant as a String, it is not possible to declare a constant as a string using fixed-width string syntax</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token comment">'This is a valid 5 character string constant</span>
<span class="token keyword">Const</span> FOO <span class="token keyword">As</span> <span class="token keyword">String</span> <span class="token operator">=</span> <span class="token string">&quot;ABCDE&quot;</span>

<span class="token comment">'This is not valid syntax for a 5 character string constant</span>
<span class="token keyword">Const</span> FOO <span class="token keyword">As</span> <span class="token keyword">String</span> <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">=</span> <span class="token string">&quot;ABCDE&quot;</span>

</code></pre></div><h2 id="declaring-fixed-length-strings"><a href="#declaring-fixed-length-strings" class="header-anchor">#</a> Declaring Fixed-Length Strings</h2> <p>In VBA, Strings can be declared with a specific length; they are automatically padded or truncated to maintain that length as declared.</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Public</span> <span class="token keyword">Sub</span> TwoTypesOfStrings<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">Dim</span> FixedLengthString <span class="token keyword">As</span> <span class="token keyword">String</span> <span class="token operator">*</span> <span class="token number">5</span> <span class="token comment">' declares a string of 5 characters</span>
    <span class="token keyword">Dim</span> NormalString <span class="token keyword">As</span> <span class="token keyword">String</span>

    Debug<span class="token punctuation">.</span>Print FixedLengthString       <span class="token comment">' Prints &quot;     &quot;</span>
    Debug<span class="token punctuation">.</span>Print NormalString            <span class="token comment">' Prints &quot;&quot;</span>

    FixedLengthString <span class="token operator">=</span> <span class="token string">&quot;123&quot;</span>           <span class="token comment">' FixedLengthString now equals &quot;123  &quot;</span>
    NormalString <span class="token operator">=</span> <span class="token string">&quot;456&quot;</span>                <span class="token comment">' NormalString now equals &quot;456&quot;</span>

    FixedLengthString <span class="token operator">=</span> <span class="token string">&quot;123456&quot;</span>        <span class="token comment">' FixedLengthString now equals &quot;12345&quot;</span>
    NormalString <span class="token operator">=</span> <span class="token string">&quot;456789&quot;</span>             <span class="token comment">' NormalString now equals &quot;456789&quot;</span>

<span class="token keyword">End</span> <span class="token keyword">Sub</span>

</code></pre></div><h2 id="implicit-and-explicit-declaration"><a href="#implicit-and-explicit-declaration" class="header-anchor">#</a> Implicit And Explicit Declaration</h2> <p>If a code module does not contain <code>Option Explicit</code> at the top of the module, then the compiler will automatically (that is, &quot;implicitly&quot;) create variables for you when you use them. They will default to variable type <code>Variant</code>.</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Public</span> <span class="token keyword">Sub</span> ExampleDeclaration<span class="token punctuation">(</span><span class="token punctuation">)</span>    

    someVariable <span class="token operator">=</span> <span class="token number">10</span>                  <span class="token comment">' </span>
    someOtherVariable <span class="token operator">=</span> <span class="token string">&quot;Hello World&quot;</span>
    <span class="token comment">'Both of these variables are of the Variant type.</span>

<span class="token keyword">End</span> <span class="token keyword">Sub</span>

</code></pre></div><p>In the above code, if <code>Option Explicit</code> is specified, the code will interrupt because it is missing the required <code>Dim</code> statements for <code>someVariable</code> and <code>someOtherVariable</code>.</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Option</span> Explicit

<span class="token keyword">Public</span> <span class="token keyword">Sub</span> ExampleDeclaration<span class="token punctuation">(</span><span class="token punctuation">)</span>   

    <span class="token keyword">Dim</span> someVariable <span class="token keyword">As</span> <span class="token keyword">Long</span> 
    someVariable <span class="token operator">=</span> <span class="token number">10</span>

    <span class="token keyword">Dim</span> someOtherVariable <span class="token keyword">As</span> <span class="token keyword">String</span>
    someOtherVariable <span class="token operator">=</span> <span class="token string">&quot;Hello World&quot;</span>

<span class="token keyword">End</span> <span class="token keyword">Sub</span>

</code></pre></div><p>It is considered best practice to use Option Explicit in code modules, to ensure that you declare all variables.</p> <p>See <a href="http://stackoverflow.com/documentation/excel-vba/1107/vba-best-practices#t=201608100743250636318" target="_blank" rel="noopener noreferrer">VBA Best Practices<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> how to set this option by default.</p> <h2 id="access-modifiers"><a href="#access-modifiers" class="header-anchor">#</a> Access Modifiers</h2> <p>The <code>Dim</code> statement should be reserved for local variables. At module-level, prefer explicit access modifiers:</p> <ul><li><code>Private</code> for private fields, which can only be accessed within the module they're declared in.</li> <li><code>Public</code> for public fields and global variables, which can be accessed by any calling code.</li> <li><code>Friend</code> for variables public within the project, but inaccessible to other referencing VBA projects (relevant for add-ins)</li> <li><code>Global</code> can also be used for <code>Public</code> fields in standard modules, but is illegal in class modules and is obsolete anyway - prefer the <code>Public</code> modifier instead. This modifier isn't legal for procedures either.</li></ul> <p>Access modifiers are applicable to variables and procedures alike.</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Private</span> ModuleVariable <span class="token keyword">As</span> <span class="token keyword">String</span>
<span class="token keyword">Public</span> GlobalVariable <span class="token keyword">As</span> <span class="token keyword">String</span>

<span class="token keyword">Private</span> <span class="token keyword">Sub</span> ModuleProcedure<span class="token punctuation">(</span><span class="token punctuation">)</span>

    ModuleVariable <span class="token operator">=</span> <span class="token string">&quot;This can only be done from within the same Module&quot;</span>

<span class="token keyword">End</span> <span class="token keyword">Sub</span>

<span class="token keyword">Public</span> <span class="token keyword">Sub</span> GlobalProcedure<span class="token punctuation">(</span><span class="token punctuation">)</span>

    GlobalVariable <span class="token operator">=</span> <span class="token string">&quot;This can be done from any Module within this Project&quot;</span>

<span class="token keyword">End</span> <span class="token keyword">Sub</span>

</code></pre></div><h3 id="option-private-module"><a href="#option-private-module" class="header-anchor">#</a> Option Private Module</h3> <p>Public parameterless <code>Sub</code> procedures in standard modules are exposed as macros and can be attached to controls and keyboard shortcuts in the host document.</p> <p>Conversely, public <code>Function</code> procedures in standard modules are exposed as user-defined functions (UDF's) in the host application.</p> <p>Specifying <code>Option Private Module</code> at the top of a standard module prevents its members from being exposed as macros and UDF's to the host application.</p> <h2 id="when-to-use-a-static-variable"><a href="#when-to-use-a-static-variable" class="header-anchor">#</a> When to use a Static variable</h2> <p>A Static variable declared locally is not destructed and does not lose its value when the Sub procedure is exited. Subsequent calls to the procedure do not require re-initialization or assignment although you may want to 'zero' any remembered value(s).</p> <p>These are particularly useful when late binding an object in a 'helper' sub that is called repeatedly.</p> <p><strong>Snippet 1:</strong> Reuse a <a href="http://stackoverflow.com/documentation/vba/3667/scripting-dictionary-object" target="_blank" rel="noopener noreferrer">Scripting.Dictionary object<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> across many worksheets</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Option</span> Explicit

<span class="token keyword">Sub</span> main<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">Dim</span> w <span class="token keyword">As</span> <span class="token keyword">Long</span>
    
    <span class="token keyword">For</span> w <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">To</span> Worksheets<span class="token punctuation">.</span>Count
        processDictionary ws<span class="token punctuation">:</span><span class="token operator">=</span>Worksheets<span class="token punctuation">(</span>w<span class="token punctuation">)</span>
    <span class="token keyword">Next</span> w
<span class="token keyword">End</span> <span class="token keyword">Sub</span>

<span class="token keyword">Sub</span> processDictionary<span class="token punctuation">(</span>ws <span class="token keyword">As</span> Worksheet<span class="token punctuation">)</span>
    <span class="token keyword">Dim</span> i <span class="token keyword">As</span> <span class="token keyword">Long</span><span class="token punctuation">,</span> rng <span class="token keyword">As</span> Range
    <span class="token keyword">Static</span> dict <span class="token keyword">As</span> <span class="token keyword">Object</span>
    
    <span class="token keyword">If</span> dict <span class="token keyword">Is</span> <span class="token boolean">Nothing</span> <span class="token keyword">Then</span>
        <span class="token comment">'initialize and set the dictionary object</span>
        <span class="token keyword">Set</span> dict <span class="token operator">=</span> CreateObject<span class="token punctuation">(</span><span class="token string">&quot;Scripting.Dictionary&quot;</span><span class="token punctuation">)</span>
        dict<span class="token punctuation">.</span>CompareMode <span class="token operator">=</span> vbTextCompare
    <span class="token keyword">Else</span>
        <span class="token comment">'remove all pre-existing dictionary entries</span>
        <span class="token comment">' this may or may not be desired if a single dictionary of entries</span>
        <span class="token comment">' from all worksheets is preferred</span>
        dict<span class="token punctuation">.</span>RemoveAll
    <span class="token keyword">End</span> <span class="token keyword">If</span>
    
    <span class="token keyword">With</span> ws
        
        <span class="token comment">'work with a fresh dictionary object for each worksheet</span>
        <span class="token comment">' without constructing/destructing a new object each time</span>
        <span class="token comment">' or do not clear the dictionary upon subsequent uses and </span>
        <span class="token comment">' build a dictionary containing entries from all worksheets</span>
    
    <span class="token keyword">End</span> <span class="token keyword">With</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>

</code></pre></div><p><strong>Snippet 2:</strong> Create a worksheet UDF that late binds the VBScript.RegExp object</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Option</span> Explicit

<span class="token keyword">Function</span> numbersOnly<span class="token punctuation">(</span>str <span class="token keyword">As</span> <span class="token keyword">String</span><span class="token punctuation">,</span> <span class="token operator">_</span>
                     <span class="token keyword">Optional</span> delim <span class="token keyword">As</span> <span class="token keyword">String</span> <span class="token operator">=</span> <span class="token string">&quot;, &quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">Dim</span> n <span class="token keyword">As</span> <span class="token keyword">Long</span><span class="token punctuation">,</span> nums<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Variant</span>
    <span class="token keyword">Static</span> rgx <span class="token keyword">As</span> <span class="token keyword">Object</span><span class="token punctuation">,</span> cmat <span class="token keyword">As</span> <span class="token keyword">Object</span>

    <span class="token comment">'with rgx as static, it only has to be created once</span>
    <span class="token comment">'this is beneficial when filling a long column with this UDF</span>
    <span class="token keyword">If</span> rgx <span class="token keyword">Is</span> <span class="token boolean">Nothing</span> <span class="token keyword">Then</span>
        <span class="token keyword">Set</span> rgx <span class="token operator">=</span> CreateObject<span class="token punctuation">(</span><span class="token string">&quot;VBScript.RegExp&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">Else</span>
        <span class="token keyword">Set</span> cmat <span class="token operator">=</span> <span class="token boolean">Nothing</span>
    <span class="token keyword">End</span> <span class="token keyword">If</span>
    
    <span class="token keyword">With</span> rgx
        <span class="token punctuation">.</span><span class="token keyword">Global</span> <span class="token operator">=</span> <span class="token boolean">True</span>
        <span class="token punctuation">.</span>MultiLine <span class="token operator">=</span> <span class="token boolean">True</span>
        <span class="token punctuation">.</span>Pattern <span class="token operator">=</span> <span class="token string">&quot;[0-9]{1,999}&quot;</span>
        <span class="token keyword">If</span> <span class="token punctuation">.</span>Test<span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token keyword">Then</span>
            <span class="token keyword">Set</span> cmat <span class="token operator">=</span> <span class="token punctuation">.</span>Execute<span class="token punctuation">(</span>str<span class="token punctuation">)</span>
            <span class="token comment">'resize the nums array to accept the matches</span>
            <span class="token keyword">ReDim</span> nums<span class="token punctuation">(</span>cmat<span class="token punctuation">.</span>Count <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token comment">'populate the nums array with the matches</span>
            <span class="token keyword">For</span> n <span class="token operator">=</span> LBound<span class="token punctuation">(</span>nums<span class="token punctuation">)</span> <span class="token keyword">To</span> UBound<span class="token punctuation">(</span>nums<span class="token punctuation">)</span>
                nums<span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">=</span> cmat<span class="token punctuation">.</span>Item<span class="token punctuation">(</span>n<span class="token punctuation">)</span>
            <span class="token keyword">Next</span> n
            <span class="token comment">'convert the nums array to a delimited string</span>
            numbersOnly <span class="token operator">=</span> Join<span class="token punctuation">(</span>nums<span class="token punctuation">,</span> delim<span class="token punctuation">)</span>
        <span class="token keyword">Else</span>
            numbersOnly <span class="token operator">=</span> vbNullString
        <span class="token keyword">End</span> <span class="token keyword">If</span>
    <span class="token keyword">End</span> <span class="token keyword">With</span>
<span class="token keyword">End</span> <span class="token keyword">Function</span>

</code></pre></div><p><a href="http://i.stack.imgur.com/BN6gX.png" target="_blank" rel="noopener noreferrer"><img src="http://i.stack.imgur.com/BN6gX.png" alt="static_UDF"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <sup>Example of UDF with Static object filled through a half-million rows</sup></p> <blockquote></blockquote> <dt>*<sub>Elapsed times to fill 500K rows with UDF:</sub></dt><dd><sub> - with **Dim rgx As Object**: 148.74 seconds</sub></dd><dd><sup> - with **Static rgx As Object**: 26.07 seconds</sup></dd>
* <sub>These should be considered for relative comparison only. Your own results will vary according to the complexity and<br> scope of the operations performed.</sub> <p>Remember that a UDF is not calculated once in the lifetime of a workbook. Even a non-volatile UDF will recalculate whenever the values within the range(s) it references are subject to change. Each subsequent recalculation event only increases the benefits of a statically declared variable.</p> <ul><li>A Static variable is available for the lifetime of the module, not the procedure or function in which it was declared and assigned.</li> <li>Static variables can only be declared locally.</li> <li>Static variable hold many of the same properties of a private module level variable but with a more restricted scope.</li></ul> <p><sub>Related reference: <a href="https://msdn.microsoft.com/en-us/library/z2cty7t8.aspx" target="_blank" rel="noopener noreferrer">Static (Visual Basic)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></sub></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/vba/declaring-variables.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      
      <a href="/vba/vba-option-keyword.html" class="prev">
        VBA Option Keyword
      </a></span> <span class="next"><a href="/vba/declaring-and-assigning-strings.html">
        Declaring and assigning strings
      </a>
      
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.ced448ab.js" defer></script><script src="/assets/js/3.f1d73125.js" defer></script><script src="/assets/js/3419.de2f7eb0.js" defer></script>
  </body>
</html>
