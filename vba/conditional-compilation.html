<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>VBA - Conditional Compilation</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Changing code behavior at compile time, Using Declare Imports that work on all versions of Office">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="VBA - Conditional Compilation">
    <meta property="og:description" content="Changing code behavior at compile time, Using Declare Imports that work on all versions of Office">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/vba/conditional-compilation.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="VBA - Conditional Compilation">
    <meta name="twitter:description" content="Changing code behavior at compile time, Using Declare Imports that work on all versions of Office">
    <meta name="twitter:url" content="/vba/conditional-compilation.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    <link rel="preload" href="/assets/css/0.styles.8b877eb8.css" as="style"><link rel="preload" href="/assets/js/app.ced448ab.js" as="script"><link rel="preload" href="/assets/js/3.f1d73125.js" as="script"><link rel="preload" href="/assets/js/3408.3225edd8.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.8b877eb8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>VBA</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vba/" class="sidebar-link">Disclaimer</a></li><li><a href="/vba/getting-started-with-vba.html" class="sidebar-link">Getting started with VBA</a></li><li><a href="/vba/comments.html" class="sidebar-link">Comments</a></li><li><a href="/vba/string-literals-escaping-non-printable-characters-and-line-continuations.html" class="sidebar-link">String Literals - Escaping, non-printable characters and line-continuations</a></li><li><a href="/vba/vba-option-keyword.html" class="sidebar-link">VBA Option Keyword</a></li><li><a href="/vba/declaring-variables.html" class="sidebar-link">Declaring Variables</a></li><li><a href="/vba/declaring-and-assigning-strings.html" class="sidebar-link">Declaring and assigning strings</a></li><li><a href="/vba/concatenating-strings.html" class="sidebar-link">Concatenating strings</a></li><li><a href="/vba/frequently-used-string-manipulation.html" class="sidebar-link">Frequently used string manipulation</a></li><li><a href="/vba/substrings.html" class="sidebar-link">Substrings</a></li><li><a href="/vba/searching-within-strings-for-the-presence-of-substrings.html" class="sidebar-link">Searching within strings for the presence of substrings</a></li><li><a href="/vba/assigning-strings-with-repeated-characters.html" class="sidebar-link">Assigning strings with repeated characters</a></li><li><a href="/vba/measuring-the-length-of-strings.html" class="sidebar-link">Measuring the length of strings</a></li><li><a href="/vba/converting-other-types-to-strings.html" class="sidebar-link">Converting other types to strings</a></li><li><a href="/vba/date-time-manipulation.html" class="sidebar-link">Date Time Manipulation</a></li><li><a href="/vba/data-types-and-limits.html" class="sidebar-link">Data Types and Limits</a></li><li><a href="/vba/naming-conventions.html" class="sidebar-link">Naming Conventions</a></li><li><a href="/vba/data-structures.html" class="sidebar-link">Data Structures</a></li><li><a href="/vba/arrays.html" class="sidebar-link">Arrays</a></li><li><a href="/vba/copying-returning-and-passing-arrays.html" class="sidebar-link">Copying, returning and passing arrays</a></li><li><a href="/vba/collections.html" class="sidebar-link">Collections</a></li><li><a href="/vba/operators.html" class="sidebar-link">Operators</a></li><li><a href="/vba/sorting.html" class="sidebar-link">Sorting</a></li><li><a href="/vba/flow-control-structures.html" class="sidebar-link">Flow control structures</a></li><li><a href="/vba/passing-arguments-byref-or-byval.html" class="sidebar-link">Passing Arguments ByRef or ByVal</a></li><li><a href="/vba/scripting-filesystemobject.html" class="sidebar-link">Scripting.FileSystemObject</a></li><li><a href="/vba/working-with-files-and-directories-without-using-filesystemobject.html" class="sidebar-link">Working With Files and Directories Without Using FileSystemObject</a></li><li><a href="/vba/reading-2gb-files-in-binary-in-vba-and-file-hashes.html" class="sidebar-link">Reading 2GB+ files in binary in VBA and File Hashes</a></li><li><a href="/vba/creating-a-procedure.html" class="sidebar-link">Creating a procedure</a></li><li><a href="/vba/procedure-calls.html" class="sidebar-link">Procedure Calls</a></li><li><a href="/vba/conditional-compilation.html" class="active sidebar-link">Conditional Compilation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vba/conditional-compilation.html#changing-code-behavior-at-compile-time" class="sidebar-link">Changing code behavior at compile time</a></li><li class="sidebar-sub-header"><a href="/vba/conditional-compilation.html#using-declare-imports-that-work-on-all-versions-of-office" class="sidebar-link">Using Declare Imports that work on all versions of Office</a></li></ul></li><li><a href="/vba/object-oriented-vba.html" class="sidebar-link">Object-Oriented VBA</a></li><li><a href="/vba/creating-a-custom-class.html" class="sidebar-link">Creating a Custom Class</a></li><li><a href="/vba/interfaces.html" class="sidebar-link">Interfaces</a></li><li><a href="/vba/recursion.html" class="sidebar-link">Recursion</a></li><li><a href="/vba/events.html" class="sidebar-link">Events</a></li><li><a href="/vba/scripting-dictionary-object.html" class="sidebar-link">Scripting.Dictionary object</a></li><li><a href="/vba/working-with-ado.html" class="sidebar-link">Working with ADO</a></li><li><a href="/vba/attributes.html" class="sidebar-link">Attributes</a></li><li><a href="/vba/user-forms.html" class="sidebar-link">User Forms</a></li><li><a href="/vba/createobject-vs-getobject.html" class="sidebar-link">CreateObject vs. GetObject</a></li><li><a href="/vba/non-latin-characters.html" class="sidebar-link">Non-Latin Characters</a></li><li><a href="/vba/api-calls.html" class="sidebar-link">API Calls</a></li><li><a href="/vba/automation-or-using-other-applications-libraries.html" class="sidebar-link">Automation or Using other applications Libraries</a></li><li><a href="/vba/macro-security-and-signing-of-vba-projects-modules.html" class="sidebar-link">Macro security and signing of VBA-projects/-modules</a></li><li><a href="/vba/vba-run-time-errors.html" class="sidebar-link">VBA Run-Time Errors</a></li><li><a href="/vba/error-handling.html" class="sidebar-link">Error Handling</a></li><li><a href="/vba/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="conditional-compilation"><a href="#conditional-compilation" class="header-anchor">#</a> Conditional Compilation</h1> <h2 id="changing-code-behavior-at-compile-time"><a href="#changing-code-behavior-at-compile-time" class="header-anchor">#</a> Changing code behavior at compile time</h2> <p>The <code>#Const</code> directive is used to define a custom preprocessor constant. These can later be used by <code>#If</code> to control which blocks of code get compiled and executed.</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token directive comment">#Const DEBUGMODE = 1</span>

<span class="token directive comment">#If DEBUGMODE Then</span>
    <span class="token keyword">Const</span> filepath <span class="token keyword">As</span> <span class="token keyword">String</span> <span class="token operator">=</span> <span class="token string">&quot;C:\Users\UserName\Path\To\File.txt&quot;</span>
<span class="token operator">#</span><span class="token keyword">Else</span>
    <span class="token keyword">Const</span> filepath <span class="token keyword">As</span> <span class="token keyword">String</span> <span class="token operator">=</span> <span class="token string">&quot;\\server\share\path\to\file.txt&quot;</span>
<span class="token directive comment">#End If</span>

</code></pre></div><p>This results in the value of <code>filepath</code> being set to <code>&quot;C:\Users\UserName\Path\To\File.txt&quot;</code>. Removing the <code>#Const</code> line, or changing it to <code>#Const DEBUGMODE = 0</code> would result in the <code>filepath</code> being set to <code>&quot;\\server\share\path\to\file.txt&quot;</code>.</p> <p><strong>#Const Scope</strong></p> <p>The <code>#Const</code> directive is only effective for a single code file (module or class). It must be declared for each and every file you wish to use your custom constant in. Alternatively, you can declare a <code>#Const</code> globally for your project by going to Tools &gt;&gt; [Your Project Name] Project Properties. This will bring up the project properties dialog box where we’ll enter the constant declaration. In the “Conditional Compilation Arguments” box, type in <code>[constName] = [value]</code>. You can enter more than 1 constant by separating them with a colon, like <code>[constName1] = [value1] : [constName2] = [value2]</code>.</p> <p><a href="http://i.stack.imgur.com/rEY6K.png" target="_blank" rel="noopener noreferrer"><img src="http://i.stack.imgur.com/rEY6K.png" alt="VBA Project Properties Dialog"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><strong>Pre-defined Constants</strong></p> <p>Some compilation constants are already pre-defined. Which ones exist will depend on the bitness of the office version you're running VBA in. Note that Vba7 was introduced alongside Office 2010 to support 64 bit versions of Office.</p> <table><thead><tr><th>Constant</th> <th>16 bit</th> <th>32 bit</th> <th>64 bit</th></tr></thead> <tbody><tr><td>Vba6</td> <td>False</td> <td>If Vba6</td> <td>False</td></tr> <tr><td>Vba7</td> <td>False</td> <td>If Vba7</td> <td>True</td></tr> <tr><td>Win16</td> <td>True</td> <td>False</td> <td>False</td></tr> <tr><td>Win32</td> <td>False</td> <td>True</td> <td>True</td></tr> <tr><td>Win64</td> <td>False</td> <td>False</td> <td>True</td></tr> <tr><td>Mac</td> <td>False</td> <td>If Mac</td> <td>If Mac</td></tr></tbody></table> <p>Note that Win64/Win32 refer to the Office version, not the Windows version.
For example Win32 = TRUE in 32-bit Office, even if the OS is a 64-bit version of Windows.</p> <h2 id="using-declare-imports-that-work-on-all-versions-of-office"><a href="#using-declare-imports-that-work-on-all-versions-of-office" class="header-anchor">#</a> Using Declare Imports that work on all versions of Office</h2> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token directive comment">#If Vba7 Then</span>
    <span class="token comment">' It's important to check for Win64 first, </span>
    <span class="token comment">' because Win32 will also return true when Win64 does.</span>

    <span class="token directive comment">#If Win64 Then</span>
        <span class="token keyword">Declare</span> PtrSafe <span class="token keyword">Function</span> GetFoo64 <span class="token keyword">Lib</span> <span class="token string">&quot;exampleLib32&quot;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">As</span> LongLong
    <span class="token operator">#</span><span class="token keyword">Else</span>
        <span class="token keyword">Declare</span> PtrSafe <span class="token keyword">Function</span> GetFoo <span class="token keyword">Lib</span> <span class="token string">&quot;exampleLib32&quot;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Long</span>
    <span class="token directive comment">#End If</span>
<span class="token directive comment">#Else </span>
    <span class="token comment">' Must be Vba6, the PtrSafe keyword didn't exist back then,</span>
    <span class="token comment">' so we need to declare Win32 imports a bit differently than above.</span>

    <span class="token directive comment">#If Win32 Then</span>
        <span class="token keyword">Declare</span> <span class="token keyword">Function</span> GetFoo <span class="token keyword">Lib</span> <span class="token string">&quot;exampleLib32&quot;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Long</span>
    <span class="token operator">#</span><span class="token keyword">Else</span>
        <span class="token keyword">Declare</span> <span class="token keyword">Function</span> GetFoo <span class="token keyword">Lib</span> <span class="token string">&quot;exampleLib&quot;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Integer</span>
    <span class="token directive comment">#End If</span>
<span class="token directive comment">#End If</span>

</code></pre></div><p>This can be simplified a bit depending on what versions of office you need to support. For example, not many people are still supporting 16 bit versions of Office. <a href="https://en.wikipedia.org/wiki/History_of_Microsoft_Office" target="_blank" rel="noopener noreferrer">The last version of 16 bit office was version 4.3, released in 1994<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, so the following declaration is sufficient for nearly all modern cases (including Office 2007).</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token directive comment">#If Vba7 Then</span>
    <span class="token comment">' It's important to check for Win64 first, </span>
    <span class="token comment">' because Win32 will also return true when Win64 does.</span>

    <span class="token directive comment">#If Win64 Then</span>
        <span class="token keyword">Declare</span> PtrSafe <span class="token keyword">Function</span> GetFoo64 <span class="token keyword">Lib</span> <span class="token string">&quot;exampleLib32&quot;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">As</span> LongLong
    <span class="token operator">#</span><span class="token keyword">Else</span>
        <span class="token keyword">Declare</span> PtrSafe <span class="token keyword">Function</span> GetFoo <span class="token keyword">Lib</span> <span class="token string">&quot;exampleLib32&quot;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Long</span>
    <span class="token directive comment">#End If</span>
<span class="token directive comment">#Else </span>
    <span class="token comment">' Must be Vba6. We don't support 16 bit office, so must be Win32. </span>

    <span class="token keyword">Declare</span> <span class="token keyword">Function</span> GetFoo <span class="token keyword">Lib</span> <span class="token string">&quot;exampleLib32&quot;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Long</span>
<span class="token directive comment">#End If</span>

</code></pre></div><p>If you don't have to support anything older than Office 2010, this declaration works just fine.</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token comment">' We only have 2010 installs, so we already know we have Vba7.</span>

<span class="token directive comment">#If Win64 Then</span>
    <span class="token keyword">Declare</span> PtrSafe <span class="token keyword">Function</span> GetFoo64 <span class="token keyword">Lib</span> <span class="token string">&quot;exampleLib32&quot;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">As</span> LongLong
<span class="token operator">#</span><span class="token keyword">Else</span>
    <span class="token keyword">Declare</span> PtrSafe <span class="token keyword">Function</span> GetFoo <span class="token keyword">Lib</span> <span class="token string">&quot;exampleLib32&quot;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Long</span>
<span class="token directive comment">#End If</span>

</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/vba/conditional-compilation.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vba/procedure-calls.html" class="prev">
        Procedure Calls
      </a></span> <span class="next"><a href="/vba/object-oriented-vba.html">
        Object-Oriented VBA
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.ced448ab.js" defer></script><script src="/assets/js/3.f1d73125.js" defer></script><script src="/assets/js/3408.3225edd8.js" defer></script>
  </body>
</html>
