<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>VBA - Working with ADO</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Making a connection to a data source, Creating parameterized commands, Retrieving records with a query, Executing non-scalar functions">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="VBA - Working with ADO">
    <meta property="og:description" content="Making a connection to a data source, Creating parameterized commands, Retrieving records with a query, Executing non-scalar functions">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/vba/working-with-ado.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="VBA - Working with ADO">
    <meta name="twitter:description" content="Making a connection to a data source, Creating parameterized commands, Retrieving records with a query, Executing non-scalar functions">
    <meta name="twitter:url" content="/vba/working-with-ado.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    <link rel="preload" href="/assets/css/0.styles.8b877eb8.css" as="style"><link rel="preload" href="/assets/js/app.ced448ab.js" as="script"><link rel="preload" href="/assets/js/3.f1d73125.js" as="script"><link rel="preload" href="/assets/js/3445.399d0064.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.8b877eb8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>VBA</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vba/" class="sidebar-link">Disclaimer</a></li><li><a href="/vba/getting-started-with-vba.html" class="sidebar-link">Getting started with VBA</a></li><li><a href="/vba/comments.html" class="sidebar-link">Comments</a></li><li><a href="/vba/string-literals-escaping-non-printable-characters-and-line-continuations.html" class="sidebar-link">String Literals - Escaping, non-printable characters and line-continuations</a></li><li><a href="/vba/vba-option-keyword.html" class="sidebar-link">VBA Option Keyword</a></li><li><a href="/vba/declaring-variables.html" class="sidebar-link">Declaring Variables</a></li><li><a href="/vba/declaring-and-assigning-strings.html" class="sidebar-link">Declaring and assigning strings</a></li><li><a href="/vba/concatenating-strings.html" class="sidebar-link">Concatenating strings</a></li><li><a href="/vba/frequently-used-string-manipulation.html" class="sidebar-link">Frequently used string manipulation</a></li><li><a href="/vba/substrings.html" class="sidebar-link">Substrings</a></li><li><a href="/vba/searching-within-strings-for-the-presence-of-substrings.html" class="sidebar-link">Searching within strings for the presence of substrings</a></li><li><a href="/vba/assigning-strings-with-repeated-characters.html" class="sidebar-link">Assigning strings with repeated characters</a></li><li><a href="/vba/measuring-the-length-of-strings.html" class="sidebar-link">Measuring the length of strings</a></li><li><a href="/vba/converting-other-types-to-strings.html" class="sidebar-link">Converting other types to strings</a></li><li><a href="/vba/date-time-manipulation.html" class="sidebar-link">Date Time Manipulation</a></li><li><a href="/vba/data-types-and-limits.html" class="sidebar-link">Data Types and Limits</a></li><li><a href="/vba/naming-conventions.html" class="sidebar-link">Naming Conventions</a></li><li><a href="/vba/data-structures.html" class="sidebar-link">Data Structures</a></li><li><a href="/vba/arrays.html" class="sidebar-link">Arrays</a></li><li><a href="/vba/copying-returning-and-passing-arrays.html" class="sidebar-link">Copying, returning and passing arrays</a></li><li><a href="/vba/collections.html" class="sidebar-link">Collections</a></li><li><a href="/vba/operators.html" class="sidebar-link">Operators</a></li><li><a href="/vba/sorting.html" class="sidebar-link">Sorting</a></li><li><a href="/vba/flow-control-structures.html" class="sidebar-link">Flow control structures</a></li><li><a href="/vba/passing-arguments-byref-or-byval.html" class="sidebar-link">Passing Arguments ByRef or ByVal</a></li><li><a href="/vba/scripting-filesystemobject.html" class="sidebar-link">Scripting.FileSystemObject</a></li><li><a href="/vba/working-with-files-and-directories-without-using-filesystemobject.html" class="sidebar-link">Working With Files and Directories Without Using FileSystemObject</a></li><li><a href="/vba/reading-2gb-files-in-binary-in-vba-and-file-hashes.html" class="sidebar-link">Reading 2GB+ files in binary in VBA and File Hashes</a></li><li><a href="/vba/creating-a-procedure.html" class="sidebar-link">Creating a procedure</a></li><li><a href="/vba/procedure-calls.html" class="sidebar-link">Procedure Calls</a></li><li><a href="/vba/conditional-compilation.html" class="sidebar-link">Conditional Compilation</a></li><li><a href="/vba/object-oriented-vba.html" class="sidebar-link">Object-Oriented VBA</a></li><li><a href="/vba/creating-a-custom-class.html" class="sidebar-link">Creating a Custom Class</a></li><li><a href="/vba/interfaces.html" class="sidebar-link">Interfaces</a></li><li><a href="/vba/recursion.html" class="sidebar-link">Recursion</a></li><li><a href="/vba/events.html" class="sidebar-link">Events</a></li><li><a href="/vba/scripting-dictionary-object.html" class="sidebar-link">Scripting.Dictionary object</a></li><li><a href="/vba/working-with-ado.html" class="active sidebar-link">Working with ADO</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vba/working-with-ado.html#making-a-connection-to-a-data-source" class="sidebar-link">Making a connection to a data source</a></li><li class="sidebar-sub-header"><a href="/vba/working-with-ado.html#creating-parameterized-commands" class="sidebar-link">Creating parameterized commands</a></li><li class="sidebar-sub-header"><a href="/vba/working-with-ado.html#retrieving-records-with-a-query" class="sidebar-link">Retrieving records with a query</a></li><li class="sidebar-sub-header"><a href="/vba/working-with-ado.html#executing-non-scalar-functions" class="sidebar-link">Executing non-scalar functions</a></li></ul></li><li><a href="/vba/attributes.html" class="sidebar-link">Attributes</a></li><li><a href="/vba/user-forms.html" class="sidebar-link">User Forms</a></li><li><a href="/vba/createobject-vs-getobject.html" class="sidebar-link">CreateObject vs. GetObject</a></li><li><a href="/vba/non-latin-characters.html" class="sidebar-link">Non-Latin Characters</a></li><li><a href="/vba/api-calls.html" class="sidebar-link">API Calls</a></li><li><a href="/vba/automation-or-using-other-applications-libraries.html" class="sidebar-link">Automation or Using other applications Libraries</a></li><li><a href="/vba/macro-security-and-signing-of-vba-projects-modules.html" class="sidebar-link">Macro security and signing of VBA-projects/-modules</a></li><li><a href="/vba/vba-run-time-errors.html" class="sidebar-link">VBA Run-Time Errors</a></li><li><a href="/vba/error-handling.html" class="sidebar-link">Error Handling</a></li><li><a href="/vba/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="working-with-ado"><a href="#working-with-ado" class="header-anchor">#</a> Working with ADO</h1> <h2 id="making-a-connection-to-a-data-source"><a href="#making-a-connection-to-a-data-source" class="header-anchor">#</a> Making a connection to a data source</h2> <p>The first step in accessing a data source via ADO is creating an ADO <code>Connection</code> object. This is typically done using a connection string to specify the data source parameters, although it is also possible to open a DSN connection by passing the DSN, user ID, and password to the <code>.Open</code> method.</p> <p>Note that a DSN is not required to connect to a data source via ADO - any data source that has an ODBC provider can be connected to with the appropriate connection string. While specific connection strings for different providers are outside of the scope of this topic, <a href="https://www.connectionstrings.com/" target="_blank" rel="noopener noreferrer">ConnectionStrings.com<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> is an excellent reference for finding the appropriate string for your provider.</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Const</span> SomeDSN <span class="token keyword">As</span> <span class="token keyword">String</span> <span class="token operator">=</span> <span class="token string">&quot;DSN=SomeDSN;Uid=UserName;Pwd=MyPassword;&quot;</span>

<span class="token keyword">Public</span> <span class="token keyword">Sub</span> Example<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">Dim</span> database <span class="token keyword">As</span> ADODB<span class="token punctuation">.</span>Connection
    <span class="token keyword">Set</span> database <span class="token operator">=</span> OpenDatabaseConnection<span class="token punctuation">(</span>SomeDSN<span class="token punctuation">)</span>
    <span class="token keyword">If</span> <span class="token keyword">Not</span> database <span class="token keyword">Is</span> <span class="token boolean">Nothing</span> <span class="token keyword">Then</span>
        <span class="token comment">'... Do work.</span>
        database<span class="token punctuation">.</span>Close          <span class="token comment">'Make sure to close all database connections.</span>
    <span class="token keyword">End</span> <span class="token keyword">If</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>

<span class="token keyword">Public</span> <span class="token keyword">Function</span> OpenDatabaseConnection<span class="token punctuation">(</span>ConnString <span class="token keyword">As</span> <span class="token keyword">String</span><span class="token punctuation">)</span> <span class="token keyword">As</span> ADODB<span class="token punctuation">.</span>Connection
    <span class="token keyword">On</span> <span class="token keyword">Error</span> <span class="token keyword">GoTo</span> Handler
    <span class="token keyword">Dim</span> database <span class="token keyword">As</span> ADODB<span class="token punctuation">.</span>Connection
    <span class="token keyword">Set</span> database <span class="token operator">=</span> <span class="token keyword">New</span> ADODB<span class="token punctuation">.</span>Connection
    
    <span class="token keyword">With</span> database
        <span class="token punctuation">.</span>ConnectionString <span class="token operator">=</span> ConnString
        <span class="token punctuation">.</span>ConnectionTimeout <span class="token operator">=</span> <span class="token number">10</span>             <span class="token comment">'Value is given in seconds.</span>
        <span class="token punctuation">.</span>Open
    <span class="token keyword">End</span> <span class="token keyword">With</span>
     
    OpenDatabaseConnection <span class="token operator">=</span> database
     
    <span class="token keyword">Exit</span> <span class="token keyword">Function</span>
Handler<span class="token punctuation">:</span>
    Debug<span class="token punctuation">.</span>Print <span class="token string">&quot;Database connection failed. Check your connection string.&quot;</span>
<span class="token keyword">End</span> <span class="token keyword">Function</span>

</code></pre></div><p>Note that the database password is included in the connection string in the example above only for the sake of clarity.  Best practices would dictate <strong><strong>not</strong></strong> storing database passwords in code. This can be accomplished by taking the password via user input or using Windows authentication.</p> <h2 id="creating-parameterized-commands"><a href="#creating-parameterized-commands" class="header-anchor">#</a> Creating parameterized commands</h2> <p>Any time SQL executed through an ADO connection needs to contain user input, it is considered best practice to parameterize it in order to minimize the chance of SQL injection. This method is also more readable than long concatenations and facilitates more robust and maintainable code (i.e. by using a function that returns an array of <code>Parameter</code>).</p> <p>In standard ODBC syntax, parameters are given <code>?</code> &quot;placeholders&quot; in the query text, and then parameters are appended to the <code>Command</code> in the same order that they appear in the query.</p> <p>Note that the example below uses the <code>OpenDatabaseConnection</code> function from the <a href="http://stackoverflow.com/documentation/vba/3578/working-with-ado/12351/making-a-connection-to-a-data-source" target="_blank" rel="noopener noreferrer">Making a connection to a data source<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for brevity.</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Public</span> <span class="token keyword">Sub</span> UpdateTheFoos<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">On</span> <span class="token keyword">Error</span> <span class="token keyword">GoTo</span> Handler
    <span class="token keyword">Dim</span> database <span class="token keyword">As</span> ADODB<span class="token punctuation">.</span>Connection
    <span class="token keyword">Set</span> database <span class="token operator">=</span> OpenDatabaseConnection<span class="token punctuation">(</span>SomeDSN<span class="token punctuation">)</span>
    
    <span class="token keyword">If</span> <span class="token keyword">Not</span> database <span class="token keyword">Is</span> <span class="token boolean">Nothing</span> <span class="token keyword">Then</span>
        <span class="token keyword">Dim</span> update <span class="token keyword">As</span> ADODB<span class="token punctuation">.</span>Command
        <span class="token keyword">Set</span> update <span class="token operator">=</span> <span class="token keyword">New</span> ADODB<span class="token punctuation">.</span>Command
        <span class="token comment">'Build the command to pass to the data source.</span>
        <span class="token keyword">With</span> update
            <span class="token punctuation">.</span>ActiveConnection <span class="token operator">=</span> database
            <span class="token punctuation">.</span>CommandText <span class="token operator">=</span> <span class="token string">&quot;UPDATE Table SET Foo = ? WHERE Bar = ?&quot;</span>
            <span class="token punctuation">.</span>CommandType <span class="token operator">=</span> adCmdText
            
            <span class="token comment">'Create the parameters.</span>
            <span class="token keyword">Dim</span> fooValue <span class="token keyword">As</span> ADODB<span class="token punctuation">.</span>Parameter
            <span class="token keyword">Set</span> fooValue <span class="token operator">=</span> <span class="token punctuation">.</span>CreateParameter<span class="token punctuation">(</span><span class="token string">&quot;FooValue&quot;</span><span class="token punctuation">,</span> adNumeric<span class="token punctuation">,</span> adParamInput<span class="token punctuation">)</span>
            fooValue<span class="token punctuation">.</span>Value <span class="token operator">=</span> <span class="token number">42</span>
            
            <span class="token keyword">Dim</span> condition <span class="token keyword">As</span> ADODB<span class="token punctuation">.</span>Parameter
            <span class="token keyword">Set</span> condition <span class="token operator">=</span> <span class="token punctuation">.</span>CreateParameter<span class="token punctuation">(</span><span class="token string">&quot;Condition&quot;</span><span class="token punctuation">,</span> adBSTR<span class="token punctuation">,</span> adParamInput<span class="token punctuation">)</span>
            condition<span class="token punctuation">.</span>Value <span class="token operator">=</span> <span class="token string">&quot;Bar&quot;</span>
            
            <span class="token comment">'Add the parameters to the Command</span>
            <span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span>Append fooValue
            <span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span>Append condition
            <span class="token punctuation">.</span>Execute
        <span class="token keyword">End</span> <span class="token keyword">With</span>
    <span class="token keyword">End</span> <span class="token keyword">If</span>
CleanExit<span class="token punctuation">:</span>
    <span class="token keyword">If</span> <span class="token keyword">Not</span> database <span class="token keyword">Is</span> <span class="token boolean">Nothing</span> <span class="token keyword">And</span> database<span class="token punctuation">.</span>State <span class="token operator">=</span> adStateOpen <span class="token keyword">Then</span>
        database<span class="token punctuation">.</span>Close
    <span class="token keyword">End</span> <span class="token keyword">If</span>
    <span class="token keyword">Exit</span> <span class="token keyword">Sub</span>
Handler<span class="token punctuation">:</span>
    Debug<span class="token punctuation">.</span>Print <span class="token string">&quot;Error &quot;</span> <span class="token operator">&amp;</span> Err<span class="token punctuation">.</span>Number <span class="token operator">&amp;</span> <span class="token string">&quot;: &quot;</span> <span class="token operator">&amp;</span> Err<span class="token punctuation">.</span>Description
    <span class="token keyword">Resume</span> CleanExit
<span class="token keyword">End</span> <span class="token keyword">Sub</span>

</code></pre></div><p>Note: The example above demonstrates a parameterized UPDATE statement, but any SQL statement can be given parameters.</p> <h2 id="retrieving-records-with-a-query"><a href="#retrieving-records-with-a-query" class="header-anchor">#</a> Retrieving records with a query</h2> <p>Queries can be performed in two ways, both of which return an ADO <code>Recordset</code> object which is a collection of returned rows.  Note that both of the examples below use the <code>OpenDatabaseConnection</code> function from the <a href="http://stackoverflow.com/documentation/vba/3578/working-with-ado/12351/making-a-connection-to-a-data-source" target="_blank" rel="noopener noreferrer">Making a connection to a data source<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> example for the purpose of brevity. Remember that the syntax of the SQL passed to the data source is provider specific.</p> <p>The first method is to pass the SQL statement directly to the Connection object, and is the easiest method for executing simple queries:</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Public</span> <span class="token keyword">Sub</span> DisplayDistinctItems<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">On</span> <span class="token keyword">Error</span> <span class="token keyword">GoTo</span> Handler
    <span class="token keyword">Dim</span> database <span class="token keyword">As</span> ADODB<span class="token punctuation">.</span>Connection
    <span class="token keyword">Set</span> database <span class="token operator">=</span> OpenDatabaseConnection<span class="token punctuation">(</span>SomeDSN<span class="token punctuation">)</span>
    
    <span class="token keyword">If</span> <span class="token keyword">Not</span> database <span class="token keyword">Is</span> <span class="token boolean">Nothing</span> <span class="token keyword">Then</span>
        <span class="token keyword">Dim</span> records <span class="token keyword">As</span> ADODB<span class="token punctuation">.</span>Recordset
        <span class="token keyword">Set</span> records <span class="token operator">=</span> database<span class="token punctuation">.</span>Execute<span class="token punctuation">(</span><span class="token string">&quot;SELECT DISTINCT Item FROM Table&quot;</span><span class="token punctuation">)</span>
        <span class="token comment">'Loop through the returned Recordset.</span>
        <span class="token keyword">Do</span> <span class="token keyword">While</span> <span class="token keyword">Not</span> records<span class="token punctuation">.</span>EOF      <span class="token comment">'EOF is false when there are more records.</span>
            <span class="token comment">'Individual fields are indexed either by name or 0 based ordinal.</span>
            <span class="token comment">'Note that this is using the default .Fields member of the Recordset.</span>
            Debug<span class="token punctuation">.</span>Print records<span class="token punctuation">(</span><span class="token string">&quot;Item&quot;</span><span class="token punctuation">)</span>
            <span class="token comment">'Move to the next record.</span>
            records<span class="token punctuation">.</span>MoveNext
        <span class="token keyword">Loop</span>
    <span class="token keyword">End</span> <span class="token keyword">If</span>
CleanExit<span class="token punctuation">:</span>
    <span class="token keyword">If</span> <span class="token keyword">Not</span> records <span class="token keyword">Is</span> <span class="token boolean">Nothing</span> <span class="token keyword">Then</span> records<span class="token punctuation">.</span>Close
    <span class="token keyword">If</span> <span class="token keyword">Not</span> database <span class="token keyword">Is</span> <span class="token boolean">Nothing</span> <span class="token keyword">And</span> database<span class="token punctuation">.</span>State <span class="token operator">=</span> adStateOpen <span class="token keyword">Then</span>
        database<span class="token punctuation">.</span>Close
    <span class="token keyword">End</span> <span class="token keyword">If</span>
    <span class="token keyword">Exit</span> <span class="token keyword">Sub</span>
Handler<span class="token punctuation">:</span>
    Debug<span class="token punctuation">.</span>Print <span class="token string">&quot;Error &quot;</span> <span class="token operator">&amp;</span> Err<span class="token punctuation">.</span>Number <span class="token operator">&amp;</span> <span class="token string">&quot;: &quot;</span> <span class="token operator">&amp;</span> Err<span class="token punctuation">.</span>Description
    <span class="token keyword">Resume</span> CleanExit
<span class="token keyword">End</span> <span class="token keyword">Sub</span>

</code></pre></div><p>The second method is to create an ADO <code>Command</code> object for the query you want to execute. This requires a little more code, but is necessary in order to use parametrized queries:</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Public</span> <span class="token keyword">Sub</span> DisplayDistinctItems<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">On</span> <span class="token keyword">Error</span> <span class="token keyword">GoTo</span> Handler
    <span class="token keyword">Dim</span> database <span class="token keyword">As</span> ADODB<span class="token punctuation">.</span>Connection
    <span class="token keyword">Set</span> database <span class="token operator">=</span> OpenDatabaseConnection<span class="token punctuation">(</span>SomeDSN<span class="token punctuation">)</span>
    
    <span class="token keyword">If</span> <span class="token keyword">Not</span> database <span class="token keyword">Is</span> <span class="token boolean">Nothing</span> <span class="token keyword">Then</span>
        <span class="token keyword">Dim</span> query <span class="token keyword">As</span> ADODB<span class="token punctuation">.</span>Command
        <span class="token keyword">Set</span> query <span class="token operator">=</span> <span class="token keyword">New</span> ADODB<span class="token punctuation">.</span>Command
        <span class="token comment">'Build the command to pass to the data source.</span>
        <span class="token keyword">With</span> query
            <span class="token punctuation">.</span>ActiveConnection <span class="token operator">=</span> database
            <span class="token punctuation">.</span>CommandText <span class="token operator">=</span> <span class="token string">&quot;SELECT DISTINCT Item FROM Table&quot;</span>
            <span class="token punctuation">.</span>CommandType <span class="token operator">=</span> adCmdText
        <span class="token keyword">End</span> <span class="token keyword">With</span>
        <span class="token keyword">Dim</span> records <span class="token keyword">As</span> ADODB<span class="token punctuation">.</span>Recordset
        <span class="token comment">'Execute the command to retrieve the recordset.</span>
        <span class="token keyword">Set</span> records <span class="token operator">=</span> query<span class="token punctuation">.</span>Execute<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">Do</span> <span class="token keyword">While</span> <span class="token keyword">Not</span> records<span class="token punctuation">.</span>EOF
            Debug<span class="token punctuation">.</span>Print records<span class="token punctuation">(</span><span class="token string">&quot;Item&quot;</span><span class="token punctuation">)</span>
            records<span class="token punctuation">.</span>MoveNext
        <span class="token keyword">Loop</span>
    <span class="token keyword">End</span> <span class="token keyword">If</span>
CleanExit<span class="token punctuation">:</span>
    <span class="token keyword">If</span> <span class="token keyword">Not</span> records <span class="token keyword">Is</span> <span class="token boolean">Nothing</span> <span class="token keyword">Then</span> records<span class="token punctuation">.</span>Close
    <span class="token keyword">If</span> <span class="token keyword">Not</span> database <span class="token keyword">Is</span> <span class="token boolean">Nothing</span> <span class="token keyword">And</span> database<span class="token punctuation">.</span>State <span class="token operator">=</span> adStateOpen <span class="token keyword">Then</span>
        database<span class="token punctuation">.</span>Close
    <span class="token keyword">End</span> <span class="token keyword">If</span>
    <span class="token keyword">Exit</span> <span class="token keyword">Sub</span>
Handler<span class="token punctuation">:</span>
    Debug<span class="token punctuation">.</span>Print <span class="token string">&quot;Error &quot;</span> <span class="token operator">&amp;</span> Err<span class="token punctuation">.</span>Number <span class="token operator">&amp;</span> <span class="token string">&quot;: &quot;</span> <span class="token operator">&amp;</span> Err<span class="token punctuation">.</span>Description
    <span class="token keyword">Resume</span> CleanExit
<span class="token keyword">End</span> <span class="token keyword">Sub</span>

</code></pre></div><p>Note that commands sent to the data source are <strong>vulnerable to SQL injection</strong>, either intentional or unintentional. In general, queries should not be created by concatenating user input of any kind. Instead, they should be parameterized (see <a href="http://stackoverflow.com/documentation/vba/3578/working-with-ado/12354/creating-parametrized-commands" target="_blank" rel="noopener noreferrer">Creating parameterized commands<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>).</p> <h2 id="executing-non-scalar-functions"><a href="#executing-non-scalar-functions" class="header-anchor">#</a> Executing non-scalar functions</h2> <p>ADO connections can be used to perform pretty much any database function that the provider supports via SQL. In this case it isn't always necessary to use the <code>Recordset</code> returned by the <code>Execute</code> function, although it can be useful for obtaining key assignments after INSERT statements with @@Identity or similar SQL commands. Note that the example below uses the <code>OpenDatabaseConnection</code> function from the <a href="http://stackoverflow.com/documentation/vba/3578/working-with-ado/12351/making-a-connection-to-a-data-source" target="_blank" rel="noopener noreferrer">Making a connection to a data source<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> example for the purpose of brevity.</p> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Public</span> <span class="token keyword">Sub</span> UpdateTheFoos<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">On</span> <span class="token keyword">Error</span> <span class="token keyword">GoTo</span> Handler
    <span class="token keyword">Dim</span> database <span class="token keyword">As</span> ADODB<span class="token punctuation">.</span>Connection
    <span class="token keyword">Set</span> database <span class="token operator">=</span> OpenDatabaseConnection<span class="token punctuation">(</span>SomeDSN<span class="token punctuation">)</span>
    
    <span class="token keyword">If</span> <span class="token keyword">Not</span> database <span class="token keyword">Is</span> <span class="token boolean">Nothing</span> <span class="token keyword">Then</span>
        <span class="token keyword">Dim</span> update <span class="token keyword">As</span> ADODB<span class="token punctuation">.</span>Command
        <span class="token keyword">Set</span> update <span class="token operator">=</span> <span class="token keyword">New</span> ADODB<span class="token punctuation">.</span>Command
        <span class="token comment">'Build the command to pass to the data source.</span>
        <span class="token keyword">With</span> update
            <span class="token punctuation">.</span>ActiveConnection <span class="token operator">=</span> database
            <span class="token punctuation">.</span>CommandText <span class="token operator">=</span> <span class="token string">&quot;UPDATE Table SET Foo = 42 WHERE Bar IS NULL&quot;</span>
            <span class="token punctuation">.</span>CommandType <span class="token operator">=</span> adCmdText
            <span class="token punctuation">.</span>Execute        <span class="token comment">'We don't need the return from the DB, so ignore it.</span>
        <span class="token keyword">End</span> <span class="token keyword">With</span>
    <span class="token keyword">End</span> <span class="token keyword">If</span>
CleanExit<span class="token punctuation">:</span>
    <span class="token keyword">If</span> <span class="token keyword">Not</span> database <span class="token keyword">Is</span> <span class="token boolean">Nothing</span> <span class="token keyword">And</span> database<span class="token punctuation">.</span>State <span class="token operator">=</span> adStateOpen <span class="token keyword">Then</span>
        database<span class="token punctuation">.</span>Close
    <span class="token keyword">End</span> <span class="token keyword">If</span>
    <span class="token keyword">Exit</span> <span class="token keyword">Sub</span>
Handler<span class="token punctuation">:</span>
    Debug<span class="token punctuation">.</span>Print <span class="token string">&quot;Error &quot;</span> <span class="token operator">&amp;</span> Err<span class="token punctuation">.</span>Number <span class="token operator">&amp;</span> <span class="token string">&quot;: &quot;</span> <span class="token operator">&amp;</span> Err<span class="token punctuation">.</span>Description
    <span class="token keyword">Resume</span> CleanExit
<span class="token keyword">End</span> <span class="token keyword">Sub</span>

</code></pre></div><p>Note that commands sent to the data source are <strong>vulnerable to SQL injection</strong>, either intentional or unintentional. In general, SQL statements should not be created by concatenating user input of any kind. Instead, they should be parameterized (see <a href="http://stackoverflow.com/documentation/vba/3578/working-with-ado/12354/creating-parametrized-commands" target="_blank" rel="noopener noreferrer">Creating parameterized commands<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>).</p> <h4 id="remarks"><a href="#remarks" class="header-anchor">#</a> Remarks</h4> <p>The examples shown in this topic use early binding for clarity, and require a reference to the Microsoft ActiveX Data Object x.x Library. They can be converted to late binding by replacing the strongly typed references with <code>Object</code> and replacing object creation using <code>New</code> with <code>CreateObject</code> where appropriate.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/vba/working-with-ado.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vba/scripting-dictionary-object.html" class="prev">
        Scripting.Dictionary object
      </a></span> <span class="next"><a href="/vba/attributes.html">
        Attributes
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.ced448ab.js" defer></script><script src="/assets/js/3.f1d73125.js" defer></script><script src="/assets/js/3445.399d0064.js" defer></script>
  </body>
</html>
