<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>R - Pivot and unpivot with data.table</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Pivot and unpivot tabular data with data.table - I, Pivot and unpivot tabular data with data.table - II">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="R - Pivot and unpivot with data.table">
    <meta property="og:description" content="Pivot and unpivot tabular data with data.table - I, Pivot and unpivot tabular data with data.table - II">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/r/pivot-and-unpivot-with-data-table.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="R - Pivot and unpivot with data.table">
    <meta name="twitter:description" content="Pivot and unpivot tabular data with data.table - I, Pivot and unpivot tabular data with data.table - II">
    <meta name="twitter:url" content="/r/pivot-and-unpivot-with-data-table.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    <link rel="preload" href="/assets/css/0.styles.8b877eb8.css" as="style"><link rel="preload" href="/assets/js/app.ced448ab.js" as="script"><link rel="preload" href="/assets/js/3.f1d73125.js" as="script"><link rel="preload" href="/assets/js/2926.0a73c71f.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.8b877eb8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>R</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/r/" class="sidebar-link">Disclaimer</a></li><li><a href="/r/getting-started-with-r-language.html" class="sidebar-link">Getting started with R Language</a></li><li><a href="/r/variables.html" class="sidebar-link">Variables</a></li><li><a href="/r/arithmetic-operators.html" class="sidebar-link">Arithmetic Operators</a></li><li><a href="/r/matrices.html" class="sidebar-link">Matrices</a></li><li><a href="/r/formula.html" class="sidebar-link">Formula</a></li><li><a href="/r/reading-and-writing-strings.html" class="sidebar-link">Reading and writing strings</a></li><li><a href="/r/string-manipulation-with-stringi-package.html" class="sidebar-link">String manipulation with stringi package</a></li><li><a href="/r/classes.html" class="sidebar-link">Classes</a></li><li><a href="/r/lists.html" class="sidebar-link">Lists</a></li><li><a href="/r/hashmaps.html" class="sidebar-link">Hashmaps</a></li><li><a href="/r/creating-vectors.html" class="sidebar-link">Creating vectors</a></li><li><a href="/r/date-and-time.html" class="sidebar-link">Date and Time</a></li><li><a href="/r/the-date-class.html" class="sidebar-link">The Date class</a></li><li><a href="/r/date-time-classes-posixct-and-posixlt.html" class="sidebar-link">Date-time classes (POSIXct and POSIXlt)</a></li><li><a href="/r/the-character-class.html" class="sidebar-link">The character class</a></li><li><a href="/r/numeric-classes-and-storage-modes.html" class="sidebar-link">Numeric classes and storage modes</a></li><li><a href="/r/the-logical-class.html" class="sidebar-link">The logical class</a></li><li><a href="/r/data-frames.html" class="sidebar-link">Data frames</a></li><li><a href="/r/split-function.html" class="sidebar-link">Split function</a></li><li><a href="/r/reading-and-writing-tabular-data-in-plain-text-files-csv-tsv-etc.html" class="sidebar-link">Reading and writing tabular data in plain-text files (CSV, TSV, etc.)</a></li><li><a href="/r/pipe-operators-and-others.html" class="sidebar-link">Pipe operators (%&gt;% and others)</a></li><li><a href="/r/linear-models-regression.html" class="sidebar-link">Linear Models (Regression)</a></li><li><a href="/r/data-table.html" class="sidebar-link">data.table</a></li><li><a href="/r/pivot-and-unpivot-with-data-table.html" class="active sidebar-link">Pivot and unpivot with data.table</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/r/pivot-and-unpivot-with-data-table.html#pivot-and-unpivot-tabular-data-with-data-table-i" class="sidebar-link">Pivot and unpivot tabular data with data.table - I</a></li><li class="sidebar-sub-header"><a href="/r/pivot-and-unpivot-with-data-table.html#pivot-and-unpivot-tabular-data-with-data-table-ii" class="sidebar-link">Pivot and unpivot tabular data with data.table - II</a></li></ul></li><li><a href="/r/bar-chart.html" class="sidebar-link">Bar Chart</a></li><li><a href="/r/base-plotting.html" class="sidebar-link">Base Plotting</a></li><li><a href="/r/boxplot.html" class="sidebar-link">boxplot</a></li><li><a href="/r/ggplot2.html" class="sidebar-link">ggplot2</a></li><li><a href="/r/factors.html" class="sidebar-link">Factors</a></li><li><a href="/r/pattern-matching-and-replacement.html" class="sidebar-link">Pattern Matching and Replacement</a></li><li><a href="/r/run-length-encoding.html" class="sidebar-link">Run-length encoding</a></li><li><a href="/r/speeding-up-tough-to-vectorize-code.html" class="sidebar-link">Speeding up tough-to-vectorize code</a></li><li><a href="/r/introduction-to-geographical-maps.html" class="sidebar-link">Introduction to Geographical Maps</a></li><li><a href="/r/set-operations.html" class="sidebar-link">Set operations</a></li><li><a href="/r/tidyverse.html" class="sidebar-link">tidyverse</a></li><li><a href="/r/rcpp.html" class="sidebar-link">Rcpp</a></li><li><a href="/r/random-numbers-generator.html" class="sidebar-link">Random Numbers Generator</a></li><li><a href="/r/parallel-processing.html" class="sidebar-link">Parallel processing</a></li><li><a href="/r/subsetting.html" class="sidebar-link">Subsetting</a></li><li><a href="/r/debugging.html" class="sidebar-link">Debugging</a></li><li><a href="/r/installing-packages.html" class="sidebar-link">Installing packages</a></li><li><a href="/r/updating-r-and-the-package-library.html" class="sidebar-link">Updating R and the package library</a></li><li><a href="/r/inspecting-packages.html" class="sidebar-link">Inspecting packages</a></li><li><a href="/r/creating-packages-with-devtools.html" class="sidebar-link">Creating packages with devtools</a></li><li><a href="/r/using-pipe-assignment-in-your-own-package-how-to.html" class="sidebar-link">Using pipe assignment in your own package %%: How to ?</a></li><li><a href="/r/arima-models.html" class="sidebar-link">Arima Models</a></li><li><a href="/r/distribution-functions.html" class="sidebar-link">Distribution Functions</a></li><li><a href="/r/shiny.html" class="sidebar-link">Shiny</a></li><li><a href="/r/spatial-analysis.html" class="sidebar-link">spatial analysis</a></li><li><a href="/r/sqldf.html" class="sidebar-link">sqldf</a></li><li><a href="/r/code-profiling.html" class="sidebar-link">Code profiling</a></li><li><a href="/r/control-flow-structures.html" class="sidebar-link">Control flow structures</a></li><li><a href="/r/column-wise-operation.html" class="sidebar-link">Column wise operation</a></li><li><a href="/r/json.html" class="sidebar-link">JSON</a></li><li><a href="/r/rodbc.html" class="sidebar-link">RODBC</a></li><li><a href="/r/lubridate.html" class="sidebar-link">lubridate</a></li><li><a href="/r/time-series-and-forecasting.html" class="sidebar-link">Time Series and Forecasting</a></li><li><a href="/r/strsplit-function.html" class="sidebar-link">strsplit function</a></li><li><a href="/r/web-scraping-and-parsing.html" class="sidebar-link">Web scraping and parsing</a></li><li><a href="/r/generalized-linear-models.html" class="sidebar-link">Generalized linear models</a></li><li><a href="/r/reshaping-data-between-long-and-wide-forms.html" class="sidebar-link">Reshaping data between long and wide forms</a></li><li><a href="/r/rmarkdown-and-knitr-presentation.html" class="sidebar-link">RMarkdown and knitr presentation</a></li><li><a href="/r/scope-of-variables.html" class="sidebar-link">Scope of variables</a></li><li><a href="/r/performing-a-permutation-test.html" class="sidebar-link">Performing a Permutation Test</a></li><li><a href="/r/xgboost.html" class="sidebar-link">xgboost</a></li><li><a href="/r/r-code-vectorization-best-practices.html" class="sidebar-link">R code vectorization best practices</a></li><li><a href="/r/missing-values.html" class="sidebar-link">Missing values</a></li><li><a href="/r/hierarchical-linear-modeling.html" class="sidebar-link">Hierarchical Linear Modeling</a></li><li><a href="/r/apply-family-of-functions-functionals.html" class="sidebar-link">*apply family of functions (functionals)</a></li><li><a href="/r/text-mining.html" class="sidebar-link">Text mining</a></li><li><a href="/r/anova.html" class="sidebar-link">ANOVA</a></li><li><a href="/r/raster-and-image-analysis.html" class="sidebar-link">Raster and Image Analysis</a></li><li><a href="/r/survival-analysis.html" class="sidebar-link">Survival analysis</a></li><li><a href="/r/fault-tolerant-resilient-code.html" class="sidebar-link">Fault-tolerant/resilient code</a></li><li><a href="/r/reproducible-r.html" class="sidebar-link">Reproducible R</a></li><li><a href="/r/fourier-series-and-transformations.html" class="sidebar-link">Fourier Series and Transformations</a></li><li><a href="/r/rprofile.html" class="sidebar-link">.Rprofile</a></li><li><a href="/r/dplyr.html" class="sidebar-link">dplyr</a></li><li><a href="/r/caret.html" class="sidebar-link">caret</a></li><li><a href="/r/extracting-and-listing-files-in-compressed-archives.html" class="sidebar-link">Extracting and Listing Files in Compressed Archives</a></li><li><a href="/r/probability-distributions-with-r.html" class="sidebar-link">Probability Distributions with R</a></li><li><a href="/r/r-in-latex-with-knitr.html" class="sidebar-link">R in LaTeX with knitr</a></li><li><a href="/r/web-crawling-in-r.html" class="sidebar-link">Web Crawling in R</a></li><li><a href="/r/creating-reports-with-rmarkdown.html" class="sidebar-link">Creating reports with RMarkdown</a></li><li><a href="/r/gpu-accelerated-computing.html" class="sidebar-link">GPU-accelerated computing</a></li><li><a href="/r/heatmap-and-heatmap-2.html" class="sidebar-link">heatmap and heatmap.2</a></li><li><a href="/r/network-analysis-with-the-igraph-package.html" class="sidebar-link">Network analysis with the igraph package</a></li><li><a href="/r/functional-programming.html" class="sidebar-link">Functional programming</a></li><li><a href="/r/get-user-input.html" class="sidebar-link">Get user input</a></li><li><a href="/r/spark-api-sparkr.html" class="sidebar-link">Spark API (SparkR)</a></li><li><a href="/r/meta-documentation-guidelines.html" class="sidebar-link">Meta: Documentation Guidelines</a></li><li><a href="/r/input-and-output.html" class="sidebar-link">Input and output</a></li><li><a href="/r/i-o-for-foreign-tables-excel-sas-spss-stata.html" class="sidebar-link">I/O for foreign tables (Excel, SAS, SPSS, Stata)</a></li><li><a href="/r/i-o-for-database-tables.html" class="sidebar-link">I/O for database tables</a></li><li><a href="/r/i-o-for-geographic-data-shapefiles-etc.html" class="sidebar-link">I/O for geographic data (shapefiles, etc.)</a></li><li><a href="/r/i-o-for-raster-images.html" class="sidebar-link">I/O for raster images</a></li><li><a href="/r/i-o-for-r-s-binary-format.html" class="sidebar-link">I/O for R's binary format</a></li><li><a href="/r/recycling.html" class="sidebar-link">Recycling</a></li><li><a href="/r/expression-parse-eval.html" class="sidebar-link">Expression: parse + eval</a></li><li><a href="/r/regular-expression-syntax-in-r.html" class="sidebar-link">Regular Expression Syntax in R</a></li><li><a href="/r/regular-expressions-regex.html" class="sidebar-link">Regular Expressions (regex)</a></li><li><a href="/r/combinatorics.html" class="sidebar-link">Combinatorics</a></li><li><a href="/r/solving-odes-in-r.html" class="sidebar-link">Solving ODEs in R</a></li><li><a href="/r/feature-selection-in-r-removing-extraneous-features.html" class="sidebar-link">Feature Selection in R -- Removing Extraneous Features</a></li><li><a href="/r/bibliography-in-rmd.html" class="sidebar-link">Bibliography in RMD</a></li><li><a href="/r/writing-functions-in-r.html" class="sidebar-link">Writing functions in R</a></li><li><a href="/r/color-schemes-for-graphics.html" class="sidebar-link">Color schemes for graphics</a></li><li><a href="/r/hierarchical-clustering-with-hclust.html" class="sidebar-link">Hierarchical clustering with hclust</a></li><li><a href="/r/random-forest-algorithm.html" class="sidebar-link">Random Forest Algorithm</a></li><li><a href="/r/restful-r-services.html" class="sidebar-link">RESTful R Services</a></li><li><a href="/r/machine-learning.html" class="sidebar-link">Machine learning</a></li><li><a href="/r/using-texreg-to-export-models-in-a-paper-ready-way.html" class="sidebar-link">Using texreg to export models in a paper-ready way</a></li><li><a href="/r/publishing.html" class="sidebar-link">Publishing</a></li><li><a href="/r/implement-state-machine-pattern-using-s4-class.html" class="sidebar-link">Implement State Machine Pattern using S4 Class</a></li><li><a href="/r/reshape-using-tidyr.html" class="sidebar-link">Reshape using tidyr</a></li><li><a href="/r/modifying-strings-by-substitution.html" class="sidebar-link">Modifying strings by substitution</a></li><li><a href="/r/non-standard-evaluation-and-standard-evaluation.html" class="sidebar-link">Non-standard evaluation and standard evaluation</a></li><li><a href="/r/randomization.html" class="sidebar-link">Randomization</a></li><li><a href="/r/object-oriented-programming-in-r.html" class="sidebar-link">Object-Oriented Programming in R</a></li><li><a href="/r/coercion.html" class="sidebar-link">Coercion</a></li><li><a href="/r/standardize-analyses-by-writing-standalone-r-scripts.html" class="sidebar-link">Standardize analyses by writing standalone R scripts</a></li><li><a href="/r/analyze-tweets-with-r.html" class="sidebar-link">Analyze tweets with R</a></li><li><a href="/r/natural-language-processing.html" class="sidebar-link">Natural language processing</a></li><li><a href="/r/r-markdown-notebooks-from-rstudio.html" class="sidebar-link">R Markdown Notebooks (from RStudio)</a></li><li><a href="/r/aggregating-data-frames.html" class="sidebar-link">Aggregating data frames</a></li><li><a href="/r/data-acquisition.html" class="sidebar-link">Data acquisition</a></li><li><a href="/r/r-memento-by-examples.html" class="sidebar-link">R memento by examples</a></li><li><a href="/r/updating-r-version.html" class="sidebar-link">Updating R version</a></li><li><a href="/r/introspection.html" class="sidebar-link">Introspection</a></li><li><a href="/r/roxygen2.html" class="sidebar-link">roxygen2</a></li><li><a href="/r/cleaning-data.html" class="sidebar-link">Cleaning data</a></li><li><a href="/r/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="pivot-and-unpivot-with-data-table"><a href="#pivot-and-unpivot-with-data-table" class="header-anchor">#</a> Pivot and unpivot with data.table</h1> <h2 id="pivot-and-unpivot-tabular-data-with-data-table-i"><a href="#pivot-and-unpivot-tabular-data-with-data-table-i" class="header-anchor">#</a> Pivot and unpivot tabular data with data.table - I</h2> <p>Convert from wide form to long form</p> <p>Load <code>data USArrests</code> from <code>datasets</code>.</p> <div class="language-r extra-class"><pre class="language-r"><code>data<span class="token punctuation">(</span><span class="token string">&quot;USArrests&quot;</span><span class="token punctuation">)</span>
head<span class="token punctuation">(</span>USArrests<span class="token punctuation">)</span>

           Murder Assault UrbanPop Rape
Alabama      <span class="token number">13.2</span>     <span class="token number">236</span>       <span class="token number">58</span> <span class="token number">21.2</span>
Alaska       <span class="token number">10.0</span>     <span class="token number">263</span>       <span class="token number">48</span> <span class="token number">44.5</span>
Arizona       <span class="token number">8.1</span>     <span class="token number">294</span>       <span class="token number">80</span> <span class="token number">31.0</span>
Arkansas      <span class="token number">8.8</span>     <span class="token number">190</span>       <span class="token number">50</span> <span class="token number">19.5</span>
California    <span class="token number">9.0</span>     <span class="token number">276</span>       <span class="token number">91</span> <span class="token number">40.6</span>
Colorado      <span class="token number">7.9</span>     <span class="token number">204</span>       <span class="token number">78</span> <span class="token number">38.7</span>

</code></pre></div><p>Use <code>?USArrests</code> to find out more. First, convert to <code>data.table</code>. The names of states are row names in the original <code>data.frame</code>.</p> <div class="language-r extra-class"><pre class="language-r"><code>library<span class="token punctuation">(</span>data.table<span class="token punctuation">)</span>
DT <span class="token operator">&lt;-</span> as.data.table<span class="token punctuation">(</span>USArrests<span class="token punctuation">,</span> keep.rownames<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>

</code></pre></div><p>This is data in the wide form. It has a column for each variable. The data can also be stored in long form without loss of information. The long form has one column that stores the variable names. Then, it has another column for the variable values. The long form of <code>USArrests</code> looks like so.</p> <div class="language- extra-class"><pre class="language-text"><code>
           State    Crime  Rate
  1:       Alabama   Murder  13.2
  2:        Alaska   Murder  10.0
  3:       Arizona   Murder   8.1
  4:      Arkansas   Murder   8.8
  5:    California   Murder   9.0
 ---                             
196:      Virginia     Rape  20.7
197:    Washington     Rape  26.2
198: West Virginia     Rape   9.3
199:     Wisconsin     Rape  10.8
200:       Wyoming     Rape  15.6

</code></pre></div><p>We use the <code>melt</code> function to switch from wide form to long form.</p> <div class="language-r extra-class"><pre class="language-r"><code>DTm <span class="token operator">&lt;-</span> melt<span class="token punctuation">(</span>DT<span class="token punctuation">)</span>
names<span class="token punctuation">(</span>DTm<span class="token punctuation">)</span> <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">&quot;State&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Crime&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Rate&quot;</span><span class="token punctuation">)</span>

</code></pre></div><p>By default, <code>melt</code> treats all columns with numeric data as variables with values. In <code>USArrests</code>, the variable <code>UrbanPop</code> represents the percentage urban population of a state. It is different from the other variabes, <code>Murder</code>, <code>Assault</code> and <code>Rape</code>, which are violent crimes reported per 100,000 people. Suppose we want to retain <code>UrbanPop</code> column. We achieve this by setting <code>id.vars</code> as follows.</p> <div class="language-r extra-class"><pre class="language-r"><code>DTmu <span class="token operator">&lt;-</span> melt<span class="token punctuation">(</span>DT<span class="token punctuation">,</span> id.vars<span class="token operator">=</span>c<span class="token punctuation">(</span><span class="token string">&quot;rn&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;UrbanPop&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> 
             variable.name<span class="token operator">=</span><span class="token string">'Crime'</span><span class="token punctuation">,</span> value.name <span class="token operator">=</span> <span class="token string">&quot;Rate&quot;</span><span class="token punctuation">)</span>
names<span class="token punctuation">(</span>DTmu<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;-</span> <span class="token string">&quot;State&quot;</span>

</code></pre></div><p>Note that we have specified the names of the column containing category names (Murder, Assault, etc.) with <code>variable.name</code> and the column containing the values with <code>value.name</code>. Our data looks like so.</p> <div class="language- extra-class"><pre class="language-text"><code>
            State UrbanPop  Crime Rate
  1:       Alabama       58 Murder 13.2
  2:        Alaska       48 Murder 10.0
  3:       Arizona       80 Murder  8.1
  4:      Arkansas       50 Murder  8.8
  5:    California       91 Murder  9.0

</code></pre></div><p>Generating summaries with with split-apply-combine style approach is a breeze. For example, to summarize violent crimes by state?</p> <div class="language-r extra-class"><pre class="language-r"><code>DTmu<span class="token punctuation">[</span><span class="token punctuation">,</span> .<span class="token punctuation">(</span>ViolentCrime <span class="token operator">=</span> sum<span class="token punctuation">(</span>Rate<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> by<span class="token operator">=</span>State<span class="token punctuation">]</span>

</code></pre></div><p>This gives:</p> <div class="language- extra-class"><pre class="language-text"><code>
       State ViolentCrime
1:    Alabama        270.4
2:     Alaska        317.5
3:    Arizona        333.1
4:   Arkansas        218.3
5: California        325.6
6:   Colorado        250.6

</code></pre></div><h2 id="pivot-and-unpivot-tabular-data-with-data-table-ii"><a href="#pivot-and-unpivot-tabular-data-with-data-table-ii" class="header-anchor">#</a> Pivot and unpivot tabular data with data.table - II</h2> <p>Convert from long form to wide form</p> <p>To recover data from the previous example, use <code>dcast</code> like so.</p> <div class="language-r extra-class"><pre class="language-r"><code>DTc <span class="token operator">&lt;-</span> dcast<span class="token punctuation">(</span>DTmu<span class="token punctuation">,</span> State <span class="token operator">+</span> UrbanPop <span class="token operator">~</span> Crime<span class="token punctuation">)</span>

</code></pre></div><p>This gives the data in the original wide form.</p> <div class="language- extra-class"><pre class="language-text"><code>
            State UrbanPop Murder Assault Rape
 1:        Alabama       58   13.2     236 21.2
 2:         Alaska       48   10.0     263 44.5
 3:        Arizona       80    8.1     294 31.0
 4:       Arkansas       50    8.8     190 19.5
 5:     California       91    9.0     276 40.6

</code></pre></div><p>Here, the formula notation is used to specify the columns that form a unique record identifier (LHS) and the column containing category labels for new column names (RHS). Which column to use for the numeric values? By default, <code>dcast</code> uses the first column with numerical values left over when from the formula specification. To make explicit, use the parameter <code>value.var</code> with column name.</p> <p>When the operation produces a list of values in each cell, <code>dcast</code> provides a <code>fun.aggregate</code> method to handle the situation. Say I am interested in states with similar urban population when investigating crime rates. I add a column <code>Decile</code> with computed information.</p> <div class="language-r extra-class"><pre class="language-r"><code>DTmu<span class="token punctuation">[</span><span class="token punctuation">,</span> Decile <span class="token operator">:</span><span class="token operator">=</span> cut<span class="token punctuation">(</span>UrbanPop<span class="token punctuation">,</span> quantile<span class="token punctuation">(</span>UrbanPop<span class="token punctuation">,</span> probs <span class="token operator">=</span> seq<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> by<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
levels<span class="token punctuation">(</span>DTmu<span class="token operator">$</span>Decile<span class="token punctuation">)</span> <span class="token operator">&lt;-</span> paste0<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">&quot;D&quot;</span><span class="token punctuation">)</span>

</code></pre></div><p>Now, casting <code>Decile ~ Crime</code> produces multiple values per cell. I can use <code>fun.aggregate</code> to determine how these are handled. Both text and numerical values can be handle this way.</p> <div class="language-r extra-class"><pre class="language-r"><code>dcast<span class="token punctuation">(</span>DTmu<span class="token punctuation">,</span> Decile <span class="token operator">~</span> Crime<span class="token punctuation">,</span> value.var<span class="token operator">=</span><span class="token string">&quot;Rate&quot;</span><span class="token punctuation">,</span> fun.aggregate<span class="token operator">=</span>sum<span class="token punctuation">)</span>

</code></pre></div><p>This gives:</p> <div class="language-r extra-class"><pre class="language-r"><code>dcast<span class="token punctuation">(</span>DTmu<span class="token punctuation">,</span> Decile <span class="token operator">~</span> Crime<span class="token punctuation">,</span> value.var<span class="token operator">=</span><span class="token string">&quot;Rate&quot;</span><span class="token punctuation">,</span> fun.aggregate<span class="token operator">=</span>mean<span class="token punctuation">)</span>

</code></pre></div><p>This gives:</p> <div class="language- extra-class"><pre class="language-text"><code>
            State UrbanPop  Crime Rate Decile
  1:       Alabama       58 Murder 13.2     4D
  2:        Alaska       48 Murder 10.0     2D
  3:       Arizona       80 Murder  8.1     8D
  4:      Arkansas       50 Murder  8.8     2D
  5:    California       91 Murder  9.0    10D

</code></pre></div><p>There are multiple states in each decile of the urban population. Use <code>fun.aggregate</code> to specify how these should be handled.</p> <div class="language-r extra-class"><pre class="language-r"><code>dcast<span class="token punctuation">(</span>DTmu<span class="token punctuation">,</span> Decile <span class="token operator">~</span> Crime<span class="token punctuation">,</span> value.var<span class="token operator">=</span><span class="token string">&quot;Rate&quot;</span><span class="token punctuation">,</span> fun.aggregate<span class="token operator">=</span>sum<span class="token punctuation">)</span>

</code></pre></div><p>This sums over the data for like states, giving the following.</p> <div class="language- extra-class"><pre class="language-text"><code>
   Decile Murder Assault  Rape
 1:     1D   39.4     808  62.6
 2:     2D   35.3     815  94.3
 3:     3D   22.6     451  67.7
 4:     4D   54.9     898 106.0
 5:     5D   42.4     758 107.6 

</code></pre></div><h4 id="syntax"><a href="#syntax" class="header-anchor">#</a> Syntax</h4> <ul><li>Melt with <code>melt(DT, id.vars=c(..), variable.name=&quot;CategoryLabel&quot;, value.name=&quot;Value&quot;)</code></li> <li>Cast with <code>dcast(DT, LHS ~ RHS, value.var=&quot;Value&quot;, fun.aggregate=sum)</code></li></ul> <h4 id="parameters"><a href="#parameters" class="header-anchor">#</a> Parameters</h4> <table><thead><tr><th>Parameter</th> <th>Details</th></tr></thead> <tbody><tr><td>id.vars</td> <td>tell <code>melt</code> which columns to retain</td></tr> <tr><td>variable.name</td> <td>tell <code>melt</code> what to call the column with category labels</td></tr> <tr><td>value.name</td> <td>tell <code>melt</code> what to call the column that has values associated with category labels</td></tr> <tr><td>value.var</td> <td>tell <code>dcast</code> where to find the values to cast in columns</td></tr> <tr><td>formula</td> <td>tell <code>dcast</code> which columns to retain to form a unique record identifier (LHS) and which one holds the category labels (RHS)</td></tr> <tr><td>fun.aggregate</td> <td>specify the function to use when the casting operation generates a list of values in each cell</td></tr></tbody></table> <h4 id="remarks"><a href="#remarks" class="header-anchor">#</a> Remarks</h4> <p>Much of what goes into conditioning data to build models or visualizations can be accomplished with <code>data.table</code>. As compare to other options, <code>data.table</code> offers advantages of speed and flexibility.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/r/pivot-and-unpivot-with-data-table.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/r/data-table.html" class="prev">
        data.table
      </a></span> <span class="next"><a href="/r/bar-chart.html">
        Bar Chart
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.ced448ab.js" defer></script><script src="/assets/js/3.f1d73125.js" defer></script><script src="/assets/js/2926.0a73c71f.js" defer></script>
  </body>
</html>
