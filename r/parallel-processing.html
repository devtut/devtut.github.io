<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>R - Parallel processing</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Parallel processing with parallel package, Parallel processing with foreach package, Random Number Generation, mcparallelDo">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="R - Parallel processing">
    <meta property="og:description" content="Parallel processing with parallel package, Parallel processing with foreach package, Random Number Generation, mcparallelDo">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/r/parallel-processing.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="R - Parallel processing">
    <meta name="twitter:description" content="Parallel processing with parallel package, Parallel processing with foreach package, Random Number Generation, mcparallelDo">
    <meta name="twitter:url" content="/r/parallel-processing.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    <link rel="preload" href="/assets/css/0.styles.8b877eb8.css" as="style"><link rel="preload" href="/assets/js/app.ced448ab.js" as="script"><link rel="preload" href="/assets/js/3.f1d73125.js" as="script"><link rel="preload" href="/assets/js/2922.28fbf565.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.8b877eb8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>R</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/r/" class="sidebar-link">Disclaimer</a></li><li><a href="/r/getting-started-with-r-language.html" class="sidebar-link">Getting started with R Language</a></li><li><a href="/r/variables.html" class="sidebar-link">Variables</a></li><li><a href="/r/arithmetic-operators.html" class="sidebar-link">Arithmetic Operators</a></li><li><a href="/r/matrices.html" class="sidebar-link">Matrices</a></li><li><a href="/r/formula.html" class="sidebar-link">Formula</a></li><li><a href="/r/reading-and-writing-strings.html" class="sidebar-link">Reading and writing strings</a></li><li><a href="/r/string-manipulation-with-stringi-package.html" class="sidebar-link">String manipulation with stringi package</a></li><li><a href="/r/classes.html" class="sidebar-link">Classes</a></li><li><a href="/r/lists.html" class="sidebar-link">Lists</a></li><li><a href="/r/hashmaps.html" class="sidebar-link">Hashmaps</a></li><li><a href="/r/creating-vectors.html" class="sidebar-link">Creating vectors</a></li><li><a href="/r/date-and-time.html" class="sidebar-link">Date and Time</a></li><li><a href="/r/the-date-class.html" class="sidebar-link">The Date class</a></li><li><a href="/r/date-time-classes-posixct-and-posixlt.html" class="sidebar-link">Date-time classes (POSIXct and POSIXlt)</a></li><li><a href="/r/the-character-class.html" class="sidebar-link">The character class</a></li><li><a href="/r/numeric-classes-and-storage-modes.html" class="sidebar-link">Numeric classes and storage modes</a></li><li><a href="/r/the-logical-class.html" class="sidebar-link">The logical class</a></li><li><a href="/r/data-frames.html" class="sidebar-link">Data frames</a></li><li><a href="/r/split-function.html" class="sidebar-link">Split function</a></li><li><a href="/r/reading-and-writing-tabular-data-in-plain-text-files-csv-tsv-etc.html" class="sidebar-link">Reading and writing tabular data in plain-text files (CSV, TSV, etc.)</a></li><li><a href="/r/pipe-operators-and-others.html" class="sidebar-link">Pipe operators (%&gt;% and others)</a></li><li><a href="/r/linear-models-regression.html" class="sidebar-link">Linear Models (Regression)</a></li><li><a href="/r/data-table.html" class="sidebar-link">data.table</a></li><li><a href="/r/pivot-and-unpivot-with-data-table.html" class="sidebar-link">Pivot and unpivot with data.table</a></li><li><a href="/r/bar-chart.html" class="sidebar-link">Bar Chart</a></li><li><a href="/r/base-plotting.html" class="sidebar-link">Base Plotting</a></li><li><a href="/r/boxplot.html" class="sidebar-link">boxplot</a></li><li><a href="/r/ggplot2.html" class="sidebar-link">ggplot2</a></li><li><a href="/r/factors.html" class="sidebar-link">Factors</a></li><li><a href="/r/pattern-matching-and-replacement.html" class="sidebar-link">Pattern Matching and Replacement</a></li><li><a href="/r/run-length-encoding.html" class="sidebar-link">Run-length encoding</a></li><li><a href="/r/speeding-up-tough-to-vectorize-code.html" class="sidebar-link">Speeding up tough-to-vectorize code</a></li><li><a href="/r/introduction-to-geographical-maps.html" class="sidebar-link">Introduction to Geographical Maps</a></li><li><a href="/r/set-operations.html" class="sidebar-link">Set operations</a></li><li><a href="/r/tidyverse.html" class="sidebar-link">tidyverse</a></li><li><a href="/r/rcpp.html" class="sidebar-link">Rcpp</a></li><li><a href="/r/random-numbers-generator.html" class="sidebar-link">Random Numbers Generator</a></li><li><a href="/r/parallel-processing.html" class="active sidebar-link">Parallel processing</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/r/parallel-processing.html#parallel-processing-with-parallel-package" class="sidebar-link">Parallel processing with parallel package</a></li><li class="sidebar-sub-header"><a href="/r/parallel-processing.html#parallel-processing-with-foreach-package" class="sidebar-link">Parallel processing with foreach package</a></li><li class="sidebar-sub-header"><a href="/r/parallel-processing.html#random-number-generation" class="sidebar-link">Random Number Generation</a></li><li class="sidebar-sub-header"><a href="/r/parallel-processing.html#mcparalleldo" class="sidebar-link">mcparallelDo</a></li></ul></li><li><a href="/r/subsetting.html" class="sidebar-link">Subsetting</a></li><li><a href="/r/debugging.html" class="sidebar-link">Debugging</a></li><li><a href="/r/installing-packages.html" class="sidebar-link">Installing packages</a></li><li><a href="/r/updating-r-and-the-package-library.html" class="sidebar-link">Updating R and the package library</a></li><li><a href="/r/inspecting-packages.html" class="sidebar-link">Inspecting packages</a></li><li><a href="/r/creating-packages-with-devtools.html" class="sidebar-link">Creating packages with devtools</a></li><li><a href="/r/using-pipe-assignment-in-your-own-package-how-to.html" class="sidebar-link">Using pipe assignment in your own package %%: How to ?</a></li><li><a href="/r/arima-models.html" class="sidebar-link">Arima Models</a></li><li><a href="/r/distribution-functions.html" class="sidebar-link">Distribution Functions</a></li><li><a href="/r/shiny.html" class="sidebar-link">Shiny</a></li><li><a href="/r/spatial-analysis.html" class="sidebar-link">spatial analysis</a></li><li><a href="/r/sqldf.html" class="sidebar-link">sqldf</a></li><li><a href="/r/code-profiling.html" class="sidebar-link">Code profiling</a></li><li><a href="/r/control-flow-structures.html" class="sidebar-link">Control flow structures</a></li><li><a href="/r/column-wise-operation.html" class="sidebar-link">Column wise operation</a></li><li><a href="/r/json.html" class="sidebar-link">JSON</a></li><li><a href="/r/rodbc.html" class="sidebar-link">RODBC</a></li><li><a href="/r/lubridate.html" class="sidebar-link">lubridate</a></li><li><a href="/r/time-series-and-forecasting.html" class="sidebar-link">Time Series and Forecasting</a></li><li><a href="/r/strsplit-function.html" class="sidebar-link">strsplit function</a></li><li><a href="/r/web-scraping-and-parsing.html" class="sidebar-link">Web scraping and parsing</a></li><li><a href="/r/generalized-linear-models.html" class="sidebar-link">Generalized linear models</a></li><li><a href="/r/reshaping-data-between-long-and-wide-forms.html" class="sidebar-link">Reshaping data between long and wide forms</a></li><li><a href="/r/rmarkdown-and-knitr-presentation.html" class="sidebar-link">RMarkdown and knitr presentation</a></li><li><a href="/r/scope-of-variables.html" class="sidebar-link">Scope of variables</a></li><li><a href="/r/performing-a-permutation-test.html" class="sidebar-link">Performing a Permutation Test</a></li><li><a href="/r/xgboost.html" class="sidebar-link">xgboost</a></li><li><a href="/r/r-code-vectorization-best-practices.html" class="sidebar-link">R code vectorization best practices</a></li><li><a href="/r/missing-values.html" class="sidebar-link">Missing values</a></li><li><a href="/r/hierarchical-linear-modeling.html" class="sidebar-link">Hierarchical Linear Modeling</a></li><li><a href="/r/apply-family-of-functions-functionals.html" class="sidebar-link">*apply family of functions (functionals)</a></li><li><a href="/r/text-mining.html" class="sidebar-link">Text mining</a></li><li><a href="/r/anova.html" class="sidebar-link">ANOVA</a></li><li><a href="/r/raster-and-image-analysis.html" class="sidebar-link">Raster and Image Analysis</a></li><li><a href="/r/survival-analysis.html" class="sidebar-link">Survival analysis</a></li><li><a href="/r/fault-tolerant-resilient-code.html" class="sidebar-link">Fault-tolerant/resilient code</a></li><li><a href="/r/reproducible-r.html" class="sidebar-link">Reproducible R</a></li><li><a href="/r/fourier-series-and-transformations.html" class="sidebar-link">Fourier Series and Transformations</a></li><li><a href="/r/rprofile.html" class="sidebar-link">.Rprofile</a></li><li><a href="/r/dplyr.html" class="sidebar-link">dplyr</a></li><li><a href="/r/caret.html" class="sidebar-link">caret</a></li><li><a href="/r/extracting-and-listing-files-in-compressed-archives.html" class="sidebar-link">Extracting and Listing Files in Compressed Archives</a></li><li><a href="/r/probability-distributions-with-r.html" class="sidebar-link">Probability Distributions with R</a></li><li><a href="/r/r-in-latex-with-knitr.html" class="sidebar-link">R in LaTeX with knitr</a></li><li><a href="/r/web-crawling-in-r.html" class="sidebar-link">Web Crawling in R</a></li><li><a href="/r/creating-reports-with-rmarkdown.html" class="sidebar-link">Creating reports with RMarkdown</a></li><li><a href="/r/gpu-accelerated-computing.html" class="sidebar-link">GPU-accelerated computing</a></li><li><a href="/r/heatmap-and-heatmap-2.html" class="sidebar-link">heatmap and heatmap.2</a></li><li><a href="/r/network-analysis-with-the-igraph-package.html" class="sidebar-link">Network analysis with the igraph package</a></li><li><a href="/r/functional-programming.html" class="sidebar-link">Functional programming</a></li><li><a href="/r/get-user-input.html" class="sidebar-link">Get user input</a></li><li><a href="/r/spark-api-sparkr.html" class="sidebar-link">Spark API (SparkR)</a></li><li><a href="/r/meta-documentation-guidelines.html" class="sidebar-link">Meta: Documentation Guidelines</a></li><li><a href="/r/input-and-output.html" class="sidebar-link">Input and output</a></li><li><a href="/r/i-o-for-foreign-tables-excel-sas-spss-stata.html" class="sidebar-link">I/O for foreign tables (Excel, SAS, SPSS, Stata)</a></li><li><a href="/r/i-o-for-database-tables.html" class="sidebar-link">I/O for database tables</a></li><li><a href="/r/i-o-for-geographic-data-shapefiles-etc.html" class="sidebar-link">I/O for geographic data (shapefiles, etc.)</a></li><li><a href="/r/i-o-for-raster-images.html" class="sidebar-link">I/O for raster images</a></li><li><a href="/r/i-o-for-r-s-binary-format.html" class="sidebar-link">I/O for R's binary format</a></li><li><a href="/r/recycling.html" class="sidebar-link">Recycling</a></li><li><a href="/r/expression-parse-eval.html" class="sidebar-link">Expression: parse + eval</a></li><li><a href="/r/regular-expression-syntax-in-r.html" class="sidebar-link">Regular Expression Syntax in R</a></li><li><a href="/r/regular-expressions-regex.html" class="sidebar-link">Regular Expressions (regex)</a></li><li><a href="/r/combinatorics.html" class="sidebar-link">Combinatorics</a></li><li><a href="/r/solving-odes-in-r.html" class="sidebar-link">Solving ODEs in R</a></li><li><a href="/r/feature-selection-in-r-removing-extraneous-features.html" class="sidebar-link">Feature Selection in R -- Removing Extraneous Features</a></li><li><a href="/r/bibliography-in-rmd.html" class="sidebar-link">Bibliography in RMD</a></li><li><a href="/r/writing-functions-in-r.html" class="sidebar-link">Writing functions in R</a></li><li><a href="/r/color-schemes-for-graphics.html" class="sidebar-link">Color schemes for graphics</a></li><li><a href="/r/hierarchical-clustering-with-hclust.html" class="sidebar-link">Hierarchical clustering with hclust</a></li><li><a href="/r/random-forest-algorithm.html" class="sidebar-link">Random Forest Algorithm</a></li><li><a href="/r/restful-r-services.html" class="sidebar-link">RESTful R Services</a></li><li><a href="/r/machine-learning.html" class="sidebar-link">Machine learning</a></li><li><a href="/r/using-texreg-to-export-models-in-a-paper-ready-way.html" class="sidebar-link">Using texreg to export models in a paper-ready way</a></li><li><a href="/r/publishing.html" class="sidebar-link">Publishing</a></li><li><a href="/r/implement-state-machine-pattern-using-s4-class.html" class="sidebar-link">Implement State Machine Pattern using S4 Class</a></li><li><a href="/r/reshape-using-tidyr.html" class="sidebar-link">Reshape using tidyr</a></li><li><a href="/r/modifying-strings-by-substitution.html" class="sidebar-link">Modifying strings by substitution</a></li><li><a href="/r/non-standard-evaluation-and-standard-evaluation.html" class="sidebar-link">Non-standard evaluation and standard evaluation</a></li><li><a href="/r/randomization.html" class="sidebar-link">Randomization</a></li><li><a href="/r/object-oriented-programming-in-r.html" class="sidebar-link">Object-Oriented Programming in R</a></li><li><a href="/r/coercion.html" class="sidebar-link">Coercion</a></li><li><a href="/r/standardize-analyses-by-writing-standalone-r-scripts.html" class="sidebar-link">Standardize analyses by writing standalone R scripts</a></li><li><a href="/r/analyze-tweets-with-r.html" class="sidebar-link">Analyze tweets with R</a></li><li><a href="/r/natural-language-processing.html" class="sidebar-link">Natural language processing</a></li><li><a href="/r/r-markdown-notebooks-from-rstudio.html" class="sidebar-link">R Markdown Notebooks (from RStudio)</a></li><li><a href="/r/aggregating-data-frames.html" class="sidebar-link">Aggregating data frames</a></li><li><a href="/r/data-acquisition.html" class="sidebar-link">Data acquisition</a></li><li><a href="/r/r-memento-by-examples.html" class="sidebar-link">R memento by examples</a></li><li><a href="/r/updating-r-version.html" class="sidebar-link">Updating R version</a></li><li><a href="/r/introspection.html" class="sidebar-link">Introspection</a></li><li><a href="/r/roxygen2.html" class="sidebar-link">roxygen2</a></li><li><a href="/r/cleaning-data.html" class="sidebar-link">Cleaning data</a></li><li><a href="/r/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="parallel-processing"><a href="#parallel-processing" class="header-anchor">#</a> Parallel processing</h1> <h2 id="parallel-processing-with-parallel-package"><a href="#parallel-processing-with-parallel-package" class="header-anchor">#</a> Parallel processing with parallel package</h2> <p>The base package <code>parallel</code> allows parallel computation through forking, sockets, and random-number generation.</p> <p>Detect the number of cores present on the localhost:</p> <div class="language-r extra-class"><pre class="language-r"><code>parallel<span class="token operator">::</span>detectCores<span class="token punctuation">(</span>all.tests <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span> logical <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>

</code></pre></div><p>Create a cluster of the cores on the localhost:</p> <div class="language-r extra-class"><pre class="language-r"><code>parallelCluster <span class="token operator">&lt;-</span> parallel<span class="token operator">::</span>makeCluster<span class="token punctuation">(</span>parallel<span class="token operator">::</span>detectCores<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><p>First, a function appropriate for parallelization must be created. Consider the <code>mtcars</code> dataset.  A regression on <code>mpg</code> could be improved by creating a separate regression model for each level of <code>cyl</code>.</p> <div class="language-r extra-class"><pre class="language-r"><code>data <span class="token operator">&lt;-</span> mtcars
yfactor <span class="token operator">&lt;-</span> <span class="token string">'cyl'</span>
zlevels <span class="token operator">&lt;-</span> sort<span class="token punctuation">(</span>unique<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token punctuation">[</span>yfactor<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
datay <span class="token operator">&lt;-</span> data<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span>
dataz <span class="token operator">&lt;-</span> data<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span>
datax <span class="token operator">&lt;-</span> data<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token operator">:</span><span class="token number">11</span><span class="token punctuation">]</span>


fitmodel <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>zlevel<span class="token punctuation">,</span> datax<span class="token punctuation">,</span> datay<span class="token punctuation">,</span> dataz<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  glm.fit<span class="token punctuation">(</span>x <span class="token operator">=</span> datax<span class="token punctuation">[</span>dataz <span class="token operator">==</span> zlevel<span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y <span class="token operator">=</span> datay<span class="token punctuation">[</span>dataz <span class="token operator">==</span> zlevel<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><p>Create a function that can loop through all the possible iterations of <code>zlevels</code>. This is still in serial, but is an important step as it determines the exact process that will be parallelized.</p> <div class="language-r extra-class"><pre class="language-r"><code>fitmodel <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>zlevel<span class="token punctuation">,</span> datax<span class="token punctuation">,</span> datay<span class="token punctuation">,</span> dataz<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  glm.fit<span class="token punctuation">(</span>x <span class="token operator">=</span> datax<span class="token punctuation">[</span>dataz <span class="token operator">==</span> zlevel<span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y <span class="token operator">=</span> datay<span class="token punctuation">[</span>dataz <span class="token operator">==</span> zlevel<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>


<span class="token keyword">for</span> <span class="token punctuation">(</span>zlevel <span class="token keyword">in</span> zlevels<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  print<span class="token punctuation">(</span><span class="token string">&quot;*****&quot;</span><span class="token punctuation">)</span>
  print<span class="token punctuation">(</span>zlevel<span class="token punctuation">)</span>
  print<span class="token punctuation">(</span>fitmodel<span class="token punctuation">(</span>zlevel<span class="token punctuation">,</span> datax<span class="token punctuation">,</span> datay<span class="token punctuation">,</span> dataz<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><p>Curry this function:</p> <div class="language-r extra-class"><pre class="language-r"><code>worker <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>zlevel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fitmodel<span class="token punctuation">(</span>zlevel<span class="token punctuation">,</span>datax<span class="token punctuation">,</span> datay<span class="token punctuation">,</span> dataz<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

</code></pre></div><p>Parallel computing using <code>parallel</code> cannot access the global environment. Luckily, each function creates a local environment <code>parallel</code> can access. Creation of a wrapper function allows for parallelization. The function to be applied also needs to be placed within the environment.</p> <div class="language-r extra-class"><pre class="language-r"><code>wrapper <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>datax<span class="token punctuation">,</span> datay<span class="token punctuation">,</span> dataz<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment"># force evaluation of all paramters not supplied by parallelization apply</span>
  force<span class="token punctuation">(</span>datax<span class="token punctuation">)</span>
  force<span class="token punctuation">(</span>datay<span class="token punctuation">)</span>
  force<span class="token punctuation">(</span>dataz<span class="token punctuation">)</span>
  <span class="token comment"># these variables are now in an enviroment accessible by parallel function</span>
  
  <span class="token comment"># function to be applied also in the environment</span>
  fitmodel <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>zlevel<span class="token punctuation">,</span> datax<span class="token punctuation">,</span> datay<span class="token punctuation">,</span> dataz<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    glm.fit<span class="token punctuation">(</span>x <span class="token operator">=</span> datax<span class="token punctuation">[</span>dataz <span class="token operator">==</span> zlevel<span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y <span class="token operator">=</span> datay<span class="token punctuation">[</span>dataz <span class="token operator">==</span> zlevel<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment"># calling in this environment iterating over single parameter zlevel</span>
  worker <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>zlevel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fitmodel<span class="token punctuation">(</span>zlevel<span class="token punctuation">,</span>datax<span class="token punctuation">,</span> datay<span class="token punctuation">,</span> dataz<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  return<span class="token punctuation">(</span>worker<span class="token punctuation">)</span> 
<span class="token punctuation">}</span>

</code></pre></div><p>Now create a cluster and run the wrapper function.</p> <div class="language-r extra-class"><pre class="language-r"><code>parallelcluster <span class="token operator">&lt;-</span> parallel<span class="token operator">::</span>makeCluster<span class="token punctuation">(</span>parallel<span class="token operator">::</span>detectCores<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
models <span class="token operator">&lt;-</span> parallel<span class="token operator">::</span>parLapply<span class="token punctuation">(</span>parallelcluster<span class="token punctuation">,</span>zlevels<span class="token punctuation">,</span>
                              wrapper<span class="token punctuation">(</span>datax<span class="token punctuation">,</span> datay<span class="token punctuation">,</span> dataz<span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><p>Always stop the cluster when finished.</p> <div class="language-r extra-class"><pre class="language-r"><code>parallel<span class="token operator">::</span>stopCluster<span class="token punctuation">(</span>parallelcluster<span class="token punctuation">)</span>

</code></pre></div><p>The <code>parallel</code> package includes the entire <code>apply()</code> family, prefixed with <code>par</code>.</p> <h2 id="parallel-processing-with-foreach-package"><a href="#parallel-processing-with-foreach-package" class="header-anchor">#</a> Parallel processing with foreach package</h2> <p>The <code>foreach</code> package brings the power of parallel processing to R. But before you want to use multi core CPUs you have to assign a multi core cluster. The <code>doSNOW</code> package is one possibility.</p> <p>A simple use of the foreach loop is to calculate the sum of the square root and the square of all numbers from 1 to 100000.</p> <div class="language-r extra-class"><pre class="language-r"><code>library<span class="token punctuation">(</span>foreach<span class="token punctuation">)</span>
library<span class="token punctuation">(</span>doSNOW<span class="token punctuation">)</span>

cl <span class="token operator">&lt;-</span> makeCluster<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token string">&quot;SOCK&quot;</span><span class="token punctuation">)</span>
registerDoSNOW<span class="token punctuation">(</span>cl<span class="token punctuation">)</span>

f <span class="token operator">&lt;-</span> foreach<span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">100000</span><span class="token punctuation">,</span> .combine <span class="token operator">=</span> c<span class="token punctuation">,</span> .inorder <span class="token operator">=</span> F<span class="token punctuation">)</span> <span class="token percent-operator operator">%dopar%</span> <span class="token punctuation">{</span>
    k <span class="token operator">&lt;-</span> i <span class="token operator">*</span><span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> sqrt<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    k
<span class="token punctuation">}</span> 

</code></pre></div><p>The structure of the output of <code>foreach</code> is controlled by the <code>.combine</code> argument. The default output structure is a list. In the code above, <code>c</code> is used to return a vector instead. Note that a calculation function (or operator) such as <code>&quot;+&quot;</code> may also be used to perform a calculation and return a further processed object.</p> <p>It is important to mention that the result of each foreach-loop is the last call. Thus, in this example <code>k</code> will be added to the result.</p> <table><thead><tr><th><strong>Parameter</strong></th> <th>Details</th></tr></thead> <tbody><tr><td>.combine</td> <td>combine Function. Determines how the results of the loop are combined. Possible values are <code>c</code>, <code>cbind</code>, <code>rbind</code>, <code>&quot;+&quot;</code>, <code>&quot;*&quot;</code>...</td></tr> <tr><td>.inorder</td> <td>if <code>TRUE</code> the result is ordered according to the order of the iteration vairable (here <code>i</code>). If <code>FALSE</code> the result is not ordered. This can have postive effects on computation time.</td></tr> <tr><td>.packages</td> <td>for functions which are provided by any package except <code>base</code>, like e.g. <code>mass</code>, <code>randomForest</code> or else, you have to provide these packages with <code>c(&quot;mass&quot;, &quot;randomForest&quot;)</code></td></tr></tbody></table> <h2 id="random-number-generation"><a href="#random-number-generation" class="header-anchor">#</a> Random Number Generation</h2> <p>A major problem with parallelization is the used of RNG as seeds. Random numbers by the number are iterated by the number of operations from either the start of the session or the most recent <code>set.seed()</code>. Since parallel processes arise from the same function, it can use the same seed, possibly causing identical results! Calls will run in serial on the different cores, provide no advantage.</p> <p>A set of seeds must be generated and sent to each parallel process. This is automatically done in some packages (<code>parallel</code>, <code>snow</code>, etc.), but must be explicitly addressed in others.</p> <div class="language-r extra-class"><pre class="language-r"><code>s <span class="token operator">&lt;-</span> seed
<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">:</span>numofcores<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    s <span class="token operator">&lt;-</span> nextRNGStream<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
    <span class="token comment"># send s to worker i as .Random.seed</span>
<span class="token punctuation">}</span>

</code></pre></div><p>Seeds can be also be set for reproducibility.</p> <div class="language-r extra-class"><pre class="language-r"><code>clusterSetRNGStream<span class="token punctuation">(</span>cl <span class="token operator">=</span> parallelcluster<span class="token punctuation">,</span> iseed<span class="token punctuation">)</span>

</code></pre></div><h2 id="mcparalleldo"><a href="#mcparalleldo" class="header-anchor">#</a> mcparallelDo</h2> <p>The <code>mcparallelDo</code> package allows for the evaluation of R code asynchronously on Unix-alike (e.g. Linux and MacOSX) operating systems.  The underlying philosophy of the package is aligned with the needs of exploratory data analysis rather than coding.  For coding asynchrony, consider the <a href="https://cran.r-project.org/package=future" target="_blank" rel="noopener noreferrer"><code>future</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> package.</p> <h3 id="example"><a href="#example" class="header-anchor">#</a> Example</h3> <p>Create data</p> <div class="language-r extra-class"><pre class="language-r"><code>data<span class="token punctuation">(</span>ToothGrowth<span class="token punctuation">)</span>

</code></pre></div><p>Trigger mcparallelDo to perform analysis on a fork</p> <div class="language-r extra-class"><pre class="language-r"><code>mcparallelDo<span class="token punctuation">(</span><span class="token punctuation">{</span>glm<span class="token punctuation">(</span>len <span class="token operator">~</span> supp <span class="token operator">*</span> dose<span class="token punctuation">,</span> data<span class="token operator">=</span>ToothGrowth<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;interactionPredictorModel&quot;</span><span class="token punctuation">)</span>

</code></pre></div><p>Do other things, e.g.</p> <div class="language-r extra-class"><pre class="language-r"><code>binaryPredictorModel <span class="token operator">&lt;-</span> glm<span class="token punctuation">(</span>len <span class="token operator">~</span> supp<span class="token punctuation">,</span> data<span class="token operator">=</span>ToothGrowth<span class="token punctuation">)</span>
gaussianPredictorModel <span class="token operator">&lt;-</span> glm<span class="token punctuation">(</span>len <span class="token operator">~</span> dose<span class="token punctuation">,</span> data<span class="token operator">=</span>ToothGrowth<span class="token punctuation">)</span>

</code></pre></div><p>The result from mcparallelDo returns in your targetEnvironment, e.g. .GlobalEnv, when it is complete with a message (by default)</p> <div class="language-r extra-class"><pre class="language-r"><code>summary<span class="token punctuation">(</span>interactionPredictorModel<span class="token punctuation">)</span>

</code></pre></div><h3 id="other-examples"><a href="#other-examples" class="header-anchor">#</a> Other Examples</h3> <div class="language-r extra-class"><pre class="language-r"><code><span class="token comment"># Example of not returning a value until we return to the top level</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    mcparallelDo<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span> targetValue <span class="token operator">=</span> <span class="token string">&quot;output&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>exists<span class="token punctuation">(</span><span class="token string">&quot;output&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> print<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment"># Example of getting a value without returning to the top level</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    mcparallelDo<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span> targetValue <span class="token operator">=</span> <span class="token string">&quot;output&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  mcparallelDoCheck<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>exists<span class="token punctuation">(</span><span class="token string">&quot;output&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> print<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="remarks"><a href="#remarks" class="header-anchor">#</a> Remarks</h4> <p>Parallelization on remote machines require libraries to be downloaded on each machine. Prefer <code>package::function()</code> calls. Several packages have parallelization natively built-in, including <code>caret</code>, <code>pls</code> and <code>plyr</code>.</p> <p><a href="https://mran.revolutionanalytics.com/" target="_blank" rel="noopener noreferrer">Microsoft R Open<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> (Revolution R) also uses multi-threaded BLAS/LAPACK libraries which intrinsically parallelizes many common functions.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/r/parallel-processing.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/r/random-numbers-generator.html" class="prev">
        Random Numbers Generator
      </a></span> <span class="next"><a href="/r/subsetting.html">
        Subsetting
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.ced448ab.js" defer></script><script src="/assets/js/3.f1d73125.js" defer></script><script src="/assets/js/2922.28fbf565.js" defer></script>
  </body>
</html>
