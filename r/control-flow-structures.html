<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>R - Control flow structures</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Optimal Construction of a For Loop, Basic For Loop Construction, The Other Looping Constructs: while and repeat">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="R - Control flow structures">
    <meta property="og:description" content="Optimal Construction of a For Loop, Basic For Loop Construction, The Other Looping Constructs: while and repeat">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/r/control-flow-structures.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="R - Control flow structures">
    <meta name="twitter:description" content="Optimal Construction of a For Loop, Basic For Loop Construction, The Other Looping Constructs: while and repeat">
    <meta name="twitter:url" content="/r/control-flow-structures.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    <link rel="preload" href="/assets/css/0.styles.8b877eb8.css" as="style"><link rel="preload" href="/assets/js/app.ced448ab.js" as="script"><link rel="preload" href="/assets/js/3.f1d73125.js" as="script"><link rel="preload" href="/assets/js/2868.1440763a.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.8b877eb8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>R</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/r/" class="sidebar-link">Disclaimer</a></li><li><a href="/r/getting-started-with-r-language.html" class="sidebar-link">Getting started with R Language</a></li><li><a href="/r/variables.html" class="sidebar-link">Variables</a></li><li><a href="/r/arithmetic-operators.html" class="sidebar-link">Arithmetic Operators</a></li><li><a href="/r/matrices.html" class="sidebar-link">Matrices</a></li><li><a href="/r/formula.html" class="sidebar-link">Formula</a></li><li><a href="/r/reading-and-writing-strings.html" class="sidebar-link">Reading and writing strings</a></li><li><a href="/r/string-manipulation-with-stringi-package.html" class="sidebar-link">String manipulation with stringi package</a></li><li><a href="/r/classes.html" class="sidebar-link">Classes</a></li><li><a href="/r/lists.html" class="sidebar-link">Lists</a></li><li><a href="/r/hashmaps.html" class="sidebar-link">Hashmaps</a></li><li><a href="/r/creating-vectors.html" class="sidebar-link">Creating vectors</a></li><li><a href="/r/date-and-time.html" class="sidebar-link">Date and Time</a></li><li><a href="/r/the-date-class.html" class="sidebar-link">The Date class</a></li><li><a href="/r/date-time-classes-posixct-and-posixlt.html" class="sidebar-link">Date-time classes (POSIXct and POSIXlt)</a></li><li><a href="/r/the-character-class.html" class="sidebar-link">The character class</a></li><li><a href="/r/numeric-classes-and-storage-modes.html" class="sidebar-link">Numeric classes and storage modes</a></li><li><a href="/r/the-logical-class.html" class="sidebar-link">The logical class</a></li><li><a href="/r/data-frames.html" class="sidebar-link">Data frames</a></li><li><a href="/r/split-function.html" class="sidebar-link">Split function</a></li><li><a href="/r/reading-and-writing-tabular-data-in-plain-text-files-csv-tsv-etc.html" class="sidebar-link">Reading and writing tabular data in plain-text files (CSV, TSV, etc.)</a></li><li><a href="/r/pipe-operators-and-others.html" class="sidebar-link">Pipe operators (%&gt;% and others)</a></li><li><a href="/r/linear-models-regression.html" class="sidebar-link">Linear Models (Regression)</a></li><li><a href="/r/data-table.html" class="sidebar-link">data.table</a></li><li><a href="/r/pivot-and-unpivot-with-data-table.html" class="sidebar-link">Pivot and unpivot with data.table</a></li><li><a href="/r/bar-chart.html" class="sidebar-link">Bar Chart</a></li><li><a href="/r/base-plotting.html" class="sidebar-link">Base Plotting</a></li><li><a href="/r/boxplot.html" class="sidebar-link">boxplot</a></li><li><a href="/r/ggplot2.html" class="sidebar-link">ggplot2</a></li><li><a href="/r/factors.html" class="sidebar-link">Factors</a></li><li><a href="/r/pattern-matching-and-replacement.html" class="sidebar-link">Pattern Matching and Replacement</a></li><li><a href="/r/run-length-encoding.html" class="sidebar-link">Run-length encoding</a></li><li><a href="/r/speeding-up-tough-to-vectorize-code.html" class="sidebar-link">Speeding up tough-to-vectorize code</a></li><li><a href="/r/introduction-to-geographical-maps.html" class="sidebar-link">Introduction to Geographical Maps</a></li><li><a href="/r/set-operations.html" class="sidebar-link">Set operations</a></li><li><a href="/r/tidyverse.html" class="sidebar-link">tidyverse</a></li><li><a href="/r/rcpp.html" class="sidebar-link">Rcpp</a></li><li><a href="/r/random-numbers-generator.html" class="sidebar-link">Random Numbers Generator</a></li><li><a href="/r/parallel-processing.html" class="sidebar-link">Parallel processing</a></li><li><a href="/r/subsetting.html" class="sidebar-link">Subsetting</a></li><li><a href="/r/debugging.html" class="sidebar-link">Debugging</a></li><li><a href="/r/installing-packages.html" class="sidebar-link">Installing packages</a></li><li><a href="/r/updating-r-and-the-package-library.html" class="sidebar-link">Updating R and the package library</a></li><li><a href="/r/inspecting-packages.html" class="sidebar-link">Inspecting packages</a></li><li><a href="/r/creating-packages-with-devtools.html" class="sidebar-link">Creating packages with devtools</a></li><li><a href="/r/using-pipe-assignment-in-your-own-package-how-to.html" class="sidebar-link">Using pipe assignment in your own package %%: How to ?</a></li><li><a href="/r/arima-models.html" class="sidebar-link">Arima Models</a></li><li><a href="/r/distribution-functions.html" class="sidebar-link">Distribution Functions</a></li><li><a href="/r/shiny.html" class="sidebar-link">Shiny</a></li><li><a href="/r/spatial-analysis.html" class="sidebar-link">spatial analysis</a></li><li><a href="/r/sqldf.html" class="sidebar-link">sqldf</a></li><li><a href="/r/code-profiling.html" class="sidebar-link">Code profiling</a></li><li><a href="/r/control-flow-structures.html" class="active sidebar-link">Control flow structures</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/r/control-flow-structures.html#optimal-construction-of-a-for-loop" class="sidebar-link">Optimal Construction of a For Loop</a></li><li class="sidebar-sub-header"><a href="/r/control-flow-structures.html#basic-for-loop-construction" class="sidebar-link">Basic For Loop Construction</a></li><li class="sidebar-sub-header"><a href="/r/control-flow-structures.html#the-other-looping-constructs-while-and-repeat" class="sidebar-link">The Other Looping Constructs: while and repeat</a></li></ul></li><li><a href="/r/column-wise-operation.html" class="sidebar-link">Column wise operation</a></li><li><a href="/r/json.html" class="sidebar-link">JSON</a></li><li><a href="/r/rodbc.html" class="sidebar-link">RODBC</a></li><li><a href="/r/lubridate.html" class="sidebar-link">lubridate</a></li><li><a href="/r/time-series-and-forecasting.html" class="sidebar-link">Time Series and Forecasting</a></li><li><a href="/r/strsplit-function.html" class="sidebar-link">strsplit function</a></li><li><a href="/r/web-scraping-and-parsing.html" class="sidebar-link">Web scraping and parsing</a></li><li><a href="/r/generalized-linear-models.html" class="sidebar-link">Generalized linear models</a></li><li><a href="/r/reshaping-data-between-long-and-wide-forms.html" class="sidebar-link">Reshaping data between long and wide forms</a></li><li><a href="/r/rmarkdown-and-knitr-presentation.html" class="sidebar-link">RMarkdown and knitr presentation</a></li><li><a href="/r/scope-of-variables.html" class="sidebar-link">Scope of variables</a></li><li><a href="/r/performing-a-permutation-test.html" class="sidebar-link">Performing a Permutation Test</a></li><li><a href="/r/xgboost.html" class="sidebar-link">xgboost</a></li><li><a href="/r/r-code-vectorization-best-practices.html" class="sidebar-link">R code vectorization best practices</a></li><li><a href="/r/missing-values.html" class="sidebar-link">Missing values</a></li><li><a href="/r/hierarchical-linear-modeling.html" class="sidebar-link">Hierarchical Linear Modeling</a></li><li><a href="/r/apply-family-of-functions-functionals.html" class="sidebar-link">*apply family of functions (functionals)</a></li><li><a href="/r/text-mining.html" class="sidebar-link">Text mining</a></li><li><a href="/r/anova.html" class="sidebar-link">ANOVA</a></li><li><a href="/r/raster-and-image-analysis.html" class="sidebar-link">Raster and Image Analysis</a></li><li><a href="/r/survival-analysis.html" class="sidebar-link">Survival analysis</a></li><li><a href="/r/fault-tolerant-resilient-code.html" class="sidebar-link">Fault-tolerant/resilient code</a></li><li><a href="/r/reproducible-r.html" class="sidebar-link">Reproducible R</a></li><li><a href="/r/fourier-series-and-transformations.html" class="sidebar-link">Fourier Series and Transformations</a></li><li><a href="/r/rprofile.html" class="sidebar-link">.Rprofile</a></li><li><a href="/r/dplyr.html" class="sidebar-link">dplyr</a></li><li><a href="/r/caret.html" class="sidebar-link">caret</a></li><li><a href="/r/extracting-and-listing-files-in-compressed-archives.html" class="sidebar-link">Extracting and Listing Files in Compressed Archives</a></li><li><a href="/r/probability-distributions-with-r.html" class="sidebar-link">Probability Distributions with R</a></li><li><a href="/r/r-in-latex-with-knitr.html" class="sidebar-link">R in LaTeX with knitr</a></li><li><a href="/r/web-crawling-in-r.html" class="sidebar-link">Web Crawling in R</a></li><li><a href="/r/creating-reports-with-rmarkdown.html" class="sidebar-link">Creating reports with RMarkdown</a></li><li><a href="/r/gpu-accelerated-computing.html" class="sidebar-link">GPU-accelerated computing</a></li><li><a href="/r/heatmap-and-heatmap-2.html" class="sidebar-link">heatmap and heatmap.2</a></li><li><a href="/r/network-analysis-with-the-igraph-package.html" class="sidebar-link">Network analysis with the igraph package</a></li><li><a href="/r/functional-programming.html" class="sidebar-link">Functional programming</a></li><li><a href="/r/get-user-input.html" class="sidebar-link">Get user input</a></li><li><a href="/r/spark-api-sparkr.html" class="sidebar-link">Spark API (SparkR)</a></li><li><a href="/r/meta-documentation-guidelines.html" class="sidebar-link">Meta: Documentation Guidelines</a></li><li><a href="/r/input-and-output.html" class="sidebar-link">Input and output</a></li><li><a href="/r/i-o-for-foreign-tables-excel-sas-spss-stata.html" class="sidebar-link">I/O for foreign tables (Excel, SAS, SPSS, Stata)</a></li><li><a href="/r/i-o-for-database-tables.html" class="sidebar-link">I/O for database tables</a></li><li><a href="/r/i-o-for-geographic-data-shapefiles-etc.html" class="sidebar-link">I/O for geographic data (shapefiles, etc.)</a></li><li><a href="/r/i-o-for-raster-images.html" class="sidebar-link">I/O for raster images</a></li><li><a href="/r/i-o-for-r-s-binary-format.html" class="sidebar-link">I/O for R's binary format</a></li><li><a href="/r/recycling.html" class="sidebar-link">Recycling</a></li><li><a href="/r/expression-parse-eval.html" class="sidebar-link">Expression: parse + eval</a></li><li><a href="/r/regular-expression-syntax-in-r.html" class="sidebar-link">Regular Expression Syntax in R</a></li><li><a href="/r/regular-expressions-regex.html" class="sidebar-link">Regular Expressions (regex)</a></li><li><a href="/r/combinatorics.html" class="sidebar-link">Combinatorics</a></li><li><a href="/r/solving-odes-in-r.html" class="sidebar-link">Solving ODEs in R</a></li><li><a href="/r/feature-selection-in-r-removing-extraneous-features.html" class="sidebar-link">Feature Selection in R -- Removing Extraneous Features</a></li><li><a href="/r/bibliography-in-rmd.html" class="sidebar-link">Bibliography in RMD</a></li><li><a href="/r/writing-functions-in-r.html" class="sidebar-link">Writing functions in R</a></li><li><a href="/r/color-schemes-for-graphics.html" class="sidebar-link">Color schemes for graphics</a></li><li><a href="/r/hierarchical-clustering-with-hclust.html" class="sidebar-link">Hierarchical clustering with hclust</a></li><li><a href="/r/random-forest-algorithm.html" class="sidebar-link">Random Forest Algorithm</a></li><li><a href="/r/restful-r-services.html" class="sidebar-link">RESTful R Services</a></li><li><a href="/r/machine-learning.html" class="sidebar-link">Machine learning</a></li><li><a href="/r/using-texreg-to-export-models-in-a-paper-ready-way.html" class="sidebar-link">Using texreg to export models in a paper-ready way</a></li><li><a href="/r/publishing.html" class="sidebar-link">Publishing</a></li><li><a href="/r/implement-state-machine-pattern-using-s4-class.html" class="sidebar-link">Implement State Machine Pattern using S4 Class</a></li><li><a href="/r/reshape-using-tidyr.html" class="sidebar-link">Reshape using tidyr</a></li><li><a href="/r/modifying-strings-by-substitution.html" class="sidebar-link">Modifying strings by substitution</a></li><li><a href="/r/non-standard-evaluation-and-standard-evaluation.html" class="sidebar-link">Non-standard evaluation and standard evaluation</a></li><li><a href="/r/randomization.html" class="sidebar-link">Randomization</a></li><li><a href="/r/object-oriented-programming-in-r.html" class="sidebar-link">Object-Oriented Programming in R</a></li><li><a href="/r/coercion.html" class="sidebar-link">Coercion</a></li><li><a href="/r/standardize-analyses-by-writing-standalone-r-scripts.html" class="sidebar-link">Standardize analyses by writing standalone R scripts</a></li><li><a href="/r/analyze-tweets-with-r.html" class="sidebar-link">Analyze tweets with R</a></li><li><a href="/r/natural-language-processing.html" class="sidebar-link">Natural language processing</a></li><li><a href="/r/r-markdown-notebooks-from-rstudio.html" class="sidebar-link">R Markdown Notebooks (from RStudio)</a></li><li><a href="/r/aggregating-data-frames.html" class="sidebar-link">Aggregating data frames</a></li><li><a href="/r/data-acquisition.html" class="sidebar-link">Data acquisition</a></li><li><a href="/r/r-memento-by-examples.html" class="sidebar-link">R memento by examples</a></li><li><a href="/r/updating-r-version.html" class="sidebar-link">Updating R version</a></li><li><a href="/r/introspection.html" class="sidebar-link">Introspection</a></li><li><a href="/r/roxygen2.html" class="sidebar-link">roxygen2</a></li><li><a href="/r/cleaning-data.html" class="sidebar-link">Cleaning data</a></li><li><a href="/r/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="control-flow-structures"><a href="#control-flow-structures" class="header-anchor">#</a> Control flow structures</h1> <h2 id="optimal-construction-of-a-for-loop"><a href="#optimal-construction-of-a-for-loop" class="header-anchor">#</a> Optimal Construction of a For Loop</h2> <p>To illustrate the effect of good for loop construction, we will calculate the mean of each column in four different ways:</p> <ol><li>Using a poorly optimized for loop</li> <li>Using a well optimized for for loop</li> <li>Using an <code>*apply</code> family of functions</li> <li>Using the <code>colMeans</code> function</li></ol> <p>Each of these options will be shown in code; a comparison of the computational time to execute each option will be shown; and lastly a discussion of the differences will be given.</p> <h3 id="poorly-optimized-for-loop"><a href="#poorly-optimized-for-loop" class="header-anchor">#</a> Poorly optimized for loop</h3> <div class="language-r extra-class"><pre class="language-r"><code>column_mean_poor <span class="token operator">&lt;-</span> <span class="token keyword">NULL</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">:</span>length<span class="token punctuation">(</span>mtcars<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  column_mean_poor<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;-</span> mean<span class="token punctuation">(</span>mtcars<span class="token punctuation">[</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="well-optimized-for-loop"><a href="#well-optimized-for-loop" class="header-anchor">#</a> Well optimized for loop</h3> <div class="language-r extra-class"><pre class="language-r"><code>column_mean_optimal <span class="token operator">&lt;-</span> vector<span class="token punctuation">(</span><span class="token string">&quot;numeric&quot;</span><span class="token punctuation">,</span> length<span class="token punctuation">(</span>mtcars<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> seq_along<span class="token punctuation">(</span>mtcars<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  column_mean_optimal <span class="token operator">&lt;-</span> mean<span class="token punctuation">(</span>mtcars<span class="token punctuation">[</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="vapply-function"><a href="#vapply-function" class="header-anchor">#</a> <code>vapply</code> Function</h3> <div class="language-r extra-class"><pre class="language-r"><code>column_mean_vapply <span class="token operator">&lt;-</span> vapply<span class="token punctuation">(</span>mtcars<span class="token punctuation">,</span> mean<span class="token punctuation">,</span> numeric<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><h3 id="colmeans-function"><a href="#colmeans-function" class="header-anchor">#</a> <code>colMeans</code> Function</h3> <div class="language-r extra-class"><pre class="language-r"><code>column_mean_colMeans <span class="token operator">&lt;-</span> colMeans<span class="token punctuation">(</span>mtcars<span class="token punctuation">)</span>

</code></pre></div><h3 id="efficiency-comparison"><a href="#efficiency-comparison" class="header-anchor">#</a> Efficiency comparison</h3> <p>The results of benchmarking these four approaches is shown below (code not displayed)</p> <div class="language-r extra-class"><pre class="language-r"><code>Unit<span class="token operator">:</span> microseconds
     expr     min       lq     mean   median       uq     max neval  cld
     poor <span class="token number">240.986</span> <span class="token number">262.0820</span> <span class="token number">287.1125</span> <span class="token number">275.8160</span> <span class="token number">307.2485</span> <span class="token number">442.609</span>   <span class="token number">100</span>    d
  optimal <span class="token number">220.313</span> <span class="token number">237.4455</span> <span class="token number">258.8426</span> <span class="token number">247.0735</span> <span class="token number">280.9130</span> <span class="token number">362.469</span>   <span class="token number">100</span>   c 
   vapply <span class="token number">107.042</span> <span class="token number">109.7320</span> <span class="token number">124.4715</span> <span class="token number">113.4130</span> <span class="token number">132.6695</span> <span class="token number">202.473</span>   <span class="token number">100</span> a   
 colMeans <span class="token number">155.183</span> <span class="token number">161.6955</span> <span class="token number">180.2067</span> <span class="token number">175.0045</span> <span class="token number">194.2605</span> <span class="token number">259.958</span>   <span class="token number">100</span>  b

</code></pre></div><p>Notice that the optimized <code>for</code> loop edged out the poorly constructed for loop.  The poorly constructed for loop is constantly increasing the length of the output object, and at each change of the length, R is reevaluating the class of the object.</p> <p>Some of this overhead burden is removed by the optimized for loop by declaring the type of output object and its length before starting the loop.</p> <p>In this example, however, the use of an <code>vapply</code> function doubles the computational efficiency, largely because we told R that the result had to be numeric (if any one result were not numeric, an error would be returned).</p> <p>Use of the <code>colMeans</code> function is a touch slower than the <code>vapply</code> function. This difference is attributable to some error checks performed in <code>colMeans</code> and mainly to the <code>as.matrix</code> conversion (because <code>mtcars</code> is a <code>data.frame</code>) that weren't performed in the <code>vapply</code> function.</p> <h2 id="basic-for-loop-construction"><a href="#basic-for-loop-construction" class="header-anchor">#</a> Basic For Loop Construction</h2> <p>In this example we will calculate the squared deviance for each column in a data frame, in this case the <code>mtcars</code>.</p> <p>Option A: integer index</p> <div class="language-r extra-class"><pre class="language-r"><code>squared_deviance <span class="token operator">&lt;-</span> vector<span class="token punctuation">(</span><span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span> length<span class="token punctuation">(</span>mtcars<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> seq_along<span class="token punctuation">(</span>mtcars<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  squared_deviance<span class="token punctuation">[</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&lt;-</span> <span class="token punctuation">(</span>mtcars<span class="token punctuation">[</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">-</span> mean<span class="token punctuation">(</span>mtcars<span class="token punctuation">[</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">2</span>
<span class="token punctuation">}</span>

</code></pre></div><p><code>squared_deviance</code> is an 11 elements list, as expected.</p> <div class="language-r extra-class"><pre class="language-r"><code>class<span class="token punctuation">(</span>squared_deviance<span class="token punctuation">)</span>
length<span class="token punctuation">(</span>squared_deviance<span class="token punctuation">)</span>

</code></pre></div><p>Option B: character index</p> <div class="language-r extra-class"><pre class="language-r"><code>squared_deviance <span class="token operator">&lt;-</span> vector<span class="token punctuation">(</span><span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span> length<span class="token punctuation">(</span>mtcars<span class="token punctuation">)</span><span class="token punctuation">)</span>
Squared_deviance <span class="token operator">&lt;-</span> setNames<span class="token punctuation">(</span>squared_deviance<span class="token punctuation">,</span> names<span class="token punctuation">(</span>mtcars<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>k <span class="token keyword">in</span> names<span class="token punctuation">(</span>mtcars<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  squared_deviance<span class="token punctuation">[</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&lt;-</span> <span class="token punctuation">(</span>mtcars<span class="token punctuation">[</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">-</span> mean<span class="token punctuation">(</span>mtcars<span class="token punctuation">[</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">2</span>
<span class="token punctuation">}</span>

</code></pre></div><p>What if we want a <code>data.frame</code> as a result? Well, there are many options for transforming a list into other objects. However, and maybe the simplest in this case, will be to store the <code>for</code> results in a <code>data.frame</code>.</p> <div class="language-r extra-class"><pre class="language-r"><code>squared_deviance <span class="token operator">&lt;-</span> mtcars <span class="token comment">#copy the original</span>
squared_deviance<span class="token punctuation">[</span><span class="token boolean">TRUE</span><span class="token punctuation">]</span><span class="token operator">&lt;-</span><span class="token keyword">NA</span>  <span class="token comment">#replace with NA or do squared_deviance[,]&lt;-NA</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> seq_along<span class="token punctuation">(</span>mtcars<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  squared_deviance<span class="token punctuation">[</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&lt;-</span> <span class="token punctuation">(</span>mtcars<span class="token punctuation">[</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">-</span> mean<span class="token punctuation">(</span>mtcars<span class="token punctuation">[</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">2</span>
<span class="token punctuation">}</span>
dim<span class="token punctuation">(</span>squared_deviance<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">32</span> <span class="token number">11</span>

</code></pre></div><p>The result will be the same event though we use the character option (B).</p> <h2 id="the-other-looping-constructs-while-and-repeat"><a href="#the-other-looping-constructs-while-and-repeat" class="header-anchor">#</a> The Other Looping Constructs: while and repeat</h2> <p>R provides two additional looping constructs, <code>while</code> and <code>repeat</code>, which are typically used in situations where the number of iterations required is indeterminate.</p> <h3 id="the-while-loop"><a href="#the-while-loop" class="header-anchor">#</a> The <code>while</code> loop</h3> <p>The general form of a <code>while</code> loop is as follows,</p> <div class="language-r extra-class"><pre class="language-r"><code><span class="token keyword">while</span> <span class="token punctuation">(</span>condition<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">## do something</span>
    <span class="token comment">## in loop body</span>
<span class="token punctuation">}</span>

</code></pre></div><p>where <code>condition</code> is evaluated prior to entering the loop body. If <code>condition</code> evaluates to <code>TRUE</code>, the code inside of the loop body is executed, and this process repeats until <code>condition</code> evaluates to <code>FALSE</code> (or a <code>break</code> statement is reached; see below). Unlike the <code>for</code> loop, if a <code>while</code> loop uses a variable to perform incremental iterations, the variable must be declared and initialized ahead of time, and must be updated within the loop body. For example, the following loops accomplish the same task:</p> <div class="language-r extra-class"><pre class="language-r"><code><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">0</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cat<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment"># 0 </span>
<span class="token comment"># 1 </span>
<span class="token comment"># 2 </span>
<span class="token comment"># 3 </span>
<span class="token comment"># 4 </span>

i <span class="token operator">&lt;-</span> <span class="token number">0</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cat<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span>
    i <span class="token operator">&lt;-</span> i <span class="token operator">+</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
<span class="token comment"># 0 </span>
<span class="token comment"># 1 </span>
<span class="token comment"># 2 </span>
<span class="token comment"># 3 </span>
<span class="token comment"># 4 </span>

</code></pre></div><p>In the <code>while</code> loop above, the line <code>i &lt;- i + 1</code> is necessary to prevent an infinite loop.</p> <p>Additionally, it is possible to terminate a <code>while</code> loop with a call to <code>break</code> from inside the loop body:</p> <div class="language-r extra-class"><pre class="language-r"><code>iter <span class="token operator">&lt;-</span> <span class="token number">0</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>runif<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.25</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">break</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        iter <span class="token operator">&lt;-</span> iter <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
iter
<span class="token comment">#[1] 4</span>

</code></pre></div><p>In this example, <code>condition</code> is always <code>TRUE</code>, so the only way to terminate the loop is with a call to <code>break</code> inside the body. Note that the final value of <code>iter</code> will depend on the state of your PRNG when this example is run, and should produce different results (essentially) each time the code is executed.</p> <h3 id="the-repeat-loop"><a href="#the-repeat-loop" class="header-anchor">#</a> The <code>repeat</code> loop</h3> <p>The <code>repeat</code> construct is essentially the same as <code>while (TRUE) { ## something }</code>, and has the following form:</p> <div class="language-r extra-class"><pre class="language-r"><code><span class="token keyword">repeat</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">## do something</span>
    <span class="token comment">## in loop body</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><p>The extra <code>{}</code> are not required, but the <code>()</code> are. Rewriting the previous example using <code>repeat</code>,</p> <div class="language-r extra-class"><pre class="language-r"><code>iter <span class="token operator">&lt;-</span> <span class="token number">0</span>
<span class="token keyword">repeat</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>runif<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.25</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">break</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        iter <span class="token operator">&lt;-</span> iter <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
iter
<span class="token comment">#[1] 2 </span>

</code></pre></div><h3 id="more-on-break"><a href="#more-on-break" class="header-anchor">#</a> More on <code>break</code></h3> <p>It's important to note that <code>break</code> will <strong>only terminate the immediately enclosing loop</strong>. That is, the following is an infinite loop:</p> <div class="language-r extra-class"><pre class="language-r"><code><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cat<span class="token punctuation">(</span><span class="token string">&quot;inner loop\n&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>
    <span class="token punctuation">}</span>
    cat<span class="token punctuation">(</span><span class="token string">&quot;outer loop\n&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><p>With a little creativity, however, it is possible to break entirely from within a nested loop. As an example, consider the following expression, which, in its current state, will loop infinitely:</p> <div class="language-r extra-class"><pre class="language-r"><code><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cat<span class="token punctuation">(</span><span class="token string">&quot;outer loop body\n&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cat<span class="token punctuation">(</span><span class="token string">&quot;inner loop body\n&quot;</span><span class="token punctuation">)</span>
        x <span class="token operator">&lt;-</span> runif<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&lt;</span> <span class="token number">.3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">break</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            cat<span class="token punctuation">(</span>sprintf<span class="token punctuation">(</span><span class="token string">&quot;x is %.5f\n&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>One possibility is to recognize that, unlike <code>break</code>, the <code>return</code> expression <strong>does</strong> have the ability to return control across multiple levels of enclosing loops. However, since <code>return</code> is only valid when used within a function, we cannot simply replace <code>break</code> with <code>return()</code> above, but also need to wrap the entire expression as an anonymous function:</p> <div class="language-r extra-class"><pre class="language-r"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cat<span class="token punctuation">(</span><span class="token string">&quot;outer loop body\n&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cat<span class="token punctuation">(</span><span class="token string">&quot;inner loop body\n&quot;</span><span class="token punctuation">)</span>
            x <span class="token operator">&lt;-</span> runif<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&lt;</span> <span class="token number">.3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                return<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                cat<span class="token punctuation">(</span>sprintf<span class="token punctuation">(</span><span class="token string">&quot;x is %.5f\n&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre></div><p>Alternatively, we can create a dummy variable (<code>exit</code>) prior to the expression, and activate it via <code>&lt;&lt;-</code> from the inner loop when we are ready to terminate:</p> <div class="language-r extra-class"><pre class="language-r"><code>exit <span class="token operator">&lt;-</span> <span class="token boolean">FALSE</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cat<span class="token punctuation">(</span><span class="token string">&quot;outer loop body\n&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cat<span class="token punctuation">(</span><span class="token string">&quot;inner loop body\n&quot;</span><span class="token punctuation">)</span>
        x <span class="token operator">&lt;-</span> runif<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&lt;</span> <span class="token number">.3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            exit <span class="token operator">&lt;&lt;-</span> <span class="token boolean">TRUE</span>
            <span class="token keyword">break</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            cat<span class="token punctuation">(</span>sprintf<span class="token punctuation">(</span><span class="token string">&quot;x is %.5f\n&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>exit<span class="token punctuation">)</span> <span class="token keyword">break</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="remarks"><a href="#remarks" class="header-anchor">#</a> Remarks</h4> <p>For loops are a flow control method for repeating a task or set of tasks over a domain.  The core structure of a for loop is</p> <div class="language-r extra-class"><pre class="language-r"><code><span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token keyword">in</span> <span class="token punctuation">[</span>domain<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token punctuation">[</span>body<span class="token punctuation">]</span>
<span class="token punctuation">}</span>

</code></pre></div><p>Where</p> <ol><li><code>[index]</code> is a name takes exactly one value of <code>[domain]</code> over each iteration of the loop.</li> <li><code>[domain]</code> is a vector of values over which to iterate.</li> <li><code>[body]</code> is the set of instructions to apply on each iteration.</li></ol> <p>As a trivial example, consider the use of a for loop to obtain the cumulative sum of a vector of values.</p> <div class="language-r extra-class"><pre class="language-r"><code>x <span class="token operator">&lt;-</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">4</span>
cumulative_sum <span class="token operator">&lt;-</span> <span class="token number">0</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> x<span class="token punctuation">)</span><span class="token punctuation">{</span>
  cumulative_sum <span class="token operator">&lt;-</span> cumulative_sum <span class="token operator">+</span> x<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
cumulative_sum

</code></pre></div><h3 id="optimizing-structure-of-for-loops"><a href="#optimizing-structure-of-for-loops" class="header-anchor">#</a> Optimizing Structure of For Loops</h3> <p>For loops can be useful for conceptualizing and executing tasks to repeat. If not constructed carefully, however, they can be very slow to execute compared to the preferred used of the <code>apply</code> family of functions.  Nonetheless, there are a handful of elements you can include in your for loop construction to optimize the loop.  In many cases, good construction of the for loop will yield computational efficiency very close to that of an apply function.</p> <p>A 'properly constructed' for loop builds on the core structure and includes a statement declaring the object that will capture each iteration of the loop.  This object should have both a class and a length declared.</p> <div class="language-r extra-class"><pre class="language-r"><code><span class="token punctuation">[</span>output<span class="token punctuation">]</span> <span class="token operator">&lt;-</span> <span class="token punctuation">[</span>vector_of_length<span class="token punctuation">]</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token keyword">in</span> <span class="token punctuation">[</span>length_safe_domain<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token punctuation">[</span>output<span class="token punctuation">]</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">&lt;-</span> <span class="token punctuation">[</span>body<span class="token punctuation">]</span>
<span class="token punctuation">}</span>

</code></pre></div><p>To illustrate, let us write a loop to square each value in a numeric vector (this is a trivial example for illustration only.  The 'correct' way of completing this task would be <code>x_squared &lt;- x^2</code>).</p> <div class="language-r extra-class"><pre class="language-r"><code>x <span class="token operator">&lt;-</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">100</span>
x_squared <span class="token operator">&lt;-</span> vector<span class="token punctuation">(</span><span class="token string">&quot;numeric&quot;</span><span class="token punctuation">,</span> length <span class="token operator">=</span> length<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> seq_along<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  x_squared<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;-</span> x<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">^</span><span class="token number">2</span>
<span class="token punctuation">}</span>

</code></pre></div><p>Again, notice that we first declared a receptacle for the output <code>x_squared</code>, and gave it the class &quot;numeric&quot; with the same length as <code>x</code>.  Additionally, we declared a &quot;length safe domain&quot; using the <code>seq_along</code> function.  <code>seq_along</code> generates a vector of indices for an object that is suited for use in for loops.  While it seems intuitive to use <code>for (i in 1:length(x))</code>, if <code>x</code> has 0 length, the loop will attempt to iterate over the domain of <code>1:0</code>, resulting in an error (the 0th index is undefined in R).</p> <p>Receptacle objects and length safe domains are handled internally by the <code>apply</code> family of functions and users are encouraged to adopt the <code>apply</code> approach in place of for loops as much as possible.  However, if properly constructed, a for loop may occasionally provide greater code clarity with minimal loss of efficiency.</p> <h3 id="vectorizing-for-loops"><a href="#vectorizing-for-loops" class="header-anchor">#</a> Vectorizing For Loops</h3> <p>For loops can often be a useful tool in conceptualizing the tasks that need to be completed within each iteration.  When the loop is completely developed and conceptualized, there may be advantages to turning the loop into a function.</p> <p>In this example, we will develop a for loop to calculate the mean of each column in the <code>mtcars</code> dataset (again, a trivial example as it could be accomplished via the <code>colMeans</code> function).</p> <div class="language-r extra-class"><pre class="language-r"><code>column_mean_loop <span class="token operator">&lt;-</span> vector<span class="token punctuation">(</span><span class="token string">&quot;numeric&quot;</span><span class="token punctuation">,</span> length<span class="token punctuation">(</span>mtcars<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>k <span class="token keyword">in</span> seq_along<span class="token punctuation">(</span>mtcars<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  column_mean_loop<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">&lt;-</span> mean<span class="token punctuation">(</span>mtcars<span class="token punctuation">[</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><p>The for loop can be converted to an apply function by rewriting the body of the loop as a function.</p> <div class="language-r extra-class"><pre class="language-r"><code>col_mean_fn <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> mean<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
column_mean_apply <span class="token operator">&lt;-</span> vapply<span class="token punctuation">(</span>mtcars<span class="token punctuation">,</span> col_mean_fn<span class="token punctuation">,</span> numeric<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><p>And to compare the results:</p> <div class="language-r extra-class"><pre class="language-r"><code>identical<span class="token punctuation">(</span>column_mean_loop<span class="token punctuation">,</span> 
          unname<span class="token punctuation">(</span>column_mean_apply<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#* vapply added names to the elements</span>
                                     <span class="token comment">#* remove them for comparison</span>

</code></pre></div><p>The advantages of the vectorized form is that we were able to eliminate a few lines of code.  The mechanics of determining the length and type of the output object and iterating over a length safe domain are handled for us by the apply function.  Additionally, the apply function is a little bit faster than the loop.  The difference of speed is often negligible in human terms depending on the number of iterations and the complexity of the body.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/r/control-flow-structures.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      
      <a href="/r/code-profiling.html" class="prev">
        Code profiling
      </a></span> <span class="next"><a href="/r/column-wise-operation.html">
        Column wise operation
      </a>
      
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.ced448ab.js" defer></script><script src="/assets/js/3.f1d73125.js" defer></script><script src="/assets/js/2868.1440763a.js" defer></script>
  </body>
</html>
