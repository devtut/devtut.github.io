<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>R - Linear Models (Regression)</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Linear regression on the mtcars dataset, Weighting, Using the 'predict' function, Checking for nonlinearity with polynomial regression, Plotting The Regression (base), Quality assessment">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="R - Linear Models (Regression)">
    <meta property="og:description" content="Linear regression on the mtcars dataset, Weighting, Using the 'predict' function, Checking for nonlinearity with polynomial regression, Plotting The Regression (base), Quality assessment">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/r/linear-models-regression.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="R - Linear Models (Regression)">
    <meta name="twitter:description" content="Linear regression on the mtcars dataset, Weighting, Using the 'predict' function, Checking for nonlinearity with polynomial regression, Plotting The Regression (base), Quality assessment">
    <meta name="twitter:url" content="/r/linear-models-regression.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/2911.fd1258a9.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>R</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/r/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/r/getting-started-with-r-language.html" class="sidebar-link">Getting started with R Language</a></li><li><a href="/r/variables.html" class="sidebar-link">Variables</a></li><li><a href="/r/arithmetic-operators.html" class="sidebar-link">Arithmetic Operators</a></li><li><a href="/r/matrices.html" class="sidebar-link">Matrices</a></li><li><a href="/r/formula.html" class="sidebar-link">Formula</a></li><li><a href="/r/reading-and-writing-strings.html" class="sidebar-link">Reading and writing strings</a></li><li><a href="/r/string-manipulation-with-stringi-package.html" class="sidebar-link">String manipulation with stringi package</a></li><li><a href="/r/classes.html" class="sidebar-link">Classes</a></li><li><a href="/r/lists.html" class="sidebar-link">Lists</a></li><li><a href="/r/hashmaps.html" class="sidebar-link">Hashmaps</a></li><li><a href="/r/creating-vectors.html" class="sidebar-link">Creating vectors</a></li><li><a href="/r/date-and-time.html" class="sidebar-link">Date and Time</a></li><li><a href="/r/the-date-class.html" class="sidebar-link">The Date class</a></li><li><a href="/r/date-time-classes-posixct-and-posixlt.html" class="sidebar-link">Date-time classes (POSIXct and POSIXlt)</a></li><li><a href="/r/the-character-class.html" class="sidebar-link">The character class</a></li><li><a href="/r/numeric-classes-and-storage-modes.html" class="sidebar-link">Numeric classes and storage modes</a></li><li><a href="/r/the-logical-class.html" class="sidebar-link">The logical class</a></li><li><a href="/r/data-frames.html" class="sidebar-link">Data frames</a></li><li><a href="/r/split-function.html" class="sidebar-link">Split function</a></li><li><a href="/r/reading-and-writing-tabular-data-in-plain-text-files-csv-tsv-etc.html" class="sidebar-link">Reading and writing tabular data in plain-text files (CSV, TSV, etc.)</a></li><li><a href="/r/pipe-operators-and-others.html" class="sidebar-link">Pipe operators (%&gt;% and others)</a></li><li><a href="/r/linear-models-regression.html" aria-current="page" class="active sidebar-link">Linear Models (Regression)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/r/linear-models-regression.html#linear-regression-on-the-mtcars-dataset" class="sidebar-link">Linear regression on the mtcars dataset</a></li><li class="sidebar-sub-header"><a href="/r/linear-models-regression.html#weighting" class="sidebar-link">Weighting</a></li><li class="sidebar-sub-header"><a href="/r/linear-models-regression.html#using-the-predict-function" class="sidebar-link">Using the 'predict' function</a></li><li class="sidebar-sub-header"><a href="/r/linear-models-regression.html#checking-for-nonlinearity-with-polynomial-regression" class="sidebar-link">Checking for nonlinearity with polynomial regression</a></li><li class="sidebar-sub-header"><a href="/r/linear-models-regression.html#plotting-the-regression-base" class="sidebar-link">Plotting The Regression (base)</a></li><li class="sidebar-sub-header"><a href="/r/linear-models-regression.html#quality-assessment" class="sidebar-link">Quality assessment</a></li></ul></li><li><a href="/r/data-table.html" class="sidebar-link">data.table</a></li><li><a href="/r/pivot-and-unpivot-with-data-table.html" class="sidebar-link">Pivot and unpivot with data.table</a></li><li><a href="/r/bar-chart.html" class="sidebar-link">Bar Chart</a></li><li><a href="/r/base-plotting.html" class="sidebar-link">Base Plotting</a></li><li><a href="/r/boxplot.html" class="sidebar-link">boxplot</a></li><li><a href="/r/ggplot2.html" class="sidebar-link">ggplot2</a></li><li><a href="/r/factors.html" class="sidebar-link">Factors</a></li><li><a href="/r/pattern-matching-and-replacement.html" class="sidebar-link">Pattern Matching and Replacement</a></li><li><a href="/r/run-length-encoding.html" class="sidebar-link">Run-length encoding</a></li><li><a href="/r/speeding-up-tough-to-vectorize-code.html" class="sidebar-link">Speeding up tough-to-vectorize code</a></li><li><a href="/r/introduction-to-geographical-maps.html" class="sidebar-link">Introduction to Geographical Maps</a></li><li><a href="/r/set-operations.html" class="sidebar-link">Set operations</a></li><li><a href="/r/tidyverse.html" class="sidebar-link">tidyverse</a></li><li><a href="/r/rcpp.html" class="sidebar-link">Rcpp</a></li><li><a href="/r/random-numbers-generator.html" class="sidebar-link">Random Numbers Generator</a></li><li><a href="/r/parallel-processing.html" class="sidebar-link">Parallel processing</a></li><li><a href="/r/subsetting.html" class="sidebar-link">Subsetting</a></li><li><a href="/r/debugging.html" class="sidebar-link">Debugging</a></li><li><a href="/r/installing-packages.html" class="sidebar-link">Installing packages</a></li><li><a href="/r/updating-r-and-the-package-library.html" class="sidebar-link">Updating R and the package library</a></li><li><a href="/r/inspecting-packages.html" class="sidebar-link">Inspecting packages</a></li><li><a href="/r/creating-packages-with-devtools.html" class="sidebar-link">Creating packages with devtools</a></li><li><a href="/r/using-pipe-assignment-in-your-own-package-how-to.html" class="sidebar-link">Using pipe assignment in your own package %%: How to ?</a></li><li><a href="/r/arima-models.html" class="sidebar-link">Arima Models</a></li><li><a href="/r/distribution-functions.html" class="sidebar-link">Distribution Functions</a></li><li><a href="/r/shiny.html" class="sidebar-link">Shiny</a></li><li><a href="/r/spatial-analysis.html" class="sidebar-link">spatial analysis</a></li><li><a href="/r/sqldf.html" class="sidebar-link">sqldf</a></li><li><a href="/r/code-profiling.html" class="sidebar-link">Code profiling</a></li><li><a href="/r/control-flow-structures.html" class="sidebar-link">Control flow structures</a></li><li><a href="/r/column-wise-operation.html" class="sidebar-link">Column wise operation</a></li><li><a href="/r/json.html" class="sidebar-link">JSON</a></li><li><a href="/r/rodbc.html" class="sidebar-link">RODBC</a></li><li><a href="/r/lubridate.html" class="sidebar-link">lubridate</a></li><li><a href="/r/time-series-and-forecasting.html" class="sidebar-link">Time Series and Forecasting</a></li><li><a href="/r/strsplit-function.html" class="sidebar-link">strsplit function</a></li><li><a href="/r/web-scraping-and-parsing.html" class="sidebar-link">Web scraping and parsing</a></li><li><a href="/r/generalized-linear-models.html" class="sidebar-link">Generalized linear models</a></li><li><a href="/r/reshaping-data-between-long-and-wide-forms.html" class="sidebar-link">Reshaping data between long and wide forms</a></li><li><a href="/r/rmarkdown-and-knitr-presentation.html" class="sidebar-link">RMarkdown and knitr presentation</a></li><li><a href="/r/scope-of-variables.html" class="sidebar-link">Scope of variables</a></li><li><a href="/r/performing-a-permutation-test.html" class="sidebar-link">Performing a Permutation Test</a></li><li><a href="/r/xgboost.html" class="sidebar-link">xgboost</a></li><li><a href="/r/r-code-vectorization-best-practices.html" class="sidebar-link">R code vectorization best practices</a></li><li><a href="/r/missing-values.html" class="sidebar-link">Missing values</a></li><li><a href="/r/hierarchical-linear-modeling.html" class="sidebar-link">Hierarchical Linear Modeling</a></li><li><a href="/r/apply-family-of-functions-functionals.html" class="sidebar-link">*apply family of functions (functionals)</a></li><li><a href="/r/text-mining.html" class="sidebar-link">Text mining</a></li><li><a href="/r/anova.html" class="sidebar-link">ANOVA</a></li><li><a href="/r/raster-and-image-analysis.html" class="sidebar-link">Raster and Image Analysis</a></li><li><a href="/r/survival-analysis.html" class="sidebar-link">Survival analysis</a></li><li><a href="/r/fault-tolerant-resilient-code.html" class="sidebar-link">Fault-tolerant/resilient code</a></li><li><a href="/r/reproducible-r.html" class="sidebar-link">Reproducible R</a></li><li><a href="/r/fourier-series-and-transformations.html" class="sidebar-link">Fourier Series and Transformations</a></li><li><a href="/r/rprofile.html" class="sidebar-link">.Rprofile</a></li><li><a href="/r/dplyr.html" class="sidebar-link">dplyr</a></li><li><a href="/r/caret.html" class="sidebar-link">caret</a></li><li><a href="/r/extracting-and-listing-files-in-compressed-archives.html" class="sidebar-link">Extracting and Listing Files in Compressed Archives</a></li><li><a href="/r/probability-distributions-with-r.html" class="sidebar-link">Probability Distributions with R</a></li><li><a href="/r/r-in-latex-with-knitr.html" class="sidebar-link">R in LaTeX with knitr</a></li><li><a href="/r/web-crawling-in-r.html" class="sidebar-link">Web Crawling in R</a></li><li><a href="/r/creating-reports-with-rmarkdown.html" class="sidebar-link">Creating reports with RMarkdown</a></li><li><a href="/r/gpu-accelerated-computing.html" class="sidebar-link">GPU-accelerated computing</a></li><li><a href="/r/heatmap-and-heatmap-2.html" class="sidebar-link">heatmap and heatmap.2</a></li><li><a href="/r/network-analysis-with-the-igraph-package.html" class="sidebar-link">Network analysis with the igraph package</a></li><li><a href="/r/functional-programming.html" class="sidebar-link">Functional programming</a></li><li><a href="/r/get-user-input.html" class="sidebar-link">Get user input</a></li><li><a href="/r/spark-api-sparkr.html" class="sidebar-link">Spark API (SparkR)</a></li><li><a href="/r/meta-documentation-guidelines.html" class="sidebar-link">Meta: Documentation Guidelines</a></li><li><a href="/r/input-and-output.html" class="sidebar-link">Input and output</a></li><li><a href="/r/i-o-for-foreign-tables-excel-sas-spss-stata.html" class="sidebar-link">I/O for foreign tables (Excel, SAS, SPSS, Stata)</a></li><li><a href="/r/i-o-for-database-tables.html" class="sidebar-link">I/O for database tables</a></li><li><a href="/r/i-o-for-geographic-data-shapefiles-etc.html" class="sidebar-link">I/O for geographic data (shapefiles, etc.)</a></li><li><a href="/r/i-o-for-raster-images.html" class="sidebar-link">I/O for raster images</a></li><li><a href="/r/i-o-for-r-s-binary-format.html" class="sidebar-link">I/O for R's binary format</a></li><li><a href="/r/recycling.html" class="sidebar-link">Recycling</a></li><li><a href="/r/expression-parse-eval.html" class="sidebar-link">Expression: parse + eval</a></li><li><a href="/r/regular-expression-syntax-in-r.html" class="sidebar-link">Regular Expression Syntax in R</a></li><li><a href="/r/regular-expressions-regex.html" class="sidebar-link">Regular Expressions (regex)</a></li><li><a href="/r/combinatorics.html" class="sidebar-link">Combinatorics</a></li><li><a href="/r/solving-odes-in-r.html" class="sidebar-link">Solving ODEs in R</a></li><li><a href="/r/feature-selection-in-r-removing-extraneous-features.html" class="sidebar-link">Feature Selection in R -- Removing Extraneous Features</a></li><li><a href="/r/bibliography-in-rmd.html" class="sidebar-link">Bibliography in RMD</a></li><li><a href="/r/writing-functions-in-r.html" class="sidebar-link">Writing functions in R</a></li><li><a href="/r/color-schemes-for-graphics.html" class="sidebar-link">Color schemes for graphics</a></li><li><a href="/r/hierarchical-clustering-with-hclust.html" class="sidebar-link">Hierarchical clustering with hclust</a></li><li><a href="/r/random-forest-algorithm.html" class="sidebar-link">Random Forest Algorithm</a></li><li><a href="/r/restful-r-services.html" class="sidebar-link">RESTful R Services</a></li><li><a href="/r/machine-learning.html" class="sidebar-link">Machine learning</a></li><li><a href="/r/using-texreg-to-export-models-in-a-paper-ready-way.html" class="sidebar-link">Using texreg to export models in a paper-ready way</a></li><li><a href="/r/publishing.html" class="sidebar-link">Publishing</a></li><li><a href="/r/implement-state-machine-pattern-using-s4-class.html" class="sidebar-link">Implement State Machine Pattern using S4 Class</a></li><li><a href="/r/reshape-using-tidyr.html" class="sidebar-link">Reshape using tidyr</a></li><li><a href="/r/modifying-strings-by-substitution.html" class="sidebar-link">Modifying strings by substitution</a></li><li><a href="/r/non-standard-evaluation-and-standard-evaluation.html" class="sidebar-link">Non-standard evaluation and standard evaluation</a></li><li><a href="/r/randomization.html" class="sidebar-link">Randomization</a></li><li><a href="/r/object-oriented-programming-in-r.html" class="sidebar-link">Object-Oriented Programming in R</a></li><li><a href="/r/coercion.html" class="sidebar-link">Coercion</a></li><li><a href="/r/standardize-analyses-by-writing-standalone-r-scripts.html" class="sidebar-link">Standardize analyses by writing standalone R scripts</a></li><li><a href="/r/analyze-tweets-with-r.html" class="sidebar-link">Analyze tweets with R</a></li><li><a href="/r/natural-language-processing.html" class="sidebar-link">Natural language processing</a></li><li><a href="/r/r-markdown-notebooks-from-rstudio.html" class="sidebar-link">R Markdown Notebooks (from RStudio)</a></li><li><a href="/r/aggregating-data-frames.html" class="sidebar-link">Aggregating data frames</a></li><li><a href="/r/data-acquisition.html" class="sidebar-link">Data acquisition</a></li><li><a href="/r/r-memento-by-examples.html" class="sidebar-link">R memento by examples</a></li><li><a href="/r/updating-r-version.html" class="sidebar-link">Updating R version</a></li><li><a href="/r/introspection.html" class="sidebar-link">Introspection</a></li><li><a href="/r/roxygen2.html" class="sidebar-link">roxygen2</a></li><li><a href="/r/cleaning-data.html" class="sidebar-link">Cleaning data</a></li><li><a href="/r/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="linear-models-regression"><a href="#linear-models-regression" class="header-anchor">#</a> Linear Models (Regression)</h1> <h2 id="linear-regression-on-the-mtcars-dataset"><a href="#linear-regression-on-the-mtcars-dataset" class="header-anchor">#</a> Linear regression on the mtcars dataset</h2> <p>The built-in mtcars <a href="http://stackoverflow.com/documentation/r/438/data-frames#t=201607172216448376641" target="_blank" rel="noopener noreferrer">data frame<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> contains information about 32 cars, including their weight, fuel efficiency (in miles-per-gallon), speed, etc. (To find out more about the dataset, use <code>help(mtcars)</code>).</p> <p>If we are interested in the relationship between fuel efficiency (<code>mpg</code>) and weight (<code>wt</code>) we may start plotting those variables with:</p> <div class="language-r extra-class"><pre class="language-r"><code>plot<span class="token punctuation">(</span>mpg <span class="token operator">~</span> wt<span class="token punctuation">,</span> data <span class="token operator">=</span> mtcars<span class="token punctuation">,</span> col<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>

</code></pre></div><p>The plots shows a (linear) relationship!. Then if we want to perform linear regression to determine the coefficients of a linear model, we would use the <code>lm</code> function:</p> <div class="language-r extra-class"><pre class="language-r"><code>fit <span class="token operator">&lt;-</span> lm<span class="token punctuation">(</span>mpg <span class="token operator">~</span> wt<span class="token punctuation">,</span> data <span class="token operator">=</span> mtcars<span class="token punctuation">)</span>

</code></pre></div><p>The <code>~</code> here means &quot;explained by&quot;, so the formula <code>mpg ~ wt</code> means we are predicting mpg as explained by wt. The most helpful way to view the output is with:</p> <div class="language-r extra-class"><pre class="language-r"><code>summary<span class="token punctuation">(</span>fit<span class="token punctuation">)</span>

</code></pre></div><p>Which gives the output:</p> <div class="language-r extra-class"><pre class="language-r"><code>Call<span class="token operator">:</span>
lm<span class="token punctuation">(</span>formula <span class="token operator">=</span> mpg <span class="token operator">~</span> wt<span class="token punctuation">,</span> data <span class="token operator">=</span> mtcars<span class="token punctuation">)</span>

Residuals<span class="token operator">:</span>
    Min      <span class="token number">1</span>Q  Median      <span class="token number">3</span>Q     Max 
<span class="token operator">-</span><span class="token number">4.5432</span> <span class="token operator">-</span><span class="token number">2.3647</span> <span class="token operator">-</span><span class="token number">0.1252</span>  <span class="token number">1.4096</span>  <span class="token number">6.8727</span> 

Coefficients<span class="token operator">:</span>
            Estimate Std. Error t value Pr<span class="token punctuation">(</span><span class="token operator">&gt;</span><span class="token operator">|</span>t<span class="token operator">|</span><span class="token punctuation">)</span>    
<span class="token punctuation">(</span>Intercept<span class="token punctuation">)</span>  <span class="token number">37.2851</span>     <span class="token number">1.8776</span>  <span class="token number">19.858</span>  <span class="token operator">&lt;</span> <span class="token number">2e-16</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
wt           <span class="token operator">-</span><span class="token number">5.3445</span>     <span class="token number">0.5591</span>  <span class="token operator">-</span><span class="token number">9.559</span> <span class="token number">1.29e-10</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
Signif. codes<span class="token operator">:</span>  <span class="token number">0</span> ‘<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>’ <span class="token number">0.001</span> ‘<span class="token operator">*</span><span class="token operator">*</span>’ <span class="token number">0.01</span> ‘<span class="token operator">*</span>’ <span class="token number">0.05</span> ‘.’ <span class="token number">0.1</span> ‘ ’ <span class="token number">1</span>

Residual standard error<span class="token operator">:</span> <span class="token number">3.046</span> on <span class="token number">30</span> degrees of freedom
Multiple R<span class="token operator">-</span>squared<span class="token operator">:</span>  <span class="token number">0.7528</span><span class="token punctuation">,</span>    Adjusted R<span class="token operator">-</span>squared<span class="token operator">:</span>  <span class="token number">0.7446</span> 
F<span class="token operator">-</span>statistic<span class="token operator">:</span> <span class="token number">91.38</span> on <span class="token number">1</span> and <span class="token number">30</span> DF<span class="token punctuation">,</span>  p<span class="token operator">-</span>value<span class="token operator">:</span> <span class="token number">1.294e-10</span>

</code></pre></div><p>This provides information about:</p> <ul><li>the estimated slope of each coefficient (<code>wt</code> and the y-intercept), which suggests the best-fit prediction of mpg is <code>37.2851 + (-5.3445) * wt</code></li> <li>The p-value of each coefficient, which suggests that the intercept and weight are probably not due to chance</li> <li>Overall estimates of fit such as R^2 and adjusted R^2, which show how much of the variation in <code>mpg</code> is explained by the model</li></ul> <p>We could add a line to our first plot to show the predicted <code>mpg</code>:</p> <div class="language-r extra-class"><pre class="language-r"><code>abline<span class="token punctuation">(</span>fit<span class="token punctuation">,</span>col<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>lwd<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>

</code></pre></div><p>It is also possible to add the equation to that plot. First, get the coefficients with <code>coef</code>. Then using <code>paste0</code> we collapse the coefficients with appropriate variables and <code>+/-</code>, to built the equation. Finally, we add it to the plot using <code>mtext</code>:</p> <div class="language-r extra-class"><pre class="language-r"><code>bs <span class="token operator">&lt;-</span> round<span class="token punctuation">(</span>coef<span class="token punctuation">(</span>fit<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> 
lmlab <span class="token operator">&lt;-</span> paste0<span class="token punctuation">(</span><span class="token string">&quot;mpg = &quot;</span><span class="token punctuation">,</span> bs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
             ifelse<span class="token punctuation">(</span>sign<span class="token punctuation">(</span>bs<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot; + &quot;</span><span class="token punctuation">,</span> <span class="token string">&quot; - &quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> abs<span class="token punctuation">(</span>bs<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot; wt &quot;</span><span class="token punctuation">)</span>
mtext<span class="token punctuation">(</span>lmlab<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> line<span class="token operator">=</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span> 

</code></pre></div><p>The result is:
<a href="https://i.stack.imgur.com/5q9yW.png" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/5q9yW.png" alt="enter image description here"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="weighting"><a href="#weighting" class="header-anchor">#</a> Weighting</h2> <p>Sometimes we want the model to give more weight to some data points or examples than others. This is possible by specifying the weight for the input data while learning the model. There are generally two kinds of scenarios where we might use non-uniform weights over the examples:</p> <ul><li><p>Analytic Weights: Reflect the different levels of precision of different observations. For example, if analyzing data where each observation is the average results from a geographic area, the analytic weight is proportional to the inverse of the estimated variance.  Useful when dealing with averages in data by providing a proportional weight given the number of observations. <a href="http://surveyanalysis.org/wiki/Different_Types_of_Weights" target="_blank" rel="noopener noreferrer">Source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>Sampling Weights (Inverse Probability Weights - IPW): a statistical technique for calculating statistics standardized to a population different from that in which the data was collected. Study designs with a disparate sampling population and population of target inference (target population) are common in application.  Useful when dealing with data that have missing values. <a href="https://en.wikipedia.org/wiki/Inverse_probability_weighting" target="_blank" rel="noopener noreferrer">Source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul> <p>The <code>lm()</code> function does analytic weighting. For sampling weights the <code>survey</code> package is used to build a survey design object and run <code>svyglm()</code>. By default, the <code>survey</code> package uses sampling weights. (NOTE: <code>lm()</code>, and <code>svyglm()</code> with family <code>gaussian()</code> will all produce the same point estimates, because they both solve for the coefficients by minimizing the weighted least squares. They differ in how standard errors are calculated.)</p> <p><strong>Test Data</strong></p> <div class="language-r extra-class"><pre class="language-r"><code>data <span class="token operator">&lt;-</span> structure<span class="token punctuation">(</span>list<span class="token punctuation">(</span>lexptot <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">9.1595012302023</span><span class="token punctuation">,</span> <span class="token number">9.86330744180814</span><span class="token punctuation">,</span> 
<span class="token number">8.92372556833205</span><span class="token punctuation">,</span> <span class="token number">8.58202430280175</span><span class="token punctuation">,</span> <span class="token number">10.1133857229336</span><span class="token punctuation">)</span><span class="token punctuation">,</span> progvillm <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">,</span> 
<span class="token number">1L</span><span class="token punctuation">,</span> <span class="token number">1L</span><span class="token punctuation">,</span> <span class="token number">1L</span><span class="token punctuation">,</span> <span class="token number">0L</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sexhead <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">,</span> <span class="token number">1L</span><span class="token punctuation">,</span> <span class="token number">0L</span><span class="token punctuation">,</span> <span class="token number">1L</span><span class="token punctuation">,</span> <span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">,</span> agehead <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">79L</span><span class="token punctuation">,</span> 
<span class="token number">43L</span><span class="token punctuation">,</span> <span class="token number">52L</span><span class="token punctuation">,</span> <span class="token number">48L</span><span class="token punctuation">,</span> <span class="token number">35L</span><span class="token punctuation">)</span><span class="token punctuation">,</span> weight <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">1.04273509979248</span><span class="token punctuation">,</span> <span class="token number">1.01139605045319</span><span class="token punctuation">,</span> 
<span class="token number">1.01139605045319</span><span class="token punctuation">,</span> <span class="token number">1.01139605045319</span><span class="token punctuation">,</span> <span class="token number">0.76305216550827</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> .Names <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">&quot;lexptot&quot;</span><span class="token punctuation">,</span> 
<span class="token string">&quot;progvillm&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;sexhead&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;agehead&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;weight&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> class <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">&quot;tbl_df&quot;</span><span class="token punctuation">,</span> 
<span class="token string">&quot;tbl&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;data.frame&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> row.names <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token keyword">NA</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">5L</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><p><strong>Analytic Weights</strong></p> <div class="language-r extra-class"><pre class="language-r"><code>lm.analytic <span class="token operator">&lt;-</span> lm<span class="token punctuation">(</span>lexptot <span class="token operator">~</span> progvillm <span class="token operator">+</span> sexhead <span class="token operator">+</span> agehead<span class="token punctuation">,</span> 
                            data <span class="token operator">=</span> data<span class="token punctuation">,</span> weight <span class="token operator">=</span> weight<span class="token punctuation">)</span>
summary<span class="token punctuation">(</span>lm.analytic<span class="token punctuation">)</span>

</code></pre></div><p><strong>Output</strong></p> <div class="language-r extra-class"><pre class="language-r"><code>Call<span class="token operator">:</span>
lm<span class="token punctuation">(</span>formula <span class="token operator">=</span> lexptot <span class="token operator">~</span> progvillm <span class="token operator">+</span> sexhead <span class="token operator">+</span> agehead<span class="token punctuation">,</span> data <span class="token operator">=</span> data<span class="token punctuation">,</span> 
    weights <span class="token operator">=</span> weight<span class="token punctuation">)</span>

Weighted Residuals<span class="token operator">:</span>
         <span class="token number">1</span>          <span class="token number">2</span>          <span class="token number">3</span>          <span class="token number">4</span>          <span class="token number">5</span> 
 <span class="token number">9.249e-02</span>  <span class="token number">5.823e-01</span>  <span class="token number">0.000e+00</span> <span class="token operator">-</span><span class="token number">6.762e-01</span> <span class="token operator">-</span><span class="token number">1.527e-16</span>

Coefficients<span class="token operator">:</span>
             Estimate Std. Error t value Pr<span class="token punctuation">(</span><span class="token operator">&gt;</span><span class="token operator">|</span>t<span class="token operator">|</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span>Intercept<span class="token punctuation">)</span> <span class="token number">10.016054</span>   <span class="token number">1.744293</span>   <span class="token number">5.742</span>    <span class="token number">0.110</span>
progvillm   <span class="token operator">-</span><span class="token number">0.781204</span>   <span class="token number">1.344974</span>  <span class="token operator">-</span><span class="token number">0.581</span>    <span class="token number">0.665</span>
sexhead      <span class="token number">0.306742</span>   <span class="token number">1.040625</span>   <span class="token number">0.295</span>    <span class="token number">0.818</span>
agehead     <span class="token operator">-</span><span class="token number">0.005983</span>   <span class="token number">0.032024</span>  <span class="token operator">-</span><span class="token number">0.187</span>    <span class="token number">0.882</span>

Residual standard error<span class="token operator">:</span> <span class="token number">0.8971</span> on <span class="token number">1</span> degrees of freedom
Multiple R<span class="token operator">-</span>squared<span class="token operator">:</span>  <span class="token number">0.467</span><span class="token punctuation">,</span> Adjusted R<span class="token operator">-</span>squared<span class="token operator">:</span>  <span class="token operator">-</span><span class="token number">1.132</span> 
F<span class="token operator">-</span>statistic<span class="token operator">:</span> <span class="token number">0.2921</span> on <span class="token number">3</span> and <span class="token number">1</span> DF<span class="token punctuation">,</span>  p<span class="token operator">-</span>value<span class="token operator">:</span> <span class="token number">0.8386</span>

</code></pre></div><p><strong>Sampling Weights (IPW)</strong></p> <div class="language-r extra-class"><pre class="language-r"><code>library<span class="token punctuation">(</span>survey<span class="token punctuation">)</span>
data<span class="token operator">$</span>X <span class="token operator">&lt;-</span> <span class="token number">1</span><span class="token operator">:</span>nrow<span class="token punctuation">(</span>data<span class="token punctuation">)</span>             <span class="token comment"># Create unique id</span>
        
<span class="token comment"># Build survey design object with unique id, ipw, and data.frame</span>
des1 <span class="token operator">&lt;-</span> svydesign<span class="token punctuation">(</span>id <span class="token operator">=</span> <span class="token operator">~</span>X<span class="token punctuation">,</span>  weights <span class="token operator">=</span> <span class="token operator">~</span>weight<span class="token punctuation">,</span> data <span class="token operator">=</span> data<span class="token punctuation">)</span>
        
<span class="token comment"># Run glm with survey design object</span>
prog.lm <span class="token operator">&lt;-</span> svyglm<span class="token punctuation">(</span>lexptot <span class="token operator">~</span> progvillm <span class="token operator">+</span> sexhead <span class="token operator">+</span> agehead<span class="token punctuation">,</span> design<span class="token operator">=</span>des1<span class="token punctuation">)</span>

</code></pre></div><p><strong>Output</strong></p> <div class="language-r extra-class"><pre class="language-r"><code>Call<span class="token operator">:</span>
svyglm<span class="token punctuation">(</span>formula <span class="token operator">=</span> lexptot <span class="token operator">~</span> progvillm <span class="token operator">+</span> sexhead <span class="token operator">+</span> agehead<span class="token punctuation">,</span> design <span class="token operator">=</span> des1<span class="token punctuation">)</span>

Survey design<span class="token operator">:</span>
svydesign<span class="token punctuation">(</span>id <span class="token operator">=</span> <span class="token operator">~</span>X<span class="token punctuation">,</span> weights <span class="token operator">=</span> <span class="token operator">~</span>weight<span class="token punctuation">,</span> data <span class="token operator">=</span> data<span class="token punctuation">)</span>

Coefficients<span class="token operator">:</span>
             Estimate Std. Error t value Pr<span class="token punctuation">(</span><span class="token operator">&gt;</span><span class="token operator">|</span>t<span class="token operator">|</span><span class="token punctuation">)</span>  
<span class="token punctuation">(</span>Intercept<span class="token punctuation">)</span> <span class="token number">10.016054</span>   <span class="token number">0.183942</span>  <span class="token number">54.452</span>   <span class="token number">0.0117</span> <span class="token operator">*</span>
progvillm   <span class="token operator">-</span><span class="token number">0.781204</span>   <span class="token number">0.640372</span>  <span class="token operator">-</span><span class="token number">1.220</span>   <span class="token number">0.4371</span>  
sexhead      <span class="token number">0.306742</span>   <span class="token number">0.397089</span>   <span class="token number">0.772</span>   <span class="token number">0.5813</span>  
agehead     <span class="token operator">-</span><span class="token number">0.005983</span>   <span class="token number">0.014747</span>  <span class="token operator">-</span><span class="token number">0.406</span>   <span class="token number">0.7546</span>  
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
Signif. codes<span class="token operator">:</span>  <span class="token number">0</span> ‘<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>’ <span class="token number">0.001</span> ‘<span class="token operator">*</span><span class="token operator">*</span>’ <span class="token number">0.01</span> ‘<span class="token operator">*</span>’ <span class="token number">0.05</span> ‘.’ <span class="token number">0.1</span> ‘ ’ <span class="token number">1</span>

<span class="token punctuation">(</span>Dispersion parameter <span class="token keyword">for</span> gaussian family taken to be <span class="token number">0.2078647</span><span class="token punctuation">)</span>

Number of Fisher Scoring iterations<span class="token operator">:</span> <span class="token number">2</span>

</code></pre></div><h2 id="using-the-predict-function"><a href="#using-the-predict-function" class="header-anchor">#</a> Using the 'predict' function</h2> <p>Once a model is built <code>predict</code> is the main function to test with new data. Our example will use the <code>mtcars</code> built-in dataset to regress miles per gallon against displacement:</p> <div class="language-r extra-class"><pre class="language-r"><code>my_mdl <span class="token operator">&lt;-</span> lm<span class="token punctuation">(</span>mpg <span class="token operator">~</span> disp<span class="token punctuation">,</span> data<span class="token operator">=</span>mtcars<span class="token punctuation">)</span>
my_mdl

Call<span class="token operator">:</span>
lm<span class="token punctuation">(</span>formula <span class="token operator">=</span> mpg <span class="token operator">~</span> disp<span class="token punctuation">,</span> data <span class="token operator">=</span> mtcars<span class="token punctuation">)</span>

Coefficients<span class="token operator">:</span>
<span class="token punctuation">(</span>Intercept<span class="token punctuation">)</span>         disp  
   <span class="token number">29.59985</span>     <span class="token operator">-</span><span class="token number">0.04122</span>

</code></pre></div><p>If I had a new data source with displacement I could see the estimated miles per gallon.</p> <div class="language-r extra-class"><pre class="language-r"><code>set.seed<span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">)</span>
newdata <span class="token operator">&lt;-</span> sample<span class="token punctuation">(</span>mtcars<span class="token operator">$</span>disp<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
newdata
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">258.0</span>  <span class="token number">71.1</span>  <span class="token number">75.7</span> <span class="token number">145.0</span> <span class="token number">400.0</span>

newdf <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>disp<span class="token operator">=</span>newdata<span class="token punctuation">)</span>
predict<span class="token punctuation">(</span>my_mdl<span class="token punctuation">,</span> newdf<span class="token punctuation">)</span>
       <span class="token number">1</span>        <span class="token number">2</span>        <span class="token number">3</span>        <span class="token number">4</span>        <span class="token number">5</span> 
<span class="token number">18.96635</span> <span class="token number">26.66946</span> <span class="token number">26.47987</span> <span class="token number">23.62366</span> <span class="token number">13.11381</span>

</code></pre></div><p>The most important part of the process is to create a new data frame with the same column names as the original data. In this case, the original data had a column labeled <code>disp</code>, I was sure to call the new data that same name.</p> <p><strong>Caution</strong></p> <p>Let's look at a few common pitfalls:</p> <li>
not using a data.frame in the new object:
<div class="language-r extra-class"><pre class="language-r"><code>predict<span class="token punctuation">(</span>my_mdl<span class="token punctuation">,</span> newdata<span class="token punctuation">)</span>
Error <span class="token keyword">in</span> eval<span class="token punctuation">(</span>predvars<span class="token punctuation">,</span> data<span class="token punctuation">,</span> env<span class="token punctuation">)</span> <span class="token operator">:</span> 
   numeric <span class="token string">'envir'</span> arg not of length one

</code></pre></div></li> <li>
not using same names in new data frame:
<div class="language-r extra-class"><pre class="language-r"><code>newdf2 <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>newdata<span class="token punctuation">)</span>
predict<span class="token punctuation">(</span>my_mdl<span class="token punctuation">,</span> newdf2<span class="token punctuation">)</span>
Error <span class="token keyword">in</span> eval<span class="token punctuation">(</span>expr<span class="token punctuation">,</span> envir<span class="token punctuation">,</span> enclos<span class="token punctuation">)</span> <span class="token operator">:</span> object <span class="token string">'disp'</span> not found

</code></pre></div></li> <p><strong>Accuracy</strong></p> <p>To check the accuracy of the prediction you will need the actual y values of the new data. In this example, <code>newdf</code> will need a column for 'mpg' and 'disp'.</p> <div class="language-r extra-class"><pre class="language-r"><code>newdf <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>mpg<span class="token operator">=</span>mtcars<span class="token operator">$</span>mpg<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span> disp<span class="token operator">=</span>mtcars<span class="token operator">$</span>disp<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#     mpg  disp</span>
<span class="token comment"># 1  21.0 160.0</span>
<span class="token comment"># 2  21.0 160.0</span>
<span class="token comment"># 3  22.8 108.0</span>
<span class="token comment"># 4  21.4 258.0</span>
<span class="token comment"># 5  18.7 360.0</span>
<span class="token comment"># 6  18.1 225.0</span>
<span class="token comment"># 7  14.3 360.0</span>
<span class="token comment"># 8  24.4 146.7</span>
<span class="token comment"># 9  22.8 140.8</span>
<span class="token comment"># 10 19.2 167.6</span>

p <span class="token operator">&lt;-</span> predict<span class="token punctuation">(</span>my_mdl<span class="token punctuation">,</span> newdf<span class="token punctuation">)</span>

<span class="token comment">#root mean square error</span>
sqrt<span class="token punctuation">(</span>mean<span class="token punctuation">(</span><span class="token punctuation">(</span>p <span class="token operator">-</span> newdf<span class="token operator">$</span>mpg<span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">,</span> na.rm<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">2.325148</span>

</code></pre></div><h2 id="checking-for-nonlinearity-with-polynomial-regression"><a href="#checking-for-nonlinearity-with-polynomial-regression" class="header-anchor">#</a> Checking for nonlinearity with polynomial regression</h2> <p>Sometimes when working with linear regression we need to check for non-linearity in the data. One way to do this is to fit a polynomial model and check whether it fits the data better than a linear model. There are other reasons, such as theoretical, that indicate to fit a quadratic or higher order model because it is believed that the variables relationship is inherently polynomial in nature.</p> <p>Let's fit a quadratic model for the <code>mtcars</code> dataset. For a linear model see <a href="http://stackoverflow.com/documentation/r/801/linear-models-regression/2738/linear-regression-on-the-mtcars-dataset" target="_blank" rel="noopener noreferrer">Linear regression on the mtcars dataset<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>First we make a scatter plot of the variables <code>mpg</code> (Miles/gallon), <code>disp</code> (Displacement (cu.in.)), and <code>wt</code> (Weight (1000 lbs)). The relationship among <code>mpg</code> and <code>disp</code> appears non-linear.</p> <div class="language-r extra-class"><pre class="language-r"><code>plot<span class="token punctuation">(</span>mtcars<span class="token punctuation">[</span><span class="token punctuation">,</span>c<span class="token punctuation">(</span><span class="token string">&quot;mpg&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;disp&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;wt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

</code></pre></div><p><a href="https://i.stack.imgur.com/rT8kS.png" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/rT8kS.png" alt="enter image description here"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>A linear fit will show that <code>disp</code> is not significant.</p> <div class="language-r extra-class"><pre class="language-r"><code>fit0 <span class="token operator">=</span> lm<span class="token punctuation">(</span>mpg <span class="token operator">~</span> wt<span class="token operator">+</span>disp<span class="token punctuation">,</span> mtcars<span class="token punctuation">)</span>
summary<span class="token punctuation">(</span>fit0<span class="token punctuation">)</span>

<span class="token comment"># Coefficients:</span>
<span class="token comment">#            Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="token comment">#(Intercept) 34.96055    2.16454  16.151 4.91e-16 ***</span>
<span class="token comment">#wt          -3.35082    1.16413  -2.878  0.00743 ** </span>
<span class="token comment">#disp        -0.01773    0.00919  -1.929  0.06362 .  </span>
<span class="token comment">#---</span>
<span class="token comment">#Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="token comment">#Residual standard error: 2.917 on 29 degrees of freedom</span>
<span class="token comment">#Multiple R-squared:  0.7809,    Adjusted R-squared:  0.7658</span>

</code></pre></div><p>Then, to get the result of a quadratic model, we added <code>I(disp^2)</code>. The new model appears better when looking at <code>R^2</code> and all variables are significant.</p> <div class="language-r extra-class"><pre class="language-r"><code>fit1 <span class="token operator">=</span> lm<span class="token punctuation">(</span>mpg <span class="token operator">~</span> wt<span class="token operator">+</span>disp<span class="token operator">+</span>I<span class="token punctuation">(</span>disp<span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mtcars<span class="token punctuation">)</span>
summary<span class="token punctuation">(</span>fit1<span class="token punctuation">)</span>

<span class="token comment"># Coefficients:</span>
<span class="token comment">#              Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="token comment">#(Intercept) 41.4019837  2.4266906  17.061  2.5e-16 ***</span>
<span class="token comment">#wt          -3.4179165  0.9545642  -3.581 0.001278 ** </span>
<span class="token comment">#disp        -0.0823950  0.0182460  -4.516 0.000104 ***</span>
<span class="token comment">#I(disp^2)    0.0001277  0.0000328   3.892 0.000561 ***</span>
<span class="token comment">#---</span>
<span class="token comment">#Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="token comment">#Residual standard error: 2.391 on 28 degrees of freedom</span>
<span class="token comment">#Multiple R-squared:  0.8578,    Adjusted R-squared:  0.8426 </span>

</code></pre></div><p>As we have three variables, the fitted model is a surface represented by:</p> <p><strong><code>mpg = 41.4020-3.4179*wt-0.0824*disp+0.0001277*disp^2</code></strong></p> <p>Another way to specify polynomial regression is using <code>poly</code> with parameter <code>raw=TRUE</code>, otherwise <strong>orthogonal polynomials</strong> will be considered (see the <code>help(ploy)</code> for more information). We get the same result using:</p> <div class="language-r extra-class"><pre class="language-r"><code>summary<span class="token punctuation">(</span>lm<span class="token punctuation">(</span>mpg <span class="token operator">~</span> wt<span class="token operator">+</span>poly<span class="token punctuation">(</span>disp<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> raw<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">,</span>mtcars<span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><p>Finally, what if we need to show a plot of the estimated surface? Well there are many options to make <code>3D</code> plots in <code>R</code>. Here we use <code>Fit3d</code> from <code>p3d</code>package.</p> <div class="language-r extra-class"><pre class="language-r"><code>library<span class="token punctuation">(</span>p3d<span class="token punctuation">)</span>
Init3d<span class="token punctuation">(</span>family<span class="token operator">=</span><span class="token string">&quot;serif&quot;</span><span class="token punctuation">,</span> cex <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>
Plot3d<span class="token punctuation">(</span>mpg <span class="token operator">~</span> disp<span class="token operator">+</span>wt<span class="token punctuation">,</span> mtcars<span class="token punctuation">)</span>
Axes3d<span class="token punctuation">(</span><span class="token punctuation">)</span>
Fit3d<span class="token punctuation">(</span>fit1<span class="token punctuation">)</span>

</code></pre></div><p><a href="https://i.stack.imgur.com/Tuodn.png" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/Tuodn.png" alt="enter image description here"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="plotting-the-regression-base"><a href="#plotting-the-regression-base" class="header-anchor">#</a> Plotting The Regression (base)</h2> <p>Continuing on the <code>mtcars</code> example, here is a simple way to produce a plot of your linear regression that is potentially suitable for publication.</p> <p>First fit the linear model and</p> <div class="language-r extra-class"><pre class="language-r"><code>fit <span class="token operator">&lt;-</span> lm<span class="token punctuation">(</span>mpg <span class="token operator">~</span> wt<span class="token punctuation">,</span> data <span class="token operator">=</span> mtcars<span class="token punctuation">)</span>

</code></pre></div><p>Then plot the two variables of interest and add  the regression line within the definition domain:</p> <div class="language-r extra-class"><pre class="language-r"><code>plot<span class="token punctuation">(</span>mtcars<span class="token operator">$</span>wt<span class="token punctuation">,</span>mtcars<span class="token operator">$</span>mpg<span class="token punctuation">,</span>pch<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">,</span> xlab <span class="token operator">=</span> <span class="token string">'wt'</span><span class="token punctuation">,</span>ylab <span class="token operator">=</span> <span class="token string">'mpg'</span><span class="token punctuation">)</span>
lines<span class="token punctuation">(</span>c<span class="token punctuation">(</span>min<span class="token punctuation">(</span>mtcars<span class="token operator">$</span>wt<span class="token punctuation">)</span><span class="token punctuation">,</span>max<span class="token punctuation">(</span>mtcars<span class="token operator">$</span>wt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
as.numeric<span class="token punctuation">(</span>predict<span class="token punctuation">(</span>fit<span class="token punctuation">,</span> data.frame<span class="token punctuation">(</span>wt<span class="token operator">=</span>c<span class="token punctuation">(</span>min<span class="token punctuation">(</span>mtcars<span class="token operator">$</span>wt<span class="token punctuation">)</span><span class="token punctuation">,</span>max<span class="token punctuation">(</span>mtcars<span class="token operator">$</span>wt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><p>Almost there! The last step is to add to the plot, the regression equation, the rsquare as well as the correlation coefficient. This is done using the <code>vector</code> function:</p> <div class="language-r extra-class"><pre class="language-r"><code>rp <span class="token operator">=</span> vector<span class="token punctuation">(</span><span class="token string">'expression'</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
rp<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> substitute<span class="token punctuation">(</span>expression<span class="token punctuation">(</span>italic<span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token operator">==</span> MYOTHERVALUE3 <span class="token operator">+</span> MYOTHERVALUE4 <span class="token percent-operator operator">%*%</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span> 
          list<span class="token punctuation">(</span>MYOTHERVALUE3 <span class="token operator">=</span> format<span class="token punctuation">(</span>fit<span class="token operator">$</span>coefficients<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> digits <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        MYOTHERVALUE4 <span class="token operator">=</span> format<span class="token punctuation">(</span>fit<span class="token operator">$</span>coefficients<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> digits <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
rp<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> substitute<span class="token punctuation">(</span>expression<span class="token punctuation">(</span>italic<span class="token punctuation">(</span>R<span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">2</span> <span class="token operator">==</span> MYVALUE<span class="token punctuation">)</span><span class="token punctuation">,</span> 
             list<span class="token punctuation">(</span>MYVALUE <span class="token operator">=</span> format<span class="token punctuation">(</span>summary<span class="token punctuation">(</span>fit<span class="token punctuation">)</span><span class="token operator">$</span>adj.r.squared<span class="token punctuation">,</span>dig<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
rp<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> substitute<span class="token punctuation">(</span>expression<span class="token punctuation">(</span>Pearson<span class="token operator">-</span>R <span class="token operator">==</span> MYOTHERVALUE2<span class="token punctuation">)</span><span class="token punctuation">,</span> 
             list<span class="token punctuation">(</span>MYOTHERVALUE2 <span class="token operator">=</span> format<span class="token punctuation">(</span>cor<span class="token punctuation">(</span>mtcars<span class="token operator">$</span>wt<span class="token punctuation">,</span>mtcars<span class="token operator">$</span>mpg<span class="token punctuation">)</span><span class="token punctuation">,</span> digits <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>

legend<span class="token punctuation">(</span><span class="token string">&quot;topright&quot;</span><span class="token punctuation">,</span> legend <span class="token operator">=</span> rp<span class="token punctuation">,</span> bty <span class="token operator">=</span> <span class="token string">'n'</span><span class="token punctuation">)</span>

</code></pre></div><p>Note that you can add any other parameter such as the RMSE by adapting the vector function. Imagine you want a legend with 10 elements. The vector definition would be the following:</p> <div class="language-r extra-class"><pre class="language-r"><code>rp <span class="token operator">=</span> vector<span class="token punctuation">(</span><span class="token string">'expression'</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span>

</code></pre></div><p>and you will need to defined <code>r[1]</code>.... to <code>r[10]</code></p> <p>Here is the output:</p> <p><a href="http://i.stack.imgur.com/l3Ach.png" target="_blank" rel="noopener noreferrer"><img src="http://i.stack.imgur.com/l3Ach.png" alt="enter image description here"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="quality-assessment"><a href="#quality-assessment" class="header-anchor">#</a> Quality assessment</h2> <p>After building a regression model it is important to check the result and decide if the model is appropriate and works well with the data at hand. This can be done by examining the residuals plot as well as other diagnostic plots.</p> <div class="language-r extra-class"><pre class="language-r"><code><span class="token comment"># fit the model</span>
fit <span class="token operator">&lt;-</span> lm<span class="token punctuation">(</span>mpg <span class="token operator">~</span> wt<span class="token punctuation">,</span> data <span class="token operator">=</span> mtcars<span class="token punctuation">)</span>
<span class="token comment"># </span>
par<span class="token punctuation">(</span>mfrow<span class="token operator">=</span>c<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># plot model object</span>
plot<span class="token punctuation">(</span>fit<span class="token punctuation">,</span> which <span class="token operator">=</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">)</span>

</code></pre></div><p><a href="https://i.stack.imgur.com/tHoK5.jpg" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/tHoK5.jpg" alt="enter image description here"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>These plots check for two assumptions that were made while building the model:</p> <ol><li>That the expected value of the predicted variable (in this case <code>mpg</code>) is given by a linear combination of the predictors (in this case <code>wt</code>). We expect this estimate to be unbiased. So the residuals should be centered around the mean for all values of the predictors. In this case we see that the residuals tend to be positive at the ends and negative in the middle, suggesting a non-linear relationship between the variables.</li> <li>That the actual predicted variable is normally distributed around its estimate. Thus, the residuals should be normally distributed. For normally distributed data, the points in a normal Q-Q plot should lie on or close to the diagonal. There is some amount of skew at the ends here.</li></ol> <h4 id="syntax"><a href="#syntax" class="header-anchor">#</a> Syntax</h4> <ul><li>lm(formula, data, subset, weights, na.action, method = &quot;qr&quot;, model = TRUE, x = FALSE, y = FALSE, qr = TRUE, singular.ok = TRUE, contrasts = NULL, offset, ...)</li></ul> <h4 id="parameters"><a href="#parameters" class="header-anchor">#</a> Parameters</h4> <table><thead><tr><th>Parameter</th> <th>Meaning</th></tr></thead> <tbody><tr><td>formula</td> <td>a formula in <strong>Wilkinson-Rogers</strong> notation; <code>response ~ ...</code> where  <code>...</code> contains terms corresponding to variables in the environment or in the data frame specified by the <code>data</code> argument</td></tr> <tr><td>data</td> <td>data frame containing the response and predictor variables</td></tr> <tr><td>subset</td> <td>a vector specifying a subset of observations to be used: may be expressed as a logical statement in terms of the variables in <code>data</code></td></tr> <tr><td>weights</td> <td>analytical weights (see <strong>Weights</strong> section above)</td></tr> <tr><td>na.action</td> <td>how to handle missing (<code>NA</code>) values: see <code>?na.action</code></td></tr> <tr><td>method</td> <td>how to perform the fitting. Only choices are <code>&quot;qr&quot;</code> or <code>&quot;model.frame&quot;</code> (the latter returns the model frame without fitting the model, identical to specifying <code>model=TRUE</code>)</td></tr> <tr><td>model</td> <td>whether to store the model frame in the fitted object</td></tr> <tr><td>x</td> <td>whether to store the model matrix in the fitted object</td></tr> <tr><td>y</td> <td>whether to store the model response in the fitted object</td></tr> <tr><td>qr</td> <td>whether to store the QR decomposition in the fitted object</td></tr> <tr><td>singular.ok</td> <td>whether to allow <strong>singular fits</strong>, models with collinear predictors (a subset of the coefficients will automatically be set to <code>NA</code> in this case</td></tr> <tr><td>contrasts</td> <td>a list of contrasts to be used for particular factors in the model; see the <code>contrasts.arg</code> argument of <code>?model.matrix.default</code>. Contrasts can also be set with <code>options()</code> (see the <code>contrasts</code> argument) or by assigning the <code>contrast</code> attributes of a factor (see <code>?contrasts</code>)</td></tr> <tr><td>offset</td> <td>used to specify an <strong>a priori</strong> known component in the model. May also be specified as part of the formula. See <code>?model.offset</code></td></tr> <tr><td>...</td> <td>additional arguments to be passed to lower-level fitting functions (<code>lm.fit()</code> or <code>lm.wfit()</code>)</td></tr></tbody></table></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/r/linear-models-regression.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/r/pipe-operators-and-others.html" class="prev">
        Pipe operators (%&gt;% and others)
      </a></span> <span class="next"><a href="/r/data-table.html">
        data.table
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/2911.fd1258a9.js" defer></script>
  </body>
</html>
