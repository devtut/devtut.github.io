<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>R - Implement State Machine Pattern using S4 Class</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Parsing Lines using State Machine">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="R - Implement State Machine Pattern using S4 Class">
    <meta property="og:description" content="Parsing Lines using State Machine">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/r/implement-state-machine-pattern-using-s4-class.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="R - Implement State Machine Pattern using S4 Class">
    <meta name="twitter:description" content="Parsing Lines using State Machine">
    <meta name="twitter:url" content="/r/implement-state-machine-pattern-using-s4-class.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/2904.c741d241.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>R</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/r/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/r/getting-started-with-r-language.html" class="sidebar-link">Getting started with R Language</a></li><li><a href="/r/variables.html" class="sidebar-link">Variables</a></li><li><a href="/r/arithmetic-operators.html" class="sidebar-link">Arithmetic Operators</a></li><li><a href="/r/matrices.html" class="sidebar-link">Matrices</a></li><li><a href="/r/formula.html" class="sidebar-link">Formula</a></li><li><a href="/r/reading-and-writing-strings.html" class="sidebar-link">Reading and writing strings</a></li><li><a href="/r/string-manipulation-with-stringi-package.html" class="sidebar-link">String manipulation with stringi package</a></li><li><a href="/r/classes.html" class="sidebar-link">Classes</a></li><li><a href="/r/lists.html" class="sidebar-link">Lists</a></li><li><a href="/r/hashmaps.html" class="sidebar-link">Hashmaps</a></li><li><a href="/r/creating-vectors.html" class="sidebar-link">Creating vectors</a></li><li><a href="/r/date-and-time.html" class="sidebar-link">Date and Time</a></li><li><a href="/r/the-date-class.html" class="sidebar-link">The Date class</a></li><li><a href="/r/date-time-classes-posixct-and-posixlt.html" class="sidebar-link">Date-time classes (POSIXct and POSIXlt)</a></li><li><a href="/r/the-character-class.html" class="sidebar-link">The character class</a></li><li><a href="/r/numeric-classes-and-storage-modes.html" class="sidebar-link">Numeric classes and storage modes</a></li><li><a href="/r/the-logical-class.html" class="sidebar-link">The logical class</a></li><li><a href="/r/data-frames.html" class="sidebar-link">Data frames</a></li><li><a href="/r/split-function.html" class="sidebar-link">Split function</a></li><li><a href="/r/reading-and-writing-tabular-data-in-plain-text-files-csv-tsv-etc.html" class="sidebar-link">Reading and writing tabular data in plain-text files (CSV, TSV, etc.)</a></li><li><a href="/r/pipe-operators-and-others.html" class="sidebar-link">Pipe operators (%&gt;% and others)</a></li><li><a href="/r/linear-models-regression.html" class="sidebar-link">Linear Models (Regression)</a></li><li><a href="/r/data-table.html" class="sidebar-link">data.table</a></li><li><a href="/r/pivot-and-unpivot-with-data-table.html" class="sidebar-link">Pivot and unpivot with data.table</a></li><li><a href="/r/bar-chart.html" class="sidebar-link">Bar Chart</a></li><li><a href="/r/base-plotting.html" class="sidebar-link">Base Plotting</a></li><li><a href="/r/boxplot.html" class="sidebar-link">boxplot</a></li><li><a href="/r/ggplot2.html" class="sidebar-link">ggplot2</a></li><li><a href="/r/factors.html" class="sidebar-link">Factors</a></li><li><a href="/r/pattern-matching-and-replacement.html" class="sidebar-link">Pattern Matching and Replacement</a></li><li><a href="/r/run-length-encoding.html" class="sidebar-link">Run-length encoding</a></li><li><a href="/r/speeding-up-tough-to-vectorize-code.html" class="sidebar-link">Speeding up tough-to-vectorize code</a></li><li><a href="/r/introduction-to-geographical-maps.html" class="sidebar-link">Introduction to Geographical Maps</a></li><li><a href="/r/set-operations.html" class="sidebar-link">Set operations</a></li><li><a href="/r/tidyverse.html" class="sidebar-link">tidyverse</a></li><li><a href="/r/rcpp.html" class="sidebar-link">Rcpp</a></li><li><a href="/r/random-numbers-generator.html" class="sidebar-link">Random Numbers Generator</a></li><li><a href="/r/parallel-processing.html" class="sidebar-link">Parallel processing</a></li><li><a href="/r/subsetting.html" class="sidebar-link">Subsetting</a></li><li><a href="/r/debugging.html" class="sidebar-link">Debugging</a></li><li><a href="/r/installing-packages.html" class="sidebar-link">Installing packages</a></li><li><a href="/r/updating-r-and-the-package-library.html" class="sidebar-link">Updating R and the package library</a></li><li><a href="/r/inspecting-packages.html" class="sidebar-link">Inspecting packages</a></li><li><a href="/r/creating-packages-with-devtools.html" class="sidebar-link">Creating packages with devtools</a></li><li><a href="/r/using-pipe-assignment-in-your-own-package-how-to.html" class="sidebar-link">Using pipe assignment in your own package %%: How to ?</a></li><li><a href="/r/arima-models.html" class="sidebar-link">Arima Models</a></li><li><a href="/r/distribution-functions.html" class="sidebar-link">Distribution Functions</a></li><li><a href="/r/shiny.html" class="sidebar-link">Shiny</a></li><li><a href="/r/spatial-analysis.html" class="sidebar-link">spatial analysis</a></li><li><a href="/r/sqldf.html" class="sidebar-link">sqldf</a></li><li><a href="/r/code-profiling.html" class="sidebar-link">Code profiling</a></li><li><a href="/r/control-flow-structures.html" class="sidebar-link">Control flow structures</a></li><li><a href="/r/column-wise-operation.html" class="sidebar-link">Column wise operation</a></li><li><a href="/r/json.html" class="sidebar-link">JSON</a></li><li><a href="/r/rodbc.html" class="sidebar-link">RODBC</a></li><li><a href="/r/lubridate.html" class="sidebar-link">lubridate</a></li><li><a href="/r/time-series-and-forecasting.html" class="sidebar-link">Time Series and Forecasting</a></li><li><a href="/r/strsplit-function.html" class="sidebar-link">strsplit function</a></li><li><a href="/r/web-scraping-and-parsing.html" class="sidebar-link">Web scraping and parsing</a></li><li><a href="/r/generalized-linear-models.html" class="sidebar-link">Generalized linear models</a></li><li><a href="/r/reshaping-data-between-long-and-wide-forms.html" class="sidebar-link">Reshaping data between long and wide forms</a></li><li><a href="/r/rmarkdown-and-knitr-presentation.html" class="sidebar-link">RMarkdown and knitr presentation</a></li><li><a href="/r/scope-of-variables.html" class="sidebar-link">Scope of variables</a></li><li><a href="/r/performing-a-permutation-test.html" class="sidebar-link">Performing a Permutation Test</a></li><li><a href="/r/xgboost.html" class="sidebar-link">xgboost</a></li><li><a href="/r/r-code-vectorization-best-practices.html" class="sidebar-link">R code vectorization best practices</a></li><li><a href="/r/missing-values.html" class="sidebar-link">Missing values</a></li><li><a href="/r/hierarchical-linear-modeling.html" class="sidebar-link">Hierarchical Linear Modeling</a></li><li><a href="/r/apply-family-of-functions-functionals.html" class="sidebar-link">*apply family of functions (functionals)</a></li><li><a href="/r/text-mining.html" class="sidebar-link">Text mining</a></li><li><a href="/r/anova.html" class="sidebar-link">ANOVA</a></li><li><a href="/r/raster-and-image-analysis.html" class="sidebar-link">Raster and Image Analysis</a></li><li><a href="/r/survival-analysis.html" class="sidebar-link">Survival analysis</a></li><li><a href="/r/fault-tolerant-resilient-code.html" class="sidebar-link">Fault-tolerant/resilient code</a></li><li><a href="/r/reproducible-r.html" class="sidebar-link">Reproducible R</a></li><li><a href="/r/fourier-series-and-transformations.html" class="sidebar-link">Fourier Series and Transformations</a></li><li><a href="/r/rprofile.html" class="sidebar-link">.Rprofile</a></li><li><a href="/r/dplyr.html" class="sidebar-link">dplyr</a></li><li><a href="/r/caret.html" class="sidebar-link">caret</a></li><li><a href="/r/extracting-and-listing-files-in-compressed-archives.html" class="sidebar-link">Extracting and Listing Files in Compressed Archives</a></li><li><a href="/r/probability-distributions-with-r.html" class="sidebar-link">Probability Distributions with R</a></li><li><a href="/r/r-in-latex-with-knitr.html" class="sidebar-link">R in LaTeX with knitr</a></li><li><a href="/r/web-crawling-in-r.html" class="sidebar-link">Web Crawling in R</a></li><li><a href="/r/creating-reports-with-rmarkdown.html" class="sidebar-link">Creating reports with RMarkdown</a></li><li><a href="/r/gpu-accelerated-computing.html" class="sidebar-link">GPU-accelerated computing</a></li><li><a href="/r/heatmap-and-heatmap-2.html" class="sidebar-link">heatmap and heatmap.2</a></li><li><a href="/r/network-analysis-with-the-igraph-package.html" class="sidebar-link">Network analysis with the igraph package</a></li><li><a href="/r/functional-programming.html" class="sidebar-link">Functional programming</a></li><li><a href="/r/get-user-input.html" class="sidebar-link">Get user input</a></li><li><a href="/r/spark-api-sparkr.html" class="sidebar-link">Spark API (SparkR)</a></li><li><a href="/r/meta-documentation-guidelines.html" class="sidebar-link">Meta: Documentation Guidelines</a></li><li><a href="/r/input-and-output.html" class="sidebar-link">Input and output</a></li><li><a href="/r/i-o-for-foreign-tables-excel-sas-spss-stata.html" class="sidebar-link">I/O for foreign tables (Excel, SAS, SPSS, Stata)</a></li><li><a href="/r/i-o-for-database-tables.html" class="sidebar-link">I/O for database tables</a></li><li><a href="/r/i-o-for-geographic-data-shapefiles-etc.html" class="sidebar-link">I/O for geographic data (shapefiles, etc.)</a></li><li><a href="/r/i-o-for-raster-images.html" class="sidebar-link">I/O for raster images</a></li><li><a href="/r/i-o-for-r-s-binary-format.html" class="sidebar-link">I/O for R's binary format</a></li><li><a href="/r/recycling.html" class="sidebar-link">Recycling</a></li><li><a href="/r/expression-parse-eval.html" class="sidebar-link">Expression: parse + eval</a></li><li><a href="/r/regular-expression-syntax-in-r.html" class="sidebar-link">Regular Expression Syntax in R</a></li><li><a href="/r/regular-expressions-regex.html" class="sidebar-link">Regular Expressions (regex)</a></li><li><a href="/r/combinatorics.html" class="sidebar-link">Combinatorics</a></li><li><a href="/r/solving-odes-in-r.html" class="sidebar-link">Solving ODEs in R</a></li><li><a href="/r/feature-selection-in-r-removing-extraneous-features.html" class="sidebar-link">Feature Selection in R -- Removing Extraneous Features</a></li><li><a href="/r/bibliography-in-rmd.html" class="sidebar-link">Bibliography in RMD</a></li><li><a href="/r/writing-functions-in-r.html" class="sidebar-link">Writing functions in R</a></li><li><a href="/r/color-schemes-for-graphics.html" class="sidebar-link">Color schemes for graphics</a></li><li><a href="/r/hierarchical-clustering-with-hclust.html" class="sidebar-link">Hierarchical clustering with hclust</a></li><li><a href="/r/random-forest-algorithm.html" class="sidebar-link">Random Forest Algorithm</a></li><li><a href="/r/restful-r-services.html" class="sidebar-link">RESTful R Services</a></li><li><a href="/r/machine-learning.html" class="sidebar-link">Machine learning</a></li><li><a href="/r/using-texreg-to-export-models-in-a-paper-ready-way.html" class="sidebar-link">Using texreg to export models in a paper-ready way</a></li><li><a href="/r/publishing.html" class="sidebar-link">Publishing</a></li><li><a href="/r/implement-state-machine-pattern-using-s4-class.html" aria-current="page" class="active sidebar-link">Implement State Machine Pattern using S4 Class</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/r/implement-state-machine-pattern-using-s4-class.html#parsing-lines-using-state-machine" class="sidebar-link">Parsing Lines using State Machine</a></li></ul></li><li><a href="/r/reshape-using-tidyr.html" class="sidebar-link">Reshape using tidyr</a></li><li><a href="/r/modifying-strings-by-substitution.html" class="sidebar-link">Modifying strings by substitution</a></li><li><a href="/r/non-standard-evaluation-and-standard-evaluation.html" class="sidebar-link">Non-standard evaluation and standard evaluation</a></li><li><a href="/r/randomization.html" class="sidebar-link">Randomization</a></li><li><a href="/r/object-oriented-programming-in-r.html" class="sidebar-link">Object-Oriented Programming in R</a></li><li><a href="/r/coercion.html" class="sidebar-link">Coercion</a></li><li><a href="/r/standardize-analyses-by-writing-standalone-r-scripts.html" class="sidebar-link">Standardize analyses by writing standalone R scripts</a></li><li><a href="/r/analyze-tweets-with-r.html" class="sidebar-link">Analyze tweets with R</a></li><li><a href="/r/natural-language-processing.html" class="sidebar-link">Natural language processing</a></li><li><a href="/r/r-markdown-notebooks-from-rstudio.html" class="sidebar-link">R Markdown Notebooks (from RStudio)</a></li><li><a href="/r/aggregating-data-frames.html" class="sidebar-link">Aggregating data frames</a></li><li><a href="/r/data-acquisition.html" class="sidebar-link">Data acquisition</a></li><li><a href="/r/r-memento-by-examples.html" class="sidebar-link">R memento by examples</a></li><li><a href="/r/updating-r-version.html" class="sidebar-link">Updating R version</a></li><li><a href="/r/introspection.html" class="sidebar-link">Introspection</a></li><li><a href="/r/roxygen2.html" class="sidebar-link">roxygen2</a></li><li><a href="/r/cleaning-data.html" class="sidebar-link">Cleaning data</a></li><li><a href="/r/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="implement-state-machine-pattern-using-s4-class"><a href="#implement-state-machine-pattern-using-s4-class" class="header-anchor">#</a> Implement State Machine Pattern using S4 Class</h1> <p><a href="https://en.wikipedia.org/wiki/Finite-state_machine" target="_blank" rel="noopener noreferrer">Finite States Machine<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> concepts are usually implemented under Object Oriented Programming (OOP) languages, for example using <a href="https://en.wikipedia.org/wiki/State_pattern" target="_blank" rel="noopener noreferrer">Java language, based on the State pattern<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> defined in GOF (refers to the book: &quot;Design Patterns&quot;).</p> <p>R provides several mechanisms to simulate the OO paradigm, let's apply <a href="http://adv-r.had.co.nz" target="_blank" rel="noopener noreferrer">S4 Object System<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for implementing this pattern.</p> <h2 id="parsing-lines-using-state-machine"><a href="#parsing-lines-using-state-machine" class="header-anchor">#</a> Parsing Lines using State Machine</h2> <p>Let's apply the <a href="https://en.wikipedia.org/wiki/State_pattern" target="_blank" rel="noopener noreferrer">State Machine pattern<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for parsing lines with the specific pattern using S4 Class feature from R.</p> <p><strong>PROBLEM ENUNCIATION</strong></p> <p>We need to parse a file where each line provides information about a person, using a delimiter (<code>&quot;;&quot;</code>), but some information provided is optional, and instead of providing an empty field, it is missing. On each line we can have the following information: <code>Name;[Address;]Phone</code>. Where the address information is optional, sometimes we have it and sometimes don’t, for example:</p> <div class="language-r extra-class"><pre class="language-r"><code>GREGORY BROWN<span class="token punctuation">;</span> <span class="token number">25</span> NE <span class="token number">25</span>TH<span class="token punctuation">;</span> <span class="token operator">+</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">786</span><span class="token operator">-</span><span class="token number">987</span><span class="token operator">-</span><span class="token number">6543</span>
DAVID SMITH<span class="token punctuation">;</span><span class="token number">786</span><span class="token operator">-</span><span class="token number">123</span><span class="token operator">-</span><span class="token number">4567</span>
ALAN PEREZ<span class="token punctuation">;</span> <span class="token number">25</span> SE <span class="token number">50</span>TH<span class="token punctuation">;</span> <span class="token operator">+</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">786</span><span class="token operator">-</span><span class="token number">987</span><span class="token operator">-</span><span class="token number">5553</span>

</code></pre></div><p>The second line does not provide address information. Therefore the number of delimiters may be deferent like in this case with one delimiter and for the other lines two delimiters.  Because the number of delimiters may vary, one way to atack this problem is to recognize the presence or not of a given field based on its pattern. In such case we can use a <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/regex.html" target="_blank" rel="noopener noreferrer">regular expression<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for identifying such patterns. For example:</p> <ul><li><strong>Name</strong>:  <code>&quot;^([A-Z]'?\\s+)* *[A-Z]+(\\s+[A-Z]{1,2}\\.?,? +)*[A-Z]+((-|\\s+)[A-Z]+)*$&quot;</code>. For example: <code>RAFAEL REAL, DAVID R. SMITH, ERNESTO PEREZ GONZALEZ, 0' CONNOR BROWN, LUIS PEREZ-MENA</code>, etc.</li> <li><strong>Address</strong>: <code>&quot;^\\s[0-9]{1,4}(\\s+[A-Z]{1,2}[0-9]{1,2}[A-Z]{1,2}|[A-Z\\s0-9]+)$&quot;</code>. For example: <code>11020 LE JEUNE ROAD</code>, <code>87 SW 27TH</code>. For the sake of simplicity we don't include here the zipcode, city, state, but I can be included in this field or adding additional fields.</li> <li><strong>Phone</strong>: <code>&quot;^\\s*(\\+1(-|\\s+))*[0-9]{3}(-|\\s+)[0-9]{3}(-|\\s+)[0-9]{4}$&quot;</code>. For example: <code>305-123-4567, 305 123 4567, +1-786-123-4567</code>.</li></ul> <p><strong>Notes</strong>:</p> <ul><li>I am considering the most common pattern of US addresses and phones, it can be easy extended to consider more general situations.</li> <li>In R the sign <code>&quot;\&quot;</code> has special meaning for character variables, therefore we need to escape it.</li> <li>In order to simplify the process of defining regular expressions a good recommendation is to use the following web page: <a href="https://regex101.com" target="_blank" rel="noopener noreferrer">regex101.com<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, so you can play with it, with a given example, until you get the expected result for all possible combinations.</li></ul> <p>The idea is to identify each line field based on previously defined patterns. The State pattern define the following entities (classes) that collaborate to control the specific behavior (The State Pattern is a behavior pattern):</p> <p><a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/regex.html" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/gToF2.png" alt="GOF State Pattern"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Let's describe each element considering the context of our problem:</p> <li>`Context`: Stores the context information of the parsing process, i.e. the current state and handles the entire State Machine Process. For each state, an action is executed (`handle()`), but the context delegates it, based on the state, on the action method defined for a particular state (`handle()` from `State` class).  It defines the interface of interest to clients. Our `Context` class can be defined like this:
<ul>
- Attributes: `state`
- Methods: `handle()`, ...
<ul><li>Attributes: <code>name, pattern</code></li> <li>Methods: <code>doAction()</code>, <code>isState</code> (using <code>pattern</code> attribute verify whether the input argument belong to this state pattern or not), …</li></ul> <p><strong>Note:</strong> It is a matter of preference how to name the method that carries out the action, <code>handle()</code>, <code>doAction()</code> or <code>goNext()</code>. The method name <code>doAction()</code> can be the same for both classes (<code>State</code>or <code>Context</code>) we preferred to name as <code>handle()</code> in the <code>Context</code> class for avoiding a confusion when defining two generic methods with the same input arguments, but different class.</p> <p><strong>PERSON CLASS</strong></p> <p>Using the S4 syntax we can define a Person class like this:</p> <div class="language-r extra-class"><pre class="language-r"><code>setClass<span class="token punctuation">(</span>Class <span class="token operator">=</span> <span class="token string">&quot;Person&quot;</span><span class="token punctuation">,</span>
    slots <span class="token operator">=</span> c<span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;character&quot;</span><span class="token punctuation">,</span> address <span class="token operator">=</span> <span class="token string">&quot;character&quot;</span><span class="token punctuation">,</span> phone <span class="token operator">=</span> <span class="token string">&quot;character&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>

</code></pre></div><p>It is a good recommendation to initialize the class attributes. The <code>setClass</code> documentation suggests using a generic method labeled as <code>&quot;initialize&quot;</code>, instead of using deprecated attributes such as: <code>prototype, representation</code>.</p> <div class="language-r extra-class"><pre class="language-r"><code>setMethod<span class="token punctuation">(</span><span class="token string">&quot;initialize&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Person&quot;</span><span class="token punctuation">,</span>
  definition <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>.Object<span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token keyword">NA_character_</span><span class="token punctuation">,</span>
    address <span class="token operator">=</span> <span class="token keyword">NA_character_</span><span class="token punctuation">,</span> phone <span class="token operator">=</span> <span class="token keyword">NA_character_</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        .Object<span class="token operator">@</span>name <span class="token operator">&lt;-</span> name
        .Object<span class="token operator">@</span>address <span class="token operator">&lt;-</span> address
        .Object<span class="token operator">@</span>phone <span class="token operator">&lt;-</span> phone
        .Object
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

</code></pre></div><p>Because the initialize method is already a standard generic method of package <code>methods</code>, we need to respect the original argument definition. We can verify it typing on R prompt:</p> <div class="language-r extra-class"><pre class="language-r"><code><span class="token operator">&gt;</span> initialize

</code></pre></div><p>It returns the entire function definition, you can see at the top who the function is defined like:</p> <div class="language-r extra-class"><pre class="language-r"><code><span class="token keyword">function</span> <span class="token punctuation">(</span>.Object<span class="token punctuation">,</span> <span class="token ellipsis">...</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token ellipsis">...</span><span class="token punctuation">}</span>

</code></pre></div><p>Therefore when we use <code>setMethod</code> we need to follow <strong>exaclty</strong> the same syntax (<code>.Object</code>).</p> <p>Another existing generic method is <code>show</code>, it is equivalent <code>toString()</code> method from Java and it is a good idea to have a specific implementation for class domain:</p> <div class="language-r extra-class"><pre class="language-r"><code>setMethod<span class="token punctuation">(</span><span class="token string">&quot;show&quot;</span><span class="token punctuation">,</span> signature <span class="token operator">=</span> <span class="token string">&quot;Person&quot;</span><span class="token punctuation">,</span>
  definition <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      info <span class="token operator">&lt;-</span> sprintf<span class="token punctuation">(</span><span class="token string">&quot;%s@[name='%s', address='%s', phone='%s']&quot;</span><span class="token punctuation">,</span> 
        class<span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">,</span> object<span class="token operator">@</span>name<span class="token punctuation">,</span> object<span class="token operator">@</span>address<span class="token punctuation">,</span> object<span class="token operator">@</span>phone<span class="token punctuation">)</span>
      cat<span class="token punctuation">(</span>info<span class="token punctuation">)</span>
      invisible<span class="token punctuation">(</span><span class="token keyword">NULL</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

</code></pre></div><p><strong>Note</strong>: We use the same convention as in the default  <code>toString()</code> Java  implementation.</p> <p>Let's say we want to save the parsed information (a list of <code>Person</code> objects) into a dataset, then we should be able first to convert a list of objects to into something the R can transform (for example coerce the object as a list). We can define the following additional method (for more detail about this see the <a href="http://stackoverflow.com/questions/30386009/how-to-extend-as-list-in-a-canonical-way-to-s4-objects" target="_blank" rel="noopener noreferrer">post<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)</p> <div class="language-r extra-class"><pre class="language-r"><code>setGeneric<span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;as.list&quot;</span><span class="token punctuation">,</span> signature <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    def <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> standardGeneric<span class="token punctuation">(</span><span class="token string">&quot;as.list&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Suggestion taken from here:</span>
<span class="token comment"># http://stackoverflow.com/questions/30386009/how-to-extend-as-list-in-a-canonical-way-to-s4-objects</span>
setMethod<span class="token punctuation">(</span><span class="token string">&quot;as.list&quot;</span><span class="token punctuation">,</span> signature <span class="token operator">=</span> <span class="token string">&quot;Person&quot;</span><span class="token punctuation">,</span>
    definition <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mapply<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">#apply as.list if the slot is again an user-defined object</span>
        <span class="token comment">#therefore, as.list gets applied recursively</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>inherits<span class="token punctuation">(</span>slot<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;Person&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          as.list<span class="token punctuation">(</span>slot<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment">#otherwise just return the slot</span>
          slot<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
        slotNames<span class="token punctuation">(</span>class<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        SIMPLIFY<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

</code></pre></div><p>R does not provide a sugar syntax for OO because the language was initially conceived to provide valuable functions for Statisticians. Therefore each user method requires two parts: 1) the Definition part (via <code>setGeneric</code>) and 2) the implementation part (via <code>setMethod</code>). Like in the above example.</p> <p><strong>STATE CLASS</strong></p> <p>Following S4 syntax, let's define the abstract <code>State</code> class.</p> <div class="language-r extra-class"><pre class="language-r"><code>setClass<span class="token punctuation">(</span>Class <span class="token operator">=</span> <span class="token string">&quot;State&quot;</span><span class="token punctuation">,</span> slots <span class="token operator">=</span> c<span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;character&quot;</span><span class="token punctuation">,</span> pattern <span class="token operator">=</span> <span class="token string">&quot;character&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

setMethod<span class="token punctuation">(</span><span class="token string">&quot;initialize&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;State&quot;</span><span class="token punctuation">,</span>
  definition <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>.Object<span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token keyword">NA_character_</span><span class="token punctuation">,</span> pattern <span class="token operator">=</span> <span class="token keyword">NA_character_</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      .Object<span class="token operator">@</span>name <span class="token operator">&lt;-</span> name
      .Object<span class="token operator">@</span>pattern <span class="token operator">&lt;-</span> pattern
      .Object
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

setMethod<span class="token punctuation">(</span><span class="token string">&quot;show&quot;</span><span class="token punctuation">,</span> signature <span class="token operator">=</span> <span class="token string">&quot;State&quot;</span><span class="token punctuation">,</span>
  definition <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      info <span class="token operator">&lt;-</span> sprintf<span class="token punctuation">(</span><span class="token string">&quot;%s@[name='%s', pattern='%s']&quot;</span><span class="token punctuation">,</span> class<span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">,</span> 
          object<span class="token operator">@</span>name<span class="token punctuation">,</span> object<span class="token operator">@</span>pattern<span class="token punctuation">)</span>
      cat<span class="token punctuation">(</span>info<span class="token punctuation">)</span>
      invisible<span class="token punctuation">(</span><span class="token keyword">NULL</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

setGeneric<span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;isState&quot;</span><span class="token punctuation">,</span> signature <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">'obj'</span><span class="token punctuation">,</span> <span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    def <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> input<span class="token punctuation">)</span> standardGeneric<span class="token punctuation">(</span><span class="token string">&quot;isState&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

setGeneric<span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;doAction&quot;</span><span class="token punctuation">,</span> signature <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">'obj'</span><span class="token punctuation">,</span> <span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token string">'context'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    def <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> input<span class="token punctuation">,</span> context<span class="token punctuation">)</span> standardGeneric<span class="token punctuation">(</span><span class="token string">&quot;doAction&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><p>Every sub-class from <code>State</code> will have associated a <code>name</code> and <code>pattern</code>, but also a way to identify whether a given input belongs to this state or not (<code>isState()</code> method), and also implement the corresponding actions for this state (<code>doAction()</code> method).</p> <p>In order to understand the process, let's define  the transition matrix for each state based on the input received:</p> <table><thead><tr><th>Input/Current State</th> <th>Init</th> <th>Name</th> <th>Address</th> <th>Phone</th></tr></thead> <tbody><tr><td>Name</td> <td>Name</td> <td></td> <td></td> <td></td></tr> <tr><td>Address</td> <td></td> <td>Address</td> <td></td> <td></td></tr> <tr><td>Phone</td> <td></td> <td>Phone</td> <td>Phone</td> <td></td></tr> <tr><td>End</td> <td></td> <td></td> <td></td> <td>End</td></tr></tbody></table> <p><strong>Note:</strong> The cell <code>[row, col]=[i,j]</code> represents the destination state for the current state <code>j</code>, when it receives the input <code>i</code>.</p> <p>It means that under the state Name it can receive two inputs: an address or a phone number. Another way to represents the transaction table is using the following <a href="https://en.wikipedia.org/wiki/UML_state_machine" target="_blank" rel="noopener noreferrer">UML State Machine<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> diagram:</p> <p><a href="https://i.stack.imgur.com/gToF2.png" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/119D9.png" alt="State Machine Diagram representation"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Let's implement each particular state as a sub-state of the class <code>State</code></p> <p><strong>STATE SUB-CLASSES</strong></p> <p><strong>Init State</strong>:</p> <p>The initial state will be implemented via the following class:</p> <div class="language-r extra-class"><pre class="language-r"><code>setClass<span class="token punctuation">(</span><span class="token string">&quot;InitState&quot;</span><span class="token punctuation">,</span> contains <span class="token operator">=</span> <span class="token string">&quot;State&quot;</span><span class="token punctuation">)</span>

setMethod<span class="token punctuation">(</span><span class="token string">&quot;initialize&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;InitState&quot;</span><span class="token punctuation">,</span>
  definition <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>.Object<span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">&quot;init&quot;</span><span class="token punctuation">,</span> pattern <span class="token operator">=</span> <span class="token keyword">NA_character_</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      .Object<span class="token operator">@</span>name <span class="token operator">&lt;-</span> name
      .Object<span class="token operator">@</span>pattern <span class="token operator">&lt;-</span> pattern
      .Object
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

setMethod<span class="token punctuation">(</span><span class="token string">&quot;show&quot;</span><span class="token punctuation">,</span> signature <span class="token operator">=</span> <span class="token string">&quot;InitState&quot;</span><span class="token punctuation">,</span>
  definition <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      callNextMethod<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

</code></pre></div><p>In R to indicate a class is a sub-class of other class is using the attribute <code>contains</code> and indicating the class name of the parent class.</p> <p>Because the sub-classes just implement the generic methods, without adding additional attributes, then the <code>show</code> method, just call the equivalent method from the upper class (via method: <code>callNextMethod()</code>)</p> <p>The initial state does not have associated a pattern, it just represents the beginning of the process, then we initialize the class with an <code>NA</code> value.</p> <p>Now lets to implement the generic methods from the <code>State</code> class:</p> <div class="language-r extra-class"><pre class="language-r"><code>setMethod<span class="token punctuation">(</span>f <span class="token operator">=</span> <span class="token string">&quot;isState&quot;</span><span class="token punctuation">,</span> signature <span class="token operator">=</span> <span class="token string">&quot;InitState&quot;</span><span class="token punctuation">,</span>
  definition <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> input<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      nameState <span class="token operator">&lt;-</span> new<span class="token punctuation">(</span><span class="token string">&quot;NameState&quot;</span><span class="token punctuation">)</span>
      result <span class="token operator">&lt;-</span> isState<span class="token punctuation">(</span>nameState<span class="token punctuation">,</span> input<span class="token punctuation">)</span>
      return<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

</code></pre></div><p>For this particular state (without <code>pattern</code>), the idea it just initializes the parsing process expecting the first field will be a <code>name</code>, otherwise it will be an error.</p> <div class="language-r extra-class"><pre class="language-r"><code>setMethod<span class="token punctuation">(</span>f <span class="token operator">=</span> <span class="token string">&quot;doAction&quot;</span><span class="token punctuation">,</span> signature <span class="token operator">=</span> <span class="token string">&quot;InitState&quot;</span><span class="token punctuation">,</span>
    definition <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> input<span class="token punctuation">,</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        nameState <span class="token operator">&lt;-</span> new<span class="token punctuation">(</span><span class="token string">&quot;NameState&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>isState<span class="token punctuation">(</span>nameState<span class="token punctuation">,</span> input<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            person <span class="token operator">&lt;-</span> context<span class="token operator">@</span>person
            person<span class="token operator">@</span>name <span class="token operator">&lt;-</span> trimws<span class="token punctuation">(</span>input<span class="token punctuation">)</span>
            context<span class="token operator">@</span>person <span class="token operator">&lt;-</span> person
            context<span class="token operator">@</span>state <span class="token operator">&lt;-</span> nameState
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            msg <span class="token operator">&lt;-</span> sprintf<span class="token punctuation">(</span><span class="token string">&quot;The input argument: '%s' cannot be identified&quot;</span><span class="token punctuation">,</span> input<span class="token punctuation">)</span>
            stop<span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        return<span class="token punctuation">(</span>context<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

</code></pre></div><p>The <code>doAction</code> method provides the transition and updates the context with the information extracted. Here we are accessing to context information via the <code>@-operator</code>. Instead, we can define <code>get/set</code> methods, to encapsulate this process (as it is mandated in OO best practices: encapsulation), but that would add four more methods per <code>get-set</code> without adding value for the purpose of this example.</p> <p>It is a good recommendation in all <code>doAction</code> implementation, to add a safeguard when the input argument is not properly identified.</p> <p><strong>Name State</strong></p> <p>Here is the definition of this class definition:</p> <div class="language-r extra-class"><pre class="language-r"><code>setClass <span class="token punctuation">(</span><span class="token string">&quot;NameState&quot;</span><span class="token punctuation">,</span> contains <span class="token operator">=</span> <span class="token string">&quot;State&quot;</span><span class="token punctuation">)</span>

setMethod<span class="token punctuation">(</span><span class="token string">&quot;initialize&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;NameState&quot;</span><span class="token punctuation">,</span>
  definition<span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span>.Object<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span>
        pattern <span class="token operator">=</span> <span class="token string">&quot;^([A-Z]'?\\s+)* *[A-Z]+(\\s+[A-Z]{1,2}\\.?,? +)*[A-Z]+((-|\\s+)[A-Z]+)*$&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        .Object<span class="token operator">@</span>pattern <span class="token operator">&lt;-</span> pattern
        .Object<span class="token operator">@</span>name <span class="token operator">&lt;-</span> name
        .Object       
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

setMethod<span class="token punctuation">(</span><span class="token string">&quot;show&quot;</span><span class="token punctuation">,</span> signature <span class="token operator">=</span> <span class="token string">&quot;NameState&quot;</span><span class="token punctuation">,</span>
  definition <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      callNextMethod<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

</code></pre></div><p>We use the function <code>grepl</code> for verifying the input belongs to a given pattern.</p> <div class="language-r extra-class"><pre class="language-r"><code>setMethod<span class="token punctuation">(</span>f<span class="token operator">=</span><span class="token string">&quot;isState&quot;</span><span class="token punctuation">,</span> signature<span class="token operator">=</span><span class="token string">&quot;NameState&quot;</span><span class="token punctuation">,</span>
  definition<span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> input<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      result <span class="token operator">&lt;-</span> grepl<span class="token punctuation">(</span>obj<span class="token operator">@</span>pattern<span class="token punctuation">,</span> input<span class="token punctuation">,</span> perl<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>
      return<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

</code></pre></div><p>Now we define the action to carry out for a given state:</p> <div class="language-r extra-class"><pre class="language-r"><code>setMethod<span class="token punctuation">(</span>f <span class="token operator">=</span> <span class="token string">&quot;doAction&quot;</span><span class="token punctuation">,</span> signature <span class="token operator">=</span> <span class="token string">&quot;NameState&quot;</span><span class="token punctuation">,</span>
  definition<span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> input<span class="token punctuation">,</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      addressState <span class="token operator">&lt;-</span> new<span class="token punctuation">(</span><span class="token string">&quot;AddressState&quot;</span><span class="token punctuation">)</span>
      phoneState <span class="token operator">&lt;-</span> new<span class="token punctuation">(</span><span class="token string">&quot;PhoneState&quot;</span><span class="token punctuation">)</span>
      person <span class="token operator">&lt;-</span> context<span class="token operator">@</span>person
      <span class="token keyword">if</span> <span class="token punctuation">(</span>isState<span class="token punctuation">(</span>addressState<span class="token punctuation">,</span> input<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          person<span class="token operator">@</span>address <span class="token operator">&lt;-</span> trimws<span class="token punctuation">(</span>input<span class="token punctuation">)</span>
          context<span class="token operator">@</span>person <span class="token operator">&lt;-</span> person
          context<span class="token operator">@</span>state <span class="token operator">&lt;-</span> addressState
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>isState<span class="token punctuation">(</span>phoneState<span class="token punctuation">,</span> input<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          person<span class="token operator">@</span>phone <span class="token operator">&lt;-</span> trimws<span class="token punctuation">(</span>input<span class="token punctuation">)</span>
          context<span class="token operator">@</span>person <span class="token operator">&lt;-</span> person
          context<span class="token operator">@</span>state <span class="token operator">&lt;-</span> phoneState
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          msg <span class="token operator">&lt;-</span> sprintf<span class="token punctuation">(</span><span class="token string">&quot;The input argument: '%s' cannot be identified&quot;</span><span class="token punctuation">,</span> input<span class="token punctuation">)</span>
          stop<span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      return<span class="token punctuation">(</span>context<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

</code></pre></div><p>Here we consider to possible transitions: one for Address state and the other one for Phone state. In all cases we update the context information:</p> <ul><li>The <code>person</code> information: <code>address</code> or <code>phone</code> with the input argument.</li> <li>The <code>state</code> of the process</li></ul> <p>The way to identify the state is to invoke the method: <code>isState()</code> for a particular state. We create a default specific states (<code>addressState, phoneState</code>) and then ask for a particular validation.</p> <p>The logic for the other sub-classes (one per state) implementation is very similar.</p> <p><strong>Address State</strong></p> <div class="language-r extra-class"><pre class="language-r"><code>setClass<span class="token punctuation">(</span><span class="token string">&quot;AddressState&quot;</span><span class="token punctuation">,</span> contains <span class="token operator">=</span> <span class="token string">&quot;State&quot;</span><span class="token punctuation">)</span>

setMethod<span class="token punctuation">(</span><span class="token string">&quot;initialize&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;AddressState&quot;</span><span class="token punctuation">,</span>
  definition <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>.Object<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">&quot;address&quot;</span><span class="token punctuation">,</span>
    pattern <span class="token operator">=</span> <span class="token string">&quot;^\\s[0-9]{1,4}(\\s+[A-Z]{1,2}[0-9]{1,2}[A-Z]{1,2}|[A-Z\\s0-9]+)$&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        .Object<span class="token operator">@</span>pattern <span class="token operator">&lt;-</span> pattern
        .Object<span class="token operator">@</span>name <span class="token operator">&lt;-</span> name
        .Object
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

setMethod<span class="token punctuation">(</span><span class="token string">&quot;show&quot;</span><span class="token punctuation">,</span> signature <span class="token operator">=</span> <span class="token string">&quot;AddressState&quot;</span><span class="token punctuation">,</span>
  definition <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      callNextMethod<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

setMethod<span class="token punctuation">(</span>f<span class="token operator">=</span><span class="token string">&quot;isState&quot;</span><span class="token punctuation">,</span> signature<span class="token operator">=</span><span class="token string">&quot;AddressState&quot;</span><span class="token punctuation">,</span>
    definition<span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> input<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        result <span class="token operator">&lt;-</span> grepl<span class="token punctuation">(</span>obj<span class="token operator">@</span>pattern<span class="token punctuation">,</span> input<span class="token punctuation">,</span> perl<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>
        return<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
    
setMethod<span class="token punctuation">(</span>f <span class="token operator">=</span> <span class="token string">&quot;doAction&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;AddressState&quot;</span><span class="token punctuation">,</span>
    definition<span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> input<span class="token punctuation">,</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        phoneState <span class="token operator">&lt;-</span> new<span class="token punctuation">(</span><span class="token string">&quot;PhoneState&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>isState<span class="token punctuation">(</span>phoneState<span class="token punctuation">,</span> input<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            person <span class="token operator">&lt;-</span> context<span class="token operator">@</span>person
            person<span class="token operator">@</span>phone <span class="token operator">&lt;-</span> trimws<span class="token punctuation">(</span>input<span class="token punctuation">)</span>
            context<span class="token operator">@</span>person <span class="token operator">&lt;-</span> person
            context<span class="token operator">@</span>state <span class="token operator">&lt;-</span> phoneState
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            msg <span class="token operator">&lt;-</span> sprintf<span class="token punctuation">(</span><span class="token string">&quot;The input argument: '%s' cannot be identified&quot;</span><span class="token punctuation">,</span> input<span class="token punctuation">)</span>
            stop<span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        return<span class="token punctuation">(</span>context<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

</code></pre></div><p><strong>Phone State</strong></p> <div class="language-r extra-class"><pre class="language-r"><code>setClass<span class="token punctuation">(</span><span class="token string">&quot;PhoneState&quot;</span><span class="token punctuation">,</span> contains <span class="token operator">=</span> <span class="token string">&quot;State&quot;</span><span class="token punctuation">)</span>

setMethod<span class="token punctuation">(</span><span class="token string">&quot;initialize&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;PhoneState&quot;</span><span class="token punctuation">,</span>
  definition <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>.Object<span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">&quot;phone&quot;</span><span class="token punctuation">,</span>
    pattern <span class="token operator">=</span> <span class="token string">&quot;^\\s*(\\+1(-|\\s+))*[0-9]{3}(-|\\s+)[0-9]{3}(-|\\s+)[0-9]{4}$&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        .Object<span class="token operator">@</span>pattern <span class="token operator">&lt;-</span> pattern
        .Object<span class="token operator">@</span>name <span class="token operator">&lt;-</span> name
        .Object
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

setMethod<span class="token punctuation">(</span><span class="token string">&quot;show&quot;</span><span class="token punctuation">,</span> signature <span class="token operator">=</span> <span class="token string">&quot;PhoneState&quot;</span><span class="token punctuation">,</span>
  definition <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      callNextMethod<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

setMethod<span class="token punctuation">(</span>f <span class="token operator">=</span> <span class="token string">&quot;isState&quot;</span><span class="token punctuation">,</span> signature <span class="token operator">=</span> <span class="token string">&quot;PhoneState&quot;</span><span class="token punctuation">,</span>
    definition <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> input<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        result <span class="token operator">&lt;-</span> grepl<span class="token punctuation">(</span>obj<span class="token operator">@</span>pattern<span class="token punctuation">,</span> input<span class="token punctuation">,</span> perl <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>
        return<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

</code></pre></div><p>Here is where we add the person information into the list of <code>persons</code> of the <code>context</code>.</p> <div class="language-r extra-class"><pre class="language-r"><code>setMethod<span class="token punctuation">(</span>f <span class="token operator">=</span> <span class="token string">&quot;doAction&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;PhoneState&quot;</span><span class="token punctuation">,</span>
    definition <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> input<span class="token punctuation">,</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        context <span class="token operator">&lt;-</span> addPerson<span class="token punctuation">(</span>context<span class="token punctuation">,</span> context<span class="token operator">@</span>person<span class="token punctuation">)</span>
        context<span class="token operator">@</span>state <span class="token operator">&lt;-</span> new<span class="token punctuation">(</span><span class="token string">&quot;InitState&quot;</span><span class="token punctuation">)</span>
        return<span class="token punctuation">(</span>context<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>   
<span class="token punctuation">)</span>

</code></pre></div><p><strong>CONTEXT CLASS</strong></p> <p>Now the lets to explain the <code>Context</code> class implementation. We can define it considering the following attributes:</p> <div class="language-r extra-class"><pre class="language-r"><code>setClass<span class="token punctuation">(</span>Class <span class="token operator">=</span> <span class="token string">&quot;Context&quot;</span><span class="token punctuation">,</span>
     slots <span class="token operator">=</span> c<span class="token punctuation">(</span>state <span class="token operator">=</span> <span class="token string">&quot;State&quot;</span><span class="token punctuation">,</span> persons <span class="token operator">=</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span> person <span class="token operator">=</span> <span class="token string">&quot;Person&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>

</code></pre></div><p>Where</p> <ul><li><code>state</code>: The current state of the process</li> <li><code>person</code>: The current person, it represents the information we have already parsed from the current line.</li> <li><code>persons</code>: The list of parsed persons processed.</li></ul> <p><strong>Note</strong>:  Optionally, we can add a <code>name</code> to identify the context by name in case we are working with more than one parser type.</p> <div class="language-r extra-class"><pre class="language-r"><code>setMethod<span class="token punctuation">(</span>f<span class="token operator">=</span><span class="token string">&quot;initialize&quot;</span><span class="token punctuation">,</span> signature<span class="token operator">=</span><span class="token string">&quot;Context&quot;</span><span class="token punctuation">,</span>
  definition <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>.Object<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        .Object<span class="token operator">@</span>state <span class="token operator">&lt;-</span> new<span class="token punctuation">(</span><span class="token string">&quot;InitState&quot;</span><span class="token punctuation">)</span>
        .Object<span class="token operator">@</span>persons <span class="token operator">&lt;-</span> list<span class="token punctuation">(</span><span class="token punctuation">)</span>
        .Object<span class="token operator">@</span>person <span class="token operator">&lt;-</span> new<span class="token punctuation">(</span><span class="token string">&quot;Person&quot;</span><span class="token punctuation">)</span>
        return<span class="token punctuation">(</span>.Object<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

setMethod<span class="token punctuation">(</span><span class="token string">&quot;show&quot;</span><span class="token punctuation">,</span> signature <span class="token operator">=</span> <span class="token string">&quot;Context&quot;</span><span class="token punctuation">,</span>
  definition <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      cat<span class="token punctuation">(</span><span class="token string">&quot;An object of class &quot;</span><span class="token punctuation">,</span> class<span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;\n&quot;</span><span class="token punctuation">,</span> sep <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
      info <span class="token operator">&lt;-</span> sprintf<span class="token punctuation">(</span><span class="token string">&quot;[state='%s', persons='%s', person='%s']&quot;</span><span class="token punctuation">,</span> object<span class="token operator">@</span>state<span class="token punctuation">,</span>
          toString<span class="token punctuation">(</span>object<span class="token operator">@</span>persons<span class="token punctuation">)</span><span class="token punctuation">,</span> object<span class="token operator">@</span>person<span class="token punctuation">)</span>
      cat<span class="token punctuation">(</span>info<span class="token punctuation">)</span>
      invisible<span class="token punctuation">(</span><span class="token keyword">NULL</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

setGeneric<span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;handle&quot;</span><span class="token punctuation">,</span> signature <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">'obj'</span><span class="token punctuation">,</span> <span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token string">'context'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    def <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> input<span class="token punctuation">,</span> context<span class="token punctuation">)</span> standardGeneric<span class="token punctuation">(</span><span class="token string">&quot;handle&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

setGeneric<span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;addPerson&quot;</span><span class="token punctuation">,</span> signature <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">'obj'</span><span class="token punctuation">,</span> <span class="token string">'person'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    def <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> person<span class="token punctuation">)</span> standardGeneric<span class="token punctuation">(</span><span class="token string">&quot;addPerson&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

setGeneric<span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;parseLine&quot;</span><span class="token punctuation">,</span> signature <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">'obj'</span><span class="token punctuation">,</span> <span class="token string">'s'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    def <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> s<span class="token punctuation">)</span> standardGeneric<span class="token punctuation">(</span><span class="token string">&quot;parseLine&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

setGeneric<span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;parseLines&quot;</span><span class="token punctuation">,</span> signature <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">'obj'</span><span class="token punctuation">,</span> <span class="token string">'s'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    def <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> s<span class="token punctuation">)</span> standardGeneric<span class="token punctuation">(</span><span class="token string">&quot;parseLines&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

setGeneric<span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;as.df&quot;</span><span class="token punctuation">,</span> signature <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">'obj'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    def <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> standardGeneric<span class="token punctuation">(</span><span class="token string">&quot;as.df&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><p>With such generic methods, we control the entire behavior  of the parsing process:</p> <ul><li><code>handle()</code>: Will invoke the particular <code>doAction()</code> method of the current <code>state</code>.</li> <li><code>addPerson</code>: Once we reach the end state, we need to add a <code>person</code> to the list of <code>persons</code> we have parsed.</li> <li><code>parseLine()</code>: Parse a single line</li> <li><code>parseLines()</code>: Parse multiple lines (an array of lines)</li> <li><code>as.df()</code>: Extract the information from <code>persons</code> list into a data frame object.</li></ul> <p>Let's go on now with the corresponding implementations:</p> <p><code>handle()</code> method, delegates on <code>doAction()</code> method from the current <code>state</code> of the <code>context</code>:</p> <div class="language-r extra-class"><pre class="language-r"><code>setMethod<span class="token punctuation">(</span>f <span class="token operator">=</span> <span class="token string">&quot;handle&quot;</span><span class="token punctuation">,</span> signature <span class="token operator">=</span> <span class="token string">&quot;Context&quot;</span><span class="token punctuation">,</span>
    definition <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> input<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        obj <span class="token operator">&lt;-</span> doAction<span class="token punctuation">(</span>obj<span class="token operator">@</span>state<span class="token punctuation">,</span> input<span class="token punctuation">,</span> obj<span class="token punctuation">)</span>
        return<span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

setMethod<span class="token punctuation">(</span>f <span class="token operator">=</span> <span class="token string">&quot;addPerson&quot;</span><span class="token punctuation">,</span> signature <span class="token operator">=</span> <span class="token string">&quot;Context&quot;</span><span class="token punctuation">,</span>
  definition <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> person<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      obj<span class="token operator">@</span>persons <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span>obj<span class="token operator">@</span>persons<span class="token punctuation">,</span> person<span class="token punctuation">)</span>
      return<span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

</code></pre></div><p>First, we split the original line in an array using the delimiter to identify each element via the R-function <code>strsplit()</code>, then iterate for each element as an input value for a given state. The <code>handle()</code> method returns again the <code>context</code> with the updated information (<code>state</code>, <code>person</code>, <code>persons</code> attribute).</p> <div class="language-r extra-class"><pre class="language-r"><code>setMethod<span class="token punctuation">(</span>f <span class="token operator">=</span> <span class="token string">&quot;parseLine&quot;</span><span class="token punctuation">,</span> signature <span class="token operator">=</span> <span class="token string">&quot;Context&quot;</span><span class="token punctuation">,</span>
  definition <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      elements <span class="token operator">&lt;-</span> strsplit<span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">&quot;;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
      <span class="token comment"># Adding an empty field for considering the end state.</span>
      elements <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span>elements<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
      n <span class="token operator">&lt;-</span> length<span class="token punctuation">(</span>elements<span class="token punctuation">)</span>
      input <span class="token operator">&lt;-</span> <span class="token keyword">NULL</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        input <span class="token operator">&lt;-</span> elements<span class="token punctuation">[</span>i<span class="token punctuation">]</span>  
        obj <span class="token operator">&lt;-</span> handle<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> input<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      return<span class="token punctuation">(</span>obj<span class="token operator">@</span>person<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

</code></pre></div><p>Becuase R makes a copy of the input argument, we need to return the context (<code>obj</code>):</p> <div class="language-r extra-class"><pre class="language-r"><code>setMethod<span class="token punctuation">(</span>f <span class="token operator">=</span> <span class="token string">&quot;parseLines&quot;</span><span class="token punctuation">,</span> signature <span class="token operator">=</span> <span class="token string">&quot;Context&quot;</span><span class="token punctuation">,</span>
  definition <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      n <span class="token operator">&lt;-</span> length<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
      listOfPersons <span class="token operator">&lt;-</span> list<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          ipersons <span class="token operator">&lt;-</span> parseLine<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
          listOfPersons<span class="token punctuation">[</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&lt;-</span> ipersons
      <span class="token punctuation">}</span>
      obj<span class="token operator">@</span>persons <span class="token operator">&lt;-</span> listOfPersons
      return<span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

</code></pre></div><p>The attribute <code>persons</code> is a list of instance of S4 <code>Person</code> class. This something cannot be coerced to any standard type because R does not know of to treat an instance of a user defined class. The solution is to convert a <code>Person</code> into a list, using the <code>as.list</code> method previously defined.  Then we can apply this function to each element of the list <code>persons</code>, via the <code>lapply()</code> function. Then in the next invocation to <code>lappy()</code> function, now applies the <code>data.frame</code> function for converting each element of the <code>persons.list</code> into a data frame. Finally, the <code>rbind()</code> function is called for adding each element converted as a new row of the data frame generated (for more detail about this see this <a href="http://stackoverflow.com/questions/4227223/r-list-to-data-frame" target="_blank" rel="noopener noreferrer">post<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)</p> <div class="language-r extra-class"><pre class="language-r"><code><span class="token comment"># Sugestion taken from this post:</span>
<span class="token comment"># http://stackoverflow.com/questions/4227223/r-list-to-data-frame</span>
setMethod<span class="token punctuation">(</span>f <span class="token operator">=</span> <span class="token string">&quot;as.df&quot;</span><span class="token punctuation">,</span> signature <span class="token operator">=</span> <span class="token string">&quot;Context&quot;</span><span class="token punctuation">,</span>
  definition <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    persons <span class="token operator">&lt;-</span> obj<span class="token operator">@</span>persons
    persons.list <span class="token operator">&lt;-</span> lapply<span class="token punctuation">(</span>persons<span class="token punctuation">,</span> as.list<span class="token punctuation">)</span>
    persons.ds <span class="token operator">&lt;-</span> do.call<span class="token punctuation">(</span>rbind<span class="token punctuation">,</span> lapply<span class="token punctuation">(</span>persons.list<span class="token punctuation">,</span> data.frame<span class="token punctuation">,</span> stringsAsFactors <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    return<span class="token punctuation">(</span>persons.ds<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

</code></pre></div><p><strong>PUTTING ALL TOGETHER</strong></p> <p>Finally, lets to test the entire solution. Define the lines to parse where for the second line the address information is missing.</p> <div class="language-r extra-class"><pre class="language-r"><code>s <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span>
    <span class="token string">&quot;GREGORY BROWN; 25 NE 25TH; +1-786-987-6543&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;DAVID SMITH;786-123-4567&quot;</span><span class="token punctuation">,</span>
     <span class="token string">&quot;ALAN PEREZ; 25 SE 50TH; +1-786-987-5553&quot;</span>
<span class="token punctuation">)</span>

</code></pre></div><p>Now we initialize the <code>context</code>, and parse the lines:</p> <div class="language-r extra-class"><pre class="language-r"><code>context <span class="token operator">&lt;-</span> new<span class="token punctuation">(</span><span class="token string">&quot;Context&quot;</span><span class="token punctuation">)</span>
context <span class="token operator">&lt;-</span> parseLines<span class="token punctuation">(</span>context<span class="token punctuation">,</span> s<span class="token punctuation">)</span>

</code></pre></div><p>Finally obtain the corresponding dataset and print it:</p> <div class="language-r extra-class"><pre class="language-r"><code>df <span class="token operator">&lt;-</span> as.df<span class="token punctuation">(</span>context<span class="token punctuation">)</span>
<span class="token operator">&gt;</span> df
           name    address           phone
<span class="token number">1</span> GREGORY BROWN <span class="token number">25</span> NE <span class="token number">25</span>TH <span class="token operator">+</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">786</span><span class="token operator">-</span><span class="token number">987</span><span class="token operator">-</span><span class="token number">6543</span>
<span class="token number">2</span>   DAVID SMITH       <span class="token operator">&lt;</span><span class="token keyword">NA</span><span class="token operator">&gt;</span>    <span class="token number">786</span><span class="token operator">-</span><span class="token number">123</span><span class="token operator">-</span><span class="token number">4567</span>
<span class="token number">3</span>    ALAN PEREZ <span class="token number">25</span> SE <span class="token number">50</span>TH <span class="token operator">+</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">786</span><span class="token operator">-</span><span class="token number">987</span><span class="token operator">-</span><span class="token number">5553</span>

</code></pre></div><p>Let's test now the <code>show</code> methods:</p> <div class="language-r extra-class"><pre class="language-r"><code><span class="token operator">&gt;</span> show<span class="token punctuation">(</span>context<span class="token operator">@</span>persons<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
Person<span class="token operator">@</span><span class="token punctuation">[</span>name<span class="token operator">=</span><span class="token string">'GREGORY BROWN'</span><span class="token punctuation">,</span> address<span class="token operator">=</span><span class="token string">'25 NE 25TH'</span><span class="token punctuation">,</span> phone<span class="token operator">=</span><span class="token string">'+1-786-987-6543'</span><span class="token punctuation">]</span>

</code></pre></div><p>And for some sub-state:</p> <div class="language-r extra-class"><pre class="language-r"><code><span class="token operator">&gt;</span>show<span class="token punctuation">(</span>new<span class="token punctuation">(</span><span class="token string">&quot;PhoneState&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
PhoneState<span class="token operator">@</span><span class="token punctuation">[</span>name<span class="token operator">=</span><span class="token string">'phone'</span><span class="token punctuation">,</span> pattern<span class="token operator">=</span><span class="token string">'^\s*(\+1(-|\s+))*[0-9]{3}(-|\s+)[0-9]{3}(-|\s+)[0-9]{4}$'</span><span class="token punctuation">]</span>

</code></pre></div><p>Finally, test the <code>as.list()</code> method:</p> <div class="language-r extra-class"><pre class="language-r"><code><span class="token operator">&gt;</span> as.list<span class="token punctuation">(</span>context<span class="token operator">@</span>persons<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">$</span>name
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">&quot;GREGORY BROWN&quot;</span>

<span class="token operator">$</span>address
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">&quot;25 NE 25TH&quot;</span>

<span class="token operator">$</span>phone
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">&quot;+1-786-987-6543&quot;</span>

<span class="token operator">&gt;</span> 

</code></pre></div><p><strong>CONCLUSION</strong></p> <p>This example shows how to implement the State pattern, using one of the available mechanisms from R for using the OO paradigm. Nevertheless, the R OO solution is not user-friendly and differs so much from other OOP languages. You need to switch your mindset because the syntax is completely different, it reminds more the functional programming paradigm. For example instead of: <code>object.setID(&quot;A1&quot;)</code> as in Java/C#, for R you have to invoke the method in this way: <code>setID(object, &quot;A1&quot;)</code>.  Therefore you always have to include the object as an input argument to provide the context of the function. On the same way, there is no special <code>this</code> class attribute and either a <code>&quot;.&quot;</code> notation for accessing methods or attributes of the given class. It is more error prompt because to refer a class or methods is done via attribute value (<code>&quot;Person&quot;</code>, <code>&quot;isState&quot;</code>, etc.).</p> <p>Said the above, S4 class solution, requires much more lines of codes than a traditional Java/C# languages for doing simple tasks.  Anyway, the State Pattern is a good and generic solution for such kind of problems. It simplifies the process delegating the logic into a particular state. Instead of having a big <code>if-else</code> block for controlling all situations, we have smaller <code>if-else</code> blocks inside on each <code>State</code> sub-class implementation for implementing the action to carry out in each state.</p> <p><strong>Attachment</strong>: <a href="https://www.sugarsync.com/pf/D309535_3_7753221989" target="_blank" rel="noopener noreferrer">Here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> you can download the entire script.</p> <p>Any suggestion is welcome.</p></ul></li></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/r/implement-state-machine-pattern-using-s4-class.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/r/publishing.html" class="prev">
        Publishing
      </a></span> <span class="next"><a href="/r/reshape-using-tidyr.html">
        Reshape using tidyr
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/2904.c741d241.js" defer></script>
  </body>
</html>
