<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Xamarin - Publishing your Xamarin.Android APK</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Preparing your APK in the Visual Studio, Enabling MultiDex in your Xamarin.Android APK, Enabling ProGuard in your Xamarin.Android APK, Mysterious bugs related to ProGuard and Linker">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="Xamarin - Publishing your Xamarin.Android APK">
    <meta property="og:description" content="Preparing your APK in the Visual Studio, Enabling MultiDex in your Xamarin.Android APK, Enabling ProGuard in your Xamarin.Android APK, Mysterious bugs related to ProGuard and Linker">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/xamarin/publishing-your-xamarin-android-apk.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="Xamarin - Publishing your Xamarin.Android APK">
    <meta name="twitter:description" content="Preparing your APK in the Visual Studio, Enabling MultiDex in your Xamarin.Android APK, Enabling ProGuard in your Xamarin.Android APK, Mysterious bugs related to ProGuard and Linker">
    <meta name="twitter:url" content="/xamarin/publishing-your-xamarin-android-apk.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/3548.05dd7183.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Xamarin</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/xamarin/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/xamarin/getting-started-with-xamarin-forms.html" class="sidebar-link">Getting started with Xamarin.Forms</a></li><li><a href="/xamarin/why-xamarin-forms-and-when-to-use-xamarin-forms.html" class="sidebar-link">Why Xamarin Forms and When to use Xamarin Forms</a></li><li><a href="/xamarin/xamarin-forms-layouts.html" class="sidebar-link">Xamarin Forms Layouts</a></li><li><a href="/xamarin/xamarin-relative-layout.html" class="sidebar-link">Xamarin Relative Layout</a></li><li><a href="/xamarin/navigation-in-xamarin-forms.html" class="sidebar-link">Navigation in Xamarin.Forms</a></li><li><a href="/xamarin/xamarin-forms-page.html" class="sidebar-link">Xamarin.Forms Page</a></li><li><a href="/xamarin/xamarin-forms-cells.html" class="sidebar-link">Xamarin.Forms Cells</a></li><li><a href="/xamarin/xamarin-forms-views.html" class="sidebar-link">Xamarin.Forms Views</a></li><li><a href="/xamarin/using-listviews.html" class="sidebar-link">Using ListViews</a></li><li><a href="/xamarin/display-alert.html" class="sidebar-link">Display Alert</a></li><li><a href="/xamarin/accessing-native-features-with-dependencyservice.html" class="sidebar-link">Accessing native features with DependencyService</a></li><li><a href="/xamarin/dependencyservice.html" class="sidebar-link">DependencyService</a></li><li><a href="/xamarin/custom-renderers.html" class="sidebar-link">Custom Renderers</a></li><li><a href="/xamarin/caching.html" class="sidebar-link">Caching</a></li><li><a href="/xamarin/gestures.html" class="sidebar-link">Gestures</a></li><li><a href="/xamarin/data-binding.html" class="sidebar-link">Data Binding</a></li><li><a href="/xamarin/working-with-maps.html" class="sidebar-link">Working with Maps</a></li><li><a href="/xamarin/custom-fonts-in-styles.html" class="sidebar-link">Custom Fonts in Styles</a></li><li><a href="/xamarin/push-notifications.html" class="sidebar-link">Push Notifications</a></li><li><a href="/xamarin/effects.html" class="sidebar-link">Effects</a></li><li><a href="/xamarin/triggers-behaviours.html" class="sidebar-link">Triggers &amp; Behaviours</a></li><li><a href="/xamarin/appsettings-reader-in-xamarin-forms.html" class="sidebar-link">AppSettings Reader in Xamarin.Forms</a></li><li><a href="/xamarin/creating-custom-controls.html" class="sidebar-link">Creating custom controls</a></li><li><a href="/xamarin/working-with-local-databases.html" class="sidebar-link">Working with local databases</a></li><li><a href="/xamarin/carouselview-pre-release-version.html" class="sidebar-link">CarouselView - Pre-release version</a></li><li><a href="/xamarin/exception-handling.html" class="sidebar-link">Exception handling</a></li><li><a href="/xamarin/sql-database-and-api-in-xamarin-forms.html" class="sidebar-link">SQL Database and API in Xamarin Forms.</a></li><li><a href="/xamarin/contact-picker-xamarin-forms-android-and-ios.html" class="sidebar-link">Contact Picker - Xamarin Forms (Android and iOS)</a></li><li><a href="/xamarin/xamarin-plugin.html" class="sidebar-link">Xamarin Plugin</a></li><li><a href="/xamarin/oauth2.html" class="sidebar-link">OAuth2</a></li><li><a href="/xamarin/messagingcenter.html" class="sidebar-link">MessagingCenter</a></li><li><a href="/xamarin/generic-xamarin-forms-app-lifecycle-platform-dependant.html" class="sidebar-link">Generic Xamarin.Forms app lifecycle? Platform-dependant!</a></li><li><a href="/xamarin/platform-specific-behaviour.html" class="sidebar-link">Platform-specific behaviour</a></li><li><a href="/xamarin/platform-specific-visual-adjustments.html" class="sidebar-link">Platform specific visual adjustments</a></li><li><a href="/xamarin/dependency-services.html" class="sidebar-link">Dependency Services</a></li><li><a href="/xamarin/unit-testing.html" class="sidebar-link">Unit Testing</a></li><li><a href="/xamarin/bdd-unit-testing-in-xamarin-forms.html" class="sidebar-link">BDD Unit Testing in Xamarin.Forms</a></li><li><a href="/xamarin/getting-started-with-xamarin-ios.html" class="sidebar-link">Getting started with Xamarin.iOS</a></li><li><a href="/xamarin/alerts.html" class="sidebar-link">Alerts</a></li><li><a href="/xamarin/touch-id.html" class="sidebar-link">Touch ID</a></li><li><a href="/xamarin/auto-layout-in-xamarin-ios.html" class="sidebar-link">Auto Layout in Xamarin.iOS</a></li><li><a href="/xamarin/add-search-bar-to-uitableview.html" class="sidebar-link">Add Search Bar to UITableView</a></li><li><a href="/xamarin/adding-uirefreshcontrol-to-a-table-view.html" class="sidebar-link">Adding UIRefreshControl to a table view</a></li><li><a href="/xamarin/add-pulltorefresh-to-uitableview.html" class="sidebar-link">Add PullToRefresh to UITableView</a></li><li><a href="/xamarin/uiimageview-zoom-in-combination-with-uiscrollview.html" class="sidebar-link">UIImageView zoom in combination with UIScrollView</a></li><li><a href="/xamarin/xamarin-ios-navigation-drawer.html" class="sidebar-link">Xamarin.iOS Navigation Drawer</a></li><li><a href="/xamarin/using-asset-catalogs.html" class="sidebar-link">Using Asset Catalogs</a></li><li><a href="/xamarin/how-to-use-asset-asset-catalogs.html" class="sidebar-link">How to use asset Asset Catalogs</a></li><li><a href="/xamarin/using-ios-asset-catalogs-to-manage-images.html" class="sidebar-link">Using iOS Asset Catalogs to Manage Images</a></li><li><a href="/xamarin/create-and-use-custom-prototype-table-cells-in-xamarin-ios-using-storyboard.html" class="sidebar-link">Create and use custom prototype table cells in xamarin.iOS using storyboard</a></li><li><a href="/xamarin/binding-swift-libraries.html" class="sidebar-link">Binding Swift Libraries</a></li><li><a href="/xamarin/connecting-with-microsoft-cognitive-services.html" class="sidebar-link">Connecting with Microsoft Cognitive Services</a></li><li><a href="/xamarin/concurrent-programming-in-xamarin-ios.html" class="sidebar-link">Concurrent Programming in Xamarin.iOS</a></li><li><a href="/xamarin/working-with-xib-and-storyboards-in-xamarin-ios.html" class="sidebar-link">Working with Xib and Storyboards in Xamarin.iOS</a></li><li><a href="/xamarin/best-practices-for-migrating-from-uilocalnotification-to-user-notifications-framework.html" class="sidebar-link">Best practices for migrating from UILocalNotification to User Notifications framework</a></li><li><a href="/xamarin/calculating-variable-row-height-in-getheightforrow.html" class="sidebar-link">Calculating variable row height in GetHeightForRow</a></li><li><a href="/xamarin/resizing-methods-for-uiimage.html" class="sidebar-link">Resizing Methods for UIImage</a></li><li><a href="/xamarin/controlling-the-screenshot-in-the-ios-multitasking-switcher.html" class="sidebar-link">Controlling the Screenshot in the iOS Multitasking Switcher</a></li><li><a href="/xamarin/xamarin-ios-google-places-autocomplete.html" class="sidebar-link">Xamarin iOS Google Places Autocomplete</a></li><li><a href="/xamarin/getting-started-with-xamarin-android.html" class="sidebar-link">Getting started with Xamarin.Android</a></li><li><a href="/xamarin/app-lifecycle-xamarin-andorid.html" class="sidebar-link">App lifecycle - Xamarin.Andorid</a></li><li><a href="/xamarin/bindings.html" class="sidebar-link">Bindings</a></li><li><a href="/xamarin/dialogs.html" class="sidebar-link">Dialogs</a></li><li><a href="/xamarin/toasts.html" class="sidebar-link">Toasts</a></li><li><a href="/xamarin/dialogs.html" class="sidebar-link">Dialogs</a></li><li><a href="/xamarin/custom-listview.html" class="sidebar-link">Custom ListView</a></li><li><a href="/xamarin/recyclerview.html" class="sidebar-link">RecyclerView</a></li><li><a href="/xamarin/xamarin-android-how-to-create-a-toolbar.html" class="sidebar-link">Xamarin.Android - How to create a toolbar</a></li><li><a href="/xamarin/xamarin-android-bluetooth-communication.html" class="sidebar-link">Xamarin.Android - Bluetooth communication</a></li><li><a href="/xamarin/how-to-correct-the-orientation-of-a-picture-captured-from-android-device.html" class="sidebar-link">How to correct the orientation of a picture captured from Android device</a></li><li><a href="/xamarin/barcode-scanning-using-zxing-library-in-xamarin-applications.html" class="sidebar-link">Barcode scanning using ZXing library in Xamarin Applications</a></li><li><a href="/xamarin/publishing-your-xamarin-android-apk.html" aria-current="page" class="active sidebar-link">Publishing your Xamarin.Android APK</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/xamarin/publishing-your-xamarin-android-apk.html#preparing-your-apk-in-the-visual-studio" class="sidebar-link">Preparing your APK in the Visual Studio</a></li><li class="sidebar-sub-header"><a href="/xamarin/publishing-your-xamarin-android-apk.html#enabling-multidex-in-your-xamarin-android-apk" class="sidebar-link">Enabling MultiDex in your Xamarin.Android APK</a></li><li class="sidebar-sub-header"><a href="/xamarin/publishing-your-xamarin-android-apk.html#enabling-proguard-in-your-xamarin-android-apk" class="sidebar-link">Enabling ProGuard in your Xamarin.Android APK</a></li><li class="sidebar-sub-header"><a href="/xamarin/publishing-your-xamarin-android-apk.html#mysterious-bugs-related-to-proguard-and-linker" class="sidebar-link">&quot;Mysterious&quot; bugs related to ProGuard and Linker</a></li></ul></li><li><a href="/xamarin/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="publishing-your-xamarin-android-apk"><a href="#publishing-your-xamarin-android-apk" class="header-anchor">#</a> Publishing your Xamarin.Android APK</h1> <p>This topic shows information on how to prepare your Xamarin.Android app for release mode and how to optimize it.</p> <h2 id="preparing-your-apk-in-the-visual-studio"><a href="#preparing-your-apk-in-the-visual-studio" class="header-anchor">#</a> Preparing your APK in the Visual Studio</h2> <p>You finished your app, tested on debug mode and it is working perfect. Now, you want to prepare it to publish in the Google Play Store.</p> <p>Xamarin documentation provides good informations in here:</p> <p><a href="https://developer.xamarin.com/guides/android/deployment,_testing,_and_metrics/publishing_an_application/" target="_blank" rel="noopener noreferrer">https://developer.xamarin.com/guides/android/deployment,_testing,_and_metrics/publishing_an_application/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>Android Manifest</strong></p> <p>First, in Visual Studio, right-click your Xamarin.Android project in the Solution Explorer and select Properties. Then, go to the Android Manifest tab, to see this screen:</p> <p><a href="https://i.stack.imgur.com/qZ3l5.png" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/qZ3l5.png" alt="Android Manifest Configuration"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Unlike in Android Studio or Eclipse, you don't need the set the AndroidManifest.xml file by writing; Xamarin and Visual Studio do that for you. Activities, BroadcastReceivers and Services are inserted into Android Manifest by <a href="https://developer.xamarin.com/guides/android/advanced_topics/working_with_androidmanifest.xml/" target="_blank" rel="noopener noreferrer">declaring specific attributes in their classes<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>In this screen, the options are:</p> <ul><li><strong>Application name</strong>: This is the app name that will be visible for the user.</li> <li><strong>Package name</strong>: This is the package name. It must be unique, meaning that it must not use the same package name of other apps in the Google Play Store.</li> <li><strong>Application Icon</strong>: This is the icon that will be visible to the user, equivalent to the @drawable/ic_launcher used in Android Studio or Eclipse projects.</li> <li><strong>Version number</strong>: The version number is used by Google Play for version control. When you want to publish an APK for an updated version of your app, you must add 1 to this number for each new upgrade.</li> <li><strong>Version name</strong>: This is the version name that will be displayed to the user.</li> <li><strong>Install location</strong>: This determines where your APK will be installed, in the device storage or SD Card.</li> <li><strong>Required permissions</strong>: Here you determine which permissions are necessary for your app.</li></ul> <p><strong>Android Options</strong></p> <p>In the screen below, you can configure the compiler options. Using the right options here can reduce a lot your APK size and also prevent errors.</p> <p><a href="https://i.stack.imgur.com/kSakk.png" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/kSakk.png" alt="Android Options Configuration"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li><strong>Configuration</strong>: <strong>Active (Release)</strong>.</li> <li><strong>Platform</strong>: <strong>Active (Any CPU)</strong>. These are necessary to build your APK for the Google Play Store. If the Configuration is set to Debug, it will not be accepted by Google Play.</li> <li><strong>Use Shared Runtime</strong>: <strong>false</strong>. If you set it to true, the APK will use Mono Runtime to execute. The Mono Runtime is installed automatically when debugging through USB, but not in the Release APK. If Mono Runtime is not installed in the device and this option is set to true in the Release APK, the app will crash.</li> <li><strong>Generate one package (.apk) per selected ABI</strong>: <strong>false</strong>. Create your APK for as many platforms as possible, for compatibility reasons.</li> <li><strong>Enable Multi-Dex</strong>: <strong>true</strong>, but you can set it to false if your app is not very complex (that is, has less than 65536 methods, <a href="https://developer.android.com/studio/build/multidex.html" target="_blank" rel="noopener noreferrer">see here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>).</li> <li><strong>Enable Proguard</strong>: <strong>true</strong>. This enables the Proguard tool that obfuscates Java code in your app. Note that it does not apply to .NET code; if you want to obfuscate .NET code, you must use <a href="https://developer.xamarin.com/guides/android/deployment,_testing,_and_metrics/publishing_an_application/part_1_-_preparing_an_application_for_release#dotfuscator" target="_blank" rel="noopener noreferrer">Dotfuscator<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. More information on Proguard for Xamarin.Android can be found <a href="https://developer.xamarin.com/guides/android/deployment,_testing,_and_metrics/proguard" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</li> <li><strong>Enable developer instrumentation (debugging and profiling)</strong>: <strong>false</strong> for Release APK.</li> <li><strong>Linking</strong>: <strong>SDK and User Assemblies</strong>. This will make the Xamarin Linker to remove all unused classes from SDK and your code, reducing the APK size.</li></ul> <h3 id="important"><a href="#important" class="header-anchor">#</a> <strong>Important</strong></h3> <p>Xamarin.Linker may sometimes remove classes that are not seemed to be used by your code, especially if they are in the project's Core (PCL library). To avoid that, you can either set the Linking to &quot;Sdk Assemblies Only&quot; or use the Preserve attribute in your classes, example:</p> <p><strong>PreserveAttribute.cs</strong></p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">namespace</span> <span class="token namespace">My_App_Core<span class="token punctuation">.</span>Models</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">PreserveAttribute</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">System<span class="token punctuation">.</span>Attribute</span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">bool</span></span> AllMembers<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">bool</span></span> Conditional<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p><strong>In a class:</strong></p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">My_App_Core<span class="token punctuation">.</span>Models</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Preserve</span><span class="token attribute-arguments"><span class="token punctuation">(</span>AllMembers <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServiceException</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Exception</span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> errorCode<span class="token punctuation">;</span>

        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Preserve</span><span class="token attribute-arguments"><span class="token punctuation">(</span>AllMembers <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token function">ServiceException</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Preserve</span><span class="token attribute-arguments"><span class="token punctuation">(</span>AllMembers <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token function">ServiceException</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> errorCode<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>errorCode <span class="token operator">=</span> errorCode<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><ul><li><strong>Supported architectures</strong>: <strong>Select all</strong>, for compatibility reasons.</li></ul> <p>After configuring everything, Rebuild the Project to make sure that it builds successfully.</p> <p><strong>Creating the APK for Release mode</strong></p> <p>You finished configuring your Android project for Release. The tutorial below shows how to generate the APK in Visual Studio. A full tutorial from Xamarin documentation can be found here:</p> <p><a href="https://developer.xamarin.com/guides/android/deployment,_testing,_and_metrics/publishing_an_application/part_2_-_signing_the_android_application_package/" target="_blank" rel="noopener noreferrer">https://developer.xamarin.com/guides/android/deployment,_testing,<em>and_metrics/publishing_an_application/part_2</em>-_signing_the_android_application_package/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>To create the APK file, right-click the Xamarin.Android project in the Solution Explorer and select Archive...</p> <p><a href="https://i.stack.imgur.com/WrEum.png" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/WrEum.png" alt="Solution Explorer -&gt; right-click Xamarin.Android project -&gt; Archive..."><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>This will open the Archive manager and begin archiving the project, preparing to create the APK file.</p> <p><a href="https://i.stack.imgur.com/kkEe7.png" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/kkEe7.png" alt="Archiving project"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>When it finishes archiving the project, click in Distribute... to proceed.</p> <p><a href="https://i.stack.imgur.com/3dR8R.png" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/3dR8R.png" alt="Distribute..."><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>The Distribute screen will present you two options: Ad-hoc and Google Play. The first will create an APK and save it in your computer. The second will directly publish the app in Google Play.</p> <p>Choosing the first is recommended, so you can test the APK in other devices if you want.</p> <p><a href="https://i.stack.imgur.com/iqcJH.png" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/iqcJH.png" alt="Distribution Channels"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>In the following screen, an Android Key Store is needed to sign the APK. If you already have one, you can use it by clicking in Import...; if you don't, you can create a new Android Key Store by clicking in +.</p> <p><a href="https://i.stack.imgur.com/cvJ0E.png" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/cvJ0E.png" alt="Signing Identity"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Creating a new Android Key Store screen:</p> <p><a href="https://i.stack.imgur.com/hn5Xl.png" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/hn5Xl.png" alt="Creating new Android Key Store"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>To create the APK, click in Save As. You may be prompted to type the Key Store password.</p> <p><a href="https://i.stack.imgur.com/lYrDo.png" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/lYrDo.png" alt="Save As"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://i.stack.imgur.com/yRlXJ.png" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/yRlXJ.png" alt="Save As -&gt; Locate folder"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://i.stack.imgur.com/qpXgu.png" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/qpXgu.png" alt="Enter Key Store password"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>When it completes, you can click in Open Folder on the Archives screen to see your generated APK file.</p> <p><a href="https://i.stack.imgur.com/r26gV.png" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/r26gV.png" alt="Open Folder"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://i.stack.imgur.com/SmEmU.png" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/SmEmU.png" alt="APK in folder"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="enabling-multidex-in-your-xamarin-android-apk"><a href="#enabling-multidex-in-your-xamarin-android-apk" class="header-anchor">#</a> Enabling MultiDex in your Xamarin.Android APK</h2> <p><a href="https://developer.android.com/studio/build/multidex.html" target="_blank" rel="noopener noreferrer">MultiDex<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> is a library in the Android APK that allows the app to have more than 65,536 methods.</p> <p>The Android APKs have Dalvik Executable files (.dex) that contain the generated bytecodes compiled from your Java code. Each .dex file can contain up to 65,536 methods (2^16).</p> <p>Android OS versions before Android 5.0 Lollipop (API 21) use the Dalvik runtime, which only supports one .dex file per APK, limiting to 65,536 methods per APK. Starting from Android 5.0, the Android OS use ART runtime, which can support more than one .dex file per APK, avoiding the limit.</p> <p>To surpass the 65k methods limit in Android versions below API 21, the developers must use the MultiDex support library. The MultiDex creates extra classes.dex files (classes2.dex, classes3.dex, ...) referencing them in the classes.dex file. When the app starts loading, it uses an MultiDexApplication class to load the extra .dex files.</p> <p>If your Android app aims for a minimum SDK version above or equal to API 21 (Android 5.0 Lollipop) it is not necessary to use the MultiDex library, because the OS handles natively the extra .dex files. However, if for compatibility reasons the developer wants to support older Android OS, then he/she should use the MultiDex library.</p> <h3 id="how-to-use-multidex-in-your-xamarin-android-app"><a href="#how-to-use-multidex-in-your-xamarin-android-app" class="header-anchor">#</a> <strong>How to use MultiDex in your Xamarin.Android app</strong></h3> <p>First, to enable MultiDex in your Xamarin.Android app, go to your project Properties -&gt; Android Options -&gt; Packaging -&gt; Enable Multi-Dex, as in the print screen below:</p> <p><a href="https://i.stack.imgur.com/QqaV3.png" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/QqaV3.png" alt="Enable MultiDex option"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Then, you must create a MultiDexApplication class in your app. In the project's root, create a new class (in the Solution Explorer, right-click in the project, Add.. -&gt; Class, or Shift+Alt+C). In the new class file, copy the following code, replacing the namespace Sample with the name of your Xamarin.Android project namespace.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Android<span class="token punctuation">.</span>App</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Android<span class="token punctuation">.</span>Runtime</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Java<span class="token punctuation">.</span>Interop</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">Sample</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Register</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;android/support/multidex/MultiDexApplication&quot;</span><span class="token punctuation">,</span> DoNotGenerateAcw <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MultiDexApplication</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Application</span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">internal</span> <span class="token keyword">static</span> <span class="token keyword">readonly</span> <span class="token class-name">JniPeerMembers</span> _members <span class="token operator">=</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">XAPeerMembers</span><span class="token punctuation">(</span><span class="token string">&quot;android/support/multidex/MultiDexApplication&quot;</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span> <span class="token punctuation">(</span><span class="token type-expression class-name">MultiDexApplication</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">internal</span> <span class="token keyword">static</span> <span class="token class-name">IntPtr</span> java_class_handle<span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">IntPtr</span> id_ctor<span class="token punctuation">;</span>

        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Register</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;.ctor&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;()V&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> DoNotGenerateAcw <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token function">MultiDexApplication</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span>IntPtr<span class="token punctuation">.</span>Zero<span class="token punctuation">,</span> JniHandleOwnership<span class="token punctuation">.</span>DoNotTransfer<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>Handle <span class="token operator">!=</span> IntPtr<span class="token punctuation">.</span>Zero<span class="token punctuation">)</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>

            <span class="token keyword">try</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">typeof</span> <span class="token punctuation">(</span><span class="token type-expression class-name">MultiDexApplication</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token function">SetHandle</span><span class="token punctuation">(</span>
                        JNIEnv<span class="token punctuation">.</span><span class="token function">StartCreateInstance</span><span class="token punctuation">(</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;()V&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        JniHandleOwnership<span class="token punctuation">.</span>TransferLocalRef<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        JNIEnv<span class="token punctuation">.</span><span class="token function">FinishCreateInstance</span><span class="token punctuation">(</span>Handle<span class="token punctuation">,</span> <span class="token string">&quot;()V&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>id_ctor <span class="token operator">==</span> IntPtr<span class="token punctuation">.</span>Zero<span class="token punctuation">)</span>
                    id_ctor <span class="token operator">=</span> JNIEnv<span class="token punctuation">.</span><span class="token function">GetMethodID</span><span class="token punctuation">(</span>class_ref<span class="token punctuation">,</span> <span class="token string">&quot;&lt;init&gt;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;()V&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">SetHandle</span><span class="token punctuation">(</span>
                    JNIEnv<span class="token punctuation">.</span><span class="token function">StartCreateInstance</span><span class="token punctuation">(</span>class_ref<span class="token punctuation">,</span> id_ctor<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    JniHandleOwnership<span class="token punctuation">.</span>TransferLocalRef<span class="token punctuation">)</span><span class="token punctuation">;</span>
                JNIEnv<span class="token punctuation">.</span><span class="token function">FinishCreateInstance</span><span class="token punctuation">(</span>Handle<span class="token punctuation">,</span> class_ref<span class="token punctuation">,</span> id_ctor<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">finally</span>
            <span class="token punctuation">{</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">protected</span> <span class="token function">MultiDexApplication</span><span class="token punctuation">(</span><span class="token class-name">IntPtr</span> javaReference<span class="token punctuation">,</span> <span class="token class-name">JniHandleOwnership</span> transfer<span class="token punctuation">)</span>
            <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span>javaReference<span class="token punctuation">,</span> transfer<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">internal</span> <span class="token keyword">static</span> <span class="token return-type class-name">IntPtr</span> class_ref
        <span class="token punctuation">{</span>
            <span class="token keyword">get</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> JNIEnv<span class="token punctuation">.</span><span class="token function">FindClass</span><span class="token punctuation">(</span><span class="token string">&quot;android/support/multidex/MultiDexApplication&quot;</span><span class="token punctuation">,</span> <span class="token keyword">ref</span> java_class_handle<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name">IntPtr</span> ThresholdClass
        <span class="token punctuation">{</span>
            <span class="token keyword">get</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> class_ref<span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name">Type</span> ThresholdType
        <span class="token punctuation">{</span>
            <span class="token keyword">get</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">typeof</span> <span class="token punctuation">(</span><span class="token type-expression class-name">MultiDexApplication</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p><a href="https://forums.xamarin.com/discussion/64234/multi-dex-app-with-a-custom-application-class-that-runs-on-pre-lollipop" target="_blank" rel="noopener noreferrer">Code source here.<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>If you are developing in Visual Studio for Windows, there is also a bug in the Android SDK build tools that you need to fix in order to properly create the classes.dex files when building your project.</p> <p>Go to your Android SDK folder, open the build-tools folder and there will be folders with the numbers of the Android SDK compilers, such as:</p> <blockquote></blockquote> <p>C:\android-sdk\build-tools\23.0.3\</p> <blockquote></blockquote> <p>C:\android-sdk\build-tools\24.0.1\</p> <blockquote></blockquote> <p>C:\android-sdk\build-tools\25.0.2\</p> <p>Inside each of those folders, there is a file called <strong>mainClassesDex.bat</strong>, a batch script used to create the classes.dex files. Open each mainClassesDex.bat file with a text editor (Notepad or Notepad++) and in its script, find and replace the block:</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">if</span> DEFINED output <span class="token keyword">goto</span> redirect
call <span class="token string">&quot;%java_exe%&quot;</span> <span class="token operator">-</span>Djava<span class="token punctuation">.</span>ext<span class="token punctuation">.</span>dirs<span class="token operator">=</span><span class="token string">&quot;%frameworkdir%&quot;</span> com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>multidex<span class="token punctuation">.</span>MainDexListBuilder <span class="token string">&quot;%disableKeepAnnotated%&quot;</span> <span class="token string">&quot;%tmpJar%&quot;</span> <span class="token string">&quot;%params%&quot;</span>
<span class="token keyword">goto</span> afterClassReferenceListBuilder
<span class="token punctuation">:</span>redirect
call <span class="token string">&quot;%java_exe%&quot;</span> <span class="token operator">-</span>Djava<span class="token punctuation">.</span>ext<span class="token punctuation">.</span>dirs<span class="token operator">=</span><span class="token string">&quot;%frameworkdir%&quot;</span> com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>multidex<span class="token punctuation">.</span>MainDexListBuilder <span class="token string">&quot;%disableKeepAnnotated%&quot;</span> <span class="token string">&quot;%tmpJar%&quot;</span> <span class="token string">&quot;%params%&quot;</span> <span class="token number">1</span><span class="token operator">&gt;</span><span class="token string">&quot;%output%&quot;</span>
<span class="token punctuation">:</span>afterClassReferenceListBuilder

</code></pre></div><p>With the block:</p> <div class="language-cs extra-class"><pre class="language-cs"><code>SET <span class="token keyword">params</span><span class="token operator">=</span><span class="token operator">%</span><span class="token keyword">params</span><span class="token punctuation">:</span>'<span class="token operator">=</span><span class="token operator">%</span>  
<span class="token keyword">if</span> DEFINED output <span class="token keyword">goto</span> redirect  
call <span class="token string">&quot;%java_exe%&quot;</span> <span class="token operator">-</span>Djava<span class="token punctuation">.</span>ext<span class="token punctuation">.</span>dirs<span class="token operator">=</span><span class="token string">&quot;%frameworkdir%&quot;</span> com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>multidex<span class="token punctuation">.</span>MainDexListBuilder <span class="token operator">%</span>disableKeepAnnotated<span class="token operator">%</span> <span class="token string">&quot;%tmpJar%&quot;</span> <span class="token operator">%</span><span class="token keyword">params</span><span class="token operator">%</span>  
<span class="token keyword">goto</span> afterClassReferenceListBuilder  
<span class="token punctuation">:</span>redirect
call <span class="token string">&quot;%java_exe%&quot;</span> <span class="token operator">-</span>Djava<span class="token punctuation">.</span>ext<span class="token punctuation">.</span>dirs<span class="token operator">=</span><span class="token string">&quot;%frameworkdir%&quot;</span> com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>multidex<span class="token punctuation">.</span>MainDexListBuilder <span class="token operator">%</span>disableKeepAnnotated<span class="token operator">%</span> <span class="token string">&quot;%tmpJar%&quot;</span> <span class="token operator">%</span><span class="token keyword">params</span><span class="token operator">%</span> <span class="token number">1</span><span class="token operator">&gt;</span><span class="token string">&quot;%output%&quot;</span>  
<span class="token punctuation">:</span>afterClassReferenceListBuilder

</code></pre></div><p><a href="http://www.jon-douglas.com/2016/09/05/xamarin-android-multidex/" target="_blank" rel="noopener noreferrer">Source here.<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Save each mainClassesDex.bat in the text editor after changes.</p> <p>After the steps above, you should be able to successfully build your Xamarin.Android app with MultiDex.</p> <h2 id="enabling-proguard-in-your-xamarin-android-apk"><a href="#enabling-proguard-in-your-xamarin-android-apk" class="header-anchor">#</a> Enabling ProGuard in your Xamarin.Android APK</h2> <p><a href="https://developer.android.com/studio/build/shrink-code.html" target="_blank" rel="noopener noreferrer">ProGuard<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> is a tool used in the building process to optimize and obfuscate the Java code of your APK, and also remove unused classes. The resulting APK when using ProGuard will have a smaller size and will be harder to reverse-engineer (decompilation).</p> <p>ProGuard can be used too in Xamarin.Android apps, and also will reduce the APK file size and obfuscate the Java code. Be aware, however, that the ProGuard obfuscation applies only to Java code. To obfuscate .NET code, the developer should use Dotfuscator or similar tools.</p> <h3 id="how-to-use-proguard-in-your-xamarin-android-app"><a href="#how-to-use-proguard-in-your-xamarin-android-app" class="header-anchor">#</a> <strong>How to use ProGuard in your Xamarin.Android app</strong></h3> <p>First, to enable ProGuard in your Xamarin.Android app, go to your project Properties -&gt; Android Options -&gt; Packaging -&gt; Enable ProGuard, as in the print screen below:</p> <p><a href="https://i.stack.imgur.com/QqaV3.png" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/QqaV3.png" alt="Enable ProGuard"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>This enables ProGuard when building your app.</p> <p>Xamarin.Android, by default, sets its own configurations for ProGuard, that can be found inside the folders <code>obj/Debug/proguard</code> or <code>obj/Release/proguard</code>, in the files <code>proguard_project_primary.cfg</code>, <code>proguard_project_references.cfg</code> and <code>proguard_xamarin.cfg</code>. The three files are combined as configurations for ProGuard and they are automatically created by Xamarin when building.</p> <p>If the developer wishes to further customize the ProGuard options, he/she can create a file in the project's root named <code>proguard.cfg</code> (other names are valid too, as long as the extension is .cfg) and setting its Build Action to ProguardConfiguration, as in the picture below:</p> <p><a href="https://i.stack.imgur.com/axEq3.png" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/axEq3.png" alt="Setting Build Action to ProguardConfiguration"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>In the file, custom ProGuard options can be inserted, such as <code>-dontwarn</code>, <code>-keep class</code> and <a href="https://www.guardsquare.com/en/proguard/manual/usage" target="_blank" rel="noopener noreferrer">others<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p><strong>Important</strong></p> <p>As by now (April/2017), the Android SDK that is usually downloaded has an old version of ProGuard, which can cause errors when building the app using Java 1.8. When building, the Error List shows the following message:</p> <div class="language-cs extra-class"><pre class="language-cs"><code>Error
Can't read <span class="token punctuation">[</span>C<span class="token punctuation">:</span>\<span class="token return-type class-name">Program</span> Files <span class="token punctuation">(</span>x86<span class="token punctuation">)</span>\Reference Assemblies\Microsoft\Framework\MonoAndroid\v7<span class="token punctuation">.</span><span class="token number">0</span>\mono<span class="token punctuation">.</span>android<span class="token punctuation">.</span>jar<span class="token punctuation">]</span> 
<span class="token punctuation">(</span>Can't process <span class="token keyword">class</span> <span class="token punctuation">[</span>android<span class="token operator">/</span>app<span class="token operator">/</span>ActivityTracker<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">]</span>  <span class="token punctuation">(</span>Unsupported <span class="token keyword">class</span> <span class="token class-name">version</span> number <span class="token punctuation">[</span><span class="token number">52.0</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>maximum <span class="token number">51.0</span><span class="token punctuation">,</span> Java <span class="token number">1.7</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>CREATEMULTIDEXMAINDEXCLASSLIST<span class="token punctuation">]</span>

</code></pre></div><p><a href="https://forums.xamarin.com/discussion/76798/compiler-issue-with-targetsdkversion-24-and-jdk-1-8" target="_blank" rel="noopener noreferrer">Source here.<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>To fix this problem, you must download the most recent version of ProGuard (<a href="https://sourceforge.net/projects/proguard/files/proguard/" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>) and copy the contents of the .zip file to <code>android-sdk\tools\proguard\</code>. That will update the ProGuard and building process should run without problems.</p> <p>After that, you should be able to successfully build your Xamarin.Android app with ProGuard.</p> <h2 id="mysterious-bugs-related-to-proguard-and-linker"><a href="#mysterious-bugs-related-to-proguard-and-linker" class="header-anchor">#</a> &quot;Mysterious&quot; bugs related to ProGuard and Linker</h2> <p>You made a great app and tested it in Debug, with good results. Everything was working fine!</p> <p>But then, you decided to prepare your app for release. You set up MultiDex, ProGuard and Linker, and then, it stopped working.</p> <p>This tutorial aims to help you to find out common problems related to ProGuard and Linker that can cause mysterious bugs.</p> <h3 id="understanding-xamarin-linker"><a href="#understanding-xamarin-linker" class="header-anchor">#</a> <strong>Understanding Xamarin.Linker</strong></h3> <p>Xamarin.Linker is a tool in the building process that removes unused code and classes <strong>from your .NET code (not Java code)</strong>. In your project's Properties -&gt; Android Options -&gt; Linker, there will be an selection box Linking with the options:</p> <p><a href="https://i.stack.imgur.com/NMQMv.png" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/NMQMv.png" alt="Linker options"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>None</strong>: No code is removed.</p> <p><strong>Sdk Assemblies Only</strong>: This option makes the Xamarin.Linker to check for unused code only in the Xamarin libraries. <strong>This option is safe.</strong></p> <p><strong>Sdk and User Assemblies</strong>: This option makes the Xamarin.Linker to check for unused code in the Xamarin libraries and in the project code (including PCLs, Xamarin components and NuGet packages). <strong>This option is not always safe!</strong></p> <p>When using Sdk and User Assemblies option, Xamarin.Linker may think that parts of the code are unused when actually they are very much used! That may cause some libraries to stop working properly and cause bugs in your app.</p> <p>To make the Xamarin.Linker not remove code, there are 3 options:</p> <ol><li>Setting the Linking option to None or Sdk Assemblies Only;</li> <li>Skip linking assemblies;</li> <li>Using the Preserve attribute.</li></ol> <p><strong>Example for 2. Skip linking assemblies:</strong></p> <p>In the example below, using Xamarin.Linker caused a NuGet Package (<a href="https://github.com/octokit" target="_blank" rel="noopener noreferrer">Octokit<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>) that works fine to stop working, because it could not connect to the internet anymore:</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token punctuation">]</span> ERROR
<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token punctuation">]</span> SOURCE<span class="token punctuation">:</span> mscorlib
<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token punctuation">]</span> MESSAGE<span class="token punctuation">:</span> Object reference <span class="token keyword">not</span> <span class="token keyword">set</span> to an instance of an <span class="token keyword">object</span><span class="token punctuation">.</span>
<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token class-name">STACK</span> TRACE<span class="token punctuation">:</span>   <span class="token return-type class-name">at</span> Octokit<span class="token punctuation">.</span>PocoJsonSerializerStrategy<span class="token punctuation">.</span>DeserializeObject <span class="token punctuation">(</span><span class="token class-name">System<span class="token punctuation">.</span>Object</span> <span class="token keyword">value</span><span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>Type</span> type<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">0x003d8</span><span class="token punctuation">]</span> <span class="token keyword">in</span> D<span class="token punctuation">:</span>\repos\octokit<span class="token punctuation">.</span>net\Octokit\SimpleJson<span class="token punctuation">.</span>cs<span class="token punctuation">:</span><span class="token number">1472</span> 
  at Octokit<span class="token punctuation">.</span>Internal<span class="token punctuation">.</span>SimpleJsonSerializer<span class="token operator">+</span>GitHubSerializerStrategy<span class="token punctuation">.</span>DeserializeObject <span class="token punctuation">(</span><span class="token class-name">System<span class="token punctuation">.</span>Object</span> <span class="token keyword">value</span><span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>Type</span> type<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">0x001c3</span><span class="token punctuation">]</span> <span class="token keyword">in</span> D<span class="token punctuation">:</span>\repos\octokit<span class="token punctuation">.</span>net\Octokit\Http\SimpleJsonSerializer<span class="token punctuation">.</span>cs<span class="token punctuation">:</span><span class="token number">165</span> 
  <span class="token return-type class-name">at</span> Octokit<span class="token punctuation">.</span>SimpleJson<span class="token punctuation">.</span>DeserializeObject <span class="token punctuation">(</span><span class="token class-name">System<span class="token punctuation">.</span>String</span> json<span class="token punctuation">,</span> <span class="token class-name">System<span class="token punctuation">.</span>Type</span> type<span class="token punctuation">,</span> <span class="token class-name">Octokit<span class="token punctuation">.</span>IJsonSerializerStrategy</span> jsonSerializerStrategy<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">0x00007</span><span class="token punctuation">]</span> <span class="token keyword">in</span> D<span class="token punctuation">:</span>\repos\octokit<span class="token punctuation">.</span>net\Octokit\SimpleJson<span class="token punctuation">.</span>cs<span class="token punctuation">:</span><span class="token number">583</span> 
  at Octokit<span class="token punctuation">.</span>SimpleJson<span class="token punctuation">.</span>DeserializeObject<span class="token punctuation">[</span>T<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token class-name">System<span class="token punctuation">.</span>String</span> json<span class="token punctuation">,</span> <span class="token class-name">Octokit<span class="token punctuation">.</span>IJsonSerializerStrategy</span> jsonSerializerStrategy<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">0x00000</span><span class="token punctuation">]</span> <span class="token keyword">in</span> D<span class="token punctuation">:</span>\repos\octokit<span class="token punctuation">.</span>net\Octokit\SimpleJson<span class="token punctuation">.</span>cs<span class="token punctuation">:</span><span class="token number">595</span> 
  at Octokit<span class="token punctuation">.</span>Internal<span class="token punctuation">.</span>SimpleJsonSerializer<span class="token punctuation">.</span>Deserialize<span class="token punctuation">[</span>T<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token class-name">System<span class="token punctuation">.</span>String</span> json<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">0x00000</span><span class="token punctuation">]</span> <span class="token keyword">in</span> D<span class="token punctuation">:</span>\repos\octokit<span class="token punctuation">.</span>net\Octokit\Http\SimpleJsonSerializer<span class="token punctuation">.</span>cs<span class="token punctuation">:</span><span class="token number">21</span> 
  at Octokit<span class="token punctuation">.</span>Internal<span class="token punctuation">.</span>JsonHttpPipeline<span class="token punctuation">.</span>DeserializeResponse<span class="token punctuation">[</span>T<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token class-name">Octokit<span class="token punctuation">.</span>IResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">0x000a7</span><span class="token punctuation">]</span> <span class="token keyword">in</span> D<span class="token punctuation">:</span>\repos\octokit<span class="token punctuation">.</span>net\Octokit\Http\JsonHttpPipeline<span class="token punctuation">.</span>cs<span class="token punctuation">:</span><span class="token number">62</span> 
  at Octokit<span class="token punctuation">.</span>Connection<span class="token operator">+</span><span class="token operator">&lt;</span>Run<span class="token operator">&gt;</span>d__54`<span class="token number">1</span><span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">.</span>MoveNext <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">0x0009c</span><span class="token punctuation">]</span> <span class="token keyword">in</span> D<span class="token punctuation">:</span>\repos\octokit<span class="token punctuation">.</span>net\Octokit\Http\Connection<span class="token punctuation">.</span>cs<span class="token punctuation">:</span><span class="token number">574</span> 
<span class="token operator">--</span><span class="token operator">-</span> End of stack trace <span class="token keyword">from</span> previous location <span class="token keyword">where</span> <span class="token class-name">exception</span> was thrown <span class="token operator">--</span><span class="token operator">-</span>

</code></pre></div><p>To make the library start working again, it was necessary to add the package reference name in the Skip linking assemblies field, located in project -&gt; Properties -&gt; Android Options -&gt; Linker, as in the picture below:</p> <p><a href="https://i.stack.imgur.com/sZ9ho.png" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/sZ9ho.png" alt="Adding project reference to skip linking assemblies"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>After that, the library started to work without any issues.</p> <p><strong>Example for 3. Using the Preserve attribute:</strong></p> <p>Xamarin.Linker perceives as unused code mostly code from model classes in your project's core.</p> <p>To make the class preserved during the linking process, you can use the Preserve attribute.</p> <p>First, create in your project core's a class named <strong>PreserveAttribute.cs</strong>, insert the following code and replace the namespace with your project's namespace:</p> <p>PreserveAttribute.cs:</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">namespace</span> <span class="token namespace">My_App_Core<span class="token punctuation">.</span>Models</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">PreserveAttribute</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">System<span class="token punctuation">.</span>Attribute</span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">bool</span></span> AllMembers<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">bool</span></span> Conditional<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>In each model class of your project's core, insert the Preserve attribute as in the example below:</p> <p>Country.cs:</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">My_App_Core<span class="token punctuation">.</span>Models</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Preserve</span><span class="token attribute-arguments"><span class="token punctuation">(</span>AllMembers <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Country</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">String</span> name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">String</span> ISOcode <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Preserve</span><span class="token attribute-arguments"><span class="token punctuation">(</span>AllMembers <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token function">Country</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> ISOCode<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>ISOCode <span class="token operator">=</span> ISOCode<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>After that, the linking process will not remove the preserved code anymore.</p> <h3 id="understanding-proguard"><a href="#understanding-proguard" class="header-anchor">#</a> <strong>Understanding ProGuard</strong></h3> <p>ProGuard is a tool in the building process that removes unused code and classes <strong>from your Java code</strong>. It also obfuscates and optimizes the code.</p> <p>However, ProGuard sometimes may remove code that it perceives as unused, when it is not. To avoid that, the developer must debug the app (in Android Device Monitor and in the Visual Studio Debug) and detect which class was removed, for then to configure the ProGuard configuration file to keep the class.</p> <p><strong>Example</strong></p> <p>In the example below, ProGuard removed two classes (Android.Support.V7.Widget.FitWindowsLinearLayout and Android.Support.Design.Widget.AppBarLayout) used in AXML layout files, but that were perceived as unused in the code. The removal caused ClassNotFoundException in the Java code when rendering the activity layout:</p> <p>layout_activitymain.axml:</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token operator">&lt;</span><span class="token punctuation">?</span><span class="token class-name">xml</span> version<span class="token operator">=</span><span class="token string">&quot;1.0&quot;</span> encoding<span class="token operator">=</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token class-name">android<span class="token punctuation">.</span>support<span class="token punctuation">.</span>v4<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>DrawerLayout</span> 
    xmlns<span class="token punctuation">:</span>android<span class="token operator">=</span><span class="token string">&quot;http://schemas.android.com/apk/res/android&quot;</span>
    xmlns<span class="token punctuation">:</span>app<span class="token operator">=</span><span class="token string">&quot;http://schemas.android.com/apk/res-auto&quot;</span>
    xmlns<span class="token punctuation">:</span>tools<span class="token operator">=</span><span class="token string">&quot;http://schemas.android.com/tools&quot;</span>
    android<span class="token punctuation">:</span>id<span class="token operator">=</span><span class="token string">&quot;@+id/activitymain_drawerlayout&quot;</span>
    android<span class="token punctuation">:</span>layout_width<span class="token operator">=</span><span class="token string">&quot;match_parent&quot;</span>
    android<span class="token punctuation">:</span>layout_height<span class="token operator">=</span><span class="token string">&quot;match_parent&quot;</span>
    android<span class="token punctuation">:</span>fitsSystemWindows<span class="token operator">=</span><span class="token string">&quot;true&quot;</span> <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> ### HERE ### <span class="token operator">--</span><span class="token operator">&gt;</span>
    tools<span class="token punctuation">:</span>openDrawer<span class="token operator">=</span><span class="token string">&quot;start&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">RelativeLayout</span>
        android<span class="token punctuation">:</span>layout_width<span class="token operator">=</span><span class="token string">&quot;match_parent&quot;</span>
        android<span class="token punctuation">:</span>layout_height<span class="token operator">=</span><span class="token string">&quot;match_parent&quot;</span>
        android<span class="token punctuation">:</span>fitsSystemWindows<span class="token operator">=</span><span class="token string">&quot;true&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> ### HERE ## <span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token class-name">android<span class="token punctuation">.</span>support<span class="token punctuation">.</span>design<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>AppBarLayout</span>
            android<span class="token punctuation">:</span>id<span class="token operator">=</span><span class="token string">&quot;@+id/activitymain_appbarlayout&quot;</span>
            android<span class="token punctuation">:</span>layout_width<span class="token operator">=</span><span class="token string">&quot;match_parent&quot;</span>
            android<span class="token punctuation">:</span>layout_height<span class="token operator">=</span><span class="token string">&quot;wrap_content&quot;</span>
            android<span class="token punctuation">:</span>theme<span class="token operator">=</span><span class="token string">&quot;@style/AppTheme.AppBarOverlay&quot;</span><span class="token operator">&gt;</span>
<span class="token range operator">..</span><span class="token punctuation">.</span>

</code></pre></div><p>LogCat showing error when creating the layout in SetContentView:</p> <p><a href="https://i.stack.imgur.com/OPgYu.png" target="_blank" rel="noopener noreferrer"><img src="https://i.stack.imgur.com/OPgYu.png" alt="Error showing in LogCat"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>To fix this error, it was necessary to add the following lines to the ProGuard configuration file of the project:</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token operator">-</span>keep <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">android</span><span class="token punctuation">.</span>support<span class="token punctuation">.</span>v7<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>FitWindowsLinearLayout
<span class="token operator">-</span>keep <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">android</span><span class="token punctuation">.</span>support<span class="token punctuation">.</span>design<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>AppBarLayout

</code></pre></div><p>After that, no more errors were shown when creating the layout.</p> <p><strong>ProGuard Warnings</strong></p> <p>ProGuard sometimes show warnings in the Error List after building your project. Although they raise a question of whether your app is OK or not, not all of their warnings indicate troubles, especially if your app successfully builds.</p> <p>One example for that is when using the <a href="http://square.github.io/picasso/" target="_blank" rel="noopener noreferrer">Picasso<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> library: when using ProGuard, this may show warnings such as <code>okio.Okio: can't find referenced class (...)</code> or <code>can't write resource [META-INF/MANIFEST.MF] (Duplicate zip entry [okhttp.jar:META-INF/MANIFEST.MF]) (...)</code>, but the app builds and the library works without problems.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/xamarin/publishing-your-xamarin-android-apk.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/xamarin/barcode-scanning-using-zxing-library-in-xamarin-applications.html" class="prev">
        Barcode scanning using ZXing library in Xamarin Applications
      </a></span> <span class="next"><a href="/xamarin/contributors.html">
        The Contributors
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/3548.05dd7183.js" defer></script>
  </body>
</html>
