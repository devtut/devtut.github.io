<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Xamarin - Accessing native features with DependencyService</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Implementing text-to-speech, Getting Application and Device OS Version Numbers - Android & iOS - PCL">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="Xamarin - Accessing native features with DependencyService">
    <meta property="og:description" content="Implementing text-to-speech, Getting Application and Device OS Version Numbers - Android & iOS - PCL">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/xamarin/accessing-native-features-with-dependencyservice.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="Xamarin - Accessing native features with DependencyService">
    <meta name="twitter:description" content="Implementing text-to-speech, Getting Application and Device OS Version Numbers - Android & iOS - PCL">
    <meta name="twitter:url" content="/xamarin/accessing-native-features-with-dependencyservice.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/3503.70b038e0.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Xamarin</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/xamarin/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/xamarin/getting-started-with-xamarin-forms.html" class="sidebar-link">Getting started with Xamarin.Forms</a></li><li><a href="/xamarin/why-xamarin-forms-and-when-to-use-xamarin-forms.html" class="sidebar-link">Why Xamarin Forms and When to use Xamarin Forms</a></li><li><a href="/xamarin/xamarin-forms-layouts.html" class="sidebar-link">Xamarin Forms Layouts</a></li><li><a href="/xamarin/xamarin-relative-layout.html" class="sidebar-link">Xamarin Relative Layout</a></li><li><a href="/xamarin/navigation-in-xamarin-forms.html" class="sidebar-link">Navigation in Xamarin.Forms</a></li><li><a href="/xamarin/xamarin-forms-page.html" class="sidebar-link">Xamarin.Forms Page</a></li><li><a href="/xamarin/xamarin-forms-cells.html" class="sidebar-link">Xamarin.Forms Cells</a></li><li><a href="/xamarin/xamarin-forms-views.html" class="sidebar-link">Xamarin.Forms Views</a></li><li><a href="/xamarin/using-listviews.html" class="sidebar-link">Using ListViews</a></li><li><a href="/xamarin/display-alert.html" class="sidebar-link">Display Alert</a></li><li><a href="/xamarin/accessing-native-features-with-dependencyservice.html" aria-current="page" class="active sidebar-link">Accessing native features with DependencyService</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/xamarin/accessing-native-features-with-dependencyservice.html#implementing-text-to-speech" class="sidebar-link">Implementing text-to-speech</a></li><li class="sidebar-sub-header"><a href="/xamarin/accessing-native-features-with-dependencyservice.html#getting-application-and-device-os-version-numbers-android-ios-pcl" class="sidebar-link">Getting Application and Device OS Version Numbers - Android &amp; iOS - PCL</a></li></ul></li><li><a href="/xamarin/dependencyservice.html" class="sidebar-link">DependencyService</a></li><li><a href="/xamarin/custom-renderers.html" class="sidebar-link">Custom Renderers</a></li><li><a href="/xamarin/caching.html" class="sidebar-link">Caching</a></li><li><a href="/xamarin/gestures.html" class="sidebar-link">Gestures</a></li><li><a href="/xamarin/data-binding.html" class="sidebar-link">Data Binding</a></li><li><a href="/xamarin/working-with-maps.html" class="sidebar-link">Working with Maps</a></li><li><a href="/xamarin/custom-fonts-in-styles.html" class="sidebar-link">Custom Fonts in Styles</a></li><li><a href="/xamarin/push-notifications.html" class="sidebar-link">Push Notifications</a></li><li><a href="/xamarin/effects.html" class="sidebar-link">Effects</a></li><li><a href="/xamarin/triggers-behaviours.html" class="sidebar-link">Triggers &amp; Behaviours</a></li><li><a href="/xamarin/appsettings-reader-in-xamarin-forms.html" class="sidebar-link">AppSettings Reader in Xamarin.Forms</a></li><li><a href="/xamarin/creating-custom-controls.html" class="sidebar-link">Creating custom controls</a></li><li><a href="/xamarin/working-with-local-databases.html" class="sidebar-link">Working with local databases</a></li><li><a href="/xamarin/carouselview-pre-release-version.html" class="sidebar-link">CarouselView - Pre-release version</a></li><li><a href="/xamarin/exception-handling.html" class="sidebar-link">Exception handling</a></li><li><a href="/xamarin/sql-database-and-api-in-xamarin-forms.html" class="sidebar-link">SQL Database and API in Xamarin Forms.</a></li><li><a href="/xamarin/contact-picker-xamarin-forms-android-and-ios.html" class="sidebar-link">Contact Picker - Xamarin Forms (Android and iOS)</a></li><li><a href="/xamarin/xamarin-plugin.html" class="sidebar-link">Xamarin Plugin</a></li><li><a href="/xamarin/oauth2.html" class="sidebar-link">OAuth2</a></li><li><a href="/xamarin/messagingcenter.html" class="sidebar-link">MessagingCenter</a></li><li><a href="/xamarin/generic-xamarin-forms-app-lifecycle-platform-dependant.html" class="sidebar-link">Generic Xamarin.Forms app lifecycle? Platform-dependant!</a></li><li><a href="/xamarin/platform-specific-behaviour.html" class="sidebar-link">Platform-specific behaviour</a></li><li><a href="/xamarin/platform-specific-visual-adjustments.html" class="sidebar-link">Platform specific visual adjustments</a></li><li><a href="/xamarin/dependency-services.html" class="sidebar-link">Dependency Services</a></li><li><a href="/xamarin/unit-testing.html" class="sidebar-link">Unit Testing</a></li><li><a href="/xamarin/bdd-unit-testing-in-xamarin-forms.html" class="sidebar-link">BDD Unit Testing in Xamarin.Forms</a></li><li><a href="/xamarin/getting-started-with-xamarin-ios.html" class="sidebar-link">Getting started with Xamarin.iOS</a></li><li><a href="/xamarin/alerts.html" class="sidebar-link">Alerts</a></li><li><a href="/xamarin/touch-id.html" class="sidebar-link">Touch ID</a></li><li><a href="/xamarin/auto-layout-in-xamarin-ios.html" class="sidebar-link">Auto Layout in Xamarin.iOS</a></li><li><a href="/xamarin/add-search-bar-to-uitableview.html" class="sidebar-link">Add Search Bar to UITableView</a></li><li><a href="/xamarin/adding-uirefreshcontrol-to-a-table-view.html" class="sidebar-link">Adding UIRefreshControl to a table view</a></li><li><a href="/xamarin/add-pulltorefresh-to-uitableview.html" class="sidebar-link">Add PullToRefresh to UITableView</a></li><li><a href="/xamarin/uiimageview-zoom-in-combination-with-uiscrollview.html" class="sidebar-link">UIImageView zoom in combination with UIScrollView</a></li><li><a href="/xamarin/xamarin-ios-navigation-drawer.html" class="sidebar-link">Xamarin.iOS Navigation Drawer</a></li><li><a href="/xamarin/using-asset-catalogs.html" class="sidebar-link">Using Asset Catalogs</a></li><li><a href="/xamarin/how-to-use-asset-asset-catalogs.html" class="sidebar-link">How to use asset Asset Catalogs</a></li><li><a href="/xamarin/using-ios-asset-catalogs-to-manage-images.html" class="sidebar-link">Using iOS Asset Catalogs to Manage Images</a></li><li><a href="/xamarin/create-and-use-custom-prototype-table-cells-in-xamarin-ios-using-storyboard.html" class="sidebar-link">Create and use custom prototype table cells in xamarin.iOS using storyboard</a></li><li><a href="/xamarin/binding-swift-libraries.html" class="sidebar-link">Binding Swift Libraries</a></li><li><a href="/xamarin/connecting-with-microsoft-cognitive-services.html" class="sidebar-link">Connecting with Microsoft Cognitive Services</a></li><li><a href="/xamarin/concurrent-programming-in-xamarin-ios.html" class="sidebar-link">Concurrent Programming in Xamarin.iOS</a></li><li><a href="/xamarin/working-with-xib-and-storyboards-in-xamarin-ios.html" class="sidebar-link">Working with Xib and Storyboards in Xamarin.iOS</a></li><li><a href="/xamarin/best-practices-for-migrating-from-uilocalnotification-to-user-notifications-framework.html" class="sidebar-link">Best practices for migrating from UILocalNotification to User Notifications framework</a></li><li><a href="/xamarin/calculating-variable-row-height-in-getheightforrow.html" class="sidebar-link">Calculating variable row height in GetHeightForRow</a></li><li><a href="/xamarin/resizing-methods-for-uiimage.html" class="sidebar-link">Resizing Methods for UIImage</a></li><li><a href="/xamarin/controlling-the-screenshot-in-the-ios-multitasking-switcher.html" class="sidebar-link">Controlling the Screenshot in the iOS Multitasking Switcher</a></li><li><a href="/xamarin/xamarin-ios-google-places-autocomplete.html" class="sidebar-link">Xamarin iOS Google Places Autocomplete</a></li><li><a href="/xamarin/getting-started-with-xamarin-android.html" class="sidebar-link">Getting started with Xamarin.Android</a></li><li><a href="/xamarin/app-lifecycle-xamarin-andorid.html" class="sidebar-link">App lifecycle - Xamarin.Andorid</a></li><li><a href="/xamarin/bindings.html" class="sidebar-link">Bindings</a></li><li><a href="/xamarin/dialogs.html" class="sidebar-link">Dialogs</a></li><li><a href="/xamarin/toasts.html" class="sidebar-link">Toasts</a></li><li><a href="/xamarin/dialogs.html" class="sidebar-link">Dialogs</a></li><li><a href="/xamarin/custom-listview.html" class="sidebar-link">Custom ListView</a></li><li><a href="/xamarin/recyclerview.html" class="sidebar-link">RecyclerView</a></li><li><a href="/xamarin/xamarin-android-how-to-create-a-toolbar.html" class="sidebar-link">Xamarin.Android - How to create a toolbar</a></li><li><a href="/xamarin/xamarin-android-bluetooth-communication.html" class="sidebar-link">Xamarin.Android - Bluetooth communication</a></li><li><a href="/xamarin/how-to-correct-the-orientation-of-a-picture-captured-from-android-device.html" class="sidebar-link">How to correct the orientation of a picture captured from Android device</a></li><li><a href="/xamarin/barcode-scanning-using-zxing-library-in-xamarin-applications.html" class="sidebar-link">Barcode scanning using ZXing library in Xamarin Applications</a></li><li><a href="/xamarin/publishing-your-xamarin-android-apk.html" class="sidebar-link">Publishing your Xamarin.Android APK</a></li><li><a href="/xamarin/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="accessing-native-features-with-dependencyservice"><a href="#accessing-native-features-with-dependencyservice" class="header-anchor">#</a> Accessing native features with DependencyService</h1> <h2 id="implementing-text-to-speech"><a href="#implementing-text-to-speech" class="header-anchor">#</a> Implementing text-to-speech</h2> <p>A good example of a feature that request platform specific code is when you want to implement text-to-speech (tts). This example assumes that you are working with shared code in a PCL library.</p> <p>A schematic overview of our solution would look like the image underneath.</p> <p><a href="http://i.stack.imgur.com/gX0zs.png" target="_blank" rel="noopener noreferrer"><img src="http://i.stack.imgur.com/gX0zs.png" alt="Schematic overview (image by Xamarin)"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>In our shared code we define an interface which is registered with the <code>DependencyService</code>. This is where we will do our calls upon.
Define an interface like underneath.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ITextToSpeech</span>
<span class="token punctuation">{</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> Speak <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> text<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>Now in each specific platform, we need to create an implementation of this interface. Let's start with the iOS implementation.</p> <h3 id="ios-implementation"><a href="#ios-implementation" class="header-anchor">#</a> iOS Implementation</h3> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">AVFoundation</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TextToSpeechImplementation</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ITextToSpeech</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> TextToSpeechImplementation <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> Speak <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> text<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> speechSynthesizer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">AVSpeechSynthesizer</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name"><span class="token keyword">var</span></span> speechUtterance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">AVSpeechUtterance</span> <span class="token punctuation">(</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            Rate <span class="token operator">=</span> AVSpeechUtterance<span class="token punctuation">.</span>MaximumSpeechRate<span class="token operator">/</span><span class="token number">4</span><span class="token punctuation">,</span>
            Voice <span class="token operator">=</span> AVSpeechSynthesisVoice<span class="token punctuation">.</span>FromLanguage <span class="token punctuation">(</span><span class="token string">&quot;en-US&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            Volume <span class="token operator">=</span> <span class="token number">0.5f</span><span class="token punctuation">,</span>
            PitchMultiplier <span class="token operator">=</span> <span class="token number">1.0f</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        speechSynthesizer<span class="token punctuation">.</span>SpeakUtterance <span class="token punctuation">(</span>speechUtterance<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>In the code example above you notice that there is specific code to iOS. Like types such as <code>AVSpeechSynthesizer</code>. These would not work in shared code.</p> <p>To register this implementation with the Xamarin <code>DependencyService</code> add this attribute above the namespace declaration.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">AVFoundation</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">DependencyServiceSample<span class="token punctuation">.</span>iOS</span><span class="token punctuation">;</span><span class="token comment">//enables registration outside of namespace</span>

<span class="token punctuation">[</span>assembly<span class="token punctuation">:</span> Xamarin<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>Dependency <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token punctuation">(</span><span class="token type-expression class-name">TextToSpeechImplementation</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">namespace</span> <span class="token namespace">DependencyServiceSample<span class="token punctuation">.</span>iOS</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TextToSpeechImplementation</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ITextToSpeech</span></span>
<span class="token comment">//... Rest of code</span>

</code></pre></div><p>Now when you do a call like this in your shared code, the right implementation for the platform you are running your app on is injected.</p> <p><code>DependencyService.Get&lt;ITextToSpeech&gt;()</code>. More on this later on.</p> <h3 id="android-implementation"><a href="#android-implementation" class="header-anchor">#</a> Android Implementation</h3> <p>The Android implementation of this code would look like underneath.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">Android<span class="token punctuation">.</span>Speech<span class="token punctuation">.</span>Tts</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Xamarin<span class="token punctuation">.</span>Forms</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">DependencyServiceSample<span class="token punctuation">.</span>Droid</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TextToSpeechImplementation</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Java<span class="token punctuation">.</span>Lang<span class="token punctuation">.</span>Object</span><span class="token punctuation">,</span> <span class="token class-name">ITextToSpeech</span><span class="token punctuation">,</span> <span class="token class-name">TextToSpeech<span class="token punctuation">.</span>IOnInitListener</span></span>
<span class="token punctuation">{</span>
    <span class="token class-name">TextToSpeech</span> speaker<span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">string</span></span> toSpeak<span class="token punctuation">;</span>

    <span class="token keyword">public</span> TextToSpeechImplementation <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> Speak <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> text<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> ctx <span class="token operator">=</span> Forms<span class="token punctuation">.</span>Context<span class="token punctuation">;</span> <span class="token comment">// useful for many Android SDK features</span>
        toSpeak <span class="token operator">=</span> text<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>speaker <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            speaker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TextToSpeech</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            speaker<span class="token punctuation">.</span>Speak <span class="token punctuation">(</span>toSpeak<span class="token punctuation">,</span> QueueMode<span class="token punctuation">.</span>Flush<span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token preprocessor property">#<span class="token directive keyword">region</span> IOnInitListener implementation</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> OnInit <span class="token punctuation">(</span><span class="token class-name">OperationResult</span> status<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>status<span class="token punctuation">.</span>Equals <span class="token punctuation">(</span>OperationResult<span class="token punctuation">.</span>Success<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            speaker<span class="token punctuation">.</span>Speak <span class="token punctuation">(</span>toSpeak<span class="token punctuation">,</span> QueueMode<span class="token punctuation">.</span>Flush<span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>
<span class="token punctuation">}</span>

</code></pre></div><p>Again don't forget to register it with the <code>DependencyService</code>.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">Android<span class="token punctuation">.</span>Speech<span class="token punctuation">.</span>Tts</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Xamarin<span class="token punctuation">.</span>Forms</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">DependencyServiceSample<span class="token punctuation">.</span>Droid</span><span class="token punctuation">;</span>


<span class="token punctuation">[</span><span class="token attribute"><span class="token target keyword">assembly</span><span class="token punctuation">:</span> <span class="token class-name">Xamarin<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>Dependency</span> <span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token punctuation">(</span><span class="token type-expression class-name">TextToSpeechImplementation</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">namespace</span> <span class="token namespace">DependencyServiceSample<span class="token punctuation">.</span>Droid</span><span class="token punctuation">{</span>
    <span class="token comment">//... Rest of code</span>

</code></pre></div><h3 id="windows-phone-implementation"><a href="#windows-phone-implementation" class="header-anchor">#</a> Windows Phone Implementation</h3> <p>Finally, for Windows Phone this code can be used.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TextToSpeechImplementation</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ITextToSpeech</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">TextToSpeechImplementation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Speak</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> text<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">MediaElement</span> mediaElement <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MediaElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name"><span class="token keyword">var</span></span> synth <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Windows<span class="token punctuation">.</span>Media<span class="token punctuation">.</span>SpeechSynthesis<span class="token punctuation">.</span>SpeechSynthesizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">SpeechSynthesisStream</span> stream <span class="token operator">=</span> <span class="token keyword">await</span> synth<span class="token punctuation">.</span><span class="token function">SynthesizeTextToStreamAsync</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        mediaElement<span class="token punctuation">.</span><span class="token function">SetSource</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span> stream<span class="token punctuation">.</span>ContentType<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mediaElement<span class="token punctuation">.</span><span class="token function">Play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">await</span> synth<span class="token punctuation">.</span><span class="token function">SynthesizeTextToStreamAsync</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>And once more do not forget to register it.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">Windows<span class="token punctuation">.</span>Media<span class="token punctuation">.</span>SpeechSynthesis</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Windows<span class="token punctuation">.</span>UI<span class="token punctuation">.</span>Xaml<span class="token punctuation">.</span>Controls</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">DependencyServiceSample<span class="token punctuation">.</span>WinPhone</span><span class="token punctuation">;</span><span class="token comment">//enables registration outside of namespace</span>

<span class="token punctuation">[</span>assembly<span class="token punctuation">:</span> Xamarin<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>Dependency <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token punctuation">(</span><span class="token type-expression class-name">TextToSpeechImplementation</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">namespace</span> <span class="token namespace">DependencyServiceSample<span class="token punctuation">.</span>WinPhone</span><span class="token punctuation">{</span>
    <span class="token comment">//... Rest of code</span>

</code></pre></div><h3 id="implementing-in-shared-code"><a href="#implementing-in-shared-code" class="header-anchor">#</a> Implementing in Shared Code</h3> <p>Now everything is in place to make it work! Finally, in your shared code you can now call this function by using the interface. At runtime, the implementation will be injected which corresponds to the current platform it is running on.</p> <p>In this code you will see a page that could be in a Xamarin Forms project. It creates a button which invokes the <code>Speak()</code> method by using the <code>DependencyService</code>.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">public</span> MainPage <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> speak <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Button</span> <span class="token punctuation">{</span>
        Text <span class="token operator">=</span> <span class="token string">&quot;Hello, Forms !&quot;</span><span class="token punctuation">,</span>
        VerticalOptions <span class="token operator">=</span> LayoutOptions<span class="token punctuation">.</span>CenterAndExpand<span class="token punctuation">,</span>
        HorizontalOptions <span class="token operator">=</span> LayoutOptions<span class="token punctuation">.</span>CenterAndExpand<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    speak<span class="token punctuation">.</span>Clicked <span class="token operator">+=</span> <span class="token punctuation">(</span>sender<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        DependencyService<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Get</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ITextToSpeech<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Speak</span><span class="token punctuation">(</span><span class="token string">&quot;Hello from Xamarin Forms&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    Content <span class="token operator">=</span> speak<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>The result will be that when the app is ran and the button is clicked, the text provided will be spoken.</p> <p>All of this without having to do hard stuff like compiler hints and such. You now have one uniform way of accessing platform specific functionality through platform independent code.</p> <h2 id="getting-application-and-device-os-version-numbers-android-ios-pcl"><a href="#getting-application-and-device-os-version-numbers-android-ios-pcl" class="header-anchor">#</a> Getting Application and Device OS Version Numbers - Android &amp; iOS - PCL</h2> <p>The example below will collect the Device's OS version number and the the version of the application (which is defined in each projects' properties) that is entered into <strong>Version name</strong> on Android and <strong>Version</strong> on iOS.</p> <p>First make an interface in your PCL project:</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">INativeHelper</span> <span class="token punctuation">{</span>
    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// On iOS, gets the &lt;c&gt;CFBundleVersion&lt;/c&gt; number and on Android, gets the &lt;c&gt;PackageInfo&lt;/c&gt;'s &lt;c&gt;VersionName&lt;/c&gt;, both of which are specified in their respective project properties.</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token comment">/// &lt;returns&gt;&lt;c&gt;string&lt;/c&gt;, containing the build number.&lt;/returns&gt;</span>
    <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GetAppVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// On iOS, gets the &lt;c&gt;UIDevice.CurrentDevice.SystemVersion&lt;/c&gt; number and on Android, gets the &lt;c&gt;Build.VERSION.Release&lt;/c&gt;.</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token comment">/// &lt;returns&gt;&lt;c&gt;string&lt;/c&gt;, containing the OS version number.&lt;/returns&gt;</span>
    <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GetOsVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>Now we implement the interface in the Android and iOS projects.</p> <p>Android:</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token target keyword">assembly</span><span class="token punctuation">:</span> <span class="token class-name">Dependency</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">NativeHelper_Android</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>

<span class="token keyword">namespace</span> <span class="token namespace">YourNamespace<span class="token punctuation">.</span>Droid</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NativeHelper_Android</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">INativeHelper</span></span> <span class="token punctuation">{</span>
        
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// See interface summary.</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GetAppVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Context</span> context <span class="token operator">=</span> Forms<span class="token punctuation">.</span>Context<span class="token punctuation">;</span>
            <span class="token keyword">return</span> context<span class="token punctuation">.</span>PackageManager<span class="token punctuation">.</span><span class="token function">GetPackageInfo</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>PackageName<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>VersionName<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// See interface summary.</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GetOsVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> Build<span class="token punctuation">.</span>VERSION<span class="token punctuation">.</span>Release<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>iOS:</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token target keyword">assembly</span><span class="token punctuation">:</span> <span class="token class-name">Dependency</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">NativeHelper_iOS</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>

<span class="token keyword">namespace</span> <span class="token namespace">YourNamespace<span class="token punctuation">.</span>iOS</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NativeHelper_iOS</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">INativeHelper</span></span> <span class="token punctuation">{</span>
        
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// See interface summary.</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GetAppVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> Foundation<span class="token punctuation">.</span>NSBundle<span class="token punctuation">.</span>MainBundle<span class="token punctuation">.</span>InfoDictionary<span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Foundation<span class="token punctuation">.</span>NSString</span><span class="token punctuation">(</span><span class="token string">&quot;CFBundleVersion&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// See interface summary.</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GetOsVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> UIDevice<span class="token punctuation">.</span>CurrentDevice<span class="token punctuation">.</span>SystemVersion<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>Now to use the code in a method:</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> GetOsAndAppVersion <span class="token punctuation">{</span>
    <span class="token class-name">INativeHelper</span> helper <span class="token operator">=</span> DependencyService<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Get</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>INativeHelper<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>helper <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">string</span></span> osVersion  <span class="token operator">=</span> helper<span class="token punctuation">.</span><span class="token function">GetOsVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">string</span></span> appVersion <span class="token operator">=</span> helper<span class="token punctuation">.</span><span class="token function">GetBuildNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="remarks"><a href="#remarks" class="header-anchor">#</a> Remarks</h4> <p>If you do not want your code to break when no implementation is found, check the <code>DependencyService</code> first if it has a implementation available.</p> <p>You can do this by a simple check if it is not <code>null</code>.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">var</span></span> speaker <span class="token operator">=</span> DependencyService<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Get</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ITextToSpeech<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>speaker <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    speaker<span class="token punctuation">.</span><span class="token function">Speak</span><span class="token punctuation">(</span><span class="token string">&quot;Ready for action!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>or, if your IDE supports C# 6, with null-conditional operator:</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">var</span></span> speaker <span class="token operator">=</span> DependencyService<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Get</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ITextToSpeech<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

speaker<span class="token punctuation">?.</span><span class="token function">Speak</span><span class="token punctuation">(</span><span class="token string">&quot;Ready for action!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>If you don't do this and no implementation is found at runtime, your code will generate an exception.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/xamarin/accessing-native-features-with-dependencyservice.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/xamarin/display-alert.html" class="prev">
        Display Alert
      </a></span> <span class="next"><a href="/xamarin/dependencyservice.html">
        DependencyService
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/3503.70b038e0.js" defer></script>
  </body>
</html>
