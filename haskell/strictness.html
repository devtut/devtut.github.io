<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Haskell - Strictness</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Bang Patterns, Lazy patterns, Normal forms, Strict fields">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="Haskell - Strictness">
    <meta property="og:description" content="Bang Patterns, Lazy patterns, Normal forms, Strict fields">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/haskell/strictness.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="Haskell - Strictness">
    <meta name="twitter:description" content="Bang Patterns, Lazy patterns, Normal forms, Strict fields">
    <meta name="twitter:url" content="/haskell/strictness.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/1227.29e380b1.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Haskell</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/haskell/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/haskell/getting-started-with-haskell-language.html" class="sidebar-link">Getting started with Haskell Language</a></li><li><a href="/haskell/overloaded-literals.html" class="sidebar-link">Overloaded Literals</a></li><li><a href="/haskell/foldable.html" class="sidebar-link">Foldable</a></li><li><a href="/haskell/traversable.html" class="sidebar-link">Traversable</a></li><li><a href="/haskell/lens.html" class="sidebar-link">Lens</a></li><li><a href="/haskell/quickcheck.html" class="sidebar-link">QuickCheck</a></li><li><a href="/haskell/common-ghc-language-extensions.html" class="sidebar-link">Common GHC Language Extensions</a></li><li><a href="/haskell/free-monads.html" class="sidebar-link">Free Monads</a></li><li><a href="/haskell/type-classes.html" class="sidebar-link">Type Classes</a></li><li><a href="/haskell/io.html" class="sidebar-link">IO</a></li><li><a href="/haskell/record-syntax.html" class="sidebar-link">Record Syntax</a></li><li><a href="/haskell/partial-application.html" class="sidebar-link">Partial Application</a></li><li><a href="/haskell/monoid.html" class="sidebar-link">Monoid</a></li><li><a href="/haskell/category-theory.html" class="sidebar-link">Category Theory</a></li><li><a href="/haskell/lists.html" class="sidebar-link">Lists</a></li><li><a href="/haskell/sorting-algorithms.html" class="sidebar-link">Sorting Algorithms</a></li><li><a href="/haskell/type-families.html" class="sidebar-link">Type Families</a></li><li><a href="/haskell/monads.html" class="sidebar-link">Monads</a></li><li><a href="/haskell/stack.html" class="sidebar-link">Stack</a></li><li><a href="/haskell/generalized-algebraic-data-types.html" class="sidebar-link">Generalized Algebraic Data Types</a></li><li><a href="/haskell/recursion-schemes.html" class="sidebar-link">Recursion Schemes</a></li><li><a href="/haskell/data-text.html" class="sidebar-link">Data.Text</a></li><li><a href="/haskell/using-ghci.html" class="sidebar-link">Using GHCi</a></li><li><a href="/haskell/strictness.html" aria-current="page" class="active sidebar-link">Strictness</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/haskell/strictness.html#bang-patterns" class="sidebar-link">Bang Patterns</a></li><li class="sidebar-sub-header"><a href="/haskell/strictness.html#lazy-patterns" class="sidebar-link">Lazy patterns</a></li><li class="sidebar-sub-header"><a href="/haskell/strictness.html#normal-forms" class="sidebar-link">Normal forms</a></li><li class="sidebar-sub-header"><a href="/haskell/strictness.html#strict-fields" class="sidebar-link">Strict fields</a></li></ul></li><li><a href="/haskell/syntax-in-functions.html" class="sidebar-link">Syntax in Functions</a></li><li><a href="/haskell/functor.html" class="sidebar-link">Functor</a></li><li><a href="/haskell/testing-with-tasty.html" class="sidebar-link">Testing with Tasty</a></li><li><a href="/haskell/creating-custom-data-types.html" class="sidebar-link">Creating Custom Data Types</a></li><li><a href="/haskell/reactive-banana.html" class="sidebar-link">Reactive-banana</a></li><li><a href="/haskell/optimization.html" class="sidebar-link">Optimization</a></li><li><a href="/haskell/concurrency.html" class="sidebar-link">Concurrency</a></li><li><a href="/haskell/function-composition.html" class="sidebar-link">Function composition</a></li><li><a href="/haskell/databases.html" class="sidebar-link">Databases</a></li><li><a href="/haskell/data-aeson-json-in-haskell.html" class="sidebar-link">Data.Aeson - JSON in Haskell</a></li><li><a href="/haskell/higher-order-functions.html" class="sidebar-link">Higher-order functions</a></li><li><a href="/haskell/containers-data-map.html" class="sidebar-link">Containers - Data.Map</a></li><li><a href="/haskell/fixity-declarations.html" class="sidebar-link">Fixity declarations</a></li><li><a href="/haskell/web-development.html" class="sidebar-link">Web Development</a></li><li><a href="/haskell/vectors.html" class="sidebar-link">Vectors</a></li><li><a href="/haskell/cabal.html" class="sidebar-link">Cabal</a></li><li><a href="/haskell/type-algebra.html" class="sidebar-link">Type algebra</a></li><li><a href="/haskell/arrows.html" class="sidebar-link">Arrows</a></li><li><a href="/haskell/typed-holes.html" class="sidebar-link">Typed holes</a></li><li><a href="/haskell/rewrite-rules-ghc.html" class="sidebar-link">Rewrite rules (GHC)</a></li><li><a href="/haskell/date-and-time.html" class="sidebar-link">Date and Time</a></li><li><a href="/haskell/list-comprehensions.html" class="sidebar-link">List Comprehensions</a></li><li><a href="/haskell/streaming-io.html" class="sidebar-link">Streaming IO</a></li><li><a href="/haskell/google-protocol-buffers.html" class="sidebar-link">Google Protocol Buffers</a></li><li><a href="/haskell/template-haskell-quasiquotes.html" class="sidebar-link">Template Haskell &amp; QuasiQuotes</a></li><li><a href="/haskell/phantom-types.html" class="sidebar-link">Phantom types</a></li><li><a href="/haskell/modules.html" class="sidebar-link">Modules</a></li><li><a href="/haskell/tuples-pairs-triples.html" class="sidebar-link">Tuples (Pairs, Triples, ...)</a></li><li><a href="/haskell/graphics-with-gloss.html" class="sidebar-link">Graphics with Gloss</a></li><li><a href="/haskell/state-monad.html" class="sidebar-link">State Monad</a></li><li><a href="/haskell/pipes.html" class="sidebar-link">Pipes</a></li><li><a href="/haskell/infix-operators.html" class="sidebar-link">Infix operators</a></li><li><a href="/haskell/parallelism.html" class="sidebar-link">Parallelism</a></li><li><a href="/haskell/parsing-html-with-taggy-lens-and-lens.html" class="sidebar-link">Parsing HTML with taggy-lens and lens</a></li><li><a href="/haskell/foreign-function-interface.html" class="sidebar-link">Foreign Function Interface</a></li><li><a href="/haskell/gtk3.html" class="sidebar-link">Gtk3</a></li><li><a href="/haskell/monad-transformers.html" class="sidebar-link">Monad Transformers</a></li><li><a href="/haskell/bifunctor.html" class="sidebar-link">Bifunctor</a></li><li><a href="/haskell/proxies.html" class="sidebar-link">Proxies</a></li><li><a href="/haskell/applicative-functor.html" class="sidebar-link">Applicative Functor</a></li><li><a href="/haskell/common-monads-as-free-monads.html" class="sidebar-link">Common monads as free monads</a></li><li><a href="/haskell/common-functors-as-the-base-of-cofree-comonads.html" class="sidebar-link">Common functors as the base of cofree comonads</a></li><li><a href="/haskell/arithmetic.html" class="sidebar-link">Arithmetic</a></li><li><a href="/haskell/role.html" class="sidebar-link">Role</a></li><li><a href="/haskell/arbitrary-rank-polymorphism-with-rankntypes.html" class="sidebar-link">Arbitrary-rank polymorphism with RankNTypes</a></li><li><a href="/haskell/ghcjs.html" class="sidebar-link">GHCJS</a></li><li><a href="/haskell/xml.html" class="sidebar-link">XML</a></li><li><a href="/haskell/reader-readert.html" class="sidebar-link">Reader / ReaderT</a></li><li><a href="/haskell/function-call-syntax.html" class="sidebar-link">Function call syntax</a></li><li><a href="/haskell/logging.html" class="sidebar-link">Logging</a></li><li><a href="/haskell/attoparsec.html" class="sidebar-link">Attoparsec</a></li><li><a href="/haskell/zipwithm.html" class="sidebar-link">zipWithM</a></li><li><a href="/haskell/profunctor.html" class="sidebar-link">Profunctor</a></li><li><a href="/haskell/type-application.html" class="sidebar-link">Type Application</a></li><li><a href="/haskell/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="strictness"><a href="#strictness" class="header-anchor">#</a> Strictness</h1> <h2 id="bang-patterns"><a href="#bang-patterns" class="header-anchor">#</a> Bang Patterns</h2> <p>Patterns annotated with a bang (<code>!</code>) are evaluated strictly instead of lazily.</p> <div class="language-hs extra-class"><pre class="language-hs"><code><span class="token hvariable">foo</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token hvariable">x</span><span class="token punctuation">,</span> <span class="token hvariable">y</span><span class="token punctuation">)</span> <span class="token operator">!</span><span class="token hvariable">z</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token hvariable">x</span><span class="token punctuation">,</span> <span class="token hvariable">y</span><span class="token punctuation">,</span> <span class="token hvariable">z</span><span class="token punctuation">]</span> 

</code></pre></div><p>In this example, <code>x</code> and <code>z</code> will both be evaluated to weak head normal form before returning the list. It's equivalent to:</p> <div class="language-hs extra-class"><pre class="language-hs"><code><span class="token hvariable">foo</span> <span class="token punctuation">(</span><span class="token hvariable">x</span><span class="token punctuation">,</span> <span class="token hvariable">y</span><span class="token punctuation">)</span> <span class="token hvariable">z</span> <span class="token operator">=</span> <span class="token hvariable">x</span> <span class="token operator">`seq`</span> <span class="token hvariable">z</span> <span class="token operator">`seq`</span> <span class="token punctuation">[</span><span class="token hvariable">x</span><span class="token punctuation">,</span> <span class="token hvariable">y</span><span class="token punctuation">,</span> <span class="token hvariable">z</span><span class="token punctuation">]</span>

</code></pre></div><p>Bang patterns are enabled using the Haskell 2010 <code>BangPatterns</code> language extension.</p> <h2 id="lazy-patterns"><a href="#lazy-patterns" class="header-anchor">#</a> Lazy patterns</h2> <p>Lazy, or <strong>irrefutable</strong>, patterns (denoted with the syntax <code>~pat</code>) are patterns that always match, without even looking at the matched value. This means lazy patterns will match even bottom values. However, subsequent uses of variables bound in sub-patterns of an irrefutable pattern will force the pattern matching to occur, evaluating to bottom unless the match succeeds.</p> <p>The following function is lazy in its argument:</p> <div class="language-hs extra-class"><pre class="language-hs"><code><span class="token hvariable">f1</span> <span class="token operator">::</span> <span class="token constant">Either</span> <span class="token hvariable">e</span> <span class="token constant">Int</span> <span class="token operator">-&gt;</span> <span class="token constant">Int</span>
<span class="token hvariable">f1</span> <span class="token operator">~</span><span class="token punctuation">(</span><span class="token constant">Right</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">42</span>

</code></pre></div><p>and so we get</p> <div class="language-hs extra-class"><pre class="language-hs"><code>λ» <span class="token hvariable">f1</span> <span class="token punctuation">(</span><span class="token constant">Right</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token number">42</span>
λ» <span class="token hvariable">f1</span> <span class="token punctuation">(</span><span class="token constant">Right</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token number">42</span>
λ» <span class="token hvariable">f1</span> <span class="token punctuation">(</span><span class="token constant">Left</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span>
<span class="token number">42</span>
λ» <span class="token hvariable">f1</span> <span class="token punctuation">(</span><span class="token builtin">error</span> <span class="token string">&quot;oops!&quot;</span><span class="token punctuation">)</span>
<span class="token number">42</span>
λ» <span class="token hvariable">f1</span> <span class="token string">&quot;oops!&quot;</span>
<span class="token operator">***</span> <span class="token keyword">type</span> <span class="token hvariable">mismatch</span> <span class="token operator">***</span>

</code></pre></div><p>The following function is written with a lazy pattern but is in fact using the pattern's variable which forces the match, so will fail for <code>Left</code> arguments:</p> <div class="language-hs extra-class"><pre class="language-hs"><code><span class="token hvariable">f2</span> <span class="token operator">::</span> <span class="token constant">Either</span> <span class="token hvariable">e</span> <span class="token constant">Int</span> <span class="token operator">-&gt;</span> <span class="token constant">Int</span>
<span class="token hvariable">f2</span> <span class="token operator">~</span><span class="token punctuation">(</span><span class="token constant">Right</span> <span class="token hvariable">x</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token hvariable">x</span> <span class="token operator">+</span> <span class="token number">1</span>

λ» <span class="token hvariable">f2</span> <span class="token punctuation">(</span><span class="token constant">Right</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token number">2</span>
λ» <span class="token hvariable">f2</span> <span class="token punctuation">(</span><span class="token constant">Right</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token number">3</span>
λ» <span class="token hvariable">f2</span> <span class="token punctuation">(</span><span class="token constant">Right</span> <span class="token punctuation">(</span><span class="token builtin">error</span> <span class="token string">&quot;oops!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">***</span> <span class="token constant">Exception</span><span class="token operator">:</span> <span class="token hvariable">oops</span><span class="token operator">!</span>
λ» <span class="token hvariable">f2</span> <span class="token punctuation">(</span><span class="token constant">Left</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span>
<span class="token operator">***</span> <span class="token constant">Exception</span><span class="token operator">:</span> <span class="token hvariable">lazypat</span><span class="token punctuation">.</span><span class="token hvariable">hs</span><span class="token operator">:</span><span class="token number">5</span><span class="token operator">:</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">21</span><span class="token operator">:</span> <span class="token constant">Irrefutable</span> <span class="token hvariable">pattern</span> <span class="token hvariable">failed</span> <span class="token hvariable">for</span> <span class="token hvariable">pattern</span> <span class="token punctuation">(</span><span class="token constant">Right</span> <span class="token hvariable">x</span><span class="token punctuation">)</span>
λ» <span class="token hvariable">f2</span> <span class="token punctuation">(</span><span class="token builtin">error</span> <span class="token string">&quot;oops!&quot;</span><span class="token punctuation">)</span>
<span class="token operator">***</span> <span class="token constant">Exception</span><span class="token operator">:</span> <span class="token hvariable">oops</span><span class="token operator">!</span> 

</code></pre></div><p><code>let</code> bindings are lazy, behave as irrefutable patterns:</p> <div class="language-hs extra-class"><pre class="language-hs"><code><span class="token hvariable">act1</span> <span class="token operator">::</span> <span class="token constant">IO</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token hvariable">act1</span> <span class="token operator">=</span> <span class="token keyword">do</span>
    <span class="token hvariable">ss</span> <span class="token operator">&lt;-</span> <span class="token builtin">readLn</span>
    <span class="token keyword">let</span> <span class="token punctuation">[</span><span class="token hvariable">s1</span><span class="token punctuation">,</span> <span class="token hvariable">s2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token hvariable">ss</span> <span class="token operator">::</span> <span class="token punctuation">[</span><span class="token constant">String</span><span class="token punctuation">]</span>
    <span class="token builtin">putStrLn</span> <span class="token string">&quot;Done&quot;</span>

<span class="token hvariable">act2</span> <span class="token operator">::</span> <span class="token constant">IO</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token hvariable">act2</span> <span class="token operator">=</span> <span class="token keyword">do</span>
    <span class="token hvariable">ss</span> <span class="token operator">&lt;-</span> <span class="token builtin">readLn</span>
    <span class="token keyword">let</span> <span class="token punctuation">[</span><span class="token hvariable">s1</span><span class="token punctuation">,</span> <span class="token hvariable">s2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token hvariable">ss</span>
    <span class="token builtin">putStrLn</span> <span class="token hvariable">s1</span>

</code></pre></div><p>Here <code>act1</code> works on inputs that parse to any list of strings, whereas in <code>act2</code> the <code>putStrLn s1</code> needs the value of <code>s1</code> which forces the pattern matching for <code>[s1, s2]</code>, so it works only for lists of exactly two strings:</p> <div class="language-hs extra-class"><pre class="language-hs"><code>λ» <span class="token hvariable">act1</span>
<span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">]</span>
<span class="token constant">Done</span>
λ» <span class="token hvariable">act2</span>
<span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">]</span>
<span class="token operator">***</span> <span class="token builtin">readIO</span><span class="token operator">:</span> <span class="token hvariable">no</span> <span class="token hvariable">parse</span> <span class="token operator">***</span>

</code></pre></div><h2 id="normal-forms"><a href="#normal-forms" class="header-anchor">#</a> Normal forms</h2> <p>This example provides a brief overview - for a more in-depth explanation of <strong>normal forms</strong> and examples, see <a href="http://stackoverflow.com/questions/6872898/haskell-what-is-weak-head-normal-form" target="_blank" rel="noopener noreferrer">this question<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h3 id="reduced-normal-form"><a href="#reduced-normal-form" class="header-anchor">#</a> Reduced normal form</h3> <p>The reduced normal form (or just normal form, when the context is clear) of an expression is the result of evaluating all reducible subexpressions in the given expression. Due to the non-strict semantics of Haskell (typically called <strong>laziness</strong>), a subexpression is not reducible if it is under a binder (i.e. a lambda abstraction - <code>\x -&gt; ..</code>). The normal form of an expression has the property that if it exists, it is unique.</p> <p>In other words, it does not matter (in terms of denotational semantics) in which order you reduce subexpressions. However, the key to writing performant Haskell programs is often ensuring that the right expression is evaluated at the right time, i.e, the understanding the operational semantics.</p> <p>An expression whose normal form is itself is said to be <strong>in normal form</strong>.</p> <p>Some expressions, e.g. <code>let x = 1:x in x</code>, have no normal form, but are still  productive. The example expression still has a <strong>value</strong>, if one admits infinite values, which here is the list <code>[1,1, ...]</code>. Other expressions, such as <code>let y = 1+y in y</code>, have no value, or their value is <code>undefined</code>.</p> <h3 id="weak-head-normal-form"><a href="#weak-head-normal-form" class="header-anchor">#</a> Weak head normal form</h3> <p>The RNF corresponds to fully evaluating an expression  - likewise, the weak head normal form (WHNF) corresponds to evaluating to the <strong>head</strong> of the expression. The head of an expression <code>e</code> is fully evaluated if <code>e</code> is an application <code>Con e1 e2 .. en</code> and <code>Con</code> is a constructor; or an abstraction <code>\x -&gt; e1</code>; or a partial application <code>f e1 e2 .. en</code>, where partial application means <code>f</code> takes more than <code>n</code> arguments (or equivalently, the type of <code>e</code> is a function type). In any case, the subexpressions <code>e1..en</code> can be evaluated or unevaluated for the expression to be in  WHNF - they can even be <code>undefined</code>.</p> <p>The evaluation semantics of Haskell can be described in terms of the WHNF - to evaluate an expression <code>e</code>, first evaluate it to WHNF, then recursively evaluate all of its subexpressions from left to right.</p> <p>The primitive <code>seq</code> function is used to evaluate an expression to WHNF. <code>seq x y</code> is denotationally equal to <code>y</code> (the value of <code>seq x y</code> is precisely <code>y</code>); furthermore <code>x</code> is evaluated to WHNF when <code>y</code> is evaluated to WHNF. An expression can also be evaluated to WHNF with a bang pattern (enabled by the <code>-XBangPatterns</code> extension), whose syntax is as follows:</p> <div class="language-hs extra-class"><pre class="language-hs"><code><span class="token hvariable">f</span> <span class="token operator">!</span><span class="token hvariable">x</span> <span class="token hvariable">y</span> <span class="token operator">=</span> <span class="token operator">...</span> 

</code></pre></div><p>In which <code>x</code> will be evaluated to WHNF when <code>f</code> is evaluated, while <code>y</code> is not (necessarily) evaluated. A bang pattern can also appear in a constructor, e.g.</p> <div class="language-hs extra-class"><pre class="language-hs"><code><span class="token keyword">data</span> <span class="token constant">X</span> <span class="token operator">=</span> <span class="token constant">Con</span> <span class="token constant">A</span> <span class="token operator">!</span><span class="token constant">B</span> <span class="token constant">C</span> <span class="token operator">..</span> <span class="token constant">N</span>

</code></pre></div><p>in which case the constructor <code>Con</code> is said to be strict in the <code>B</code> field, which means the <code>B</code> field is evaluated to WHNF when the constructor is applied to sufficient (here, two) arguments.</p> <h2 id="strict-fields"><a href="#strict-fields" class="header-anchor">#</a> Strict fields</h2> <p>In a <code>data</code> declaration, prefixing a type with a bang (<code>!</code>) makes the field a <strong>strict field</strong>. When the data constructor is applied, those fields will be evaluated to weak head normal form, so the data in the fields is guaranteed to always be in weak head normal form.</p> <p>Strict fields can be used in both record and non-record types:</p> <div class="language-hs extra-class"><pre class="language-hs"><code><span class="token keyword">data</span> <span class="token constant">User</span> <span class="token operator">=</span> <span class="token constant">User</span>
    <span class="token punctuation">{</span> <span class="token hvariable">identifier</span> <span class="token operator">::</span> <span class="token operator">!</span><span class="token constant">Int</span>
    <span class="token punctuation">,</span> <span class="token hvariable">firstName</span> <span class="token operator">::</span> <span class="token operator">!</span><span class="token constant">Text</span>
    <span class="token punctuation">,</span> <span class="token hvariable">lastName</span> <span class="token operator">::</span> <span class="token operator">!</span><span class="token constant">Text</span>
    <span class="token punctuation">}</span>

<span class="token keyword">data</span> <span class="token constant">T</span> <span class="token operator">=</span> <span class="token constant">MkT</span> <span class="token operator">!</span><span class="token constant">Int</span> <span class="token operator">!</span><span class="token constant">Int</span>

</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/haskell/strictness.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/haskell/using-ghci.html" class="prev">
        Using GHCi
      </a></span> <span class="next"><a href="/haskell/syntax-in-functions.html">
        Syntax in Functions
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/1227.29e380b1.js" defer></script>
  </body>
</html>
