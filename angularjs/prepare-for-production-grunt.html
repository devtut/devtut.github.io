<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>AngularJS - Prepare for Production - Grunt</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="View preloading, Script optimisation ">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="AngularJS - Prepare for Production - Grunt">
    <meta property="og:description" content="View preloading, Script optimisation ">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/angularjs/prepare-for-production-grunt.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="AngularJS - Prepare for Production - Grunt">
    <meta name="twitter:description" content="View preloading, Script optimisation ">
    <meta name="twitter:url" content="/angularjs/prepare-for-production-grunt.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/457.e7312f46.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>AngularJS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/angularjs/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/angularjs/getting-started-with-angularjs.html" class="sidebar-link">Getting started with AngularJS</a></li><li><a href="/angularjs/modules.html" class="sidebar-link">Modules</a></li><li><a href="/angularjs/components.html" class="sidebar-link">Components</a></li><li><a href="/angularjs/built-in-directives.html" class="sidebar-link">Built-in directives</a></li><li><a href="/angularjs/use-of-in-built-directives.html" class="sidebar-link">Use of in-built directives</a></li><li><a href="/angularjs/custom-directives.html" class="sidebar-link">Custom Directives</a></li><li><a href="/angularjs/how-data-binding-works.html" class="sidebar-link">How data binding works</a></li><li><a href="/angularjs/angular-project-directory-structure.html" class="sidebar-link">Angular Project - Directory Structure</a></li><li><a href="/angularjs/filters.html" class="sidebar-link">Filters</a></li><li><a href="/angularjs/custom-filters.html" class="sidebar-link">Custom filters</a></li><li><a href="/angularjs/constants.html" class="sidebar-link">Constants</a></li><li><a href="/angularjs/custom-filters-with-es6.html" class="sidebar-link">Custom filters with ES6</a></li><li><a href="/angularjs/directives-using-ngmodelcontroller.html" class="sidebar-link">Directives using ngModelController</a></li><li><a href="/angularjs/controllers.html" class="sidebar-link">Controllers</a></li><li><a href="/angularjs/controllers-with-es6.html" class="sidebar-link">Controllers with ES6</a></li><li><a href="/angularjs/the-self-or-this-variable-in-a-controller.html" class="sidebar-link">The Self Or This Variable In A Controller</a></li><li><a href="/angularjs/services.html" class="sidebar-link">Services</a></li><li><a href="/angularjs/distinguishing-service-vs-factory.html" class="sidebar-link">Distinguishing Service vs Factory</a></li><li><a href="/angularjs/angular-promises-with-q-service.html" class="sidebar-link">Angular promises with $q service</a></li><li><a href="/angularjs/dependency-injection.html" class="sidebar-link">Dependency Injection</a></li><li><a href="/angularjs/events.html" class="sidebar-link">Events</a></li><li><a href="/angularjs/sharing-data.html" class="sidebar-link">Sharing Data</a></li><li><a href="/angularjs/form-validation.html" class="sidebar-link">Form Validation</a></li><li><a href="/angularjs/routing-using-ngroute.html" class="sidebar-link">Routing using ngRoute</a></li><li><a href="/angularjs/ng-class-directive.html" class="sidebar-link">ng-class directive</a></li><li><a href="/angularjs/ng-repeat.html" class="sidebar-link">ng-repeat</a></li><li><a href="/angularjs/ng-style.html" class="sidebar-link">ng-style</a></li><li><a href="/angularjs/ng-view.html" class="sidebar-link">ng-view</a></li><li><a href="/angularjs/angularjs-bindings-options-etc.html" class="sidebar-link">AngularJS bindings options (=, @, &amp; etc.)</a></li><li><a href="/angularjs/providers.html" class="sidebar-link">Providers</a></li><li><a href="/angularjs/decorators.html" class="sidebar-link">Decorators</a></li><li><a href="/angularjs/print.html" class="sidebar-link">Print</a></li><li><a href="/angularjs/ui-router.html" class="sidebar-link">ui-router</a></li><li><a href="/angularjs/built-in-helper-functions.html" class="sidebar-link">Built-in helper Functions</a></li><li><a href="/angularjs/digest-loop-walkthrough.html" class="sidebar-link">digest loop walkthrough</a></li><li><a href="/angularjs/angular-scopes.html" class="sidebar-link">Angular $scopes</a></li><li><a href="/angularjs/using-angularjs-with-typescript.html" class="sidebar-link">Using AngularJS with TypeScript</a></li><li><a href="/angularjs/http-request.html" class="sidebar-link">$http request</a></li><li><a href="/angularjs/prepare-for-production-grunt.html" aria-current="page" class="active sidebar-link">Prepare for Production - Grunt</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/angularjs/prepare-for-production-grunt.html#view-preloading" class="sidebar-link">View preloading</a></li><li class="sidebar-sub-header"><a href="/angularjs/prepare-for-production-grunt.html#script-optimisation" class="sidebar-link">Script optimisation</a></li></ul></li><li><a href="/angularjs/grunt-tasks.html" class="sidebar-link">Grunt tasks</a></li><li><a href="/angularjs/lazy-loading.html" class="sidebar-link">Lazy loading</a></li><li><a href="/angularjs/http-interceptor.html" class="sidebar-link">HTTP Interceptor</a></li><li><a href="/angularjs/session-storage.html" class="sidebar-link">Session storage</a></li><li><a href="/angularjs/angular-mvc.html" class="sidebar-link">Angular MVC</a></li><li><a href="/angularjs/signalr-with-angularjs.html" class="sidebar-link">SignalR with AngularJs</a></li><li><a href="/angularjs/migration-to-angular-2.html" class="sidebar-link">Migration to Angular 2+</a></li><li><a href="/angularjs/angularjs-with-data-filter-pagination-etc.html" class="sidebar-link">angularjs with data filter, pagination etc</a></li><li><a href="/angularjs/profiling-and-performance.html" class="sidebar-link">Profiling and Performance</a></li><li><a href="/angularjs/performance-profiling.html" class="sidebar-link">Performance Profiling</a></li><li><a href="/angularjs/debugging.html" class="sidebar-link">Debugging</a></li><li><a href="/angularjs/unit-tests.html" class="sidebar-link">Unit tests</a></li><li><a href="/angularjs/angularjs-gotchas-and-traps.html" class="sidebar-link">AngularJS gotchas and traps</a></li><li><a href="/angularjs/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="prepare-for-production-grunt"><a href="#prepare-for-production-grunt" class="header-anchor">#</a> Prepare for Production - Grunt</h1> <h2 id="view-preloading"><a href="#view-preloading" class="header-anchor">#</a> View preloading</h2> <p>When the first time view is requested, normally Angular makes <code>XHR</code> request to get that view. For mid-size projects, the view count can be significant and it can slow down the application responsiveness.</p> <p>The <strong>good practice</strong> <strong>is to pre-load</strong> all the views at once for small and mid size projects. For larger projects it is good to aggregate them in some meaningful bulks as well, but some other methods can be handy to split the load. To automate this task it is handy to use Grunt or Gulp tasks.</p> <p>To pre-load the views, we can use <code>$templateCache</code> object. That is an object, where angular stores every received view from the server.</p> <p>It is possible to use <code>html2js</code> module, that will convert all our views to one module - js file. Then we will need to inject that module into our application and that's it.</p> <p>To create concatenated file of all the views we can use this task</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">grunt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token comment">//set up the location of your views here</span>
 <span class="token keyword">var</span> viewLocation <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'app/views/**.html'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
 
 grunt<span class="token punctuation">.</span><span class="token function">initConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        pkg<span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./package.json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token comment">//section that sets up the settings for concatenation of the html files into one file</span>
            html2js<span class="token operator">:</span> <span class="token punctuation">{</span>
                        options<span class="token operator">:</span> <span class="token punctuation">{</span>
                            base<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                            module<span class="token operator">:</span> <span class="token string">'app.templates'</span><span class="token punctuation">,</span> <span class="token comment">//new module name</span>
                            singleModule<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                            useStrict<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                            htmlmin<span class="token operator">:</span> <span class="token punctuation">{</span>
                                collapseBooleanAttributes<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                                collapseWhitespace<span class="token operator">:</span> <span class="token boolean">true</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span><span class="token punctuation">,</span>
                        main<span class="token operator">:</span> <span class="token punctuation">{</span>
                            src<span class="token operator">:</span> viewLocation<span class="token punctuation">,</span>
                            dest<span class="token operator">:</span> <span class="token string">'build/app.templates.js'</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">//this section is watching for changes in view files, and if there was a change, it will regenerate the production file. This task can be handy during development.</span>
            watch<span class="token operator">:</span> <span class="token punctuation">{</span>
                views<span class="token operator">:</span><span class="token punctuation">{</span>
                    files<span class="token operator">:</span> viewLocation<span class="token punctuation">,</span>
                    tasks<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'buildHTML'</span><span class="token punctuation">]</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">//to automatically generate one view file</span>
        grunt<span class="token punctuation">.</span><span class="token function">loadNpmTasks</span><span class="token punctuation">(</span><span class="token string">'grunt-html2js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">//to watch for changes and if the file has been changed, regenerate the file</span>
        grunt<span class="token punctuation">.</span><span class="token function">loadNpmTasks</span><span class="token punctuation">(</span><span class="token string">'grunt-contrib-watch'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">//just a task with friendly name to reference in watch</span>
        grunt<span class="token punctuation">.</span><span class="token function">registerTask</span><span class="token punctuation">(</span><span class="token string">'buildHTML'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'html2js'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><p>To use this way of concatination, you need to make 2 changes:
In your <code>index.html</code> file you need to reference the concatenated view file</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;build/app.templates.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

</code></pre></div><p>In the file, where you are declaring your app, you need to inject the dependency</p> <div class="language-js extra-class"><pre class="language-js"><code>angular<span class="token punctuation">.</span><span class="token function">module</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'app.templates'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

</code></pre></div><p>If you are using popular routers like <code>ui-router</code>, there are no changes in the way, how you are referencing templates</p> <div class="language- extra-class"><pre class="language-text"><code>
   .state('home', {
        url: '/home',
        views: {
            &quot;@&quot;: {
                controller: 'homeController',
                //this will be picked up from $templateCache
                templateUrl: 'app/views/home.html'
            },
        }

    })

</code></pre></div><h2 id="script-optimisation"><a href="#script-optimisation" class="header-anchor">#</a> Script optimisation</h2> <p>It is <strong>good practice to combine JS files together</strong> and minify them. For larger project there could be hundreds of JS files and it adds unnecessary latency to load each file separately from the server.</p> <p>For angular minification it is required to to have all functions annotated. That in necessary for Angular dependency injection proper minificaiton. (During minification, function names and variables will be renamed and it will break dependency injection if no extra actions will be taken.)</p> <p>During minificaiton <code>$scope</code> and <code>myService</code> variables will be replaced by some other values. Angular dependency injection works based on the name, as a result, these names shouldn't change</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">.</span><span class="token function">controller</span><span class="token punctuation">(</span><span class="token string">'myController'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">$scope<span class="token punctuation">,</span> myService</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><p>Angular will understand the array notation, because minification won't replace string literals.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">.</span><span class="token function">controller</span><span class="token punctuation">(</span><span class="token string">'myController'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'$scope'</span><span class="token punctuation">,</span><span class="token string">'myService'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">$scope<span class="token punctuation">,</span> myService</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

</code></pre></div><ul><li>Firstly we will concatinate all files end to end.</li> <li>Secondly we will use <code>ng-annotate</code> module, that will prepare code for minification</li> <li>Finally we will apply <code>uglify</code> module.</li></ul> <p>module.exports = function (grunt) {
//set up the location of your scripts here for reusing it in code
var scriptLocation = ['app/scripts/*.js'];</p> <div class="language- extra-class"><pre class="language-text"><code>
grunt.initConfig({
        pkg: require('./package.json'),
            //add necessary annotations for safe minification
         ngAnnotate: {
            angular: {
                src: ['staging/concatenated.js'],
                dest: 'staging/anotated.js'
            }
        },
        //combines all the files into one file
        concat: {
                js: {
                    src: scriptLocation,
                    dest: 'staging/concatenated.js'
                }
            },
        //final uglifying
        uglify: {
            options: {
                report: 'min',
                mangle: false,
                sourceMap:true
            },
            my_target: {
                files: {
                    'build/app.min.js': ['staging/anotated.js']
                }
            }
        },
        
        //this section is watching for changes in JS files, and if there was a change, it will regenerate the production file. You can choose not to do it, but I like to keep concatenated version up to date
        watch: {
            scripts: {
                files: scriptLocation,
                tasks: ['buildJS']
            }
        }
            
});

    //module to make files less readable
    grunt.loadNpmTasks('grunt-contrib-uglify');
    
    //mdule to concatenate files together
    grunt.loadNpmTasks('grunt-contrib-concat');
    
    //module to make angularJS files ready for minification
    grunt.loadNpmTasks('grunt-ng-annotate');
    
    //to watch for changes and if the file has been changed, regenerate the file
    grunt.loadNpmTasks('grunt-contrib-watch');
    
    //task that sequentially executes all steps to prepare JS file for production
    //concatinate all JS files
    //annotate JS file (prepare for minification
    //uglify file
     grunt.registerTask('buildJS', ['concat:js', 'ngAnnotate', 'uglify']);
};

</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/angularjs/prepare-for-production-grunt.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/angularjs/http-request.html" class="prev">
        $http request
      </a></span> <span class="next"><a href="/angularjs/grunt-tasks.html">
        Grunt tasks
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/457.e7312f46.js" defer></script>
  </body>
</html>
