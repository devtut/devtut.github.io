<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>AngularJS - Angular promises with $q service</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Wrap simple value into a promise using $q.when(), Using angular promises with $q service, Using the $q constructor to create promises, Using $q.all to handle multiple promises, Avoid the $q Deferred Anti-Pattern, Deferring operations using $q.defer">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="AngularJS - Angular promises with $q service">
    <meta property="og:description" content="Wrap simple value into a promise using $q.when(), Using angular promises with $q service, Using the $q constructor to create promises, Using $q.all to handle multiple promises, Avoid the $q Deferred Anti-Pattern, Deferring operations using $q.defer">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/angularjs/angular-promises-with-q-service.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="AngularJS - Angular promises with $q service">
    <meta name="twitter:description" content="Wrap simple value into a promise using $q.when(), Using angular promises with $q service, Using the $q constructor to create promises, Using $q.all to handle multiple promises, Avoid the $q Deferred Anti-Pattern, Deferring operations using $q.defer">
    <meta name="twitter:url" content="/angularjs/angular-promises-with-q-service.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    <link rel="preload" href="/assets/css/0.styles.8b877eb8.css" as="style"><link rel="preload" href="/assets/js/app.ced448ab.js" as="script"><link rel="preload" href="/assets/js/3.f1d73125.js" as="script"><link rel="preload" href="/assets/js/418.57b9f717.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.8b877eb8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>AngularJS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/angularjs/" class="sidebar-link">Disclaimer</a></li><li><a href="/angularjs/getting-started-with-angularjs.html" class="sidebar-link">Getting started with AngularJS</a></li><li><a href="/angularjs/modules.html" class="sidebar-link">Modules</a></li><li><a href="/angularjs/components.html" class="sidebar-link">Components</a></li><li><a href="/angularjs/built-in-directives.html" class="sidebar-link">Built-in directives</a></li><li><a href="/angularjs/use-of-in-built-directives.html" class="sidebar-link">Use of in-built directives</a></li><li><a href="/angularjs/custom-directives.html" class="sidebar-link">Custom Directives</a></li><li><a href="/angularjs/how-data-binding-works.html" class="sidebar-link">How data binding works</a></li><li><a href="/angularjs/angular-project-directory-structure.html" class="sidebar-link">Angular Project - Directory Structure</a></li><li><a href="/angularjs/filters.html" class="sidebar-link">Filters</a></li><li><a href="/angularjs/custom-filters.html" class="sidebar-link">Custom filters</a></li><li><a href="/angularjs/constants.html" class="sidebar-link">Constants</a></li><li><a href="/angularjs/custom-filters-with-es6.html" class="sidebar-link">Custom filters with ES6</a></li><li><a href="/angularjs/directives-using-ngmodelcontroller.html" class="sidebar-link">Directives using ngModelController</a></li><li><a href="/angularjs/controllers.html" class="sidebar-link">Controllers</a></li><li><a href="/angularjs/controllers-with-es6.html" class="sidebar-link">Controllers with ES6</a></li><li><a href="/angularjs/the-self-or-this-variable-in-a-controller.html" class="sidebar-link">The Self Or This Variable In A Controller</a></li><li><a href="/angularjs/services.html" class="sidebar-link">Services</a></li><li><a href="/angularjs/distinguishing-service-vs-factory.html" class="sidebar-link">Distinguishing Service vs Factory</a></li><li><a href="/angularjs/angular-promises-with-q-service.html" class="active sidebar-link">Angular promises with $q service</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/angularjs/angular-promises-with-q-service.html#wrap-simple-value-into-a-promise-using-q-when" class="sidebar-link">Wrap simple value into a promise using $q.when()</a></li><li class="sidebar-sub-header"><a href="/angularjs/angular-promises-with-q-service.html#using-angular-promises-with-q-service" class="sidebar-link">Using angular promises with $q service</a></li><li class="sidebar-sub-header"><a href="/angularjs/angular-promises-with-q-service.html#using-the-q-constructor-to-create-promises" class="sidebar-link">Using the $q constructor to create promises</a></li><li class="sidebar-sub-header"><a href="/angularjs/angular-promises-with-q-service.html#using-q-all-to-handle-multiple-promises" class="sidebar-link">Using $q.all to handle multiple promises</a></li><li class="sidebar-sub-header"><a href="/angularjs/angular-promises-with-q-service.html#avoid-the-q-deferred-anti-pattern" class="sidebar-link">Avoid the $q Deferred Anti-Pattern</a></li><li class="sidebar-sub-header"><a href="/angularjs/angular-promises-with-q-service.html#deferring-operations-using-q-defer" class="sidebar-link">Deferring operations using $q.defer</a></li></ul></li><li><a href="/angularjs/dependency-injection.html" class="sidebar-link">Dependency Injection</a></li><li><a href="/angularjs/events.html" class="sidebar-link">Events</a></li><li><a href="/angularjs/sharing-data.html" class="sidebar-link">Sharing Data</a></li><li><a href="/angularjs/form-validation.html" class="sidebar-link">Form Validation</a></li><li><a href="/angularjs/routing-using-ngroute.html" class="sidebar-link">Routing using ngRoute</a></li><li><a href="/angularjs/ng-class-directive.html" class="sidebar-link">ng-class directive</a></li><li><a href="/angularjs/ng-repeat.html" class="sidebar-link">ng-repeat</a></li><li><a href="/angularjs/ng-style.html" class="sidebar-link">ng-style</a></li><li><a href="/angularjs/ng-view.html" class="sidebar-link">ng-view</a></li><li><a href="/angularjs/angularjs-bindings-options-etc.html" class="sidebar-link">AngularJS bindings options (=, @, &amp; etc.)</a></li><li><a href="/angularjs/providers.html" class="sidebar-link">Providers</a></li><li><a href="/angularjs/decorators.html" class="sidebar-link">Decorators</a></li><li><a href="/angularjs/print.html" class="sidebar-link">Print</a></li><li><a href="/angularjs/ui-router.html" class="sidebar-link">ui-router</a></li><li><a href="/angularjs/built-in-helper-functions.html" class="sidebar-link">Built-in helper Functions</a></li><li><a href="/angularjs/digest-loop-walkthrough.html" class="sidebar-link">digest loop walkthrough</a></li><li><a href="/angularjs/angular-scopes.html" class="sidebar-link">Angular $scopes</a></li><li><a href="/angularjs/using-angularjs-with-typescript.html" class="sidebar-link">Using AngularJS with TypeScript</a></li><li><a href="/angularjs/http-request.html" class="sidebar-link">$http request</a></li><li><a href="/angularjs/prepare-for-production-grunt.html" class="sidebar-link">Prepare for Production - Grunt</a></li><li><a href="/angularjs/grunt-tasks.html" class="sidebar-link">Grunt tasks</a></li><li><a href="/angularjs/lazy-loading.html" class="sidebar-link">Lazy loading</a></li><li><a href="/angularjs/http-interceptor.html" class="sidebar-link">HTTP Interceptor</a></li><li><a href="/angularjs/session-storage.html" class="sidebar-link">Session storage</a></li><li><a href="/angularjs/angular-mvc.html" class="sidebar-link">Angular MVC</a></li><li><a href="/angularjs/signalr-with-angularjs.html" class="sidebar-link">SignalR with AngularJs</a></li><li><a href="/angularjs/migration-to-angular-2.html" class="sidebar-link">Migration to Angular 2+</a></li><li><a href="/angularjs/angularjs-with-data-filter-pagination-etc.html" class="sidebar-link">angularjs with data filter, pagination etc</a></li><li><a href="/angularjs/profiling-and-performance.html" class="sidebar-link">Profiling and Performance</a></li><li><a href="/angularjs/performance-profiling.html" class="sidebar-link">Performance Profiling</a></li><li><a href="/angularjs/debugging.html" class="sidebar-link">Debugging</a></li><li><a href="/angularjs/unit-tests.html" class="sidebar-link">Unit tests</a></li><li><a href="/angularjs/angularjs-gotchas-and-traps.html" class="sidebar-link">AngularJS gotchas and traps</a></li><li><a href="/angularjs/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="angular-promises-with-q-service"><a href="#angular-promises-with-q-service" class="header-anchor">#</a> Angular promises with $q service</h1> <h2 id="wrap-simple-value-into-a-promise-using-q-when"><a href="#wrap-simple-value-into-a-promise-using-q-when" class="header-anchor">#</a> Wrap simple value into a promise using $q.when()</h2> <p>If all you need is to wrap the value into a promise, you don't need to use the long syntax like here:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//OVERLY VERBOSE</span>
<span class="token keyword">var</span> defer<span class="token punctuation">;</span>
defer <span class="token operator">=</span> $q<span class="token punctuation">.</span><span class="token function">defer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
defer<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> defer<span class="token punctuation">.</span>promise<span class="token punctuation">;</span>

</code></pre></div><p>In this case you can just write:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//BETTER</span>
<span class="token keyword">return</span> $q<span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><blockquote></blockquote> <h3>$q.when and its alias $q.resolve</h3>
Wraps an object that might be a value or a (3rd party) then-able promise into a $q promise. This is useful when you are dealing with an object that might or might not be a promise, or if the promise comes from a source that can't be trusted.
[— AngularJS $q Service API Reference - $q.when](https://docs.angularjs.org/api/ng/service/$q#when)
<p>With the release of AngularJS v1.4.1</p> <p>You can also use an ES6-consistent alias <code>resolve</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//ABSOLUTELY THE SAME AS when</span>
<span class="token keyword">return</span> $q<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

</code></pre></div><h2 id="using-angular-promises-with-q-service"><a href="#using-angular-promises-with-q-service" class="header-anchor">#</a> Using angular promises with $q service</h2> <p><code>$q</code> is a  built-in service which helps in executing asynchronous functions and using their return values(or exception) when they are finished with processing.</p> <p><code>$q</code> is integrated with the <code>$rootScope.Scope</code> model observation mechanism, which means faster propagation of resolution or rejection into your models and avoiding unnecessary browser repaints, which would result in flickering UI.</p> <p>In our example, we call our factory <code>getMyData</code>, which return a promise object. If the object is <code>resolved</code>, it returns a random number. If it is <code>rejected</code>, it return a rejection with an error message after 2 seconds.</p> <p>In Angular factory</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getMyData</span><span class="token punctuation">(</span><span class="token parameter">$timeout<span class="token punctuation">,</span> $q</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// simulated async function</span>
    <span class="token keyword">var</span> promise <span class="token operator">=</span> <span class="token function">$timeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">'data received!'</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> $q<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'oh no an error! try again'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> promise<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="using-promises-on-call"><a href="#using-promises-on-call" class="header-anchor">#</a> Using Promises on call</h3> <div class="language-js extra-class"><pre class="language-js"><code>angular<span class="token punctuation">.</span><span class="token function">module</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">factory</span><span class="token punctuation">(</span><span class="token string">'getMyData'</span><span class="token punctuation">,</span> getMyData<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">getData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> promise <span class="token operator">=</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Finished at:'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><p>To use promises, inject <code>$q</code> as dependency. Here we injected <code>$q</code> in <code>getMyData</code> factory.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> defer <span class="token operator">=</span> $q<span class="token punctuation">.</span><span class="token function">defer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>A new instance of deferred is constructed by calling <code>$q.defer()</code></p> <p>A deferred object is simply an object that exposes a promise as well as the associated methods for resolving that promise. It is constructed using the <code>$q.deferred()</code> function and exposes three main methods: <code>resolve()</code>, <code>reject()</code>, and <code>notify()</code>.</p> <ul><li><code>resolve(value)</code> – resolves the derived promise with the value.</li> <li><code>reject(reason)</code> – rejects the derived promise with the reason.</li> <li><code>notify(value)</code> - provides updates on the status of the promise's execution. This may be called multiple times before the promise is either resolved or rejected.</li></ul> <h3 id="properties"><a href="#properties" class="header-anchor">#</a> Properties</h3> <p>The associated promise object is accessed via the promise property.
<code>promise</code> – {Promise} – promise object associated with this deferred.</p> <p>A new promise instance is created when a deferred instance is created and can be retrieved by calling <code>deferred.promise</code>.</p> <p>The purpose of the <code>promise</code> object is to allow for interested parties to get access to the result of the deferred task when it completes.</p> <p>Promise Methods -</p> <li>
`then(successCallback, [errorCallback], [notifyCallback])` – Regardless of when the promise was or will be resolved or rejected, then calls one of the success or error callbacks asynchronously as soon as the result is available. The callbacks are called with a single argument: the result or rejection reason. Additionally, the notify callback may be called zero or more times to provide a progress indication, before the promise is resolved or rejected.
</li> <li>
`catch(errorCallback)` – shorthand for promise.then(null, errorCallback)
</li> <li>
`finally(callback, notifyCallback)` – allows you to observe either the fulfillment or rejection of a promise, but to do so without modifying the final value.
</li> <p>One of the most powerful features of promises is the ability to chain them together. This allows the data to flow through the chain and be manipulated and mutated at each step. This is demonstrated with the following example:</p> <p><strong>Example 1:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Creates a promise that when resolved, returns 4.</span>
<span class="token keyword">function</span> <span class="token function">getNumbers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">var</span> promise <span class="token operator">=</span> <span class="token function">$timeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">4</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Resolve getNumbers() and chain subsequent then() calls to decrement</span>
<span class="token comment">// initial number from 4 to 0 and then output a string.</span>
<span class="token function">getNumbers</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 4</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token operator">--</span>num<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 3</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token operator">--</span>num<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 2</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token operator">--</span>num<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 1</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token operator">--</span>num<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 0</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token string">'And we are done!'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// &quot;And we are done!&quot;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>        
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="using-the-q-constructor-to-create-promises"><a href="#using-the-q-constructor-to-create-promises" class="header-anchor">#</a> Using the $q constructor to create promises</h2> <p>The <code>$q</code> constructor function is used to create promises from asynchronous APIs that use callbacks to return results.</p> <blockquote></blockquote> <p>$q(function(resolve, reject) {...})</p> <p>The constructor function receives a function that is invoked with two arguments, <code>resolve</code> and <code>reject</code> that are functions which are used to either resolve or reject the promise.</p> <p><strong>Example 1:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">$timeout</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> delay</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">=</span> <span class="token function">$q</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">try</span> <span class="token punctuation">{</span>
                 <span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                 <span class="token function">resolve</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span> 
              <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                 <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
         <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
    

</code></pre></div><p>The above example creates a promise from the <a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowTimers/setTimeout" target="_blank" rel="noopener noreferrer">WindowTimers.setTimeout API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. The AngularJS framework provides a more elaborate version of this function. For usage, see the <a href="https://docs.angularjs.org/api/ng/service/$timeout" target="_blank" rel="noopener noreferrer">AngularJS $timeout Service API Reference<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p><strong>Example 2:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>$scope<span class="token punctuation">.</span><span class="token function-variable function">divide</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">$q</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>b<span class="token operator">===</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&quot;Cannot devide by 0&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span>a<span class="token operator">/</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>The above code showing a promisified division function, it will return a promise with the result or reject with a reason if the calculation is impossible.</p> <p>You can then call and use <code>.then</code></p> <div class="language-js extra-class"><pre class="language-js"><code>$scope<span class="token punctuation">.</span><span class="token function">divide</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// will return 3.5</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// will not run</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

$scope<span class="token punctuation">.</span><span class="token function">divide</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// will not run as the calculation will fail on a divide by 0</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// will return the error string.</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><h2 id="using-q-all-to-handle-multiple-promises"><a href="#using-q-all-to-handle-multiple-promises" class="header-anchor">#</a> Using $q.all to handle multiple promises</h2> <p>You can use the <code>$q.all</code> function to call a <code>.then</code> method after an array of promises has been successfully resolved and fetch the data they resolved with.</p> <p>Example:</p> <p><strong>JS:</strong></p> <div class="language- extra-class"><pre class="language-text"><code>
$scope.data = []

 $q.all([
    $http.get(&quot;data.json&quot;),
    $http.get(&quot;more-data.json&quot;),
    ]).then(function(responses) {
      $scope.data = responses.map((resp) =&gt; resp.data);
    });

</code></pre></div><p>The above code runs <code>$http.get</code> 2 times for data in local json files, when both <code>get</code> method complete they resolve their associated promises, when all the promises in the array are resolved, the <code>.then</code> method starts with both promises data inside the <code>responses</code> array argument.</p> <p>The data is then mapped so it could be shown on the template, we can then show</p> <p><strong>HTML:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span>
   <span class="token operator">&lt;</span>li ng<span class="token operator">-</span>repeat<span class="token operator">=</span><span class="token string">&quot;d in data&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span>
         <span class="token operator">&lt;</span>li ng<span class="token operator">-</span>repeat<span class="token operator">=</span><span class="token string">&quot;item in d&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">{</span> <span class="token punctuation">{</span>item<span class="token punctuation">.</span>name<span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token punctuation">{</span>item<span class="token punctuation">.</span>occupation<span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
   <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>

</code></pre></div><p><strong>JSON:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">[</span><span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;alice&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;occupation&quot;</span><span class="token operator">:</span> <span class="token string">&quot;manager&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bob&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;occupation&quot;</span><span class="token operator">:</span> <span class="token string">&quot;developer&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>

</code></pre></div><h2 id="avoid-the-q-deferred-anti-pattern"><a href="#avoid-the-q-deferred-anti-pattern" class="header-anchor">#</a> Avoid the $q Deferred Anti-Pattern</h2> <blockquote></blockquote> <h3>Avoid this Anti-Pattern</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> myDeferred <span class="token operator">=</span> $q<span class="token punctuation">.</span><span class="token function">defer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">$http</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
   myDeferred<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   myDeferred<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> myDeferred<span class="token punctuation">.</span>promise<span class="token punctuation">;</span>

</code></pre></div><p>There is no need to manufacture a promise with <code>$q.defer</code> as the $http service already returns a promise.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//INSTEAD</span>
<span class="token keyword">return</span> <span class="token function">$http</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>Simply return the promise created by the $http service.</p> <h2 id="deferring-operations-using-q-defer"><a href="#deferring-operations-using-q-defer" class="header-anchor">#</a> Deferring operations using $q.defer</h2> <p>We can use <code>$q</code> to defer operations to the future while having a pending promise object at the present, by using <code>$q.defer</code> we create a promise that will either resolve or reject in the future.</p> <p>This method is not equivalent of using the <code>$q</code> constructor, as we use <code>$q.defer</code> to promisify an existing routine that may or may not return (or had ever returned) a promise at all.</p> <p><strong>Example:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">runAnimation</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">animation<span class="token punctuation">,</span> duration</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> deferred <span class="token operator">=</span> $q<span class="token punctuation">.</span><span class="token function">defer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>
        <span class="token comment">// run some animation for a given duration</span>
        deferred<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;done&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// in case of error we would want to run the error hander of .then</span>
        deferred<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> deferred<span class="token punctuation">.</span>promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// and then</span>
runAnimation<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">status</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>


</code></pre></div><li>
Be sure you always return a the `deferred.promise` object or risk an error when invoking `.then`
</li> <li>
Make sure you always resolve or reject your deferred object or `.then` may not run and you risk a memory leak
</li></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/angularjs/angular-promises-with-q-service.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/angularjs/distinguishing-service-vs-factory.html" class="prev">
        Distinguishing Service vs Factory
      </a></span> <span class="next"><a href="/angularjs/dependency-injection.html">
        Dependency Injection
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.ced448ab.js" defer></script><script src="/assets/js/3.f1d73125.js" defer></script><script src="/assets/js/418.57b9f717.js" defer></script>
  </body>
</html>
