<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Microsoft SQL Server - GROUP BY</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Simple Grouping, GROUP BY multiple columns , GROUP BY with ROLLUP and CUBE, Group by with multiple tables, multiple columns, HAVING">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="Microsoft SQL Server - GROUP BY">
    <meta property="og:description" content="Simple Grouping, GROUP BY multiple columns , GROUP BY with ROLLUP and CUBE, Group by with multiple tables, multiple columns, HAVING">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/mssql/group-by.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="Microsoft SQL Server - GROUP BY">
    <meta name="twitter:description" content="Simple Grouping, GROUP BY multiple columns , GROUP BY with ROLLUP and CUBE, Group by with multiple tables, multiple columns, HAVING">
    <meta name="twitter:url" content="/mssql/group-by.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    <link rel="preload" href="/assets/css/0.styles.8b877eb8.css" as="style"><link rel="preload" href="/assets/js/app.ced448ab.js" as="script"><link rel="preload" href="/assets/js/3.f1d73125.js" as="script"><link rel="preload" href="/assets/js/2010.f0d63b51.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.8b877eb8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>MS SQL Server</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mssql/" class="sidebar-link">Disclaimer</a></li><li><a href="/mssql/getting-started-with-microsoft-sql-server.html" class="sidebar-link">Getting started with Microsoft SQL Server</a></li><li><a href="/mssql/data-types.html" class="sidebar-link">Data Types</a></li><li><a href="/mssql/converting-data-types.html" class="sidebar-link">Converting data types</a></li><li><a href="/mssql/user-defined-table-types.html" class="sidebar-link">User Defined Table Types</a></li><li><a href="/mssql/select-statement.html" class="sidebar-link">SELECT statement</a></li><li><a href="/mssql/alias-names-in-sql-server.html" class="sidebar-link">Alias Names in Sql Server</a></li><li><a href="/mssql/nulls.html" class="sidebar-link">NULLs</a></li><li><a href="/mssql/variables.html" class="sidebar-link">Variables</a></li><li><a href="/mssql/dates.html" class="sidebar-link">Dates</a></li><li><a href="/mssql/generating-a-range-of-dates.html" class="sidebar-link">Generating a range of dates</a></li><li><a href="/mssql/database-snapshots.html" class="sidebar-link">Database Snapshots</a></li><li><a href="/mssql/coalesce.html" class="sidebar-link">COALESCE</a></li><li><a href="/mssql/if-else.html" class="sidebar-link">IF...ELSE</a></li><li><a href="/mssql/case-statement.html" class="sidebar-link">CASE Statement</a></li><li><a href="/mssql/insert-into.html" class="sidebar-link">INSERT INTO</a></li><li><a href="/mssql/drop-keyword.html" class="sidebar-link">Drop Keyword</a></li><li><a href="/mssql/merge.html" class="sidebar-link">MERGE</a></li><li><a href="/mssql/create-view.html" class="sidebar-link">CREATE VIEW</a></li><li><a href="/mssql/views.html" class="sidebar-link">Views</a></li><li><a href="/mssql/union.html" class="sidebar-link">UNION</a></li><li><a href="/mssql/try-catch.html" class="sidebar-link">TRY/CATCH</a></li><li><a href="/mssql/while-loop.html" class="sidebar-link">WHILE loop</a></li><li><a href="/mssql/over-clause.html" class="sidebar-link">OVER Clause</a></li><li><a href="/mssql/group-by.html" class="active sidebar-link">GROUP BY</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mssql/group-by.html#simple-grouping" class="sidebar-link">Simple Grouping</a></li><li class="sidebar-sub-header"><a href="/mssql/group-by.html#group-by-multiple-columns" class="sidebar-link">GROUP BY multiple columns</a></li><li class="sidebar-sub-header"><a href="/mssql/group-by.html#group-by-with-rollup-and-cube" class="sidebar-link">GROUP BY with ROLLUP and CUBE</a></li><li class="sidebar-sub-header"><a href="/mssql/group-by.html#group-by-with-multiple-tables-multiple-columns" class="sidebar-link">Group by with multiple tables, multiple columns</a></li><li class="sidebar-sub-header"><a href="/mssql/group-by.html#having" class="sidebar-link">HAVING</a></li></ul></li><li><a href="/mssql/order-by.html" class="sidebar-link">ORDER BY</a></li><li><a href="/mssql/the-stuff-function.html" class="sidebar-link">The STUFF Function</a></li><li><a href="/mssql/json-in-sql-server.html" class="sidebar-link">JSON in Sql Server</a></li><li><a href="/mssql/openjson.html" class="sidebar-link">OPENJSON</a></li><li><a href="/mssql/for-json.html" class="sidebar-link">FOR JSON</a></li><li><a href="/mssql/queries-with-json-data.html" class="sidebar-link">Queries with JSON data</a></li><li><a href="/mssql/storing-json-in-sql-tables.html" class="sidebar-link">Storing JSON in SQL tables</a></li><li><a href="/mssql/modify-json-text.html" class="sidebar-link">Modify JSON text</a></li><li><a href="/mssql/for-xml-path.html" class="sidebar-link">FOR XML PATH</a></li><li><a href="/mssql/join.html" class="sidebar-link">Join</a></li><li><a href="/mssql/cross-apply.html" class="sidebar-link">cross apply</a></li><li><a href="/mssql/computed-columns.html" class="sidebar-link">Computed Columns</a></li><li><a href="/mssql/common-table-expressions.html" class="sidebar-link">Common Table Expressions</a></li><li><a href="/mssql/move-and-copy-data-around-tables.html" class="sidebar-link">Move and copy data around tables</a></li><li><a href="/mssql/limit-result-set.html" class="sidebar-link">Limit Result Set</a></li><li><a href="/mssql/retrieve-information-about-your-instance.html" class="sidebar-link">Retrieve Information about your Instance</a></li><li><a href="/mssql/with-ties-option.html" class="sidebar-link">With Ties Option</a></li><li><a href="/mssql/string-functions.html" class="sidebar-link">String Functions</a></li><li><a href="/mssql/logical-functions.html" class="sidebar-link">Logical Functions</a></li><li><a href="/mssql/aggregate-functions.html" class="sidebar-link">Aggregate Functions</a></li><li><a href="/mssql/string-aggregate-functions-in-sql-server.html" class="sidebar-link">String Aggregate functions in SQL Server</a></li><li><a href="/mssql/ranking-functions.html" class="sidebar-link">Ranking Functions</a></li><li><a href="/mssql/window-functions.html" class="sidebar-link">Window functions</a></li><li><a href="/mssql/pivot-unpivot.html" class="sidebar-link">PIVOT / UNPIVOT</a></li><li><a href="/mssql/dynamic-sql-pivot.html" class="sidebar-link">Dynamic SQL Pivot</a></li><li><a href="/mssql/partitioning.html" class="sidebar-link">Partitioning</a></li><li><a href="/mssql/stored-procedures.html" class="sidebar-link">Stored Procedures</a></li><li><a href="/mssql/retrieve-information-about-the-database.html" class="sidebar-link">Retrieve information about the database</a></li><li><a href="/mssql/split-string-function-in-sql-server.html" class="sidebar-link">Split String function in Sql Server</a></li><li><a href="/mssql/insert.html" class="sidebar-link">Insert</a></li><li><a href="/mssql/primary-keys.html" class="sidebar-link">Primary Keys</a></li><li><a href="/mssql/foreign-keys.html" class="sidebar-link">Foreign Keys</a></li><li><a href="/mssql/last-inserted-identity.html" class="sidebar-link">Last Inserted Identity</a></li><li><a href="/mssql/scope-identity.html" class="sidebar-link">SCOPE_IDENTITY()</a></li><li><a href="/mssql/sequences.html" class="sidebar-link">Sequences</a></li><li><a href="/mssql/indexing.html" class="sidebar-link">Indexing</a></li><li><a href="/mssql/full-text-indexing.html" class="sidebar-link">Full-Text Indexing</a></li><li><a href="/mssql/trigger.html" class="sidebar-link">Trigger</a></li><li><a href="/mssql/cursors.html" class="sidebar-link">Cursors</a></li><li><a href="/mssql/transaction-isolation-levels.html" class="sidebar-link">Transaction isolation levels</a></li><li><a href="/mssql/advanced-options.html" class="sidebar-link">Advanced options</a></li><li><a href="/mssql/migration.html" class="sidebar-link">Migration</a></li><li><a href="/mssql/table-valued-parameters.html" class="sidebar-link">Table Valued Parameters</a></li><li><a href="/mssql/dbmail.html" class="sidebar-link">DBMAIL</a></li><li><a href="/mssql/in-memory-oltp-hekaton.html" class="sidebar-link">In-Memory OLTP (Hekaton)</a></li><li><a href="/mssql/temporal-tables.html" class="sidebar-link">Temporal Tables</a></li><li><a href="/mssql/use-of-temp-table.html" class="sidebar-link">Use of TEMP Table</a></li><li><a href="/mssql/scheduled-task-or-job.html" class="sidebar-link">Scheduled Task or Job</a></li><li><a href="/mssql/isolation-levels-and-locking.html" class="sidebar-link">Isolation levels and locking</a></li><li><a href="/mssql/sorting-ordering-rows.html" class="sidebar-link">Sorting/ordering rows</a></li><li><a href="/mssql/privileges-or-permissions.html" class="sidebar-link">Privileges or Permissions</a></li><li><a href="/mssql/sqlcmd.html" class="sidebar-link">SQLCMD</a></li><li><a href="/mssql/resource-governor.html" class="sidebar-link">Resource Governor</a></li><li><a href="/mssql/file-group.html" class="sidebar-link">File Group</a></li><li><a href="/mssql/basic-ddl-operations-in-ms-sql-server.html" class="sidebar-link">Basic DDL Operations in MS SQL Server</a></li><li><a href="/mssql/subqueries.html" class="sidebar-link">Subqueries</a></li><li><a href="/mssql/pagination.html" class="sidebar-link">Pagination</a></li><li><a href="/mssql/clustered-columnstore.html" class="sidebar-link">CLUSTERED COLUMNSTORE</a></li><li><a href="/mssql/parsename.html" class="sidebar-link">Parsename</a></li><li><a href="/mssql/installing-sql-server-on-windows.html" class="sidebar-link">Installing SQL Server on Windows</a></li><li><a href="/mssql/analyzing-a-query.html" class="sidebar-link">Analyzing a Query</a></li><li><a href="/mssql/query-hints.html" class="sidebar-link">Query Hints</a></li><li><a href="/mssql/query-store.html" class="sidebar-link">Query Store</a></li><li><a href="/mssql/querying-results-by-page.html" class="sidebar-link">Querying results by page</a></li><li><a href="/mssql/schemas.html" class="sidebar-link">Schemas</a></li><li><a href="/mssql/backup-and-restore-database.html" class="sidebar-link">Backup and Restore Database</a></li><li><a href="/mssql/transaction-handling.html" class="sidebar-link">Transaction handling</a></li><li><a href="/mssql/natively-compiled-modules-hekaton.html" class="sidebar-link">Natively compiled modules (Hekaton)</a></li><li><a href="/mssql/spatial-data.html" class="sidebar-link">Spatial Data</a></li><li><a href="/mssql/dynamic-sql.html" class="sidebar-link">Dynamic SQL</a></li><li><a href="/mssql/dynamic-data-masking.html" class="sidebar-link">Dynamic data masking</a></li><li><a href="/mssql/export-data-in-txt-file-by-using-sqlcmd.html" class="sidebar-link">Export data in txt file by using SQLCMD</a></li><li><a href="/mssql/common-language-runtime-integration.html" class="sidebar-link">Common Language Runtime Integration</a></li><li><a href="/mssql/delimiting-special-characters-and-reserved-words.html" class="sidebar-link">Delimiting special characters and reserved words</a></li><li><a href="/mssql/dbcc.html" class="sidebar-link">DBCC</a></li><li><a href="/mssql/bulk-import.html" class="sidebar-link">BULK Import</a></li><li><a href="/mssql/service-broker.html" class="sidebar-link">Service broker</a></li><li><a href="/mssql/permissions-and-security.html" class="sidebar-link">Permissions and Security</a></li><li><a href="/mssql/database-permissions.html" class="sidebar-link">Database permissions</a></li><li><a href="/mssql/row-level-security.html" class="sidebar-link">Row-level security</a></li><li><a href="/mssql/encryption.html" class="sidebar-link">Encryption</a></li><li><a href="/mssql/phantom-read.html" class="sidebar-link">PHANTOM read</a></li><li><a href="/mssql/filestream.html" class="sidebar-link">Filestream</a></li><li><a href="/mssql/bcp-bulk-copy-program-utility.html" class="sidebar-link">bcp (bulk copy program) Utility</a></li><li><a href="/mssql/sql-server-evolution-through-different-versions-2000-2016.html" class="sidebar-link">SQL Server Evolution through different versions (2000 - 2016)</a></li><li><a href="/mssql/sql-server-management-studio-ssms.html" class="sidebar-link">SQL Server Management Studio (SSMS)</a></li><li><a href="/mssql/managing-azure-sql-database.html" class="sidebar-link">Managing Azure SQL Database</a></li><li><a href="/mssql/system-database-tempdb.html" class="sidebar-link">System database - TempDb</a></li><li><a href="/mssql/microsoft-sql-server-management-studio-shortcut-keys.html" class="sidebar-link">Microsoft SQL Server Management Studio Shortcut Keys</a></li><li><a href="/mssql/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="group-by"><a href="#group-by" class="header-anchor">#</a> GROUP BY</h1> <h2 id="simple-grouping"><a href="#simple-grouping" class="header-anchor">#</a> Simple Grouping</h2> <p>Orders Table</p> <table><thead><tr><th>CustomerId</th> <th>ProductId</th> <th>Quantity</th> <th>Price</th></tr></thead> <tbody><tr><td>1</td> <td>2</td> <td>5</td> <td>100</td></tr> <tr><td>1</td> <td>3</td> <td>2</td> <td>200</td></tr> <tr><td>1</td> <td>4</td> <td>1</td> <td>500</td></tr> <tr><td>2</td> <td>1</td> <td>4</td> <td>50</td></tr> <tr><td>3</td> <td>5</td> <td>6</td> <td>700</td></tr></tbody></table> <p>When grouping by a specific column, only unique values of this column are returned.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> customerId
<span class="token keyword">FROM</span> orders
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> customerId<span class="token punctuation">;</span>

</code></pre></div><p>Return value:</p> <table><thead><tr><th>customerId</th></tr></thead> <tbody><tr><td>1</td></tr> <tr><td>2</td></tr> <tr><td>3</td></tr></tbody></table> <p>Aggregate functions like <code>count()</code> apply to each group and not to the complete table:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> customerId<span class="token punctuation">,</span> 
       <span class="token function">COUNT</span><span class="token punctuation">(</span>productId<span class="token punctuation">)</span> <span class="token keyword">as</span> numberOfProducts<span class="token punctuation">,</span>
       <span class="token function">sum</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token keyword">as</span> totalPrice
<span class="token keyword">FROM</span> orders
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> customerId<span class="token punctuation">;</span>

</code></pre></div><p>Return value:</p> <table><thead><tr><th>customerId</th> <th>numberOfProducts</th> <th>totalPrice</th></tr></thead> <tbody><tr><td>1</td> <td>3</td> <td>800</td></tr> <tr><td>2</td> <td>1</td> <td>50</td></tr> <tr><td>3</td> <td>1</td> <td>700</td></tr></tbody></table> <h2 id="group-by-multiple-columns"><a href="#group-by-multiple-columns" class="header-anchor">#</a> GROUP BY multiple columns</h2> <p>One might want to GROUP BY more than one column</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">declare</span> <span class="token variable">@temp</span> <span class="token keyword">table</span><span class="token punctuation">(</span>age <span class="token keyword">int</span><span class="token punctuation">,</span> name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> <span class="token variable">@temp</span>
<span class="token keyword">select</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token string">'matt'</span> <span class="token keyword">union</span> <span class="token keyword">all</span>
<span class="token keyword">select</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token string">'matt'</span> <span class="token keyword">union</span> <span class="token keyword">all</span>
<span class="token keyword">select</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token string">'matt'</span> <span class="token keyword">union</span> <span class="token keyword">all</span>
<span class="token keyword">select</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token string">'luke'</span> <span class="token keyword">union</span> <span class="token keyword">all</span>
<span class="token keyword">select</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token string">'luke'</span> <span class="token keyword">union</span> <span class="token keyword">all</span>
<span class="token keyword">select</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token string">'luke'</span> <span class="token keyword">union</span> <span class="token keyword">all</span>
<span class="token keyword">select</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token string">'luke'</span> <span class="token keyword">union</span> <span class="token keyword">all</span>
<span class="token keyword">select</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token string">'luke'</span>

<span class="token keyword">SELECT</span> Age<span class="token punctuation">,</span> Name<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> count
<span class="token keyword">FROM</span> <span class="token variable">@temp</span> 
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> Age<span class="token punctuation">,</span> Name

</code></pre></div><p>will group by both age and name and will produce:</p> <table><thead><tr><th>Age</th> <th>Name</th> <th>count</th></tr></thead> <tbody><tr><td>18</td> <td>luke</td> <td>3</td></tr> <tr><td>21</td> <td>luke</td> <td>2</td></tr> <tr><td>18</td> <td>matt</td> <td>1</td></tr> <tr><td>21</td> <td>matt</td> <td>2</td></tr></tbody></table> <h2 id="group-by-with-rollup-and-cube"><a href="#group-by-with-rollup-and-cube" class="header-anchor">#</a> GROUP BY with ROLLUP and CUBE</h2> <p>The ROLLUP operator is useful in generating reports that contain subtotals and totals.</p> <li>
CUBE generates a result set that shows aggregates for all combinations of values in the selected columns.
</li> <li>
ROLLUP generates a result set that shows aggregates for a hierarchy of values in the selected columns.
<table><thead>|Item|Color|Quantity
</thead><tbody>|Table|Blue|124
|Table|Red|223
|Chair|Blue|101
|Chair|Red|210
</tbody></table></li> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> <span class="token punctuation">(</span>GROUPING<span class="token punctuation">(</span>Item<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">THEN</span> <span class="token string">'ALL'</span>
            <span class="token keyword">ELSE</span> ISNULL<span class="token punctuation">(</span>Item<span class="token punctuation">,</span> <span class="token string">'UNKNOWN'</span><span class="token punctuation">)</span>
       <span class="token keyword">END</span> <span class="token keyword">AS</span> Item<span class="token punctuation">,</span>
       <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> <span class="token punctuation">(</span>GROUPING<span class="token punctuation">(</span>Color<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">THEN</span> <span class="token string">'ALL'</span>
            <span class="token keyword">ELSE</span> ISNULL<span class="token punctuation">(</span>Color<span class="token punctuation">,</span> <span class="token string">'UNKNOWN'</span><span class="token punctuation">)</span>
       <span class="token keyword">END</span> <span class="token keyword">AS</span> Color<span class="token punctuation">,</span>
       <span class="token function">SUM</span><span class="token punctuation">(</span>Quantity<span class="token punctuation">)</span> <span class="token keyword">AS</span> QtySum
<span class="token keyword">FROM</span> Inventory
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> Item<span class="token punctuation">,</span> Color <span class="token keyword">WITH ROLLUP</span>

Item                 Color                QtySum                     
<span class="token comment">-------------------- -------------------- -------------------------- </span>
Chair                Blue                 <span class="token number">101.00</span>                     
Chair                Red                  <span class="token number">210.00</span>                     
Chair                <span class="token keyword">ALL</span>                  <span class="token number">311.00</span>                     
<span class="token keyword">Table</span>                Blue                 <span class="token number">124.00</span>                     
<span class="token keyword">Table</span>                Red                  <span class="token number">223.00</span>                     
<span class="token keyword">Table</span>                <span class="token keyword">ALL</span>                  <span class="token number">347.00</span>                     
<span class="token keyword">ALL</span>                  <span class="token keyword">ALL</span>                  <span class="token number">658.00</span> 

</code></pre></div><p>(7 row(s) affected)</p> <p>If the ROLLUP keyword in the query is changed to CUBE, the CUBE result set is the same, except these two additional rows are returned at the end:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">ALL</span>                  Blue                 <span class="token number">225.00</span>                     
<span class="token keyword">ALL</span>                  Red                  <span class="token number">433.00</span> 

</code></pre></div><p><a href="https://technet.microsoft.com/en-us/library/ms189305(v=sql.90).aspx" target="_blank" rel="noopener noreferrer">https://technet.microsoft.com/en-us/library/ms189305(v=sql.90).aspx<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="group-by-with-multiple-tables-multiple-columns"><a href="#group-by-with-multiple-tables-multiple-columns" class="header-anchor">#</a> Group by with multiple tables, multiple columns</h2> <p>Group by is often used with join statement. Let's assume we have two tables. The first one is the table of students:</p> <table><thead><tr><th>Id</th> <th>Full Name</th> <th>Age</th></tr></thead> <tbody><tr><td>1</td> <td>Matt Jones</td> <td>20</td></tr> <tr><td>2</td> <td>Frank Blue</td> <td>21</td></tr> <tr><td>3</td> <td>Anthony Angel</td> <td>18</td></tr></tbody></table> <p>Second table is the table of subject each student can take:</p> <table><thead><tr><th>Subject_Id</th> <th>Subject</th></tr></thead> <tbody><tr><td>1</td> <td>Maths</td></tr> <tr><td>2</td> <td>P.E.</td></tr> <tr><td>3</td> <td>Physics</td></tr></tbody></table> <p>And because one student can attend many subjects and one subject can be attended by many students (therefore N:N relationship) we need to have third &quot;bounding&quot; table. Let's call the table Students_subjects:</p> <table><thead><tr><th>Subject_Id</th> <th>Student_Id</th></tr></thead> <tbody><tr><td>1</td> <td>1</td></tr> <tr><td>2</td> <td>2</td></tr> <tr><td>2</td> <td>1</td></tr> <tr><td>3</td> <td>2</td></tr> <tr><td>1</td> <td>3</td></tr> <tr><td>1</td> <td>1</td></tr></tbody></table> <p>Now lets say we want to know the number of subjects each student is attending. Here the standalone <code>GROUP BY</code> statement is not sufficient as the information is not available through single table. Therefore we need to use <code>GROUP BY</code> with the <code>JOIN</code> statement:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">Select</span> Students<span class="token punctuation">.</span>FullName<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>Subject Id<span class="token punctuation">)</span> <span class="token keyword">as</span> SubjectNumber <span class="token keyword">FROM</span> Students_Subjects
<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> Students
<span class="token keyword">ON</span> Students_Subjects<span class="token punctuation">.</span>Student_id <span class="token operator">=</span> Students<span class="token punctuation">.</span>Id
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> Students<span class="token punctuation">.</span>FullName

</code></pre></div><p>The result of the given query is as follows:</p> <table><thead><tr><th>FullName</th> <th>SubjectNumber</th></tr></thead> <tbody><tr><td>Matt Jones</td> <td>3</td></tr> <tr><td>Frank Blue</td> <td>2</td></tr> <tr><td>Anthony Angel</td> <td>1</td></tr></tbody></table> <p>For an even more complex example of GROUP BY usage, let's say student might be able to assign the same subject to his name more than once (as shown in table Students_Subjects).
In this scenario we might be able to count number of times each subject was assigned to a student by GROUPing by more than one column:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> Students<span class="token punctuation">.</span>FullName<span class="token punctuation">,</span> Subjects<span class="token punctuation">.</span>Subject<span class="token punctuation">,</span>
<span class="token function">COUNT</span><span class="token punctuation">(</span>Students_subjects<span class="token punctuation">.</span>Subject_id<span class="token punctuation">)</span> <span class="token keyword">AS</span> NumberOfOrders
<span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>Students_Subjects
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> Students
<span class="token keyword">ON</span> Students_Subjcets<span class="token punctuation">.</span>Student_id<span class="token operator">=</span>Students<span class="token punctuation">.</span>Id<span class="token punctuation">)</span>
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> Subjects
<span class="token keyword">ON</span> Students_Subjects<span class="token punctuation">.</span>Subject_id<span class="token operator">=</span>Subjects<span class="token punctuation">.</span>Subject_id<span class="token punctuation">)</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> Fullname<span class="token punctuation">,</span>Subject

</code></pre></div><p>This query gives the following result:</p> <table><thead><tr><th>FullName</th> <th>Subject</th> <th>SubjectNumber</th></tr></thead> <tbody><tr><td>Matt Jones</td> <td>Maths</td> <td>2</td></tr> <tr><td>Matt Jones</td> <td>P.E</td> <td>1</td></tr> <tr><td>Frank Blue</td> <td>P.E</td> <td>1</td></tr> <tr><td>Frank Blue</td> <td>Physics</td> <td>1</td></tr> <tr><td>Anthony Angel</td> <td>Maths</td> <td>1</td></tr></tbody></table> <h2 id="having"><a href="#having" class="header-anchor">#</a> HAVING</h2> <p>Because the <code>WHERE</code> clause is evaluated before <code>GROUP BY</code>, you cannot use <code>WHERE</code> to pare down results of the grouping (typically an aggregate function, such as <code>COUNT(*)</code>). To meet this need, the <code>HAVING</code> clause can be used.</p> <p>For example, using the following data:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">DECLARE</span> <span class="token variable">@orders</span> <span class="token keyword">TABLE</span><span class="token punctuation">(</span>OrderID <span class="token keyword">INT</span><span class="token punctuation">,</span> Name NVARCHAR<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token variable">@orders</span> <span class="token keyword">VALUES</span>
<span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'Matt'</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'John'</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'Matt'</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">'Luke'</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">'John'</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">'Luke'</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">'John'</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">'John'</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token string">'Luke'</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">'John'</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token string">'Luke'</span> <span class="token punctuation">)</span>

</code></pre></div><p>If we want to get the number of orders each person has placed, we would use</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> Name<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">'Orders'</span>
<span class="token keyword">FROM</span> <span class="token variable">@orders</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> Name

</code></pre></div><p>and get</p> <table><thead><tr><th>Name</th> <th>Orders</th></tr></thead> <tbody><tr><td>Matt</td> <td>2</td></tr> <tr><td>John</td> <td>5</td></tr> <tr><td>Luke</td> <td>4</td></tr></tbody></table> <p>However, if we want to limit this to individuals who have placed more than two orders, we can add a <code>HAVING</code> clause.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> Name<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">'Orders'</span>
<span class="token keyword">FROM</span> <span class="token variable">@orders</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> Name
<span class="token keyword">HAVING</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">2</span>

</code></pre></div><p>will yield</p> <table><thead><tr><th>Name</th> <th>Orders</th></tr></thead> <tbody><tr><td>John</td> <td>5</td></tr> <tr><td>Luke</td> <td>4</td></tr></tbody></table> <p>Note that, much like <code>GROUP BY</code>, the columns put in <code>HAVING</code> must exactly match their counterparts in the <code>SELECT</code> statement. If in the above example we had instead said</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> Name<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> OrderID<span class="token punctuation">)</span>

</code></pre></div><p>our <code>HAVING</code> clause would have to say</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">HAVING</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> OrderID<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">2</span>

</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/mssql/group-by.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/mssql/over-clause.html" class="prev">
        OVER Clause
      </a></span> <span class="next"><a href="/mssql/order-by.html">
        ORDER BY
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.ced448ab.js" defer></script><script src="/assets/js/3.f1d73125.js" defer></script><script src="/assets/js/2010.f0d63b51.js" defer></script>
  </body>
</html>
