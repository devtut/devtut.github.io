<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Microsoft SQL Server - Queries with JSON data</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Using values from JSON in query, Using JSON values in reports, Filter-out bad JSON text from query results, Update value in JSON column, Append new value into JSON array, JOIN table with inner JSON collection, Finding rows that contain value in the JSON array">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="Microsoft SQL Server - Queries with JSON data">
    <meta property="og:description" content="Using values from JSON in query, Using JSON values in reports, Filter-out bad JSON text from query results, Update value in JSON column, Append new value into JSON array, JOIN table with inner JSON collection, Finding rows that contain value in the JSON array">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/mssql/queries-with-json-data.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="Microsoft SQL Server - Queries with JSON data">
    <meta name="twitter:description" content="Using values from JSON in query, Using JSON values in reports, Filter-out bad JSON text from query results, Update value in JSON column, Append new value into JSON array, JOIN table with inner JSON collection, Finding rows that contain value in the JSON array">
    <meta name="twitter:url" content="/mssql/queries-with-json-data.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/2044.7bc02402.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>MS SQL Server</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mssql/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/mssql/getting-started-with-microsoft-sql-server.html" class="sidebar-link">Getting started with Microsoft SQL Server</a></li><li><a href="/mssql/data-types.html" class="sidebar-link">Data Types</a></li><li><a href="/mssql/converting-data-types.html" class="sidebar-link">Converting data types</a></li><li><a href="/mssql/user-defined-table-types.html" class="sidebar-link">User Defined Table Types</a></li><li><a href="/mssql/select-statement.html" class="sidebar-link">SELECT statement</a></li><li><a href="/mssql/alias-names-in-sql-server.html" class="sidebar-link">Alias Names in Sql Server</a></li><li><a href="/mssql/nulls.html" class="sidebar-link">NULLs</a></li><li><a href="/mssql/variables.html" class="sidebar-link">Variables</a></li><li><a href="/mssql/dates.html" class="sidebar-link">Dates</a></li><li><a href="/mssql/generating-a-range-of-dates.html" class="sidebar-link">Generating a range of dates</a></li><li><a href="/mssql/database-snapshots.html" class="sidebar-link">Database Snapshots</a></li><li><a href="/mssql/coalesce.html" class="sidebar-link">COALESCE</a></li><li><a href="/mssql/if-else.html" class="sidebar-link">IF...ELSE</a></li><li><a href="/mssql/case-statement.html" class="sidebar-link">CASE Statement</a></li><li><a href="/mssql/insert-into.html" class="sidebar-link">INSERT INTO</a></li><li><a href="/mssql/drop-keyword.html" class="sidebar-link">Drop Keyword</a></li><li><a href="/mssql/merge.html" class="sidebar-link">MERGE</a></li><li><a href="/mssql/create-view.html" class="sidebar-link">CREATE VIEW</a></li><li><a href="/mssql/views.html" class="sidebar-link">Views</a></li><li><a href="/mssql/union.html" class="sidebar-link">UNION</a></li><li><a href="/mssql/try-catch.html" class="sidebar-link">TRY/CATCH</a></li><li><a href="/mssql/while-loop.html" class="sidebar-link">WHILE loop</a></li><li><a href="/mssql/over-clause.html" class="sidebar-link">OVER Clause</a></li><li><a href="/mssql/group-by.html" class="sidebar-link">GROUP BY</a></li><li><a href="/mssql/order-by.html" class="sidebar-link">ORDER BY</a></li><li><a href="/mssql/the-stuff-function.html" class="sidebar-link">The STUFF Function</a></li><li><a href="/mssql/json-in-sql-server.html" class="sidebar-link">JSON in Sql Server</a></li><li><a href="/mssql/openjson.html" class="sidebar-link">OPENJSON</a></li><li><a href="/mssql/for-json.html" class="sidebar-link">FOR JSON</a></li><li><a href="/mssql/queries-with-json-data.html" aria-current="page" class="active sidebar-link">Queries with JSON data</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mssql/queries-with-json-data.html#using-values-from-json-in-query" class="sidebar-link">Using values from JSON in query</a></li><li class="sidebar-sub-header"><a href="/mssql/queries-with-json-data.html#using-json-values-in-reports" class="sidebar-link">Using JSON values in reports</a></li><li class="sidebar-sub-header"><a href="/mssql/queries-with-json-data.html#filter-out-bad-json-text-from-query-results" class="sidebar-link">Filter-out bad JSON text from query results</a></li><li class="sidebar-sub-header"><a href="/mssql/queries-with-json-data.html#update-value-in-json-column" class="sidebar-link">Update value in JSON column</a></li><li class="sidebar-sub-header"><a href="/mssql/queries-with-json-data.html#append-new-value-into-json-array" class="sidebar-link">Append new value into JSON array</a></li><li class="sidebar-sub-header"><a href="/mssql/queries-with-json-data.html#join-table-with-inner-json-collection" class="sidebar-link">JOIN table with inner JSON collection</a></li><li class="sidebar-sub-header"><a href="/mssql/queries-with-json-data.html#finding-rows-that-contain-value-in-the-json-array" class="sidebar-link">Finding rows that contain value in the JSON array</a></li></ul></li><li><a href="/mssql/storing-json-in-sql-tables.html" class="sidebar-link">Storing JSON in SQL tables</a></li><li><a href="/mssql/modify-json-text.html" class="sidebar-link">Modify JSON text</a></li><li><a href="/mssql/for-xml-path.html" class="sidebar-link">FOR XML PATH</a></li><li><a href="/mssql/join.html" class="sidebar-link">Join</a></li><li><a href="/mssql/cross-apply.html" class="sidebar-link">cross apply</a></li><li><a href="/mssql/computed-columns.html" class="sidebar-link">Computed Columns</a></li><li><a href="/mssql/common-table-expressions.html" class="sidebar-link">Common Table Expressions</a></li><li><a href="/mssql/move-and-copy-data-around-tables.html" class="sidebar-link">Move and copy data around tables</a></li><li><a href="/mssql/limit-result-set.html" class="sidebar-link">Limit Result Set</a></li><li><a href="/mssql/retrieve-information-about-your-instance.html" class="sidebar-link">Retrieve Information about your Instance</a></li><li><a href="/mssql/with-ties-option.html" class="sidebar-link">With Ties Option</a></li><li><a href="/mssql/string-functions.html" class="sidebar-link">String Functions</a></li><li><a href="/mssql/logical-functions.html" class="sidebar-link">Logical Functions</a></li><li><a href="/mssql/aggregate-functions.html" class="sidebar-link">Aggregate Functions</a></li><li><a href="/mssql/string-aggregate-functions-in-sql-server.html" class="sidebar-link">String Aggregate functions in SQL Server</a></li><li><a href="/mssql/ranking-functions.html" class="sidebar-link">Ranking Functions</a></li><li><a href="/mssql/window-functions.html" class="sidebar-link">Window functions</a></li><li><a href="/mssql/pivot-unpivot.html" class="sidebar-link">PIVOT / UNPIVOT</a></li><li><a href="/mssql/dynamic-sql-pivot.html" class="sidebar-link">Dynamic SQL Pivot</a></li><li><a href="/mssql/partitioning.html" class="sidebar-link">Partitioning</a></li><li><a href="/mssql/stored-procedures.html" class="sidebar-link">Stored Procedures</a></li><li><a href="/mssql/retrieve-information-about-the-database.html" class="sidebar-link">Retrieve information about the database</a></li><li><a href="/mssql/split-string-function-in-sql-server.html" class="sidebar-link">Split String function in Sql Server</a></li><li><a href="/mssql/insert.html" class="sidebar-link">Insert</a></li><li><a href="/mssql/primary-keys.html" class="sidebar-link">Primary Keys</a></li><li><a href="/mssql/foreign-keys.html" class="sidebar-link">Foreign Keys</a></li><li><a href="/mssql/last-inserted-identity.html" class="sidebar-link">Last Inserted Identity</a></li><li><a href="/mssql/scope-identity.html" class="sidebar-link">SCOPE_IDENTITY()</a></li><li><a href="/mssql/sequences.html" class="sidebar-link">Sequences</a></li><li><a href="/mssql/indexing.html" class="sidebar-link">Indexing</a></li><li><a href="/mssql/full-text-indexing.html" class="sidebar-link">Full-Text Indexing</a></li><li><a href="/mssql/trigger.html" class="sidebar-link">Trigger</a></li><li><a href="/mssql/cursors.html" class="sidebar-link">Cursors</a></li><li><a href="/mssql/transaction-isolation-levels.html" class="sidebar-link">Transaction isolation levels</a></li><li><a href="/mssql/advanced-options.html" class="sidebar-link">Advanced options</a></li><li><a href="/mssql/migration.html" class="sidebar-link">Migration</a></li><li><a href="/mssql/table-valued-parameters.html" class="sidebar-link">Table Valued Parameters</a></li><li><a href="/mssql/dbmail.html" class="sidebar-link">DBMAIL</a></li><li><a href="/mssql/in-memory-oltp-hekaton.html" class="sidebar-link">In-Memory OLTP (Hekaton)</a></li><li><a href="/mssql/temporal-tables.html" class="sidebar-link">Temporal Tables</a></li><li><a href="/mssql/use-of-temp-table.html" class="sidebar-link">Use of TEMP Table</a></li><li><a href="/mssql/scheduled-task-or-job.html" class="sidebar-link">Scheduled Task or Job</a></li><li><a href="/mssql/isolation-levels-and-locking.html" class="sidebar-link">Isolation levels and locking</a></li><li><a href="/mssql/sorting-ordering-rows.html" class="sidebar-link">Sorting/ordering rows</a></li><li><a href="/mssql/privileges-or-permissions.html" class="sidebar-link">Privileges or Permissions</a></li><li><a href="/mssql/sqlcmd.html" class="sidebar-link">SQLCMD</a></li><li><a href="/mssql/resource-governor.html" class="sidebar-link">Resource Governor</a></li><li><a href="/mssql/file-group.html" class="sidebar-link">File Group</a></li><li><a href="/mssql/basic-ddl-operations-in-ms-sql-server.html" class="sidebar-link">Basic DDL Operations in MS SQL Server</a></li><li><a href="/mssql/subqueries.html" class="sidebar-link">Subqueries</a></li><li><a href="/mssql/pagination.html" class="sidebar-link">Pagination</a></li><li><a href="/mssql/clustered-columnstore.html" class="sidebar-link">CLUSTERED COLUMNSTORE</a></li><li><a href="/mssql/parsename.html" class="sidebar-link">Parsename</a></li><li><a href="/mssql/installing-sql-server-on-windows.html" class="sidebar-link">Installing SQL Server on Windows</a></li><li><a href="/mssql/analyzing-a-query.html" class="sidebar-link">Analyzing a Query</a></li><li><a href="/mssql/query-hints.html" class="sidebar-link">Query Hints</a></li><li><a href="/mssql/query-store.html" class="sidebar-link">Query Store</a></li><li><a href="/mssql/querying-results-by-page.html" class="sidebar-link">Querying results by page</a></li><li><a href="/mssql/schemas.html" class="sidebar-link">Schemas</a></li><li><a href="/mssql/backup-and-restore-database.html" class="sidebar-link">Backup and Restore Database</a></li><li><a href="/mssql/transaction-handling.html" class="sidebar-link">Transaction handling</a></li><li><a href="/mssql/natively-compiled-modules-hekaton.html" class="sidebar-link">Natively compiled modules (Hekaton)</a></li><li><a href="/mssql/spatial-data.html" class="sidebar-link">Spatial Data</a></li><li><a href="/mssql/dynamic-sql.html" class="sidebar-link">Dynamic SQL</a></li><li><a href="/mssql/dynamic-data-masking.html" class="sidebar-link">Dynamic data masking</a></li><li><a href="/mssql/export-data-in-txt-file-by-using-sqlcmd.html" class="sidebar-link">Export data in txt file by using SQLCMD</a></li><li><a href="/mssql/common-language-runtime-integration.html" class="sidebar-link">Common Language Runtime Integration</a></li><li><a href="/mssql/delimiting-special-characters-and-reserved-words.html" class="sidebar-link">Delimiting special characters and reserved words</a></li><li><a href="/mssql/dbcc.html" class="sidebar-link">DBCC</a></li><li><a href="/mssql/bulk-import.html" class="sidebar-link">BULK Import</a></li><li><a href="/mssql/service-broker.html" class="sidebar-link">Service broker</a></li><li><a href="/mssql/permissions-and-security.html" class="sidebar-link">Permissions and Security</a></li><li><a href="/mssql/database-permissions.html" class="sidebar-link">Database permissions</a></li><li><a href="/mssql/row-level-security.html" class="sidebar-link">Row-level security</a></li><li><a href="/mssql/encryption.html" class="sidebar-link">Encryption</a></li><li><a href="/mssql/phantom-read.html" class="sidebar-link">PHANTOM read</a></li><li><a href="/mssql/filestream.html" class="sidebar-link">Filestream</a></li><li><a href="/mssql/bcp-bulk-copy-program-utility.html" class="sidebar-link">bcp (bulk copy program) Utility</a></li><li><a href="/mssql/sql-server-evolution-through-different-versions-2000-2016.html" class="sidebar-link">SQL Server Evolution through different versions (2000 - 2016)</a></li><li><a href="/mssql/sql-server-management-studio-ssms.html" class="sidebar-link">SQL Server Management Studio (SSMS)</a></li><li><a href="/mssql/managing-azure-sql-database.html" class="sidebar-link">Managing Azure SQL Database</a></li><li><a href="/mssql/system-database-tempdb.html" class="sidebar-link">System database - TempDb</a></li><li><a href="/mssql/microsoft-sql-server-management-studio-shortcut-keys.html" class="sidebar-link">Microsoft SQL Server Management Studio Shortcut Keys</a></li><li><a href="/mssql/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="queries-with-json-data"><a href="#queries-with-json-data" class="header-anchor">#</a> Queries with JSON data</h1> <h2 id="using-values-from-json-in-query"><a href="#using-values-from-json-in-query" class="header-anchor">#</a> Using values from JSON in query</h2> <p>JSON_VALUE function enables you to take a data from JSON text on the path specified as the second argument, and use this value in any part of the select query:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> ProductID<span class="token punctuation">,</span> Name<span class="token punctuation">,</span> Color<span class="token punctuation">,</span> Size<span class="token punctuation">,</span> Price<span class="token punctuation">,</span> JSON_VALUE<span class="token punctuation">(</span><span class="token keyword">Data</span><span class="token punctuation">,</span> <span class="token string">'$.Type'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">Type</span>
<span class="token keyword">from</span> Product
<span class="token keyword">where</span> JSON_VALUE<span class="token punctuation">(</span><span class="token keyword">Data</span><span class="token punctuation">,</span> <span class="token string">'$.Type'</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">'part'</span>

</code></pre></div><h2 id="using-json-values-in-reports"><a href="#using-json-values-in-reports" class="header-anchor">#</a> Using JSON values in reports</h2> <p>Once JSON values are extracted from JSON text, you can use them ina any part of the query. You can create some kind of report on JSON data with grouping aggregations, etc:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> JSON_VALUE<span class="token punctuation">(</span><span class="token keyword">Data</span><span class="token punctuation">,</span> <span class="token string">'$.Type'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">type</span><span class="token punctuation">,</span>
        <span class="token function">AVG</span><span class="token punctuation">(</span> cast<span class="token punctuation">(</span>JSON_VALUE<span class="token punctuation">(</span><span class="token keyword">Data</span><span class="token punctuation">,</span> <span class="token string">'$.ManufacturingCost'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">float</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token keyword">as</span> cost
<span class="token keyword">from</span> Product
<span class="token keyword">group</span> <span class="token keyword">by</span> JSON_VALUE<span class="token punctuation">(</span><span class="token keyword">Data</span><span class="token punctuation">,</span> <span class="token string">'$.Type'</span><span class="token punctuation">)</span> 
<span class="token keyword">having</span> JSON_VALUE<span class="token punctuation">(</span><span class="token keyword">Data</span><span class="token punctuation">,</span> <span class="token string">'$.Type'</span><span class="token punctuation">)</span> <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span>

</code></pre></div><h2 id="filter-out-bad-json-text-from-query-results"><a href="#filter-out-bad-json-text-from-query-results" class="header-anchor">#</a> Filter-out bad JSON text from query results</h2> <p>If some JSON text might not be properly formatted, you can remove those entries from query using ISJSON function.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> ProductID<span class="token punctuation">,</span> Name<span class="token punctuation">,</span> Color<span class="token punctuation">,</span> Size<span class="token punctuation">,</span> Price<span class="token punctuation">,</span> JSON_VALUE<span class="token punctuation">(</span><span class="token keyword">Data</span><span class="token punctuation">,</span> <span class="token string">'$.Type'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">Type</span>
<span class="token keyword">from</span> Product
<span class="token keyword">where</span> JSON_VALUE<span class="token punctuation">(</span><span class="token keyword">Data</span><span class="token punctuation">,</span> <span class="token string">'$.Type'</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">'part'</span>
<span class="token operator">and</span> ISJSON<span class="token punctuation">(</span><span class="token keyword">Data</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span>

</code></pre></div><h2 id="update-value-in-json-column"><a href="#update-value-in-json-column" class="header-anchor">#</a> Update value in JSON column</h2> <p>JSON_MODIFY function can be used to update value on some path. You can use this function to modify original value of JSON cell in UPDATE statement:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">update</span> Product
<span class="token keyword">set</span> <span class="token keyword">Data</span> <span class="token operator">=</span> JSON_MODIFY<span class="token punctuation">(</span><span class="token keyword">Data</span><span class="token punctuation">,</span> <span class="token string">'$.Price'</span><span class="token punctuation">,</span> <span class="token number">24.99</span><span class="token punctuation">)</span>
<span class="token keyword">where</span> ProductID <span class="token operator">=</span> <span class="token number">17</span><span class="token punctuation">;</span>

</code></pre></div><p>JSON_MODIFY function will update or create Price key (if it does not exists). If new value is NULL, the key will be removed.
JSON_MODIFY function will treat new value as string (escape special characters, wrap it with double quotes to create proper JSON string). If your new value is JSON fragment, you should wrap it with JSON_QUERY function:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">update</span> Product
<span class="token keyword">set</span> <span class="token keyword">Data</span> <span class="token operator">=</span> JSON_MODIFY<span class="token punctuation">(</span><span class="token keyword">Data</span><span class="token punctuation">,</span> <span class="token string">'$.tags'</span><span class="token punctuation">,</span> JSON_QUERY<span class="token punctuation">(</span><span class="token string">'[&quot;promo&quot;,&quot;new&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">where</span> ProductID <span class="token operator">=</span> <span class="token number">17</span><span class="token punctuation">;</span>

</code></pre></div><p>JSON_QUERY function without second parameter behaves like a &quot;cast to JSON&quot;. Since the result of JSON_QUERY is valid JSON fragment (object or array), JSON_MODIFY will no escape this value when modifies input JSON.</p> <h2 id="append-new-value-into-json-array"><a href="#append-new-value-into-json-array" class="header-anchor">#</a> Append new value into JSON array</h2> <p>JSON_MODIFY function can be used to append new value to some array inside JSON:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">update</span> Product
<span class="token keyword">set</span> <span class="token keyword">Data</span> <span class="token operator">=</span> JSON_MODIFY<span class="token punctuation">(</span><span class="token keyword">Data</span><span class="token punctuation">,</span> <span class="token string">'append $.tags'</span><span class="token punctuation">,</span> <span class="token string">&quot;sales&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">where</span> ProductID <span class="token operator">=</span> <span class="token number">17</span><span class="token punctuation">;</span>

</code></pre></div><p>New value will be appended at the end of the array, or a new array with value [&quot;sales&quot;] will be created.
JSON_MODIFY function will treat new value as string (escape special characters, wrap it with double quotes to create proper JSON string). If your new value is JSON fragment, you should wrap it with JSON_QUERY function:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">update</span> Product
<span class="token keyword">set</span> <span class="token keyword">Data</span> <span class="token operator">=</span> JSON_MODIFY<span class="token punctuation">(</span><span class="token keyword">Data</span><span class="token punctuation">,</span> <span class="token string">'append $.tags'</span><span class="token punctuation">,</span> JSON_QUERY<span class="token punctuation">(</span><span class="token string">'{&quot;type&quot;:&quot;new&quot;}'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">where</span> ProductID <span class="token operator">=</span> <span class="token number">17</span><span class="token punctuation">;</span>

</code></pre></div><p>JSON_QUERY function without second parameter behaves like a &quot;cast to JSON&quot;. Since the result of JSON_QUERY is valid JSON fragment (object or array), JSON_MODIFY will no escape this value when modifies input JSON.</p> <h2 id="join-table-with-inner-json-collection"><a href="#join-table-with-inner-json-collection" class="header-anchor">#</a> JOIN table with inner JSON collection</h2> <p>If you have a &quot;child table&quot; formatted as JSON collection and stored in-row as JSON column, you can unpack this collection, transform it to table and join it with parent row. Instead of the standard JOIN operator, you should use CROSS APPLY.
In this example, product parts are formatted as collection of JSON objects in and stored in Data column:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> ProductID<span class="token punctuation">,</span> Name<span class="token punctuation">,</span> Size<span class="token punctuation">,</span> Price<span class="token punctuation">,</span> Quantity<span class="token punctuation">,</span> PartName<span class="token punctuation">,</span> Code
<span class="token keyword">from</span> Product
    <span class="token keyword">CROSS</span> <span class="token keyword">APPLY</span> OPENJSON<span class="token punctuation">(</span><span class="token keyword">Data</span><span class="token punctuation">,</span> <span class="token string">'$.Parts'</span><span class="token punctuation">)</span> <span class="token keyword">WITH</span> <span class="token punctuation">(</span>PartName <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Code <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><p>Result of the query is equivalent to the join between Product and Part tables.</p> <h2 id="finding-rows-that-contain-value-in-the-json-array"><a href="#finding-rows-that-contain-value-in-the-json-array" class="header-anchor">#</a> Finding rows that contain value in the JSON array</h2> <p>In this example, Tags array may contain various keywords like [&quot;promo&quot;, &quot;sales&quot;], so we can open this array and filter values:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> ProductID<span class="token punctuation">,</span> Name<span class="token punctuation">,</span> Color<span class="token punctuation">,</span> Size<span class="token punctuation">,</span> Price<span class="token punctuation">,</span> Quantity
<span class="token keyword">from</span> Product
    <span class="token keyword">CROSS</span> <span class="token keyword">APPLY</span> OPENJSON<span class="token punctuation">(</span><span class="token keyword">Data</span><span class="token punctuation">,</span> <span class="token string">'$.Tags'</span><span class="token punctuation">)</span> 
<span class="token keyword">where</span> <span class="token keyword">value</span> <span class="token operator">=</span> <span class="token string">'sales'</span>

</code></pre></div><p>OPENJSON will open inner collection of tags and return it as table. Then we can filter results by some value in the table.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/mssql/queries-with-json-data.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/mssql/for-json.html" class="prev">
        FOR JSON
      </a></span> <span class="next"><a href="/mssql/storing-json-in-sql-tables.html">
        Storing JSON in SQL tables
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/2044.7bc02402.js" defer></script>
  </body>
</html>
