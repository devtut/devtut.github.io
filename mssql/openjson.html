<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Microsoft SQL Server - OPENJSON</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Get key:value pairs from JSON text, Transform JSON array into set of rows, Transform nested JSON fields into set of rows, Extracting inner JSON sub-objects, Working with nested JSON sub-arrays">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="Microsoft SQL Server - OPENJSON">
    <meta property="og:description" content="Get key:value pairs from JSON text, Transform JSON array into set of rows, Transform nested JSON fields into set of rows, Extracting inner JSON sub-objects, Working with nested JSON sub-arrays">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/mssql/openjson.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="Microsoft SQL Server - OPENJSON">
    <meta name="twitter:description" content="Get key:value pairs from JSON text, Transform JSON array into set of rows, Transform nested JSON fields into set of rows, Extracting inner JSON sub-objects, Working with nested JSON sub-arrays">
    <meta name="twitter:url" content="/mssql/openjson.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/2033.d0f2a6db.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>MS SQL Server</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mssql/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/mssql/getting-started-with-microsoft-sql-server.html" class="sidebar-link">Getting started with Microsoft SQL Server</a></li><li><a href="/mssql/data-types.html" class="sidebar-link">Data Types</a></li><li><a href="/mssql/converting-data-types.html" class="sidebar-link">Converting data types</a></li><li><a href="/mssql/user-defined-table-types.html" class="sidebar-link">User Defined Table Types</a></li><li><a href="/mssql/select-statement.html" class="sidebar-link">SELECT statement</a></li><li><a href="/mssql/alias-names-in-sql-server.html" class="sidebar-link">Alias Names in Sql Server</a></li><li><a href="/mssql/nulls.html" class="sidebar-link">NULLs</a></li><li><a href="/mssql/variables.html" class="sidebar-link">Variables</a></li><li><a href="/mssql/dates.html" class="sidebar-link">Dates</a></li><li><a href="/mssql/generating-a-range-of-dates.html" class="sidebar-link">Generating a range of dates</a></li><li><a href="/mssql/database-snapshots.html" class="sidebar-link">Database Snapshots</a></li><li><a href="/mssql/coalesce.html" class="sidebar-link">COALESCE</a></li><li><a href="/mssql/if-else.html" class="sidebar-link">IF...ELSE</a></li><li><a href="/mssql/case-statement.html" class="sidebar-link">CASE Statement</a></li><li><a href="/mssql/insert-into.html" class="sidebar-link">INSERT INTO</a></li><li><a href="/mssql/drop-keyword.html" class="sidebar-link">Drop Keyword</a></li><li><a href="/mssql/merge.html" class="sidebar-link">MERGE</a></li><li><a href="/mssql/create-view.html" class="sidebar-link">CREATE VIEW</a></li><li><a href="/mssql/views.html" class="sidebar-link">Views</a></li><li><a href="/mssql/union.html" class="sidebar-link">UNION</a></li><li><a href="/mssql/try-catch.html" class="sidebar-link">TRY/CATCH</a></li><li><a href="/mssql/while-loop.html" class="sidebar-link">WHILE loop</a></li><li><a href="/mssql/over-clause.html" class="sidebar-link">OVER Clause</a></li><li><a href="/mssql/group-by.html" class="sidebar-link">GROUP BY</a></li><li><a href="/mssql/order-by.html" class="sidebar-link">ORDER BY</a></li><li><a href="/mssql/the-stuff-function.html" class="sidebar-link">The STUFF Function</a></li><li><a href="/mssql/json-in-sql-server.html" class="sidebar-link">JSON in Sql Server</a></li><li><a href="/mssql/openjson.html" aria-current="page" class="active sidebar-link">OPENJSON</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mssql/openjson.html#get-key-value-pairs-from-json-text" class="sidebar-link">Get key:value pairs from JSON text</a></li><li class="sidebar-sub-header"><a href="/mssql/openjson.html#transform-json-array-into-set-of-rows" class="sidebar-link">Transform JSON array into set of rows</a></li><li class="sidebar-sub-header"><a href="/mssql/openjson.html#transform-nested-json-fields-into-set-of-rows" class="sidebar-link">Transform nested JSON fields into set of rows</a></li><li class="sidebar-sub-header"><a href="/mssql/openjson.html#extracting-inner-json-sub-objects" class="sidebar-link">Extracting inner JSON sub-objects</a></li><li class="sidebar-sub-header"><a href="/mssql/openjson.html#working-with-nested-json-sub-arrays" class="sidebar-link">Working with nested JSON sub-arrays</a></li></ul></li><li><a href="/mssql/for-json.html" class="sidebar-link">FOR JSON</a></li><li><a href="/mssql/queries-with-json-data.html" class="sidebar-link">Queries with JSON data</a></li><li><a href="/mssql/storing-json-in-sql-tables.html" class="sidebar-link">Storing JSON in SQL tables</a></li><li><a href="/mssql/modify-json-text.html" class="sidebar-link">Modify JSON text</a></li><li><a href="/mssql/for-xml-path.html" class="sidebar-link">FOR XML PATH</a></li><li><a href="/mssql/join.html" class="sidebar-link">Join</a></li><li><a href="/mssql/cross-apply.html" class="sidebar-link">cross apply</a></li><li><a href="/mssql/computed-columns.html" class="sidebar-link">Computed Columns</a></li><li><a href="/mssql/common-table-expressions.html" class="sidebar-link">Common Table Expressions</a></li><li><a href="/mssql/move-and-copy-data-around-tables.html" class="sidebar-link">Move and copy data around tables</a></li><li><a href="/mssql/limit-result-set.html" class="sidebar-link">Limit Result Set</a></li><li><a href="/mssql/retrieve-information-about-your-instance.html" class="sidebar-link">Retrieve Information about your Instance</a></li><li><a href="/mssql/with-ties-option.html" class="sidebar-link">With Ties Option</a></li><li><a href="/mssql/string-functions.html" class="sidebar-link">String Functions</a></li><li><a href="/mssql/logical-functions.html" class="sidebar-link">Logical Functions</a></li><li><a href="/mssql/aggregate-functions.html" class="sidebar-link">Aggregate Functions</a></li><li><a href="/mssql/string-aggregate-functions-in-sql-server.html" class="sidebar-link">String Aggregate functions in SQL Server</a></li><li><a href="/mssql/ranking-functions.html" class="sidebar-link">Ranking Functions</a></li><li><a href="/mssql/window-functions.html" class="sidebar-link">Window functions</a></li><li><a href="/mssql/pivot-unpivot.html" class="sidebar-link">PIVOT / UNPIVOT</a></li><li><a href="/mssql/dynamic-sql-pivot.html" class="sidebar-link">Dynamic SQL Pivot</a></li><li><a href="/mssql/partitioning.html" class="sidebar-link">Partitioning</a></li><li><a href="/mssql/stored-procedures.html" class="sidebar-link">Stored Procedures</a></li><li><a href="/mssql/retrieve-information-about-the-database.html" class="sidebar-link">Retrieve information about the database</a></li><li><a href="/mssql/split-string-function-in-sql-server.html" class="sidebar-link">Split String function in Sql Server</a></li><li><a href="/mssql/insert.html" class="sidebar-link">Insert</a></li><li><a href="/mssql/primary-keys.html" class="sidebar-link">Primary Keys</a></li><li><a href="/mssql/foreign-keys.html" class="sidebar-link">Foreign Keys</a></li><li><a href="/mssql/last-inserted-identity.html" class="sidebar-link">Last Inserted Identity</a></li><li><a href="/mssql/scope-identity.html" class="sidebar-link">SCOPE_IDENTITY()</a></li><li><a href="/mssql/sequences.html" class="sidebar-link">Sequences</a></li><li><a href="/mssql/indexing.html" class="sidebar-link">Indexing</a></li><li><a href="/mssql/full-text-indexing.html" class="sidebar-link">Full-Text Indexing</a></li><li><a href="/mssql/trigger.html" class="sidebar-link">Trigger</a></li><li><a href="/mssql/cursors.html" class="sidebar-link">Cursors</a></li><li><a href="/mssql/transaction-isolation-levels.html" class="sidebar-link">Transaction isolation levels</a></li><li><a href="/mssql/advanced-options.html" class="sidebar-link">Advanced options</a></li><li><a href="/mssql/migration.html" class="sidebar-link">Migration</a></li><li><a href="/mssql/table-valued-parameters.html" class="sidebar-link">Table Valued Parameters</a></li><li><a href="/mssql/dbmail.html" class="sidebar-link">DBMAIL</a></li><li><a href="/mssql/in-memory-oltp-hekaton.html" class="sidebar-link">In-Memory OLTP (Hekaton)</a></li><li><a href="/mssql/temporal-tables.html" class="sidebar-link">Temporal Tables</a></li><li><a href="/mssql/use-of-temp-table.html" class="sidebar-link">Use of TEMP Table</a></li><li><a href="/mssql/scheduled-task-or-job.html" class="sidebar-link">Scheduled Task or Job</a></li><li><a href="/mssql/isolation-levels-and-locking.html" class="sidebar-link">Isolation levels and locking</a></li><li><a href="/mssql/sorting-ordering-rows.html" class="sidebar-link">Sorting/ordering rows</a></li><li><a href="/mssql/privileges-or-permissions.html" class="sidebar-link">Privileges or Permissions</a></li><li><a href="/mssql/sqlcmd.html" class="sidebar-link">SQLCMD</a></li><li><a href="/mssql/resource-governor.html" class="sidebar-link">Resource Governor</a></li><li><a href="/mssql/file-group.html" class="sidebar-link">File Group</a></li><li><a href="/mssql/basic-ddl-operations-in-ms-sql-server.html" class="sidebar-link">Basic DDL Operations in MS SQL Server</a></li><li><a href="/mssql/subqueries.html" class="sidebar-link">Subqueries</a></li><li><a href="/mssql/pagination.html" class="sidebar-link">Pagination</a></li><li><a href="/mssql/clustered-columnstore.html" class="sidebar-link">CLUSTERED COLUMNSTORE</a></li><li><a href="/mssql/parsename.html" class="sidebar-link">Parsename</a></li><li><a href="/mssql/installing-sql-server-on-windows.html" class="sidebar-link">Installing SQL Server on Windows</a></li><li><a href="/mssql/analyzing-a-query.html" class="sidebar-link">Analyzing a Query</a></li><li><a href="/mssql/query-hints.html" class="sidebar-link">Query Hints</a></li><li><a href="/mssql/query-store.html" class="sidebar-link">Query Store</a></li><li><a href="/mssql/querying-results-by-page.html" class="sidebar-link">Querying results by page</a></li><li><a href="/mssql/schemas.html" class="sidebar-link">Schemas</a></li><li><a href="/mssql/backup-and-restore-database.html" class="sidebar-link">Backup and Restore Database</a></li><li><a href="/mssql/transaction-handling.html" class="sidebar-link">Transaction handling</a></li><li><a href="/mssql/natively-compiled-modules-hekaton.html" class="sidebar-link">Natively compiled modules (Hekaton)</a></li><li><a href="/mssql/spatial-data.html" class="sidebar-link">Spatial Data</a></li><li><a href="/mssql/dynamic-sql.html" class="sidebar-link">Dynamic SQL</a></li><li><a href="/mssql/dynamic-data-masking.html" class="sidebar-link">Dynamic data masking</a></li><li><a href="/mssql/export-data-in-txt-file-by-using-sqlcmd.html" class="sidebar-link">Export data in txt file by using SQLCMD</a></li><li><a href="/mssql/common-language-runtime-integration.html" class="sidebar-link">Common Language Runtime Integration</a></li><li><a href="/mssql/delimiting-special-characters-and-reserved-words.html" class="sidebar-link">Delimiting special characters and reserved words</a></li><li><a href="/mssql/dbcc.html" class="sidebar-link">DBCC</a></li><li><a href="/mssql/bulk-import.html" class="sidebar-link">BULK Import</a></li><li><a href="/mssql/service-broker.html" class="sidebar-link">Service broker</a></li><li><a href="/mssql/permissions-and-security.html" class="sidebar-link">Permissions and Security</a></li><li><a href="/mssql/database-permissions.html" class="sidebar-link">Database permissions</a></li><li><a href="/mssql/row-level-security.html" class="sidebar-link">Row-level security</a></li><li><a href="/mssql/encryption.html" class="sidebar-link">Encryption</a></li><li><a href="/mssql/phantom-read.html" class="sidebar-link">PHANTOM read</a></li><li><a href="/mssql/filestream.html" class="sidebar-link">Filestream</a></li><li><a href="/mssql/bcp-bulk-copy-program-utility.html" class="sidebar-link">bcp (bulk copy program) Utility</a></li><li><a href="/mssql/sql-server-evolution-through-different-versions-2000-2016.html" class="sidebar-link">SQL Server Evolution through different versions (2000 - 2016)</a></li><li><a href="/mssql/sql-server-management-studio-ssms.html" class="sidebar-link">SQL Server Management Studio (SSMS)</a></li><li><a href="/mssql/managing-azure-sql-database.html" class="sidebar-link">Managing Azure SQL Database</a></li><li><a href="/mssql/system-database-tempdb.html" class="sidebar-link">System database - TempDb</a></li><li><a href="/mssql/microsoft-sql-server-management-studio-shortcut-keys.html" class="sidebar-link">Microsoft SQL Server Management Studio Shortcut Keys</a></li><li><a href="/mssql/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="openjson"><a href="#openjson" class="header-anchor">#</a> OPENJSON</h1> <h2 id="get-key-value-pairs-from-json-text"><a href="#get-key-value-pairs-from-json-text" class="header-anchor">#</a> Get key:value pairs from JSON text</h2> <p>OPENJSON function parse JSON text and returns all key:value pairs at the first level of JSON:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">declare</span> <span class="token variable">@json</span> NVARCHAR<span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span> <span class="token operator">=</span> N<span class="token string">'{&quot;Name&quot;:&quot;Joe&quot;,&quot;age&quot;:27,&quot;skills&quot;:[&quot;C#&quot;,&quot;SQL&quot;]}'</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> OPENJSON<span class="token punctuation">(</span><span class="token variable">@json</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><table><thead><tr><th>key</th> <th>value</th> <th>type</th></tr></thead> <tbody><tr><td>Name</td> <td>Joe</td> <td>1</td></tr> <tr><td>age</td> <td>27</td> <td>2</td></tr> <tr><td>skills</td> <td>[&quot;C#&quot;,&quot;SQL&quot;]</td> <td>4</td></tr></tbody></table> <p>Column type describe the type of value, i.e. null(0), string(1), number(2), boolean(3), array(4), and object(5).</p> <h2 id="transform-json-array-into-set-of-rows"><a href="#transform-json-array-into-set-of-rows" class="header-anchor">#</a> Transform JSON array into set of rows</h2> <p>OPENJSON function parses collection of JSON objects and returns values from JSON text as set of rows.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">declare</span> <span class="token variable">@json</span> nvarchar<span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span> <span class="token operator">=</span> N<span class="token string">'[
  {&quot;Number&quot;:&quot;SO43659&quot;,&quot;Date&quot;:&quot;2011-05-31T00:00:00&quot;,&quot;Customer&quot;: &quot;MSFT&quot;,&quot;Price&quot;:59.99,&quot;Quantity&quot;:1},
  {&quot;Number&quot;:&quot;SO43661&quot;,&quot;Date&quot;:&quot;2011-06-01T00:00:00&quot;,&quot;Customer&quot;:&quot;Nokia&quot;,&quot;Price&quot;:24.99,&quot;Quantity&quot;:3}
]'</span>

<span class="token keyword">SELECT</span>    <span class="token operator">*</span> 
<span class="token keyword">FROM</span> OPENJSON <span class="token punctuation">(</span><span class="token variable">@json</span><span class="token punctuation">)</span>
    <span class="token keyword">WITH</span> <span class="token punctuation">(</span>
          Number   <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token keyword">Date</span>     <span class="token keyword">datetime</span><span class="token punctuation">,</span>
          Customer <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          Quantity <span class="token keyword">int</span>
  <span class="token punctuation">)</span>

</code></pre></div><p>In the WITH clause is specified return schema of OPENJSON function. Keys in the JSON objects are fetched by column names. If some key in JSON is not specified in the WITH clause (e.g. Price in this example) it will be ignored. Values are automatically converted into specified types.</p> <table><thead><tr><th>Number</th> <th>Date</th> <th>Customer</th> <th>Quantity</th></tr></thead> <tbody><tr><td>SO43659</td> <td>2011-05-31T00:00:00</td> <td>MSFT</td> <td>1</td></tr> <tr><td>SO43661</td> <td>2011-06-01T00:00:00</td> <td>Nokia</td> <td>3</td></tr></tbody></table> <h2 id="transform-nested-json-fields-into-set-of-rows"><a href="#transform-nested-json-fields-into-set-of-rows" class="header-anchor">#</a> Transform nested JSON fields into set of rows</h2> <p>OPENJSON function parses collection of JSON objects and returns values from JSON text as set of rows. If the values in input object are nested, additional mapping parameter can be specified in each column in WITH clause:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">declare</span> <span class="token variable">@json</span> nvarchar<span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span> <span class="token operator">=</span> N<span class="token string">'[
  {&quot;data&quot;:{&quot;num&quot;:&quot;SO43659&quot;,&quot;date&quot;:&quot;2011-05-31T00:00:00&quot;},&quot;info&quot;:{&quot;customer&quot;:&quot;MSFT&quot;,&quot;Price&quot;:59.99,&quot;qty&quot;:1}},
  {&quot;data&quot;:{&quot;number&quot;:&quot;SO43661&quot;,&quot;date&quot;:&quot;2011-06-01T00:00:00&quot;},&quot;info&quot;:{&quot;customer&quot;:&quot;Nokia&quot;,&quot;Price&quot;:24.99,&quot;qty&quot;:3}}
]'</span>

<span class="token keyword">SELECT</span>    <span class="token operator">*</span> 
<span class="token keyword">FROM</span> OPENJSON <span class="token punctuation">(</span><span class="token variable">@json</span><span class="token punctuation">)</span>
    <span class="token keyword">WITH</span> <span class="token punctuation">(</span>
          Number   <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token string">'$.data.num'</span><span class="token punctuation">,</span>
          <span class="token keyword">Date</span>     <span class="token keyword">datetime</span> <span class="token string">'$.data.date'</span><span class="token punctuation">,</span>
          Customer <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token string">'$.info.customer'</span><span class="token punctuation">,</span>
          Quantity <span class="token keyword">int</span> <span class="token string">'$.info.qty'</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span>

</code></pre></div><p>In the WITH clause is specified return schema of OPENJSON function. After the type is specified path to the JSON nodes where returned value should be found. Keys in the JSON objects are fetched by these paths. Values are automatically converted into specified types.</p> <table><thead><tr><th>Number</th> <th>Date</th> <th>Customer</th> <th>Quantity</th></tr></thead> <tbody><tr><td>SO43659</td> <td>2011-05-31T00:00:00</td> <td>MSFT</td> <td>1</td></tr> <tr><td>SO43661</td> <td>2011-06-01T00:00:00</td> <td>Nokia</td> <td>3</td></tr></tbody></table> <h2 id="extracting-inner-json-sub-objects"><a href="#extracting-inner-json-sub-objects" class="header-anchor">#</a> Extracting inner JSON sub-objects</h2> <p>OPENJSON can extract fragments of JSON objects inside the JSON text. In the column definition that references JSON sub-object set the type nvarchar(max) and AS JSON option:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">declare</span> <span class="token variable">@json</span> nvarchar<span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span> <span class="token operator">=</span> N<span class="token string">'[
  {&quot;Number&quot;:&quot;SO43659&quot;,&quot;Date&quot;:&quot;2011-05-31T00:00:00&quot;,&quot;info&quot;:{&quot;customer&quot;:&quot;MSFT&quot;,&quot;Price&quot;:59.99,&quot;qty&quot;:1}},
  {&quot;Number&quot;:&quot;SO43661&quot;,&quot;Date&quot;:&quot;2011-06-01T00:00:00&quot;,&quot;info&quot;:{&quot;customer&quot;:&quot;Nokia&quot;,&quot;Price&quot;:24.99,&quot;qty&quot;:3}}
]'</span>

<span class="token keyword">SELECT</span>    <span class="token operator">*</span> 
<span class="token keyword">FROM</span> OPENJSON <span class="token punctuation">(</span><span class="token variable">@json</span><span class="token punctuation">)</span>
    <span class="token keyword">WITH</span> <span class="token punctuation">(</span>
          Number   <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token keyword">Date</span>     <span class="token keyword">datetime</span><span class="token punctuation">,</span>
          Info nvarchar<span class="token punctuation">(</span>max<span class="token punctuation">)</span> <span class="token string">'$.info'</span> <span class="token keyword">AS</span> JSON
  <span class="token punctuation">)</span>

</code></pre></div><p>Info column will be mapped to &quot;Info&quot; object. Results will be:</p> <table><thead><tr><th>Number</th> <th>Date</th> <th>Info</th></tr></thead> <tbody><tr><td>SO43659</td> <td>2011-05-31T00:00:00</td> <td>{&quot;customer&quot;:&quot;MSFT&quot;,&quot;Price&quot;:59.99,&quot;qty&quot;:1}</td></tr> <tr><td>SO43661</td> <td>2011-06-01T00:00:00</td> <td>{&quot;customer&quot;:&quot;Nokia&quot;,&quot;Price&quot;:24.99,&quot;qty&quot;:3}</td></tr></tbody></table> <h2 id="working-with-nested-json-sub-arrays"><a href="#working-with-nested-json-sub-arrays" class="header-anchor">#</a> Working with nested JSON sub-arrays</h2> <p>JSON may have complex structure with inner arrays. In this example, we have array of orders with nested sub array of OrderItems.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">declare</span> <span class="token variable">@json</span> nvarchar<span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span> <span class="token operator">=</span> N<span class="token string">'[
  {&quot;Number&quot;:&quot;SO43659&quot;,&quot;Date&quot;:&quot;2011-05-31T00:00:00&quot;,
    &quot;Items&quot;:[{&quot;Price&quot;:11.99,&quot;Quantity&quot;:1},{&quot;Price&quot;:12.99,&quot;Quantity&quot;:5}]},
  {&quot;Number&quot;:&quot;SO43661&quot;,&quot;Date&quot;:&quot;2011-06-01T00:00:00&quot;,
    &quot;Items&quot;:[{&quot;Price&quot;:21.99,&quot;Quantity&quot;:3},{&quot;Price&quot;:22.99,&quot;Quantity&quot;:2},{&quot;Price&quot;:23.99,&quot;Quantity&quot;:2}]}
]'</span>

</code></pre></div><p>We can parse root level properties using OPENJSON that will return Items array AS JSON fragment. Then we can apply OPENJSON again on Items array and open inner JSON table. First level table and inner table will be &quot;joined&quot; like in the JOIN between standard tables:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span>    <span class="token operator">*</span> 
<span class="token keyword">FROM</span>
    OPENJSON <span class="token punctuation">(</span><span class="token variable">@json</span><span class="token punctuation">)</span>
    <span class="token keyword">WITH</span> <span class="token punctuation">(</span>  Number <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">Date</span> <span class="token keyword">datetime</span><span class="token punctuation">,</span>
            Items nvarchar<span class="token punctuation">(</span>max<span class="token punctuation">)</span> <span class="token keyword">AS</span> JSON <span class="token punctuation">)</span>
        <span class="token keyword">CROSS</span> <span class="token keyword">APPLY</span> 
            OPENJSON <span class="token punctuation">(</span>Items<span class="token punctuation">)</span>
            <span class="token keyword">WITH</span> <span class="token punctuation">(</span> Price <span class="token keyword">float</span><span class="token punctuation">,</span> Quantity <span class="token keyword">int</span><span class="token punctuation">)</span>

</code></pre></div><p>Results:</p> <p>|Number|Date|Items|Price|Quantity
|---|---|---|---
|SO43659|2011-05-31 00:00:00.000|[{&quot;Price&quot;:11.99,&quot;Quantity&quot;:1},{&quot;Price&quot;:12.99,&quot;Quantity&quot;:5}]|11.99|1
|SO43659|2011-05-31 00:00:00.000|[{&quot;Price&quot;:11.99,&quot;Quantity&quot;:1},{&quot;Price&quot;:12.99,&quot;Quantity&quot;:5}]|12.99|5
|SO43661|2011-06-01 00:00:00.000|[{&quot;Price&quot;:21.99,&quot;Quantity&quot;:3},{&quot;Price&quot;:22.99,&quot;Quantity&quot;:2},{&quot;Price&quot;:23.99,&quot;Quantity&quot;:2}]|21.99|3
|SO43661|2011-06-01 00:00:00.000|[{&quot;Price&quot;:21.99,&quot;Quantity&quot;:3},{&quot;Price&quot;:22.99,&quot;Quantity&quot;:2},{&quot;Price&quot;:23.99,&quot;Quantity&quot;:2}]|22.99|2
|SO43661|2011-06-01 00:00:00.000|[{&quot;Price&quot;:21.99,&quot;Quantity&quot;:3},{&quot;Price&quot;:22.99,&quot;Quantity&quot;:2},{&quot;Price&quot;:23.99,&quot;Quantity&quot;:2}]|23.99|2</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/mssql/openjson.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/mssql/json-in-sql-server.html" class="prev">
        JSON in Sql Server
      </a></span> <span class="next"><a href="/mssql/for-json.html">
        FOR JSON
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/2033.d0f2a6db.js" defer></script>
  </body>
</html>
