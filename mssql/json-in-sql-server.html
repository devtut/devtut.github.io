<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Microsoft SQL Server - JSON in Sql Server</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Format Query Results as JSON with FOR JSON, Parse JSON text, Join parent and child JSON entities using CROSS APPLY OPENJSON, Index on JSON properties by using computed columns, Format one table row as a single JSON object using FOR JSON, Parse JSON text using OPENJSON function">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="Microsoft SQL Server - JSON in Sql Server">
    <meta property="og:description" content="Format Query Results as JSON with FOR JSON, Parse JSON text, Join parent and child JSON entities using CROSS APPLY OPENJSON, Index on JSON properties by using computed columns, Format one table row as a single JSON object using FOR JSON, Parse JSON text using OPENJSON function">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/mssql/json-in-sql-server.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="Microsoft SQL Server - JSON in Sql Server">
    <meta name="twitter:description" content="Format Query Results as JSON with FOR JSON, Parse JSON text, Join parent and child JSON entities using CROSS APPLY OPENJSON, Index on JSON properties by using computed columns, Format one table row as a single JSON object using FOR JSON, Parse JSON text using OPENJSON function">
    <meta name="twitter:url" content="/mssql/json-in-sql-server.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/2021.516f69d4.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>MS SQL Server</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mssql/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/mssql/getting-started-with-microsoft-sql-server.html" class="sidebar-link">Getting started with Microsoft SQL Server</a></li><li><a href="/mssql/data-types.html" class="sidebar-link">Data Types</a></li><li><a href="/mssql/converting-data-types.html" class="sidebar-link">Converting data types</a></li><li><a href="/mssql/user-defined-table-types.html" class="sidebar-link">User Defined Table Types</a></li><li><a href="/mssql/select-statement.html" class="sidebar-link">SELECT statement</a></li><li><a href="/mssql/alias-names-in-sql-server.html" class="sidebar-link">Alias Names in Sql Server</a></li><li><a href="/mssql/nulls.html" class="sidebar-link">NULLs</a></li><li><a href="/mssql/variables.html" class="sidebar-link">Variables</a></li><li><a href="/mssql/dates.html" class="sidebar-link">Dates</a></li><li><a href="/mssql/generating-a-range-of-dates.html" class="sidebar-link">Generating a range of dates</a></li><li><a href="/mssql/database-snapshots.html" class="sidebar-link">Database Snapshots</a></li><li><a href="/mssql/coalesce.html" class="sidebar-link">COALESCE</a></li><li><a href="/mssql/if-else.html" class="sidebar-link">IF...ELSE</a></li><li><a href="/mssql/case-statement.html" class="sidebar-link">CASE Statement</a></li><li><a href="/mssql/insert-into.html" class="sidebar-link">INSERT INTO</a></li><li><a href="/mssql/drop-keyword.html" class="sidebar-link">Drop Keyword</a></li><li><a href="/mssql/merge.html" class="sidebar-link">MERGE</a></li><li><a href="/mssql/create-view.html" class="sidebar-link">CREATE VIEW</a></li><li><a href="/mssql/views.html" class="sidebar-link">Views</a></li><li><a href="/mssql/union.html" class="sidebar-link">UNION</a></li><li><a href="/mssql/try-catch.html" class="sidebar-link">TRY/CATCH</a></li><li><a href="/mssql/while-loop.html" class="sidebar-link">WHILE loop</a></li><li><a href="/mssql/over-clause.html" class="sidebar-link">OVER Clause</a></li><li><a href="/mssql/group-by.html" class="sidebar-link">GROUP BY</a></li><li><a href="/mssql/order-by.html" class="sidebar-link">ORDER BY</a></li><li><a href="/mssql/the-stuff-function.html" class="sidebar-link">The STUFF Function</a></li><li><a href="/mssql/json-in-sql-server.html" aria-current="page" class="active sidebar-link">JSON in Sql Server</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mssql/json-in-sql-server.html#format-query-results-as-json-with-for-json" class="sidebar-link">Format Query Results as JSON with FOR JSON</a></li><li class="sidebar-sub-header"><a href="/mssql/json-in-sql-server.html#parse-json-text" class="sidebar-link">Parse JSON text</a></li><li class="sidebar-sub-header"><a href="/mssql/json-in-sql-server.html#join-parent-and-child-json-entities-using-cross-apply-openjson" class="sidebar-link">Join parent and child JSON entities using CROSS APPLY OPENJSON</a></li><li class="sidebar-sub-header"><a href="/mssql/json-in-sql-server.html#index-on-json-properties-by-using-computed-columns" class="sidebar-link">Index on JSON properties by using computed columns</a></li><li class="sidebar-sub-header"><a href="/mssql/json-in-sql-server.html#format-one-table-row-as-a-single-json-object-using-for-json" class="sidebar-link">Format one table row as a single JSON object using FOR JSON</a></li><li class="sidebar-sub-header"><a href="/mssql/json-in-sql-server.html#parse-json-text-using-openjson-function" class="sidebar-link">Parse JSON text using OPENJSON function</a></li></ul></li><li><a href="/mssql/openjson.html" class="sidebar-link">OPENJSON</a></li><li><a href="/mssql/for-json.html" class="sidebar-link">FOR JSON</a></li><li><a href="/mssql/queries-with-json-data.html" class="sidebar-link">Queries with JSON data</a></li><li><a href="/mssql/storing-json-in-sql-tables.html" class="sidebar-link">Storing JSON in SQL tables</a></li><li><a href="/mssql/modify-json-text.html" class="sidebar-link">Modify JSON text</a></li><li><a href="/mssql/for-xml-path.html" class="sidebar-link">FOR XML PATH</a></li><li><a href="/mssql/join.html" class="sidebar-link">Join</a></li><li><a href="/mssql/cross-apply.html" class="sidebar-link">cross apply</a></li><li><a href="/mssql/computed-columns.html" class="sidebar-link">Computed Columns</a></li><li><a href="/mssql/common-table-expressions.html" class="sidebar-link">Common Table Expressions</a></li><li><a href="/mssql/move-and-copy-data-around-tables.html" class="sidebar-link">Move and copy data around tables</a></li><li><a href="/mssql/limit-result-set.html" class="sidebar-link">Limit Result Set</a></li><li><a href="/mssql/retrieve-information-about-your-instance.html" class="sidebar-link">Retrieve Information about your Instance</a></li><li><a href="/mssql/with-ties-option.html" class="sidebar-link">With Ties Option</a></li><li><a href="/mssql/string-functions.html" class="sidebar-link">String Functions</a></li><li><a href="/mssql/logical-functions.html" class="sidebar-link">Logical Functions</a></li><li><a href="/mssql/aggregate-functions.html" class="sidebar-link">Aggregate Functions</a></li><li><a href="/mssql/string-aggregate-functions-in-sql-server.html" class="sidebar-link">String Aggregate functions in SQL Server</a></li><li><a href="/mssql/ranking-functions.html" class="sidebar-link">Ranking Functions</a></li><li><a href="/mssql/window-functions.html" class="sidebar-link">Window functions</a></li><li><a href="/mssql/pivot-unpivot.html" class="sidebar-link">PIVOT / UNPIVOT</a></li><li><a href="/mssql/dynamic-sql-pivot.html" class="sidebar-link">Dynamic SQL Pivot</a></li><li><a href="/mssql/partitioning.html" class="sidebar-link">Partitioning</a></li><li><a href="/mssql/stored-procedures.html" class="sidebar-link">Stored Procedures</a></li><li><a href="/mssql/retrieve-information-about-the-database.html" class="sidebar-link">Retrieve information about the database</a></li><li><a href="/mssql/split-string-function-in-sql-server.html" class="sidebar-link">Split String function in Sql Server</a></li><li><a href="/mssql/insert.html" class="sidebar-link">Insert</a></li><li><a href="/mssql/primary-keys.html" class="sidebar-link">Primary Keys</a></li><li><a href="/mssql/foreign-keys.html" class="sidebar-link">Foreign Keys</a></li><li><a href="/mssql/last-inserted-identity.html" class="sidebar-link">Last Inserted Identity</a></li><li><a href="/mssql/scope-identity.html" class="sidebar-link">SCOPE_IDENTITY()</a></li><li><a href="/mssql/sequences.html" class="sidebar-link">Sequences</a></li><li><a href="/mssql/indexing.html" class="sidebar-link">Indexing</a></li><li><a href="/mssql/full-text-indexing.html" class="sidebar-link">Full-Text Indexing</a></li><li><a href="/mssql/trigger.html" class="sidebar-link">Trigger</a></li><li><a href="/mssql/cursors.html" class="sidebar-link">Cursors</a></li><li><a href="/mssql/transaction-isolation-levels.html" class="sidebar-link">Transaction isolation levels</a></li><li><a href="/mssql/advanced-options.html" class="sidebar-link">Advanced options</a></li><li><a href="/mssql/migration.html" class="sidebar-link">Migration</a></li><li><a href="/mssql/table-valued-parameters.html" class="sidebar-link">Table Valued Parameters</a></li><li><a href="/mssql/dbmail.html" class="sidebar-link">DBMAIL</a></li><li><a href="/mssql/in-memory-oltp-hekaton.html" class="sidebar-link">In-Memory OLTP (Hekaton)</a></li><li><a href="/mssql/temporal-tables.html" class="sidebar-link">Temporal Tables</a></li><li><a href="/mssql/use-of-temp-table.html" class="sidebar-link">Use of TEMP Table</a></li><li><a href="/mssql/scheduled-task-or-job.html" class="sidebar-link">Scheduled Task or Job</a></li><li><a href="/mssql/isolation-levels-and-locking.html" class="sidebar-link">Isolation levels and locking</a></li><li><a href="/mssql/sorting-ordering-rows.html" class="sidebar-link">Sorting/ordering rows</a></li><li><a href="/mssql/privileges-or-permissions.html" class="sidebar-link">Privileges or Permissions</a></li><li><a href="/mssql/sqlcmd.html" class="sidebar-link">SQLCMD</a></li><li><a href="/mssql/resource-governor.html" class="sidebar-link">Resource Governor</a></li><li><a href="/mssql/file-group.html" class="sidebar-link">File Group</a></li><li><a href="/mssql/basic-ddl-operations-in-ms-sql-server.html" class="sidebar-link">Basic DDL Operations in MS SQL Server</a></li><li><a href="/mssql/subqueries.html" class="sidebar-link">Subqueries</a></li><li><a href="/mssql/pagination.html" class="sidebar-link">Pagination</a></li><li><a href="/mssql/clustered-columnstore.html" class="sidebar-link">CLUSTERED COLUMNSTORE</a></li><li><a href="/mssql/parsename.html" class="sidebar-link">Parsename</a></li><li><a href="/mssql/installing-sql-server-on-windows.html" class="sidebar-link">Installing SQL Server on Windows</a></li><li><a href="/mssql/analyzing-a-query.html" class="sidebar-link">Analyzing a Query</a></li><li><a href="/mssql/query-hints.html" class="sidebar-link">Query Hints</a></li><li><a href="/mssql/query-store.html" class="sidebar-link">Query Store</a></li><li><a href="/mssql/querying-results-by-page.html" class="sidebar-link">Querying results by page</a></li><li><a href="/mssql/schemas.html" class="sidebar-link">Schemas</a></li><li><a href="/mssql/backup-and-restore-database.html" class="sidebar-link">Backup and Restore Database</a></li><li><a href="/mssql/transaction-handling.html" class="sidebar-link">Transaction handling</a></li><li><a href="/mssql/natively-compiled-modules-hekaton.html" class="sidebar-link">Natively compiled modules (Hekaton)</a></li><li><a href="/mssql/spatial-data.html" class="sidebar-link">Spatial Data</a></li><li><a href="/mssql/dynamic-sql.html" class="sidebar-link">Dynamic SQL</a></li><li><a href="/mssql/dynamic-data-masking.html" class="sidebar-link">Dynamic data masking</a></li><li><a href="/mssql/export-data-in-txt-file-by-using-sqlcmd.html" class="sidebar-link">Export data in txt file by using SQLCMD</a></li><li><a href="/mssql/common-language-runtime-integration.html" class="sidebar-link">Common Language Runtime Integration</a></li><li><a href="/mssql/delimiting-special-characters-and-reserved-words.html" class="sidebar-link">Delimiting special characters and reserved words</a></li><li><a href="/mssql/dbcc.html" class="sidebar-link">DBCC</a></li><li><a href="/mssql/bulk-import.html" class="sidebar-link">BULK Import</a></li><li><a href="/mssql/service-broker.html" class="sidebar-link">Service broker</a></li><li><a href="/mssql/permissions-and-security.html" class="sidebar-link">Permissions and Security</a></li><li><a href="/mssql/database-permissions.html" class="sidebar-link">Database permissions</a></li><li><a href="/mssql/row-level-security.html" class="sidebar-link">Row-level security</a></li><li><a href="/mssql/encryption.html" class="sidebar-link">Encryption</a></li><li><a href="/mssql/phantom-read.html" class="sidebar-link">PHANTOM read</a></li><li><a href="/mssql/filestream.html" class="sidebar-link">Filestream</a></li><li><a href="/mssql/bcp-bulk-copy-program-utility.html" class="sidebar-link">bcp (bulk copy program) Utility</a></li><li><a href="/mssql/sql-server-evolution-through-different-versions-2000-2016.html" class="sidebar-link">SQL Server Evolution through different versions (2000 - 2016)</a></li><li><a href="/mssql/sql-server-management-studio-ssms.html" class="sidebar-link">SQL Server Management Studio (SSMS)</a></li><li><a href="/mssql/managing-azure-sql-database.html" class="sidebar-link">Managing Azure SQL Database</a></li><li><a href="/mssql/system-database-tempdb.html" class="sidebar-link">System database - TempDb</a></li><li><a href="/mssql/microsoft-sql-server-management-studio-shortcut-keys.html" class="sidebar-link">Microsoft SQL Server Management Studio Shortcut Keys</a></li><li><a href="/mssql/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="json-in-sql-server"><a href="#json-in-sql-server" class="header-anchor">#</a> JSON in Sql Server</h1> <h2 id="format-query-results-as-json-with-for-json"><a href="#format-query-results-as-json-with-for-json" class="header-anchor">#</a> Format Query Results as JSON with FOR JSON</h2> <p>Input table data (People table)</p> <table><thead><tr><th>Id</th> <th>Name</th> <th>Age</th></tr></thead> <tbody><tr><td>1</td> <td>John</td> <td>23</td></tr> <tr><td>2</td> <td>Jane</td> <td>31</td></tr></tbody></table> <p>Query</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> Id<span class="token punctuation">,</span> Name<span class="token punctuation">,</span> Age
<span class="token keyword">FROM</span> People
<span class="token keyword">FOR</span> JSON PATH

</code></pre></div><p>Result</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token punctuation">[</span>
    {<span class="token string">&quot;Id&quot;</span>:<span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;Name&quot;</span>:<span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Age&quot;</span>:<span class="token number">23</span>}<span class="token punctuation">,</span>
    {<span class="token string">&quot;Id&quot;</span>:<span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&quot;Name&quot;</span>:<span class="token string">&quot;Jane&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Age&quot;</span>:<span class="token number">31</span>}
<span class="token punctuation">]</span>

</code></pre></div><h2 id="parse-json-text"><a href="#parse-json-text" class="header-anchor">#</a> Parse JSON text</h2> <p><strong>JSON_VALUE</strong> and <strong>JSON_QUERY</strong> functions parse JSON text and return scalar values or objects/arrays on the path in JSON text.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">DECLARE</span> <span class="token variable">@json</span> NVARCHAR<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">'{&quot;id&quot;: 1, &quot;user&quot;:{&quot;name&quot;:&quot;John&quot;}, &quot;skills&quot;:[&quot;C#&quot;,&quot;SQL&quot;]}'</span>

<span class="token keyword">SELECT</span>
    JSON_VALUE<span class="token punctuation">(</span><span class="token variable">@json</span><span class="token punctuation">,</span> <span class="token string">'$.id'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> Id<span class="token punctuation">,</span>
    JSON_VALUE<span class="token punctuation">(</span><span class="token variable">@json</span><span class="token punctuation">,</span> <span class="token string">'$.user.name'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> Name<span class="token punctuation">,</span>
    JSON_QUERY<span class="token punctuation">(</span><span class="token variable">@json</span><span class="token punctuation">,</span> <span class="token string">'$.user'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> UserObject<span class="token punctuation">,</span>
    JSON_QUERY<span class="token punctuation">(</span><span class="token variable">@json</span><span class="token punctuation">,</span> <span class="token string">'$.skills'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> Skills<span class="token punctuation">,</span>
    JSON_VALUE<span class="token punctuation">(</span><span class="token variable">@json</span><span class="token punctuation">,</span> <span class="token string">'$.skills[0]'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> Skill0

</code></pre></div><p><strong>Result</strong></p> <table><thead><tr><th>Id</th> <th>Name</th> <th>UserObject</th> <th>Skills</th> <th>Skill0</th></tr></thead> <tbody><tr><td>1</td> <td>John</td> <td>{&quot;name&quot;:&quot;John&quot;}</td> <td>[&quot;C#&quot;,&quot;SQL&quot;]</td> <td>C#</td></tr></tbody></table> <h2 id="join-parent-and-child-json-entities-using-cross-apply-openjson"><a href="#join-parent-and-child-json-entities-using-cross-apply-openjson" class="header-anchor">#</a> Join parent and child JSON entities using CROSS APPLY OPENJSON</h2> <p>Join parent objects with their child entities, for example we want a relational table of each person and their hobbies</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">DECLARE</span> <span class="token variable">@json</span> nvarchar<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">=</span>
N<span class="token string">'[
    {
        &quot;id&quot;:1,
        &quot;user&quot;:{&quot;name&quot;:&quot;John&quot;},
        &quot;hobbies&quot;:[
            {&quot;name&quot;: &quot;Reading&quot;},
            {&quot;name&quot;: &quot;Surfing&quot;}
        ]
    },
    {
        &quot;id&quot;:2,
        &quot;user&quot;:{&quot;name&quot;:&quot;Jane&quot;},
        &quot;hobbies&quot;:[
            {&quot;name&quot;: &quot;Programming&quot;},
            {&quot;name&quot;: &quot;Running&quot;}
        ]
    }
 ]'</span>

</code></pre></div><p><strong>Query</strong></p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> 
    JSON_VALUE<span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token keyword">value</span><span class="token punctuation">,</span> <span class="token string">'$.id'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> Id<span class="token punctuation">,</span>
    JSON_VALUE<span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token keyword">value</span><span class="token punctuation">,</span> <span class="token string">'$.user.name'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> PersonName<span class="token punctuation">,</span>
    JSON_VALUE<span class="token punctuation">(</span>hobbies<span class="token punctuation">.</span><span class="token keyword">value</span><span class="token punctuation">,</span> <span class="token string">'$.name'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> Hobby
<span class="token keyword">FROM</span> OPENJSON <span class="token punctuation">(</span><span class="token variable">@json</span><span class="token punctuation">)</span> <span class="token keyword">as</span> person
    <span class="token keyword">CROSS</span> <span class="token keyword">APPLY</span> OPENJSON<span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token keyword">value</span><span class="token punctuation">,</span> <span class="token string">'$.hobbies'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> hobbies

</code></pre></div><p>Alternatively this query can be written using the WITH clause.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> 
    Id<span class="token punctuation">,</span> person<span class="token punctuation">.</span>PersonName<span class="token punctuation">,</span> Hobby
<span class="token keyword">FROM</span> OPENJSON <span class="token punctuation">(</span><span class="token variable">@json</span><span class="token punctuation">)</span>
<span class="token keyword">WITH</span><span class="token punctuation">(</span>
    Id <span class="token keyword">int</span> <span class="token string">'$.id'</span><span class="token punctuation">,</span>
    PersonName nvarchar<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token string">'$.user.name'</span><span class="token punctuation">,</span>
    Hobbies nvarchar<span class="token punctuation">(</span>max<span class="token punctuation">)</span> <span class="token string">'$.hobbies'</span> <span class="token keyword">AS</span> JSON
<span class="token punctuation">)</span> <span class="token keyword">as</span> person
<span class="token keyword">CROSS</span> <span class="token keyword">APPLY</span> OPENJSON<span class="token punctuation">(</span>Hobbies<span class="token punctuation">)</span>
<span class="token keyword">WITH</span><span class="token punctuation">(</span>
    Hobby nvarchar<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token string">'$.name'</span>
<span class="token punctuation">)</span>

</code></pre></div><p><strong>Result</strong></p> <table><thead><tr><th>Id</th> <th>PersonName</th> <th>Hobby</th></tr></thead> <tbody><tr><td>1</td> <td>John</td> <td>Reading</td></tr> <tr><td>1</td> <td>John</td> <td>Surfing</td></tr> <tr><td>2</td> <td>Jane</td> <td>Programming</td></tr> <tr><td>2</td> <td>Jane</td> <td>Running</td></tr></tbody></table> <h2 id="index-on-json-properties-by-using-computed-columns"><a href="#index-on-json-properties-by-using-computed-columns" class="header-anchor">#</a> Index on JSON properties by using computed columns</h2> <p>When storing JSON documents in SQL Server, We need to be able to efficiently filter and sort query results on properties of the JSON documents.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> JsonTable
<span class="token punctuation">(</span>
    id <span class="token keyword">int</span> <span class="token keyword">identity</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
    jsonInfo nvarchar<span class="token punctuation">(</span>max<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">CONSTRAINT</span> <span class="token punctuation">[</span>Content should be formatted <span class="token keyword">as</span> JSON<span class="token punctuation">]</span>
    <span class="token keyword">CHECK</span> <span class="token punctuation">(</span>ISJSON<span class="token punctuation">(</span>jsonInfo<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>

</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> JsonTable
<span class="token keyword">VALUES</span><span class="token punctuation">(</span>N<span class="token string">'{&quot;Name&quot;:&quot;John&quot;,&quot;Age&quot;:23}'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span>N<span class="token string">'{&quot;Name&quot;:&quot;Jane&quot;,&quot;Age&quot;:31}'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span>N<span class="token string">'{&quot;Name&quot;:&quot;Bob&quot;,&quot;Age&quot;:37}'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span>N<span class="token string">'{&quot;Name&quot;:&quot;Adam&quot;,&quot;Age&quot;:65}'</span><span class="token punctuation">)</span>
GO

</code></pre></div><p>Given the above table If we want to find the row with the name = 'Adam', we would execute the following query.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> 
<span class="token keyword">FROM</span> JsonTable <span class="token keyword">Where</span> 
JSON_VALUE<span class="token punctuation">(</span>jsonInfo<span class="token punctuation">,</span> <span class="token string">'$.Name'</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">'Adam'</span>

</code></pre></div><p>However this will require SQL server to perform a full table which on a large table is not efficent.</p> <p>To speed this up we would like to add an index, however we cannot directly reference properties in the JSON document. The solution is to add a computed column on the JSON path <code>$.Name</code>, then add an index on the computed column.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> JsonTable
<span class="token keyword">ADD</span> vName <span class="token keyword">as</span> JSON_VALUE<span class="token punctuation">(</span>jsonInfo<span class="token punctuation">,</span> <span class="token string">'$.Name'</span><span class="token punctuation">)</span>

<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> idx_name
<span class="token keyword">ON</span> JsonTable<span class="token punctuation">(</span>vName<span class="token punctuation">)</span>

</code></pre></div><p>Now when we execute the same query, instead of a full table scan SQL server uses an index to seek into the non-clustered index and find the rows that satisfy the specified conditions.</p> <p>Note: For SQL server to use the index, you must create the computed column with the same expression that you plan to use in your queries - in this example <code>JSON_VALUE(jsonInfo, '$.Name')</code>, however you can also use the name of computed column <code>vName</code></p> <h2 id="format-one-table-row-as-a-single-json-object-using-for-json"><a href="#format-one-table-row-as-a-single-json-object-using-for-json" class="header-anchor">#</a> Format one table row as a single JSON object using FOR JSON</h2> <p><strong>WITHOUT_ARRAY_WRAPPER</strong> option in <strong>FOR JSON</strong> clause will remove array brackets from the JSON output. This is useful if you are returning single row in the query.</p> <blockquote></blockquote> <p>Note: this option will produce invalid JSON output if more than one row is returned.</p> <p>Input table data (People table)</p> <table><thead><tr><th>Id</th> <th>Name</th> <th>Age</th></tr></thead> <tbody><tr><td>1</td> <td>John</td> <td>23</td></tr> <tr><td>2</td> <td>Jane</td> <td>31</td></tr></tbody></table> <p>Query</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> Id<span class="token punctuation">,</span> Name<span class="token punctuation">,</span> Age
<span class="token keyword">FROM</span> People
<span class="token keyword">WHERE</span> Id <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">FOR</span> JSON PATH<span class="token punctuation">,</span> WITHOUT_ARRAY_WRAPPER

</code></pre></div><p>Result</p> <div class="language-sql extra-class"><pre class="language-sql"><code>{<span class="token string">&quot;Id&quot;</span>:<span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;Name&quot;</span>:<span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Age&quot;</span>:<span class="token number">23</span>}

</code></pre></div><h2 id="parse-json-text-using-openjson-function"><a href="#parse-json-text-using-openjson-function" class="header-anchor">#</a> Parse JSON text using OPENJSON function</h2> <p><strong>OPENJSON</strong> function parses JSON text and returns multiple outputs. Values that should be returned are specified using the paths defined in the WITH clause. If a path is not specified for some column, the column name is used as a path. This function casts returned values to the SQL types defined in the WITH clause. AS JSON option must be specified in the column definition if some object/array should be returned.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">DECLARE</span> <span class="token variable">@json</span> NVARCHAR<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">'{&quot;id&quot;: 1, &quot;user&quot;:{&quot;name&quot;:&quot;John&quot;}, &quot;skills&quot;:[&quot;C#&quot;,&quot;SQL&quot;]}'</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> 
<span class="token keyword">FROM</span> OPENJSON <span class="token punctuation">(</span><span class="token variable">@json</span><span class="token punctuation">)</span>
    <span class="token keyword">WITH</span><span class="token punctuation">(</span>Id <span class="token keyword">int</span> <span class="token string">'$.id'</span><span class="token punctuation">,</span>
        Name nvarchar<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token string">'$.user.name'</span><span class="token punctuation">,</span>
        UserObject nvarchar<span class="token punctuation">(</span>max<span class="token punctuation">)</span> <span class="token string">'$.user'</span> <span class="token keyword">AS</span> JSON<span class="token punctuation">,</span>
        Skills nvarchar<span class="token punctuation">(</span>max<span class="token punctuation">)</span> <span class="token string">'$.skills'</span> <span class="token keyword">AS</span> JSON<span class="token punctuation">,</span>
        Skill0 nvarchar<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token string">'$.skills[0]'</span><span class="token punctuation">)</span>

</code></pre></div><p><strong>Result</strong></p> <table><thead><tr><th>Id</th> <th>Name</th> <th>UserObject</th> <th>Skills</th> <th>Skill0</th></tr></thead> <tbody><tr><td>1</td> <td>John</td> <td>{&quot;name&quot;:&quot;John&quot;}</td> <td>[&quot;C#&quot;,&quot;SQL&quot;]</td> <td>C#</td></tr></tbody></table> <h4 id="syntax"><a href="#syntax" class="header-anchor">#</a> Syntax</h4> <ul><li><strong>JSON_VALUE</strong>(expression , path) -- extract a scalar value from a JSON string.</li> <li><strong>JSON_QUERY</strong>( expression [ , path ] ) -- Extracts an object or an array from a JSON string.</li> <li><strong>OPENJSON</strong>( jsonExpression [ , path ] ) -- table-value function that parses JSON text and returns objects and properties in JSON as rows and columns.</li> <li><strong>ISJSON</strong>( expression ) -- Tests whether a string contains valid JSON.</li> <li><strong>JSON_MODIFY</strong>( expression , path , newValue ) -- Updates the value of a property in a JSON string and returns the updated JSON string.</li></ul> <h4 id="parameters"><a href="#parameters" class="header-anchor">#</a> Parameters</h4> <table><thead><tr><th>Parameters</th> <th>Details</th></tr></thead> <tbody><tr><td>expression</td> <td>Typically the name of a variable or a column that contains JSON text.</td></tr> <tr><td>path</td> <td>A JSON path expression that specifies the property to update. path has the following syntax: [append] [ lax</td></tr> <tr><td>jsonExpression</td> <td>Is a Unicode character expression containing the JSON text.</td></tr></tbody></table> <h4 id="remarks"><a href="#remarks" class="header-anchor">#</a> Remarks</h4> <p>The OPENJSON function is only available under compatibility level 130. If your database compatibility level is lower than 130, SQL Server will not be able to find and execute OPENJSON function. Currently all Azure SQL databases are set to 120 by default.
You can change the compatibility level of a database using the following command:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">DATABASE</span> <span class="token operator">&lt;</span><span class="token keyword">Database</span><span class="token operator">-</span>Name<span class="token operator">-</span>Here<span class="token operator">&gt;</span> <span class="token keyword">SET</span> COMPATIBILITY_LEVEL <span class="token operator">=</span> <span class="token number">130</span>

</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/mssql/json-in-sql-server.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/mssql/the-stuff-function.html" class="prev">
        The STUFF Function
      </a></span> <span class="next"><a href="/mssql/openjson.html">
        OPENJSON
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/2021.516f69d4.js" defer></script>
  </body>
</html>
