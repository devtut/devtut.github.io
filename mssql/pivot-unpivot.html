<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Microsoft SQL Server - PIVOT / UNPIVOT</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="Simple PIVOT & UNPIVOT (T-SQL), Dynamic PIVOT, Simple Pivot - Static Columns">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="Microsoft SQL Server - PIVOT / UNPIVOT">
    <meta property="og:description" content="Simple PIVOT & UNPIVOT (T-SQL), Dynamic PIVOT, Simple Pivot - Static Columns">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/mssql/pivot-unpivot.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="Microsoft SQL Server - PIVOT / UNPIVOT">
    <meta name="twitter:description" content="Simple PIVOT & UNPIVOT (T-SQL), Dynamic PIVOT, Simple Pivot - Static Columns">
    <meta name="twitter:url" content="/mssql/pivot-unpivot.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/2041.a66241c7.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>MS SQL Server</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mssql/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/mssql/getting-started-with-microsoft-sql-server.html" class="sidebar-link">Getting started with Microsoft SQL Server</a></li><li><a href="/mssql/data-types.html" class="sidebar-link">Data Types</a></li><li><a href="/mssql/converting-data-types.html" class="sidebar-link">Converting data types</a></li><li><a href="/mssql/user-defined-table-types.html" class="sidebar-link">User Defined Table Types</a></li><li><a href="/mssql/select-statement.html" class="sidebar-link">SELECT statement</a></li><li><a href="/mssql/alias-names-in-sql-server.html" class="sidebar-link">Alias Names in Sql Server</a></li><li><a href="/mssql/nulls.html" class="sidebar-link">NULLs</a></li><li><a href="/mssql/variables.html" class="sidebar-link">Variables</a></li><li><a href="/mssql/dates.html" class="sidebar-link">Dates</a></li><li><a href="/mssql/generating-a-range-of-dates.html" class="sidebar-link">Generating a range of dates</a></li><li><a href="/mssql/database-snapshots.html" class="sidebar-link">Database Snapshots</a></li><li><a href="/mssql/coalesce.html" class="sidebar-link">COALESCE</a></li><li><a href="/mssql/if-else.html" class="sidebar-link">IF...ELSE</a></li><li><a href="/mssql/case-statement.html" class="sidebar-link">CASE Statement</a></li><li><a href="/mssql/insert-into.html" class="sidebar-link">INSERT INTO</a></li><li><a href="/mssql/drop-keyword.html" class="sidebar-link">Drop Keyword</a></li><li><a href="/mssql/merge.html" class="sidebar-link">MERGE</a></li><li><a href="/mssql/create-view.html" class="sidebar-link">CREATE VIEW</a></li><li><a href="/mssql/views.html" class="sidebar-link">Views</a></li><li><a href="/mssql/union.html" class="sidebar-link">UNION</a></li><li><a href="/mssql/try-catch.html" class="sidebar-link">TRY/CATCH</a></li><li><a href="/mssql/while-loop.html" class="sidebar-link">WHILE loop</a></li><li><a href="/mssql/over-clause.html" class="sidebar-link">OVER Clause</a></li><li><a href="/mssql/group-by.html" class="sidebar-link">GROUP BY</a></li><li><a href="/mssql/order-by.html" class="sidebar-link">ORDER BY</a></li><li><a href="/mssql/the-stuff-function.html" class="sidebar-link">The STUFF Function</a></li><li><a href="/mssql/json-in-sql-server.html" class="sidebar-link">JSON in Sql Server</a></li><li><a href="/mssql/openjson.html" class="sidebar-link">OPENJSON</a></li><li><a href="/mssql/for-json.html" class="sidebar-link">FOR JSON</a></li><li><a href="/mssql/queries-with-json-data.html" class="sidebar-link">Queries with JSON data</a></li><li><a href="/mssql/storing-json-in-sql-tables.html" class="sidebar-link">Storing JSON in SQL tables</a></li><li><a href="/mssql/modify-json-text.html" class="sidebar-link">Modify JSON text</a></li><li><a href="/mssql/for-xml-path.html" class="sidebar-link">FOR XML PATH</a></li><li><a href="/mssql/join.html" class="sidebar-link">Join</a></li><li><a href="/mssql/cross-apply.html" class="sidebar-link">cross apply</a></li><li><a href="/mssql/computed-columns.html" class="sidebar-link">Computed Columns</a></li><li><a href="/mssql/common-table-expressions.html" class="sidebar-link">Common Table Expressions</a></li><li><a href="/mssql/move-and-copy-data-around-tables.html" class="sidebar-link">Move and copy data around tables</a></li><li><a href="/mssql/limit-result-set.html" class="sidebar-link">Limit Result Set</a></li><li><a href="/mssql/retrieve-information-about-your-instance.html" class="sidebar-link">Retrieve Information about your Instance</a></li><li><a href="/mssql/with-ties-option.html" class="sidebar-link">With Ties Option</a></li><li><a href="/mssql/string-functions.html" class="sidebar-link">String Functions</a></li><li><a href="/mssql/logical-functions.html" class="sidebar-link">Logical Functions</a></li><li><a href="/mssql/aggregate-functions.html" class="sidebar-link">Aggregate Functions</a></li><li><a href="/mssql/string-aggregate-functions-in-sql-server.html" class="sidebar-link">String Aggregate functions in SQL Server</a></li><li><a href="/mssql/ranking-functions.html" class="sidebar-link">Ranking Functions</a></li><li><a href="/mssql/window-functions.html" class="sidebar-link">Window functions</a></li><li><a href="/mssql/pivot-unpivot.html" aria-current="page" class="active sidebar-link">PIVOT / UNPIVOT</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mssql/pivot-unpivot.html#simple-pivot-unpivot-t-sql" class="sidebar-link">Simple PIVOT &amp; UNPIVOT (T-SQL)</a></li><li class="sidebar-sub-header"><a href="/mssql/pivot-unpivot.html#dynamic-pivot" class="sidebar-link">Dynamic PIVOT</a></li><li class="sidebar-sub-header"><a href="/mssql/pivot-unpivot.html#simple-pivot-static-columns" class="sidebar-link">Simple Pivot - Static Columns</a></li></ul></li><li><a href="/mssql/dynamic-sql-pivot.html" class="sidebar-link">Dynamic SQL Pivot</a></li><li><a href="/mssql/partitioning.html" class="sidebar-link">Partitioning</a></li><li><a href="/mssql/stored-procedures.html" class="sidebar-link">Stored Procedures</a></li><li><a href="/mssql/retrieve-information-about-the-database.html" class="sidebar-link">Retrieve information about the database</a></li><li><a href="/mssql/split-string-function-in-sql-server.html" class="sidebar-link">Split String function in Sql Server</a></li><li><a href="/mssql/insert.html" class="sidebar-link">Insert</a></li><li><a href="/mssql/primary-keys.html" class="sidebar-link">Primary Keys</a></li><li><a href="/mssql/foreign-keys.html" class="sidebar-link">Foreign Keys</a></li><li><a href="/mssql/last-inserted-identity.html" class="sidebar-link">Last Inserted Identity</a></li><li><a href="/mssql/scope-identity.html" class="sidebar-link">SCOPE_IDENTITY()</a></li><li><a href="/mssql/sequences.html" class="sidebar-link">Sequences</a></li><li><a href="/mssql/indexing.html" class="sidebar-link">Indexing</a></li><li><a href="/mssql/full-text-indexing.html" class="sidebar-link">Full-Text Indexing</a></li><li><a href="/mssql/trigger.html" class="sidebar-link">Trigger</a></li><li><a href="/mssql/cursors.html" class="sidebar-link">Cursors</a></li><li><a href="/mssql/transaction-isolation-levels.html" class="sidebar-link">Transaction isolation levels</a></li><li><a href="/mssql/advanced-options.html" class="sidebar-link">Advanced options</a></li><li><a href="/mssql/migration.html" class="sidebar-link">Migration</a></li><li><a href="/mssql/table-valued-parameters.html" class="sidebar-link">Table Valued Parameters</a></li><li><a href="/mssql/dbmail.html" class="sidebar-link">DBMAIL</a></li><li><a href="/mssql/in-memory-oltp-hekaton.html" class="sidebar-link">In-Memory OLTP (Hekaton)</a></li><li><a href="/mssql/temporal-tables.html" class="sidebar-link">Temporal Tables</a></li><li><a href="/mssql/use-of-temp-table.html" class="sidebar-link">Use of TEMP Table</a></li><li><a href="/mssql/scheduled-task-or-job.html" class="sidebar-link">Scheduled Task or Job</a></li><li><a href="/mssql/isolation-levels-and-locking.html" class="sidebar-link">Isolation levels and locking</a></li><li><a href="/mssql/sorting-ordering-rows.html" class="sidebar-link">Sorting/ordering rows</a></li><li><a href="/mssql/privileges-or-permissions.html" class="sidebar-link">Privileges or Permissions</a></li><li><a href="/mssql/sqlcmd.html" class="sidebar-link">SQLCMD</a></li><li><a href="/mssql/resource-governor.html" class="sidebar-link">Resource Governor</a></li><li><a href="/mssql/file-group.html" class="sidebar-link">File Group</a></li><li><a href="/mssql/basic-ddl-operations-in-ms-sql-server.html" class="sidebar-link">Basic DDL Operations in MS SQL Server</a></li><li><a href="/mssql/subqueries.html" class="sidebar-link">Subqueries</a></li><li><a href="/mssql/pagination.html" class="sidebar-link">Pagination</a></li><li><a href="/mssql/clustered-columnstore.html" class="sidebar-link">CLUSTERED COLUMNSTORE</a></li><li><a href="/mssql/parsename.html" class="sidebar-link">Parsename</a></li><li><a href="/mssql/installing-sql-server-on-windows.html" class="sidebar-link">Installing SQL Server on Windows</a></li><li><a href="/mssql/analyzing-a-query.html" class="sidebar-link">Analyzing a Query</a></li><li><a href="/mssql/query-hints.html" class="sidebar-link">Query Hints</a></li><li><a href="/mssql/query-store.html" class="sidebar-link">Query Store</a></li><li><a href="/mssql/querying-results-by-page.html" class="sidebar-link">Querying results by page</a></li><li><a href="/mssql/schemas.html" class="sidebar-link">Schemas</a></li><li><a href="/mssql/backup-and-restore-database.html" class="sidebar-link">Backup and Restore Database</a></li><li><a href="/mssql/transaction-handling.html" class="sidebar-link">Transaction handling</a></li><li><a href="/mssql/natively-compiled-modules-hekaton.html" class="sidebar-link">Natively compiled modules (Hekaton)</a></li><li><a href="/mssql/spatial-data.html" class="sidebar-link">Spatial Data</a></li><li><a href="/mssql/dynamic-sql.html" class="sidebar-link">Dynamic SQL</a></li><li><a href="/mssql/dynamic-data-masking.html" class="sidebar-link">Dynamic data masking</a></li><li><a href="/mssql/export-data-in-txt-file-by-using-sqlcmd.html" class="sidebar-link">Export data in txt file by using SQLCMD</a></li><li><a href="/mssql/common-language-runtime-integration.html" class="sidebar-link">Common Language Runtime Integration</a></li><li><a href="/mssql/delimiting-special-characters-and-reserved-words.html" class="sidebar-link">Delimiting special characters and reserved words</a></li><li><a href="/mssql/dbcc.html" class="sidebar-link">DBCC</a></li><li><a href="/mssql/bulk-import.html" class="sidebar-link">BULK Import</a></li><li><a href="/mssql/service-broker.html" class="sidebar-link">Service broker</a></li><li><a href="/mssql/permissions-and-security.html" class="sidebar-link">Permissions and Security</a></li><li><a href="/mssql/database-permissions.html" class="sidebar-link">Database permissions</a></li><li><a href="/mssql/row-level-security.html" class="sidebar-link">Row-level security</a></li><li><a href="/mssql/encryption.html" class="sidebar-link">Encryption</a></li><li><a href="/mssql/phantom-read.html" class="sidebar-link">PHANTOM read</a></li><li><a href="/mssql/filestream.html" class="sidebar-link">Filestream</a></li><li><a href="/mssql/bcp-bulk-copy-program-utility.html" class="sidebar-link">bcp (bulk copy program) Utility</a></li><li><a href="/mssql/sql-server-evolution-through-different-versions-2000-2016.html" class="sidebar-link">SQL Server Evolution through different versions (2000 - 2016)</a></li><li><a href="/mssql/sql-server-management-studio-ssms.html" class="sidebar-link">SQL Server Management Studio (SSMS)</a></li><li><a href="/mssql/managing-azure-sql-database.html" class="sidebar-link">Managing Azure SQL Database</a></li><li><a href="/mssql/system-database-tempdb.html" class="sidebar-link">System database - TempDb</a></li><li><a href="/mssql/microsoft-sql-server-management-studio-shortcut-keys.html" class="sidebar-link">Microsoft SQL Server Management Studio Shortcut Keys</a></li><li><a href="/mssql/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="pivot-unpivot"><a href="#pivot-unpivot" class="header-anchor">#</a> PIVOT / UNPIVOT</h1> <h2 id="simple-pivot-unpivot-t-sql"><a href="#simple-pivot-unpivot-t-sql" class="header-anchor">#</a> Simple PIVOT &amp; UNPIVOT (T-SQL)</h2> <p>Below is a simple example which shows average item's price of each item per weekday.</p> <p>First, suppose we have a table which keeps daily records of all items' prices.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> tbl_stock<span class="token punctuation">(</span>item NVARCHAR<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> weekday NVARCHAR<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> price <span class="token keyword">INT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tbl_stock <span class="token keyword">VALUES</span> 
<span class="token punctuation">(</span><span class="token string">'Item1'</span><span class="token punctuation">,</span> <span class="token string">'Mon'</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Item2'</span><span class="token punctuation">,</span> <span class="token string">'Mon'</span><span class="token punctuation">,</span> <span class="token number">230</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Item3'</span><span class="token punctuation">,</span> <span class="token string">'Mon'</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
<span class="token punctuation">(</span><span class="token string">'Item1'</span><span class="token punctuation">,</span> <span class="token string">'Tue'</span><span class="token punctuation">,</span> <span class="token number">115</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Item2'</span><span class="token punctuation">,</span> <span class="token string">'Tue'</span><span class="token punctuation">,</span> <span class="token number">231</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Item3'</span><span class="token punctuation">,</span> <span class="token string">'Tue'</span><span class="token punctuation">,</span> <span class="token number">162</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
<span class="token punctuation">(</span><span class="token string">'Item1'</span><span class="token punctuation">,</span> <span class="token string">'Wed'</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Item2'</span><span class="token punctuation">,</span> <span class="token string">'Wed'</span><span class="token punctuation">,</span> <span class="token number">240</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Item3'</span><span class="token punctuation">,</span> <span class="token string">'Wed'</span><span class="token punctuation">,</span> <span class="token number">162</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
<span class="token punctuation">(</span><span class="token string">'Item1'</span><span class="token punctuation">,</span> <span class="token string">'Thu'</span><span class="token punctuation">,</span> <span class="token number">109</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Item2'</span><span class="token punctuation">,</span> <span class="token string">'Thu'</span><span class="token punctuation">,</span> <span class="token number">228</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Item3'</span><span class="token punctuation">,</span> <span class="token string">'Thu'</span><span class="token punctuation">,</span> <span class="token number">145</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
<span class="token punctuation">(</span><span class="token string">'Item1'</span><span class="token punctuation">,</span> <span class="token string">'Fri'</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Item2'</span><span class="token punctuation">,</span> <span class="token string">'Fri'</span><span class="token punctuation">,</span> <span class="token number">210</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Item3'</span><span class="token punctuation">,</span> <span class="token string">'Fri'</span><span class="token punctuation">,</span> <span class="token number">125</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'Item1'</span><span class="token punctuation">,</span> <span class="token string">'Mon'</span><span class="token punctuation">,</span> <span class="token number">122</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Item2'</span><span class="token punctuation">,</span> <span class="token string">'Mon'</span><span class="token punctuation">,</span> <span class="token number">225</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Item3'</span><span class="token punctuation">,</span> <span class="token string">'Mon'</span><span class="token punctuation">,</span> <span class="token number">140</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'Item1'</span><span class="token punctuation">,</span> <span class="token string">'Tue'</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Item2'</span><span class="token punctuation">,</span> <span class="token string">'Tue'</span><span class="token punctuation">,</span> <span class="token number">235</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Item3'</span><span class="token punctuation">,</span> <span class="token string">'Tue'</span><span class="token punctuation">,</span> <span class="token number">154</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'Item1'</span><span class="token punctuation">,</span> <span class="token string">'Wed'</span><span class="token punctuation">,</span> <span class="token number">125</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Item2'</span><span class="token punctuation">,</span> <span class="token string">'Wed'</span><span class="token punctuation">,</span> <span class="token number">220</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Item3'</span><span class="token punctuation">,</span> <span class="token string">'Wed'</span><span class="token punctuation">,</span> <span class="token number">142</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>The table should look like below:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token operator">+</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">+</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">+</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">+</span>
<span class="token operator">|</span>   item <span class="token operator">|</span> weekday <span class="token operator">|</span> price <span class="token operator">|</span>
<span class="token operator">+</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">+</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">+</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">+</span>
<span class="token operator">|</span>  Item1 <span class="token operator">|</span>    Mon  <span class="token operator">|</span>   <span class="token number">110</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+---------+-------+</span>
<span class="token operator">|</span>  Item2 <span class="token operator">|</span>    Mon  <span class="token operator">|</span>   <span class="token number">230</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+---------+-------+</span>
<span class="token operator">|</span>  Item3 <span class="token operator">|</span>    Mon  <span class="token operator">|</span>   <span class="token number">150</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+---------+-------+</span>
<span class="token operator">|</span>  Item1 <span class="token operator">|</span>    Tue  <span class="token operator">|</span>   <span class="token number">115</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+---------+-------+</span>
<span class="token operator">|</span>  Item2 <span class="token operator">|</span>    Tue  <span class="token operator">|</span>   <span class="token number">231</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+---------+-------+</span>
<span class="token operator">|</span>  Item3 <span class="token operator">|</span>    Tue  <span class="token operator">|</span>   <span class="token number">162</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+---------+-------+</span>
<span class="token operator">|</span>          <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span>           <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+---------+-------+</span>
<span class="token operator">|</span>  Item2 <span class="token operator">|</span>    Wed  <span class="token operator">|</span>   <span class="token number">220</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+---------+-------+</span>
<span class="token operator">|</span>  Item3 <span class="token operator">|</span>    Wed  <span class="token operator">|</span>   <span class="token number">142</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+---------+-------+</span>

</code></pre></div><p>In order to perform aggregation which is to find the average price per item for each week day, we are going to use the relational operator <code>PIVOT</code> to rotate the column <code>weekday</code> of table-valued expression into aggregated row values as below:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tbl_stock
<span class="token keyword">PIVOT</span> <span class="token punctuation">(</span> 
    <span class="token function">AVG</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token keyword">FOR</span> weekday <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>Mon<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>Tue<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>Wed<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>Thu<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>Fri<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> pvt<span class="token punctuation">;</span>

</code></pre></div><p>Result:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token operator">+</span><span class="token comment">--------+------+------+------+------+------+</span>
<span class="token operator">|</span>  item  <span class="token operator">|</span>  Mon <span class="token operator">|</span>  Tue <span class="token operator">|</span>  Wed <span class="token operator">|</span>  Thu <span class="token operator">|</span>  Fri <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+------+------+------+------+------+</span>
<span class="token operator">|</span>  Item1 <span class="token operator">|</span>  <span class="token number">116</span> <span class="token operator">|</span>  <span class="token number">112</span> <span class="token operator">|</span>  <span class="token number">117</span> <span class="token operator">|</span>  <span class="token number">109</span> <span class="token operator">|</span>  <span class="token number">120</span> <span class="token operator">|</span>
<span class="token operator">|</span>  Item2 <span class="token operator">|</span>  <span class="token number">227</span> <span class="token operator">|</span>  <span class="token number">233</span> <span class="token operator">|</span>  <span class="token number">230</span> <span class="token operator">|</span>  <span class="token number">228</span> <span class="token operator">|</span>  <span class="token number">210</span> <span class="token operator">|</span>
<span class="token operator">|</span>  Item3 <span class="token operator">|</span>  <span class="token number">145</span> <span class="token operator">|</span>  <span class="token number">158</span> <span class="token operator">|</span>  <span class="token number">152</span> <span class="token operator">|</span>  <span class="token number">145</span> <span class="token operator">|</span>  <span class="token number">125</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+------+------+------+------+------+</span>

</code></pre></div><p>Lastly, in order to perform the reverse operation of <code>PIVOT</code>, we can use the relational operator <code>UNPIVOT</code> to rotate columns into rows as below:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tbl_stock
<span class="token keyword">PIVOT</span> <span class="token punctuation">(</span> 
    <span class="token function">AVG</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token keyword">FOR</span> weekday <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>Mon<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>Tue<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>Wed<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>Thu<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>Fri<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> pvt
<span class="token keyword">UNPIVOT</span> <span class="token punctuation">(</span> 
    price <span class="token keyword">FOR</span> weekday <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>Mon<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>Tue<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>Wed<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>Thu<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>Fri<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> unpvt<span class="token punctuation">;</span>

</code></pre></div><p>Result:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token operator">+</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">+</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">+</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">+</span>
<span class="token operator">|</span>  item <span class="token operator">|</span>  price <span class="token operator">|</span> weekday <span class="token operator">|</span>
<span class="token operator">+</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">+</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">+</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">+</span>
<span class="token operator">|</span> Item1 <span class="token operator">|</span>    <span class="token number">116</span> <span class="token operator">|</span>     Mon <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+---------+</span>
<span class="token operator">|</span> Item1 <span class="token operator">|</span>    <span class="token number">112</span> <span class="token operator">|</span>     Tue <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+---------+</span>
<span class="token operator">|</span> Item1 <span class="token operator">|</span>    <span class="token number">117</span> <span class="token operator">|</span>     Wed <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+---------+</span>
<span class="token operator">|</span> Item1 <span class="token operator">|</span>    <span class="token number">109</span> <span class="token operator">|</span>     Thu <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+---------+</span>
<span class="token operator">|</span> Item1 <span class="token operator">|</span>    <span class="token number">120</span> <span class="token operator">|</span>     Fri <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+---------+</span>
<span class="token operator">|</span> Item2 <span class="token operator">|</span>    <span class="token number">227</span> <span class="token operator">|</span>     Mon <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+---------+</span>
<span class="token operator">|</span> Item2 <span class="token operator">|</span>    <span class="token number">233</span> <span class="token operator">|</span>     Tue <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+---------+</span>
<span class="token operator">|</span> Item2 <span class="token operator">|</span>    <span class="token number">230</span> <span class="token operator">|</span>     Wed <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+---------+</span>
<span class="token operator">|</span> Item2 <span class="token operator">|</span>    <span class="token number">228</span> <span class="token operator">|</span>     Thu <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+---------+</span>
<span class="token operator">|</span> Item2 <span class="token operator">|</span>    <span class="token number">210</span> <span class="token operator">|</span>     Fri <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+---------+</span>
<span class="token operator">|</span> Item3 <span class="token operator">|</span>    <span class="token number">145</span> <span class="token operator">|</span>     Mon <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+---------+</span>
<span class="token operator">|</span> Item3 <span class="token operator">|</span>    <span class="token number">158</span> <span class="token operator">|</span>     Tue <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+---------+</span>
<span class="token operator">|</span> Item3 <span class="token operator">|</span>    <span class="token number">152</span> <span class="token operator">|</span>     Wed <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+---------+</span>
<span class="token operator">|</span> Item3 <span class="token operator">|</span>    <span class="token number">145</span> <span class="token operator">|</span>     Thu <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+---------+</span>
<span class="token operator">|</span> Item3 <span class="token operator">|</span>    <span class="token number">125</span> <span class="token operator">|</span>     Fri <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+---------+</span>

</code></pre></div><h2 id="dynamic-pivot"><a href="#dynamic-pivot" class="header-anchor">#</a> Dynamic PIVOT</h2> <p>One problem with the <code>PIVOT</code> query is that you have to specify all values inside the <code>IN</code> selection if you want to see them as columns.
A quick way to circumvent this problem is to create a dynamic IN selection making your <code>PIVOT</code> dynamic.</p> <p>For demonstration we will use a table <code>Books</code> in a <code>Bookstore</code>’s database. We assume that the table is quite de-normalised and has following columns</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">Table</span>: Books
<span class="token comment">-----------------------------</span>
BookId <span class="token punctuation">(</span><span class="token keyword">Primary</span> <span class="token keyword">Key</span> <span class="token keyword">Column</span><span class="token punctuation">)</span>
Name
<span class="token keyword">Language</span>
NumberOfPages
EditionNumber
YearOfPrint
YearBoughtIntoStore
ISBN
AuthorName
Price
NumberOfUnitsSold

</code></pre></div><p>Creation script for the table will be like:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">[</span>dbo<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>BookList<span class="token punctuation">]</span><span class="token punctuation">(</span>
      <span class="token punctuation">[</span>BookId<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">int</span><span class="token punctuation">]</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
      <span class="token punctuation">[</span>Name<span class="token punctuation">]</span> <span class="token punctuation">[</span>nvarchar<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
      <span class="token punctuation">[</span><span class="token keyword">Language</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>nvarchar<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
      <span class="token punctuation">[</span>NumberOfPages<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">int</span><span class="token punctuation">]</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
      <span class="token punctuation">[</span>EditionNumber<span class="token punctuation">]</span> <span class="token punctuation">[</span>nvarchar<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
      <span class="token punctuation">[</span>YearOfPrint<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">int</span><span class="token punctuation">]</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
      <span class="token punctuation">[</span>YearBoughtIntoStore<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">int</span><span class="token punctuation">]</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
<span class="token punctuation">[</span>NumberOfBooks<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">int</span><span class="token punctuation">]</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
<span class="token punctuation">[</span>ISBN<span class="token punctuation">]</span> <span class="token punctuation">[</span>nvarchar<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
      <span class="token punctuation">[</span>AuthorName<span class="token punctuation">]</span> <span class="token punctuation">[</span>nvarchar<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
      <span class="token punctuation">[</span>Price<span class="token punctuation">]</span> <span class="token punctuation">[</span>money<span class="token punctuation">]</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
      <span class="token punctuation">[</span>NumberOfUnitsSold<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">int</span><span class="token punctuation">]</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
 <span class="token keyword">CONSTRAINT</span> <span class="token punctuation">[</span>PK_BookList<span class="token punctuation">]</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">CLUSTERED</span>
<span class="token punctuation">(</span>
      <span class="token punctuation">[</span>BookId<span class="token punctuation">]</span> <span class="token keyword">ASC</span>
<span class="token punctuation">)</span><span class="token keyword">WITH</span> <span class="token punctuation">(</span>PAD_INDEX <span class="token operator">=</span> <span class="token keyword">OFF</span><span class="token punctuation">,</span> STATISTICS_NORECOMPUTE <span class="token operator">=</span> <span class="token keyword">OFF</span><span class="token punctuation">,</span> IGNORE_DUP_KEY <span class="token operator">=</span> <span class="token keyword">OFF</span><span class="token punctuation">,</span> ALLOW_ROW_LOCKS <span class="token operator">=</span> <span class="token keyword">ON</span><span class="token punctuation">,</span> ALLOW_PAGE_LOCKS <span class="token operator">=</span> <span class="token keyword">ON</span><span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token punctuation">[</span><span class="token keyword">PRIMARY</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token punctuation">[</span><span class="token keyword">PRIMARY</span><span class="token punctuation">]</span>

GO

</code></pre></div><p>Now if we need to query on the database and figure out number of books in English, Russian, German, Hindi, Latin languages bought into the bookstore every year and present our output in a small report format, we can use PIVOT query like this</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span>
  <span class="token punctuation">(</span>
   <span class="token keyword">SELECT</span> YearBoughtIntoStore <span class="token keyword">AS</span> <span class="token punctuation">[</span><span class="token keyword">Year</span> Bought<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token keyword">Language</span><span class="token punctuation">]</span><span class="token punctuation">,</span> NumberOfBooks
   <span class="token keyword">FROM</span> BookList
  <span class="token punctuation">)</span> sourceData 
 <span class="token keyword">PIVOT</span>
  <span class="token punctuation">(</span>
  <span class="token function">SUM</span><span class="token punctuation">(</span>NumberOfBooks<span class="token punctuation">)</span>
  <span class="token keyword">FOR</span> <span class="token punctuation">[</span><span class="token keyword">Language</span><span class="token punctuation">]</span> <span class="token operator">IN</span> <span class="token punctuation">(</span>English<span class="token punctuation">,</span> Russian<span class="token punctuation">,</span> German<span class="token punctuation">,</span> Hindi<span class="token punctuation">,</span> Latin<span class="token punctuation">)</span>
  <span class="token punctuation">)</span> pivotrReport

</code></pre></div><p>Special case is when we do not have a full list of the languages, so we'll use dynamic SQL like below</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">DECLARE</span> <span class="token variable">@query</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span>
<span class="token keyword">DECLARE</span> <span class="token variable">@languages</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span>
<span class="token keyword">SELECT</span> <span class="token variable">@languages</span> <span class="token operator">=</span>
        STUFF<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> <span class="token string">'],['</span><span class="token operator">+</span>LTRIM<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token keyword">Language</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">FROM</span> <span class="token punctuation">[</span>dbo<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>BookList<span class="token punctuation">]</span>
        <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token string">'],['</span><span class="token operator">+</span>LTRIM<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token keyword">Language</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">FOR</span> XML PATH<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">']'</span>
<span class="token keyword">SET</span> <span class="token variable">@query</span><span class="token operator">=</span>
<span class="token string">'SELECT * FROM
  (SELECT YearBoughtIntoStore AS [Year Bought],[Language],NumberOfBooks
   FROM BookList) sourceData
PIVOT(SUM(NumberOfBooks)FOR [Language] IN ('</span><span class="token operator">+</span> <span class="token variable">@languages</span> <span class="token operator">+</span><span class="token string">')) pivotrReport'</span> <span class="token keyword">EXECUTE</span><span class="token punctuation">(</span><span class="token variable">@query</span><span class="token punctuation">)</span>

</code></pre></div><h2 id="simple-pivot-static-columns"><a href="#simple-pivot-static-columns" class="header-anchor">#</a> Simple Pivot - Static Columns</h2> <p>Using <a href="http://stackoverflow.com/documentation/sql/280/example-database/1207/item-sales-table#t=201604231440127063045" target="_blank" rel="noopener noreferrer">Item Sales Table<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> from <a href="http://stackoverflow.com/documentation/sql/280/example-database#t=201604231440308642346" target="_blank" rel="noopener noreferrer">Example Database<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, let us calculate and show the total Quantity we sold of each Product.</p> <p>This can be easily done with a group by, but lets assume we to 'rotate' our result table in a way that for each Product Id we have a column.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">145</span><span class="token punctuation">]</span>
  <span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> ItemId <span class="token punctuation">,</span> Quantity
          <span class="token keyword">FROM</span> <span class="token comment">#ItemSalesTable</span>
       <span class="token punctuation">)</span> <span class="token keyword">AS</span> pivotIntermediate
 <span class="token keyword">PIVOT</span> <span class="token punctuation">(</span>   <span class="token function">SUM</span><span class="token punctuation">(</span>Quantity<span class="token punctuation">)</span>
           <span class="token keyword">FOR</span> ItemId <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">145</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
       <span class="token punctuation">)</span> <span class="token keyword">AS</span> pivotTable

</code></pre></div><p>Since our 'new' columns are numbers (in the source table), we need to square brackets <code>[]</code></p> <p>This will give us an output like</p> <table><thead><tr><th>100</th> <th>145</th></tr></thead> <tbody><tr><td>45</td> <td>18</td></tr></tbody></table> <h4 id="syntax"><a href="#syntax" class="header-anchor">#</a> Syntax</h4> <li>SELECT `<non-pivoted column="">`,<br>
[first pivoted column] AS `<column name="">`,<br>
[second pivoted column] AS `<column name="">`,<br>
...<br>
[last pivoted column] AS `<column name="">`<br>
FROM<br>
(`<SELECT query="" that="" produces="" the="" data="">`)<br>
AS `<alias for="" the="" source="" query="">`<br>
PIVOT<br>
(<br>
`<aggregation function="">`(`<column being="" aggregated="">`)<br>
FOR<br>
[`<column that="" contains="" the="" values="" will="" become="" column="" headers="">`]<br>
IN ( [first pivoted column], [second pivoted column],<br>
... [last pivoted column])<br>
) AS `<alias for="" the="" pivot="" table="">`
`<optional ORDER="" BY="" clause="">`;</optional></alias></column></column></aggregation></alias></SELECT></column></column></column></non-pivoted></li> <h4 id="remarks"><a href="#remarks" class="header-anchor">#</a> Remarks</h4> <p>Using PIVOT and UNPIVOT operators you transform a table by shifting the rows (column values) of a table to columns and vise-versa. As part of this transformation aggregation functions can be applied on the table values.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/mssql/pivot-unpivot.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/mssql/window-functions.html" class="prev">
        Window functions
      </a></span> <span class="next"><a href="/mssql/dynamic-sql-pivot.html">
        Dynamic SQL Pivot
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/2041.a66241c7.js" defer></script>
  </body>
</html>
