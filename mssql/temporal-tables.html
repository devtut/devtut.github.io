<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Microsoft SQL Server - Temporal Tables</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="description" content="CREATE Temporal Tables, FOR SYSTEM_TIME ALL, Creating a Memory-Optimized System-Versioned Temporal Table and cleaning up the SQL Server history table, How do I query temporal data?, Return actual value specified point in time(FOR SYSTEM_TIME AS OF <date_time>), FOR SYSTEM_TIME BETWEEN <start_date_time> AND <end_date_time>, FOR SYSTEM_TIME FROM <start_date_time> TO <end_date_time>, FOR SYSTEM_TIME CONTAINED IN (<start_date_time> , <end_date_time>)">
    <meta property="og:site_name" content="DevTut">
    <meta property="og:title" content="Microsoft SQL Server - Temporal Tables">
    <meta property="og:description" content="CREATE Temporal Tables, FOR SYSTEM_TIME ALL, Creating a Memory-Optimized System-Versioned Temporal Table and cleaning up the SQL Server history table, How do I query temporal data?, Return actual value specified point in time(FOR SYSTEM_TIME AS OF <date_time>), FOR SYSTEM_TIME BETWEEN <start_date_time> AND <end_date_time>, FOR SYSTEM_TIME FROM <start_date_time> TO <end_date_time>, FOR SYSTEM_TIME CONTAINED IN (<start_date_time> , <end_date_time>)">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/mssql/temporal-tables.html">
    <meta property="og:image" content="/logo.png">
    <meta name="twitter:title" content="Microsoft SQL Server - Temporal Tables">
    <meta name="twitter:description" content="CREATE Temporal Tables, FOR SYSTEM_TIME ALL, Creating a Memory-Optimized System-Versioned Temporal Table and cleaning up the SQL Server history table, How do I query temporal data?, Return actual value specified point in time(FOR SYSTEM_TIME AS OF <date_time>), FOR SYSTEM_TIME BETWEEN <start_date_time> AND <end_date_time>, FOR SYSTEM_TIME FROM <start_date_time> TO <end_date_time>, FOR SYSTEM_TIME CONTAINED IN (<start_date_time> , <end_date_time>)">
    <meta name="twitter:url" content="/mssql/temporal-tables.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/logo.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="google-site-verification" content="76_rKXgwMVIjd-axJC_1zPV9OS4mEjvtgjYOWVkAdnQ">
    
    <link rel="preload" href="/assets/css/0.styles.60619e34.css" as="style"><link rel="preload" href="/assets/js/app.1779e102.js" as="script"><link rel="preload" href="/assets/js/3.2cfa8016.js" as="script"><link rel="preload" href="/assets/js/2072.509d334d.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.60619e34.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DevTut</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/devtut/generate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>MS SQL Server</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mssql/" aria-current="page" class="sidebar-link">Disclaimer</a></li><li><a href="/mssql/getting-started-with-microsoft-sql-server.html" class="sidebar-link">Getting started with Microsoft SQL Server</a></li><li><a href="/mssql/data-types.html" class="sidebar-link">Data Types</a></li><li><a href="/mssql/converting-data-types.html" class="sidebar-link">Converting data types</a></li><li><a href="/mssql/user-defined-table-types.html" class="sidebar-link">User Defined Table Types</a></li><li><a href="/mssql/select-statement.html" class="sidebar-link">SELECT statement</a></li><li><a href="/mssql/alias-names-in-sql-server.html" class="sidebar-link">Alias Names in Sql Server</a></li><li><a href="/mssql/nulls.html" class="sidebar-link">NULLs</a></li><li><a href="/mssql/variables.html" class="sidebar-link">Variables</a></li><li><a href="/mssql/dates.html" class="sidebar-link">Dates</a></li><li><a href="/mssql/generating-a-range-of-dates.html" class="sidebar-link">Generating a range of dates</a></li><li><a href="/mssql/database-snapshots.html" class="sidebar-link">Database Snapshots</a></li><li><a href="/mssql/coalesce.html" class="sidebar-link">COALESCE</a></li><li><a href="/mssql/if-else.html" class="sidebar-link">IF...ELSE</a></li><li><a href="/mssql/case-statement.html" class="sidebar-link">CASE Statement</a></li><li><a href="/mssql/insert-into.html" class="sidebar-link">INSERT INTO</a></li><li><a href="/mssql/drop-keyword.html" class="sidebar-link">Drop Keyword</a></li><li><a href="/mssql/merge.html" class="sidebar-link">MERGE</a></li><li><a href="/mssql/create-view.html" class="sidebar-link">CREATE VIEW</a></li><li><a href="/mssql/views.html" class="sidebar-link">Views</a></li><li><a href="/mssql/union.html" class="sidebar-link">UNION</a></li><li><a href="/mssql/try-catch.html" class="sidebar-link">TRY/CATCH</a></li><li><a href="/mssql/while-loop.html" class="sidebar-link">WHILE loop</a></li><li><a href="/mssql/over-clause.html" class="sidebar-link">OVER Clause</a></li><li><a href="/mssql/group-by.html" class="sidebar-link">GROUP BY</a></li><li><a href="/mssql/order-by.html" class="sidebar-link">ORDER BY</a></li><li><a href="/mssql/the-stuff-function.html" class="sidebar-link">The STUFF Function</a></li><li><a href="/mssql/json-in-sql-server.html" class="sidebar-link">JSON in Sql Server</a></li><li><a href="/mssql/openjson.html" class="sidebar-link">OPENJSON</a></li><li><a href="/mssql/for-json.html" class="sidebar-link">FOR JSON</a></li><li><a href="/mssql/queries-with-json-data.html" class="sidebar-link">Queries with JSON data</a></li><li><a href="/mssql/storing-json-in-sql-tables.html" class="sidebar-link">Storing JSON in SQL tables</a></li><li><a href="/mssql/modify-json-text.html" class="sidebar-link">Modify JSON text</a></li><li><a href="/mssql/for-xml-path.html" class="sidebar-link">FOR XML PATH</a></li><li><a href="/mssql/join.html" class="sidebar-link">Join</a></li><li><a href="/mssql/cross-apply.html" class="sidebar-link">cross apply</a></li><li><a href="/mssql/computed-columns.html" class="sidebar-link">Computed Columns</a></li><li><a href="/mssql/common-table-expressions.html" class="sidebar-link">Common Table Expressions</a></li><li><a href="/mssql/move-and-copy-data-around-tables.html" class="sidebar-link">Move and copy data around tables</a></li><li><a href="/mssql/limit-result-set.html" class="sidebar-link">Limit Result Set</a></li><li><a href="/mssql/retrieve-information-about-your-instance.html" class="sidebar-link">Retrieve Information about your Instance</a></li><li><a href="/mssql/with-ties-option.html" class="sidebar-link">With Ties Option</a></li><li><a href="/mssql/string-functions.html" class="sidebar-link">String Functions</a></li><li><a href="/mssql/logical-functions.html" class="sidebar-link">Logical Functions</a></li><li><a href="/mssql/aggregate-functions.html" class="sidebar-link">Aggregate Functions</a></li><li><a href="/mssql/string-aggregate-functions-in-sql-server.html" class="sidebar-link">String Aggregate functions in SQL Server</a></li><li><a href="/mssql/ranking-functions.html" class="sidebar-link">Ranking Functions</a></li><li><a href="/mssql/window-functions.html" class="sidebar-link">Window functions</a></li><li><a href="/mssql/pivot-unpivot.html" class="sidebar-link">PIVOT / UNPIVOT</a></li><li><a href="/mssql/dynamic-sql-pivot.html" class="sidebar-link">Dynamic SQL Pivot</a></li><li><a href="/mssql/partitioning.html" class="sidebar-link">Partitioning</a></li><li><a href="/mssql/stored-procedures.html" class="sidebar-link">Stored Procedures</a></li><li><a href="/mssql/retrieve-information-about-the-database.html" class="sidebar-link">Retrieve information about the database</a></li><li><a href="/mssql/split-string-function-in-sql-server.html" class="sidebar-link">Split String function in Sql Server</a></li><li><a href="/mssql/insert.html" class="sidebar-link">Insert</a></li><li><a href="/mssql/primary-keys.html" class="sidebar-link">Primary Keys</a></li><li><a href="/mssql/foreign-keys.html" class="sidebar-link">Foreign Keys</a></li><li><a href="/mssql/last-inserted-identity.html" class="sidebar-link">Last Inserted Identity</a></li><li><a href="/mssql/scope-identity.html" class="sidebar-link">SCOPE_IDENTITY()</a></li><li><a href="/mssql/sequences.html" class="sidebar-link">Sequences</a></li><li><a href="/mssql/indexing.html" class="sidebar-link">Indexing</a></li><li><a href="/mssql/full-text-indexing.html" class="sidebar-link">Full-Text Indexing</a></li><li><a href="/mssql/trigger.html" class="sidebar-link">Trigger</a></li><li><a href="/mssql/cursors.html" class="sidebar-link">Cursors</a></li><li><a href="/mssql/transaction-isolation-levels.html" class="sidebar-link">Transaction isolation levels</a></li><li><a href="/mssql/advanced-options.html" class="sidebar-link">Advanced options</a></li><li><a href="/mssql/migration.html" class="sidebar-link">Migration</a></li><li><a href="/mssql/table-valued-parameters.html" class="sidebar-link">Table Valued Parameters</a></li><li><a href="/mssql/dbmail.html" class="sidebar-link">DBMAIL</a></li><li><a href="/mssql/in-memory-oltp-hekaton.html" class="sidebar-link">In-Memory OLTP (Hekaton)</a></li><li><a href="/mssql/temporal-tables.html" aria-current="page" class="active sidebar-link">Temporal Tables</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mssql/temporal-tables.html#create-temporal-tables" class="sidebar-link">CREATE Temporal Tables</a></li><li class="sidebar-sub-header"><a href="/mssql/temporal-tables.html#for-system-time-all" class="sidebar-link">FOR SYSTEM_TIME ALL</a></li><li class="sidebar-sub-header"><a href="/mssql/temporal-tables.html#creating-a-memory-optimized-system-versioned-temporal-table-and-cleaning-up-the-sql-server-history-table" class="sidebar-link">Creating a Memory-Optimized System-Versioned Temporal Table and cleaning up the SQL Server history table</a></li><li class="sidebar-sub-header"><a href="/mssql/temporal-tables.html#how-do-i-query-temporal-data" class="sidebar-link">How do I query temporal data?</a></li><li class="sidebar-sub-header"><a href="/mssql/temporal-tables.html#return-actual-value-specified-point-in-time-for-system-time-as-of-date-time" class="sidebar-link">Return actual value specified point in time(FOR SYSTEM_TIME AS OF )</a></li><li class="sidebar-sub-header"><a href="/mssql/temporal-tables.html#for-system-time-between-start-date-time-and-end-date-time" class="sidebar-link">FOR SYSTEM_TIME BETWEEN</a></li><li class="sidebar-sub-header"><a href="/mssql/temporal-tables.html#for-system-time-from-start-date-time-to-end-date-time" class="sidebar-link">FOR SYSTEM_TIME FROM</a></li><li class="sidebar-sub-header"><a href="/mssql/temporal-tables.html#for-system-time-contained-in-start-date-time-end-date-time" class="sidebar-link">FOR SYSTEM_TIME CONTAINED IN ()</a></li></ul></li><li><a href="/mssql/use-of-temp-table.html" class="sidebar-link">Use of TEMP Table</a></li><li><a href="/mssql/scheduled-task-or-job.html" class="sidebar-link">Scheduled Task or Job</a></li><li><a href="/mssql/isolation-levels-and-locking.html" class="sidebar-link">Isolation levels and locking</a></li><li><a href="/mssql/sorting-ordering-rows.html" class="sidebar-link">Sorting/ordering rows</a></li><li><a href="/mssql/privileges-or-permissions.html" class="sidebar-link">Privileges or Permissions</a></li><li><a href="/mssql/sqlcmd.html" class="sidebar-link">SQLCMD</a></li><li><a href="/mssql/resource-governor.html" class="sidebar-link">Resource Governor</a></li><li><a href="/mssql/file-group.html" class="sidebar-link">File Group</a></li><li><a href="/mssql/basic-ddl-operations-in-ms-sql-server.html" class="sidebar-link">Basic DDL Operations in MS SQL Server</a></li><li><a href="/mssql/subqueries.html" class="sidebar-link">Subqueries</a></li><li><a href="/mssql/pagination.html" class="sidebar-link">Pagination</a></li><li><a href="/mssql/clustered-columnstore.html" class="sidebar-link">CLUSTERED COLUMNSTORE</a></li><li><a href="/mssql/parsename.html" class="sidebar-link">Parsename</a></li><li><a href="/mssql/installing-sql-server-on-windows.html" class="sidebar-link">Installing SQL Server on Windows</a></li><li><a href="/mssql/analyzing-a-query.html" class="sidebar-link">Analyzing a Query</a></li><li><a href="/mssql/query-hints.html" class="sidebar-link">Query Hints</a></li><li><a href="/mssql/query-store.html" class="sidebar-link">Query Store</a></li><li><a href="/mssql/querying-results-by-page.html" class="sidebar-link">Querying results by page</a></li><li><a href="/mssql/schemas.html" class="sidebar-link">Schemas</a></li><li><a href="/mssql/backup-and-restore-database.html" class="sidebar-link">Backup and Restore Database</a></li><li><a href="/mssql/transaction-handling.html" class="sidebar-link">Transaction handling</a></li><li><a href="/mssql/natively-compiled-modules-hekaton.html" class="sidebar-link">Natively compiled modules (Hekaton)</a></li><li><a href="/mssql/spatial-data.html" class="sidebar-link">Spatial Data</a></li><li><a href="/mssql/dynamic-sql.html" class="sidebar-link">Dynamic SQL</a></li><li><a href="/mssql/dynamic-data-masking.html" class="sidebar-link">Dynamic data masking</a></li><li><a href="/mssql/export-data-in-txt-file-by-using-sqlcmd.html" class="sidebar-link">Export data in txt file by using SQLCMD</a></li><li><a href="/mssql/common-language-runtime-integration.html" class="sidebar-link">Common Language Runtime Integration</a></li><li><a href="/mssql/delimiting-special-characters-and-reserved-words.html" class="sidebar-link">Delimiting special characters and reserved words</a></li><li><a href="/mssql/dbcc.html" class="sidebar-link">DBCC</a></li><li><a href="/mssql/bulk-import.html" class="sidebar-link">BULK Import</a></li><li><a href="/mssql/service-broker.html" class="sidebar-link">Service broker</a></li><li><a href="/mssql/permissions-and-security.html" class="sidebar-link">Permissions and Security</a></li><li><a href="/mssql/database-permissions.html" class="sidebar-link">Database permissions</a></li><li><a href="/mssql/row-level-security.html" class="sidebar-link">Row-level security</a></li><li><a href="/mssql/encryption.html" class="sidebar-link">Encryption</a></li><li><a href="/mssql/phantom-read.html" class="sidebar-link">PHANTOM read</a></li><li><a href="/mssql/filestream.html" class="sidebar-link">Filestream</a></li><li><a href="/mssql/bcp-bulk-copy-program-utility.html" class="sidebar-link">bcp (bulk copy program) Utility</a></li><li><a href="/mssql/sql-server-evolution-through-different-versions-2000-2016.html" class="sidebar-link">SQL Server Evolution through different versions (2000 - 2016)</a></li><li><a href="/mssql/sql-server-management-studio-ssms.html" class="sidebar-link">SQL Server Management Studio (SSMS)</a></li><li><a href="/mssql/managing-azure-sql-database.html" class="sidebar-link">Managing Azure SQL Database</a></li><li><a href="/mssql/system-database-tempdb.html" class="sidebar-link">System database - TempDb</a></li><li><a href="/mssql/microsoft-sql-server-management-studio-shortcut-keys.html" class="sidebar-link">Microsoft SQL Server Management Studio Shortcut Keys</a></li><li><a href="/mssql/contributors.html" class="sidebar-link">The Contributors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="temporal-tables"><a href="#temporal-tables" class="header-anchor">#</a> Temporal Tables</h1> <h2 id="create-temporal-tables"><a href="#create-temporal-tables" class="header-anchor">#</a> CREATE Temporal Tables</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> dbo<span class="token punctuation">.</span>Employee   
<span class="token punctuation">(</span>    
  <span class="token punctuation">[</span>EmployeeID<span class="token punctuation">]</span> <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">CLUSTERED</span>   
  <span class="token punctuation">,</span> <span class="token punctuation">[</span>Name<span class="token punctuation">]</span> nvarchar<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>  
  <span class="token punctuation">,</span> <span class="token punctuation">[</span>Position<span class="token punctuation">]</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>   
  <span class="token punctuation">,</span> <span class="token punctuation">[</span>Department<span class="token punctuation">]</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>  
  <span class="token punctuation">,</span> <span class="token punctuation">[</span>Address<span class="token punctuation">]</span> nvarchar<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>  
  <span class="token punctuation">,</span> <span class="token punctuation">[</span>AnnualSalary<span class="token punctuation">]</span> <span class="token keyword">decimal</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>  
  <span class="token punctuation">,</span> <span class="token punctuation">[</span>ValidFrom<span class="token punctuation">]</span> datetime2 <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> GENERATED ALWAYS <span class="token keyword">AS</span> <span class="token keyword">ROW</span> <span class="token keyword">START</span>  
  <span class="token punctuation">,</span> <span class="token punctuation">[</span>ValidTo<span class="token punctuation">]</span> datetime2 <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> GENERATED ALWAYS <span class="token keyword">AS</span> <span class="token keyword">ROW</span> <span class="token keyword">END</span>  
  <span class="token punctuation">,</span> PERIOD <span class="token keyword">FOR</span> SYSTEM_TIME <span class="token punctuation">(</span>ValidFrom<span class="token punctuation">,</span> ValidTo<span class="token punctuation">)</span>  
 <span class="token punctuation">)</span>    
 <span class="token keyword">WITH</span> <span class="token punctuation">(</span>SYSTEM_VERSIONING <span class="token operator">=</span> <span class="token keyword">ON</span> <span class="token punctuation">(</span>HISTORY_TABLE <span class="token operator">=</span> dbo<span class="token punctuation">.</span>EmployeeHistory<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  

</code></pre></div><p><strong>INSERTS:</strong> On an <strong>INSERT</strong>, the system sets the value for the <strong>ValidFrom</strong> column to the begin time of the current transaction (in the UTC time zone) based on the system clock and assigns the value for the <strong>ValidTo</strong> column to the maximum value of 9999-12-31. This marks the row as open.</p> <p><strong>UPDATES:</strong> On an <strong>UPDATE</strong>, the system stores the previous value of the row in the history table and sets the value for the <strong>ValidTo</strong> column to the begin time of the current transaction (in the UTC time zone) based on the system clock. This marks the row as closed, with a period recorded for which the row was valid. In the current table, the row is updated with its new value and the system sets the value for the <strong>ValidFrom</strong> column to the begin time for the transaction (in the UTC time zone) based on the system clock. The value for the updated row in the current table for the <strong>ValidTo</strong> column remains the maximum value of 9999-12-31.</p> <p><strong>DELETES</strong>: On a <strong>DELETE</strong>, the system stores the previous value of the row in the history table and sets the value for the <strong>ValidTo</strong> column to the begin time of the current transaction (in the UTC time zone) based on the system clock. This marks the row as closed, with a period recorded for which the previous row was valid. In the current table, the row is removed. Queries of the current table will not return this row. Only queries that deal with history data return data for which a row is closed.</p> <p><strong>MERGE</strong>: On a <strong>MERGE</strong>, the operation behaves exactly as if up to three statements (an <strong>INSERT</strong>, an <strong>UPDATE</strong>, and/or a <strong>DELETE</strong>) executed, depending on what is specified as actions in the <strong>MERGE</strong> statement.</p> <p><strong>Tip :</strong> The times recorded in the system datetime2 columns are based on the begin time of the transaction itself. For example, all rows inserted within a single transaction will have the same UTC time recorded in the column corresponding to the start of the <strong>SYSTEM_TIME</strong> period.</p> <h2 id="for-system-time-all"><a href="#for-system-time-all" class="header-anchor">#</a> FOR SYSTEM_TIME ALL</h2> <p>Returns the union of rows that belong to the current and the history table.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Employee
    <span class="token keyword">FOR</span> SYSTEM_TIME <span class="token keyword">ALL</span>

</code></pre></div><h2 id="creating-a-memory-optimized-system-versioned-temporal-table-and-cleaning-up-the-sql-server-history-table"><a href="#creating-a-memory-optimized-system-versioned-temporal-table-and-cleaning-up-the-sql-server-history-table" class="header-anchor">#</a> Creating a Memory-Optimized System-Versioned Temporal Table and cleaning up the SQL Server history table</h2> <p>Creating a temporal table with a default history table is a convenient option when you want to control naming and still rely on system to create history table with default configuration. In the example below, a new system-versioned memory-optimized temporal table linked to a new disk-based history table.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">SCHEMA</span> History  
GO  
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> dbo<span class="token punctuation">.</span>Department   
<span class="token punctuation">(</span>  
    DepartmentNumber <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">NONCLUSTERED</span><span class="token punctuation">,</span>   
    DepartmentName <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>   
    ManagerID <span class="token keyword">int</span>  <span class="token boolean">NULL</span><span class="token punctuation">,</span>   
    ParentDepartmentNumber <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>   
    SysStartTime datetime2 GENERATED ALWAYS <span class="token keyword">AS</span> <span class="token keyword">ROW</span> <span class="token keyword">START</span> HIDDEN <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>   
    SysEndTime datetime2 GENERATED ALWAYS <span class="token keyword">AS</span> <span class="token keyword">ROW</span> <span class="token keyword">END</span> HIDDEN <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>     
    PERIOD <span class="token keyword">FOR</span> SYSTEM_TIME <span class="token punctuation">(</span>SysStartTime<span class="token punctuation">,</span>SysEndTime<span class="token punctuation">)</span>     
<span class="token punctuation">)</span>  
<span class="token keyword">WITH</span>   
    <span class="token punctuation">(</span>  
        MEMORY_OPTIMIZED <span class="token operator">=</span> <span class="token keyword">ON</span><span class="token punctuation">,</span> DURABILITY <span class="token operator">=</span> SCHEMA_AND_DATA<span class="token punctuation">,</span>  
        SYSTEM_VERSIONING <span class="token operator">=</span> <span class="token keyword">ON</span> <span class="token punctuation">(</span> HISTORY_TABLE <span class="token operator">=</span> History<span class="token punctuation">.</span>DepartmentHistory <span class="token punctuation">)</span>   
    <span class="token punctuation">)</span><span class="token punctuation">;</span>  

</code></pre></div><p><strong>Cleaning up the SQL Server history table</strong>
Over time the history table can grow significantly. Since inserting, updating or deleting data from the history table are not allowed, the only way to clean up the history table is first to disable system versioning:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> dbo<span class="token punctuation">.</span>Employee

</code></pre></div><p>SET (SYSTEM_VERSIONING = OFF);
GO</p> <p>Delete unnecessary data from the history table:</p> <div class="language- extra-class"><pre class="language-text"><code>
   DELETE FROM dbo.EmployeeHistory

</code></pre></div><p>WHERE EndTime &lt;= '2017-01-26 14:00:29';</p> <p>and then re-enable system versioning:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> dbo<span class="token punctuation">.</span>Employee

</code></pre></div><p>SET (SYSTEM_VERSIONING = ON (HISTORY_TABLE = [dbo].[EmployeeHistory], DATA_CONSISTENCY_CHECK = ON));</p> <p>Cleaning the history table in Azure SQL Databases is a little different, since Azure SQL databases have built-in support for cleaning of the history table. First, temporal history retention cleanup need to be enable on a database level:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">DATABASE</span> <span class="token keyword">CURRENT</span>

</code></pre></div><p>SET TEMPORAL_HISTORY_RETENTION ON
GO</p> <p>Then set the retention period per table:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> dbo<span class="token punctuation">.</span>Employee

</code></pre></div><p>SET (SYSTEM_VERSIONING = ON (HISTORY_RETENTION_PERIOD = 90 DAYS));</p> <p>This will delete all data in the history table older than 90 days.
SQL Server 2016 on-premise databases do not support TEMPORAL_HISTORY_RETENTION and HISTORY_RETENTION_PERIOD and either of the above two queries are executed on the SQL Server 2016 on-premise databases the following errors will occur.</p> <p>For TEMPORAL_HISTORY_RETENTION error will be:</p> <div class="language-sql extra-class"><pre class="language-sql"><code>Msg <span class="token number">102</span><span class="token punctuation">,</span> <span class="token keyword">Level</span> <span class="token number">15</span><span class="token punctuation">,</span> State <span class="token number">6</span><span class="token punctuation">,</span> Line <span class="token number">34</span>

</code></pre></div><p>Incorrect syntax near ‘TEMPORAL_HISTORY_RETENTION’.</p> <p>For HISTORY_RETENTION_PERIOD error will be:</p> <div class="language-sql extra-class"><pre class="language-sql"><code>Msg <span class="token number">102</span><span class="token punctuation">,</span> <span class="token keyword">Level</span> <span class="token number">15</span><span class="token punctuation">,</span> State <span class="token number">1</span><span class="token punctuation">,</span> Line <span class="token number">39</span>

</code></pre></div><p>Incorrect syntax near ‘HISTORY_RETENTION_PERIOD’.</p> <h2 id="how-do-i-query-temporal-data"><a href="#how-do-i-query-temporal-data" class="header-anchor">#</a> How do I query temporal data?</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Employee   
    <span class="token keyword">FOR</span> SYSTEM_TIME    
        <span class="token operator">BETWEEN</span> <span class="token string">'2014-01-01 00:00:00.0000000'</span> <span class="token operator">AND</span> <span class="token string">'2015-01-01 00:00:00.0000000'</span>   
            <span class="token keyword">WHERE</span> EmployeeID <span class="token operator">=</span> <span class="token number">1000</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> ValidFrom<span class="token punctuation">;</span>  

</code></pre></div><h2 id="return-actual-value-specified-point-in-time-for-system-time-as-of-date-time"><a href="#return-actual-value-specified-point-in-time-for-system-time-as-of-date-time" class="header-anchor">#</a> Return actual value specified point in time(FOR SYSTEM_TIME AS OF &lt;date_time&gt;)</h2> <p>Returns a table with a rows containing the values that were actual (current) at the specified point in time in the past.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Employee   
    <span class="token keyword">FOR</span> SYSTEM_TIME <span class="token keyword">AS</span>  <span class="token keyword">OF</span> <span class="token string">'2016-08-06 08:32:37.91'</span>

</code></pre></div><h2 id="for-system-time-between-start-date-time-and-end-date-time"><a href="#for-system-time-between-start-date-time-and-end-date-time" class="header-anchor">#</a> FOR SYSTEM_TIME BETWEEN &lt;start_date_time&gt; AND &lt;end_date_time&gt;</h2> <p>Same as above in the FOR SYSTEM_TIME FROM &lt;start_date_time&gt;TO &lt;end_date_time&gt; description, except the table of rows returned includes rows that became active on the upper boundary defined by the &lt;end_date_time&gt; endpoint.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Employee   
    <span class="token keyword">FOR</span> SYSTEM_TIME <span class="token operator">BETWEEN</span>  <span class="token string">'2015-01-01'</span> <span class="token operator">AND</span> <span class="token string">'2015-12-31'</span> 

</code></pre></div><h2 id="for-system-time-from-start-date-time-to-end-date-time"><a href="#for-system-time-from-start-date-time-to-end-date-time" class="header-anchor">#</a> FOR SYSTEM_TIME FROM &lt;start_date_time&gt; TO &lt;end_date_time&gt;</h2> <p>Returns a table with the values for all row versions that were active within the specified time range, regardless of whether they started being active before the &lt;start_date_time&gt; parameter value for the FROM argument or ceased being active after the &lt;end_date_time&gt; parameter value for the TO argument. Internally, a union is performed between the temporal table and its history table and the results are filtered to return the values for all row versions that were active at any time during the time range specified. Rows that became active exactly on the lower boundary defined by the FROM endpoint are included and records that became active exactly on the upper boundary defined by the TO endpoint are not included.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Employee   
    <span class="token keyword">FOR</span> SYSTEM_TIME <span class="token keyword">FROM</span> <span class="token string">'2015-01-01'</span> <span class="token keyword">TO</span> <span class="token string">'2015-12-31'</span> 

</code></pre></div><h2 id="for-system-time-contained-in-start-date-time-end-date-time"><a href="#for-system-time-contained-in-start-date-time-end-date-time" class="header-anchor">#</a> FOR SYSTEM_TIME CONTAINED IN (&lt;start_date_time&gt; , &lt;end_date_time&gt;)</h2> <p>Returns a table with the values for all row versions that were opened and closed within the specified time range defined by the two datetime values for the CONTAINED IN argument. Rows that became active exactly on the lower boundary or ceased being active exactly on the upper boundary are included.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Employee
    <span class="token keyword">FOR</span> SYSTEM_TIME CONTAINED <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'2015-04-01'</span><span class="token punctuation">,</span> <span class="token string">'2015-09-25'</span><span class="token punctuation">)</span>   

</code></pre></div><h4 id="remarks"><a href="#remarks" class="header-anchor">#</a> Remarks</h4> <p>SQL Server 2016 introduces support for system-versioned temporal tables as a database feature that brings built-in support for providing information about data stored in the table at any point in time rather than only the data that is correct at the current moment in time.</p> <p>A system-versioned temporal table is a new type of user table in SQL Server 2016, designed to keep a full history of data changes and allow easy point in time analysis. This type of temporal table is referred to as a system-versioned temporal table because the period of validity for each row is managed by the system (i.e. database engine).
Every temporal table has two explicitly defined columns, each with a datetime2 data type. These columns are referred to as period columns. These period columns are used exclusively by the system to record period of validity for each row whenever a row is modified.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/devtut/generate/edit/master/docs/mssql/temporal-tables.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/mssql/in-memory-oltp-hekaton.html" class="prev">
        In-Memory OLTP (Hekaton)
      </a></span> <span class="next"><a href="/mssql/use-of-temp-table.html">
        Use of TEMP Table
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1779e102.js" defer></script><script src="/assets/js/3.2cfa8016.js" defer></script><script src="/assets/js/2072.509d334d.js" defer></script>
  </body>
</html>
